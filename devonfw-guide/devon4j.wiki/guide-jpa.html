<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.8">
<title>Java Persistence API</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/* Asciidoctor default stylesheet | MIT License | http://asciidoctor.org */
/* Uncomment @import statement below to use as custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section,summary{display:block}
audio,canvas,video{display:inline-block}
audio:not([controls]){display:none;height:0}
script{display:none!important}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
a{background:transparent}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*::before,*::after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto;tab-size:4;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:none}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite::before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt,table tr:nth-of-type(even){background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
*:not(pre)>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background-color:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed;word-wrap:break-word}
*:not(pre)>code.nobreak{word-wrap:normal}
*:not(pre)>code.nowrap{white-space:nowrap}
pre,pre>code{line-height:1.45;color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;text-rendering:optimizeSpeed}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background-color:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background-color:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background-color:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock pre:not(.highlight),.listingblock pre[class="highlight"],.listingblock pre[class^="highlight "],.listingblock pre.CodeRay,.listingblock pre.prettyprint{background:#f7f7f8}
.sidebarblock .literalblock pre,.sidebarblock .listingblock pre:not(.highlight),.sidebarblock .listingblock pre[class="highlight"],.sidebarblock .listingblock pre[class^="highlight "],.sidebarblock .listingblock pre.CodeRay,.sidebarblock .listingblock pre.prettyprint{background:#f2f1f1}
.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:1em}}
.literalblock pre.nowrap,.literalblock pre.nowrap pre,.listingblock pre.nowrap,.listingblock pre.nowrap pre{white-space:pre;word-wrap:normal}
.literalblock.output pre{color:#f7f7f8;background-color:rgba(0,0,0,.9)}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:#999}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:#999}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
table.pyhltable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.pyhltable td{vertical-align:top;padding-top:0;padding-bottom:0;line-height:1.45}
table.pyhltable td.code{padding-left:.75em;padding-right:0}
pre.pygments .lineno,table.pyhltable td:not(.code){color:#999;padding-left:0;padding-right:.5em;border-right:1px solid #dddddf}
pre.pygments .lineno{display:inline-block;margin-right:.25em}
table.pyhltable .linenodiv{background:none!important;padding-right:0!important}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt,.quoteblock .quoteblock{margin:0 0 1.25em;padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;text-align:left;margin-right:0}
table.tableblock{max-width:100%;border-collapse:separate}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>thead>tr>.tableblock,table.grid-all>tbody>tr>.tableblock{border-width:0 1px 1px 0}
table.grid-all>tfoot>tr>.tableblock{border-width:1px 1px 0 0}
table.grid-cols>*>tr>.tableblock{border-width:0 1px 0 0}
table.grid-rows>thead>tr>.tableblock,table.grid-rows>tbody>tr>.tableblock{border-width:0 0 1px}
table.grid-rows>tfoot>tr>.tableblock{border-width:1px 0 0}
table.grid-all>*>tr>.tableblock:last-child,table.grid-cols>*>tr>.tableblock:last-child{border-right-width:0}
table.grid-all>tbody>tr:last-child>.tableblock,table.grid-all>thead:last-child>tr>.tableblock,table.grid-rows>tbody>tr:last-child>.tableblock,table.grid-rows>thead:last-child>tr>.tableblock{border-bottom-width:0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot,table.frame-ends{border-width:1px 0}
table.stripes-all tr,table.stripes-odd tr:nth-of-type(odd){background:#f8f8f7}
table.stripes-none tr,table.stripes-odd tr:nth-of-type(even){background:none}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
td>div.verse{white-space:pre}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{margin-right:.25em}
ul.inline{display:-ms-flexbox;display:-webkit-box;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background-color:#00fafa}
.black{color:#000}
.black-background{background-color:#000}
.blue{color:#0000bf}
.blue-background{background-color:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background-color:#fa00fa}
.gray{color:#606060}
.gray-background{background-color:#7d7d7d}
.green{color:#006000}
.green-background{background-color:#007d00}
.lime{color:#00bf00}
.lime-background{background-color:#00fa00}
.maroon{color:#600000}
.maroon-background{background-color:#7d0000}
.navy{color:#000060}
.navy-background{background-color:#00007d}
.olive{color:#606000}
.olive-background{background-color:#7d7d00}
.purple{color:#600060}
.purple-background{background-color:#7d007d}
.red{color:#bf0000}
.red-background{background-color:#fa0000}
.silver{color:#909090}
.silver-background{background-color:#bcbcbc}
.teal{color:#006060}
.teal-background{background-color:#007d7d}
.white{color:#bfbfbf}
.white-background{background-color:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background-color:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background-color:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background-color:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media print,amzn-kf8{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
</head>
<body class="article toc2 toc-right">
<div id="header">
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel0">
<li><a href="#guide-jpa.asciidoc">Java Persistence API</a>
<ul class="sectlevel1">
<li><a href="#guide-jpa.asciidoc_entity">Entity</a>
<ul class="sectlevel2">
<li><a href="#guide-jpa.asciidoc_a-simple-entity">A Simple Entity</a></li>
<li><a href="#guide-jpa.asciidoc_entities-and-datatypes">Entities and Datatypes</a></li>
<li><a href="#guide-jpa.asciidoc_primary-keys">Primary Keys</a></li>
</ul>
</li>
<li><a href="#guide-jpa.asciidoc_relationships">Relationships</a>
<ul class="sectlevel2">
<li><a href="#guide-jpa.asciidoc_n1-and-11-relationships">n:1 and 1:1 Relationships</a></li>
<li><a href="#guide-jpa.asciidoc_1n-and-nm-relationships">1:n and n:m Relationships</a></li>
<li><a href="#guide-jpa.asciidoc_eager-vs.-lazy-loading">Eager vs. Lazy Loading</a></li>
<li><a href="#guide-jpa.asciidoc_cascading-relationships">Cascading Relationships</a></li>
</ul>
</li>
<li><a href="#guide-jpa.asciidoc_embeddable">Embeddable</a></li>
<li><a href="#guide-jpa.asciidoc_inheritance">Inheritance</a></li>
<li><a href="#guide-jpa.asciidoc_repositories-and-daos">Repositories and DAOs</a>
<ul class="sectlevel2">
<li><a href="#guide-jpa.asciidoc_concurrency-control">Concurrency Control</a></li>
<li><a href="#guide-jpa.asciidoc_optimistic-locking">Optimistic Locking</a></li>
<li><a href="#guide-jpa.asciidoc_pessimistic-locking">Pessimistic Locking</a></li>
</ul>
</li>
<li><a href="#guide-jpa.asciidoc_database-auditing">Database Auditing</a></li>
<li><a href="#guide-jpa.asciidoc_testing-entities-and-daos">Testing Entities and DAOs</a></li>
<li><a href="#guide-jpa.asciidoc_principles">Principles</a></li>
<li><a href="#guide-jpa.asciidoc_database-configuration">Database Configuration</a>
<ul class="sectlevel2">
<li><a href="#guide-jpa.asciidoc_database-system-and-access">Database System and Access</a></li>
<li><a href="#guide-jpa.asciidoc_database-migration">Database Migration</a></li>
<li><a href="#guide-jpa.asciidoc_database-logging">Database Logging</a></li>
<li><a href="#guide-jpa.asciidoc_pooling">Pooling</a></li>
</ul>
</li>
<li><a href="#guide-jpa.asciidoc_security">Security</a>
<ul class="sectlevel2">
<li><a href="#guide-jpa.asciidoc_sql-injection">SQL-Injection</a></li>
<li><a href="#guide-jpa.asciidoc_limited-permissions-for-application">Limited Permissions for Application</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<!-- toc disabled -->
<h1 id="guide-jpa.asciidoc" class="sect0">Java Persistence API</h1>
<div class="paragraph">
<p>For mapping java objects to a relational database we use the <a href="http://www.oracle.com/technetwork/java/javaee/tech/persistence-jsp-140049.html">Java Persistence API (JPA)</a>.
As JPA implementation we recommend to use <a href="http://hibernate.org/orm/">hibernate</a>. For general documentation about JPA and hibernate follow the links above as we will not replicate the documentation. Here you will only find guidelines and examples how we recommend to use it properly. The following examples show how to map the data of a database to an entity. As we use JPA we abstract from <a href="#guide-sql.asciidoc">SQL</a> here. However, you will still need a <a href="https://en.wikipedia.org/wiki/Data_definition_language">DDL</a> script for your schema and during maintenance also <a href="#guide-database-migration.asciidoc">database migrations</a>. Please follow our <a href="#guide-sql.asciidoc">SQL guide</a> for such artefacts.</p>
</div>
<div class="sect1">
<h2 id="guide-jpa.asciidoc_entity">Entity</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Entities are part of the persistence layer and contain the actual data. They are POJOs (Plain Old Java Objects) on which the relational data of a database is mapped and vice versa. The mapping is configured via JPA annotations (<code>javax.persistence</code>). Usually an entity class corresponds to a table of a database and a property to a column of that table. A persistent entity instance then represents a row of the database table.</p>
</div>
<div class="sect2">
<h3 id="guide-jpa.asciidoc_a-simple-entity">A Simple Entity</h3>
<div class="paragraph">
<p>The following listing shows a simple example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Entity
@Table(name="TEXTMESSAGE")
public class MessageEntity extends ApplicationPersistenceEntity implements Message {

  private String text;

  public String getText() {
    return this.text;
  }

  public void setText(String text) {
    this.text = text;
  }
 }</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>@Entity</code> annotation defines that instances of this class will be entities which can be stored in the database. The <code>@Table</code> annotation is optional and can be used to define the name of the corresponding table in the database. If it is not specified, the simple name of the entity class is used instead.</p>
</div>
<div class="paragraph">
<p>In order to specify how to map the attributes to columns we annotate the corresponding getter methods (technically also private field annotation is also possible but approaches can not be mixed).
The <code>@Id</code> annotation specifies that a property should be used as <a href="#guide-jpa.asciidoc_primary-keys">primary key</a>.
With the help of the <code>@Column</code> annotation it is possible to define the name of the column that an attribute is mapped to as well as other aspects such as <code>nullable</code> or <code>unique</code>. If no column name is specified, the name of the property is used as default.</p>
</div>
<div class="paragraph">
<p>Note that every entity class needs a constructor with public or protected visibility that does not have any arguments. Moreover, neither the class nor its getters and setters may be final.</p>
</div>
<div class="paragraph">
<p>Entities should be simple POJOs and not contain business logic.</p>
</div>
</div>
<div class="sect2">
<h3 id="guide-jpa.asciidoc_entities-and-datatypes">Entities and Datatypes</h3>
<div class="paragraph">
<p>Standard datatypes like <code>Integer</code>, <code>BigDecimal</code>, <code>String</code>, etc. are mapped automatically by JPA. Custom <a href="#guide-datatype.asciidoc">datatypes</a> are mapped as serialized <a href="#guide-jpa.asciidoc_blob">BLOB</a> by default what is typically undesired.
In order to map atomic custom datatypes (implementations of`+SimpleDatatype`) we implement an <code>AttributeConverter</code>. ere is a simple example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Converter(autoApply = true)
public class MoneyAttributeConverter implements AttributeConverter&lt;Money, BigDecimal&gt; {

  public BigDecimal convertToDatabaseColumn(Money attribute) {
    return attribute.getValue();
  }

  public Money convertToEntityAttribute(BigDecimal dbData) {
    return new Money(dbData);
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The annotation <code>@Converter</code> is detected by the JPA vendor if the annotated class is in the packages to scan. Further, <code>autoApply = true</code> implies that the converter is automatically used for all properties of the handled datatype. Therefore all entities with properties of that datatype will automatically be mapped properly (in our example <code>Money</code> is mapped as <code>BigDecimal</code>).</p>
</div>
<div class="paragraph">
<p>In case you have a composite datatype that you need to map to multiple columns the JPA does not offer a real solution. As a workaround you can use a bean instead of a real datatype and declare it as <a href="#guide-jpa.asciidoc_embeddable"><code>@Embeddable</code></a>. If you are using hibernate you can implement <code>CompositeUserType</code>. Via the <code>@TypeDef</code> annotation it can be registered to hibernate. If you want to annotate the <code>CompositeUserType</code> implementation itself you also need another annoation (e.g. <code>MappedSuperclass</code> tough not technically correct) so it is found by the scan.</p>
</div>
<div class="sect3">
<h4 id="guide-jpa.asciidoc_enumerations">Enumerations</h4>
<div class="paragraph">
<p>By default JPA maps Enums via their ordinal. Therefore the database will only contain the ordinals (0, 1, 2, etc.) . So , inside the database you can not easily understand their meaning. Using <code>@Enumerated</code> with <code>EnumType.STRING</code> allows to map the enum values to their name (<code>Enum.name()</code>). Both approaches are fragile when it comes to code changes and refactorings (if you change the order of the enum values or rename them) after the application is deployed to production. If you want to avoid this and get a robust mapping you can define a dedicated string in each enum value for database representation that you keep untouched. Then you treat the enum just like any other <a href="#guide-jpa.asciidoc_entities-and-datatypes">custom datatype</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="guide-jpa.asciidoc_blob">BLOB</h4>
<div class="paragraph">
<p>If binary or character large objects (BLOB/CLOB) should be used to store the value of an attribute, e.g. to store an icon, the <code>@Lob</code> annotation should be used as shown in the following listing:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Lob
public byte[] getIcon() {
  return this.icon;
}</code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Using a byte array will cause problems if BLOBs get large because the entire BLOB is loaded into the RAM of the server and has to be processed by the garbage collector. For larger BLOBs the type <a href="http://docs.oracle.com/javase/7/docs/api/java/sql/Blob.html">Blob</a> and streaming should be used.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public Blob getAttachment() {
  return this.attachment;
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="guide-jpa.asciidoc_date-and-time">Date and Time</h4>
<div class="paragraph">
<p>To store date and time related values, the temporal annotation can be used as shown in the listing below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Temporal(TemporalType.TIMESTAMP)
public java.util.Date getStart() {
  return start;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Until Java8 the java data type <code>java.util.Date</code> (or Jodatime) has to be used.
<code>TemporalType</code> defines the granularity. In this case, a precision of nanoseconds is used. If this granularity is not wanted, <code>TemporalType.DATE</code> can be used instead, which only has a granularity of milliseconds.
Mixing these two granularities can cause problems when comparing one value to another. This is why we <strong>only</strong>  use <code>TemporalType.TIMESTAMP</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="guide-jpa.asciidoc_querydsl-and-custom-types">QueryDSL and Custom Types</h4>
<div class="paragraph">
<p>Using the Aliases API of QueryDSL might result in an <code>InvalidDataAccessApiUsageException</code> when using custom datatypes in entity properties. This can be circumvented in two steps:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Ensure you have the following maven dependencies in your project (<code>core</code> module) to support custom types via the Aliases API:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;dependency&gt;
  &lt;groupId&gt;org.ow2.asm&lt;/groupId&gt;
  &lt;artifactId&gt;asm&lt;/artifactId&gt;
&lt;/dependency&gt;
&lt;dependency&gt;
  &lt;groupId&gt;cglib&lt;/groupId&gt;
  &lt;artifactId&gt;cglib&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
</li>
<li>
<p>Make sure, that all your custom types used in entities provide a non-argument constructor with at least visibility level <code>protected</code>.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="guide-jpa.asciidoc_primary-keys">Primary Keys</h3>
<div class="paragraph">
<p>We only use simple Long values as primary keys (IDs). By default it is auto generated (<code>@GeneratedValue(strategy=GenerationType.AUTO)</code>). This is already provided by the class <code>com.devonfw.&lt;projectName&gt;.general.dataaccess.api.AbstractPersistenceEntity</code> that you can extend.
In case you have business oriented keys (often as <code>String</code>), you can define an additional property for it and declare it as unique (<code>@Column(unique=true)</code>).
Be sure to include "AUTO_INCREMENT" in your sql table field ID to be able to persist data (or similar for other databases).</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="guide-jpa.asciidoc_relationships">Relationships</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="guide-jpa.asciidoc_n1-and-11-relationships">n:1 and 1:1 Relationships</h3>
<div class="paragraph">
<p>Entities often do not exist independently but are in some relation to each other. For example, for every period of time one of the StaffMember&#8217;s of the restaurant example has worked, which is represented by the class <code>WorkingTime</code>, there is a relationship to this StaffMember.</p>
</div>
<div class="paragraph">
<p>The following listing shows how this can be modeled using JPA:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">...

@Entity
public class WorkingTimeEntity {
   ...

   private StaffMemberEntity staffMember;

   @ManyToOne
   @JoinColumn(name="STAFFMEMBER")
   public StaffMemberEntity getStaffMember() {
      return this.staffMember;
   }

   public void setStaffMember(StaffMemberEntity staffMember) {
      this.staffMember = staffMember;
   }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>To represent the relationship, an attribute of the type of the corresponding entity class that is referenced has been introduced. The relationship is a n:1 relationship, because every <code>WorkingTime</code> belongs to exactly one <code>StaffMember</code>, but a <code>StaffMember</code> usually worked more often than once.<br>
This is why the <code>@ManyToOne</code> annotation is used here. For 1:1 relationships the <code>@OneToOne</code> annotation can be used which works basically the same way. To be able to save information about the relation in the database, an additional column in the corresponding table of WorkingTime is needed which contains the primary key of the referenced StaffMember. With the <code>name</code> element of the <code>@JoinColumn</code> annotation it is possible to specify the name of this column.</p>
</div>
</div>
<div class="sect2">
<h3 id="guide-jpa.asciidoc_1n-and-nm-relationships">1:n and n:m Relationships</h3>
<div class="paragraph">
<p>The relationship of the example listed above is currently an unidirectional one, as there is a getter method for retrieving the <code>StaffMember</code> from the <code>WorkingTime</code> object, but not vice versa.</p>
</div>
<div class="paragraph">
<p>To make it a bidirectional one, the following code has to be added to <code>StaffMember</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">  private Set&lt;WorkingTimeEntity&gt; workingTimes;

  @OneToMany(mappedBy="staffMember")
  public Set&lt;WorkingTimeEntity&gt; getWorkingTimes() {
    return this.workingTimes;
  }

  public void setWorkingTimes(Set&lt;WorkingTimeEntity&gt; workingTimes) {
    this.workingTimes = workingTimes;
  }</code></pre>
</div>
</div>
<div class="paragraph">
<p>To make the relationship bidirectional, the tables in the database do not have to be changed. Instead the column that corresponds to the attribute <code>staffMember</code> in class <code>WorkingTime</code> is used, which is specified by the <code>mappedBy</code> element of the <code>@OneToMany</code> annotation. Hibernate will search for corresponding <code>WorkingTime</code> objects automatically when a <code>StaffMember</code> is loaded.</p>
</div>
<div class="paragraph">
<p>The problem with bidirectional relationships is that if a <code>WorkingTime</code> object is added to the set or list <code>workingTimes</code> in <code>StaffMember</code>, this does not have any effect in the database unless
the <code>staffMember</code> attribute of that <code>WorkingTime</code> object is set. That is why the devon4j advices not to use bidirectional relationships but to use queries instead. How to do this is shown <a href="#guide-jpa.asciidoc_queries">here</a>. If a bidirectional relationship should be used nevertheless, approriate add and remove methods must be used.</p>
</div>
<div class="paragraph">
<p>For 1:n and n:m relations, the devon4j demands that (unordered) Sets and no other collection types are used, as shown in the listing above. The only exception is whenever an ordering is really needed, (sorted) lists can be used.<br>
For example, if <code>WorkingTime</code> objects should be sorted by their start time, this could be done like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">  private List&lt;WorkingTimeEntity&gt; workingTimes;

  @OneToMany(mappedBy = "staffMember")
  @OrderBy("startTime asc")
  public List&lt;WorkingTimeEntity&gt; getWorkingTimes() {
    return this.workingTimes;
  }

  public void setWorkingTimes(List&lt;WorkingTimeEntity&gt; workingTimes) {
    this.workingTimes = workingTimes;
  }</code></pre>
</div>
</div>
<div class="paragraph">
<p>The value of the <code>@OrderBy</code> annotation consists of an attribute name of the class followed by <code>asc</code> (ascending) or <code>desc</code> (descending).</p>
</div>
<div class="paragraph">
<p>To store information about a n:m relationship, a separate table has to be used, as one column cannot store several values (at least if the database schema is in first normal form).<br>
For example if one wanted to extend the example application so that all ingredients of one <code>FoodDrink</code> can be saved and to model the ingredients themselves as entities (e.g. to store additional information about them), this could be modeled as follows (extract of class <code>FoodDrink</code>):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">  private Set&lt;IngredientEntity&gt; ingredients;

  @ManyToMany()
  @JoinTable
  public Set&lt;IngredientEntity&gt; getIngredients() {
    return this.ingredients;
  }

  public void setOrders(Set&lt;IngredientEntity&gt; ingredients) {
    this.ingredients = ingredients;
  }</code></pre>
</div>
</div>
<div class="paragraph">
<p>Information about the relation is stored in a table called <code>BILL_ORDER</code> that has to have two columns, one for referencing the Bill, the other one for referencing the Order. Note that the <code>@JoinTable</code> annotation is not needed in this case because a separate table is the default solution here (same for n:m relations) unless there is a <code>mappedBy</code> element specified.</p>
</div>
<div class="paragraph">
<p>For 1:n relationships this solution has the disadvantage that more joins (in the database system) are needed to get a Bill with all the Orders it refers to. This might have a negative impact on performance so that the solution to store a reference to the Bill row/entity in the Order&#8217;s table is probably the better solution in most cases.</p>
</div>
<div class="paragraph">
<p>Note that bidirectional n:m relationships are not allowed for applications based on the devon4j. Instead a third entity has to be introduced, which "represents" the relationship (it has two n:1 relationships).</p>
</div>
</div>
<div class="sect2">
<h3 id="guide-jpa.asciidoc_eager-vs.-lazy-loading">Eager vs. Lazy Loading</h3>
<div class="paragraph">
<p>Using JPA it is possible to use either lazy or eager loading. Eager loading means that for entities retrieved from the database, other entities that are referenced by these entities are also retrieved, whereas lazy loading means that this is only done when they are actually needed, i.e. when the corresponding getter method is invoked.</p>
</div>
<div class="paragraph">
<p>Application based on the devon are strongly advised to always use lazy loading. The JPA defaults are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>@OneToMany</code>: LAZY</p>
</li>
<li>
<p><code>@ManyToMany</code>: LAZY</p>
</li>
<li>
<p><code>@ManyToOne</code>: EAGER</p>
</li>
<li>
<p><code>@OneToOne</code>: EAGER</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>So at least for <code>@ManyToOne</code> and <code>@OneToOne</code> you always need to override the default by providing <code>fetch = FetchType.LAZY</code>.
IMPORTANT: Please read the <a href="#guide-jpa-performance.asciidoc">performance guide</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="guide-jpa.asciidoc_cascading-relationships">Cascading Relationships</h3>
<div class="paragraph">
<p>For relations it is also possible to define whether operations are cascaded (like a recursion) to the related entity.
By default, nothing is done in these situations. This can be changed by using the <code>cascade</code> property of the annotation that specifies the relation type (<code>@OneToOne</code>, <code>@ManyToOne</code>, <code>@OneToMany</code>, <code>@ManyToOne</code>). This property accepts a <code>CascadeType</code> that offers the following options:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>PERSIST (for <code>EntityManager.persist</code>, relevant to inserted transient entities into DB)</p>
</li>
<li>
<p>REMOVE (for <code>EntityManager.remove</code> to delete entity from DB)</p>
</li>
<li>
<p>MERGE (for <code>EntityManager.merge</code>)</p>
</li>
<li>
<p>REFRESH (for <code>EntityManager.refresh</code>)</p>
</li>
<li>
<p>DETACH (for <code>EntityManager.detach</code>)</p>
</li>
<li>
<p>ALL (cascade all of the above operations)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>See <a href="http://meri-stuff.blogspot.de/2012/03/jpa-tutorial.html">here</a> for more information.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="guide-jpa.asciidoc_embeddable">Embeddable</h2>
<div class="sectionbody">
<div class="paragraph">
<p>An embeddable Object is a way to group properties of an <a href="#guide-jpa.asciidoc_entity">entity</a> into a separate Java (child) object. Unlike with implement <a href="#guide-jpa.asciidoc_relationships">relationships</a> the embeddable is not a separate entity and its properties are stored (embedded) in the same table together with the entity. This is helpful to structure and reuse groups of properties.</p>
</div>
<div class="paragraph">
<p>The following example shows an <code>Address</code> implemented as an embeddable class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Embeddable
public class AddressEmbeddable {

  private String street;
  private String number;
  private Integer zipCode;
  private String city;

  @Column(name="STREETNUMBER")
  public String getNumber() {
    return number;
  }

  public void setNumber(String number) {
    this.number = number;
  }

  ...  // other getter and setter methods, equals, hashCode
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see an embeddable is similar to an entity class, but with an <code>@Embeddable</code> annotation instead of the <code>@Entity</code> annotation and without primary key or modification counter.
An Embeddable does not exist on its own but in the context of an entity.
As a simplification Embeddables do not require a separate interface and <a href="guide-transferobject.html#ETO">ETO</a> as the <a href="#guide-beanmapping.asciidoc">bean-mapper</a> will create a copy automatically when converting the owning entity to an ETO.
However, in this case the embeddable becoms part of your <code>api</code> module that therefore needs a dependency on the <code>JPA</code>.</p>
</div>
<div class="paragraph">
<p>In addition to that the methods <code>equals(Object)</code> and <code>hashCode()</code> need to be implemented as this is required by Hibernate (it is not required for entities because they can be unambiguously identified by their primary key). For some hints on how to implement the <code>hashCode()</code> method please have a look <a href="http://stackoverflow.com/questions/113511/hash-code-implementation">here</a>.</p>
</div>
<div class="paragraph">
<p>Using this <code>AddressEmbeddable</code> inside an entity class can be done like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">  private AddressEmbeddable address;

  @Embedded
  public AddressEmbeddable getAddress() {
    return this.address;
  }

  public void setAddress(AddressEmbeddable address) {
    this.address = address;
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>@Embedded</code> annotation needs to be used for embedded attributes. Note that if in all columns of the embeddable (here <code>Address</code>) are <code>null</code>, then the embeddable object itself is also <code>null</code> inside the entity. This has to be considered to avoid NullPointerException&#8217;s. Further this causes some issues with primitive types in embeddable classes that can be avoided by only using object types instead.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="guide-jpa.asciidoc_inheritance">Inheritance</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Just like normal java classes, <a href="#guide-jpa.asciidoc_entity">entity</a> classes can inherit from others. The only difference is that you need to specify how to map a class hierarchy to database tables. Generic abstract super-classes for entities can simply be annotated with <code>@MappedSuperclass</code>.</p>
</div>
<div class="paragraph">
<p>For all other cases the JPA offers the annotation <code>@Inheritance</code> with the property <code>strategy</code> talking an <code>InheritanceType</code> that has the following options:</p>
</div>
<div class="openblock">
<div class="content">
<div class="ulist">
<ul>
<li>
<p><code>SINGLE_TABLE</code>: This strategy uses a single table that contains all columns needed to store all entity-types of the entire inheritance hierarchy. If a column is not needed for an entity because of its type, there is a null value in this column. An additional column is introduced, which denotes the type of the entity (called <code>dtype</code>).</p>
</li>
<li>
<p><code>TABLE_PER_CLASS</code>: For each concrete entity class there is a table in the database that can store such an entity with all its attributes. An entity is only saved in the table corresponding to its most concrete type. To get all entities of a super type, joins are needed.</p>
</li>
<li>
<p><code>JOINED</code>: In this case there is a table for every entity class including abstract classes, which contains only the columns for the persistent properties of that particular class. Additionally there is a primary key column in every table. To get an entity of a class that is a subclass of another one, joins are needed.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="paragraph">
<p>Each of the three approaches has its advantages and drawbacks, which are discussed in detail <a href="http://openjpa.apache.org/builds/1.0.4/apache-openjpa-1.0.4/docs/manual/jpa_overview_mapping_inher.html#jpa_overview_mapping_inher_tpc">here</a>. In most cases, the first one should be used, because it is usually the fastest way to do the mapping, as no joins are needed when retrieving, searching or persisting entities. Moreover it is rather simple and easy to understand.
One major disadvantage is that the first approach could lead to a table with a lot of null values, which might have a negative impact on the database size.</p>
</div>
<div class="paragraph">
<p>The inheritance strategy has to be annotated to the top-most entity of the class hierarchy (where `@MappedSuperclass`es are not considered) like in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Entity
@Inheritance(strategy=InheritanceType.SINGLE_TABLE)
public abstract class MyParentEntity extends ApplicationPersistenceEntity implements MyParent {
  ...
}

@Entity
public class MyChildEntity extends MyParentEntity implements MyChild {
  ...
}

@Entity
public class MyOtherEntity extends MyParentEntity implements MyChild {
  ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>As a best practice we advise you to avoid entity hierarchies at all where possible and otherwise to keep the hierarchy as small as possible. In order to just ensure reuse or establish a common API you can consider a shared interface, a <code>@MappedSuperclass</code> or an <code>@Embeddable</code> instead of an entity hierarchy.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="guide-jpa.asciidoc_repositories-and-daos">Repositories and DAOs</h2>
<div class="sectionbody">
<div class="paragraph">
<p>For each entity a code unit is created that groups all database operations for that entity. We recommend to use <a href="#guide-repository.asciidoc">spring-data respositories</a> for that as it is most efficient for developers. As an alternative there is still the classic approach using <a href="#guide-dao.asciidoc">DAOs</a>.</p>
</div>
<div class="sect2">
<h3 id="guide-jpa.asciidoc_concurrency-control">Concurrency Control</h3>
<div class="paragraph">
<p>The concurrency control defines the way concurrent access to the same data of a database is handled. When several users (or threads of application servers) concurrently access a database, anomalies may happen, e.g. a transaction is able to see changes from another transaction although that one did, not yet commit these changes. Most of these anomalies are automatically prevented by the database system, depending on the <a href="http://en.wikipedia.org/wiki/Isolation_(database_systems)"><em>isolation level</em></a> (property <code>hibernate.connection.isolation</code> in the <code>jpa.xml</code>, see <a href="http://docs.jboss.org/hibernate/orm/5.0/manual/en-US/html/ch03.html">here</a>).</p>
</div>
<div class="paragraph">
<p>Another anomaly is when two stakeholders concurrently access a record, do some changes and write them back to the database. The JPA addresses this with different locking strategies (see <a href="http://www.objectdb.com/java/jpa/persistence/lock">here</a>).</p>
</div>
<div class="paragraph">
<p>As a best practice we are using optimistic locking for regular end-user <a href="#guide-service-layer.asciidoc">services</a> (OLTP) and pessimistic locking for <a href="#guide-batch-layer.asciidoc">batches</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="guide-jpa.asciidoc_optimistic-locking">Optimistic Locking</h3>
<div class="paragraph">
<p>The class <code>com.devonfw.module.jpa.persistence.api.AbstractPersistenceEntity</code> already provides optimistic locking via a <code>modificationCounter</code> with the <code>@Version</code> annotation. Therefore JPA takes care of optimistic locking for you. When entities are transferred to clients, modified and sent back for update you need to ensure the <code>modificationCounter</code> is part of the game. If you follow our guides about <a href="#guide-transferobject.asciidoc">transfer-objects</a> and <a href="#guide-service-layer.asciidoc">services</a> this will also work out of the box.
You only have to care about two things:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>How to deal with optimistic locking in <a href="#guide-jpa.asciidoc_relationships">relationships</a>?<br>
Assume an entity <code>A</code> contains a collection of <code>B</code> entities. Should there be a locking conflict if one user modifies an instance of <code>A</code> while another user in parallel modifies an instance of <code>B</code> that is contained in the other instance? To address this , take a look at <a href="https://oasp.github.io/oasp4j_content/2.4.0/maven/apidocs/io/oasp/module/jpa/dataaccess/api/GenericDao.html#forceIncrementModificationCounter(E)">GenericDao.forceIncrementModificationCounter</a>.</p>
</li>
<li>
<p>What should happen in the UI if an <code>OptimisticLockException</code> occurred?<br>
According to KISS our recommendation is that the user gets an error displayed that tells him to do his change again on the recent data. Try to design your system and the work processing in a way to keep such conflicts rare and you are fine.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="guide-jpa.asciidoc_pessimistic-locking">Pessimistic Locking</h3>
<div class="paragraph">
<p>For back-end <a href="#guide-service-layer.asciidoc">services</a> and especially for <a href="#guide-batch-layer.asciidoc">batches</a> optimistic locking is not suitable. A human user shall not cause a large batch process to fail because he was editing the same entity. Therefore such use-cases use pessimistic locking what gives them a kind of priority over the human users.
In your <a href="#guide-jpa.asciidoc_data-access-object">DAO</a> implementation you can provide methods that do pessimistic locking via <a href="http://docs.oracle.com/javaee/7/api/javax/persistence/EntityManager.html"><code>EntityManager</code></a> operations that take a <a href="http://docs.oracle.com/javaee/7/api/javax/persistence/LockModeType.html"><code>LockModeType</code></a>. Here is a simple example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">  getEntityManager().lock(entity, LockModeType.READ);</code></pre>
</div>
</div>
<div class="paragraph">
<p>When using the <code>lock(Object, LockModeType)</code> method with <code>LockModeType.READ</code>, Hibernate will issue a <code>SELECT &#8230;&#8203; FOR UPDATE</code>. This means that no one else can update the entity (see <a href="http://docs.oracle.com/cd/B28359_01/server.111/b28286/statements_10002.htm">here</a> for more information on the statement). If <code>LockModeType.WRITE</code> is specified, Hibernate issues a <code>SELECT &#8230;&#8203; FOR UPDATE NOWAIT</code> instead, which has has the same meaning as the statement above, but if there is already a lock, the program will not wait for this lock to be released. Instead, an exception is raised.<br>
Use one of the types if you want to modify the entity later on, for read only access no lock is required.</p>
</div>
<div class="paragraph">
<p>As you might have noticed, the behavior of Hibernate deviates from what one would expect by looking at the <code>LockModeType</code> (especially <code>LockModeType.READ</code> should not cause a <code>SELECT &#8230;&#8203; FOR UPDATE</code> to be issued). The framework actually deviates from what is <a href="http://docs.oracle.com/javaee/7/api/javax/persistence/LockModeType.html">specified</a> in the JPA for unknown reasons.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="guide-jpa.asciidoc_database-auditing">Database Auditing</h2>
<div class="sectionbody">
<div class="paragraph">
<p>See <a href="#guide-auditing.asciidoc">auditing guide</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="guide-jpa.asciidoc_testing-entities-and-daos">Testing Entities and DAOs</h2>
<div class="sectionbody">
<div class="paragraph">
<p>See <a href="guide-testing.html#integration-testing">testing guide</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="guide-jpa.asciidoc_principles">Principles</h2>
<div class="sectionbody">
<div class="paragraph">
<p>We strongly recommend these principles:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Use the JPA where ever possible and use vendor (hibernate) specific features only for situations when JPA does not provide a solution. In the latter case consider first if you really need the feature.</p>
</li>
<li>
<p>Create your entities as simple POJOs and use JPA to annotate the getters in order to define the mapping.</p>
</li>
<li>
<p>Keep your entities simple and avoid putting advanced logic into entity methods.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="guide-jpa.asciidoc_database-configuration">Database Configuration</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <a href="#guide-configuration.asciidoc">configuration</a> for spring and hibernate is already provided by devonfw in our sample application and the application template. So you only need to worry about a few things to customize.</p>
</div>
<div class="sect2">
<h3 id="guide-jpa.asciidoc_database-system-and-access">Database System and Access</h3>
<div class="paragraph">
<p>Obviously you need to configure which type of database you want to use as well as the location and credentials to access it. The defaults are configured in <code>application-default.properties</code> that is bundled and deployed with the release of the software. It should therefore contain the properties as in the given example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">  database.url=jdbc:postgresql://database.enterprise.com/app
  database.user.login=appuser01
  database.hibernate.dialect = org.hibernate.dialect.PostgreSQLDialect
  database.hibernate.hbm2ddl.auto=validate</code></pre>
</div>
</div>
<div class="paragraph">
<p>The environment specific settings (especially passwords) are configured by the operators in <code>application.properties</code>. For further details consult the <a href="#guide-configuration.asciidoc">configuration guide</a>. It can also override the default values. The relevant configuration properties can be seen by the following example for the development environment (located in <code>src/test/resources</code>):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">  database.url=jdbc:postgresql://localhost/app
  database.user.password=************
  database.hibernate.hbm2ddl.auto=create</code></pre>
</div>
</div>
<div class="paragraph">
<p>For further details about <code>database.hibernate.hbm2ddl.auto</code> please see <a href="http://docs.jboss.org/hibernate/orm/5.0/manual/en-US/html/ch03.html#configuration-misc-properties">here</a>. For production and acceptance environments we use the value <code>validate</code> that should be set as default. In case you want to use Oracle RDBMS you can find additional hints <a href="guide-oracle.html#driver">here</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="guide-jpa.asciidoc_database-migration">Database Migration</h3>
<div class="paragraph">
<p>See <a href="#guide-database-migration.asciidoc">database migration</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="guide-jpa.asciidoc_database-logging">Database Logging</h3>
<div class="paragraph">
<p>Add the following properties to <code>application.properties</code> to enable logging of database queries for debugging purposes.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">spring.jpa.properties.hibernate.show_sql=true
spring.jpa.properties.hibernate.use_sql_comments=true
spring.jpa.properties.hibernate.format_sql=true</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="guide-jpa.asciidoc_pooling">Pooling</h3>
<div class="paragraph">
<p>You typically want to pool JDBC connections to boost performance by recycling previous connections. There are many libraries available to do connection pooling. We recommend to use <a href="https://github.com/brettwooldridge/HikariCP">HikariCP</a>. For Oracle RDBMS see <a href="guide-oracle.html#pooling">here</a>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="guide-jpa.asciidoc_security">Security</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="guide-jpa.asciidoc_sql-injection">SQL-Injection</h3>
<div class="paragraph">
<p>A common <a href="#guide-security.asciidoc">security</a> threat is <a href="http://en.wikipedia.org/wiki/SQL_injection">SQL-injection</a>. Never build queries with string concatenation or your code might be vulnerable as in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">  String query = "Select op from OrderPosition op where op.comment = " + userInput;
  return getEntityManager().createQuery(query).getResultList();</code></pre>
</div>
</div>
<div class="paragraph">
<p>Via the parameteter <code>userInput</code> an attacker can inject SQL (JPQL) and execute arbitrary statements in the database causing extreme damage. In order to prevent such injections you have to strictly follow our rules for <a href="#guide-jpa.asciidoc_queries">queries</a>: Use named queries for static queries and QueryDSL for dynamic queries. Please also consult the <a href="https://www.owasp.org/index.php/SQL_Injection_Prevention_Cheat_Sheet">SQL Injection Prevention Cheat Sheet</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="guide-jpa.asciidoc_limited-permissions-for-application">Limited Permissions for Application</h3>
<div class="paragraph">
<p>We suggest that you operate your application with a database user that has limited permissions so he can not modify the SQL schema (e.g. drop tables). For initializing the schema (DDL) or to do schema migrations use a separate user that is not used by the application itself.</p>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2019-09-24 11:34:47 UTC
</div>
</div>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.13.1/styles/github.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.13.1/highlight.min.js"></script>
<script>hljs.initHighlighting()</script>
</body>
</html>