<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.8">
<meta name="author" content="Updated at 2019-09-24 11:39:15 UTC">
<title>devonfw guide</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/* Asciidoctor default stylesheet | MIT License | http://asciidoctor.org */
/* Uncomment @import statement below to use as custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section,summary{display:block}
audio,canvas,video{display:inline-block}
audio:not([controls]){display:none;height:0}
script{display:none!important}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
a{background:transparent}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*::before,*::after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto;tab-size:4;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:none}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite::before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt,table tr:nth-of-type(even){background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
*:not(pre)>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background-color:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed;word-wrap:break-word}
*:not(pre)>code.nobreak{word-wrap:normal}
*:not(pre)>code.nowrap{white-space:nowrap}
pre,pre>code{line-height:1.45;color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;text-rendering:optimizeSpeed}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background-color:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background-color:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background-color:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock pre:not(.highlight),.listingblock pre[class="highlight"],.listingblock pre[class^="highlight "],.listingblock pre.CodeRay,.listingblock pre.prettyprint{background:#f7f7f8}
.sidebarblock .literalblock pre,.sidebarblock .listingblock pre:not(.highlight),.sidebarblock .listingblock pre[class="highlight"],.sidebarblock .listingblock pre[class^="highlight "],.sidebarblock .listingblock pre.CodeRay,.sidebarblock .listingblock pre.prettyprint{background:#f2f1f1}
.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:1em}}
.literalblock pre.nowrap,.literalblock pre.nowrap pre,.listingblock pre.nowrap,.listingblock pre.nowrap pre{white-space:pre;word-wrap:normal}
.literalblock.output pre{color:#f7f7f8;background-color:rgba(0,0,0,.9)}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:#999}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:#999}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
table.pyhltable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.pyhltable td{vertical-align:top;padding-top:0;padding-bottom:0;line-height:1.45}
table.pyhltable td.code{padding-left:.75em;padding-right:0}
pre.pygments .lineno,table.pyhltable td:not(.code){color:#999;padding-left:0;padding-right:.5em;border-right:1px solid #dddddf}
pre.pygments .lineno{display:inline-block;margin-right:.25em}
table.pyhltable .linenodiv{background:none!important;padding-right:0!important}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt,.quoteblock .quoteblock{margin:0 0 1.25em;padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;text-align:left;margin-right:0}
table.tableblock{max-width:100%;border-collapse:separate}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>thead>tr>.tableblock,table.grid-all>tbody>tr>.tableblock{border-width:0 1px 1px 0}
table.grid-all>tfoot>tr>.tableblock{border-width:1px 1px 0 0}
table.grid-cols>*>tr>.tableblock{border-width:0 1px 0 0}
table.grid-rows>thead>tr>.tableblock,table.grid-rows>tbody>tr>.tableblock{border-width:0 0 1px}
table.grid-rows>tfoot>tr>.tableblock{border-width:1px 0 0}
table.grid-all>*>tr>.tableblock:last-child,table.grid-cols>*>tr>.tableblock:last-child{border-right-width:0}
table.grid-all>tbody>tr:last-child>.tableblock,table.grid-all>thead:last-child>tr>.tableblock,table.grid-rows>tbody>tr:last-child>.tableblock,table.grid-rows>thead:last-child>tr>.tableblock{border-bottom-width:0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot,table.frame-ends{border-width:1px 0}
table.stripes-all tr,table.stripes-odd tr:nth-of-type(odd){background:#f8f8f7}
table.stripes-none tr,table.stripes-odd tr:nth-of-type(even){background:none}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
td>div.verse{white-space:pre}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{margin-right:.25em}
ul.inline{display:-ms-flexbox;display:-webkit-box;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background-color:#00fafa}
.black{color:#000}
.black-background{background-color:#000}
.blue{color:#0000bf}
.blue-background{background-color:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background-color:#fa00fa}
.gray{color:#606060}
.gray-background{background-color:#7d7d7d}
.green{color:#006000}
.green-background{background-color:#007d00}
.lime{color:#00bf00}
.lime-background{background-color:#00fa00}
.maroon{color:#600000}
.maroon-background{background-color:#7d0000}
.navy{color:#000060}
.navy-background{background-color:#00007d}
.olive{color:#606000}
.olive-background{background-color:#7d7d00}
.purple{color:#600060}
.purple-background{background-color:#7d007d}
.red{color:#bf0000}
.red-background{background-color:#fa0000}
.silver{color:#909090}
.silver-background{background-color:#bcbcbc}
.teal{color:#006060}
.teal-background{background-color:#007d7d}
.white{color:#bfbfbf}
.white-background{background-color:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background-color:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background-color:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background-color:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media print,amzn-kf8{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
</head>
<body id="master.asciidoc" class="book toc2 toc-right">
<div id="header">
<h1>devonfw guide</h1>
<div class="details">
<span id="author" class="author">Updated at 2019-09-24 11:39:15 UTC</span><br>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel0">
<li><a href="#master-general-start.asciidoc">I: Getting Started</a>
<ul class="sectlevel1">
<li><a href="#getting-started-what-is-devonfw.asciidoc">1. devonfw Introduction</a>
<ul class="sectlevel2">
<li><a href="#getting-started-what-is-devonfw.asciidoc_building-blocks-of-the-platform">1.1. Building Blocks of the Platform</a></li>
<li><a href="#getting-started-what-is-devonfw.asciidoc_devonfw-technology-stack">1.2. devonfw Technology Stack</a></li>
<li><a href="#getting-started-what-is-devonfw.asciidoc_custom-tools">1.3. Custom Tools</a></li>
<li><a href="#getting-started-what-is-devonfw.asciidoc_devonfw-modules">1.4. devonfw Modules</a></li>
</ul>
</li>
<li><a href="#getting-started-why-should-i-use-devonfw.asciidoc">2. Why should I use devonfw?</a>
<ul class="sectlevel2">
<li><a href="#getting-started-why-should-i-use-devonfw.asciidoc_objectives">2.1. Objectives</a></li>
<li><a href="#getting-started-why-should-i-use-devonfw.asciidoc_features">2.2. Features</a></li>
</ul>
</li>
<li><a href="#getting-started-download-and-setup.asciidoc">3. Download and Setup</a>
<ul class="sectlevel2">
<li><a href="#getting-started-download-and-setup.asciidoc_prerequisites">3.1. Prerequisites</a></li>
<li><a href="#getting-started-download-and-setup.asciidoc_download">3.2. Download</a></li>
<li><a href="#getting-started-download-and-setup.asciidoc_setup-the-workspace">3.3. Setup the workspace</a></li>
<li><a href="#getting-started-download-and-setup.asciidoc_setup-the-workspace-linux">3.4. Setup the workspace (Linux)</a></li>
</ul>
</li>
<li><a href="#getting-started-the-devon-ide.asciidoc">4. The Devon IDE</a>
<ul class="sectlevel2">
<li><a href="#getting-started-the-devon-ide.asciidoc_introduction">4.1. Introduction</a></li>
<li><a href="#getting-started-the-devon-ide.asciidoc_cobigen">4.2. Cobigen</a></li>
<li><a href="#getting-started-the-devon-ide.asciidoc_ide-plugins">4.3. IDE Plugins:</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#master-general-start.asciidoc">II: Devcon</a>
<ul class="sectlevel1">
<li><a href="#devcon-command-developers-guide.asciidoc">5. Devcon Command Developer&#8217;s guide</a>
<ul class="sectlevel2">
<li><a href="#devcon-command-developers-guide.asciidoc_introduction">5.1. Introduction</a></li>
<li><a href="#devcon-command-developers-guide.asciidoc_creating-your-own-devcon-modules">5.2. Creating your own Devcon modules</a></li>
<li><a href="#devcon-command-developers-guide.asciidoc_conclusion">5.3. Conclusion</a></li>
</ul>
</li>
<li><a href="#devcon-command-reference.asciidoc">6. Devcon Command Reference</a>
<ul class="sectlevel2">
<li><a href="#devcon-command-reference.asciidoc_dist">6.1. dist</a></li>
<li><a href="#devcon-command-reference.asciidoc_doc">6.2. doc</a></li>
<li><a href="#devcon-command-reference.asciidoc_github">6.3. github</a></li>
<li><a href="#devcon-command-reference.asciidoc_help">6.4. help</a></li>
<li><a href="#devcon-command-reference.asciidoc_devon4j">6.5. devon4j</a></li>
<li><a href="#devcon-command-reference.asciidoc_devon4ng">6.6. devon4ng</a></li>
<li><a href="#devcon-command-reference.asciidoc_project">6.7. project</a></li>
<li><a href="#devcon-command-reference.asciidoc_sencha">6.8. sencha</a></li>
<li><a href="#devcon-command-reference.asciidoc_workspace">6.9. workspace</a></li>
<li><a href="#devcon-command-reference.asciidoc_system">6.10. system</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#master-devon4j.asciidoc">III: devon4j</a>
<ul class="sectlevel1">
<li><a href="#master-devon4j.asciidoc_introduction">7. Introduction</a></li>
<li><a href="#architecture.asciidoc">8. Architecture</a>
<ul class="sectlevel2">
<li><a href="#architecture.asciidoc_key-principles">8.1. Key Principles</a></li>
<li><a href="#architecture.asciidoc_architecture-principles">8.2. Architecture Principles</a></li>
<li><a href="#architecture.asciidoc_application-architecture">8.3. Application Architecture</a></li>
<li><a href="#guide-component.asciidoc">8.4. Components</a></li>
</ul>
</li>
<li><a href="#master-devon4j.asciidoc_coding">9. Coding</a>
<ul class="sectlevel2">
<li><a href="#coding-conventions.asciidoc">9.1. Coding Conventions</a></li>
<li><a href="#coding-tools.asciidoc">9.2. Tools</a></li>
</ul>
</li>
<li><a href="#master-devon4j.asciidoc_layers">10. Layers</a>
<ul class="sectlevel2">
<li><a href="#guide-client-layer.asciidoc">10.1. Client Layer</a></li>
<li><a href="#guide-service-layer.asciidoc">10.2. Service Layer</a></li>
<li><a href="#guide-logic-layer.asciidoc">10.3. Logic Layer</a></li>
<li><a href="#guide-component-facade.asciidoc">10.4. Component Facade</a></li>
<li><a href="#guide-usecase.asciidoc">10.5. UseCase</a></li>
<li><a href="#guide-dataaccess-layer.asciidoc">10.6. Data-Access Layer</a></li>
<li><a href="#guide-batch-layer.asciidoc">10.7. Batch Layer</a></li>
</ul>
</li>
<li><a href="#master-devon4j.asciidoc_guides">11. Guides</a>
<ul class="sectlevel2">
<li><a href="#guide-dependency-injection.asciidoc">11.1. Dependency Injection</a></li>
<li><a href="#guide-configuration.asciidoc">11.2. Configuration</a></li>
<li><a href="#guide-jpa.asciidoc">11.3. Java Persistence API</a></li>
<li><a href="#guide-auditing.asciidoc">11.4. Auditing</a></li>
<li><a href="#guide-transactions.asciidoc">11.5. Transaction Handling</a></li>
<li><a href="#guide-sql.asciidoc">11.6. SQL</a></li>
<li><a href="#guide-database-migration.asciidoc">11.7. Database Migration</a></li>
<li><a href="#guide-hana.asciidoc">11.8. SAP HANA</a></li>
<li><a href="#guide-oracle.asciidoc">11.9. Oracle RDBMS</a></li>
<li><a href="#guide-jee.asciidoc">11.10. JEE</a></li>
<li><a href="#guide-logging.asciidoc">11.11. Logging</a></li>
<li><a href="#guide-security.asciidoc">11.12. Security</a></li>
<li><a href="#guide-access-control.asciidoc">11.13. Access-Control</a></li>
<li><a href="#guide-data-permission.asciidoc">11.14. Data-permissions</a></li>
<li><a href="#guide-validation.asciidoc">11.15. Validation</a></li>
<li><a href="#guide-aop.asciidoc">11.16. Aspect Oriented Programming (AOP)</a></li>
<li><a href="#guide-exceptions.asciidoc">11.17. Exception Handling</a></li>
<li><a href="#guide-i18n.asciidoc">11.18. Internationalization</a></li>
<li><a href="#guide-xml.asciidoc">11.19. XML</a></li>
<li><a href="#guide-json.asciidoc">11.20. JSON</a></li>
<li><a href="#guide-rest.asciidoc">11.21. REST</a></li>
<li><a href="#guide-soap.asciidoc">11.22. SOAP</a></li>
<li><a href="#guide-service-client.asciidoc">11.23. Service Client</a></li>
<li><a href="#guide-testing.asciidoc">11.24. Testing</a></li>
<li><a href="#guide-transferobject.asciidoc">11.25. Transfer-Objects</a></li>
<li><a href="#guide-beanmapping.asciidoc">11.26. Bean-Mapping</a></li>
<li><a href="#guide-datatype.asciidoc">11.27. Datatypes</a></li>
<li><a href="#guide-accessibility.asciidoc">11.28. Accessibility</a></li>
<li><a href="#guide-caching.asciidoc">11.29. Caching</a></li>
<li><a href="#guide-cors-support.asciidoc">11.30. CORS support</a></li>
<li><a href="#guide-blob-support.asciidoc">11.31. BLOB support</a></li>
<li><a href="#guide-jdk.asciidoc">11.32. Java Development Kit</a></li>
<li><a href="#guide-apm.asciidoc">11.33. Application Performance Management</a></li>
</ul>
</li>
<li><a href="#master-devon4j.asciidoc_devonfw-development">12. devonfw Development</a>
<ul class="sectlevel2">
<li><a href="#devonfw-ide-setup.asciidoc">12.1. IDE Setup</a></li>
<li><a href="#devonfw-issue-work.asciidoc">12.2. Issue creation and resolution</a></li>
<li><a href="#devonfw-code-contribution.asciidoc">12.3. Code contribution</a></li>
<li><a href="#devonfw-documentation.asciidoc">12.4. devonfw Documentation</a></li>
</ul>
</li>
<li><a href="#master-devon4j.asciidoc_tutorials">13. Tutorials</a>
<ul class="sectlevel2">
<li><a href="#tutorial-introduction.asciidoc">13.1. Introduction</a></li>
<li><a href="#tutorial-newapp.asciidoc">13.2. Creating a new application</a></li>
</ul>
</li>
<li><a href="#master-devon4j.asciidoc_for-core-developers">14. For Core-Developers</a>
<ul class="sectlevel2">
<li><a href="#devonfw-release.asciidoc">14.1. Creating a Release</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#master-devon4ng.asciidoc">IV: devon4ng</a>
<ul class="sectlevel1">
<li><a href="#master-devon4ng.asciidoc_architecture">15. Architecture</a>
<ul class="sectlevel2">
<li><a href="#architecture.asciidoc">15.1. Architecture</a></li>
<li><a href="#meta-architecture.asciidoc">15.2. Meta Architecture</a></li>
</ul>
</li>
<li><a href="#master-devon4ng.asciidoc_layers">16. Layers</a>
<ul class="sectlevel2">
<li><a href="#components-layer.asciidoc">16.1. Components Layer</a></li>
<li><a href="#services-layer.asciidoc">16.2. Services Layer</a></li>
</ul>
</li>
<li><a href="#master-devon4ng.asciidoc_guides">17. Guides</a>
<ul class="sectlevel2">
<li><a href="#guide-package-managers.asciidoc">17.1. Package Managers</a></li>
<li><a href="#guide-npm-yarn-workflow.asciidoc">17.2. Package Managers Workflow</a></li>
</ul>
</li>
<li><a href="#master-devon4ng.asciidoc_angular">18. Angular</a>
<ul class="sectlevel2">
<li><a href="#guide-accessibility.asciidoc">18.1. Accessibility</a></li>
<li><a href="#guide-angular-elements.asciidoc">18.2. Angular Elements</a></li>
<li><a href="#guide-angular-lazy-loading.asciidoc">18.3. Angular Lazy loading</a></li>
<li><a href="#guide-angular-library.asciidoc">18.4. Angular Library</a></li>
<li><a href="#guide-angular-theming.asciidoc">18.5. Angular Material Theming</a></li>
<li><a href="#guide-angular-pwa.asciidoc">18.6. Angular Progressive Web App</a></li>
<li><a href="#guide-app-initializer.asciidoc">18.7. APP_INITIALIZER</a></li>
<li><a href="#guide-component-decomposition.asciidoc">18.8. Component Decomposition</a></li>
<li><a href="#guide-consuming-rest-services.asciidoc">18.9. Consuming REST services</a></li>
<li><a href="#guide-error-handler.asciidoc">18.10. Error Handler in angular</a></li>
<li><a href="#guide-file-structure.asciidoc">18.11. File Structure</a></li>
<li><a href="#guide-internationalization.asciidoc">18.12. Internationalization</a></li>
<li><a href="#guide-routing.asciidoc">18.13. Routing</a></li>
<li><a href="#guide-testing.asciidoc">18.14. Testing</a></li>
<li><a href="#guide-update-angular-cli.asciidoc">18.15. Update Angular CLI</a></li>
<li><a href="#guide-working-with-angular-cli.asciidoc">18.16. Working with Angular CLI</a></li>
</ul>
</li>
<li><a href="#master-devon4ng.asciidoc_ionic">19. Ionic</a>
<ul class="sectlevel2">
<li><a href="#guide-ionic-getting-started.asciidoc">19.1. Ionic 4 Getting started</a></li>
<li><a href="#basic-proyect-set-up">19.2. Basic proyect set up</a></li>
<li><a href="#guide-ionic-from-code-to-android.asciidoc">19.3. Ionic 4 to android</a></li>
<li><a href="#guide-ionic-pwa.asciidoc">19.4. Ionic Progressive Web App</a></li>
</ul>
</li>
<li><a href="#master-devon4ng.asciidoc_layouts">20. Layouts</a>
<ul class="sectlevel2">
<li><a href="#guide-layout-with-angular-material.asciidoc">20.1. Angular Material Layout</a></li>
</ul>
</li>
<li><a href="#master-devon4ng.asciidoc_ngrx">21. NgRx</a>
<ul class="sectlevel2">
<li><a href="#guide-ngrx-getting-started.asciidoc">21.1. Introduction to NgRx</a></li>
<li><a href="#guide-ngrx-simple-store.asciidoc">21.2. State, Selection and Reducers</a></li>
<li><a href="#guide-ngrx-effects.asciidoc">21.3. Side effects with NgRx/Effects</a></li>
<li><a href="#guide-ngrx-entity.asciidoc">21.4. Simplifying CRUD with NgRx/Entity</a></li>
</ul>
</li>
<li><a href="#master-devon4ng.asciidoc_cookbook">22. Cookbook</a>
<ul class="sectlevel2">
<li><a href="#cookbook-abstract-class-store.asciidoc">22.1. Abstract Class Store</a></li>
<li><a href="#guide-add-electron.asciidoc">22.2. Angular Electron</a></li>
<li><a href="#guide-angular-mock-service.asciidoc">22.3. Angular Mock Service</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#master-devon4net.asciidoc">V: devon4net</a>
<ul class="sectlevel1">
<li><a href="#master-devon4net.asciidoc_arquitecture-basics">23. Arquitecture basics</a>
<ul class="sectlevel2">
<li><a href="#architecture_guide.asciidoc">23.1. <span class="navy">Introduction</span></a></li>
</ul>
</li>
<li><a href="#master-devon4net.asciidoc_coding-conventions">24. Coding conventions</a>
<ul class="sectlevel2">
<li><a href="#codeconvention.asciidoc">24.1. Code conventions</a></li>
</ul>
</li>
<li><a href="#master-devon4net.asciidoc_environment">25. Environment</a>
<ul class="sectlevel2">
<li><a href="#environment.asciidoc">25.1. Environment</a></li>
</ul>
</li>
<li><a href="#master-devon4net.asciidoc_user-guide">26. User guide</a>
<ul class="sectlevel2">
<li><a href="#userguide.asciidoc">26.1. <span class="navy">OASP4NET Guide</span></a></li>
</ul>
</li>
<li><a href="#master-devon4net.asciidoc_packages">27. Packages</a>
<ul class="sectlevel2">
<li><a href="#packages.asciidoc">27.1. Packages</a></li>
<li><a href="#packages.asciidoc">27.2. <span class="navy">Required software</span></a></li>
</ul>
</li>
<li><a href="#master-devon4net.asciidoc_templates">28. Templates</a>
<ul class="sectlevel2">
<li><a href="#templates.asciidoc">28.1. <span class="navy">Templates</span></a></li>
</ul>
</li>
<li><a href="#master-devon4net.asciidoc_samples">29. Samples</a>
<ul class="sectlevel2">
<li><a href="#samples.asciidoc">29.1. <span class="navy">Samples</span></a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#master-devonfw-shop-floor.asciidoc">VI: devonfw shop floor</a>
<ul class="sectlevel1">
<li><a href="#Home.asciidoc">30. What is devonfw shop floor?</a></li>
<li><a href="#dsf-how-to-use.asciidoc">31. How to use it</a>
<ul class="sectlevel2">
<li><a href="#dsf-how-to-use.asciidoc_prerequisites---provisioning-environment">31.1. Prerequisites - Provisioning environment</a></li>
<li><a href="#dsf-how-to-use.asciidoc_step-1---configuration-and-services-integration">31.2. Step 1 - Configuration and services integration</a></li>
<li><a href="#dsf-how-to-use.asciidoc_step-2---create-the-project">31.3. Step 2 - Create the project</a></li>
<li><a href="#dsf-how-to-use.asciidoc_step-3---deployment">31.4. Step 3 - Deployment</a></li>
<li><a href="#dsf-how-to-use.asciidoc_step-4---monitoring">31.5. Step 4 - Monitoring</a></li>
</ul>
</li>
<li><a href="#master-devonfw-shop-floor.asciidoc_provisioning-environments">32. Provisioning environments</a>
<ul class="sectlevel2">
<li><a href="#dsf-provisioning-production-line.asciidoc">32.1. Production Line provisioning environment</a></li>
<li><a href="#dsf-provisioning-dsf4docker.asciidoc">32.2. dsf4docker provisioning environment</a></li>
</ul>
</li>
<li><a href="#master-devonfw-shop-floor.asciidoc_configuration-and-services-integration">33. Configuration and services integration</a>
<ul class="sectlevel2">
<li><a href="#dsf-configure-nexus.asciidoc">33.1. Nexus Configuration</a></li>
<li><a href="#dsf-configure-sonarqube.asciidoc">33.2. SonarQube Configuration</a></li>
</ul>
</li>
<li><a href="#master-devonfw-shop-floor.asciidoc_create-project">34. Create project</a>
<ul class="sectlevel2">
<li><a href="#master-devonfw-shop-floor.asciidoc_create-and-integrate-git-repository">34.1. Create and integrate git repository</a></li>
<li><a href="#master-devonfw-shop-floor.asciidoc_start-new-devonfw-project">34.2. start new devonfw project</a></li>
<li><a href="#master-devonfw-shop-floor.asciidoc_cicd-configuration">34.3. cicd configuration</a></li>
</ul>
</li>
<li><a href="#master-devonfw-shop-floor.asciidoc_deployment-environments">35. Deployment environments</a>
<ul class="sectlevel2">
<li><a href="#master-devonfw-shop-floor.asciidoc_openshift">35.1. OpenShift</a></li>
</ul>
</li>
<li><a href="#master-devonfw-shop-floor.asciidoc_monitoring">36. Monitoring</a>
<ul class="sectlevel2">
<li><a href="#dsf-configure-jenkins-build-monitor-view.asciidoc">36.1. Build monitor view</a></li>
</ul>
</li>
<li><a href="#master-devonfw-shop-floor.asciidoc_annexes">37. Annexes</a>
<ul class="sectlevel2">
<li><a href="#master-devonfw-shop-floor.asciidoc_bitbucket">37.1. BitBucket</a></li>
<li><a href="#dsf-openshift-services-selenium-basic-grid.asciidoc">37.2. Basic Selenium Grid setup in OpenShift</a></li>
<li><a href="#dsf-mirabaud-cicd-environment-setup.asciidoc">37.3. Mirabaud CICD Environment Setup</a></li>
<li><a href="#dsf-okd.asciidoc">37.4. OKD <em>(OpenShift Origin)</em></a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#master-cicdgen.asciidoc">VII: cicdgen</a>
<ul class="sectlevel1">
<li><a href="#Home.asciidoc">38. CICDGEN</a>
<ul class="sectlevel2">
<li><a href="#home.asciidoc_what-is-angular-schematics">38.1. What is angular schematics?</a></li>
<li><a href="#home.asciidoc_cicdgen-cli">38.2. cicdgen CLI</a></li>
<li><a href="#home.asciidoc_cicdgen-schematics">38.3. cicdgen Schematics</a></li>
<li><a href="#home.asciidoc_usage-example">38.4. Usage example</a></li>
</ul>
</li>
<li><a href="#master-cicdgen.asciidoc_cicdgen-cli">39. cicdgen CLI</a>
<ul class="sectlevel3">
<li><a href="#cicdgen-cli.asciidoc_cicdgen-cli">39.1. CICDGEN CLI</a></li>
<li><a href="#usage-example.asciidoc_cicdgen-usage-example">39.2. cicdgen usage example</a></li>
</ul>
</li>
<li><a href="#master-cicdgen.asciidoc_cicdgen-schematics">40. cicdgen Schematics</a>
<ul class="sectlevel3">
<li><a href="#cicdgen-schematics.asciidoc_cicdgen-schematics">40.1. CICDGEN SCHEMATICS</a></li>
<li><a href="#devon4j-schematic.asciidoc_devon4j-schematic">40.2. Devon4j schematic</a></li>
<li><a href="#devon4ng-schematic.asciidoc_devon4ng-schematic">40.3. Devon4ng schematic</a></li>
<li><a href="#devon4node-schematic.asciidoc_devon4node-schematic">40.4. Devon4node schematic</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#master-cobigen.asciidoc">VIII: CobiGen&#8201;&#8212;&#8201;Code-based incremental Generator</a>
<ul class="sectlevel1">
<li><a href="#master-cobigen.asciidoc_document-description">41. Document Description</a>
<ul class="sectlevel2">
<li><a href="#Guide-to-the-Reader.asciidoc">41.1. Guide to the Reader</a></li>
<li><a href="#Home.asciidoc">41.2. CobiGen - Code-based incremental Generator</a></li>
<li><a href="#cobigen-usecases.asciidoc">41.3. General use cases</a></li>
</ul>
</li>
<li><a href="#master-cobigen.asciidoc_cobigen">42. CobiGen</a>
<ul class="sectlevel2">
<li><a href="#cobigen-core_configuration.asciidoc">42.1. Configuration</a></li>
<li><a href="#master-cobigen.asciidoc_plug-ins">42.2. Plug-ins</a></li>
</ul>
</li>
<li><a href="#master-cobigen.asciidoc_maven-build-integration">43. Maven Build Integration</a>
<ul class="sectlevel2">
<li><a href="#cobigen-maven_configuration.asciidoc">43.1. Maven Build Integration</a></li>
</ul>
</li>
<li><a href="#master-cobigen.asciidoc_eclipse-integration">44. Eclipse Integration</a>
<ul class="sectlevel2">
<li><a href="#cobigen-eclipse_installation.asciidoc">44.1. Installation</a></li>
<li><a href="#cobigen-eclipse_usage.asciidoc">44.2. Usage</a></li>
<li><a href="#cobigen-eclipse_logging.asciidoc">44.3. Logging</a></li>
</ul>
</li>
<li><a href="#master-cobigen.asciidoc_template-development">45. Template Development</a>
<ul class="sectlevel2">
<li><a href="#cobigen-templates_helpful-links.asciidoc">45.1. Helpful links for template development</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#master-devonfw-testing.asciidoc">IX: devonfw testing</a>
<ul class="sectlevel1">
<li><a href="#Home.asciidoc">46. Home</a>
<ul class="sectlevel2">
<li><a href="#home.asciidoc_contact">46.1. Contact</a></li>
<li><a href="#home.asciidoc_what-is-e2e-mr-checker-test-framework">46.2. What is E2E Mr Checker Test Framework</a></li>
<li><a href="#home.asciidoc_where-mr-checker-applies">46.3. Where Mr Checker applies?</a></li>
<li><a href="#home.asciidoc_benefits-for-the-project">46.4. Benefits for the project</a></li>
<li><a href="#home.asciidoc_road-map-plan">46.5. Road map plan</a></li>
<li><a href="#home.asciidoc_wiki-structure">46.6. Wiki Structure</a></li>
</ul>
</li>
<li><a href="#How-to-install.asciidoc">47. How to install</a>
<ul class="sectlevel3">
<li><a href="#how-to-install.asciidoc_easy-out-of-the-box-installation">47.1. Easy out of the box installation</a></li>
<li><a href="#how-to-install.asciidoc_out-of-the-box-installation---with-additional-steps">47.2. Out of the box installation - with additional steps</a></li>
<li><a href="#how-to-install.asciidoc_advanced-manual-step-by-step-installation">47.3. Advanced manual step by step installation</a></li>
</ul>
</li>
<li><a href="#master-devonfw-testing.asciidoc_mr-checker-test-framework-modules">48. Mr Checker Test Framework modules</a>
<ul class="sectlevel2">
<li><a href="#Core-test-module.asciidoc">48.1. Core Test Module</a></li>
<li><a href="#Selenium-test-module.asciidoc">48.2. Selenium Test Module</a></li>
<li><a href="#WebAPI-test-module.asciidoc">48.3. WebAPI Test Module</a></li>
<li><a href="#WebAPI-test-module.asciidoc">48.4. Service Virtualization</a></li>
<li><a href="#Security-test-module.asciidoc">48.5. Security Test Module</a></li>
<li><a href="#Database-test-module.asciidoc">48.6. Database Test Module</a></li>
<li><a href="#Mobile-test-module.asciidoc">48.7. Mobile Test Module</a></li>
<li><a href="#Standalone-test-module.asciidoc">48.8. Standalone Test Module</a></li>
<li><a href="#DevOps-module.asciidoc">48.9. DevOps Module</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#master-my-thai-star.asciidoc">X: MyThaiStar</a>
<ul class="sectlevel1">
<li><a href="#agile.asciidoc">49. 1.	My Thai Star – Agile Framework</a>
<ul class="sectlevel2">
<li><a href="#agile.asciidoc_1.1-team-setup">49.1. 1.1 Team Setup</a></li>
<li><a href="#agile.asciidoc_1.2-scrum-events">49.2. 1.2 Scrum events</a></li>
<li><a href="#agile.asciidoc_1.3-establish-product-backlog">49.3. 1.3 Establish Product Backlog</a></li>
</ul>
</li>
<li><a href="#agile.asciidoc">50. 2.	My Thai Star – Agile Diary</a>
<ul class="sectlevel2">
<li><a href="#agile.asciidoc_24.03.2017-sprint-1-planning">50.1. 24.03.2017 Sprint 1 Planning</a></li>
<li><a href="#agile.asciidoc_27.04.2017-sprint-1-review">50.2. 27.04.2017 Sprint 1 Review</a></li>
<li><a href="#agile.asciidoc_03.05.2017-sprint-2-planning">50.3. 03.05.2017 Sprint 2 Planning</a></li>
<li><a href="#agile.asciidoc_01.06.2017-sprint-2-review">50.4. 01.06.2017 Sprint 2 Review</a></li>
</ul>
</li>
<li><a href="#User-Stories.asciidoc">51. User Stories</a>
<ul class="sectlevel2">
<li><a href="#user-stories.asciidoc_epic-invite-friends">51.1. Epic: Invite friends</a></li>
<li><a href="#user-stories.asciidoc_epic-digital-menu">51.2. Epic: Digital Menu</a></li>
<li><a href="#user-stories.asciidoc_epic-user-profile">51.3. Epic: User Profile</a></li>
<li><a href="#user-stories.asciidoc_epic-rate-by-twitter">51.4. Epic: Rate by twitter</a></li>
<li><a href="#user-stories.asciidoc_epic-waiter-cockpit">51.5. Epic: Waiter Cockpit</a></li>
</ul>
</li>
<li><a href="#master-my-thai-star.asciidoc_technical-design">52. Technical design</a>
<ul class="sectlevel2">
<li><a href="#master-my-thai-star.asciidoc_data-model">52.1. Data Model</a></li>
<li><a href="#master-my-thai-star.asciidoc_server-side">52.2. Server Side</a></li>
<li><a href="#master-my-thai-star.asciidoc_client-side">52.3. Client Side</a></li>
</ul>
</li>
<li><a href="#master-my-thai-star.asciidoc_security">53. Security</a>
<ul class="sectlevel2">
<li><a href="#twofactor.asciidoc">53.1. Two-Factor Authentication</a></li>
</ul>
</li>
<li><a href="#master-my-thai-star.asciidoc_testing">54. Testing</a>
<ul class="sectlevel2">
<li><a href="#master-my-thai-star.asciidoc_server-side">54.1. Server Side</a></li>
<li><a href="#master-my-thai-star.asciidoc_client-side">54.2. Client Side</a></li>
<li><a href="#master-my-thai-star.asciidoc_end-to-end">54.3. End to end</a></li>
</ul>
</li>
<li><a href="#master-my-thai-star.asciidoc_ui-design">55. UI design</a>
<ul class="sectlevel2">
<li><a href="#style-guide.asciidoc">55.1. Style guide</a></li>
<li><a href="#style-guide.asciidoc">55.2. Low and high fidelity wireframes</a></li>
</ul>
</li>
<li><a href="#master-my-thai-star.asciidoc_cicd">56. CI/CD</a>
<ul class="sectlevel2">
<li><a href="#production-line-ci.asciidoc">56.1. My Thai Star in Production Line</a></li>
<li><a href="#deployment.asciidoc">56.2. Deployment</a></li>
<li><a href="#deployment.asciidoc">56.3. Container Schema</a></li>
<li><a href="#deployment.asciidoc">56.4. Run My Thai Star</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#master-general-end.asciidoc">XI: Contributing Guide</a>
<ul class="sectlevel1">
<li><a href="#Contributing-Code.asciidoc">57. Code Contributions</a>
<ul class="sectlevel2">
<li><a href="#contributing-code.asciidoc_notes-on-code-contributions">57.1. Notes on Code Contributions</a></li>
<li><a href="#contributing-code.asciidoc_introduction-to-git-and-github">57.2. Introduction to Git and GitHub</a></li>
<li><a href="#contributing-code.asciidoc_structure-of-our-projects">57.3. Structure of our projects</a></li>
<li><a href="#contributing-code.asciidoc_contributing-to-our-projects">57.4. Contributing to our projects</a></li>
<li><a href="#contributing-code.asciidoc_reviewing-pull-requests">57.5. Reviewing Pull Requests</a></li>
</ul>
</li>
<li><a href="#Contributing-Code-of-Conduct.asciidoc">58. Contributor Covenant Code of Conduct</a>
<ul class="sectlevel2">
<li><a href="#contributing-code-of-conduct.asciidoc_our-pledge">58.1. Our Pledge</a></li>
<li><a href="#contributing-code-of-conduct.asciidoc_our-standards">58.2. Our Standards</a></li>
<li><a href="#contributing-code-of-conduct.asciidoc_our-responsibilities">58.3. Our Responsibilities</a></li>
<li><a href="#contributing-code-of-conduct.asciidoc_scope">58.4. Scope</a></li>
<li><a href="#contributing-code-of-conduct.asciidoc_enforcement">58.5. Enforcement</a></li>
<li><a href="#contributing-code-of-conduct.asciidoc_attribution">58.6. Attribution</a></li>
</ul>
</li>
<li><a href="#Contributing-Development-Guidelines.asciidoc">59. Development Guidelines</a></li>
<li><a href="#Contributing-Git-Fork-Guide.asciidoc">60. Working with forked repositories</a>
<ul class="sectlevel2">
<li><a href="#contributing-git-fork-guide.asciidoc_fork-a-repository">60.1. Fork a repository</a></li>
<li><a href="#contributing-git-fork-guide.asciidoc_configuring-a-remote-for-a-fork">60.2. Configuring a remote for a fork</a></li>
<li><a href="#contributing-git-fork-guide.asciidoc_syncing-a-fork">60.3. Syncing a fork</a></li>
</ul>
</li>
<li><a href="#Contributing-Wiki.asciidoc">61. Wiki Contributions</a>
<ul class="sectlevel2">
<li><a href="#contributing-wiki.asciidoc_text-styles">61.1. Text styles</a></li>
<li><a href="#contributing-wiki.asciidoc_titles">61.2. Titles</a></li>
<li><a href="#contributing-wiki.asciidoc_lists">61.3. Lists</a></li>
<li><a href="#contributing-wiki.asciidoc_tables">61.4. Tables</a></li>
<li><a href="#contributing-wiki.asciidoc_source-code">61.5. Source Code</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#master-general-end.asciidoc">XII: OSS Compliance</a>
<ul class="sectlevel1">
<li><a href="#Cookbook-OSS-Compliance.asciidoc">62. Cookbook OSS Compliance</a>
<ul class="sectlevel2">
<li><a href="#cookbook-oss-compliance.asciidoc_preface">62.1. Preface</a></li>
<li><a href="#cookbook-oss-compliance.asciidoc_obligations-when-using-oss">62.2. Obligations when using OSS</a></li>
<li><a href="#cookbook-oss-compliance.asciidoc_automate-oss-handling">62.3. Automate OSS handling</a></li>
<li><a href="#cookbook-oss-compliance.asciidoc_configure-the-mojo-maven-license-plugin">62.4. Configure the Mojo Maven License Plugin</a></li>
<li><a href="#cookbook-oss-compliance.asciidoc_retrieve-licenses-list">62.5. Retrieve licenses list</a></li>
<li><a href="#cookbook-oss-compliance.asciidoc_create-an-oss-inventory">62.6. Create an OSS inventory</a></li>
<li><a href="#cookbook-oss-compliance.asciidoc_create-a-third-party-file">62.7. Create a THIRD PARTY file</a></li>
<li><a href="#cookbook-oss-compliance.asciidoc_download-and-package-oss-sourcecode">62.8. Download and package OSS SourceCode</a></li>
<li><a href="#cookbook-oss-compliance.asciidoc_handle-oss-within-ci-process">62.9. Handle OSS within CI-process</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#master-general-end.asciidoc">XIII: Release Notes</a>
<ul class="sectlevel1">
<li><a href="#release-notes-version-3.1.asciidoc">63. devonfw Release notes 3.1 “Goku”</a>
<ul class="sectlevel2">
<li><a href="#release-notes-version-3.1.asciidoc_introduction">63.1. Introduction</a></li>
<li><a href="#release-notes-version-3.1.asciidoc_changes-and-new-features">63.2. Changes and new features</a></li>
</ul>
</li>
<li><a href="#release-notes-version-3.0.asciidoc">64. devonfw Release notes 3.0 “Fry”</a>
<ul class="sectlevel2">
<li><a href="#release-notes-version-3.0.asciidoc_introduction">64.1. Introduction</a></li>
<li><a href="#release-notes-version-3.0.asciidoc_changes-and-new-features">64.2. Changes and new features</a></li>
</ul>
</li>
<li><a href="#release-notes-version-2.4.asciidoc">65. devonfw Release notes 2.4 “EVE”</a>
<ul class="sectlevel2">
<li><a href="#release-notes-version-2.4.asciidoc_introduction">65.1. Introduction</a></li>
<li><a href="#release-notes-version-2.4.asciidoc_changes-and-new-features">65.2. Changes and new features</a></li>
</ul>
</li>
<li><a href="#release-notes-version-2.3.asciidoc">66. devonfw Release notes 2.3 "Dash"</a>
<ul class="sectlevel2">
<li><a href="#release-notes-version-2.3.asciidoc_release-improving--strengthening-the-platform">66.1. Release: improving &amp; strengthening the Platform</a></li>
<li><a href="#release-notes-version-2.3.asciidoc_an-industrialized-platform-for-the-adcenter">66.2. An industrialized platform for the ADcenter</a></li>
<li><a href="#release-notes-version-2.3.asciidoc_changes-and-new-features">66.3. Changes and new features</a></li>
</ul>
</li>
<li><a href="#release-notes-version-2.2.asciidoc">67. devonfw Release notes 2.2 "Courage"</a>
<ul class="sectlevel2">
<li><a href="#release-notes-version-2.2.asciidoc_production-line-integration">67.1. Production Line Integration</a></li>
<li><a href="#release-notes-version-2.2.asciidoc_oasp4js-2.0">67.2. OASP4js 2.0</a></li>
<li><a href="#release-notes-version-2.2.asciidoc_a-new-oasp-portal">67.3. A new OASP Portal</a></li>
<li><a href="#release-notes-version-2.2.asciidoc_new-cobigen">67.4. New Cobigen</a></li>
<li><a href="#release-notes-version-2.2.asciidoc_mythaistar-new-restaurant-example">67.5. MyThaiStar: New Restaurant Example, reference implementation &amp; Methodology showcase</a></li>
<li><a href="#release-notes-version-2.2.asciidoc_the-new-oasp-tutorial">67.6. The new OASP Tutorial</a></li>
<li><a href="#release-notes-version-2.2.asciidoc_oasp4j-2.4.0">67.7. OASP4j 2.4.0</a></li>
<li><a href="#release-notes-version-2.2.asciidoc_microservices-netflix">67.8. Microservices Netflix</a></li>
<li><a href="#release-notes-version-2.2.asciidoc_devonfw-distribution-based-on-eclipse-oomph">67.9. devonfw distribution based on Eclipse OOMPH</a></li>
<li><a href="#release-notes-version-2.2.asciidoc_visual-studio-code--atom">67.10. Visual Studio Code / Atom</a></li>
<li><a href="#release-notes-version-2.2.asciidoc_more-i18n-options">67.11. More I18N options</a></li>
<li><a href="#release-notes-version-2.2.asciidoc_spring-integration-as-devonfw-module">67.12. Spring Integration as devonfw Module</a></li>
<li><a href="#release-notes-version-2.2.asciidoc_devonfw-harvest-contributions">67.13. devonfw Harvest contributions</a></li>
<li><a href="#release-notes-version-2.2.asciidoc_more-deployment-options-to-jee-application-servers-and-dockercloudfoundry">67.14. More Deployment options to JEE Application Servers and Docker/CloudFoundry</a></li>
<li><a href="#release-notes-version-2.2.asciidoc_devcon-on-linux">67.15. Devcon on Linux</a></li>
<li><a href="#release-notes-version-2.2.asciidoc_new-oasp-incubators">67.16. New OASP Incubators</a></li>
</ul>
</li>
<li><a href="#release-notes-version-2.1.asciidoc">68. Release notes devonfw 2.1.1 "Balu"</a>
<ul class="sectlevel2">
<li><a href="#release-notes-version-2.1.asciidoc_version-2.1.2-oasp4j-updates--some-new-features">68.1. Version 2.1.2: OASP4J updates &amp; some new features</a></li>
<li><a href="#release-notes-version-2.1.asciidoc_version-2.1.1-updates">68.2. Version 2.1.1 Updates, fixes &amp; some new features</a></li>
<li><a href="#release-notes-version-2.1.asciidoc_version-2.1-new-features">68.3. Version 2.1 New features, improvements and updates</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<h1 id="master-general-start.asciidoc" class="sect0">I: Getting Started</h1>
<div class="openblock partintro">
<div class="content">
<!-- toc disabled -->
</div>
</div>
<div class="sect1">
<h2 id="getting-started-what-is-devonfw.asciidoc">1. devonfw Introduction</h2>
<div class="sectionbody">
<div class="imageblock text-center">
<div class="content">
<a class="image" href="images/devonfw-small.png"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/devonfw-small.png" alt="devonfw small" width="200"></a>
</div>
</div>
<div class="paragraph">
<p>Welcome to <strong>devonfw</strong>, the devonfw platform. This is a product of the CSD industrialization effort to bring a standardized platform for custom software development within Capgemini APPS2. This platform is aimed at engagements where clients do not force the use of a determined technology so we can offer a better alternative coming from our experience as a group.</p>
</div>
<div class="paragraph">
<p><a href="http://www.devonfw.com">devonfw</a> is a development platform aiming for standardization of processes and productivity boost, that provides an architecture blueprint for Java/JavaScript applications, alongside a set of tools to provide a fully functional <em>out-of-the-box</em> development environment.</p>
</div>
<div class="sect2">
<h3 id="getting-started-what-is-devonfw.asciidoc_building-blocks-of-the-platform">1.1. Building Blocks of the Platform</h3>
<div class="imageblock">
<div class="content">
<a class="image" href="images/introduction/devon_buildingblocks.png"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/introduction/devon_buildingblocks.png" alt="devon buildingblocks" width="650" height="devonfw Building blocks"></a>
</div>
</div>
<div class="paragraph">
<p>devonfw uses a state-of-the-art open source core reference architecture for the server (today considered as commodity in the IT-industry) and on top of it an ever increasing number of high-value assets that are developed by Capgemini.</p>
</div>
</div>
<div class="sect2">
<h3 id="getting-started-what-is-devonfw.asciidoc_devonfw-technology-stack">1.2. devonfw Technology Stack</h3>
<div class="paragraph">
<p>devonfw is fully Open Source and consists of the following technology stacks.</p>
</div>
<div class="sect3">
<h4 id="getting-started-what-is-devonfw.asciidoc_back-end-solutions">1.2.1. Back-end solutions</h4>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/devonfw/devon4j"><em>devon4j</em></a>: server implemented with Java. The devonfw platform provides an implementation for Java based on <a href="https://spring.io/">Spring</a> and <a href="https://projects.spring.io/spring-boot/">Spring Boot</a>.</p>
</li>
<li>
<p><a href="https://github.com/devonfw/devon4net"><em>devon4net</em></a>: server implementation based on <a href="https://dotnet.microsoft.com/">.NET</a>.</p>
</li>
<li>
<p><a href="https://github.com/devonfw/devon4node"><em>devon4node</em></a>: server implementation based on <a href="https://nestjs.com/">NestJS</a>.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="getting-started-what-is-devonfw.asciidoc_front-end-solutions">1.2.2. Front-end solutions</h4>
<div class="paragraph">
<p>For client applications, <em>devonfw</em> includes two possible solutions based on <em>TypeScript, JavaScript, C# and .NET</em>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/devonfw/devon4ng">devon4ng</a>: Frontend implementation based on <a href="https://angular.io/">Angular</a> and hybrid mobile implementation based on <a href="https://ionicframework.com/">Ionic</a>.</p>
</li>
<li>
<p><a href="https://github.com/devonfw/devon4x">devon4X</a>: Mobile implementation based on <a href="https://docs.microsoft.com/xamarin/">Xamarin</a>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Check out the links for more details.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="getting-started-what-is-devonfw.asciidoc_custom-tools">1.3. Custom Tools</h3>
<div class="sect3">
<h4 id="getting-started-what-is-devonfw.asciidoc_pre-installed-software">1.3.1. Pre-installed Software</h4>
<div class="ulist">
<ul>
<li>
<p><em>Eclipse</em>: pre-configured and fully functional IDE to develop Java based apps.</p>
</li>
<li>
<p><em>Visual Studio Code</em>: pre-configured and fully functional IDE to develop applications.</p>
</li>
<li>
<p><em>Java</em>: all the Java environment configured and ready to be used within the distribution.</p>
</li>
<li>
<p><em>Maven</em>: to manage project dependencies.</p>
</li>
<li>
<p><em>Node</em>: a Node js environment configured and ready to be used within the distribution.</p>
</li>
<li>
<p><em>Sonarqube</em>: a code quality tool.</p>
</li>
<li>
<p><em>Tomcat</em>: a web server ready to test the deploy of our artifacts.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="getting-started-what-is-devonfw.asciidoc_devcon">1.3.2. Devcon</h4>
<div class="paragraph">
<p>For project management and other life-cycle related tasks, <em>devonfw</em> provides also <a href="https://github.com/devonfw/devcon">Devcon</a>, a command line and graphic user interface cross platform tool.</p>
</div>
<div class="paragraph">
<p>With <em>Devcon</em>, users can automate the creation of new projects (both server and client), build and run those and even, for server projects, deploy locally on Tomcat.</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/devon/devcon.png"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/devcon/devcon.png" alt="devcon" width="550"></a>
</div>
</div>
<div class="paragraph">
<p>All those tasks can be done manually using <em>Maven</em>, <em>Tomcat</em>, <em>Sencha Cmd</em>, <em>Bower</em>, <em>Gulp</em>, etc. but with <em>Devcon</em> users have the possibility of managing the projects without the necessity of dealing with all those different tools.</p>
</div>
</div>
<div class="sect3">
<h4 id="getting-started-what-is-devonfw.asciidoc_cobigen">1.3.3. Cobigen</h4>
<div class="paragraph">
<p><em>Cobigen</em> is a code generator included in the context of <em>devonfw</em> that allows users to generate all the structure and code of the components, helping to save a lot of time wasted in repetitive tasks.</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/devon/cobigen.png"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/cobigen.png" alt="cobigen" width="550"></a>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="getting-started-what-is-devonfw.asciidoc_devonfw-modules">1.4. devonfw Modules</h3>
<div class="paragraph">
<p>As a part of the goal of productivity boosting, <em>devonfw</em> also provides a set of <em>modules</em> to the developers, created from real projects requirements, that can be connected to projects for saving all the work of a new implementation.</p>
</div>
<div class="paragraph">
<p>The current available modules are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>async</em>: module to manage asynchronous web calls in a <em>Spring</em> based server app.</p>
</li>
<li>
<p><em>i18n</em>: module for internationalization.</p>
</li>
<li>
<p><em>integration</em>: implementation of <a href="https://projects.spring.io/spring-integration/"><em>Spring Integration</em></a>.</p>
</li>
<li>
<p><em>microservices</em>: a set of archetypes to create a complete microservices infrastructure based on <a href="https://cloud.spring.io/spring-cloud-netflix/">_Spring Cloud_Netflix</a>.</p>
</li>
<li>
<p><em>reporting</em>: a module to create reports based on <a href="http://community.jaspersoft.com/project/jasperreports-library"><em>Jasper Reports</em></a> library.</p>
</li>
<li>
<p><em>winauth active directory</em>: a module to authenticate users against an <em>Active Directory</em>.</p>
</li>
<li>
<p><em>winauth single sign on</em>: module that allows applications to authenticate the users by the Windows credentials.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Find more about devonfw <a href="#devonfw Outline"><em>here</em></a>.</p>
</div>
<!-- toc disabled -->
</div>
</div>
</div>
<div class="sect1">
<h2 id="getting-started-why-should-i-use-devonfw.asciidoc">2. Why should I use devonfw?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Devonnfw aims at providing a framework which is oriented at development of web applications based on the Java EE programming model using the Spring framework project as the default implementation.</p>
</div>
<div class="sect2">
<h3 id="getting-started-why-should-i-use-devonfw.asciidoc_objectives">2.1. Objectives</h3>
<div class="sect3">
<h4 id="getting-started-why-should-i-use-devonfw.asciidoc_standardization">2.1.1. Standardization</h4>
<div class="paragraph">
<p>It means that to stop reinventing the Wheel in thousands of projects, hundreds of centers, dozens of countries. This also includes rationalize, harmonize and standardize all development assets all over the group and industrialize the software development process</p>
</div>
</div>
<div class="sect3">
<h4 id="getting-started-why-should-i-use-devonfw.asciidoc_industrialization-of-innovative-technologies--digital">2.1.2. Industrialization of Innovative technologies &amp; “Digital”</h4>
<div class="paragraph">
<p>devonfw needs to standardize &amp; industrialize. But not just large volume, “traditional” custom software development. devonfw needs to offer a standardized platform which contains a range of state of the art methodologies and technology options. devonfw needs to support agile development by small teams utilizing the latest technologies for Mobile, IoT and the Cloud</p>
</div>
</div>
<div class="sect3">
<h4 id="getting-started-why-should-i-use-devonfw.asciidoc_deliver--improve-business-value">2.1.3. Deliver &amp; Improve Business Value</h4>
<div class="imageblock">
<div class="content">
<a class="image" href="images/introduction/devon_quality_agility.png"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/introduction/devon_quality_agility.png" alt="devon quality agility" width="250"></a>
</div>
</div>
</div>
<div class="sect3">
<h4 id="getting-started-why-should-i-use-devonfw.asciidoc_efficiency">2.1.4. Efficiency</h4>
<div class="ulist">
<ul>
<li>
<p>Up to 20% reduction in time to market with faster delivery due to automation and reuse.</p>
</li>
<li>
<p>Up to 25% less implementation efforts due to code generation and reuse.</p>
</li>
<li>
<p>Flat pyramid and rightshore, ready for juniors.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="getting-started-why-should-i-use-devonfw.asciidoc_quality">2.1.5. Quality</h4>
<div class="ulist">
<ul>
<li>
<p>State of the Art architecture and design.</p>
</li>
<li>
<p>Lower cost on maintenance and warranty.</p>
</li>
<li>
<p>Technical debt reduction by reuse.</p>
</li>
<li>
<p>Risk reduction due to assets continuous improvement.</p>
</li>
<li>
<p>Standardized automated quality checks.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="getting-started-why-should-i-use-devonfw.asciidoc_agility">2.1.6. Agility</h4>
<div class="ulist">
<ul>
<li>
<p>Focus on business functionality not on technical.</p>
</li>
<li>
<p>Shorter release cycles.</p>
</li>
<li>
<p>DevOps by design - Infrastructure as Code.</p>
</li>
<li>
<p>Continuous Delivery Pipeline.</p>
</li>
<li>
<p>On and Off-premise flexibility.</p>
</li>
<li>
<p>PoCs and Prototypes in days not months.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="getting-started-why-should-i-use-devonfw.asciidoc_features">2.2. Features</h3>
<div class="sect3">
<h4 id="getting-started-why-should-i-use-devonfw.asciidoc_everything-in-a-single-zip">2.2.1. Everything in a single zip</h4>
<div class="paragraph">
<p>The devonfw distributions is packaged in a <em>zip</em> file that includes all the <a href="http://devonfw.github.io/index.html">Custom Tools</a>, <a href="http://devonfw.github.io/index.html">Software</a> and configurations.</p>
</div>
<div class="paragraph">
<p>Having all the dependencies self-contained in the distribution&#8217;s <em>zip</em> file, users don&#8217;t need to install or configure anything. Just extracting the <em>zip</em> content is enough to have a fully functional <em>devonfw</em>.</p>
</div>
</div>
<div class="sect3">
<h4 id="getting-started-why-should-i-use-devonfw.asciidoc_devonfw">2.2.2. devonfw, the package</h4>
<div class="paragraph">
<p>devonfw package provides:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Implementation blueprints for a modern cloud-ready server and a choice on JS-Client technologies (either open source AngularJs or a very rich and impressive solution based on commercial Sencha UI).</p>
</li>
<li>
<p>Quality documentation and step-by-step quick start guides.</p>
</li>
<li>
<p>Highly integrated and packaged development environment based around Eclipse and Jenkins. You will be ready to start implementing your first customer-specific use case in 2h time.</p>
</li>
<li>
<p>Iterative eclipse-based code-generator that understands "Java" and works on higher architectural concepts than Java-classes.</p>
</li>
<li>
<p>Example application as a reference implementation.</p>
</li>
<li>
<p>Support through large community + industrialization services (Standard Platform as a service) available in the iProd service catalog.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To read in details about devonfw features read <a href="#getting-started-what-is-devonfw.asciidoc_devonfw-modules"><em>here</em></a></p>
</div>
<!-- toc disabled -->
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="getting-started-download-and-setup.asciidoc">3. Download and Setup</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In this section, you will learn how to setup the devonfw environment and start working on first project based on devonfw.</p>
</div>
<div class="paragraph">
<p>The devonfw environment contains all software and tools necessary to develop the applications with devonfw.</p>
</div>
<div class="sect2">
<h3 id="getting-started-download-and-setup.asciidoc_prerequisites">3.1. Prerequisites</h3>
<div class="paragraph">
<p>In order to setup the environment, following are the prerequisites:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Internet connection (including details of your proxy configuration, if necessary)</p>
</li>
<li>
<p>2GB of free disk space</p>
</li>
<li>
<p>The ZIP containing the latest devonfw distribution</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="getting-started-download-and-setup.asciidoc_download">3.2. Download</h3>
<div class="paragraph">
<p>The devonfw distributions can be obtained from the <a href="http://de-mucevolve02/files/devonfw/">FTP releases library</a> and are packaged in a <em>zip</em> file that includes all the needed tools, software and configurations. Browse to the <strong>current</strong> folder in order to get the latest version.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/devconlogo_imgonly.png" alt="devconlogo imgonly" width="50">
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title"><strong>Using devcon</strong></div>
You can do it using devcon with the command <code>devon dist install</code>, learn more  <a href="#devcon-command-reference.asciidoc_dist-install">here</a>.
After a successful installation, you can initialize it with the command <code>devon dist init</code>, learn more <a href="#devcon-command-reference.asciidoc_dist-init">here</a>.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="getting-started-download-and-setup.asciidoc_setup-the-workspace">3.3. Setup the workspace</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Unzip the devonfw distribution into a directory of your choice. <strong>The path to the devonfw distribution directory should contain no spaces</strong>, to prevent problems with some of the tools.</p>
</li>
<li>
<p>Run the batch file "create-or-update-workspace.bat".</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/download-install/devon_guide_environment_setup_1_create_workspace.png"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/download-install/devon_guide_environment_setup_1_create_workspace.png" alt="devon guide environment setup 1 create workspace" width="350" height="devon_guide_environment_setup_1_create_workspace"></a>
</div>
</div>
<div class="paragraph">
<p>This will configure the included tools like Eclipse with the default settings of the devonfw distribution.</p>
</div>
<div class="paragraph">
<p>The result should be as seen below</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/download-install/devon_guide_environment_setup_2_create_workspace.png"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/download-install/devon_guide_environment_setup_2_create_workspace.png" alt="devon guide environment setup 2 create workspace" width="450"></a>
</div>
</div>
<div class="paragraph">
<p><strong>The working devonfw environment is ready!!!</strong></p>
</div>
<div class="paragraph">
<p><strong>Note</strong> : If you use a proxy to connect to the Internet, you have to manually configure it in Maven, Sencha Cmd and Eclipse. Next section explains about it.</p>
</div>
</div>
<div class="sect2">
<h3 id="getting-started-download-and-setup.asciidoc_setup-the-workspace-linux">3.4. Setup the workspace (Linux)</h3>
<div class="ulist">
<ul>
<li>
<p>Unzip the devonfw distribution into a directory of your choice. <strong>The path to the devonfw distribution directory should contain no spaces</strong>, to prevent problems with some of the tools.</p>
</li>
<li>
<p>Run the script: . env.sh</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/download-install/run_env_sh.png"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/download-install/run_env_sh.png" alt="run env sh" width="550" height="run_env_sh"></a>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Run the script: . create-or-update-workspace</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/download-install/create_update_ws.png"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/download-install/create_update_ws.png" alt="create update ws" width="550" height="create_update_ws"></a>
</div>
</div>
<div class="paragraph">
<p>These both . env.sh and . create-or-update-workspace will set all the softwares path that included with devon distribution like eclipse, maven , java etc. Also this will generate some file like eclipse_main used to invoke eclipse</p>
</div>
<div class="ulist">
<ul>
<li>
<p>For vscode setup we have to execute create-or-update-workspace-vs</p>
</li>
<li>
<p>There are a scripts initialize.sh and uninstallUI.sh.</p>
<div class="ulist">
<ul>
<li>
<p>initialize.sh : It installs angular,node, python ant subversion</p>
</li>
<li>
<p>uninstallUI.sh : It is use to uninstalls the above softwares</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="getting-started-download-and-setup.asciidoc_manual-tool-configuration">3.4.1. Manual Tool Configuration</h4>
<div class="sect4">
<h5 id="getting-started-download-and-setup.asciidoc_maven">Maven</h5>
<div class="paragraph">
<p>Open the file "conf/.m2/settings.xml" in an editor</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/download-install/devon_guide_environment_setup_3_proxy_maven.png"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/download-install/devon_guide_environment_setup_3_proxy_maven.png" alt="devon guide environment setup 3 proxy maven" width="450"></a>
</div>
</div>
<div class="paragraph">
<p>Remove the comment tags around the &lt;proxy&gt; section at the beginning of the file.</p>
</div>
<div class="paragraph">
<p>Then update the settings to match your proxy configuration.</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/download-install/devon_guide_environment_setup_4_proxy_maven.png"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/download-install/devon_guide_environment_setup_4_proxy_maven.png" alt="devon guide environment setup 4 proxy maven" width="450"></a>
</div>
</div>
<div class="paragraph">
<p>If your proxy does not require authentication, simply remove the &lt;username&gt; and &lt;password&gt; lines.</p>
</div>
</div>
<div class="sect4">
<h5 id="getting-started-download-and-setup.asciidoc_sencha-cmd">Sencha Cmd</h5>
<div class="paragraph">
<p>Open the file software/Sencha/Cmd/default/sencha.cfg in an editor</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/download-install/devon_guide_environment_setup_5_proxy_sencha.png"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/download-install/devon_guide_environment_setup_5_proxy_sencha.png" alt="devon guide environment setup 5 proxy sencha" width="450"></a>
</div>
</div>
<div class="paragraph">
<p>Search for the property definition of "cmd.jvm.args" (around line 45).</p>
</div>
<div class="paragraph">
<p>Comment the existing property definition and uncomment the line above it.</p>
</div>
<div class="paragraph">
<p>Then update the settings to match your proxy configuration.</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/download-install/devon_guide_environment_setup_6_proxy_sencha.png"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/download-install/devon_guide_environment_setup_6_proxy_sencha.png" alt="devon guide environment setup 6 proxy sencha" width="450"></a>
</div>
</div>
<div class="paragraph">
<p>If your proxy does not require authentication, simply remove the "-Dhttp.proxyUser", "-DhttpProxyPassword", "-Dhttps.proxyUser" and "-Dhttps.proxyPassword" parameters.</p>
</div>
</div>
<div class="sect4">
<h5 id="getting-started-download-and-setup.asciidoc_eclipse">Eclipse</h5>
<div class="paragraph">
<p>Open eclipse by executing "eclipse-main.bat".</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/download-install/devon_guide_environment_setup_7_proxy_eclipse.png"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/download-install/devon_guide_environment_setup_7_proxy_eclipse.png" alt="devon guide environment setup 7 proxy eclipse" width="350"></a>
</div>
</div>
<div class="paragraph">
<p>In the Eclipse preferences dialog, go to "General - Network Connection".</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/download-install/devon_guide_environment_setup_8_proxy_eclipse.png"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/download-install/devon_guide_environment_setup_8_proxy_eclipse.png" alt="devon guide environment setup 8 proxy eclipse" width="450"></a>
</div>
</div>
<div class="paragraph">
<p>Switch from "Native" to "Manual"</p>
</div>
<div class="paragraph">
<p>Enter your proxy configuration</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/download-install/devon_guide_environment_setup_9_proxy_eclipse.png"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/download-install/devon_guide_environment_setup_9_proxy_eclipse.png" alt="devon guide environment setup 9 proxy eclipse" width="450"></a>
</div>
</div>
<div class="paragraph">
<p>Thats All!!!</p>
</div>
<!-- toc disabled -->
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="getting-started-the-devon-ide.asciidoc">4. The Devon IDE</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="getting-started-the-devon-ide.asciidoc_introduction">4.1. Introduction</h3>
<div class="paragraph">
<p>The Devon IDE is the general name for two distinct versions of a customized Eclipse which comes in a Open Source variant, called devon-ide, and a more extended version included in the "Devon Dist" which is only available for Capgemini engagements.</p>
</div>
<div class="sect3">
<h4 id="getting-started-the-devon-ide.asciidoc_features-and-advantages">4.1.1. Features and advantages</h4>
<div class="paragraph">
<p>devonfw comes with a fully featured IDE in order to simplify the installation, configuration and maintenance of this instrumental part of the development environment. As it is being included in the distribution, the IDE is ready to be used and some specific configuration of certain plugins only takes a few  minutes.</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/devon-ide/integrated-ide.png"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/devon-ide/integrated-ide.png" alt="Integrated IDE" width="450"></a>
</div>
</div>
<div class="paragraph">
<p>As with the remainder of the distribution, the advantage of this approach is that you can have as many instances of the -ide "installed" on your machine for different projects with different tools, tool versions and configurations. No physical installation and no tweaking of your operating system required. "Installations" of the Devon distribution do not interfere with each other nor with other installed software.</p>
</div>
</div>
<div class="sect3">
<h4 id="getting-started-the-devon-ide.asciidoc_multiple-workspaces">4.1.2. Multiple Workspaces</h4>
<div class="paragraph">
<p>There is inbuilt support for working with different workspaces on different branches. Create and update new workspaces with a few clicks. You can see the workspace name in the title-bar of your IDE so you do not get confused and work on the right branch.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="getting-started-the-devon-ide.asciidoc_cobigen">4.2. Cobigen</h3>
<div class="paragraph">
<p>In the Devon distribution we have a code generator to create CRUD code, called <strong>Cobigen</strong>. This is a generic incremental generator for end to end code generation tasks, mostly used in Java projects. Due to a template-based approach, CobiGen generates any set of text-based documents and document fragments.</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/devon-ide/cobigen.png"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/devon-ide/cobigen.png" alt="cobigen" width="450"></a>
</div>
</div>
<div class="paragraph">
<p>Cobigen is distributed in the Devon distribution as an Eclipse plugin, and is available to all Devon developers for Capgemini engagements. Due to the importance of this component and the scope of its functionality, it is fully described <a href="#Getting Started Cobigen">here</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="getting-started-the-devon-ide.asciidoc_ide-plugins">4.3. IDE Plugins:</h3>
<div class="paragraph">
<p>Since an application’s code can greatly vary, and every program can be written in lots of ways without being semantically different, IDE comes with pre-installed and pre-configured plugins that use some kind of a probabilistic approach, usually based on pattern matching, to determine which pieces of code should be reviewed. These hints are a real time-saver, helping you to review incoming changes and prevent bugs from propagating into the released artifacts. Apart from Cobigen mentioned in the previous paragraph, the IDE provides CheckStyle, SonarQube, FindBugs and SOAP-UI. Details of each can be found in subsequent sections.</p>
</div>
<div class="sect3">
<h4 id="getting-started-the-devon-ide.asciidoc_checkstyle">4.3.1. CheckStyle</h4>
<div class="sect4">
<h5 id="getting-started-the-devon-ide.asciidoc_what-is-checkstyle">What is CheckStyle</h5>
<div class="paragraph">
<p><a href="http://eclipse-cs.sourceforge.net/">CheckStyle</a> is a Open Source development tool to help you ensure that your Java code adheres to a set of coding standards. Checkstyle does this by inspecting your Java source code and pointing out items that deviate from a defined set of coding rules.</p>
</div>
<div class="paragraph">
<p>With the Checkstyle IDE Plugin, your code is constantly inspected for coding standard deviations. Within the Eclipse workbench, you are immediately notified with the problems via the Eclipse Problems View and source code annotations similar to compiler errors or warnings.
This ensures an extremely short feedback loop right at the developers fingertips.</p>
</div>
</div>
<div class="sect4">
<h5 id="getting-started-the-devon-ide.asciidoc_why-use-checkstyle">Why use CheckStyle</h5>
<div class="paragraph">
<p>If your development team consists of more than one person, then obviously a common ground for coding standards (formatting rules, line lengths etc.) must be agreed upon - even if it is just for practical reasons to avoid superficial, format related merge conflicts.
Checkstyle Plugin helps you define and easily apply those common rules.</p>
</div>
<div class="paragraph">
<p>The plugin uses a project builder to check your project files with Checkstyle. Assuming the IDE Auto-Build feature is enabled, each modification of a project file will immediately get checked by Checkstyle on file save - giving you immediate feedback about the changes you made. To use a simple analogy, the Checkstyle Plug-in works very much like a compiler but instead of producing .class files, it produces warnings where the code violates Checkstyle rules. The discovered deviations are accessible in the Eclipse Problems View, as code editor annotations and via additional Checkstyle violations views.</p>
</div>
</div>
<div class="sect4">
<h5 id="getting-started-the-devon-ide.asciidoc_installation-of-checkstyle">Installation of CheckStyle</h5>
<div class="paragraph">
<p>After IDE installation, IDE provides default checkstyle configuration file which has certain check rules specified .
The set of rules used to check the code is highly configurable. A Checkstyle configuration specifies which check rules are validated against the code and with which severity violations will be reported. Once defined a Checkstyle configuration can be used across multiple projects. The IDE comes with several pre-defined Checkstyle configurations.
You can create custom configurations using the plugin&#8217;s Checkstyle configuration editor or even use an existing Checkstyle configuration file from an external location.</p>
</div>
<div class="paragraph">
<p>You can see violations in your workspace as shown in below figure.</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/devon-ide/checkstyle.png"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/devon-ide/checkstyle.png" alt="checkstyle" width="450"></a>
</div>
</div>
</div>
<div class="sect4">
<h5 id="getting-started-the-devon-ide.asciidoc_usage">Usage</h5>
<div class="paragraph">
<p>So, once projects are created, follow steps mentioned below, to activate checkstyle:</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="1">
<li>
<p>Open the properties of the project you want to get checked.</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/devon-ide/checkstyle2.png"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/devon-ide/checkstyle2.png" alt="checkstyle2" width="450"></a>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="2">
<li>
<p>Select the Checkstyle section within the properties dialog .</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/devon-ide/checkstyle3.png"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/devon-ide/checkstyle3.png" alt="checkstyle3" width="450"></a>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="3">
<li>
<p>Activate Checkstyle for your project by selecting the Checkstyle active for this project check box and press OK</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/devon-ide/checkstyle4.png"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/devon-ide/checkstyle4.png" alt="checkstyle4" width="450"></a>
</div>
</div>
<div class="paragraph">
<p>Now Checkstyle should begin checking your code. This may take a while depending on how many source files your project contains.
The Checkstyle Plug-in uses background jobs to do its work - so while Checkstyle audits your source files you should be able to continue your work.
After Checkstyle has finished checking your code please look into your Eclipse Problems View.
There should be some warnings from Checkstyle. This warnings point to the code locations where your code violates the preconfigured Checks configuration.</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/devon-ide/checkstyle5.png"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/devon-ide/checkstyle5.png" alt="checkstyle5" width="450"></a>
</div>
</div>
<div class="paragraph">
<p>You can navigate to the problems in your code by double-clicking the problem in you problems view.
On the left hand side of the editor an icon is shown for each line that contains a Checkstyle violation. Hovering with your mouse above this icon will show you the problem message.
Also note the editor annotations - they are there to make it even easier to see where the problems are.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="getting-started-the-devon-ide.asciidoc_findbugs">4.3.2. FindBugs</h4>
<div class="sect4">
<h5 id="getting-started-the-devon-ide.asciidoc_what-is-findbugs">What is FindBugs</h5>
<div class="paragraph">
<p><a href="http://findbugs.sourceforge.net/">FindBugs</a>is an open source project for a static analysis of the Java bytecode to identify potential software bugs. Findbugs provides early feedback about potential errors in the code.</p>
</div>
</div>
<div class="sect4">
<h5 id="getting-started-the-devon-ide.asciidoc_why-use-findbugs">Why use FindBugs</h5>
<div class="paragraph">
<p>It scans your code for bugs, breaking down the list of bugs in your code into a ranked list on a 20-point scale. The lower the number, the more hardcore the bug.This helps the developer to access these problems early in the development phase.</p>
</div>
</div>
<div class="sect4">
<h5 id="getting-started-the-devon-ide.asciidoc_installation-and-usage-of-findbugs">Installation and Usage of FindBugs</h5>
<div class="paragraph">
<p>IDE comes preinstalled with FindBugs plugin.</p>
</div>
<div class="paragraph">
<p>You can configure that FindBugs should run automatically for a selected project. For this right-click on a project and select Properties from the popup menu. via the project properties. Select FindBugs → Run automatically  as shown below.</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/devon-ide/FindBugs1.png"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/devon-ide/FindBugs1.png" alt="configure FindBugs" width="450"></a>
</div>
</div>
<div class="paragraph">
<p>To run the error analysis of FindBugs on a project, right-click on it and select the Find Bugs&#8230;&#8203; → Find Bugs menu entry.</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/devon-ide/FindBugs2.png"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/devon-ide/FindBugs2.png" alt="error analysis" width="450"></a>
</div>
</div>
<div class="paragraph">
<p>Plugin provides specialized views to see the reported error messages. Select Window → Show View → Other&#8230;&#8203; to access the views.
The FindBugs error messages are also displayed in the Problems view or as decorators in the Package Explorer view.</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/devon-ide/FindBugs3.png"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/devon-ide/FindBugs3.png" alt="ShowView bug Explorer" width="450"></a>
</div>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/devon-ide/FindBugs4.png"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/devon-ide/FindBugs4.png" alt="bug Explorer" width="450"></a>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="getting-started-the-devon-ide.asciidoc_sonarlint">4.3.3. SonarLint</h4>
<div class="sect4">
<h5 id="getting-started-the-devon-ide.asciidoc_what-is-sonarlint">what is SonarLint</h5>
<div class="paragraph">
<p><a href="http://www.sonarlint.org/">SonarLint</a> is an open platform to manage code quality.
It provides on-the-fly feedback to developers on new bugs and quality issues injected into their code..</p>
</div>
</div>
<div class="sect4">
<h5 id="getting-started-the-devon-ide.asciidoc_why-use-sonarlint">Why use SonarLint</h5>
<div class="paragraph">
<p>It covers seven aspects of code quality like junits, coding rules,comments,complexity,duplications, architecture and design and potential bugs.
SonarLint has got a very efficient way of navigating, a balance between high-level view, dashboard and defect hunting tools. This enables to quickly uncover projects and / or components that are in analysis to establish action plans.</p>
</div>
</div>
<div class="sect4">
<h5 id="getting-started-the-devon-ide.asciidoc_installation-and-usage-of-sonarlint">Installation and usage of SonarLint</h5>
<div class="paragraph">
<p>IDE comes preinstalled with SonarLint.
To configure it , please follow below steps:</p>
</div>
<div class="paragraph">
<p>First of all, you need to start sonar service. For that , go to software folder which is extracted from Devon-dist zip, choose sonarqube&#8594;bin&#8594;&lt;choose appropriate folder according to your OS&gt;-&#8594;and execute startSonar bat file.</p>
</div>
<div class="paragraph">
<p>If your project is not already under analysis, you&#8217;ll need to declare it through the SonarQube web interface as described <a href="http://docs.sonarqube.org/display/SONAR/Project+Existence">here</a>.
Once your project exists in SonarQube, you&#8217;re ready to get started with SonarQube in Eclipse.</p>
</div>
<div class="paragraph">
<p>SonarLint in Eclipse is pre-configured to access a local SonarQube server listening on <a href="http://localhost:9000/" class="bare">http://localhost:9000/</a>.
You can edit this server, delete it or add new ones.By default, user and password is "admin".If sonar service is started properly, test connection will give you successful result.</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/devon-ide/Sonar_add_server.png"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/devon-ide/Sonar_add_server.png" alt="Sonar_add_server" width="450"></a>
</div>
</div>
<div class="paragraph">
<p>For getting a project analysed on sonar, refer this <a href="http://docs.sonarqube.org/display/SONAR/Analyzing+Source+Code" class="bare">http://docs.sonarqube.org/display/SONAR/Analyzing+Source+Code</a> [link].</p>
</div>
<div class="paragraph">
<p>Linking a project to one analysed on sonar server.</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/devon-ide/associate-sonarqube.png"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/devon-ide/associate-sonarqube.png" alt="associate-sonarqube" width="450"></a>
</div>
</div>
<div class="paragraph">
<p>In the SonarQube project text field, start typing the name of the project and select it in the list box:</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/devon-ide/link-with-project.png"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/devon-ide/link-with-project.png" alt="link-with-project" width="450"></a>
</div>
</div>
<div class="paragraph">
<p>Click on Finish. Your project is now associated to one analyzed on your SonarQube server.</p>
</div>
<div class="paragraph">
<p><strong>Changing Binding</strong></p>
</div>
<div class="paragraph">
<p>At any time, it is possible to change the project association.</p>
</div>
<div class="paragraph">
<p>To do so, right-click on the project in the Project Explorer, and then SonarQube &gt; Change Project Association.</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/devon-ide/change-link-with-project.png"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/devon-ide/change-link-with-project.png" alt="change-link-with-project" width="450"></a>
</div>
</div>
<div class="paragraph">
<p><strong>Unbinding a Project</strong></p>
</div>
<div class="paragraph">
<p>To do so, right-click on the project in the Project Explorer, and then SonarQube &gt; Remove SonarQube Nature.</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/devon-ide/unlink-with-project.png"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/devon-ide/unlink-with-project.png" alt="unlink-with-project" width="450"></a>
</div>
</div>
<div class="paragraph">
<p><strong>Advanced Configuration</strong></p>
</div>
<div class="paragraph">
<p>Additional settings (such as markers for new issues) are available through Window &gt; Preferences &gt; SonarLint</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/devon-ide/eclipse-settings.png"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/devon-ide/eclipse-settings.png" alt="eclipse-settings" width="450"></a>
</div>
</div>
<div class="paragraph">
<p>To look for sonarqube analysed issue, go to Window&#8594;Show View&#8594; Others&#8594;SonarLint&#8594;SonarLint Issues.
Now you can see issues in soanrqube issues tab as shown</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/devon-ide/sonarQube-issues-view.png"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/devon-ide/sonarQube-issues-view.png" alt="sonarQube-issues-view" width="450"></a>
</div>
</div>
<div class="paragraph">
<p>Or you can go to link <a href="http://localhost:9000" class="bare">http://localhost:9000</a> and login with admin as id and admin as password and goto Dashboard.you can see all the statistics of analysis of the configured projects on sonar server.</p>
</div>
</div>
</div>
</div>
</div>
</div>
<h1 id="master-general-start.asciidoc" class="sect0">II: Devcon</h1>
<div class="openblock partintro">
<div class="content">
<!-- toc disabled -->
</div>
</div>
<div class="sect1">
<h2 id="devcon-command-developers-guide.asciidoc">5. Devcon Command Developer&#8217;s guide</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="devcon-command-developers-guide.asciidoc_introduction">5.1. Introduction</h3>
<div class="paragraph">
<p><a href="#Devcon User Guide">Devcon</a> is a cross-platform command line and GUI tool written in Java that provides many automated tasks around the full life-cycle of devonfw applications.</p>
</div>
<div class="paragraph">
<p>The structure of Devcon is formed by two main elements: <em>modules</em> and <em>commands</em>.</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/devcon/devcon-structure.png"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/devcon/devcon-structure.png" alt="devcon structure" width="450"></a>
</div>
</div>
<div class="paragraph">
<p>where each module represents an area of Devon and groups commands that are related to some specific task of that area.</p>
</div>
<div class="paragraph">
<p>There is also a third element with a main spot in Devcon, the <em>parameters</em>, we will see them later.</p>
</div>
<div class="paragraph">
<p>After <a href="#Download Devcon">installing Devcon</a> you can see the modules and commands available out of the box opening a command line and using the command <code>devon -g</code> to launch the Devcon&#8217;s graphic user interface.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Using the command line and the command <code>devon -h</code> (even using only the keyword <code>devon</code> or <code>devcon</code>) and <code>devon &lt;module&gt; -h</code> will show the equivalent information.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/devcon/devcon-structure-gui.png"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/devcon/devcon-structure-gui.png" alt="devcon structure gui" width="450"></a>
</div>
</div>
<div class="paragraph">
<p>The available modules appear in the window bar and clicking over each module a drop down menu shows the list of commands grouped under a particular module.</p>
</div>
<div class="paragraph">
<p>As showed above the module <em>devon4j</em> has four commands related to the <em>devon4j</em> projects: <em>create</em>, <em>build</em>, <em>run</em> and <em>deploy</em>. Each command takes care of an specific task within the context of that particular module.</p>
</div>
</div>
<div class="sect2">
<h3 id="devcon-command-developers-guide.asciidoc_creating-your-own-devcon-modules">5.2. Creating your own Devcon modules</h3>
<div class="paragraph">
<p>Devcon has been designed to be easily extended with new custom functionalities. Thanks to its structure based on <em>modules</em> and <em>commands</em> (and <em>parameters</em>) the users can cover new tasks simply including new modules and commands to the tool.</p>
</div>
<div class="paragraph">
<p>We will be able to do that in two ways:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Adding a new Java module in the <em>core</em> of Devcon.</p>
</li>
<li>
<p>Adding an external module written in Javascipt.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Let&#8217;s see the basic elements to have in mind before starting with the addition of new modules.</p>
</div>
<div class="sect3">
<h4 id="devcon-command-developers-guide.asciidoc_elements-and-their-keywords">5.2.1. Elements and their keywords</h4>
<div class="paragraph">
<p>Each main element of Devcon needs to be <em>registered</em> to become accessible, to achieve that we annotate each element with a specific <em>keyword</em> that will tell Devcon, during the launching process, which elements are available as modules and commands.</p>
</div>
<div class="sect4">
<h5 id="devcon-command-developers-guide.asciidoc_module-registry">module registry</h5>
<div class="paragraph">
<p>Internally the modules are registered in Devcon&#8217;s context using the <em>@CmdModuleRegistry</em> annotation and providing some <em>metadata</em> (like <em>name</em>, <em>description</em>, etc.) to define the basic details of the module.</p>
</div>
<div class="paragraph">
<p>In de Javascript approach this annotation will be replaced by a <em>json</em> file.</p>
</div>
</div>
<div class="sect4">
<h5 id="devcon-command-developers-guide.asciidoc_command-registry">command registry</h5>
<div class="paragraph">
<p>In the same way, the commands in Devcon are registered using the <em>@Command</em> annotation, that also allows to add <em>metadata</em> (<em>name</em>, <em>description</em>, etc.) to provide more information.</p>
</div>
</div>
<div class="sect4">
<h5 id="devcon-command-developers-guide.asciidoc_parameter-registry">parameter registry</h5>
<div class="paragraph">
<p>In most cases the commands will need parameters to work with. The <em>@Parameters</em> and <em>@Parameter</em> annotations allow to register those in Devcon. The <em>@Parameter</em> annotation also allows to define the basic info of each parameter (<em>name</em>, <em>description</em>, etc.).</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="devcon-command-developers-guide.asciidoc_creating-a-java-module">5.2.2. Creating a java module</h4>
<div class="paragraph">
<p>If you are not interested in create <em>core</em> modules and want to focus on external Javascript modules skip this section and go direcly to <a href="#devcon-command-developers-guide.asciidoc_javascript-modules">Javascript modules</a> part.</p>
</div>
<div class="paragraph">
<p>So once we have the basic definition of the Devcon&#8217;s elements and we know how to register them, let&#8217;s see how to add a new module in Devcon&#8217;s <em>core</em> using Java.</p>
</div>
<div class="paragraph">
<p>In this example we are going to create a new module called <em>file</em> in order to manage files. As a second stage we are going to add an <em>extract</em> command to extract zip files. To avoid the tricky details we are going to reuse the <em>unzip</em> functionality already implemented in the Devcon&#8217;s utilities.</p>
</div>
<div class="paragraph">
<p>1 - Get the last Devcon release from <a href="https://github.com/devonfw/devcon/releases" class="bare">https://github.com/devonfw/devcon/releases</a></p>
</div>
<div class="paragraph">
<p>2 - Unzip it and <em>Import</em> the Devcon project using Eclipse.</p>
</div>
<div class="paragraph">
<p>3 - In <code>src/main/java/com.devonfw.devcon/modules</code> folder create a new package <em>file</em> for the new module and inside it add a new <em>File</em> class.</p>
</div>
<div class="sect4">
<h5 id="devcon-command-developers-guide.asciidoc_module-annotations">Module annotations</h5>
<div class="paragraph">
<p>To define the class as a Devcon module we must provide:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>@CmdModuleRegistry</strong> annotation with the attributes:</p>
<div class="ulist">
<ul>
<li>
<p><em>name</em>: for the module name.</p>
</li>
<li>
<p><em>description</em>: for the module description that will be shown to the users.</p>
</li>
<li>
<p><em>visible</em>: if not provided its default value is <em>true</em>. Allows to hide modules during develop time.</p>
</li>
<li>
<p><em>sort</em>: to sort modules, if not provided the default value will be <em>-1</em>. If sort &gt;=0, it will be sorted by descending value. Modules which do not have any value for sort attribute or which have value &lt;1 will be omitted from numeric sort and will be sorted alphabetically. This modules will be appended to the modules which are sorted numerically.</p>
</li>
</ul>
</div>
</li>
<li>
<p>extend the <em>AbstractCommandModule</em> to have access to all internal features already implemented for the modules (access to output and input methods, get metadata from the project <em>devon.json</em> file, get the directory from which the command has been launched, get the root of the distribution and so foth).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Finally we will have something like</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@CmdModuleRegistry(name = "file", description = "custom devcon module", sort = -1)
public class File extends AbstractCommandModule {

...
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="devcon-command-developers-guide.asciidoc_command-annotations">Command annotations</h5>
<div class="paragraph">
<p>Now is time to define the command <em>extract</em> of our new module <em>file</em>. In this case we will need to provide:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>@Command</strong> annotation with attributes:</p>
<div class="ulist">
<ul>
<li>
<p><em>name</em>: for the command name.</p>
</li>
<li>
<p><em>description</em>: for the command description that will be shown to the users.</p>
</li>
<li>
<p><em>context</em>: the context in which the command is expected to be launched regarding a project. E.g. think in the <em>devon4j run</em> command. In this case the <em>run</em> command of the <em>devon4j</em> module needs to be launched within the context of an <em>devon4j</em> project. We will define that context using this <em>context</em> attribute. The options are:</p>
<div class="ulist">
<ul>
<li>
<p><em>NONE</em>: if the command doesn&#8217;t need to be launched within a project context.</p>
</li>
<li>
<p><em>PROJECT</em>: if the command is expected to be launched within a project (devon4j, devon4js or Sencha). In theese cases this context definition will automatically provide a default <em>path</em> parameter to the command parameters alongside some extra project info (see the <em>devon4j run</em> implementation.).</p>
</li>
<li>
<p><em>COMBINEDPROJECT</em>: if the command needs to be launched within a combined (server &amp; client) project.</p>
</li>
</ul>
</div>
</li>
<li>
<p><em>proxyParams</em>: in case you need to configure a proxy this attribute will inject automatically a <em>host</em> and <em>port</em> parameters as part of the parameters of your command.</p>
</li>
<li>
<p><em>sort</em>: see the <em>sort</em> attribute in the previous section.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="devcon-command-developers-guide.asciidoc_parameter-annotations">Parameter annotations</h5>
<div class="paragraph">
<p>To define the parameters of our <em>extract</em> method we must use the following annotations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>@Parameters</strong> annotation to group the command parameters</p>
<div class="ulist">
<ul>
<li>
<p><em>value</em>: an array with the parameters</p>
<div class="ulist">
<ul>
<li>
<p><strong>@Parameter</strong> annotation for each parameter expected.</p>
<div class="ulist">
<ul>
<li>
<p><em>name</em>: the name for the parameter.</p>
</li>
<li>
<p><em>description</em>: the description of the parameter to be shown to the users.</p>
</li>
<li>
<p><em>optional</em>: if the parameter is mandatory or not, by default this attribute has as value <em>false</em>, so by default a parameter will be mandatory.</p>
</li>
<li>
<p><em>sort</em>: see the <em>sort</em> attribute in the previous section.</p>
</li>
<li>
<p><em>inputType</em>: the type of field related to the parameter to be shown in the graphic user interface of Devcon.</p>
<div class="ulist">
<ul>
<li>
<p><em>GENERIC</em> for text field parameters.</p>
</li>
<li>
<p><em>PATH</em> if you want to bind the parameter value to a <em>directory window</em>.</p>
</li>
<li>
<p><em>PASSWORD</em> to show a password field.</p>
</li>
<li>
<p><em>LIST</em> to show a dropdown list with predefined options as value for a parameter.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>Let&#8217;s imagine that in our <em>extract</em> example we are going to define two parameters <em>filepath</em> and <em>targetpath</em> (the location of the zip file and the path to the folder to store the extracted files).
As our command will extract a zip file we don&#8217;t need a particular project context so we will use the <em>ContextType.NONE</em>.</p>
</div>
<div class="paragraph">
<p>Finally, importing the package <code>com.devonfw.devcon.common.utils.Extractor</code> we will have access to the <em>unZip</em> functionality. Also, thanks to the <em>AbstractCommandModule</em> class that we have extended we have access to an output object to show info/error messages to the users.</p>
</div>
<div class="paragraph">
<p>So our example will look like</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@CmdModuleRegistry(name = "file", description = "custom devcon module", sort = -1)
public class File extends AbstractCommandModule {

  @Command(name = "extract", description = "This command extracts a zip file.", context = ContextType.NONE)
  @Parameters(values = {
  @Parameter(name = "filepath", description = "path to the file to be extracted", inputType = @InputType(name = InputTypeNames.GENERIC)),
  @Parameter(name = "targetpath", description = "path to the folder to locate the extracted files", inputType = @InputType(name = InputTypeNames.PATH)) })
  public void extract(String filepath, String targetpath){
    getOutput().showMessage("Extracting...");
    try {
      Extractor.unZip(filepath, targetpath);
      getOutput().showMessage("Done!");
    } catch (Exception e) {
      getOutput().showError("Ups something went wrong.");
    }
  }
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="devcon-command-developers-guide.asciidoc_generate-the-jar">Generate the jar</h5>
<div class="paragraph">
<p>Finally, we need to generate a new devcon.jar file containing our new module. To do so, in Eclipse, with right click over the <em>devcon</em> project in the <em>Project Explorer</em> panel:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>Export</em> &gt; <em>Runnable JAR file</em> &gt; <em>Next</em></p>
</li>
<li>
<p>Runnable JAR File Export window:</p>
<div class="ulist">
<ul>
<li>
<p>Launch configuration: Devcon (if you don`t have any option for that paramter try to launch once the Devcon.java class with right click and <em>Run as</em> &gt; <em>Java Application</em> and start again the JAR generation).</p>
</li>
<li>
<p>Export destination: select a location for the jar.</p>
</li>
<li>
<p>Check 'Extract required libraries into generated JAR'.</p>
</li>
<li>
<p>Click <em>Finish</em> and click <em>OK</em> in the next window prompts.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>Once we have the devcon.jar file we have two options depending if we are customizing a Devcon installed locally or the Devcon tool included with the Devon distributions (from version 2.1.1 onwards).</p>
</div>
<div class="ulist">
<ul>
<li>
<p>OPTION1: If you are working over a local installation of Devcon you only need to copy the <em>devcon.jar</em> you just created, to <code>C:\Users\{Your User}\.devcon</code> replacing the devcon.jar that is inside of that directory with your new <em>devcon.jar</em> (be aware that the directory <em>.devcon</em> may be placed in another drive like <em>D</em>).</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If you don&#8217;t have Devcon installed you can see how to install it <a href="#Download Devcon">here</a></p>
</div>
</td>
</tr>
</table>
</div>
<div class="ulist">
<ul>
<li>
<p>OPTION 2: In case you are working over the copy of Devcon enabled by default in Devon distributions you only need to copy the <em>devcon.jar</em> you just created, to <code>Devon-distribution\software\devcon</code> replacing the devcon.jar that is inside of that directory with your new <em>devcon.jar</em></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Once we have installed our customized version of Devcon we can open the Windows command line (for local Devcon installations) or <em>console.bat</em> script (for the Devcon included in Devon distributions) and type <code>devcon -g</code> or <code>devcon -h</code>. The first one will open the Devcon graphic user interface, the second one will show the Devcon basic info in the command line. In both cases we should see our new module as one of the available modules.</p>
</div>
<div class="paragraph">
<p>In case of the <em>gui</em> option we will see</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/devcon/devcon-new-module.png"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/devcon/devcon-new-module.png" alt="devcon new module" width="450"></a>
</div>
</div>
<div class="paragraph">
<p>And selecting the <em>extract</em> command we can see that the parameters we defined appear as mandatory parameters.</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/devcon/devcon-new-module2.png"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/devcon/devcon-new-module2.png" alt="devcon new module2" width="450"></a>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If you want to try the same but using the command line you can use the command <code>devcon file extract -h</code></p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="devcon-command-developers-guide.asciidoc_using-our-module-and-command">Using our module and command</h5>
<div class="paragraph">
<p>Finally we want to use the <em>extract</em> command of our <em>file</em> module to extract a real zip file.</p>
</div>
<div class="paragraph">
<p>We have a <em>myFile.zip</em> in <em>D:</em> and want to extract the files into <em>D:\Temp</em> directory</p>
</div>
<div class="paragraph">
<p><strong>with the gui</strong></p>
</div>
<div class="paragraph">
<p>We will need to provide both mandatory parameters and click <em>Start</em> button</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/devcon/devcon-using-custom-command-gui.png"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/devcon/devcon-using-custom-command-gui.png" alt="devcon using custom command gui" width="450"></a>
</div>
</div>
<div class="paragraph">
<p><strong>with the command line</strong></p>
</div>
<div class="paragraph">
<p>We would obtain the same result using the command line</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-batch hljs" data-lang="batch">C:\&gt;devcon file extract -filepath D:\myFile.zip -targetpath D:\Temp
Hello, this is Devcon!
Copyright (c) 2016 Capgemini
Extracting...
file unzip : D:\Temp\myFile\file1.txt
file unzip : D:\Temp\myFile\file2.txt
file unzip : D:\Temp\myFile\file3.txt
file unzip : D:\Temp\myFile\file4.txt
Done

C:\&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>That&#8217;s all, with theese few steps, we have created and included a new customized module written in Java in the Devcon&#8217;s core.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="devcon-command-developers-guide.asciidoc_javascript-modules">5.2.3. Javascript modules</h4>
<div class="paragraph">
<p>As we mentioned at the beginning of this chapter Devcon allows to be extended with custom modules in an external way by adding modules written in Javascript.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>You will need to have installed Java 8 to be able to run Javascript modules.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>We have seen how to define the Devcon&#8217;s elements (modules, commands and parameters) and how to register them (using keywords) so let&#8217;s see how to add a new module to Devcon using Javascript.</p>
</div>
<div class="sect4">
<h5 id="devcon-command-developers-guide.asciidoc_module-structure">Module structure</h5>
<div class="paragraph">
<p>The Javascript modules must include two main files:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the <strong>commands.json</strong> file that contains the definition of the elements of the module (module metadata, commands and parameters).</p>
</li>
<li>
<p>a Javascript file <strong>&lt;name of the module&gt;.js</strong> with the logic of the module.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="devcon-command-developers-guide.asciidoc_how-to-register-a-module">How to register a module</h5>
<div class="paragraph">
<p>To register a Javascript module we only need to create a directory with that two files and add it to the Devcon&#8217;s module engine. If you have installed Devcon locally you should add that directory in a <em>scripts</em> directory within the <code>C:\Users\{Your User}\.devcon</code> folder but if you are customizing the Devcon included by default in the Devon distributions (for versions 2.1.1 or higher) you should add the directory with the <em>json</em> and the <em>js</em> files in a <em>scripts</em> directory within the <code>Devon-dist\software\devon</code> folder (we will see it later in more detail).</p>
</div>
</div>
<div class="sect4">
<h5 id="devcon-command-developers-guide.asciidoc_module-definition">Module definition</h5>
<div class="paragraph">
<p>The <em>commands.json</em> file located in the Javascript module folder defines the elements included in it, from the module details, as name or description, to the commands and its parameters.</p>
</div>
<div class="paragraph">
<p>If you have followed the <a href="#devcon-command-developers-guide.asciidoc_creating-a-java-module">Creating a Java module</a> section you have seen that for the Java modules we use the <em>@CmdModuleRegistry</em> annotation to register a module. In the case of the Javascript modules this is replaced by the <em>commands.json</em> file itself so we won&#8217;t have an equivalent <em>module registry</em> keyword.</p>
</div>
<div class="paragraph">
<p>To define the module in the <em>commands.json</em> file we can use the following attributes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>name</em>: for the module name.</p>
</li>
<li>
<p><em>description</em>: for the module description that will be shown to the users.</p>
</li>
<li>
<p><em>visible</em>: <em>true</em>/<em>false</em> attribute. Allows to hide modules in case we don&#8217;t want them to be available.</p>
</li>
<li>
<p><em>sort</em>: to sort modules, if sort &gt;=0, it will be sorted by descending value. Modules which have value &lt;1 will be omitted from numeric sort and will be sorted alphabetically. This modules will be appended to the modules which are sorted numerically.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>An example for a <em>commands.json</em> might look like</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
    "name": "myJSmodule",
    "description": "this is an example of a Devcon Javascript module",
    "visible": true,
    "sort": -1,

...

}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="devcon-command-developers-guide.asciidoc_command-definition">Command definition</h5>
<div class="paragraph">
<p>Also in the <em>commands.json</em> file we will define the commands of the module and its parameters.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>We will use a <strong>commands</strong> array to enumerate all the commands of a module. Each command will be defined with the following attributes:</p>
<div class="ulist">
<ul>
<li>
<p><em>name</em>: for the command name.</p>
</li>
<li>
<p><em>path</em>: path to the <em>js</em> file that contains the logic of the module. If this is located in the same folder than the <em>commands.json</em> file we can provide only the name of the file, without the path.</p>
</li>
<li>
<p><em>description</em>: for the command description that will be shown to the users.</p>
</li>
<li>
<p><em>context</em>: the context in which the command is expected to be launched regarding a project. E.g. the <em>run</em> command of the <em>devon4j</em> module needs to be launched within the context of an <em>devon4j</em> project. The options to define the context are:</p>
<div class="ulist">
<ul>
<li>
<p><em>NONE</em>: if the command doesn&#8217;t need to be launched within a project context.</p>
</li>
<li>
<p><em>PROJECT</em>: if the command is expected to be launched within a project (devon4j, devon4js or Sencha). In theese cases this context definition will automatically provide a default <em>path</em> parameter to the command parameters alongside some extra project info (see the <em>devon4j run</em> implementation.).</p>
</li>
<li>
<p><em>COMBINEDPROJECT</em>: if the command needs to be launched within a combined (server &amp; client) project.</p>
</li>
</ul>
</div>
</li>
<li>
<p><em>proxyParams</em>: in case your command needs to configure a proxy, this attribute will inject automatically a <em>host</em> and <em>port</em> parameters as part of the parameters of your command.</p>
</li>
<li>
<p><em>sort</em>: see the <em>sort</em> attribute in the previous section.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
    "name": "myJSmodule",
    "description": "this is an example of a Devcon Javascript module",
    "visible": true,
    "sort": -1,
	"commands": [{
		"name": "myFirstCommand",
		"path": "myFirstCommand.js",
		"description": "this is my first js command",
		"context": "NONE",
		"proxyParams": false,
		...
	}]
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="devcon-command-developers-guide.asciidoc_parameter-definition">Parameter definition</h5>
<div class="paragraph">
<p>As part of the <em>command</em> object in the <em>commands.json</em> file we can define the parameters using the following structure of attributes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>parameters</strong> array to group the command parameters. For each parameter we will define the following attributes:</p>
<div class="ulist">
<ul>
<li>
<p><em>name</em>: the name for the parameter.</p>
</li>
<li>
<p><em>description</em>: the description of the parameter to be shown to the users.</p>
</li>
<li>
<p><em>optional</em>: a <em>true</em>/<em>false</em> attribute to define if the parameter is mandatory or not.</p>
</li>
<li>
<p><em>sort</em>: see the <em>sort</em> attribute in the previous section.</p>
</li>
<li>
<p><em>inputType</em>: by default the parameters will be represented in the Devcon&#8217;s graphic user interface as text boxes but, in case we want the parameter to be a drop down list, a directory picker or a password box, we can specify it using this <em>inputType</em> attribute and defining some sub-attributes</p>
<div class="ulist">
<ul>
<li>
<p><em>drop down list</em>: <code>"inputType": {"name":"list", "values":["optionA", "optionB", "optionC"]}</code></p>
</li>
<li>
<p><em>directory picker</em>: <code>"inputType": {"name":"path", "values":[]}</code></p>
</li>
<li>
<p><em>password box</em>: <code>"inputType": {"name":"password", "values":[]}</code></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>In our example we are going to add two parameters, a first one that will be showed as a text box and the second one that will be a drop down with four options. The result will look like the following</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
    "name": "myJSmodule",
    "description": "this is an example of a Devcon Javascript module",
    "visible": true,
    "sort": -1,
	"commands": [{
		"name": "myFirstCommand",
		"path": "myFirstCommand.js",
		"description": "this is my first js command",
		"context": "NONE",
		"proxyParams": false,
		"parameters": [
			{
			"name": "firstParameter",
			"description": "this is my first parameter",
			"optional": false,
			"sort": -1
			},
			{
			"name": "secondParameter",
                        "description": "this is my second parameter",
                        "optional":true,
                        "sort": -1,
			"inputType" : {"name":"list", "values":["devonfw", "devon4j", "cobigen", "devcon"]}
			}
		]
	}],

...


}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="devcon-command-developers-guide.asciidoc_the-commands">The commands</h5>
<div class="paragraph">
<p>Each command will be defined in a separate Javascript file with a name that match the <code>path</code> attribute defined in the <code>commands.json</code> file of the module. Remember that in case that the js file is in the same directory than the <em>commands.json</em> file we only need to provide the name of the js file.</p>
</div>
<div class="paragraph">
<p>The JavaScript file must have as content either a named or anonymous function which contains the command implementation. The parameters of the funcion contain the parameters in the defined order and the <code>this</code> special property points to the Java <em>CommandModule</em> context.</p>
</div>
<div class="paragraph">
<p>So returning to our example we will have a file called <code>myFirstCommand.js</code> located in the same directory than the <code>commands.json</code>.</p>
</div>
<div class="paragraph">
<p>The content will be</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-javascript hljs" data-lang="javascript">function (firstParameter, secondParameter){

	// Here the content of your module.
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="devcon-command-developers-guide.asciidoc_creating-a-javascript-module">Creating a javascript module</h5>
<div class="paragraph">
<p><strong>Adding the module structure</strong></p>
</div>
<div class="paragraph">
<p>We have already seen the structure of a Devcon&#8217;s Javascript module so let&#8217;s see how to create one with an example that contains all steps.</p>
</div>
<div class="paragraph">
<p>In this case we are going to create (again) a command to extract a zip file, so we are going to create a module called <em>myJSmodule</em> with a command <em>extract</em> that gets two mandatory parameters <em>filepath</em> for the path to the zip file and a <em>targetpath</em> to define the location of the extracted files.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>1. The <code>Devcon Directory</code> is</p>
<div class="ulist">
<ul>
<li>
<p>for local installations of Devcon: <code>C:\Users\{Your User}\.devcon</code> (if you don&#8217;t find the <code>.devcon</code> directory there try looking in <code>D:</code> drive, if the directory is not there neither check your Devcon&#8217;s installation).</p>
</li>
<li>
<p>for the Devcon tool within the Devon distribution (version 2.1.1 or higher): <code>Devon-dist\software\devon</code></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If you want to customize a copy of Devcon in a local context and you still don&#8217;t have Devcon installed you can see how to download and install it <a href="#Download Devcon">here</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="ulist">
<ul>
<li>
<p>2. We will need to create the <em>scripts</em> folder within the <em>Devcon Directory</em>.</p>
</li>
<li>
<p>3. Then we will need to create inside the <em>scripts</em> folder the directory for our new module and inside it we need to add</p>
<div class="ulist">
<ul>
<li>
<p>a <code>commands.json</code> file with the definition of the module</p>
</li>
<li>
<p>and an <code>extract.js</code> file with the code for the <em>extract</em> command.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>So we will end having a structure like <code>{Devcon Directory}\scripts\myModule</code></p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/devcon/devcon-js-structure.png"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/devcon/devcon-js-structure.png" alt="devcon js structure" width="450"></a>
</div>
</div>
</div>
<div class="sect4">
<h5 id="devcon-command-developers-guide.asciidoc_defining-the-module-and-the-command">Defining the module and the command</h5>
<div class="paragraph">
<p>To define and register the module and the command we will use the <em>commands.json</em> file. First we will add the module metadata (name, description) and then the commands, and its parameters, inside the <em>commands</em> array.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
	"name": "myJSmodule",
	"description": "test module",
	"visible": true,
	"sort": -1,
	"commands": [
	    {
	    "name": "extract",
	    "path": "extract.js",
	    "description": "command to extract a file",
	    "context": "NONE",
	    "proxyParams": false,
	    "parameters": [
	         {
		     "name": "filepath",
		     "description": "path to the file to be extracted",
		     "optional": false,
		     "sort": -1
		  },
		  {
		      "name": "targetpath",
                      "description": "path to the folder to locate the extracted files",
                      "optional":false,
                      "sort": -1
		   }
		]
	}
      ]
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="devcon-command-developers-guide.asciidoc_adding-the-command-logic">Adding the command logic</h5>
<div class="paragraph">
<p>As we have previously mentioned we need to add the code of our command in the <em>extract.js</em> file. As we want to extract a file, to avoid a most complicated implementation, we are going to use the <em>unZip</em> method that belongs to the <em>utils</em> package of Devcon. To access to the method we will need to provide the fully qualified name <code>com.devonfw.devcon.common.utils.Extractor.unZip</code>.</p>
</div>
<div class="paragraph">
<p>So in the <em>extract.js</em> file we must add a function that gets the two parameters defined in the <em>commands.json</em> (<em>filepath</em> and <em>targetpath</em>) and uses the Java method <em>unZip</em> to extract the file. Also remember that the special property <em>this</em> will give us access to the Devcon&#8217;s module context so we will be able to use the Devcon&#8217;s output (you can find the entire resources that <code>this</code> can provide <a href="https://github.com/devonfw/devcon/blob/develop/src/main/java/com/devonfw/devcon/common/impl/AbstractCommandModule.java">here</a>)</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-javascript hljs" data-lang="javascript">function(filepath, targetpath){
	this.getOutput().showMessage("extracting...");
	com.devonfw.devcon.common.utils.Extractor.unZip(filepath, targetpath);
	this.getOutput().showMessage("Done!");
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="devcon-command-developers-guide.asciidoc_using-the-new-module-and-the-command">Using the new module and the command</h5>
<div class="paragraph">
<p>We have finished the implementation of the new Javascript module so now we can start using it.</p>
</div>
<div class="paragraph">
<p>We have created a module to extract <em>zip</em> files so we are going to use a <em>myFile.zip</em> located in the <code>D:</code> drive and we are going to extract it to the <code>D:\Temp</code> directory using our new module.</p>
</div>
<div class="paragraph">
<p>As you may know if you have followed the Devcon&#8217;s documentation we can use the tool in two ways: using the command line or using the Devcon&#8217;s graphic user interface (GUI).</p>
</div>
<div class="paragraph">
<p><strong>using the gui</strong></p>
</div>
<div class="paragraph">
<p>To launch Devcon&#8217;s GUI we must open a command line and use the <code>devon -g</code> command. After that the Devon main window should be opened and we should see our new <code>myJSmodule</code> in the list of available modules. Then if we click over the module we should see the <code>extract</code> command available.</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/devcon/devcon-new-js-module.png"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/devcon/devcon-new-js-module.png" alt="devcon new js module" width="450"></a>
</div>
</div>
<div class="paragraph">
<p>Then if we click over the <code>extract</code> command we should see a window with the name and description we provided in the <code>commands.json</code> alongside the parameters that we defined (<em>filepath</em> and <em>targetpath</em>), both mandatory.</p>
</div>
<div class="paragraph">
<p>If we provide the parameters and click on the <em>Start</em> button the command should be launched and the file should be extracted.</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/devcon/devcon-using-custom-js-command-gui.png"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/devcon/devcon-using-custom-js-command-gui.png" alt="devcon using custom js command gui" width="450"></a>
</div>
</div>
<div class="paragraph">
<p>We have extracted the file successfully using our just created Devcon command.</p>
</div>
<div class="paragraph">
<p><strong>using the command line</strong></p>
</div>
<div class="paragraph">
<p>If we use the command line the result will be exactly the same.</p>
</div>
<div class="paragraph">
<p>Open a Windows command line (for local Devcon installations) or <em>command.line</em> script (for the Devcon included in Devon distributions) and launch the <code>devcon</code> command (<code>devon</code> or <code>devcon -h</code> will also work)</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-batch hljs" data-lang="batch">...&gt;devon
Hello, this is Devcon!
Copyright (c) 2016 Capgemini
usage: devon &lt;&lt;module&gt;&gt; &lt;&lt;command&gt;&gt; [parameters...] [-g] [-h] [-p] [-s] [-v]
Devcon is a command line tool that provides many automated tasks around the full
 life-cycle of Devon applications.
 -g,--gui         show devcon GUI
 -h,--help        show help info for each module/command
 -p,--prompt      prompt user for parameters
 -s,--stacktrace  show (if relevant) stack-trace when errors occur
 -v,--version     show devcon version
List of available modules:
&gt; dist: Module with general tasks related to the distribution itself
&gt; doc: Module with tasks related with obtaining specific documentation
&gt; file: custom devcon module
&gt; github: Module to get Github repositories related to devonfw.
&gt; help: This module shows help info about devcon
&gt; myJSmodule: test module
&gt; devon4j: devon4j(server project) related commands
&gt; oasp4js: Module to automate tasks related to oasp4js
&gt; project: Module to automate tasks related to the devon projects (server + client)
&gt; sencha: Commands related with Ext JS6/Devon4Sencha projects
&gt; system: Devcon and system-wide commands
&gt; workspace: Module to create a new workspace with all default configuration</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the list of available modules you should see our <code>myJSmodule</code>.</p>
</div>
<div class="paragraph">
<p>Now if we ask for the <code>myJSmodule</code> information with the command <code>devcon myJSmodule -h</code> we can check that our <code>extract</code> command is available. Also we can see the needed parameters using the <code>devcon myJSmodule extract -h</code> command</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-batch hljs" data-lang="batch">...&gt;devcon myJSmodule extract -h
Hello, this is Devcon!
Copyright (c) 2016 Capgemini
usage: myJSmodule extract [-filepath] [-targetpath]
command to extract a file
 -filepath    path to the file to be extracted
 -targetpath  path to the folder to locate the extracted files</code></pre>
</div>
</div>
<div class="paragraph">
<p>Finally we can use the <em>extract</em> command providing both mandatory parameters</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-batch hljs" data-lang="batch">...&gt;devcon myJSmodule extract -filepath D:\myFile.zip -targetpath D:\Temp
Hello, this is Devcon!
Copyright (c) 2016 Capgemini
extracting...
file unzip : D:\Temp\myFile\file1.txt
file unzip : D:\Temp\myFile\file2.txt
file unzip : D:\Temp\myFile\file3.txt
file unzip : D:\Temp\myFile\file4.txt
Done!</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="devcon-command-developers-guide.asciidoc_conclusion">5.3. Conclusion</h3>
<div class="paragraph">
<p>In this section we have seen how easy can be to extend Devcon with new modules. You can either choose to add a Java module into the core of Devcon or achieve the same in an external way creating your own modules with Javascript (remember that you will need Java 8 to run your Javascript modules).</p>
</div>
<div class="paragraph">
<p>Thanks to the Devcon&#8217;s structure, in both cases the work is reduced to, first, register the modules and then define each of its elements (commands and parameters) and the modules engine of Devcon will do the rest.</p>
</div>
<!-- toc disabled -->
</div>
</div>
</div>
<div class="sect1">
<h2 id="devcon-command-reference.asciidoc">6. Devcon Command Reference</h2>
<div class="sectionbody">
<div class="imageblock text-center">
<div class="content">
<a class="image" href="images/devconlogo_full.png"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/devconlogo_full.png" alt="devconlogo full" width="200"></a>
</div>
</div>
<div class="paragraph">
<p>In the introduction to Devcon we mentioned that Devcon is a tool based on modules that group commands so the different functionalities are stored in these modules that act as utilities containers.
The current version of devcon has been released with the following modules</p>
</div>
<div class="ulist">
<ul>
<li>
<p>dist</p>
</li>
<li>
<p>doc</p>
</li>
<li>
<p>github</p>
</li>
<li>
<p>help</p>
</li>
<li>
<p>devon4j</p>
</li>
<li>
<p>devon4ng</p>
</li>
<li>
<p>project</p>
</li>
<li>
<p>sencha</p>
</li>
<li>
<p>system</p>
</li>
<li>
<p>workspace</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>in your Devcon version more modules may have been included. You can list them using the option <code>devon -h</code></p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="devcon-command-reference.asciidoc_dist">6.1. dist</h3>
<div class="paragraph">
<p>The <em>dist</em> module is responsible for the tasks related with the distribution which means all the functionalities surrounding the configuration of the Devon distribution, including the obtention of the distribution itself.</p>
</div>
<div class="sect3">
<h4 id="devcon-command-reference.asciidoc_dist-install">6.1.1. dist install</h4>
<div class="paragraph">
<p>The <em>install</em> command downloads a distribution from a Team Forge repository and after that extracts the file in a location defined by the user.</p>
</div>
<div class="sect4">
<h5 id="devcon-command-reference.asciidoc_dist-install-requirements">dist install requirements</h5>
<div class="paragraph">
<p>A user with permissions to download files from Team Forge repository.</p>
</div>
</div>
<div class="sect4">
<h5 id="devcon-command-reference.asciidoc__dist-install_-parameters"><em>dist install</em> parameters</h5>
<div class="paragraph">
<p>The <em>install</em> parameter needs four parameters to work properly:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>user</strong>: a Team Forge user with permissions to download files from the repository at least.</p>
</li>
<li>
<p><strong>password</strong>: the Team Forge user password.</p>
</li>
<li>
<p><strong>path</strong>: the path where the distribution must be downloaded.</p>
</li>
<li>
<p><strong>type</strong>: the type of distribution. The options are <em>'oaspide'</em> to download a devon4j based distribution or <em>'devondist'</em> to download a Devon based distribution.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="devcon-command-reference.asciidoc__dist-install_-example-of-usage"><em>dist install</em> example of usage</h5>
<div class="paragraph">
<p>A simple example of usage for this command would be the following</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-batch hljs" data-lang="batch">D:\&gt;devon dist install -user john -password 1234 -path D:\Temp\MyDistribution -type devondist
Hello, this is Devcon!
Copyright (c) 2016 Capgemini
[INFO] installing distribution...
[INFO] Downloading Devon-dist_2.0.0.7z (876,16MB). It may take a few minutes.
[==========] 100% downloaded
[INFO] File downloaded successfully.
[...]
[INFO] extracting file...
[INFO] File successfully extracted.
[INFO] The command INSTALL has finished successfully</code></pre>
</div>
</div>
<div class="paragraph">
<p>You must have in mind that this process can take a while, specially depending on your connection to the internet.</p>
</div>
<div class="paragraph">
<p>After downloading and installing the distribution successfully installed. You can now follow the manual steps as described in the devonfw Guide or, alternatively, run 'devon dist init' to initialize the distribution.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="devcon-command-reference.asciidoc_dist-init">6.1.2. dist init</h4>
<div class="paragraph">
<p>The <em>init</em> command initializes a newly downloaded distribution.</p>
</div>
<div class="sect4">
<h5 id="devcon-command-reference.asciidoc__dist-init_-requirements"><em>dist init</em> requirements</h5>
<div class="paragraph">
<p>A new, not initialized distribution (running it on a configured distribution has no adverse side-effects).</p>
</div>
</div>
<div class="sect4">
<h5 id="devcon-command-reference.asciidoc__dist-init_-parameters"><em>dist init</em> parameters</h5>
<div class="paragraph">
<p>The <em>init</em> parameter needs one parameter to work properly:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>path</strong>: location of the Devon distribution (current dir if not given).</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="devcon-command-reference.asciidoc_dist-s2">6.1.3. dist s2</h4>
<div class="paragraph">
<p>The <em>s2</em> command has been developed to automate the configuration process to use Devon as a Shared Service. This configuration is based on launching two scripts included in the Devon distributions, the <em>s2-init.bat</em> and the <em>s2-create.bat</em>.
The <em>*s2-init.bat*</em> is responsible for configuring the <em>settings.xml</em> file (located in the <em>conf/.m2</em> directory). Basically enables the connection of <em>Maven</em> with the <em>Artifactory</em> repository, where the Devon modules are stored, and adds the user credentials for this connection.</p>
</div>
<div class="paragraph">
<p>The <em>*s2-create.bat*</em> creates a new project in the workspace of the distribution, and optionally does a checkout of a Subversion repository inside this new project. Finally the script creates a Eclipse <em>.bat</em> starter related to the new project.</p>
</div>
<div class="sect4">
<h5 id="devcon-command-reference.asciidoc__dist-s2_-requirements"><em>dist s2</em> requirements</h5>
<div class="ulist">
<ul>
<li>
<p>The command can be launched from any directory within a Devon distribution version 2.0.1 or higher. The Devon distribution is defined by having a <em>settings.json</em> file located in the <em>conf</em> directory. This file is a JSON object that defines parameters like the version of the distribution or the type which should be <em>devon-dist</em> as is showed below.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{"version": "2.0.1","type": "devon-dist"}</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>An <em>Artifactory</em> user with permissions to download files from the repository.</p>
</li>
<li>
<p>In case the optional checkout A Subversion user with permissions to do the checkout of the project specified in the <em>url</em> parameter.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The command will search for this file to get the root directory where the scripts are located so is necessary to have this file in its correct location.</p>
</div>
<div class="paragraph">
<p>Apart from this the <em>settings.xml</em> file needs to be compatible with the Shared Services autoconfiguration script (<em>s2-init.bat</em>).</p>
</div>
</div>
<div class="sect4">
<h5 id="devcon-command-reference.asciidoc__dist-s2_-parameters"><em>dist s2</em> parameters</h5>
<div class="paragraph">
<p>So the <em>s2</em> command needs six parameters to be able to complete the two phases:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>user</strong>: the userId for Artifactory provided by S2 for the project.</p>
</li>
<li>
<p><strong>pass</strong>: the password for Artifactory.</p>
</li>
<li>
<p><strong>engagementname</strong>: the name of the repository for the engagement.</p>
</li>
<li>
<p><strong>ciaas</strong>: if the settings.xml must be configured for CIaaS user must set this as TRUE. Is an optional parameter with FALSE as default value.</p>
</li>
<li>
<p><strong>projectname</strong>: the name for the new project.</p>
</li>
<li>
<p><strong>svnuser</strong>: the user for the SVN.</p>
</li>
<li>
<p><strong>svnpass</strong>: the password for the SVN.</p>
</li>
<li>
<p><strong>svnurl</strong>: the url for the SVN provided by S2.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="devcon-command-reference.asciidoc__dist-s2_-example-of-usage"><em>dist s2</em> example of usage</h5>
<div class="paragraph">
<p>A simple example of usage for this command would be the followings:</p>
</div>
<div class="paragraph">
<p>If we only want to configure the <em>settigs.xml</em> file without using the svn option the simplest usage would be</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-batch hljs" data-lang="batch">D:\devon-dist\workspaces&gt;devon dist s2 -user john -pass ZMF4AgyhQ5X6Sr9Bd1ohjWcFjL -engagementname myEngagement -projectname TestProject
Hello, this is Devcon!
Copyright (c) 2016 Capgemini
[...]
INFO: Completed
Eclipse preferences for workspace: "TestProject" have been created/updated
Created eclipse-TestProject.bat
Finished creating/updating workspace: "TestProject"</code></pre>
</div>
</div>
<div class="paragraph">
<p>After this the <code>conf/.m2/settings.xml</code> file should have been configured and a new (and empty) <em>TestProject</em> directory must have been created in the <em>workspaces</em> directory and in the distribution root a new <em>eclipse-testproject.bat</em> script must have been created too.</p>
</div>
<div class="paragraph">
<p>We also can get the same result and configure the <em>settings.xml</em> for CIaaS using the <em>ciaas</em> parameter</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-batch hljs" data-lang="batch">D:\devon-dist\workspaces&gt;devon dist s2 -user john -pass ZMF4AgyhQ5X6Sr9Bd1ohjWcFjL -engagementname myEngagement -projectname TestProject -ciaas true</code></pre>
</div>
</div>
<div class="paragraph">
<p>Using the svn option to automate the check out from the repository the usage would be</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-batch hljs" data-lang="batch">D:\devon-dist\workspaces&gt;devon dist s2 -user john -pass ZMF4AgyhQ5X6Sr9Bd1ohjWcFjL -engagementname myEngagement -projectname TestProject -svnurl https://coconet...Project/ -svnuser john_svn -svnpass 12345
Hello, this is Devcon!
Copyright (c) 2016 Capgemini
[...]
[INFO] The checkout has been done successfully.
[INFO] Creating and updating workspace...
[...]
INFO: Completed
Eclipse preferences for workspace: "TestProject" have been created/updated
Created eclipse-TestProject.bat
Finished creating/updating workspace: "TestProject"</code></pre>
</div>
</div>
<div class="paragraph">
<p>After this the <code>conf/.m2/settings.xml</code> file should have been configured and a new <em>TestProject</em> directory must have been created in the <em>workspaces</em> directory with all the files checked out from the svn repository and in the distribution root a new <em>eclipse-testproject.bat</em> script must have been created too.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="devcon-command-reference.asciidoc_dist-info">6.1.4. dist info</h4>
<div class="paragraph">
<p>The <em>info</em> command provides very basic information about the Devon distribution, like type, version and path.</p>
</div>
<div class="sect4">
<h5 id="devcon-command-reference.asciidoc__dist-info_-parameters"><em>dist info</em> parameters</h5>
<div class="paragraph">
<p>The <em>dist info</em> command has one optional parameter:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>path</strong>: path to the distro. Uses current directory if not specified.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="devcon-command-reference.asciidoc_doc">6.2. doc</h3>
<div class="paragraph">
<p>With this module we can access in a straightforward way to the documentation to get started with Devon framework. The commands of this module show information related with different components of Devon even opening in the default browser the sites related with them.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>doc devon</code>: Opens the Devon site in the default web browser.</p>
</li>
<li>
<p><code>doc devonguide</code>: Opens the Devon Guide in the default web browser.</p>
</li>
<li>
<p><code>doc getstarted</code>: Opens the 'Getting started' guide of Devon framework.</p>
</li>
<li>
<p><code>doc links</code>: Shows a brief description of Devon framework and lists a set of links related to it like the public site, introduction videos, the Yammer group and so forth.</p>
</li>
<li>
<p><code>doc devon4jguide</code>: Opens the devon4j guide.</p>
</li>
<li>
<p><code>doc sencha</code>: Opens the Sencha Ext JS 6 documentation site.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="devcon-command-reference.asciidoc_github">6.3. github</h3>
<div class="paragraph">
<p>This module is implemented to facilitate getting the Github code from devon4j and Devon repositories. It has only two commands, one to get the OAPS4J code and other to get the Devon code.</p>
</div>
<div class="sect3">
<h4 id="devcon-command-reference.asciidoc_github-devon4j">6.3.1. github devon4j</h4>
<div class="paragraph">
<p>This command clones the devon4j repository to the path that the user specifies in the parameters.</p>
</div>
<div class="sect4">
<h5 id="devcon-command-reference.asciidoc__github-devon4j_-parameters"><em>github devon4j</em> parameters</h5>
<div class="paragraph">
<p>The devon4j command needs only one parameter:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>path</strong>: the location where the repository should be cloned.</p>
</li>
<li>
<p><strong>proxyHost</strong>: Host parameter for optional Proxy configuration.</p>
</li>
<li>
<p><strong>proxyPort</strong>: Port parameter for optional Proxy configuration.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="devcon-command-reference.asciidoc__github-devon4j_-example-of-usage"><em>github devon4j</em> example of usage</h5>
<div class="paragraph">
<p>A simple example of usage for this command would be the following</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-batch hljs" data-lang="batch">D:\Projects\devon4j&gt;devon github devon4j</code></pre>
</div>
</div>
<div class="paragraph">
<p>Or using the <strong>-path</strong> parameter</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-batch hljs" data-lang="batch">D:\&gt;devon github devon4j -path C:\Projects\devon4j</code></pre>
</div>
</div>
<div class="paragraph">
<p>Also we can define, if necessary, a proxy configuration. The following example shows how configure the connection for Capgemini&#8217;s proxy in Europe</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bath hljs" data-lang="bath">D:\Projects\devon4j&gt;devon github devon4j -proxyHost 1.0.5.10 -proxyPort 8080</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="devcon-command-reference.asciidoc_github-devoncode">6.3.2. github devoncode</h4>
<div class="paragraph">
<p>This command clones the Devon repository to the path specified in the path parameter.</p>
</div>
<div class="sect4">
<h5 id="devcon-command-reference.asciidoc__github-devoncode_-requirements"><em>github devoncode</em> requirements</h5>
<div class="paragraph">
<p>A github user with download permissions over the Devon repository.</p>
</div>
</div>
<div class="sect4">
<h5 id="devcon-command-reference.asciidoc__github-devoncode_-parameters"><em>github devoncode</em> parameters</h5>
<div class="paragraph">
<p>The <em>devoncode</em> command needs three parameters:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>path</strong>: the location where the repository must be cloned.</p>
</li>
<li>
<p><strong>username</strong>: the github user (with permission to download).</p>
</li>
<li>
<p><strong>password</strong>: the password of the github user.</p>
</li>
<li>
<p><strong>proxyHost</strong>: Host parameter for optional Proxy configuration.</p>
</li>
<li>
<p><strong>proxyPort</strong>: Port parameter for optional Proxy configuration.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="devcon-command-reference.asciidoc__github-devoncode_-example-of-usage"><em>github devoncode</em> example of usage</h5>
<div class="paragraph">
<p>A simple example of usage for this command would be the followingdevon</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-batch hljs" data-lang="batch">D:\&gt;devon github devoncode -path C:\Projects\devon -user John_g -pass 12345</code></pre>
</div>
</div>
<div class="paragraph">
<p>Also we can define, if necessary, a proxy configuration. The following example shows how configure the connection for Capgemini&#8217;s proxy in Europe</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bath hljs" data-lang="bath">D:\&gt;devon github devoncode -path C:\Projects\devon -user John_g -pass 12345 -proxyHost 1.0.5.10 -proxyPort 8080</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="devcon-command-reference.asciidoc_help">6.4. help</h3>
<div class="paragraph">
<p>The help module is responsible for showing the help info to facilitate the user the knowledge to use the tool. It has only one command, the <em>guide</em> command, that doesn&#8217;t need any parameter and that basically prints a summary of the devcon general usage with a list of the global options and a list with the available modules</p>
</div>
<div class="sect3">
<h4 id="devcon-command-reference.asciidoc__help_-example-of-usage">6.4.1. <em>help</em> example of usage</h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-batch hljs" data-lang="batch">D:\&gt;devon help guide
Hello, this is Devcon!
Copyright (c) 2016 Capgemini
usage: devon &lt;&lt;module&gt;&gt; &lt;&lt;command&gt;&gt; [parameters...]
Devcon is a command line tool that provides many automated tasks around
the full life-cycle of Devon applications.
 -h,--help        show help info for each module/command
 -v,--version     show devcon version
List of available modules:
&gt; help: This module shows help info about devcon
&gt; sencha: Sencha related commands
&gt; dist: Module with general tasks related to the distribution itself
&gt; doc: Module with tasks related with obtaining specific documentation
&gt; github: Module to create a new workspace with all default configuration
&gt; workspace: Module to create a new workspace with all default configuration</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you have follow this guide you can realize that the result is the same that is shown with other options as <code><code>devon</code></code> or <code><code>devon -h</code></code>. This is because these options internally are using this module <em>help</em>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="devcon-command-reference.asciidoc_devon4j">6.5. devon4j</h3>
<div class="paragraph">
<p>This module groups all the devcon functionalities related to the server applications like creating, running and deploying server applications based on the devon4j project.</p>
</div>
<div class="sect3">
<h4 id="devcon-command-reference.asciidoc_devon4j-create">6.5.1. devon4j create</h4>
<div class="paragraph">
<p>This command creates a new server project based on the devon4j archetype.</p>
</div>
<div class="sect4">
<h5 id="devcon-command-reference.asciidoc__devon4j-create_-requirements"><em>devon4j create</em> requirements</h5>
<div class="paragraph">
<p>This command needs to be launched from within (or pointing to) a devonfw distribution.</p>
</div>
<div class="paragraph">
<p>In a second term internally this command uses the <em>Maven</em> plugin included in the devonfw distributions so in order to be able to use this plugin we should launch this command from a devonfw command line (use the <em>console.bat</em> included in the devonfw distributions).</p>
</div>
</div>
<div class="sect4">
<h5 id="devcon-command-reference.asciidoc__devon4j-create_-parameters"><em>devon4j create</em> parameters</h5>
<div class="paragraph">
<p>This command uses five parameters (four of them mandatory).</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>servername</strong>: the name for the new server project.</p>
</li>
<li>
<p><strong>serverpath</strong>: the location for the new server project. Is an optional parameter, if the user does not provide it devcon will use the current directory in its place.</p>
</li>
<li>
<p><strong>packagename</strong>: the name for the project package.</p>
</li>
<li>
<p><strong>groupid</strong>: the groupId for the project.</p>
</li>
<li>
<p><strong>version</strong>: the version for the project.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="devcon-command-reference.asciidoc__devon4j-create_-example-of-usage"><em>devon4j create</em> example of usage</h5>
<div class="paragraph">
<p>A simple example of usage for this command would be the following</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-batch hljs" data-lang="batch">D:\devon-dist&gt;devon devon4j create -servername MyNewProject -packagename io.devon.application.MyNewProject -groupid io.devon.application -version 1.0-SNAPSHOT
Hello, this is Devcon!
Copyright (c) 2016 Capgemini
[INFO] Scanning for projects...
[...]
[INFO] --------------------------------------
[INFO] BUILD SUCCESS
[INFO] --------------------------------------
[INFO] Total time: 7.203 s
[INFO] Finished at: 2016-07-14T13:00:17+01:00
[INFO] Final Memory: 10M/42M
[INFO] --------------------------------------
D:\&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Or using the optional <em>serverpath</em> parameter to define the location for the project</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-batch hljs" data-lang="batch">D:\&gt;devon devon4j create -servername MyNewProject -serverpath D:\devon-dist\ -packagename io.devon.application.MyNewProject -groupid io.devon.application -version 1.0-SNAPSHOT</code></pre>
</div>
</div>
<div class="paragraph">
<p>After that we should have a new <em>MyNewProject</em> project created in the <em>devon-dist</em> directory.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="devcon-command-reference.asciidoc_devon4j-run">6.5.2. devon4j run</h4>
<div class="paragraph">
<p>With this command the user can run a server project application from the embedded tomcat server.</p>
</div>
<div class="sect4">
<h5 id="devcon-command-reference.asciidoc__devon4j-run_-requirements"><em>devon4j run</em> requirements</h5>
<div class="paragraph">
<p>The command can be launched within a Devon distribution version 2.0.1 or higher. Also verify that your <em>devon4j</em> application has the devon.json file well configured.</p>
</div>
</div>
<div class="sect4">
<h5 id="devcon-command-reference.asciidoc__devon4j-run_-parameters"><em>devon4j run</em> parameters</h5>
<div class="paragraph">
<p>The <em>run</em> command handles two parameters</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>path</strong>: to indicate the location of the core project of the server app. Is an optional parameter and if not provided by the user devcon will take as the path the directory from which the command has been launched.</p>
</li>
<li>
<p><strong>port</strong>: the port from which the app should be accessible.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="devcon-command-reference.asciidoc__devon4j-run_-example-of-usage"><em>devon4j run</em> example of usage</h5>
<div class="paragraph">
<p>A simple example of usage for this command would be the following</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-batch hljs" data-lang="batch">D:\devon-dist\workspaces\MyApp\core&gt;devon devon4j run -port 8081
Hello, this is Devcon!
Copyright (c) 2016 Capgemini
Application started

[...]

  .   ____          _            __ _ _
 /\\ / ___'_ __ _ _(_)_ __  __ _ \ \ \ \
( ( )\___ | '_ | '_| | '_ \/ _` | \ \ \ \
 \\/  ___)| |_)| | | | | || (_| |  ) ) ) )
  '  |____| .__|_| |_|_| |_\__, | / / / /
 =========|_|==============|___/=/_/_/_/
 :: Spring Boot ::        (v1.3.3.RELEASE)

2016-07-01 11:13:59.006  INFO 6116 --- [           main] i.d.application.MyAp
p.SpringBootApp   : Starting SpringBootApp on LES002610 with PID 6116 (D:\devon-
alpha\workspaces\MyApp\core\target\classes started by pparrado in D:\devon-al
pha\workspaces\MyApp\core)

[...]

2016-07-01 11:14:18.297  INFO 6116 --- [           main] i.d.application.MyAp
p.SpringBootApp   : Started SpringBootApp in 19.698 seconds (JVM running for 35.
789)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Or providing the optional <em>path</em> parameter</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-batch hljs" data-lang="batch">D:\&gt;devon devon4j run -port 8081 -path D:\devon-dist\workspaces\MyApp\core</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="devcon-command-reference.asciidoc_devon4j-build">6.5.3. devon4j build</h4>
<div class="paragraph">
<p>With this command the user can build a server project, is the equivalent to the <code>mvn clean install</code> command</p>
</div>
<div class="sect4">
<h5 id="devcon-command-reference.asciidoc__devon4j-build_-requirements"><em>devon4j build</em> requirements</h5>
<div class="paragraph">
<p>In order to work properly the command must be launched from within (or pointing to) a devon4j project directory (the devon4j project type is defined in a <em>devon.json</em> file with parameter 'type' set to 'devon4j').</p>
</div>
</div>
<div class="sect4">
<h5 id="devcon-command-reference.asciidoc__devon4j-build_-parameters"><em>devon4j build</em> parameters</h5>
<div class="paragraph">
<p>This command only uses one parameter</p>
</div>
<div class="paragraph">
<p>-<strong>path</strong>: the location of the server project. This is an optional parameter and if the user does not provide it devcon will use in its place the current directory from which the command has been launched.</p>
</div>
</div>
<div class="sect4">
<h5 id="devcon-command-reference.asciidoc__devon4j-build_-example-of-usage"><em>devon4j build</em> example of usage</h5>
<div class="paragraph">
<p>A simple example of usage for this command would be the following</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-batch hljs" data-lang="batch">D:\devon-dist\workspaces\MyApp&gt;devon devon4j build
Hello, this is Devcon!
Copyright (c) 2016 Capgemini
projectInfo read...
path D:\devon-dist\workspaces\MyApp project type devon4j

[...]

[INFO] ------------------------------------------------------------------------
[INFO] Reactor Summary:
[INFO]
[INFO] MyApp .............................................. SUCCESS [  0.301 s]
[INFO] MyApp-core ......................................... SUCCESS [ 12.431 s]
[INFO] MyApp-server ....................................... SUCCESS [  3.699 s]
[INFO] ------------------------------------------------------------------------
[INFO] BUILD SUCCESS
[INFO] ------------------------------------------------------------------------
[INFO] Total time: 16.712 s
[INFO] Finished at: 2016-07-15T11:44:00+01:00
[INFO] Final Memory: 31M/76M
[INFO] ------------------------------------------------------------------------
D:\devon-dist\workspaces\MyApp&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Or using the optional parameter <em>path</em></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-batch hljs" data-lang="batch">D:\&gt;devon devon4j build -path D:\devon-dist\workspaces\MyApp</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="devcon-command-reference.asciidoc_devon4j-migrate">6.5.4. devon4j migrate</h4>
<div class="paragraph">
<p>With this command the user can update server project to the latest version</p>
</div>
<div class="sect4">
<h5 id="devcon-command-reference.asciidoc__devon4j-migrate_-requirements"><em>devon4j migrate</em> requirements</h5>
<div class="paragraph">
<p>The migrate command need only the Project that&#8217;s needs to migrate to latest version of devon4j</p>
</div>
</div>
<div class="sect4">
<h5 id="devcon-command-reference.asciidoc__devon4j-migrate_-parameters"><em>devon4j migrate</em> parameters</h5>
<div class="paragraph">
<p>This command only uses one parameter</p>
</div>
<div class="paragraph">
<p>-<strong>projectPath</strong>: the location of the server project that&#8217;s needs to be updated.</p>
</div>
</div>
<div class="sect4">
<h5 id="devcon-command-reference.asciidoc__devon4j-migrate_-example-of-usage"><em>devon4j migrate</em> example of usage</h5>
<div class="paragraph">
<p>A simple example of usage for this command would be the following</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-batch hljs" data-lang="batch">D:\devon-dist\workspaces\MyApp&gt;devon devon4j migrate D:\Devon-dist_2.4.0\testproj
Hello, this is Devcon!
Copyright (c) 2016 Capgemini
***********************************************************
Migrating from version oasp4j:2.6.0 to oasp4j:2.6.1 ...
***********************************************************
Migrating file: D:\Devon-dist_2.4.0\testproj\pom.xml
***********************************************************
Migrating from version oasp4j:2.6.1 to oasp4j:3.0.0 ...
***********************************************************
Migrating file: D:\Devon-dist_2.4.0\testproj\core\pom.xml
[......
.........]
Migrating file: D:\Devon-dist_2.4.0\testproj\src\main\java\com\company\SpringBootBatchApp.java
Migrating file: D:\Devon-dist_2.4.0\testproj\src\test\java\com\company\general\batch\base\test\SpringBatchIntegrationTest.java
***********************************************************
Successfully applied 3 migrations to migrate project from version oasp4j:2.6.0 to devon4j:3.0.0.
***********************************************************</code></pre>
</div>
</div>
<div class="paragraph">
<p>After successful upgrade of the project, below are the manual steps that are needed to perform</p>
</div>
<div class="paragraph">
<p>Add the following in class WebSecurityBeansConfig</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import org.springframework.security.crypto.factory.PasswordEncoderFactories;
import org.springframework.security.crypto.password.PasswordEncoder;

Add the below method

 @Bean
  public PasswordEncoder passwordEncoder() {

    return PasswordEncoderFactories.createDelegatingPasswordEncoder();
  }</code></pre>
</div>
</div>
<div class="paragraph">
<p>Add the following in class BaseWebSecurityConfig</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import org.springframework.security.crypto.password.PasswordEncoder;

@Inject
private PasswordEncoder passwordEncoder;

In method configureGlobal update below

auth.inMemoryAuthentication().withUser("waiter").password(this.passwordEncoder.encode("waiter")).roles("Waiter")
        .and().withUser("cook").password(this.passwordEncoder.encode("cook")).roles("Cook").and().withUser("barkeeper")
        .password(this.passwordEncoder.encode("barkeeper")).roles("Barkeeper").and().withUser("chief")
        .password(this.passwordEncoder.encode("chief")).roles("Chief");</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="devcon-command-reference.asciidoc_devon4ng">6.6. devon4ng</h3>
<div class="paragraph">
<p>The devon4ng module is responsible for automating the tasks related to the client projects based on Angular.</p>
</div>
<div class="sect3">
<h4 id="devcon-command-reference.asciidoc_devon4ng-create">6.6.1. devon4ng create</h4>
<div class="paragraph">
<p>With this command the user can create a basic devon4ng app.</p>
</div>
<div class="sect4">
<h5 id="devcon-command-reference.asciidoc__devon4ng-create_-requirements"><em>devon4ng create</em> requirements</h5>
<div class="paragraph">
<p>This command must be used within a devonfw distribution with version 2.0.0 or higher. You can check your distribution&#8217;s version looking at the conf/settings.json file.</p>
</div>
</div>
<div class="sect4">
<h5 id="devcon-command-reference.asciidoc__devon4ng-create_-parameters"><em>devon4ng create</em> parameters</h5>
<div class="paragraph">
<p>This command accepts two parameters:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>clientname</strong>: the name for the application.</p>
</li>
<li>
<p><strong>clientpath</strong>: the location for the new application. Is an optional parameter and if not provided by the user devcon will take as the path the directory from which the command has been launched.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="devcon-command-reference.asciidoc__devon4ng-create_-example-of-usage"><em>devon4ng create</em> example of usage</h5>
<div class="paragraph">
<p>A simple example of usage for this command would be the following</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-batch hljs" data-lang="batch">D:\devon-dist\workspaces&gt;devon devon4ng create -clientname MyDevon4ngApp
Hello, this is Devcon!
Copyright (c) 2016 Capgemini
Creating project MyDevon4ngApp...
installing ng
  create .editorconfig
  create README.md
  create src\app\app.component.css
  [...]
  create tslint.json
Installing packages for tooling via npm.
Installed packages for tooling via npm.
Project 'MyDevon4ngApp' successfully created.
Adding devon.json file...
Project build successfully

D:\devon-dist\workspaces&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>If everything goes right a new directory <em>MyDevon4ngApp</em> must have been created containing the basic structure of an <em>devon4ng</em> app.</p>
</div>
<div class="paragraph">
<p>The user can also use the next command <em>devon4ng build</em> to do that last operation.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="devcon-command-reference.asciidoc_devon4ng-build">6.6.2. devon4ng build</h4>
<div class="paragraph">
<p>With this command the user can resolve the dependencies of an <em>devon4ng</em> app. The <em>devon4ng build</em> command is the equivalent to the <code>ng build</code> command.</p>
</div>
<div class="sect4">
<h5 id="devcon-command-reference.asciidoc__devon4ng-build_-parameters"><em>devon4ng build</em> parameters</h5>
<div class="ulist">
<ul>
<li>
<p><strong>path</strong>: The location of the <em>devon4ng</em> app. Is an optional parameter and if not provided devcon will use the current directory from which the command has been launched instead.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="devcon-command-reference.asciidoc__devon4ng-build_-example-of-usage"><em>devon4ng build</em> example of usage</h5>
<div class="paragraph">
<p>A simple example of usage for this command would be the following</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-batch hljs" data-lang="batch">D:\devon-dist\workspaces\MyDevon4ngApp&gt;devon devon4ng build
Hello, this is Devcon!
Copyright (c) 2016 Capgemini
Building project...
Hash: 936deb00dfd88c0d9e56
Hash: 936deb00dfd88c0d9e56
Time: 12735ms
Time: 12735ms
chunk    {0} polyfills.bundle.js, polyfills.bundle.js.map (polyfills) 177 kB {4} [initial] [rendered]
[...]
chunk    {4} inline.bundle.js, inline.bundle.js.map (inline) 0 bytes [entry] [rendered]
Project build successfully</code></pre>
</div>
</div>
<div class="paragraph">
<p>Or using the optional parameter <em>path</em></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-batch hljs" data-lang="batch">D:\devon-dist&gt;devon devon4ng build -path D:\devon-dist\workspaces\MyDevon4ngApp</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="devcon-command-reference.asciidoc_devon4ng-run">6.6.3. devon4ng run</h4>
<div class="paragraph">
<p>In order to launch the <em>devon4ng</em> apps devcon provides this <em>run</em> command that can be launched even without parameters.</p>
</div>
<div class="sect4">
<h5 id="devcon-command-reference.asciidoc__devon4ng-run_-parameters"><em>devon4ng run</em> parameters</h5>
<div class="paragraph">
<p>The only parameter needed is the <em>clientpath</em> that points to the client app. This is an optional parameter and if not provided devcon will use by default the directory from within the command is launched.</p>
</div>
</div>
<div class="sect4">
<h5 id="devcon-command-reference.asciidoc__devon4ng-run_-example-of-usage"><em>devon4ng run</em> example of usage</h5>
<div class="paragraph">
<p>A simple example of usage for this command would be the following</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-batch hljs" data-lang="batch">D:\devon-dist\workspaces\MyDevon4ngApp&gt;devon devon4ng run
Hello, this is Devcon!
Copyright (c) 2016 Capgemini
Project starting
** NG Live Development Server is listening on localhost:4200, open your browser on http://localhost:4200 **
** NG Live Development Server is listening on localhost:4200, open your browser on http://localhost:4200 **
Hash: 7f1a11f3e039fd0028ac
Hash: 7f1a11f3e039fd0028ac
Time: 14333ms
Time: 14333ms
chunk    {0} polyfills.bundle.js, polyfills.bundle.js.map (polyfills) 177 kB {4} [initial]
[...]
chunk    {4} inline.bundle.js, inline.bundle.js.map (inline) 0 bytes [entry] [rendered]
webpack: Compiled successfully.
webpack: Compiled successfully.</code></pre>
</div>
</div>
<div class="paragraph">
<p>Or using the optional parameter <em>clientpath</em></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-batch hljs" data-lang="batch">D:\devon-dist&gt;devon devon4ng run -clientpath D:\devon-dist\workspaces\MyDevon4ngApp</code></pre>
</div>
</div>
<div class="paragraph">
<p>In both cases, after launching the command, the app should be available through a web browser in url <code><a href="http://localhost:4200" class="bare">http://localhost:4200</a></code>.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="devcon-command-reference.asciidoc_project">6.7. project</h3>
<div class="paragraph">
<p>The <em>project</em> module groups the funcionalities related to the combined server + client projects.</p>
</div>
<div class="sect3">
<h4 id="devcon-command-reference.asciidoc_project-create">6.7.1. project create</h4>
<div class="paragraph">
<p>With this command the user can automate the creation of a combined server and client project (Sencha or devon4ng).</p>
</div>
<div class="sect4">
<h5 id="devcon-command-reference.asciidoc__project-create_-requirements"><em>project create</em> requirements</h5>
<div class="paragraph">
<p>If you want to use a Sencha app as client you will need a github user with permissions to download the <em>devon4sencha</em> repository.</p>
</div>
</div>
<div class="sect4">
<h5 id="devcon-command-reference.asciidoc__project-create_-parameters"><em>project create</em> parameters</h5>
<div class="paragraph">
<p>Basically this command needs the same paremeters as the 'subcommands' that is using behind (<code>devon4j create</code>, <code>devon4ng create</code>, <code>sencha workspace</code> and <code>sencha create</code>)</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>combinedprojectpath</strong>: the path to locate the server and client projects. Is an optional parameter and if not provided by the user devcon will take as the path the directory from which the command has been launched.</p>
</li>
<li>
<p><strong>servername</strong>, <strong>packagename</strong>, <strong>groupid</strong>, <strong>version</strong>: the parameters related to the Server application. You can get more details in the 'devon4j create' command reference in this document.</p>
</li>
<li>
<p><strong>clienttype</strong>: the type for the client app, you can provide <em>devon4ng</em> for Angular based client or <em>devon4sencha</em> for Sencha based client.</p>
</li>
<li>
<p><strong>clientname</strong>: the name for the client app.</p>
</li>
<li>
<p><strong>clientpath</strong>: the path to locate the client app. Current directory if not provided.</p>
</li>
<li>
<p><strong>createsenchaws</strong>: is an optional parameter that indicates if the Sencha workspace needs to be created (by default its value is FALSE).</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="devcon-command-reference.asciidoc__project-create_-example-of-usage"><em>project create</em> example of usage</h5>
<div class="paragraph">
<p>A simple example of usage for this command would be the following</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-batch hljs" data-lang="batch">D:\devon-dist\workspaces\combined&gt;devon project create -servername myServerApp -groupid com.capgemini.devonfw -packagename com.capgemini.devonfw.myServerApp -version 1.0 -clientname myClientApp -clienttype devon4ng
Hello, this is Devcon!
Copyright (c) 2016 Capgemini
serverpath is D:\devon-dist\workspaces\combined\.
[INFO] Scanning for projects...
[INFO]
[INFO] ------------------------------------------------------------------------
[INFO] Building Maven Stub Project (No POM) 1
[INFO] ------------------------------------------------------------------------

[...]

[INFO] ------------------------------------------------------------------------
[INFO] BUILD SUCCESS
[INFO] ------------------------------------------------------------------------
[INFO] Total time: 6.862 s
[INFO] Finished at: 2016-08-05T09:23:35+01:00
[INFO] Final Memory: 10M/43M
[INFO] ------------------------------------------------------------------------
Adding devon.json file...
Project Creation completed successfully
Creating client project...
Creating project myClientApp...
Adding devon.json file...
Editing java/pom.xml...
Project created successfully. Please launch 'npm install' to resolve the project dependencies.
Adding devon.json file to combined project...
Combined project created successfully.</code></pre>
</div>
</div>
<div class="paragraph">
<p>With this example we have created a Server + devon4ng app in the <code>D:\devon-dist\workspaces\combined</code> directory. So within this folder we should find:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>myServerApp</em> folder with the <code>devon4j</code> app.</p>
</li>
<li>
<p><em>myClientApp</em> folder with the `devon4ng`app.</p>
</li>
<li>
<p>the <code>devon.json</code> file with the following configuration:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>{"version": "2.0.1",
"type":"COMBINED",
"projects":["myServerApp", "myClientApp"]
}</pre>
</div>
</div>
<div class="paragraph">
<p>As you can see the 'projects' property points to the 'subprojects' created. In case we had used the <em>clientpath</em> parameter to locate it in a different place that 'project' will reflect it pointing to the client path location:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{"version": "2.0.1",
"type":"COMBINED",
"projects":["myServerApp", "D:\\devon-dist\\otherDirectory\\myClientApp"]
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Other possible usages</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>D:\devon-dist\TEST&gt;devon project create -servername sss -groupid com.cap -packagename com.cap.sss -version 1.0 -clientname ccc -clienttype devon4sencha -clientpath D:\devon-dist\TESTB</code></p>
<div class="literalblock">
<div class="content">
<pre>Will create a server app (sss) in current directory and a Sencha app in the TESTB directory (that must be a Sencha workspace)</pre>
</div>
</div>
</li>
<li>
<p><code>D:\devon-dist\TEST&gt;devon project create -servername sss -groupid com.cap -packagename com.cap.sss -version 1.0 -clientname ccc -clienttype devon4sencha -clientpath D:\devon-dist\TESTB -createsenchaws true</code></p>
<div class="literalblock">
<div class="content">
<pre>Will create a server app (sss) in current directory and a Sencha workspace with a Sencha app inside in the TESTB directory.</pre>
</div>
</div>
</li>
<li>
<p><code>D:\devon-dist\TEST&gt;devon project create -servername sss -groupid com.cap -packagename com.cap.sss -version 1.0 -clientname ccc -clienttype devon4sencha</code></p>
<div class="literalblock">
<div class="content">
<pre>Will create a server app (sss) and a Sencha workspace with a Sencha app inside, all in current directory.</pre>
</div>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="devcon-command-reference.asciidoc_project-build">6.7.2. project build</h4>
<div class="paragraph">
<p>This command will build both client and server project.</p>
</div>
<div class="sect4">
<h5 id="devcon-command-reference.asciidoc__project-build_-requirements"><em>project build</em> requirements</h5>
<div class="paragraph">
<p>In order to work properly, the command must be launched from within (or pointing to) a Devon distribution (the devon4j project type is defined in a <em>devon.json</em> file with parameter 'type' set to 'devon4j' in the server project ).
The directory from where build command is fired should contain client and server project at same level, and directory should contain a <em>devon.json</em> which should have project type as <em>COMBINED</em>,and  client  project should contain a <em>devon.json</em> file with parameter 'type' set to  'devon4ng' or 'devon4sencha'.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="devcon-command-reference.asciidoc__project-build_-parameters">6.7.3. <em>project build</em> parameters</h4>
<div class="paragraph">
<p>The build command takes three parameters and two of them are mandatory.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>path</strong> : This is an optional paremaeter. It points to server project workspace and if value of this parameter not given, it takes default value as current directory.</p>
</li>
<li>
<p><strong>clienttype</strong> : This parameter shows which type of client is integrated with server i.e devon4ng or sencha. Its a mandatory one.</p>
</li>
<li>
<p><strong>clientpath</strong> : It should point to client directory i.e where the client code is located. Again a mandatory one.</p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="devcon-command-reference.asciidoc__project-build_-example-of-usage"><em>project build</em> example of usage</h5>
<div class="paragraph">
<p>A simple example of usage for this command would be the following</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-batch hljs" data-lang="batch">D:\&gt;devon project build -path D:\FIN_IDE\devon4j-ide-all-2.0.0\samplec -clienttyp
e devon4ng -clientpath D:\FIN_IDE\devon4j-ide-all-2.0.0\clientdoc
Hello, this is Devcon!
Copyright (c) 2016 Capgemini
projectInfo read...
path D:\FIN_IDE\devon4j-ide-all-2.0.0\samplecproject type devon4j
Completed
path D:\FIN_IDE\devon4j-ide-all-2.0.0\clientdocproject type devon4ng
Completed</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="devcon-command-reference.asciidoc_project-deploy">6.7.4. project deploy</h4>
<div class="paragraph">
<p>This command automates all the process described in the <a href="#Deployment on Tomcat (Client/Server)">deployment on tomcat</a> section. It creates a new tomcat server associated to the combined server + client project in the <em>software</em> directory of the distribution and launches it to make the project available in a browser.</p>
</div>
<div class="sect4">
<h5 id="devcon-command-reference.asciidoc__project-deploy_-requirements"><em>project deploy</em> requirements</h5>
<div class="paragraph">
<p>The command automates the packaging of the combined Server + Client project but the user must configure those apps to work properly so you need to varify that:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The client app <em>points</em> to the server app: in Sencha projects the 'server' property of <em>app/Config.js</em> or app/ConfigDevelopment.js_ (depending of the type of build) must point to your server app. In case of devon4ng projects we will need to configure the <em>baseUrl</em> property of the&#8217;config.json' file to point to our server.</p>
</li>
<li>
<p>The server redirects to the client: in the server project the file <code>&#8230;&#8203;\serverApp\server\src\main\webapp\index.jsp</code> should redirect to <code>jsclient</code> profile
.index.jsp</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>&lt;%
  response.sendRedirect(request.getContextPath() + "/jsclient/");
%&gt;</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>The combined project must have a <code>devon.json</code> file defining the type (that must be 'combined') and the subprojects (server and client):</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>{"version": "2.0.1",
"type":"COMBINED",
"projects": ["D:\devon-dist\workspaces\SenchaWorkspace\myClientApp","myServerApp"]
}</pre>
</div>
</div>
<div class="paragraph">
<p>In the example above that <code>devon.json</code> file defines a server app (<em>myServerApp</em>) that is located within the combined project directory (so we do not need to provide a path, only the folder name) and a client app (<em>myClientApp</em>) located in a Sencha workspace outside the combined project directory (so we need to provide the path).</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Each 'subprojects' (server and client) must have its corresponding <code>devon.json</code> file well formed (the 'type' must be <em>devon4j</em> for server and for client apps <em>devon4ng</em> or <em>devon4sencha</em>).</p>
</li>
<li>
<p>The command must be launched from within a valid devonfw distribution.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="devcon-command-reference.asciidoc__project-deploy_-parameters"><em>project deploy</em> parameters</h5>
<div class="ulist">
<ul>
<li>
<p><strong>tomcatpath</strong>: the path to the tomcat folder. Devcon will look for the distribution&#8217;s Tomcat when this parameter is not provided.</p>
</li>
<li>
<p><strong>clienttype</strong>: type of client either angular or Sencha (obtained from 'projects' property in devon.json when not given).</p>
</li>
<li>
<p><strong>clientpath</strong>: path to client project (obtained from 'projects' property in devon.json when not given).</p>
</li>
<li>
<p><strong>serverpath</strong>: path to server project (obtained from 'projects' property in devon.json when not given).</p>
</li>
<li>
<p><strong>path</strong>: path for the combined project (current directory when not given).</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="devcon-command-reference.asciidoc__project-deploy_-example-of-usage"><em>project deploy</em> example of usage</h5>
<div class="paragraph">
<p>A simple example of usage for this command would be the following</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-batch hljs" data-lang="batch">D:\devon-dist\workspaces\MyCombinedProject&gt;devon project deploy
Hello, this is Devcon!
Copyright (c) 2016 Capgemini
[...]
##########################################################################
After Tomcat finishes the loading process the app should be available in:
localhost:8080/myServerApp-server-1.0
##########################################################################</code></pre>
</div>
</div>
<div class="paragraph">
<p>The process will open a new command window for the Tomcat&#8217;s launching process and finally will shows us the url where the combined app should be accesible.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The url is formed with the name of the .war file generated when packaging the app.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If we use the optional parameter <em>path</em></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-batch hljs" data-lang="batch">D:\devon-dist&gt;devon project deploy -path D:\devon-dist\workspaces\MyCombinedProject</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="devcon-command-reference.asciidoc_project-run">6.7.5. project run</h4>
<div class="paragraph">
<p>This command  runs the server &amp; client project(unified build) in debug mode that is separate client and spring boot server.</p>
</div>
</div>
<div class="sect3">
<h4 id="devcon-command-reference.asciidoc__project-run_-requirements">6.7.6. <em>project run</em> requirements</h4>
<div class="paragraph">
<p>Please verify the <em>devon4j run</em> and <em>devon4ng run</em> or <em>sencha run</em> requirements.</p>
</div>
</div>
<div class="sect3">
<h4 id="devcon-command-reference.asciidoc__project-run_-parameters">6.7.7. <em>project run</em> parameters</h4>
<div class="ulist">
<ul>
<li>
<p><strong>clienttype</strong> : This parameter shows which type of client is integrated with server i.e devon4ng or sencha and its a mandatory parameter</p>
</li>
<li>
<p><strong>clienttype</strong> : the type of the client app ('devon4ng' or 'devon4sencha').</p>
</li>
<li>
<p><strong>clientpath</strong> : Location of the devon4ng app.</p>
</li>
<li>
<p><strong>serverport</strong> : Port to start server.</p>
</li>
<li>
<p><strong>serverpath</strong> : Path to Server project Workspace (currentDir if not given).</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="devcon-command-reference.asciidoc__project-run_-example-of-usage">6.7.8. <em>project run</em> example of usage</h4>
<div class="paragraph">
<p>A simple example of usage for this command ( for client type devon4ng) would be the following</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-batch hljs" data-lang="batch">D:\&gt;devon project run -clienttype devon4ng -clientpath D:\FIN_IDE\devon4j-ide-all-
2.0.0\workspaces\main\examples\devon4ng -serverport 8080 -serverpath D:\FIN_IDE\o
asp4j-ide-all-2.0.0\workspaces\main\code\devon4j\samples\server
Hello, this is Devcon!
Copyright (c) 2016 Capgemini
path before modification D:\FIN_IDE\devon4j-ide-all-2.0.0\workspaces\main\code\oa
sp4j\samples\server
Server project path D:\FIN_IDE\devon4j-ide-all-2.0.0\workspaces\main\code\devon4j\
samples\server
Application started
Starting application</code></pre>
</div>
</div>
<div class="paragraph">
<p>After launching the command, a browser should be opened and will show the welcome page of the devon4ng app.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="devcon-command-reference.asciidoc_sencha">6.8. sencha</h3>
<div class="paragraph">
<p><em>Sencha</em> is a pure JavaScript application framework for building interactive cross platform web applications and is the view layer for web applications developed with Devon Framework. This module encapsulates the <em>Sencha Cmd</em> functionality that is a command line tool to automate tasks around <em>Sencha</em> apps.</p>
</div>
<div class="sect3">
<h4 id="devcon-command-reference.asciidoc_sencha-run">6.8.1. sencha run</h4>
<div class="paragraph">
<p>This command compiles in DEBUG mode and then runs the internal Sencha web server. Is the equivalent to the <em>Sencha Cmd</em>'s <code><code>sencha app watch</code></code> and does not need any parameter.</p>
</div>
<div class="sect4">
<h5 id="devcon-command-reference.asciidoc__sencha-run_-requirements"><em>sencha run</em> requirements</h5>
<div class="paragraph">
<p>We should launch the command from a Devon4Sencha project which is defined by a <em>devon.json</em> file with parameter 'type' set to 'Devon4Sencha'</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{ "version": "2.0.0",
  "type":"Devon4Sencha"}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="devcon-command-reference.asciidoc__sencha-run_-example-of-usage"><em>sencha run</em> example of usage</h5>
<div class="paragraph">
<p>A simple example of usage for this command would be the following</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-batch hljs" data-lang="batch">D:\devon-dist\workspaces\senchaProject&gt;devon sencha run</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="devcon-command-reference.asciidoc_sencha-workspace">6.8.2. sencha workspace</h4>
<div class="paragraph">
<p>With this command we can generate automatically a fully functional Sencha workspace in a directory of our machine.</p>
</div>
<div class="sect4">
<h5 id="devcon-command-reference.asciidoc__sencha-workspace_-requirements"><em>sencha workspace</em> requirements</h5>
<div class="paragraph">
<p>We will need a Github user with permissions to clone the <em>devon4sencha</em> repository.</p>
</div>
</div>
<div class="sect4">
<h5 id="devcon-command-reference.asciidoc__sencha-workspace_-parameters"><em>sencha workspace</em> parameters</h5>
<div class="paragraph">
<p>The <em>sencha workspace</em> command needs five parameters and four of them are mandatory.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>path</strong>: the location where the workspace should be created. This parameter is optional and if the user does not provide it devcon will take the current directory as the location for the Sencha workspace.</p>
</li>
<li>
<p><strong>username</strong>: the github user with permission to download the <em>devon4sencha</em> repository.</p>
</li>
<li>
<p><strong>password</strong>: the password of the github user.</p>
</li>
<li>
<p><strong>proxyHost</strong>: Host parameter for optional Proxy configuration.</p>
</li>
<li>
<p><strong>proxyPort</strong>: Port parameter for optional Proxy configuration.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="devcon-command-reference.asciidoc__sencha-workspace_-example-of-usage"><em>sencha workspace</em> example of usage</h5>
<div class="paragraph">
<p>A simple example of usage for this command would be the following</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-batch hljs" data-lang="batch">D:\&gt;devon sencha workspace -path D:\MyProject -username john -password 1234
Hello, this is Devcon!
Copyright (c) 2016 Capgemini
Cloning into 'D:\MyProject\MySenchaWorkspace'...
Having repository: D:\MyProject\MySenchaWorkspace\.git</code></pre>
</div>
</div>
<div class="paragraph">
<p>So after that we will have a sencha workspace located in the <em>D:\MyProject</em> directory.</p>
</div>
<div class="paragraph">
<p>Also we can define, if necessary, a proxy configuration. The following example shows how to configure the connection for Capgemini&#8217;s proxy in Europe</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-batch hljs" data-lang="batch">D:\&gt;devon sencha workspace -path D:\MyProject -username john -password 1234 -proxyHost 1.0.5.10 -proxyPort 8080</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="devcon-command-reference.asciidoc_sencha-copyworkspace">6.8.3. sencha copyworkspace</h4>
<div class="paragraph">
<p>With this command we can make create new Sencha workspace by making a copy from an existing Devon dist to a particular path</p>
</div>
<div class="sect4">
<h5 id="devcon-command-reference.asciidoc__sencha-copyworkspace_-requirements"><em>sencha copyworkspace</em> requirements</h5>
<div class="paragraph">
<p>There should be a devonfw distribution present which included the 'workspaces\examples\devon4sencha' folder</p>
</div>
</div>
<div class="sect4">
<h5 id="devcon-command-reference.asciidoc__sencha-copyworkspace_-parameters"><em>sencha copyworkspace</em> parameters</h5>
<div class="paragraph">
<p>The <em>sencha copyworkspace</em> command needs two parameters. Both are optional.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>workspace</strong>: the path to the workspace. This parameter is optional. Devcon will take the current directory if not provide and in that case it will use the name 'devon4sencha'.</p>
</li>
<li>
<p><strong>distpath</strong>: the path to a devonfw Dist (Current directory if not provided)</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="devcon-command-reference.asciidoc_sencha-build">6.8.4. sencha build</h4>
<div class="paragraph">
<p>This command builds a Sencha Ext JS6 project. Is the equivalent to the <em>Sencha Cmd</em>'s <code><code>sencha app build</code></code>.</p>
</div>
<div class="sect4">
<h5 id="devcon-command-reference.asciidoc__sencha-build_-parameters"><em>sencha build</em> parameters</h5>
<div class="paragraph">
<p>This command only has one parameter and it is optional</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>appDir</strong>: the path to the app to be built. If the user does not provide it devcon will use the current directory as the location of the Sencha app.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="devcon-command-reference.asciidoc__sencha-build_-example-of-usage"><em>sencha build</em> example of usage</h5>
<div class="paragraph">
<p>A simple example of usage for this command would be the following</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-batch hljs" data-lang="batch">D:\MySenchaWorkspace\MyApp&gt;devon sencha build
Hello, this is Devcon!
Copyright (c) 2016 Capgemini
OUTPUT:Sencha Cmd v6.1.2.15
OUTPUT:[INF] Processing Build Descriptor : classic
[...]
[INFO] [LOG] Sencha App Watch Started
[INFO] [LOG]Sencha Build Successful
D:\MySenchaWorkspace\MyApp&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>And using the optional parameter <em>appDir</em> to locate the app the usage would be like the following</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-batch hljs" data-lang="batch">D:\&gt;devon sencha build -appDir D:\MySenchaWorkspace\MyApp
Hello, this is Devcon!
Copyright (c) 2016 Capgemini
OUTPUT:Sencha Cmd v6.1.2.15
OUTPUT:[INF] Processing Build Descriptor : classic
[...]
[INFO] [LOG] Sencha App Watch Started
[INFO] [LOG]Sencha Build Successful
D:\&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="devcon-command-reference.asciidoc_sencha-create">6.8.5. sencha create</h4>
<div class="paragraph">
<p>This command creates a new Sencha Ext JS6 app.</p>
</div>
<div class="sect4">
<h5 id="devcon-command-reference.asciidoc__sencha-create_-requirements"><em>sencha create</em> requirements</h5>
<div class="paragraph">
<p>The command must be launched within a Sencha workspace or pointing to a Sencha workspace using the optional parameter <em>workspacepath</em>. So in order to work properly first we will need to have a Sencha workspace ready in our local machine.</p>
</div>
</div>
<div class="sect4">
<h5 id="devcon-command-reference.asciidoc__sencha-create_-parameters"><em>sencha create</em> parameters</h5>
<div class="paragraph">
<p>The create parameters handles two parameters</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>appname</strong>: the name for the new app.</p>
</li>
<li>
<p><strong>workspacepath</strong>: optionally the user can specify the location of the Sencha workspace. If the user does not provide it the current directory will be use as default.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="devcon-command-reference.asciidoc__sencha-create_-example-of-usage"><em>sencha create</em> example of usage</h5>
<div class="paragraph">
<p>A simple example of usage for this command would be the following</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-batch hljs" data-lang="batch">D:\MySenchaWorkspace&gt;devon sencha create -appname MyNewApp
Hello, this is Devcon!
Copyright (c) 2016 Capgemini
OUTPUT:Sencha Cmd v6.1.2.15
OUTPUT:[INF] Loading framework from D:\MySenchaWorkspace\
[...]
[INFO] [LOG]Sencha Ext JS6 app Created
D:\MySenchaWorkspace&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>And using the optional parameter <em>workspacepath</em> to locate the Sencha workspace the command would be like the following</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-batch hljs" data-lang="batch">D:\&gt;devon sencha create -appname MyNewApp -workspacepath D:\MySenchaWorkspace
Hello, this is Devcon!
Copyright (c) 2016 Capgemini
OUTPUT:Sencha Cmd v6.1.2.15
OUTPUT:[INF] Loading framework from D:\MySenchaWorkspace\
[...]
[INFO] [LOG]Sencha Ext JS6 app Created
D:\&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>After that we will have a new Sencha app called <em>MyNewApp</em> in our Sencha workspace.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="devcon-command-reference.asciidoc_workspace">6.9. workspace</h3>
<div class="paragraph">
<p>This module handles all tasks related to distribution workspaces.</p>
</div>
<div class="sect3">
<h4 id="devcon-command-reference.asciidoc_workspace-create">6.9.1. workspace create</h4>
<div class="paragraph">
<p>This command automates the creation of new workspaces within the distribution with the default configuration including a new Eclipse <em>.bat</em> starter related to the new project.</p>
</div>
<div class="sect4">
<h5 id="devcon-command-reference.asciidoc_workspace-create-parameters">workspace create parameters</h5>
<div class="paragraph">
<p>The create command needs two parameters:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>devonpath</strong>: the path where the devon distribution is located.</p>
</li>
<li>
<p><strong>foldername</strong>: the name for the new workspace.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="devcon-command-reference.asciidoc__workspace-create_-example-of-usage"><em>workspace create</em> example of usage</h5>
<div class="paragraph">
<p>A simple example of usage for this command would be the following</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-batch hljs" data-lang="batch">D:\&gt;devon workspace create -devonpath C:\MyFolder\devon-dist -foldername newproject
Hello, this is Devcon!
Copyright (c) 2016 Capgemini
[INFO] creating workspace at path D:\devon2-alpha\workspaces\newproject
[...]</code></pre>
</div>
</div>
<div class="paragraph">
<p>As a result of that a new folder <em>newproject</em> with the default project configuration should be created in the <em>C:\MyFolder\devon-dist\workspaces</em> directory alongside an <em>eclipse-newproject.bat</em> starter script in the root of the distribution.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="devcon-command-reference.asciidoc_system">6.10. system</h3>
<div class="paragraph">
<p>This module contains system wide commands related to devcon.</p>
</div>
<div class="sect3">
<h4 id="devcon-command-reference.asciidoc_system-install">6.10.1. system install</h4>
<div class="paragraph">
<p>This command installs devcon on user&#8217;s HOME directory or at an alternative path provided by user.</p>
</div>
<div class="paragraph">
<p>It should be used as a very first step to install Devcon, <a href="#Download Devcon">see more here</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-batch hljs" data-lang="batch">&gt; java -jar devcon.jar system install</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you are behind a proxy you must configure the connection using the optional parameters <strong>-proxyHost</strong> and <strong>-proxyPort</strong>. In following example we show how to use the <em>system install</em> command for Capgemini&#8217;s proxy in Europe</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-batch hljs" data-lang="batch">&gt; java -jar devcon.jar system install -proxyHost 1.0.5.10 -proxyPort 8080</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="devcon-command-reference.asciidoc_system-update">6.10.2. system update</h4>
<div class="paragraph">
<p>Launching this command the user can update the Devcon version installed to the last version available.</p>
</div>
<div class="sect4">
<h5 id="devcon-command-reference.asciidoc__system-update_-example-of-usage"><em>system update</em> example of usage</h5>
<div class="paragraph">
<p>A simple example of usage for this command would be the following</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-batch hljs" data-lang="batch">D:\&gt;devon system update</code></pre>
</div>
</div>
<div class="paragraph">
<p>As occurs with the <em>system install</em> command, if you are behind a proxy you will need to use the optional parameters <strong>-proxyHost</strong> and <strong>-proxyPort</strong> to configure the connection. The following example shows how to configure the <em>system update</em> with the Capgemini&#8217;s proxy in Europe</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-batch hljs" data-lang="batch">D:\&gt;devon system update -proxyHost 1.0.5.10 -proxyPort 8080</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<h1 id="master-devon4j.asciidoc" class="sect0">III: devon4j</h1>
<div class="sect1">
<h2 id="master-devon4j.asciidoc_introduction">7. Introduction</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <a href="http://www.devonfw.com/"><em>devonfw</em></a> provides a solution to building applications which combine best-in-class frameworks and libraries as well as industry proven practices and code conventions.
It massively speeds up development, reduces risks and helps you to deliver better results.</p>
</div>
<div class="paragraph">
<p>This document contains the complete compendium of the <a href="http://www.devonfw.com/devon4j/">devon4j</a>, the Java stack of devonfw. From this link you will also find the latest release or nightly snapshot of this documentation.</p>
</div>
<!-- toc disabled -->
</div>
</div>
<div class="sect1">
<h2 id="architecture.asciidoc">8. Architecture</h2>
<div class="sectionbody">
<div class="paragraph">
<p>There are many different views on what is summarized by the term <em>architecture</em>. First we introduce the <a href="#architecture.asciidoc_key-principles">key principles</a> and <a href="#architecture.asciidoc_architecture-principles">architecture principles</a> of the devonfw. Then we go into details of the the <a href="#architecture.asciidoc_application-architecture">architecture of an application</a>.</p>
</div>
<div class="sect2">
<h3 id="architecture.asciidoc_key-principles">8.1. Key Principles</h3>
<div class="paragraph">
<p>For the devonfw we follow these fundamental key principles for all decisions about architecture, design, or choosing standards, libraries, and frameworks:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>KISS</strong><br>
Keep it small and simple</p>
</li>
<li>
<p><strong>Open</strong><br>
Commitment to open standards and solutions (no required dependencies to commercial or vendor-specific standards or solutions)</p>
</li>
<li>
<p><strong>Patterns</strong><br>
We concentrate on providing patterns, best-practices and examples rather than writing framework code.</p>
</li>
<li>
<p><strong>Solid</strong><br>
We pick solutions that are established and have been proven to be solid and robust in real-live (business) projects.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="architecture.asciidoc_architecture-principles">8.2. Architecture Principles</h3>
<div class="paragraph">
<p>Additionally we define the following principles that our architecture is based on:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Component Oriented Design</strong><br>
We follow a strictly component oriented design to address the following sub-principles:</p>
<div class="ulist">
<ul>
<li>
<p><a href="http://en.wikipedia.org/wiki/Separation_of_concerns">Separation of Concerns</a></p>
</li>
<li>
<p><a href="http://en.wikipedia.org/wiki/Reusability">Reusability</a> and avoiding <a href="http://en.wikipedia.org/wiki/Redundant_code">redundant code</a></p>
</li>
<li>
<p><a href="http://en.wikipedia.org/wiki/Information_hiding">Information Hiding</a> via component API and its exchangeable implementation treated as secret.</p>
</li>
<li>
<p><em>Design by Contract</em> for self-contained, descriptive, and stable component APIs.</p>
</li>
<li>
<p><a href="#architecture.asciidoc_technical-architecture">Layering</a> as well as separation of business logic from technical code for better maintenance.</p>
</li>
<li>
<p><em>Data Sovereignty</em> (and <em>high cohesion with low coupling</em>) says that a component is responsible for its data and changes to this data shall only happen via the component. Otherwise maintenance problems will arise to ensure that data remains consistent. Therefore interfaces of a component that may be used by other components are designed <em>call-by-value</em> and not <em>call-by-reference</em>.</p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>Homogeneity</strong><br>
Solve similar problems in similar ways and establish a uniform <a href="#coding-conventions.asciidoc">code-style</a>.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="architecture.asciidoc_application-architecture">8.3. Application Architecture</h3>
<div class="paragraph">
<p>For the architecture of an application we distinguish the following views:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The <a href="#architecture.asciidoc_business-architecture">Business Architecture</a> describes an application from the business perspective. It divides the application into business components and with full abstraction of technical aspects.</p>
</li>
<li>
<p>The <a href="#architecture.asciidoc_technical-architecture">Technical Architecture</a> describes an application from the technical implementation perspective. It divides the application into technical layers and defines which technical products and frameworks are used to support these layers.</p>
</li>
<li>
<p>The Infrastructure Architecture describes an application from the operational infrastructure perspective. It defines the nodes used to run the application including clustering, load-balancing and networking. This view is not explored further in this guide.</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="architecture.asciidoc_business-architecture">8.3.1. Business Architecture</h4>
<div class="paragraph">
<p>The <em>business architecture</em> divides the application into <em>business components</em>. A business component has a well-defined responsibility that it encapsulates. All aspects related to that responsibility have to be implemented within that business component. Further the business architecture defines the dependencies between the business components. These dependencies need to be free of cycles. A business component exports his functionality via well-defined interfaces as a self-contained API. A business component may use another business component via its API and compliant with the dependencies defined by the business architecture.</p>
</div>
<div class="paragraph">
<p>As the business domain and logic of an application can be totally different, the devonfw can not define a standardized business architecture. Depending on the business domain it has to be defined from scratch or from a domain reference architecture template. For very small systems it may be suitable to define just a single business component containing all the code.</p>
</div>
</div>
<div class="sect3">
<h4 id="architecture.asciidoc_technical-architecture">8.3.2. Technical Architecture</h4>
<div class="paragraph">
<p>The <em>technical architecture</em> divides the application into technical <em>layers</em> based on the <a href="http://en.wikipedia.org/wiki/Multilayered_architecture">multilayered architecture</a>. A layer is a unit of code with the same category such as service or presentation logic. A layer is therefore often supported by a technical framework. Each business component can therefore be split into <em>component parts</em> for each layer. However, a business component may not have component parts for every layer (e.g. only a presentation part that utilized logic from other components).</p>
</div>
<div class="paragraph">
<p>An overview of the technical reference architecture of the devonfw is given by <a href="#architecture.asciidoc_img-t-architecture">figure "Technical Reference Architecture"</a>.
It defines the following layers visualized as horizontal boxes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#guide-client-layer.asciidoc">client layer</a> for the front-end (GUI).</p>
</li>
<li>
<p><a href="#guide-service-layer.asciidoc">service layer</a> for the services used to expose functionality of the
back-end to the client or other consumers.</p>
</li>
<li>
<p><a href="#guide-batch-layer.asciidoc">batch layer</a> for exposing functionality in batch-processes (e.g. mass imports).</p>
</li>
<li>
<p><a href="#guide-logic-layer.asciidoc">logic layer</a> for the business logic.</p>
</li>
<li>
<p><a href="#guide-dataaccess-layer.asciidoc">data-access layer</a> for the data access (esp. persistence).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Also you can see the (business) components as vertical boxes (e.g. <em>A</em> and <em>X</em>) and how they are composed out of component parts each one assigned to one of the technical layers.</p>
</div>
<div class="paragraph">
<p>Further, there are technical components for cross-cutting aspects grouped by the gray box on the left. Here is a complete list:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#guide-security.asciidoc">Security</a></p>
</li>
<li>
<p><a href="#guide-logging.asciidoc">Logging</a></p>
</li>
<li>
<p><a href="#guide-monitoring.asciidoc">Monitoring</a></p>
</li>
<li>
<p><a href="#guide-transactions.asciidoc">Transaction-Handling</a></p>
</li>
<li>
<p><a href="#guide-exceptions.asciidoc">Exception-Handling</a></p>
</li>
<li>
<p><a href="#guide-i18n.asciidoc">Internationalization</a></p>
</li>
<li>
<p><a href="#guide-dependency-injection.asciidoc">Dependency-Injection</a></p>
</li>
</ul>
</div>
<div id="architecture.asciidoc_img-t-architecture" class="imageblock text-center">
<div class="content">
<img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/T-Architecture.png" alt="Technical architecture">
</div>
<div class="title">Figure 1. Technical Reference Architecture</div>
</div>
<div class="paragraph">
<p>We reflect this architecture in our code as described in our <a href="coding-conventions.html#packages">coding conventions</a> allowing a traceability of business components, use-cases, layers, etc. into the code and giving
developers a sound orientation within the project.</p>
</div>
<div class="paragraph">
<p>Further, the architecture diagram shows the allowed dependencies illustrated by the dark green connectors.
Within a business component a component part can call the next component part on the layer directly below via a dependency on its API (vertical connectors).
While this is natural and obvious it is generally forbidden to have dependencies upwards the layers
or to skip a layer by a direct dependency on a component part two or more layers below.
The general dependencies allowed between business components are defined by the <a href="#architecture.asciidoc_business-architecture">business architecture</a>.
In our reference architecture diagram we assume that the business component <code>X</code> is allowed to depend
on component <code>A</code>. Therefore a use-case within the logic component part of <code>X</code> is allowed to call a
use-case from <code>A</code> via a dependency on the component API. The same applies for dialogs on the client layer.
This is illustrated by the horizontal connectors. Please note that <a href="guide-jpa.html#entity">persistence entities</a> are part of the API of the data-access component part so only the logic component part of the same
business component may depend on them.</p>
</div>
<div class="paragraph">
<p>The technical architecture has to address non-functional requirements:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>scalability</strong><br>
is established by keeping state in the client and making the server state-less (except for login session). Via load-balancers new server nodes can be added to improve performance (horizontal scaling).</p>
</li>
<li>
<p><strong>availability</strong> and <strong>reliability</strong><br>
are addressed by clustering with redundant nodes avoiding any single-point-of failure. If one node fails the system is still available. Further the software has to be robust so there are no dead-locks or other bad effects that can make the system unavailable or not reliable.</p>
</li>
<li>
<p><strong>security</strong><br>
is archived in the devonfw by the right templates and best-practices that avoid vulnerabilities. See <a href="#guide-security.asciidoc">security guidelines</a> for further details.</p>
</li>
<li>
<p><strong>performance</strong><br>
is obtained by choosing the right products and proper configurations. While the actual implementation of the application matters for performance a proper design is important as it is the key to allow performance-optimizations (see e.g. <a href="#guide-caching.asciidoc">caching</a>).</p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="architecture.asciidoc_technology-stack">Technology Stack</h5>
<div class="paragraph">
<p>The technology stack of the devonfw is illustrated by the following table.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. Technology Stack of devonfw</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>Topic</strong></th>
<th class="tableblock halign-left valign-top"><strong>Detail</strong></th>
<th class="tableblock halign-left valign-top"><strong>Standard</strong></th>
<th class="tableblock halign-left valign-top"><strong>Suggested implementation</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">runtime</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">language &amp; VM</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Java</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Oracle JDK</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">runtime</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">servlet-container</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">JEE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://tomcat.apache.org/">tomcat</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#guide-dependency-injection.asciidoc">component management</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">dependency injection</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://jcp.org/en/jsr/detail?id=330">JSR330</a> &amp; <a href="https://jcp.org/en/jsr/detail?id=250">JSR250</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://spring.io/">spring</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#guide-configuration.asciidoc">configuration</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">framework</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://projects.spring.io/spring-boot/">spring-boot</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#guide-dataaccess-layer.asciidoc">persistence</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">OR-mapper</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://www.oracle.com/technetwork/java/javaee/tech/persistence-jsp-140049.html">JPA</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://hibernate.org/orm/">hibernate</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#guide-batch-layer.asciidoc">batch</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">framework</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://jcp.org/en/jsr/detail?id=352">JSR352</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://projects.spring.io/spring-batch/">spring-batch</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#guide-service-layer.asciidoc">service</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="guide-service-layer.html#soap">SOAP services</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://jcp.org/en/jsr/detail?id=224">JAX-WS</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://cxf.apache.org/">CXF</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#guide-service-layer.asciidoc">service</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="guide-service-layer.html#rest">REST services</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://jax-rs-spec.java.net/">JAX-RS</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://cxf.apache.org/">CXF</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#guide-logging.asciidoc">logging</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">framework</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://www.slf4j.org/">slf4j</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://logback.qos.ch/">logback</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#guide-validation.asciidoc">validation</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">framework</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://beanvalidation.org/">beanvalidation/JSR303</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://hibernate.org/validator/">hibernate-validator</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#guide-security.asciidoc">security</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Authentication &amp; Authorization</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://www.oracle.com/technetwork/java/javase/jaas/index.html">JAAS</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://projects.spring.io/spring-security/">spring-security</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#guide-monitoring.asciidoc">monitoring</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">framework</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://www.oracle.com/technetwork/java/javase/tech/javamanagement-140525.html">JMX</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://spring.io/">spring</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#guide-monitoring.asciidoc">monitoring</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HTTP Bridge</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HTTP &amp; JSON</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://www.jolokia.org">jolokia</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#guide-aop.asciidoc">AOP</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">framework</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://docs.oracle.com/javase/7/docs/api/java/lang/reflect/Proxy.html">dynamic proxies</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://docs.spring.io/autorepo/docs/spring/3.0.6.RELEASE/spring-framework-reference/html/aop.html">spring AOP</a></p></td>
</tr>
</tbody>
</table>
<!-- toc disabled -->
</div>
</div>
</div>
<div class="sect2">
<h3 id="guide-component.asciidoc">8.4. Components</h3>
<div class="paragraph">
<p>Following <a href="architecture.html#architecture-principles">separation-of-concerns</a> we divide an application into components using our <a href="coding-conventions.html#packages">package-conventions</a> and <a href="coding-conventions.html#architecture-mapping">architecture-mapping</a>.
As described by the <a href="#architecture.asciidoc">architecture</a> each component is divided into these layers:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#guide-client-layer.asciidoc">client-layer</a> with the dialogs to view and modify the component&#8217;s data.</p>
</li>
<li>
<p><a href="#guide-service-layer.asciidoc">service-layer</a> with the services to access the component&#8217;s data remotely.</p>
</li>
<li>
<p><a href="#guide-logic-layer.asciidoc">logic-layer</a> with the <a href="#guide-component-facade.asciidoc">component-facade</a> providing the business-logic to manage the component&#8217;s data.</p>
</li>
<li>
<p><a href="#guide-dataaccess-layer.asciidoc">dataaccess-layer</a> with the <a href="guide-jpa.html#entity">entities</a> defining and the <a href="#guide-repository.asciidoc">repositories</a> (or <a href="#guide-dao.asciidoc">DAOs</a>) accessing the component&#8217;s data.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Please note that only CRUD oriented components will have all four layers within the same component.
Some types of applications may have completely different components for the client.</p>
</div>
<div class="sect3">
<h4 id="guide-component.asciidoc_general-component">8.4.1. General Component</h4>
<div class="paragraph">
<p>Cross-cutting aspects belong to the implicit component <code>general</code>. It contains technical configurations and very general code that is not business specific. Such code shall not have any dependencies to other components and therefore business related code.</p>
</div>
</div>
<div class="sect3">
<h4 id="guide-component.asciidoc_business-component">8.4.2. Business Component</h4>
<div class="paragraph">
<p>The <a href="architecture.html#business-architecture">business-architecture</a> defines the business componets with their allowed dependencies. A small application (microservice) may just have one component and no dependencies making it simple while the same architecture can scale up to large and complex applications (from bigger microservice up to modulith).
Tayloring an business domain into applications and applications into components is a tricky task that needs the skills of an experinced architect.
Also the tayloring should follow the business and not split by technical reasons or only by size.
Size is only an indicator but not a driver of tayloring.
Whatever hypes like microservices are telling you, never get misslead in this regard:
If your system grows and reaches <code>MAX+1</code> lines of code, it is not the right motivation to split it into two microservices of <code>~MAX/2</code> lines of code - such approaches will waste huge amounts of money and lead to chaos.</p>
</div>
</div>
<div class="sect3">
<h4 id="guide-component.asciidoc_app-component">8.4.3. App Component</h4>
<div class="paragraph">
<p>Only in case you need cross-cutting code that aggregates other component you may introduce the component <code>app</code>.
It is allowed to depend on all other components but no other component may depend on it.
With the modularity and flexibility of spring you typically do not need this.
However, when you need to have a class that registers all services or component-facades using direct code dependencies, you can introduce this component.</p>
</div>
</div>
<div class="sect3">
<h4 id="guide-component.asciidoc_component-example">8.4.4. Component Example</h4>
<div class="paragraph">
<p>The following class diagram illustrates an example of the business component <code>Staffmanagement</code>:</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/guide-logic-layer.png" alt="logic layer component pattern">
</div>
</div>
<div class="paragraph">
<p>Here you can see the structure and flow from the <a href="#guide-service-layer.asciidoc">service-layer</a> (REST service call) via the <a href="#guide-logic-layer.asciidoc">logic-layer</a> to the <a href="#guide-dataaccess-layer.asciidoc">dataaccess-layer</a> (and back).</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="master-devon4j.asciidoc_coding">9. Coding</h2>
<div class="sectionbody">
<!-- toc disabled -->
<div class="sect2">
<h3 id="coding-conventions.asciidoc">9.1. Coding Conventions</h3>
<div class="paragraph">
<p>The code should follow general conventions for Java (see <a href="http://www.oracle.com/technetwork/java/namingconventions-139351.html">Oracle Naming Conventions</a>, <a href="https://google.github.io/styleguide/javaguide.html">Google Java Style</a>, etc.).We consider this as common sense and provide configurations for <a href="http://www.sonarqube.org/">SonarQube</a> and related tools such as <a href="http://checkstyle.sourceforge.net/">Checkstyle</a> instead of repeating this here.</p>
</div>
<div class="sect3">
<h4 id="coding-conventions.asciidoc_naming">9.1.1. Naming</h4>
<div class="paragraph">
<p>Besides general Java naming conventions, we follow the additional rules listed here explicitly:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Always use short but speaking names (for types, methods, fields, parameters, variables, constants, etc.).</p>
</li>
<li>
<p>For package segments and type names prefer singular forms (<code>CustomerEntity</code> instead of <code class="line-through">CustomersEntity</code>). Only use plural forms when there is no singular or it is really semantically required (e.g. for a container that contains multiple of such objects).</p>
</li>
<li>
<p>Avoid having duplicate type names. The name of a class, interface, enum or annoation should be unique within your project unless this is intentionally desired in a special and reasonable situation.</p>
</li>
<li>
<p>Avoid artificial naming constructs such as prefixes (<code>I*</code>) or suffixes (<code>*IF</code>) for interfaces.</p>
</li>
<li>
<p>Use CamlCase even for abbreviations (<code>XmlUtil</code> instead of <code class="line-through">XMLUtil</code>)</p>
</li>
<li>
<p>Names of Generics should be easy to understand. Where suitable follow the common rule <code>E=Element</code>, <code>T=Type</code>, <code>K=Key</code>, <code>V=Value</code> but feel free to use longer names for more specific cases such as <code>ID</code>, <code>DTO</code> or <code>ENTITY</code>. The capitalized naming helps to distinguish a generic type from a regular class.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="coding-conventions.asciidoc_packages">9.1.2. Packages</h4>
<div class="paragraph">
<p>Java Packages are the most important element to structure your code. We use a strict packaging convention to map technical layers and business components (slices) to the code (See <a href="architecture.html#technical-architecture">technical architecture</a> for further details). By using the same names in documentation and code we create a strong link that gives orientation and makes it easy to find from business requirements, specifications or story tickets into the code and back. Further we can use tools such as <a href="http://www.sonarqube.org/">SonarQube</a> and <a href="http://www.hello2morrow.com/products/sonargraph">SonarGraph</a> to verify architectural rules.</p>
</div>
<div class="paragraph">
<p>For an devonfw based application we use the following Java-Package schema:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>«rootpackage».«application».«component».«layer».«scope»[.«detail»]*</code></pre>
</div>
</div>
<div class="paragraph">
<p>E.g. in our example application we find the Spring Data repositories for the <code>ordermanagement</code> component in the package <code>com.devonfw.application.mtsj.ordermanagement.dataaccess.api.repo</code></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 2. Segments of package schema</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>Segment</strong></th>
<th class="tableblock halign-left valign-top"><strong>Description</strong></th>
<th class="tableblock halign-left valign-top"><strong>Example</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">«rootpackage»</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Is the basic Java Package name-space of the organization or IT project owning the code following common Java Package conventions. Consists of multiple segments corresponding to the Internet domain of the organization.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>com.devonfw.application.mtsj</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">«application»</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The name of the application build in this project.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>devonfw</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">«component»</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The (business) component the code belongs to. It is defined by the business architecture and uses terms from the business domain. Use the implicit component <code>general</code> for code not belonging to a specific component (foundation code).</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>salesmanagement</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">«layer»</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The name of the technical layer (See <a href="#architecture.asciidoc">technical architecture</a>) which is one of the predefined layers (<code>dataaccess</code>, <code>logic</code>, <code>service</code>, <code>batch</code>, <code>gui</code>, <code>client</code>) or <code>common</code> for code not assigned to a technical layer (datatypes, cross-cutting concerns).</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>dataaccess</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">«scope»</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The scope which is one of <code>api</code> (official API to be used by other layers or components),<code>base</code> (basic code to be reused by other implementations) and <code>impl</code> (implementation that should never be imported from outside)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>api</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">«detail»</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Here you are free to further divide your code into sub-components and other concerns according to the size of your component part.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>dao</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Please note that for library modules where we use <code>com.devonfw.module</code> as <code>«basepackage»</code> and the name of the module as <code>«component»</code>. E.g. the API of our <code>beanmapping</code> module can be found in the package <code>com.devonfw.module.beanmapping.common.api</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="coding-conventions.asciidoc_architecture-mapping">9.1.3. Architecture Mapping</h4>
<div class="paragraph">
<p>We combine the above naming and packaging conventions to map the entire architecture to the code.
This also allows tools such as <a href="https://github.com/devonfw/tools-cobigen">CobiGen</a> or <a href="https://github.com/devonfw/sonar-devon-plugin/">sonar-devon-plugin</a> to "understand" the code.
Also this helps developers going from one devon4j project to the next to quickly understand the code-base.
If every developer knows where to find what, the project gets more efficient.
A long time ago maven standardized the project structure with <code>src/main/java</code>, etc. and turned chaos into structure.
With devonfw we experienced the same for the codebase (what is inside <code>src/main/java</code>).</p>
</div>
<div class="listingblock">
<div class="title">Listing 1. Architecture mapped to code</div>
<div class="content">
<pre>«rootpackage».«application»
├──.<a href="guide-component.html#business-component">«component»</a>
|  ├──.common
|  |  ├──.api[.«detail»]
|  |  |  ├──.<a href="#guide-datatype.asciidoc">datatype</a>
|  |  |  |  └──.<a href="#guide-datatype.asciidoc">«Datatype»</a>
|  |  |  └──.<a href="guide-transferobject.html#bo">«BusinessObject»</a>
|  |  └──.impl[.«detail»]
|  |     ├──.<a href="guide-json.html#custom-mapping">«Datatype»JsonSerializer</a>
|  |     └──.<a href="guide-json.html#custom-mapping">«Datatype»JsonDeserializer</a>
|  ├──.<a href="#guide-dataaccess-layer.asciidoc">dataaccess</a>
|  |  ├──.api[.«detail»]
|  |  |  ├──.<a href="#guide-repository.asciidoc">repo</a>
|  |  |  |  └──.<a href="guide-repository.html#repository">«BusinessObject»Repository</a>
|  |  |  ├──.<a href="#guide-dao.asciidoc">dao</a> (alternative to repo)
|  |  |  |  └──.<a href="guide-dao.html#data-access-object">«BusinessObject»Dao</a> (alternative to Repository)
|  |  |  └──.<a href="guide-jpa.html#entity">«BusinessObject»Entity</a>
|  |  └──.impl[.«detail»]
|  |     ├──.<a href="#guide-dao.asciidoc">dao</a> (alternative to repo)
|  |     |  └──.<a href="guide-dao.html#data-access-object">«BusinessObject»DaoImpl</a> (alternative to Repository)
|  |     └──.<a href="guide-jpa.html#entities-and-datatypes">«Datatype»AttributeConverter</a>
|  ├──.<a href="#guide-logic-layer.asciidoc">logic</a>
|  |  ├──.api
|  |  |  ├──.[«detail».]<a href="#guide-transferobject.asciidoc">to</a>
|  |  |  |   ├──.<a href="guide-transferobject.html#to">«MyCustom»«To</a>
|  |  |  |   ├──.<a href="guide-jpa.html#embeddable">«DataStructure»Embeddable</a>
|  |  |  |   ├──.<a href="guide-transferobject.html#eto">«BusinessObject»Eto</a>
|  |  |  |   └──.<a href="guide-transferobject.html#cto">«BusinessObject»«Subset»Cto</a>
|  |  |  ├──.[«detail».]<a href="#guide-usecase.asciidoc">usecase</a>
|  |  |  |   ├──.<a href="guide-usecase.html#find">UcFind«BusinessObject»</a>
|  |  |  |   ├──.<a href="guide-usecase.html#manage">UcManage«BusinessObject»</a>
|  |  |  |   └──.<a href="guide-usecase.html#custom">Uc«Operation»«BusinessObject»</a>
|  |  |  └──.<a href="guide-logic-layer.html#component">«Component»</a>
|  |  ├──.base
|  |  |  └──.[«detail».]<a href="#guide-usecase.asciidoc">usecase</a>
|  |  |     └──.<a href="#guide-usecase.asciidoc">Abstract«BusinessObject»Uc</a>
|  |  └──.impl
|  |     ├──.[«detail».]<a href="#guide-usecase.asciidoc">usecase</a>
|  |     |   ├──.<a href="guide-usecase.html#find">UcFind«BusinessObject»Impl</a>
|  |     |   ├──.<a href="guide-usecase.html#manage">UcManage«BusinessObject»Impl</a>
|  |     |   └──.<a href="guide-usecase.html#custom">Uc«Operation»«BusinessObject»Impl</a>
|  |     └──.<a href="guide-logic-layer.html#component">«Component»Impl</a>
|  └──.<a href="#guide-service-layer.asciidoc">service</a>
|     ├──.api[.«detail»]
|     |  ├──.<a href="#guide-rest.asciidoc">rest</a>
|     |  |  └──.<a href="guide-rest.html#rest-service-api">«Component»RestService</a>
|     |  └──.<a href="#guide-soap.asciidoc">ws</a>
|     |     └──.<a href="guide-soap.html#web-service-api">«Component»WebService</a>
|     └──.impl[.«detail»]
|        ├──.<a href="#guide-jms.asciidoc">jms</a>
|        |  └──.<a href="guide-jms.html#jms-listener">«BusinessObject»JmsListener</a>
|        ├──.<a href="#guide-rest.asciidoc">rest</a>
|        |  └──.<a href="guide-rest.html#rest-service-implementation">«Component»RestServiceImpl</a>
|        └──.<a href="#guide-soap.asciidoc">ws</a>
|           └──.<a href="guide-soap.html#web-service-implementation">«Component»WebServiceImpl</a>
├──.<a href="guide-component.html#general-component">general</a>
│  ├──.common
│  |  ├──.api
|  |  |  ├──.to
|  |  |  |  ├──.AbstractSearchCriteriaTo
|  |  |  └──.ApplicationEntity
│  |  ├──.base
|  |  |  └──.AbstractBeanMapperSupport
│  |  └──.impl
│  |     ├──.config
│  |     |  └──.ApplicationObjectMapperFactory
│  |     └──.security
│  |        └──.ApplicationWebSecurityConfig
│  ├──.dataaccess
│  |  └──.api
|  |     └──.ApplicationPersistenceEntity
│  ├──.logic
│  |  └──.base
|  |     ├──.AbstractComponentFacade
|  |     ├──.AbstractLogic
|  |     └──.AbstractUc
|  └──.service
|     └──...
└──.SpringBootApp</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="coding-conventions.asciidoc_code-tasks">9.1.4. Code Tasks</h4>
<div class="paragraph">
<p>Code spots that need some rework can be marked with the following tasks tags. These are already properly pre-configured in your development environment for auto completion and to view tasks you are responsible for. It is important to keep the number of code tasks low. Therefore every member of the team should be responsible for the overall code quality. So if you change a piece of code and hit a code task that you can resolve in a reliable way do this as part of your change and remove the according tag.</p>
</div>
<div class="sect4">
<h5 id="coding-conventions.asciidoc_todo">TODO</h5>
<div class="paragraph">
<p>Used to mark a piece of code that is not yet complete (typically because it can not be completed due to a dependency on something that is not ready).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"> // TODO «author» «description»</code></pre>
</div>
</div>
<div class="paragraph">
<p>A TODO tag is added by the author of the code who is also responsible for completing this task.</p>
</div>
</div>
<div class="sect4">
<h5 id="coding-conventions.asciidoc_fixme">FIXME</h5>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"> // FIXME «author» «description»</code></pre>
</div>
</div>
<div class="paragraph">
<p>A FIXME tag is added by the author of the code or someone who found a bug he can not fix right now. The «author» who added the FIXME is also responsible for completing this task. This is very similar to a TODO but with a higher priority. FIXME tags indicate problems that should be resolved before a release is completed while TODO tags might have to stay for a longer time.</p>
</div>
</div>
<div class="sect4">
<h5 id="coding-conventions.asciidoc_review">REVIEW</h5>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"> // REVIEW «responsible» («reviewer») «description»</code></pre>
</div>
</div>
<div class="paragraph">
<p>A REVIEW tag is added by a reviewer during a code review. Here the original author of the code is responsible to resolve the REVIEW tag and the reviewer is assigning this task to him. This is important for feedback and learning and has to be aligned with a review "process" where people talk to each other and get into discussion. In smaller or local teams a peer-review is preferable but this does not scale for large or even distributed teams.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="coding-conventions.asciidoc_code-documentation">9.1.5. Code-Documentation</h4>
<div class="paragraph">
<p>As a general goal the code should be easy to read and understand. Besides clear naming the documentation is important. We follow these rules:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>APIs (especially component interfaces) are properly documented with JavaDoc.</p>
</li>
<li>
<p>JavaDoc shall provide actual value - we do not write JavaDoc to satisfy tools such as checkstyle but to express information not already available in the signature.</p>
</li>
<li>
<p>We make use of <code>{@link}</code> tags in JavaDoc to make it more expressive.</p>
</li>
<li>
<p>JavaDoc of APIs describes how to use the type or method and not how the implementation internally works.</p>
</li>
<li>
<p>To document implementation details, we use code comments (e.g. <code>// we have to flush explicitly to ensure version is up-to-date</code>). This is only needed for complex logic.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="coding-conventions.asciidoc_code-style">9.1.6. Code-Style</h4>
<div class="paragraph">
<p>This section gives you best practices to write better code and avoid pitfalls and mistakes.</p>
</div>
<div class="sect4">
<h5 id="coding-conventions.asciidoc_blobs">BLOBs</h5>
<div class="paragraph">
<p>Avoid using <code>byte[]</code> for BLOBs as this will load them entirely into your memory. This will cause performance issues or out of memory errors. Instead use streams when dealing with BLOBs. For further details see <a href="#guide-blob-support.asciidoc">BLOB support</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="coding-conventions.asciidoc_closing-resources">Closing Resources</h5>
<div class="paragraph">
<p>Resources such as streams (<code>InputStream</code>, <code>OutputStream</code>, <code>Reader</code>, <code>Writer</code>) or transactions need to be handled properly. Therefore it is important to follow these rules:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Each resource has to be closed properly, otherwise you will get out of file handles, TX sessions, memory leaks or the like</p>
</li>
<li>
<p>Where possible avoid to deal with such resources manually. That is why we are recommending <code>@Transactional</code> for transactions in devonfw (see <a href="#guide-transactions.asciidoc">Transaction Handling</a>).</p>
</li>
<li>
<p>In case you have to deal with resources manually (e.g. binary streams) ensure to close them properly. See the example below for details.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Closing streams and other such resources is error prone. Have a look at the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">try {
  InputStream in = new FileInputStream(file);
  readData(in);
  in.close();
} catch (IOException e) {
  throw new RuntimeIoException(e, IoMode.READ);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The code above is wrong as in case of an <code>IOException</code> the <code>InputStream</code> is not properly closed. In a server application such mistakes can cause severe errors that typically will only occur in production. As such resources implement the <code>AutoCloseable</code> interface you can use the <code>try-with-resource</code> syntax to write correct code. The following code shows a correct version of the example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">try (InputStream in = new FileInputStream(file)) {
  readData(in);
} catch (IOException e) {
  throw new RuntimeIoException(e, IoMode.READ);
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="coding-conventions.asciidoc_lambdas-and-streams">Lambdas and Streams</h5>
<div class="paragraph">
<p>With Java8 you have cool new feautres like lambdas and monads like (<code>Stream</code>, <code>CompletableFuture</code>, <code>Optional</code>, etc.).
However, these new features can also be misused or lead to code that is hard to read or debug. To avoid pain, we give you the following best practices:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Learn how to use the new features properly before using. Often developers are keen on using cool new features. When you do your first experiments in your project code you will cause deep pain and might be ashamed afterwards. Please study the features properly. Even Java8 experts still write for loops to iterate over collections, so only use these features where it really makes sense.</p>
</li>
<li>
<p>Streams shall only be used in fluent API calls as a Stream can not be forked or reused.</p>
</li>
<li>
<p>Each stream has to have exactly one terminal operation.</p>
</li>
<li>
<p>Do not write multiple statements into lambda code:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">collection.stream().map(x -&gt; {
Foo foo = doSomething(x);
...
return foo;
}).collect(Collectors.toList());</code></pre>
</div>
</div>
<div class="paragraph">
<p>This style makes the code hard to read and debug. Never do that! Instead extract the lambda body to a private method with a meaningful name:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">collection.stream().map(this::convertToFoo).collect(Collectors.toList());</code></pre>
</div>
</div>
</li>
<li>
<p>Do not use <code>parallelStream()</code> in general code (that will run on server side) unless you know exactly what you are doing and what is going on under the hood. Some developers might think that using parallel streams is a good idea as it will make the code faster. However, if you want to do performance optimizations talk to your technical lead (architect). Many features such as security and transactions will rely on contextual information that is associated with the current thread. Hence, using parallel streams will most probably cause serious bugs. Only use them for standalone (CLI) applications or for code that is just processing large amounts of data.</p>
</li>
<li>
<p>Do not perform operations on a sub-stream inside a lambda:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">set.stream().flatMap(x -&gt; x.getChildren().stream().filter(this::isSpecial)).collect(Collectors.toList()); // bad
set.stream().flatMap(x -&gt; x.getChildren().stream()).filter(this::isSpecial).collect(Collectors.toList()); // fine</code></pre>
</div>
</div>
</li>
<li>
<p>Only use <code>collect</code> at the end of the stream:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">set.stream().collect(Collectors.toList()).forEach(...) // bad
set.stream().peek(...).collect(Collectors.toList()) // fine</code></pre>
</div>
</div>
</li>
<li>
<p>Lambda parameters with Types inference</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">(a,b,c)  -&gt; a.toString() + Float.toString(b) + Arrays.toString(c)  // fine
(String a, Float b, Byte[] c) -&gt; a.toString() + Float.toString(b) + Arrays.toString(c)  //bad

Collections.sort(personList, (p1, p2) -&gt; p1.getSurName().compareTo(p2.getSurName()));  //fine
Collections.sort(personList, (Person p1, Person p2) -&gt; p1.getSurName().compareTo(p2.getSurName()));  //bad</code></pre>
</div>
</div>
</li>
<li>
<p>Avoid Return Braces and Statement</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"> (a) -&gt;  a.toString();   // fine
 (a) -&gt;  { return a.toString(); } //bad</code></pre>
</div>
</div>
</li>
<li>
<p>Avoid Parentheses with Single Parameter</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"> a -&gt; a.toString();  // fine
(a) -&gt; a.toString(); //bad</code></pre>
</div>
</div>
</li>
<li>
<p>Avoid if/else inside foreach method. Use Filter method &amp; comprehension</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">Bad
static public Iterator&lt;String&gt; TwitterHandles(Iterator&lt;Author&gt; authors, string company) {
    final List result = new ArrayList&lt;String&gt; ();
    foreach (Author a : authors) {
      if (a.Company.equlas(company)) {
        String handle = a.TwitterHandle;
        if (handle != null)
          result.Add(handle);
      }
    }
    return result;
  }</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">Fine
public List&lt;String&gt; twitterHandles(List&lt;Author&gt; authors, String company) {
    return authors.stream()
            .filter(a -&gt; null != a &amp;&amp; a.getCompany().equals(company))
            .map(a -&gt; a.getTwitterHandle())
            .collect(toList());
  }</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="coding-conventions.asciidoc_optionals">Optionals</h5>
<div class="paragraph">
<p>With <code>Optional</code> you can wrap values to avoid a <code>NullPointerException</code> (NPE). However, it is not a good code-style to use <code>Optional</code> for every parameter or result to express that it may be null. For such case use <code>@Nullable</code> or even better instead annotate <code>@NotNull</code> where <code>null</code> is not acceptable.</p>
</div>
<div class="paragraph">
<p>However, <code>Optional</code> can be used to prevent NPEs in fluent calls (due to the lack of the elvis operator):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">Long id;
id = fooCto.getBar().getBar().getId(); // may cause NPE
id = Optional.ofNullable(fooCto).map(FooCto::getBar).map(BarCto::getBar).map(BarEto::getId).orElse(null); // null-safe</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="coding-conventions.asciidoc_encoding">Encoding</h5>
<div class="paragraph">
<p>Encoding (esp. Unicode with combining characters and surrogates) is a complex topic. Please study this topic if you have to deal with encodings and processing of special characters. For the basics follow these recommendations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>When you have explicitly decide for an encoding always prefer Unicode (UTF-8 or better). This especially impacts your databases and has to be defined upfront as it typically can not be changed (easily) afterwards.</p>
</li>
<li>
<p>Do not cast from <code>byte</code> to <code>char</code> (Unicode characters can be composed of multiple bytes, such cast may only work for ASCII characters)</p>
</li>
<li>
<p>Never convert the case of a String using the default locale (esp. when writing generic code like in devonfw). E.g. if you do <code>"HI".toLowerCase()</code> and your system locale is Turkish, then the output will be "hı" instead of "hi" what can lead to wrong assumptions and serious problems. If you want to do a "universal" case conversion always use explicitly an according western locale (e.g. <code>toLowerCase(Locale.US)</code>). Consider using a library (<a href="https://github.com/m-m-m/util/blob/master/core/src/main/java/net/sf/mmm/util/lang/api/BasicHelper.java" class="bare">https://github.com/m-m-m/util/blob/master/core/src/main/java/net/sf/mmm/util/lang/api/BasicHelper.java</a>) or create your own little static utility for that in your project.</p>
</li>
<li>
<p>Write your code independent from the default encoding (system property <code>file.encoding</code>) - this will most likely differ in JUnit from production environment</p>
<div class="ulist">
<ul>
<li>
<p>Always provide an encoding when you create a <code>String</code> from <code>byte[]</code>: <code>new String(bytes, encoding)</code></p>
</li>
<li>
<p>Always provide an encoding when you create a <code>Reader</code> or <code>Writer</code> : <code>new InputStreamReader(inStream, encoding)</code></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="coding-conventions.asciidoc_prefer-general-api">Prefer general API</h5>
<div class="paragraph">
<p>Avoid unnecessary strong bindings:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Do not bind your code to implementations such as <code>Vector</code> or <code>ArrayList</code> instead of <code>List</code></p>
</li>
<li>
<p>In APIs for input (=parameters) always consider to make little assumptions:</p>
<div class="ulist">
<ul>
<li>
<p>prefer <code>Collection</code> over <code>List</code> or <code>Set</code> where the difference does not matter (e.g. only use <code>Set</code> when you require uniqueness or highly efficient <code>contains</code>)</p>
</li>
<li>
<p>consider prefering <code>Collection&lt;? extends Foo&gt;</code> over <code>Collection&lt;Foo&gt;</code> when <code>Foo</code> is an interface or super-class</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<!-- toc disabled -->
</div>
</div>
</div>
<div class="sect2">
<h3 id="coding-tools.asciidoc">9.2. Tools</h3>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 3. Development Tools used for devon4j</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>Topic</strong></th>
<th class="tableblock halign-left valign-top"><strong>Detail</strong></th>
<th class="tableblock halign-left valign-top"><strong>Suggested Tool</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">build-management</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">*</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://maven.apache.org/">maven</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">IDE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">IDE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://www.eclipse.org/">Eclipse</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">IDE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">setup &amp; update</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://github.com/devonfw/devon-ide">devonfw-ide</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">IDE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">code generation</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://github.com/devonfw/tools-cobigen">CobiGen</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Testing</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Unit-Testing</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://junit.org/">JUnit</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Testing</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Mocking</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://code.google.com/p/mockito/">Mockito</a> &amp; <a href="http://wiremock.org/getting-started.html">WireMock</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Testing</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Integration-Testing</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://docs.spring.io/spring-framework/docs/3.2.x/spring-framework-reference/html/testing.html">spring-test</a> (<a href="http://arquillian.org/">arquillian</a> for JEE)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Testing</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">End-to-end</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://github.com/devonfw/devonfw-testing">MrChecker</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Quality</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Code-Analysis</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://www.sonarqube.org/">SonarQube</a></p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="master-devon4j.asciidoc_layers">10. Layers</h2>
<div class="sectionbody">
<!-- toc disabled -->
<div class="sect2">
<h3 id="guide-client-layer.asciidoc">10.1. Client Layer</h3>
<div class="paragraph">
<p>There are various technical approaches to building GUI clients. The devonfw proposes rich clients that connect to the server via data-oriented services (e.g. using REST with JSON).
In general, we have to distinguish among the following types of clients:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>web clients</p>
</li>
<li>
<p>native desktop clients</p>
</li>
<li>
<p>(native) mobile clients</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Our main focus is on web-clients. In our sample application <a href="https://github.com/devonfw/my-thai-star/">my-thai-star</a> we offer a responsive web-client based on Angular following <a href="https://github.com/devonfw/devon4ng/">devon4ng</a> that integrates seamlessly with the backends of my-thai-star available for Java using devon4j as well as .NET/C# using <a href="https://github.com/devonfw/devon4net/">devon4net</a>. For building angular clients read the separate <a href="https://github.com/devonfw/devon4ng/wiki">devon4ng guide</a>.</p>
</div>
<div class="sect3">
<h4 id="guide-client-layer.asciidoc_javascript-for-java-developers">10.1.1. JavaScript for Java Developers</h4>
<div class="paragraph">
<p>In order to get started with client development as a Java developer we give you some hints to get started. Also if you are an experienced JavaScript developer and want to learn Java this can be helpful. First, you need to understand that the JavaScript ecosystem is as large as the Java ecosystem and developing a modern web client requires a lot of knowledge. The following table helps you as experienced developer to get an overview of the tools, configuration-files, and other related aspects from the new world to learn. Also it helps you to map concepts between the ecosystems. Please note that we list the tools recommended by devonfw here (and we know that there are alternatives not listed here such as gradle, grunt, bower, etc.).</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 4. Aspects in JavaScript and Java ecosystem</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>Topic</strong></th>
<th class="tableblock halign-left valign-top"><strong>Aspect</strong></th>
<th class="tableblock halign-left valign-top"><strong>JavaScript</strong></th>
<th class="tableblock halign-left valign-top"><strong>Java</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Programming</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Language</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://www.typescriptlang.org/">TypeScript</a> (extends <a href="https://www.javascript.com/">JavaScript</a>)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://docs.oracle.com/javase/tutorial/">Java</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Runtime</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">VM</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://nodejs.org/">nodejs</a> (or web-browser)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://www.oracle.com/technetwork/java/javase/">jvm</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" rowspan="3"><p class="tableblock">Dependency-Management</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Tool</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://yarnpkg.com/">yarn</a> (or <a href="https://github.com/npm/npm">npm</a>)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://maven.apache.org/">maven</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Config</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://docs.npmjs.com/files/package.json">package.json</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://maven.apache.org/pom.html">pom.xml</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Repository</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://www.npmjs.com/">npm repo</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://repo.maven.apache.org/maven2">maven central</a> (<a href="https://mvnrepository.com/">repo search</a>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" rowspan="5"><p class="tableblock">Build-Management</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Taskrunner</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://gulpjs.com/">gulp</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://maven.apache.org/">maven</a> (or more comparable <a href="http://ant.apache.org/">ant</a>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Config</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://github.com/gulpjs/gulp/blob/master/docs/getting-started.md">gulpfile.js</a> (and <code>gulp/*</code>)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://maven.apache.org/pom.html">pom.xml</a> (or <a href="https://ant.apache.org/manual/using.html">build.xml</a>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Clean cmd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">gulp clean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">mvn <a href="https://maven.apache.org/plugins/maven-clean-plugin/">clean</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Build cmd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yarn install &amp;&amp; gulp build:dist</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">mvn <a href="https://maven.apache.org/plugins/maven-install-plugin/usage.html">install</a> (see <a href="https://maven.apache.org/guides/introduction/introduction-to-the-lifecycle.html">lifecycle</a>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Test cmd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">gulp test</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">mvn <a href="http://maven.apache.org/components/surefire/maven-surefire-plugin/">test</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" rowspan="4"><p class="tableblock"><a href="#guide-testing.asciidoc">Testing</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Test-Tool</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://jasmine.github.io/">jasmine</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://junit.org/">junit</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Test-Framework</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://karma-runner.github.io/">karma</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://junit.org/">junit</a> / <a href="http://maven.apache.org/components/surefire/maven-surefire-plugin/">surefire</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Browser Testing</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://phantomjs.org/">PhantomJS</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://www.seleniumhq.org/">Selenium</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Extensions</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://karma-runner.github.io/">karma</a>-*, <a href="http://phantomjs.org/">PhantomJs</a> for browser emulation</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://joel-costigliola.github.io/assertj/">AssertJ</a>,*Unit and <a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/html/integration-testing.html">spring-test</a>, etc.)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Code Analysis</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Code Coverage</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://github.com/karma-runner/karma-coverage">karma-coverage</a> (and <a href="https://github.com/SitePen/remap-istanbul">remap-istanbul</a> for TypeScript)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://www.eclemma.org/jacoco/">JaCoCo/EclEmma</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Development</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">IDE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://code.visualstudio.com/">MS VS Code</a> or <a href="https://www.jetbrains.com/idea/">IntelliJ</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://eclipse.org/downloads/">Eclipse</a> or <a href="https://www.jetbrains.com/idea/">IntelliJ</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Framework</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://angularjs.org/">Angular</a> (etc.)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://spring.io/">Spring</a> (etc.)</p></td>
</tr>
</tbody>
</table>
<!-- toc disabled -->
</div>
</div>
<div class="sect2">
<h3 id="guide-service-layer.asciidoc">10.2. Service Layer</h3>
<div class="paragraph">
<p>The service layer is responsible for exposing functionality made available by the <a href="#guide-logic-layer.asciidoc">logical layer</a> to external consumers over a network via <a href="#guide-service-layer.asciidoc_protocol">technical protocols</a>.</p>
</div>
<div class="sect3">
<h4 id="guide-service-layer.asciidoc_types-of-services">10.2.1. Types of Services</h4>
<div class="paragraph">
<p>We distinguish between the following types of services:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>External Services</strong><br>
are used for communication between different companies, vendors, or partners.</p>
</li>
<li>
<p><strong>Internal Services</strong><br>
are used for communication between different applications in the same application landscape of the same vendor.</p>
<div class="ulist">
<ul>
<li>
<p><strong>Back-end Services</strong><br>
are internal services between Java back-end components typically with different release and deployment cycles (if not Java consider this as external service).</p>
</li>
<li>
<p><strong>JS-Client Services</strong><br>
are internal services provided by the Java back-end for JavaScript clients (GUI).</p>
</li>
<li>
<p><strong>Java-Client Services</strong><br>
are internal services provided by the Java back-end for a native Java client (JavaFx, EclipseRcp, etc.).</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>The choices for technology and protocols will depend on the type of service. The following table gives a guideline for aspects according to the service types.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 5. Aspects according to service-type</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>Aspect</strong></th>
<th class="tableblock halign-left valign-top"><strong>External Service</strong></th>
<th class="tableblock halign-left valign-top"><strong>Back-end Service</strong></th>
<th class="tableblock halign-left valign-top"><strong>JS-Client Service</strong></th>
<th class="tableblock halign-left valign-top"><strong>Java-Client Service</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#guide-service-layer.asciidoc_versioning"><strong>Versioning</strong></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">required</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">required</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">not required</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">not required</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#guide-service-layer.asciidoc_interoperability"><strong>Interoperability</strong></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">mandatory</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">not required</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">implicit</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">not required</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#guide-service-layer.asciidoc_protocol">Recommended <strong>Protocol</strong></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#guide-soap.asciidoc">SOAP</a> or <a href="#guide-rest.asciidoc">REST</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#guide-rest.asciidoc">REST</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#guide-rest.asciidoc">REST</a>+JSON</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#guide-rest.asciidoc">REST</a></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="guide-service-layer.asciidoc_versioning">10.2.2. Versioning</h4>
<div class="paragraph">
<p>For services consumed by other applications we use versioning to prevent incompatibilities between applications when deploying updates. This is done by the following conventions:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>We define a version number and prefix it with <code>v</code> (e.g. <code>v1</code>).</p>
</li>
<li>
<p>If we support previous versions we use that version numbers as part of the Java package defining the service API (e.g. <code>com.foo.application.component.service.api.v1</code>)</p>
</li>
<li>
<p>We use the version number as part of the service name in the remote URL (e.g. <code><a href="https://application.foo.com/services/rest/component/v1/resource" class="bare">https://application.foo.com/services/rest/component/v1/resource</a></code>)</p>
</li>
<li>
<p>Whenever breaking changes are made to the API, create a separate version of the service and increment the version (e.g. <code>v1</code> &#8594; <code>v2</code>) . The implementations of the different versions of the service contain compatibility code and delegate to the same unversioned use-case of the logic layer whenever possible.</p>
</li>
<li>
<p>For maintenance and simplicity, avoid keeping more than one previous version.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="guide-service-layer.asciidoc_interoperability">10.2.3. Interoperability</h4>
<div class="paragraph">
<p>For services that are consumed by clients with different technology, <em>interoperability</em> is required. This is addressed by selecting the right protocol, following protocol-specific best practices and following our considerations especially <em>simplicity</em>.</p>
</div>
</div>
<div class="sect3">
<h4 id="guide-service-layer.asciidoc_service-considerations">10.2.4. Service Considerations</h4>
<div class="paragraph">
<p>The term <em>service</em> is quite generic and therefore easily misunderstood. It is a unit exposing coherent functionality via a well-defined interface over a network. For the design of a service, we consider the following aspects:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>self-contained</strong><br>
The entire API of the service shall be self-contained and have no dependencies on other parts of the application (other services, implementations, etc.).</p>
</li>
<li>
<p><strong>idempotence</strong><br>
E.g. creation of the same master-data entity has no effect (no error)</p>
</li>
<li>
<p><strong>loosely coupled</strong><br>
Service consumers have minimum knowledge and dependencies on the service provider.</p>
</li>
<li>
<p><strong>normalized</strong><br>
complete, no redundancy, minimal</p>
</li>
<li>
<p><strong>coarse-grained</strong><br>
Service provides rather large operations (save entire entity or set of entities rather than individual attributes)</p>
</li>
<li>
<p><strong>atomic</strong><br>
Process individual entities (for processing large sets of data, use a <a href="#guide-batch-layer.asciidoc">batch</a> instead of a service)</p>
</li>
<li>
<p><strong>simplicity</strong><br>
avoid polymorphism, RPC methods with unique name per signature and no overloading, avoid attachments (consider separate download service), etc.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="guide-service-layer.asciidoc_security">10.2.5. Security</h4>
<div class="paragraph">
<p>Your services are the major entry point to your application. Hence security considerations are important here.</p>
</div>
<div class="paragraph">
<p>See <a href="guide-rest.html#security">REST Security</a>.</p>
</div>
<!-- toc disabled -->
</div>
</div>
<div class="sect2">
<h3 id="guide-logic-layer.asciidoc">10.3. Logic Layer</h3>
<div class="paragraph">
<p>The logic layer is the heart of the application and contains the main business logic.
According to our <a href="architecture.html#business-architecture">business architecture</a> we divide an application into <a href="#guide-component.asciidoc">components</a>.
For each component the logic layer defines a <a href="#guide-component-facade.asciidoc">component-facade</a>.
According to the complexity you can further devide this into indivudual <a href="#guide-usecase.asciidoc">use-cases</a>.
It is very important that you follow the links to understand the concept of component-facade and use-case in order to properly implement your business logic.</p>
</div>
<div class="sect3">
<h4 id="guide-logic-layer.asciidoc_responsibility">10.3.1. Responsibility</h4>
<div class="paragraph">
<p>The logic layer is responsible for implementation the business logic according to the specified functional demands and requirements.
It therefore creates the actual value of the application.
The following additional aspects are also in its responsibility:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#guide-validation.asciidoc">validation</a></p>
</li>
<li>
<p><a href="guide-access-control.html#authorization">authorization</a></p>
</li>
<li>
<p><a href="#guide-transactions.asciidoc">transaction-handling</a> (in addition to <a href="#guide-service-layer.asciidoc">service layer</a>).</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="guide-logic-layer.asciidoc_security">10.3.2. Security</h4>
<div class="paragraph">
<p>The logic layer is the heart of the application. It is also responsible for authorization and hence security is important here. Every method exposed in an interface needs to be annotated with an authorization check, stating what role(s) a caller must provide in order to be allowed to make the call. The authorization concept is described <a href="guide-security.html#authorization">here</a>.</p>
</div>
<div class="sect4">
<h5 id="guide-logic-layer.asciidoc_direct-object-references">Direct Object References</h5>
<div class="paragraph">
<p>A security threat are <a href="https://www.owasp.org/index.php/Top_10_2013-A4-Insecure_Direct_Object_References">Insecure Direct Object References</a>. This simply gives you two options:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>avoid direct object references at all</p>
</li>
<li>
<p>ensure that direct object references are secure</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Especially when using REST, direct object references via technical IDs are common sense. This implies that you have a proper <a href="#guide-logic-layer.asciidoc_authorization">authorization</a> in place. This is especially tricky when your authorization does not only rely on the type of the data and according static permissions but also on the data itself. Vulnerabilities for this threat can easily happen by design flaws and inadvertence. Here is an example from our sample application:</p>
</div>
<div class="paragraph">
<p>We have a generic use-case to manage BLOBs. In the first place it makes sense to write a generic REST service to load and save these BLOBs. However, the permission to read or even update such BLOB depend on the business object hosting the BLOB. Therefore, such a generic REST service would open the door for this OWASP A4 vulnerability. To solve this in a secure way, you need individual services for each hosting business object to manage the linked BLOB and have to check permissions based on the parent business object. In this example the ID of the BLOB would be the direct object reference and the ID of the business object (and a BLOB property indicator) would be the indirect object reference.</p>
</div>
<!-- toc disabled -->
</div>
</div>
</div>
<div class="sect2">
<h3 id="guide-component-facade.asciidoc">10.4. Component Facade</h3>
<div class="paragraph">
<p>For each component of the application the <a href="#guide-logic-layer.asciidoc">logic layer</a> defines a component facade.
This is an interface defining all business operations of the component.
It carries the name of the component (<code>«Component»</code>) and has an implementation named <code>«Component»Impl</code> (see <a href="#guide-component-facade.asciidoc_implementation">implementation</a>).</p>
</div>
<div class="sect3">
<h4 id="guide-component-facade.asciidoc_api">10.4.1. API</h4>
<div class="paragraph">
<p>The component facade interface defines the logic API of the component and has to be business oriented.
This means that all parameters and return types of all methods from this API have to be business <a href="#guide-transferobject.asciidoc">transfer-objects</a>, <a href="#guide-datatype.asciidoc">datatypes</a> (<code>String</code>, <code>Integer</code>, <code>MyCustomerNumber</code>, etc.), or collections of these.
The API may also only access objects of other business components listed in the (transitive) dependencies of the <a href="architecture.html#business-architecture">business-architecture</a>.</p>
</div>
<div class="paragraph">
<p>Here is an example how such an API may look like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public interface Bookingmanagement {

  BookingEto findBooking(Long id);

  BookingCto findBookingCto(Long id);

  Page&lt;BookingEto&gt; findBookingEtos(BookingSearchCriteriaTo criteria);

  void approveBooking(BookingEto booking);

}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="guide-component-facade.asciidoc_implementation">10.4.2. Implementation</h4>
<div class="paragraph">
<p>The implementation of an interface from the <a href="#guide-logic-layer.asciidoc">logic layer</a> (a component facade or a <a href="#guide-usecase.asciidoc">use-case</a>) carries the name of that interface with the suffix <code>Impl</code> and is annotated with <code>@Named</code>.
An implementation typically needs access to the persistent data.
This is done by <a href="#guide-dependency-injection.asciidoc">injecting</a> the corresponding <a href="#guide-repository.asciidoc">repository</a> (or <a href="#guide-dao.asciidoc">DAO</a>).
According to <a href="architecture.html#architecture-principles">data-sovereignty</a>, only repostories of the same business component may be accessed directly.
For accessing data from other components the implementation has to use the corresponding API of the logic layer (the component facade). Further, it shall not expose persistent entities from the <a href="#guide-dataaccess-layer.asciidoc">dataaccess layer</a> and has to map them to <a href="#guide-transferobject.asciidoc">transfer objects</a> using the <a href="#guide-beanmapping.asciidoc">bean-mapper</a>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Named
@Transactional
public class BookingmanagementImpl extends AbstractComponentFacade implements Bookingmanagement {

  @Inject
  private BookingRepository bookingRepository;

  @Override
  public BookingEto findBooking(Long id) {

    LOG.debug("Get Booking with id {} from database.", id);
    BookingEntity entity = this.bookingRepository.findOne(id);
    return getBeanMapper().map(entity, BookingEto.class));
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see, <a href="guide-jpa.html#entity">entities</a> (<code>BookingEntity</code>) are mapped to corresponding <a href="guide-transferobject.html#eto">ETOs</a> (<code>BookingEto</code>).
Further details about this can be found in <a href="#guide-beanmapping.asciidoc">bean-mapping</a>.</p>
</div>
<div class="paragraph">
<p>For complex applications, the component facade consisting of many different methods.
For better maintainability in such case it is recommended to split it into separate <a href="#guide-usecase.asciidoc">use-cases</a> that are then only aggregated by the component facade.</p>
</div>
<!-- toc disabled -->
</div>
</div>
<div class="sect2">
<h3 id="guide-usecase.asciidoc">10.5. UseCase</h3>
<div class="paragraph">
<p>A use-case is a small unit of the <a href="#guide-logic-layer.asciidoc">logic layer</a> responsible for an operation on a particular <a href="guide-jpa.html#entity">entity</a> (business object).
It is defined by an interface (API) with its according implementation.
Following our <a href="coding-conventions.html#architecture-mapping">architecture-mapping</a> use-cases are named <code>Uc«Operation»«BusinessObject»[Impl]</code>. The prefix <code>Uc</code> stands for use-case and allows to easily find and identify them in your IDE. The <code>«Operation»</code> stands for a verb that is operated on the entity identified by <code>«BusinessObject»</code>.
For <a href="https://en.wikipedia.org/wiki/Create,_read,_update_and_delete">CRUD</a> we use the standard operations <code>Find</code> and <code>Manage</code> that can be generated by <a href="https://github.com/devonfw/tools-cobigen">CobiGen</a>. This also separates read and write operations (e.g. if you want to do CQSR, or to configure read-only transactions for read operations).</p>
</div>
<div class="sect3">
<h4 id="guide-usecase.asciidoc_find">10.5.1. Find</h4>
<div class="paragraph">
<p>The <code>UcFind«BusinessObject»</code> defines all read operations to retrieve and search the <code>«BusinessObject»</code>.
Here is an example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public interface UcFindBooking {

  BookingEto findBooking(Long id);

  BookingCto findBookingCto(Long id);

  Page&lt;BookingEto&gt; findBookingEtos(BookingSearchCriteriaTo criteria);

  Page&lt;BookingCto&gt; findBookingCtos(BookingSearchCriteriaTo criteria);

}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="guide-usecase.asciidoc_manage">10.5.2. Manage</h4>
<div class="paragraph">
<p>The <code>UcManage«BusinessObject»</code> defines all CRUD write operations (create, update and delete) for the <code>«BusinessObject»</code>.
Here is an example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public interface UcManageBooking {

  BookingEto saveBooking(BookingEto booking);

  boolean deleteBooking(Long id);

}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="guide-usecase.asciidoc_custom">10.5.3. Custom</h4>
<div class="paragraph">
<p>Any other non CRUD operation <code>Uc«Operation»«BusinessObject»</code> uses any other custom verb for <code>«Operation»</code>.
Typically such custom use-cases only defing a single method.
Here is an example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public interface UcApproveBooking {

  void approveBooking(BookingEto booking);

}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="guide-usecase.asciidoc_implementation">10.5.4. Implementation</h4>
<div class="paragraph">
<p>For the implementation of a use-case the same rules apply that are described for the <a href="guide-component-facade.html#implementation">component-facade implementation</a>.</p>
</div>
<div class="paragraph">
<p>However, when following the use-case approach, your component facade simply changes to:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public interface Bookingmanagement extends UcFindBooking, UcManageBooking, UcApproveBooking {
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Where the implementation only delegates to the use-cases and gets entirely generated by CobiGen:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class BookingmanagementImpl implements  {

  @Inject
  private UcFindBooking ucFindBooking;

  @Inject
  private UcManageBooking ucManageBooking;

  @Inject
  private UcApproveBooking ucApproveBooking;

  @Override
  public BookingEto findBooking(Long id) {
    return this.ucFindBooking.findBooking(id);
  }

  @Override
  public Page&lt;BookingEto&gt; findBookingEtos(BookingSearchCriteriaTo criteria) {
    return this.ucFindBooking.findBookingEtos(criteria);
  }

  @Override
  public BookingEto saveBooking(BookingEto booking) {
    return this.ucManageBooking.saveBooking(booking);
  }

  @Override
  public boolean deleteBooking(Long id) {
    return this.ucManageBooking.deleteBooking(booking);
  }

  @Override
  public void approveBooking(BookingEto booking) {
    this.ucApproveBooking.approveBooking(booking);
  }

  ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This approach is also illustrated by the following UML diagram:</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/component-facade-with-use-cases.png" alt="Component facade with use cases.">
</div>
</div>
</div>
<div class="sect3">
<h4 id="guide-usecase.asciidoc_internal-use-case">10.5.5. Internal use case</h4>
<div class="paragraph">
<p>Sometimes a component with multiple related entities and many use-cases needs to reuse business logic internally.
Of course this can be exposed as official use-case API but this will imply using transfer-objects (ETOs) instead of entities. In some cases this is undesired e.g. for better performance to prevent unnecessary mapping of entire collections of entities.
In the first place you should try to use abstract base implementations providing reusable methods the actual use-case implementations can inherit from.
If your business logic is even more complex and you have multiple aspects of business logic to share and reuse but also run into multi-inheritance issues, you may also just create use-cases that have their interface located in the <code>impl</code> scope package right next to the implementation (or you may just skip the interface). In such case you may define methods that directly take or return entity objects.
To avoid confusion with regular use-cases we recommend to add the <code>Internal</code> suffix to the type name leading to <code>Uc«Operation»«BusinessObject»Internal[Impl]</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="guide-usecase.asciidoc_injection-issues">10.5.6. Injection issues</h4>
<div class="paragraph">
<p>Technically now you have two implementations of your use-case:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the direct implementation of the use-case (<code>Uc*Impl</code>)</p>
</li>
<li>
<p>the component facade implemenation (<code>«Component»Impl</code>)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>When injecting a use-case interface this could cause ambiguities.
This is addressed as following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>In the component facade implemenation (<code>«Component»Impl</code>) spring is smart enough to resolve the ambiguity as it assumes that a spring bean never wants to inject itself (can already be access via <code>this</code>).
Therefore only the proper use-case implementation remains as candidate and injection works as expected.</p>
</li>
<li>
<p>In all other places simply always inject the component facade interface instead of the use-case.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In case you might have the lucky occasion to hit this nice exception:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>org.springframework.beans.factory.BeanCurrentlyInCreationException: Error creating bean with name 'uc...Impl': Bean with name 'uc...Impl' has been injected into other beans [...Impl] in its raw version as part of a circular reference, but has eventually been wrapped. This means that said other beans do not use the final version of the bean. This is often the result of over-eager type matching - consider using 'getBeanNamesOfType' with the 'allowEagerInit' flag turned off, for example.</code></pre>
</div>
</div>
<div class="paragraph">
<p>To get rid of such error you need to annotate your according implementation also with <code>@Lazy</code> in addition to <code>@Named</code>.</p>
</div>
<!-- toc disabled -->
</div>
</div>
<div class="sect2">
<h3 id="guide-dataaccess-layer.asciidoc">10.6. Data-Access Layer</h3>
<div class="paragraph">
<p>The data-access layer is responsible for all outgoing connections to access and process data. This is mainly about accessing data from a persistent data-store but also about invoking external services.</p>
</div>
<div class="sect3">
<h4 id="guide-dataaccess-layer.asciidoc_rdbms">10.6.1. RDBMS</h4>
<div class="paragraph">
<p>The classical approach is to use a Relational Database Management System (RDMS). In such case we strongly recommend to follow our <a href="#guide-jpa.asciidoc">JPA Guide</a>. In case you are using Oracle you should also consider the <a href="#guide-oracle.asciidoc">Oracle guide</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="guide-dataaccess-layer.asciidoc_nosql">10.6.2. NoSQL</h4>
<div class="paragraph">
<p>In case of specific demands and requirements you may want to choose for a <em>Not only SQL</em> database (NoSQL). There are different categories of such products so you should first be aware what fits your requirements best:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>key/value DB</p>
</li>
<li>
<p>document DB</p>
</li>
<li>
<p>graph DB</p>
</li>
<li>
<p>wide-column DB</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>As there are many such products and the market is evolving very fast, we do not yet give clear recommendations here. If you are doing a devon project and consider NoSQL please contact us for further details.</p>
</div>
<!-- toc disabled -->
</div>
</div>
<div class="sect2">
<h3 id="guide-batch-layer.asciidoc">10.7. Batch Layer</h3>
<div class="paragraph">
<p>We understand batch processing as bulk-oriented, non-interactive, typically long running execution of tasks. For simplicity we use the term batch or batch job for such tasks in the following documentation.</p>
</div>
<div class="paragraph">
<p>devonfw uses <a href="http://projects.spring.io/spring-batch/">Spring Batch</a> as batch framework.</p>
</div>
<div class="paragraph">
<p>This guide explains how Spring Batch is used in devonfw applications. Please note that it is not yet fully consistent concerning batches with the sample application. You should adhere to this guide by now.</p>
</div>
<div class="sect3">
<h4 id="guide-batch-layer.asciidoc_batch-architecture">10.7.1. Batch architecture</h4>
<div class="paragraph">
<p>In this chapter we will describe the overall architecture (especially concerning layering) and how to administer batches.</p>
</div>
<div class="sect4">
<h5 id="guide-batch-layer.asciidoc_layering">Layering</h5>
<div class="paragraph">
<p>Batches are implemented in the batch layer. The batch layer is responsible for batch processes, whereas the business logic is implemented in the logic layer. Compared to the <a href="#guide-service-layer.asciidoc">service layer</a> you may understand the batch layer just as a different way of accessing the business logic.
From a component point of view each batch is implemented as a subcomponent in the corresponding business component.
The business component is defined by the <a href="#architecture.asciidoc">business architecture</a>.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s make an example for that. The sample application implements a batch for exporting bills. This <em>billExport</em> belongs to the salesmanagement business component.
So the <em>billExport</em> is implemented in the following package:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>&lt;basepackage&gt;.salesmanagement.batch.impl.billexport.*</code></pre>
</div>
</div>
<div class="paragraph">
<p>Batches should invoke use cases in the logic layer for doing their work.
Only "batch specific" technical aspects should be implemented in the batch layer.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>Example:
For a batch, which imports product data from a CSV file, this means that all code for actually reading and parsing the CSV input file is implemented in the batch layer.
The batch calls the use case "create product" in the logic layer for actually creating the products for each line read from the CSV input file.</p>
</div>
</div>
</div>
<div class="sect5">
<h6 id="guide-batch-layer.asciidoc_-accessing-data-access-layer">Accessing data access layer</h6>
<div class="paragraph">
<p>In practice it is not always appropriate to create use cases for every bit of work a batch should do. Instead, the data access layer can be used directly.
An example for that is a typical batch for data retention which deletes out-of-time data.
Often deleting out-dated data is done by invoking a single SQL statement. It is appropriate to implement that SQL in a <a href="#guide-repository.asciidoc">Repository</a> or <a href="#guide-dao.asciidoc">DAO</a> method and call this method directly from the batch.
But be careful that this pattern is a simplification which could lead to business logic cluttered in different layers which reduces maintainability of your application.
It is a typical design decision you have to take when designing your specific batches.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="guide-batch-layer.asciidoc_batch-administration-and-execution">Batch administration and execution</h5>
<div class="sect5">
<h6 id="guide-batch-layer.asciidoc_starting-and-stopping-batches">Starting and Stopping Batches</h6>
<div class="paragraph">
<p>Spring Batch provides a simple command line API for execution and parameterization of batches, the <code>CommandLineJobRunner</code>. It is not yet fully compatible with Spring Boot, however. For those using Spring Boot, devonfw provides the <code>SpringBootBatchCommandLine</code> with similar functionalities.</p>
</div>
<div class="paragraph">
<p>Both execute batches as a "simple" standalone process (instantiating a new JVM and creating a new ApplicationContext).</p>
</div>
</div>
<div class="sect5">
<h6 id="guide-batch-layer.asciidoc_starting-a-batch-job">Starting a Batch Job</h6>
<div class="paragraph">
<p>For starting a batch job, the following parameters are required:</p>
</div>
<div class="sect6">
<h7 id="guide-batch-layer.asciidoc_jobpaths">jobPath(s)</h7>
<div class="paragraph">
<p>The location of the JavaConfig classes (usually annotated with <code>@Configuration</code> or <code>@SpringBootApplication</code>) and/or XML files that will be used to create an <code>ApplicationContext</code>.</p>
</div>
<div class="paragraph">
<p>The CommandLineJobRunner only accepts one class/file, which must contain everything needed to run a job (potentially by referencing other classes/files), the SpringBootBatchCommandLine, however, expects that there are two paths given: one for the general batch setup and one for the XML file containing the batch job to be executed.</p>
</div>
<div class="paragraph">
<p>There is an example of a general batch setup for Spring Boot in the <a href="https://github.com/devonfw/my-thai-star/tree/develop/java/mtsj/batch">my-thai-star batch module</a>. The main class is <code>SpringBootBatchApp</code>, which also imports the general configuration class introduced in the chapter on the <a href="#guide-batch-layer.asciidoc_general-configuration">general configuration</a>. Note that <code>SpringBootBatchApp</code> deactivates the evaluation of annotations used for authorization, especially the <code>@RolesAllowed</code> annotation. You should of course make sure that only authorized users can start batches, but once the batch is started there is usually no need to check any authorization.</p>
</div>
</div>
<div class="sect6">
<h7 id="guide-batch-layer.asciidoc_jobname">jobName</h7>
<div class="paragraph">
<p>The name of the job to be run.</p>
</div>
<div class="paragraph">
<p>All arguments after the job name are considered to be job parameters and must be in the format of <code>name=value</code>:</p>
</div>
<div class="paragraph">
<p>Example for the CommandLineJobRunner:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>java org.springframework.batch.core.launch.support.CommandLineJobRunner classpath:config/app/batch/beans-billexport.xml billExportJob -outputFile=file:out.csv date(date)=2015/12/20</pre>
</div>
</div>
<div class="paragraph">
<p>Example for the SpringBootBatchCommandLine:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>java com.devonfw.module.batch.common.base.SpringBootBatchCommandLine com.devonfw.application.mtsj.SpringBootBatchApp classpath:config/app/batch/beans-billexport.xml billExportJob -outputFile=file:out.csv date(date)=2015/12/20</pre>
</div>
</div>
<div class="paragraph">
<p>The date parameter will be explained in the section on <a href="#guide-batch-layer.asciidoc_parameters">parameters</a>.</p>
</div>
<div class="paragraph">
<p>Note that when a batch is started with the same parameters as a previous execution of the same batch job, the new execution is considered a restart, see <a href="#guide-batch-layer.asciidoc_restarts">restarts</a> for further details. Parameters starting with a "-" are ignored when deciding whether an execution is a restart or not (so called non identifying parameters).</p>
</div>
<div class="paragraph">
<p>When trying to restart a batch that was already complete, there will either be an exception (message: <code>"A job instance already exists and is complete for parameters={&#8230;&#8203;}.  If you want to run this job again, change the parameters."</code>) or the batch will simply do nothing (might happen when no or only non identifying parameters are set; in this case the console log contains the following message for every step: <code>"Step already complete or not restartable, so no action to execute: &#8230;&#8203;"</code>).</p>
</div>
</div>
</div>
<div class="sect5">
<h6 id="guide-batch-layer.asciidoc_stopping-a-job">Stopping a Job</h6>
<div class="paragraph">
<p>The command line option to stop a running execution is as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>java org.springframework.batch.core.launch.support.CommandLineJobRunner classpath:config/app/batch/beans-billexport.xml –stop billExportJob</pre>
</div>
</div>
<div class="paragraph">
<p>or</p>
</div>
<div class="listingblock">
<div class="content">
<pre>java com.devonfw.module.batch.common.base.SpringBootBatchCommandLine com.devonfw.application.mtsj.SpringBootBatchApp classpath:config/app/batch/beans-billexport.xml billExportJob –stop</pre>
</div>
</div>
<div class="paragraph">
<p>Note that the job is not shutdown immediately, but might actually take some time to stop.</p>
</div>
</div>
<div class="sect5">
<h6 id="guide-batch-layer.asciidoc_scheduling">Scheduling</h6>
<div class="paragraph">
<p>In real world scheduling of batches is not as simple as it first might look like.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Multiple batches have to be executed in order to achieve complex tasks. If one of those batches fails the further execution has to be stopped and operations should be notified for example.</p>
</li>
<li>
<p>Input files or those created by batches have to be copied from one node to another.</p>
</li>
<li>
<p>Scheduling batch executing could get complex easily (quarterly jobs, run job on first workday of a month, &#8230;&#8203;)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For devonfw we propose the batches themselves should not mess around with details of batch administration.
Likewise your application should not do so.</p>
</div>
<div class="paragraph">
<p>Batch administration should be externalized to a dedicated batch administration service or scheduler.
This service could be a complex product or a simple tool like cron. We propose <a href="http://rundeck.org">Rundeck</a> as an open source job scheduler.</p>
</div>
<div class="paragraph">
<p>This gives full control to operations to choose the solution which fits best into existing administration procedures.</p>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="guide-batch-layer.asciidoc_implementation">10.7.2. Implementation</h4>
<div class="paragraph">
<p>In this chapter we will describe how to properly setup and implement batches.</p>
</div>
<div class="sect4">
<h5 id="guide-batch-layer.asciidoc_main-challenges">Main Challenges</h5>
<div class="paragraph">
<p>At a first glimpse, implementing batches is much like implementing a backend for client processing.
There are, however, some points at which batches have to be implemented totally different. This is especially true if large data volumes are to be processed.</p>
</div>
<div class="paragraph">
<p>The most important points are:</p>
</div>
<div class="sect5">
<h6 id="guide-batch-layer.asciidoc_transaction-handling">Transaction handling</h6>
<div class="paragraph">
<p>For processing request made by clients there is usually one transaction for each request. If anything goes wrong, the transaction is rolled back and all changes are reverted.</p>
</div>
<div class="paragraph">
<p>A naive approach for batches would be to execute a whole batch in one single transaction so that if anything goes wrong, all changes are reverted and the batch could start from scratch. For processing large amounts of data, this is technically not feasible, because the database system would have to be able to undo every action made within this transaction. And the space for storing the undo information needed for this (the so called "undo tablespace") is usually quite limited.</p>
</div>
<div class="paragraph">
<p>So there is a need of short running transactions. To help programmers to do so, Spring Batch offers the so called chunk processing which will be explained <a href="#guide-batch-layer.asciidoc_chunk-processing">here</a>.</p>
</div>
</div>
<div class="sect5">
<h6 id="guide-batch-layer.asciidoc_restarting-batches">Restarting Batches</h6>
<div class="paragraph">
<p>In client processing mode, when an exception occurs, the transaction is rolled back and there is no need to worry about data inconsistencies.</p>
</div>
<div class="paragraph">
<p>This is not true for batches however, due to the fact that you usually can&#8217;t have just one transaction. When an unexpected error occurs and the batch aborts, the system is in a state where the data is partly processed and partly not and there needs to be some sort of plan on how to continue from there.</p>
</div>
<div class="paragraph">
<p>Even if a batch was perfectly reliable, there might be errors that are not under the control of the application, e.g. lost connection to the database, so that there is always a need for being able to restart.</p>
</div>
<div class="paragraph">
<p>The section on <a href="#guide-batch-layer.asciidoc_restarts">restarts</a> describes how to design a batch that is restartable. What&#8217;s important is that a programmer has to invest some time upfront for a batch to be able restart after aborts.</p>
</div>
</div>
<div class="sect5">
<h6 id="guide-batch-layer.asciidoc_exception-handling-in-batches">Exception handling in Batches</h6>
<div class="paragraph">
<p>The problem with exception handling is that a single record can cause a whole batch to fail and many records will remain unprocessed. In contrast to this, in client processing mode when processing fails this usually affects only one user.</p>
</div>
<div class="paragraph">
<p>To prevent this situation, Spring Batch allows to skip data when certain exceptions occur. However, the feature should not be misused in a way that you just skip all exceptions independently of their cause.</p>
</div>
<div class="paragraph">
<p>So when implementing a batch, you should think about what exceptional situations might occur and how to deal with that and weather it is okay to skip those exceptions or not. When an unexpected exception occurs, the batch should still fail so that this exception is not ignored but its causes are analyzed.</p>
</div>
<div class="paragraph">
<p>Another way of handling exceptions in batches is retrying: Simply try to process the data once more and hope that everything works well this time. This approach often works for database problems, e.g. timeouts.</p>
</div>
<div class="paragraph">
<p>The section on <a href="#guide-batch-layer.asciidoc_exception-handling">exception handling</a> explains skipping and retrying in more detail.</p>
</div>
<div class="paragraph">
<p>Note that exceptions are another reason why you should not execute a whole batch in one transaction. If anything goes wrong, you could either rollback the transaction and start the batch from scratch or you could manually revert all relevant changes. Both are not very good solutions.</p>
</div>
</div>
<div class="sect5">
<h6 id="guide-batch-layer.asciidoc_performance-issues">Performance issues</h6>
<div class="paragraph">
<p>In client processing mode, optimizing throughput (and response times) is an important topic as well, of course.</p>
</div>
<div class="paragraph">
<p>However, a performance that is still considered okay for client processing might be problematic for batches as these usually have to process large volumes of data and the time for their execution is usually quite limited (batches are often executed at night when no one is using the application).</p>
</div>
<div class="paragraph">
<p>An example: If processing the data of one person takes a second, this is usually still considered OK for client processing (even though performance could be better). However if a batch has to process the data of 100.000 persons in one night and is not executed with multiple threads, this takes roughly 28 hours, which is by far too much.</p>
</div>
<div class="paragraph">
<p>The section on <a href="#guide-batch-layer.asciidoc_performance-tuning">performance</a> contains some tips on how to deal with performance problems.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="guide-batch-layer.asciidoc_setup">Setup</h5>
<div class="sect5">
<h6 id="guide-batch-layer.asciidoc_database">Database</h6>
<div class="paragraph">
<p>Spring Batch needs some meta data tables for monitoring batch executions and for restoring state for <a href="#guide-batch-layer.asciidoc_restarts">restarts</a>. Detailed description about needed tables, sequences and indexes can be found in <a href="http://docs.spring.io/spring-batch/reference/html/metaDataSchema.html">Spring Batch - Reference Documentation: Appendix B. Meta-Data Schema</a>.</p>
</div>
<div class="paragraph">
<p>It is not recommended to add additional meta data tables, because this easily leads to inconsistencies with what is stored in those tables maintained by Spring Batch.
You should rather try to extract all needed information out of the standard tables in case the standard API (especially <code>JobRepository</code> and <code>JobExplorer</code>, see below) does not fit your needs.</p>
</div>
<div class="sect6">
<h7 id="guide-batch-layer.asciidoc_failure-information">Failure information</h7>
<div class="paragraph">
<p><code>BATCH_JOB_EXECUTION.EXIT_MESSAGE</code> and <code>BATCH_STEP_EXECUTION.EXIT_MESSAGE</code> store a detailed description of how the job exited. In the case of failure, this might include as much of the stack trace as is possible.
<code>BATCH_STEP_EXECUTION_CONTEXT.SHORT_CONTEXT</code> stores a stringified version of the step&#8217;s <code>ExecutionContext</code> (see <a href="#guide-batch-layer.asciidoc_saving-and-restoring-state">saving and restoring state</a>, the rest is stored in a BLOB if needed).
The default length of those columns in the sample schema scripts is <code>2500</code>.</p>
</div>
<div class="paragraph">
<p>It is good to increase the length of those columns as far as the database allows it to make it easier to find out which exception failed a batch (not every exception causes a failure, see <a href="#guide-batch-layer.asciidoc_exception-handling">exception handling</a>). Some JDBC drivers cast CLOBs to string automatically. If this is the case, you can use CLOBs instead.</p>
</div>
</div>
</div>
<div class="sect5">
<h6 id="guide-batch-layer.asciidoc_general-configuration">General Configuration</h6>
<div class="paragraph">
<p>For configuring batches, we recommend not to use annotations (would not work very well for batches) or JavaConfig, but XML, because this makes the whole batch configuration more transparent, as its structure and implementing beans are immediately visible. Moreover the Spring Batch documentation focuses rather on XML based configurations than on JavaConfig.</p>
</div>
<div class="paragraph">
<p>For explanations on how these XML files are build in general, have a look at the <a href="http://docs.spring.io/spring-framework/docs/current/spring-framework-reference/html/beans.html#beans-factory-metadata">spring documentation</a>.</p>
</div>
<div class="paragraph">
<p>There is, however, some general configuration needed for all batches, for which we use JavaConfig, as it is also used for the setup of all other layers. You can find an example of such a configuration in the <code>samples/core</code> project: <code>BeansBatchConfig</code>. In this section, we will explain the most important parts of this class.</p>
</div>
<div class="paragraph">
<p>The <code>jobRepository</code> is used to update the meta data tables.</p>
</div>
<div class="paragraph">
<p>The database type can optionally be set on the <code>jobRepository</code> for correctly handling database specific things using the <code>setDatabaseType</code> method. Possible values are oracle, mysql, postgres etc.</p>
</div>
<div class="paragraph">
<p>If the size of all three columns, which by default have a length limitation of 2500, has been increased as proposed <a href="#guide-batch-layer.asciidoc_failure-information">here</a>, the property maxVarCharLength should be adjusted accordingly using the corresponding setter method in order to actually utilize the additional space.</p>
</div>
<div class="paragraph">
<p>The <code>jobExplorer</code> offers methods for reading from the meta data tables in addition to those methods provided by the <code>jobRepository</code>, e.g. getting the last executions of a batch.</p>
</div>
<div class="paragraph">
<p>The <code>jobLauncher</code> is used to actually start batches.</p>
</div>
<div class="paragraph">
<p>We use our own implementation (<code>JobLauncherWithAdditionalRestartCapabilities</code>) here, which can be found in the module <code>modules/batch</code> (<code>devon4j-batch</code>). It enables a special form of restarting a batch ("restart from scratch", see the section on <a href="#guide-batch-layer.asciidoc_restarts">restarts</a> for further details).</p>
</div>
<div class="paragraph">
<p>The <code>jobRegistry</code> is basically a map, which contains all batch jobs. It is filled by the bean of type <code>JobRegistryBeanPostProcessor</code> automatically.</p>
</div>
<div class="paragraph">
<p>A <code>JobParametersIncremeter</code> (bean <code>incrementer</code>) can be used to generate unique parameters, see <a href="#guide-batch-layer.asciidoc_restarts">restarts</a> and <a href="#guide-batch-layer.asciidoc_parameters">parameters</a> for further details. It should be configured manually for each batch job, see example batch below, otherwise exceptions might occur when starting batches.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="guide-batch-layer.asciidoc_example-batch">Example-Batch</h5>
<div class="paragraph">
<p>As already mentioned, every batch job consists of one or more batch steps, which internally either use chunk processing or tasklet based processing.</p>
</div>
<div class="paragraph">
<p>Our bill export batch job consists of the following to steps:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Read all (not processed) bills from the database, mark them as processed (additional attribute) and write them into a CSV file (to be further processed by other systems). This step is implemented using chunk processing (see <a href="#guide-batch-layer.asciidoc_chunk-processing">chunk processing</a>).</p>
</li>
<li>
<p>Delete all bill from the database which are marked as processed. This step is implemented in a tasklet (see <a href="#guide-batch-layer.asciidoc_tasklet-based-processing">tasklet based processing</a>).</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Note that you could also delete the bills directly. However, for being able to demonstrate tasklet based processing, we have created a separate step here.</p>
</div>
<div class="paragraph">
<p>Also note that in real systems you would usually create a backup of data as important as bills, which is not done here.</p>
</div>
<div class="paragraph">
<p>The <a href="https://github.com/devonfw/my-thai-star/blob/develop/java/mtsj/batch/src/main/resources/config/app/batch/beans-billexport.xml">beans-billexport.xml</a> configures the batch for exporting the bills.</p>
</div>
<div class="paragraph">
<p>As you can see, there is a job element (<code>billExportJob</code>), which contains the two step elements (<code>createCsvFile</code> and <code>deleteBills</code>). Note that for every step you have to explicitly specify which step comes next (using the next attribute), unless it is the last step.</p>
</div>
<div class="paragraph">
<p>The step elements always contains a tasklet element, even if chunk processing is used. The transaction-attributes element is especially used to set timeout of transactions (in seconds). Note that there is usually more than one transaction per step (see below).</p>
</div>
<div class="paragraph">
<p>What follows is either a chunk element with <code>ItemReader</code>, <code>ItemProcessor</code>, <code>ItemWriter</code> and a commit interval (see <a href="#guide-batch-layer.asciidoc_chunk-processing">chunk processing</a>) or the tasklet element containing a reference to a tasklet.</p>
</div>
<div class="paragraph">
<p>In the example above the <code>ItemReader</code> named <code>unprocessedBillsReader</code> always reads 1000 ids of unprocessed bills (via a DAO) and returns them one after another. The <code>ItemProcessor</code> <code>processedMarker</code> reads the corresponding bills from the database (see <a href="#guide-batch-layer.asciidoc_chunk-processing">chunk processing</a> why we do not read them directly in the <code>ItemReader</code>) and marks them as processed. The <code>ItemWriter</code> <code>csvFileWriter</code> (see below on how this writer is configured) writes them to a CSV file. The path of this file is provided as batch parameter (<code>outputFile</code>).</p>
</div>
<div class="paragraph">
<p>The <code>tasklet</code> <code>billsDeleter</code> deletes all processed bills (10.000 in one transaction).</p>
</div>
<div class="paragraph">
<p>The <code>chunkLoggingListener</code>, which is also used in the example above, can be utilized for all chunk steps to log exceptions together with the items where these exceptions occurred (see <a href="#guide-batch-layer.asciidoc_listeners">listeners</a> for further details on listeners). It&#8217;s implementation can be found in the module modules/batch. Note that classes used for items have to have an appropriate <code>toString()</code> method in order for this listener to be useful.</p>
</div>
</div>
<div class="sect4">
<h5 id="guide-batch-layer.asciidoc_restarts">Restarts</h5>
<div class="paragraph">
<p>A batch execution is considered a restart, if it was run already (with the same parameters) and there was a (non skippable) failure or the batch has been stopped.</p>
</div>
<div class="paragraph">
<p>There are basically two ways to do a restart:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Undo all changes and restart from scratch.</p>
</li>
<li>
<p>Restore the state of that batch at the time the error occurred and continue processing.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The first approach has two major disadvantages:
One is that depending on what the batch does, reverting all of its changes can get quite complex. And you easily end up having implemented a batch that is restartable, but not if it fails in the wrong step.</p>
</div>
<div class="paragraph">
<p>The second disadvantage is that if a batch runs for several hours and then it fails it has to start all over again. And as the time for executing batches is usually quite limited, this can be problematic.</p>
</div>
<div class="paragraph">
<p>If reverting all changes is as easy as deleting all files in a given directory or something like that and the expected duration for an execution of the batch is rather short, you might consider the option of always starting at the beginning, otherwise you shouldn’t.</p>
</div>
<div class="paragraph">
<p>Spring Batch supports implementing the second option. By default, if a batch is restarted with the same parameters as a previous execution of this batch, then this new execution continues processing at the step where the last execution was stopped or failed. If the last execution was already complete, an exception is raised.</p>
</div>
<div class="paragraph">
<p>The step itself has to be implemented in a way so that it can restore its internal state, which is the main drawback of this second option.</p>
</div>
<div class="paragraph">
<p>However, there are 'standard implementations' that are capable of doing so and these can easily be adapted to your needs. They are introduced in the section on <a href="#guide-batch-layer.asciidoc_chunk-processing">chunk processing</a>.</p>
</div>
<div class="paragraph">
<p>For instructing Spring Batch to always restart a batch at the very beginning even though there has been an execution of this batch with the same parameters already, set the <code>restartable</code> attribute of the <code>Job</code> element to false.</p>
</div>
<div class="paragraph">
<p>By default, setting this attribute to false means that the batch is not restartable (i.e. it cannot be started with the same parameters once more). It would raise an error if there was attempt to do so, so that it cannot be restarted where it left off.</p>
</div>
<div class="paragraph">
<p>We use our own <code>JobLauncher</code> (<code>JobLauncherWithAdditionalRestartCapabilities</code>) as described in the section on the <a href="#guide-batch-layer.asciidoc_general-configuration">general configuration</a> to modify this behavior so that those batches are always restarted from the first step on by adding an extra parameter (instead of raising an exception), so that you do not have to take care of that yourself. So don&#8217;t think of a batch marked with <code>restartable="false"</code> as a batch that is not restartable (as most people would probably assume just looking at the attribute) but as a batch that restarts always from the first step on.</p>
</div>
<div class="paragraph">
<p>Note that if a batch is restartable by restoring its internal state, it might not work correctly if the batch is started with different parameters after it failed, which usually comes down to the same thing as restating it from scratch. So, the batch has to be restarted and completed successfully before executing the next regular 'run'. When scheduling batches, you should make that sure.</p>
</div>
</div>
<div class="sect4">
<h5 id="guide-batch-layer.asciidoc_chunk-processing">Chunk Processing</h5>
<div class="paragraph">
<p>Chunk processing is item based processing. Items can be bills, persons or whatever needs to be processed. Those items are grouped into chunks of a fixed size and all items within such a chunk are processed in one transaction. There is not one transaction for every single (small) item because there would be too many commits which degrades performance.</p>
</div>
<div class="paragraph">
<p>All items of a chunk are read by an <code>ItemReader</code> (e.g. from a file or from database), processed by an <code>ItemProcessor</code> (e.g. modified or converted) and written out as a whole by an <code>ItemWriter</code> (e.g. to a file or to database).</p>
</div>
<div class="paragraph">
<p>The size of a chunk is also called commit interval. One has to be careful , while choosing a large chunk size: When a skip or retry occurs for a single item (see <a href="#guide-batch-layer.asciidoc_exception-handling">exception handling</a>), the current transaction has to be rolled back and all items of the chunk have to be reprocessed. This is especially a problem when skips and retries occur more often and results in long runtimes.</p>
</div>
<div class="paragraph">
<p>The most important advantages of chunk processing are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>good trade-off between size and number of transactions (configurable via commit size)</p>
</li>
<li>
<p>transaction timeouts that do not have to be adapted for larger amounts of data that needs to be processed (as there is always one transaction for a fixed number of items)</p>
</li>
<li>
<p>an exception handling that is more fain-grained than aborting/restarting the whole batch (item based skipping and retrying, see <a href="#guide-batch-layer.asciidoc_exception-handling">exception handling</a>)</p>
</li>
<li>
<p>logging items where exceptions occurred (which makes failure analysis much more easy)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Note that you could actually achieve similar results using <a href="#guide-batch-layer.asciidoc_tasklet-based-processing">tasklets</a> as described below. However, you would have to write many lines of additional code whereas you get these advantages out of the box using chunk processing (logging exceptions and items where these exceptions occurred is an extension, see <a href="#guide-batch-layer.asciidoc_example-batch">example batch</a>).</p>
</div>
<div class="paragraph">
<p>Also note that items should not be too "big". For example, one might consider processing all bills within one month as one item. However, doing so you would not have those advantages any more. For instance, you would have larger transactions, as there are usually quite a lot of bills per month or payment method and if an exception occurs, you would not know which bill actually caused the exception. Additionally you would lose control of commit size, since one commit would process many bills hard coded and you cannot choose smaller chuncks.</p>
</div>
<div class="paragraph">
<p>Nevertheless, there are sometimes, situations where you cannot further "divide" items, e.g. when these are needed for one single call to an external system (e.g. for creating a PDF of all bills within a certain month, if PDFs are created by an external system). In this case you should do as much of the processing as possible on the basis of "small" items and then add an extra step to do what cannot be done based on these "small" items.</p>
</div>
<div class="sect5">
<h6 id="guide-batch-layer.asciidoc_itemreader">ItemReader</h6>
<div class="paragraph">
<p>A reader has to implement the <code>ItemReader</code> interface, which has the following method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public T read() throws Exception;</code></pre>
</div>
</div>
<div class="paragraph">
<p>T is a type parameter of the <code>ItemReader</code> interface to be replaced with the type of items to be read.</p>
</div>
<div class="paragraph">
<p>The method returns all items (one at a time) that need to be processed or null if there are no more items.</p>
</div>
<div class="paragraph">
<p>If an exception occurs during read, Spring Batch cannot tell which item caused the exception (as it has not been read yet). That is why a reader should contain as little processing logic as possible, minimizing the potential for failures.</p>
</div>
<div class="sect6">
<h7 id="guide-batch-layer.asciidoc_caching">Caching</h7>
<div class="paragraph">
<p>By default, all items read by an <code>ItemReader</code> are cached by Spring Batch. This is useful because when a skippable exception occurs during processing of a chunk, all items (or at least those, that did not cause the exception) have to be reprocessed. These items are not read twice but taken from the cache then.</p>
</div>
<div class="paragraph">
<p>This is often necessary, because if a reader saves it&#8217;s current state in member variables (e.g. the current position within a list of items) or uses some sort of cursor, these will be updated already and the next calls of the read method would deliver the next items ready and not those that have to be reprocessed.</p>
</div>
<div class="paragraph">
<p>However this also means that when the items read by an <code>ItemReader</code> are entities, these might be detached, because these might have been read in a different transaction. In some standard implementations Spring Batch even manually detaches entities in <code>ItemReaders</code>.</p>
</div>
<div class="paragraph">
<p>In case these entities are to be modified it is a good practice that the <code>ItemReader</code> only reads IDs and the <code>ItemProcessor</code> loads the entities for these IDs to avoid the problem.</p>
</div>
</div>
<div class="sect6">
<h7 id="guide-batch-layer.asciidoc_reading-from-transactional-queues">Reading from Transactional Queues</h7>
<div class="paragraph">
<p>In case the reader reads from a transactional queue (e.g. using JMS), you must not use caching, because then an item might get processed twice: Once from cache and once from queue to where it has been returned after the rollback. To achieve this, set <code>reader-transactional-queue="true"</code> in the chunk element in the step definition.</p>
</div>
<div class="paragraph">
<p>Moreover the <code>equals</code> and <code>hashCode</code> methods of the class used for items have to be appropriately implemented for Spring Batch to be able to identify items that were processed before unsuccessfully (causing a rollback and thereby returning them to the queue). Otherwise the batch might be caught in an infinite loop trying to process the same item over and over again (e.g. when the item is about to be skipped, see <a href="#guide-batch-layer.asciidoc_exception-handling">exception handling</a>).</p>
</div>
</div>
<div class="sect6">
<h7 id="guide-batch-layer.asciidoc_reading-from-the-database">Reading from the Database</h7>
<div class="paragraph">
<p>When selecting data from a database, there is usually some sort of cursor used. One challenge is to make this cursor not participate in the chunk&#8217;s transaction, because it would be closed after the first chunk.</p>
</div>
<div class="paragraph">
<p>We will show how to use JDBC based cursors for <code>ItemReader</code> implementations in later releases of this documentation.</p>
</div>
<div class="paragraph">
<p>For JPA/JPQL based queries, cursors cannot be used, because JPA does not know of the concept of a cursor. Instead it supports pagination as introduced in the chapter on the data access layer, which can be used for this purpose as well. Note that pagination requires the result set to be sorted in an unambiguous order to work reliably. The order itself is irrelevant as long as it does not change (you can e.g. sort the entities by their primary key).</p>
</div>
<div class="paragraph">
<p>An <code>ItemReader</code> using pagination should inherit from the <code>AbstractPagingItemReader</code>, which already provides most of the needed functionality. It manages the internal state, i.e. the current position, which can be correctly restored after a restart (when using an unambiguous order for the result set).</p>
</div>
<div class="paragraph">
<p>Classes inheriting from <code>AbstractPagingItemReader</code> must implement two methods.</p>
</div>
<div class="paragraph">
<p>The method <code>doReadPage()</code> performs the actual read of a page. The result is not returned (return type is void) but used to replace the content of the 'results' instance variable (type: List).</p>
</div>
<div class="paragraph">
<p>Due to our layering concept and the persistence layer being the only place where access to the database should take place, you should not directly execute a query in this method, but call a DAO, which itself executes the query (using pagination).</p>
</div>
<div class="paragraph">
<p><code>AbstractPagingItemReader</code> provides methods for finding out the current position: use <code>getPage()</code> for the current page and <code>getPageSize()</code> for the (max.) page size. These values should be passed to the DAO as parameters. Note that the <code>AbstractPagingItemReader</code> starts counting pages from zero, whereas the <code>PaginationTo</code> used for pagination (retrieved by calling <code>SearchCriteriaTo.getPagination()</code>) starts counting from one, which is why you always have to increment the page number by one.</p>
</div>
<div class="paragraph">
<p>The second method is <code>doJumpToPage(int)</code>, which usually only requires an empty implementation.</p>
</div>
<div class="paragraph">
<p>Furthermore, you need to set the property <code>pageSize</code>, which specifies how many items should be read at once. A page size that is as big as the commit interval usually results in the best performance.</p>
</div>
<div class="paragraph">
<p>The approach of using pagination for <code>ItemReader</code> should not be used when items (usually entities) are added or removed or modified by the batch step itself or in parallel with the execution of the batch step so that the order changes, e.g. by other batches or due to operations started by clients (i.e. if the batch is executed in online mode). In this case there might be items processed twice or not processed at all. Be aware that due to hibernate&#8217;s Hi/Lo-Algorithm newer entities could get lower IDs than existing IDs and you probably will not process all entities if you rely on strict ID monotony!</p>
</div>
<div class="paragraph">
<p>A simple solution for such scenarios would be to introduce a new flag 'processed' for the entities read if that is an option (as it is also done in the example batch). The query should be rewritten then so that only unprocessed items are read (additionally limiting the result set size to the number of items to be processed in the current chunk, but not more).</p>
</div>
<div class="paragraph">
<p>Note that most of the standard implementations provided by Spring Batch do not fit to the layering approach in devonfw applications, as these mostly require direct access to an <code>EntityManager</code> or a JDBC connection for example.  You should think twice when using them and not break the layering concept.</p>
</div>
</div>
<div class="sect6">
<h7 id="guide-batch-layer.asciidoc_reading-from-files">Reading from Files</h7>
<div class="paragraph">
<p>For reading simply structured files, e.g. for those in which every line corresponds to an item to be processed by the batch, the <code>FlatFileItemReader</code> can be used. It requires two properties to be set: The first one the <code>LineMapper</code> (property <code>lineMapper</code>), which is used to convert a line (i.e. a String) to an item. It is a very simple interface which will not be discussed in more detail here. The second one is the resource, which is actually the file to be read. When set in the XML, it is sufficient to specify the path with a "file:" in front of it if it is a normal file from the file system.</p>
</div>
<div class="paragraph">
<p>In addition to that, the property <code>linesToSkip</code> (integer) can be set to skip headers for example. For reading more than one line before for creating an item, a <code>RecordSeparatorPolicy</code> can be used, which will not be discussed in more detail here, too. By default, all lines starting with a '#' will be considered to be a comment, which can be changed by changing the comment property (string array). The encoding property can be used to set the encoding. A <code>FlatFileItemReader</code> can restore its state after restarts.</p>
</div>
<div class="paragraph">
<p>For reading XML files, you can use the <code>StaxEventItemReader</code> (StAX is an alternative to DOM and SAX), which will not be discussed in further detail here.</p>
</div>
<div class="paragraph">
<p>In case the standard implementations introduced here do not fit your needs, you will need to implement your own <code>ItemReader</code>. If this <code>ItemReader</code> has some internal state (usually stored in member variables), which needs to be restored in case of restarts, see the section on <a href="#guide-batch-layer.asciidoc_saving-and-restoring-state">saving and restoring state</a> for information on how to do this.</p>
</div>
</div>
</div>
<div class="sect5">
<h6 id="guide-batch-layer.asciidoc_itemprocessor">ItemProcessor</h6>
<div class="paragraph">
<p>A processor must implement the <code>ItemProcessor</code> interface, which has the following method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public O process(I item) throws Exception;</code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see, there are two type parameters involved: one for the type of items received from the <code>ItemReader</code> and one for the type of items passed to the <code>ItemWriter</code>. These can be the same.</p>
</div>
<div class="paragraph">
<p>If an item has been selected by the <code>ItemReader</code>, but there is no need to further process this item (i.e. it should not be passed to the <code>ItemWriter</code>), the <code>ItemProcessor</code> can return null instead of an item.</p>
</div>
<div class="paragraph">
<p>Strictly interpreting chunk processing, the <code>ItemProcessor</code> should not modify anything but should only give instructions to the <code>ItemWriter</code> on how to do modifications. For entities however this is not really practical and as it requires no special logic in case of rollbacks/restarts (as all modifications are transactional), it is usually OK to modify them directly.</p>
</div>
<div class="paragraph">
<p>In contrast to this, performing accesses to files or calling external systems should only be done in <code>ItemReader</code>/<code>ItemWriter</code> and the code needed for properly handling failures (restarts for example) should be encapsulated there.</p>
</div>
<div class="paragraph">
<p>It is usually a good practice to make <code>ItemProcessor</code> implementations stateless, as the process method might be called more than once for one item (see the section on <code>ItemReader</code> why). If your ItemProcessor really needs to have some internal state, see <a href="#guide-batch-layer.asciidoc_saving-and-restoring-state">saving and restoring state</a> on how to save and restore the state for restarts.</p>
</div>
<div class="paragraph">
<p>Do not forget to implement use cases instead of implementing everything directly in the ItemProcessor if the processing logic gets more complex.</p>
</div>
</div>
<div class="sect5">
<h6 id="guide-batch-layer.asciidoc_itemwriter">ItemWriter</h6>
<div class="paragraph">
<p>A writer has to implement the ItemWriter interface, which has the following method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public void write(List&lt;? extends T&gt; items) Exception;</code></pre>
</div>
</div>
<div class="paragraph">
<p>This method is called at the end of each chunk with a list of all (processed) items. It is not called once for every item, because it is often more efficient doing 'bulk writes', e.g. when writing to files.</p>
</div>
<div class="paragraph">
<p>Note that this method might also be called more than once for one item (see the section on ItemReader&#8217;s why).</p>
</div>
<div class="paragraph">
<p>At the end of the write method, there should always be a flush.</p>
</div>
<div class="paragraph">
<p>When writing to files, this should be obvious, because when a chunks completes, it is expected that all changes are already there in case of restarts, which is not true if these changes were only buffered but have not been written out.</p>
</div>
<div class="paragraph">
<p>When modifying the database, the flush method on the <code>EntityManager</code> should be called, too (via a DAO), because there might be changes not written out yet and therefore constraints were not checked yet. This can be problematic, because Spring Batch considers all exceptions that occur during commit as critical, which is why these exceptions cannot be skipped. You should be careful using deferred constraints for the same reason.</p>
</div>
<div class="sect6">
<h7 id="guide-batch-layer.asciidoc_writing-to-database-or-transactional-queues">Writing to Database or Transactional Queues</h7>
<div class="paragraph">
<p>All changes made which are transactional can be conducted directly, there is no special logic needed for restarts, because these changes are applied if and only if the chunk succeeds.</p>
</div>
</div>
<div class="sect6">
<h7 id="guide-batch-layer.asciidoc_writing-to-files">Writing to Files</h7>
<div class="paragraph">
<p>For writing simply structured files, the <code>FlatFileItemWriter</code> can be used. Similar to the FlatFileItemReader it requires the resource (i.e. the file) and a <code>LineAggregator</code> (property <code>lineAggregator</code> instead of the <code>lineMapper</code>) to be set.</p>
</div>
<div class="paragraph">
<p>There are various properties that can be used of which we will only present the most important ones here. As with the FlatFileItemReader, the encoding property is used to set the encoding. A FlatFileHeaderCallback (property headerCallback) can be used to write a header.</p>
</div>
<div class="paragraph">
<p>The <code>FlatFileItemWriter</code> can restore its state correctly after restarts. In case, the files contain too many lines (written out in chunks that did not complete successfully), these lines are removed before continuing execution.</p>
</div>
<div class="paragraph">
<p>For writing XML files, you can use the <code>StaxEventItemWriter</code>, which will not be discussed in further detail here.</p>
</div>
<div class="paragraph">
<p>Just as with <code>ItemReader</code> and <code>ItemProcessor</code>: In case your <code>ItemWriter</code> has some internal state this state is not managed by a standard implementation, see <a href="#guide-batch-layer.asciidoc_saving-and-restoring-state">saving and restoring state</a> on how to make your implementation restartable (restart by restoring the internal state).</p>
</div>
</div>
</div>
<div class="sect5">
<h6 id="guide-batch-layer.asciidoc_saving-and-restoring-state">Saving and Restoring State</h6>
<div class="paragraph">
<p>For saving and restoring (in case of restarts) state, e.g. saving and restoring values of member variables, the ItemStream interface should be implemented by the <code>ItemReader</code>/<code>ItemProcessor</code>/<code>ItemWriter</code>, which has the following methods:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public void open(ExecutionContext executionContext) throws ItemStreamException;
public void update(ExecutionContext executionContext) throws ItemStreamException;
public void close() throws ItemStreamException;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The open method is always called before the actual processing starts for the current step and can be used to restore state when restarting.</p>
</div>
<div class="paragraph">
<p>The <code>ExecutionContext</code> passed in as parameter is basically a map to be used to retrieve values set before the failure. The method <code>containsKey(String)</code> can be used to check if a value for a given key is set. If it is not set, this might be because the current batch execution is no restart or no value has been set before the failure.</p>
</div>
<div class="paragraph">
<p>There are several getter methods for actually retrieving a value for a given key: <code>get(String)</code> for objects (must be serializable), <code>getInt(String)</code>, <code>getLong(String)</code>, <code>getDouble(String)</code> and <code>getString(String)</code>. These values will be the same as after the subsequent call to the update method after the last chunk that completed successfully. Note that if you update the ExecutionContext outside of the update method (e.g. in the read method of an <code>ItemReader</code>), it might contain values set in chunks that did not finish successfully after restarts, which is why you should not do that.</p>
</div>
<div class="paragraph">
<p>So the update method is the right place to update the current state. It is called after each chunk (and before and after each step).</p>
</div>
<div class="paragraph">
<p>For setting values, there are several put methods: <code>put(String, Object)</code>, <code>putInt(String, int)</code>, <code>putLong(String, long)</code>, <code>putDouble(String, double)</code> and <code>putString(String, String)</code>. You can choose keys (<code>String</code>) freely as long as these are unique within the current step.</p>
</div>
<div class="paragraph">
<p>Note that when a skip occurs, the update method is sometimes but not always called, so you should design your code in a way that it can deal with both situations.</p>
</div>
<div class="paragraph">
<p>The close method is usually not needed.</p>
</div>
<div class="paragraph">
<p>Do not misuse the ItemStream interface for purposes other than storing/restoring state. For instance, do not use the update method for flushing, because you will not have the chance to properly handle failure (e.g. skipping). For opening or closing a file handle, you should rather use a StepExecutionListener as introduced in the section on <a href="#guide-batch-layer.asciidoc_listeners">listeners</a>. The state can also be restored in the beforeStep(ExecutionListener) method (instead of the open method).</p>
</div>
<div class="paragraph">
<p>Note that when a batch that always starts from scratch (i.e. the restartable attribute has been set to false for the batch job) is restarted, the ExecutionContext will not contain any state from the previous (failed) execution, so there is no use in storing the state in this case and usually no need to, of course, because the batch will start all over again.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="guide-batch-layer.asciidoc_tasklet-based-processing">Tasklet based Processing</h5>
<div class="paragraph">
<p>Tasklets are the alternative to chunk processing. In the section on <a href="#guide-batch-layer.asciidoc_chunk-processing">chunk processing</a> we already mentioned the advantages of chunk processing as compared to tasklets. However, if only very few data needs to be processed (within one transaction) or if you need to do some sort of bulk operation (e.g. deleting all records from a database table), where the currently processed item does not matter and it is unlikely that a 'fine grained' exception handling will be needed, tasklets might still be considered an option. Note that for the latter use case you should still use more than one transaction, which is possible when using tasklets, too.</p>
</div>
<div class="paragraph">
<p>Tasklets have to implement the interface with the same name, which has the following method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public RepeatStatus execute(StepContribution contribution, ChunkContext chunkContext) throws Exception;</code></pre>
</div>
</div>
<div class="paragraph">
<p>This method might be called several times. Every call is executed inside a new transaction automatically. If processing is not finished yet and the execute method should be called once more, just use RepeatStatus.CONTINUABLE as return value and <code>RepeatStatus.FINISHED</code> otherwise.</p>
</div>
<div class="paragraph">
<p>The <code>StepContribution</code> parameter can be used to set how many items have been processed manually (which is done automatically using chunk processing), there is, however, usually no need to do so.</p>
</div>
<div class="paragraph">
<p>The ChunkContext is similar to the <code>ExecutionContext</code>, but is only used within one chunk. If there is a retry in chunk processing, the same context should be used (with the same state that this context had when the exception occurred).</p>
</div>
<div class="paragraph">
<p>Note that tasklets serve as the basis for chunk processing internally. For chunk processing there is a Spring Batch internal tasklet, which has an execute method that is called for every chunk and itself calls <code>ItemReader</code>, <code>ItemProcessor</code> and <code>ItemWriter</code>.</p>
</div>
<div class="paragraph">
<p>That is the reason why a <code>StepContribution</code> and a <code>ChunkContext</code> are passed to tasklets as parameters, even though they are more useful in chunk processing. Moreover this is also the reason why you have to use the tasklet element in the XML even though you want to specify a step that uses chunk processing (see <a href="#guide-batch-layer.asciidoc_example-batch">the example batch</a>).</p>
</div>
</div>
<div class="sect4">
<h5 id="guide-batch-layer.asciidoc_exception-handling">Exception Handling</h5>
<div class="paragraph">
<p>As already mentioned, in chunk processing you can configure a step so that items are skipped or retried when certain exceptions occur.</p>
</div>
<div class="paragraph">
<p>If retries are exhausted (by default, there is no retry) and the exception that occurred cannot be skipped (by default, no exception can be skipped), the batch will fail (i.e. stop executing).</p>
</div>
<div class="paragraph">
<p>In tasklet based processing this cannot be done, the only chance is to implement the needed logic yourself.</p>
</div>
<div class="sect5">
<h6 id="guide-batch-layer.asciidoc_skipping">Skipping</h6>
<div class="paragraph">
<p>Before skipping items you should think about what to do if a skip occurs. If a skip occurs, the exception will be logged in the server log. However if no one evaluates those logs on a regular basis and informs those who are affected further actions need to take place when implementing the batch.</p>
</div>
<div class="paragraph">
<p>Implement the <code>SkipListener</code> interface to be informed when a skip occurs. For example, you could store a notification or send a message to someone. For skips that occurred in ItemReader&#8217;s there is no information available about the item that was skipped (as it has not been read yet) which is why there should be as little processing logic as possible in an <code>ItemReader</code>. It might also be a reason why you might want to forbid  to skip exceptions that might occur in readers.</p>
</div>
<div class="paragraph">
<p>Do not try to catch skipped exceptions and write something into the database in a new transaction (e.g. a notification) instead of using a SkipListener, because a skipped item might be processed more than once before actually being skipped (for example, if a skippable exception is thrown during a call of an <code>ItemWriter</code>, Spring Batch does not know which item of the current chunk actually caused the exception and therefore has to retry each item separately in order to know which item actually caused the exception).</p>
</div>
<div class="paragraph">
<p>Skippable exception classes can be specified as shown below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">      &lt;batch:chunk ... skip-limit="10"&gt;
         &lt;batch:skippable-exception-classes&gt;
            &lt;batch:include class="..."/&gt;
            &lt;batch:include class="..."/&gt;
            ...
         &lt;/batch:skippable-exception-classes&gt;
      &lt;/batch:chunk&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The attribute skip-limit, which has to be set in case there is any skippable exception class configured, is used to set how many items should be skipped at most. It is useful to avoid situations where many items are skipped but the batch still completes successfully and no one notices this situation.</p>
</div>
<div class="paragraph">
<p>Skippable exception classes are specified by their fully qualified name (e.g. <code>java.lang.Exception</code>), each of such class set in its own include element as shown above. Subclasses of such classes are also skipped.</p>
</div>
<div class="paragraph">
<p>To programmatically decide whether to skip an exception or not, you can set a skip policy as shown below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;batch:chunk ... skip-policy="mySkipPolicy"&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The skip policy (here <code>mySkipPolicy</code>) has to be a bean that implements the interface <code>SkipPolicy</code> with the following method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public boolean shouldSkip(java.lang.Throwable t,
                   int skipCount)
            throws SkipLimitExceededException</code></pre>
</div>
</div>
<div class="paragraph">
<p>To skip the exception and continue processing, just return true and otherwise false.</p>
</div>
<div class="paragraph">
<p>The parameter <code>skipCount</code> can be used for a skip limit. A <code>SkipLimitExceededException</code> should be thrown if there should be no more skips. Note that this method is sometimes called with a skipCount less than zero to test if an exception is skippable in general.</p>
</div>
<div class="paragraph">
<p>When a <code>SkipPolicy</code> is set, the attribute <code>skip-limit</code> and element <code>skippable-exception-classes</code> are ignored.</p>
</div>
<div class="paragraph">
<p>You could of course skip every exception (using <code>java.lang.Exception</code> as skippable exception class). This is, however, not a good practice as it might easily result in an error in the code that is ignored as the batch still completes successfully and everything seems to be fine. Instead, you should think about what kind of exceptions might actually occur, what to do if they occur and if it is OK to skip them. If an unexpected exception occurs, it is usually better to fail the batch execution and analyze the cause of the exception before restarting the batch.</p>
</div>
<div class="paragraph">
<p>Exceptions that can occur in instances of <code>ItemWriter</code> that write something to file should not be skipped unless the <code>ItemWriter</code> can properly deal with that. Otherwise there might be data written out even though the according item is skipped, because operations in the file systems are not transactional.</p>
</div>
<div class="paragraph">
<p>Another situation where skips can be problematic is when calls to external interfaces are being made and these calls change something "on the other side", as these calls are usually not transactional. So be careful using skips here, too.</p>
</div>
</div>
<div class="sect5">
<h6 id="guide-batch-layer.asciidoc_retrying">Retrying</h6>
<div class="paragraph">
<p>For some types of exceptions, processing should be retried independently of weather the exception can be skipped or would otherwise fail the batch execution.</p>
</div>
<div class="paragraph">
<p>For example, if there was a database timeout, this might be because there were too many requests at the time the chunk was processed. And it is not unlikely that retrying to successfully complete the chunk would succeed.</p>
</div>
<div class="paragraph">
<p>There are, of course, also exceptions where retrying does not make much sense. E.g. exceptions caused by the business logic should be deterministic and therefore retrying does not make much sense in this case.</p>
</div>
<div class="paragraph">
<p>Nevertheless, retrying every exception results in longer runtime but should in general be considered OK if you do not know which exceptions might occur or do not have the time to think about it.</p>
</div>
<div class="paragraph">
<p>Retryable exception classes can be set similarly to setting skippable exception classes:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">      &lt;batch:chunk ... retry-limit="3"&gt;
         &lt;batch:retryable-exception-classes&gt;
            &lt;batch:include class="..."/&gt;
            &lt;batch:include class="..."/&gt;
            ...
         &lt;/batch:retryable-exception-classes&gt;
      &lt;/batch:chunk&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>retry-limit</code> attribute specifies how many times one individual item can be retried, as long as the exception thrown is "retryable".</p>
</div>
<div class="paragraph">
<p>As with skippable exception classes, retryable exception classes are set in include elements and their subclasses are retried, too.</p>
</div>
<div class="paragraph">
<p>To programmatically decide, whether to retry an exception or not, you can use a <code>RetryPolicy</code>, which is not covered in more detail here.</p>
</div>
<div class="paragraph">
<p>Note that even if no retry is configured, an item might nevertheless be processed more than once. This is because if a skippable exception occurs in a chunk, all items of the chunk that did not cause the exception have to reprocessed, which is done in a separate transaction for every item, as the transaction in which these items were processed in the first place was rolled back. And even if the exception is not skippable, there is no guarantee that Spring Batch will not attempt to reprocess each item separately.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="guide-batch-layer.asciidoc_listeners">Listeners</h5>
<div class="paragraph">
<p>Spring Batch provides various listeners for various events to be notified about.</p>
</div>
<div class="paragraph">
<p>For every listener there is an interface which can either be implemented by an ItemReader, ItemProcessor, ItemWriter or Tasklet or by a separate listener class, which can be registered for a step like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">    &lt;batch:tasklet&gt;
        &lt;batch:chunk .../&gt;
        &lt;batch:listeners&gt;
            &lt;batch:listener ref="listener1"/&gt;
            &lt;batch:listener ref="listener2"/&gt;
            ....
        &lt;/batch:listeners&gt;
    &lt;/batch:tasklet&gt;
    &lt;beans:bean id="listener1" class=".."/&gt;
    &lt;beans:bean id="listener2" class=".."/&gt;
    ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>The most commonly use listener is probably the <code>StepExecutionListener</code>, which has methods that are called before and after the execution of the step. It can be utilized e.g. for opening and closing files.</p>
</div>
<div class="paragraph">
<p>The following example shows how to use the listener:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class MyListener implements StepExecutionListener {

	public void beforeStep(StepExecution stepExecution) {
		// take actions before processing of the step starts
	}

	public ExitStatus afterStep(StepExecution stepExecution) {
		try {
			// take actions after processing is finished
		} catch (Exception e) {
			stepExecution.addFailureException(e);
			stepExecution.setStatus(BatchStatus.FAILED);
			return ExitStatus.FAILED.addExitDescription(e);
		}
		return null;
	}

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the <code>afterStep(StepExecution)</code> method, you can check the outcome of the batch execution (completed, failed, stopped etc.) checking the <code>ExitStatus</code>, which can be accessed via <code>StepExecution.getExitStatus()</code>. You can even modify the <code>ExitStatus</code> by returning a new <code>ExitStatus</code>, which is something we will not discuss in further detail here. If you do not want to modify the <code>ExitStatus</code>, just return null.</p>
</div>
<div class="paragraph">
<p>Throwing an exception in this method has no effect. If you want to fail the whole batch in case an exception occurs, you have to do an exception handling as shown above. This does not apply to the <code>beforeStep</code> method.</p>
</div>
<div class="paragraph">
<p>For other types of listeners (among others the <code>SkipListener</code> mentioned already) see <a href="http://docs.spring.io/spring-batch/reference/html/configureStep.html#interceptingStepExecution">Spring Batch Reference Documentation - 5. Configuring a Step - Intercepting Step Execution</a>.</p>
</div>
<div class="paragraph">
<p>Note that exception handling for listeners is often a problem, because exceptions are mostly ignored, which is not always documented very well. If an important part of a batch is implemented in listener methods, you should always test what happens when exceptions occur. Or you might think about not implementing important things in listeners &#8230;&#8203;</p>
</div>
<div class="paragraph">
<p>If you want an exception to fail the whole batch, you can always wrap it in a <code>FatalStepExecutionException</code>, which will stop the execution.</p>
</div>
</div>
<div class="sect4">
<h5 id="guide-batch-layer.asciidoc_parameters">Parameters</h5>
<div class="paragraph">
<p>The section on <a href="#guide-batch-layer.asciidoc_starting-and-stopping-batches">starting and stopping batches</a> already showed how to start a batch with parameters.</p>
</div>
<div class="paragraph">
<p>One way to get access to the values set is using the <code>StepExecutionListener</code> introduced in the section on <a href="#guide-batch-layer.asciidoc_listeners">listeners</a> like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public void beforeStep(StepExecution stepExecution) {

	String parameterValue = stepExecution.getJobExecution().getJobParameters().
		getString("parameterKey");
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>There are getter methods for strings, doubles, longs and dates. Note that when set via the <code>CommandLineJobRunner</code> or <code>SpringBootBatchCommandLine</code>, all parameters will be of type string unless the type is specified in brackets after the parameter key, e.g. <code>processUntil(date)=2015/12/31</code>. The parameter key here is <code>processUntil</code>.</p>
</div>
<div class="paragraph">
<p>Another way is to inject values. In order for this to work, the bean has to have step scope, which means there is a new object created for every execution of a batch step. It works like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;bean id="myProcessor" class="...MyItemProcessor" scope="step"&gt;
	&lt;property name="parameter" value="#{jobParameters['parameterKey']}" /&gt;
&lt;bean&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>There has to be an appropriate setter method for the parameter of course.</p>
</div>
<div class="paragraph">
<p>As already mentioned in the section on <a href="#guide-batch-layer.asciidoc_restarts">restarts</a>, a batch that successfully completed with a certain set of parameters cannot be started once more with the same parameters as this would be considered a restart, which is not necessary, because the batch was already finished.</p>
</div>
<div class="paragraph">
<p>So using no parameters for a batch would mean that it can be started until it completes successfully once, which usually does not make much sense.</p>
</div>
<div class="paragraph">
<p>As batches are usually not executed more than once a day, we propose introducing a general <code>date</code> parameter (without time) for all batch executions.</p>
</div>
<div class="paragraph">
<p>It is advisable to add the date parameter automatically in the <code>JobLauncher</code> if it has not been set manually, which can be done as shown below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">private static final String DATE_PARAMETER = "date";

...

if (jobParameters.getDate("DATE_PARAMETER") == null) {

	Date dateWithoutTime = new Date();
	Calendar cal = Calendar.getInstance();
	cal.setTime(dateWithoutTime);
	cal.set(Calendar.HOUR_OF_DAY, 0);
	cal.set(Calendar.MINUTE, 0);
	cal.set(Calendar.SECOND, 0);
	cal.set(Calendar.MILLISECOND, 0);
	dateWithoutTime = cal.getTime();

	jobParameters = new JobParametersBuilder(jobParameters).addDate(
		DATE_PARAMETER, dateWithoutTime).toJobParameters();

	... // using the jobParametersIncrementer as shown above
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Keep in mind that you might need to set the date parameter explicitly for restarts. Also note that automatically setting the date parameter can be problematic if a batch is sometimes started before and sometimes after midnight, which might result in a batch not being executed (as it has already been executed with the same parameters), so at least for productive systems you should always set it explicitly.</p>
</div>
<div class="paragraph">
<p>The date parameters can also be useful for controlling the business logic, e.g. a batch can process all data that was created until the current date (as set in the date parameter), thereby giving a chance to control how much is actually processed.</p>
</div>
<div class="paragraph">
<p>If your batch has to run more than once a day you could easily adapt the concept of timestamps. If you are using an external batch scheduler, they often provide a counter for the execution and you might automatically pass this instead of the date parameter.</p>
</div>
</div>
<div class="sect4">
<h5 id="guide-batch-layer.asciidoc_performance-tuning">Performance Tuning</h5>
<div class="paragraph">
<p>Most important for performance are of course the algorithms that you write and how fast (and scalable) these are, which is the same as for client processing. Apart from that, the performance of batches is usually closely related to the performance of the database system.</p>
</div>
<div class="paragraph">
<p>If you are retrieving information from the database, you can have one complex query executed in the <code>ItemReader</code> (via a DAO) retrieving all the information needed for the current set of items, or you can execute further queries in the <code>ItemProcessor</code> (or <code>ItemWriter</code>) on a per item basis to retrieve further information.</p>
</div>
<div class="paragraph">
<p>The first approach is usually by far more performant, because there is an overhead for every query being executed and this approach results in less queries being executed. Note that there is a tradeoff between performance and maintainability here. If you put everything into the query executed by an <code>ItemReader</code>, this query can get quite complex.</p>
</div>
<div class="paragraph">
<p>Using cursors instead of pagination as described in the section on <a href="#guide-batch-layer.asciidoc_itemreader">ItemReaders</a> can result in a better performance for the same reason: When using a cursor, the query is only executed once, when using pagination, the query is usually executed once per chunk. You could of course manually cache items, however this easily leads to a high memory consumption.</p>
</div>
<div class="paragraph">
<p>Further possibilities for optimizations are query (plan) optimization and adding missing database indexes.</p>
</div>
</div>
<div class="sect4">
<h5 id="guide-batch-layer.asciidoc_testing">Testing</h5>
<div class="paragraph">
<p>The Section <a href="#guide-testing.asciidoc">Testing</a> covers how to unit and integration test in detail. Therefore we focus here on testing batches.</p>
</div>
<div class="paragraph">
<p>In order for the unit test to run a batch job the unit test class must extend the <code>AbstractSpringBatchIntegrationTest</code> class. Annotation used to load the job&#8217;s <code>ApplicationContext</code>:</p>
</div>
<div class="paragraph">
<p><code>@SpringBootTest(classes = {&#8230;&#8203;})</code>: Indicates which JavaConfig classes (attribute <code>classes</code>)
<code>@ImportResource("classpath:../sample_BatchContext.xml") : Indicates XML files that contain the `ApplicationContext</code>. Use <code>@ContextConfiguration(&#8230;&#8203;)</code> if Spring Boot is not used.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public abstract class AbstractSpringBatchIntegrationTest extends AbstractComponentTest {..}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@SpringBootTest(classes = { SpringBootBatchApp.class }, webEnvironment = WebEnvironment.RANDOM_PORT)
@ImportResource("classpath:config/app/batch/beans-productimport.xml")
@EnableAutoConfiguration
public class ProductImportJobTest extends AbstractSpringBatchIntegrationTest {..}</code></pre>
</div>
</div>
<div class="sect5">
<h6 id="guide-batch-layer.asciidoc_testing-batch-jobs">Testing Batch Jobs</h6>
<div class="paragraph">
<p>For testing the complete run of a batch job from beginning to end involves following steps:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>set up a test condition</p>
</li>
<li>
<p>execute the job</p>
</li>
<li>
<p>verify the end result.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The test method below begins by setting up the database with test data. The test then launches the Job using the <code>launchJob()</code> method. The <code>launchJob()</code> method is provided by the <code>JobLauncherTestUtils</code> class.</p>
</div>
<div class="paragraph">
<p>Also provided by the utils class is <code>launchJob(JobParameters)</code>, which allows the test to give particular parameters. The <code>launchJob()</code> method returns the <code>JobExecution</code> object which is useful for asserting particular information about the Job run. In the case below, the test verifies that the Job ended with <code>ExitStatus</code> <code>COMPLETED</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@SpringBootTest(classes = { SpringBootBatchApp.class }, webEnvironment = WebEnvironment.RANDOM_PORT)
@ImportResource("classpath:config/app/batch/beans-productimport.xml")
@EnableAutoConfiguration
public class ProductImportJobTest extends AbstractSpringBatchIntegrationTest {

  @Inject
  private Job productImportJob;

  @Test
  public void testJob() throws Exception {
    ......
    ......
    JobExecution jobExecution = getJobLauncherTestUtils(this.productImportJob).launchJob(jobParameters);
    assertThat(jobExecution.getStatus()).isEqualTo(BatchStatus.COMPLETED);
    ......
    ......
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that when using the <code>launchJob()</code> method, the batch execution will never be considered as a restart (i.e. it will always start from scratch). This is achieved by adding a unique (random) parameter.</p>
</div>
<div class="paragraph">
<p>This is not true for the method <code>launchJob(JobParameters)</code> however, which will result in an exception if the test is executed twice or a batch is executed in two different tests with the same parameters.</p>
</div>
<div class="paragraph">
<p>We will add methods for appropriately handling this situation in future releases of devonfw. Until then you can help yourself by using the method <code>getUniqueJobParameters()</code> and then add all required parameters to those parameters returned by the method (as shown in the section on <a href="#guide-batch-layer.asciidoc_parameters">parameters</a>).</p>
</div>
<div class="paragraph">
<p>Also note that even if skips occurred, the BatchStatus is still COMPLETED. That is one reason why you should always check whether the batch did what it was supposed to do or not.</p>
</div>
<div class="sect6">
<h7 id="guide-batch-layer.asciidoc_testing-individual-steps">Testing Individual Steps</h7>
<div class="paragraph">
<p>For complex batch jobs individual steps can be tested. For example to test a <code>createCsvFile</code>, run just that particular Step. This approach allows for more targeted tests by allowing the test to set up data for just that step and to validate its results directly.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">JobExecution jobExecution = getJobLauncherTestUtils(this.billExportJob).launchStep(“createCsvFile”);</code></pre>
</div>
</div>
</div>
<div class="sect6">
<h7 id="guide-batch-layer.asciidoc_validating-output-files">Validating Output Files</h7>
<div class="paragraph">
<p>When a batch job writes to the database, it is easy to query the database to verify the output. To facilitate the verification of output files Spring Batch provides the class <code>AssertFile</code>. The method <code>assertFileEquals</code> takes two File objects and asserts, line by line, that the two files have the same content. Therefore, it is possible to create a file with the expected output and to compare it to the actual result:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">private static final String EXPECTED_FILE = "classpath:expected.csv";
private static final String OUTPUT_FILE = " file:./temp/output.csv";
AssertFile.assertFileEquals(new FileSystemResource(EXPECTED_FILE), new FileSystemResource(OUTPUT_FILE));</code></pre>
</div>
</div>
</div>
<div class="sect6">
<h7 id="guide-batch-layer.asciidoc_testing-restarts">Testing Restarts</h7>
<div class="paragraph">
<p>Simulating an exception at an arbitrary method in the code can be done relatively easy using <a href="https://eclipse.org/aspectj/">AspectJ</a>. Afterwards you should restart the batch and check if the outcome is still correct.</p>
</div>
<div class="paragraph">
<p>Note that when using the <code>launchJob()</code> method, the batch is always started from the beginning (as already mentioned). Use the <code>launchJob(JobParameters)</code> instead with the same parameters for the initial (failing) execution and for the restart.</p>
</div>
<div class="paragraph">
<p>Test your code thoroughly. There should be at least one restart test for every step of the batch job.</p>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="master-devon4j.asciidoc_guides">11. Guides</h2>
<div class="sectionbody">
<!-- toc disabled -->
<div class="sect2">
<h3 id="guide-dependency-injection.asciidoc">11.1. Dependency Injection</h3>
<div class="paragraph">
<p>Dependency injection is one of the most important design patterns and is a key principle to a modular and component based architecture. The Java Standard for dependency injection is <a href="http://docs.oracle.com/javaee/6/api/javax/inject/package-summary.html">javax.inject (JSR330)</a> that we use in combination with <a href="http://docs.oracle.com/javaee/5/api/javax/annotation/package-summary.html">JSR250</a>.</p>
</div>
<div class="paragraph">
<p>There are many frameworks which support this standard including all recent Java EE application servers. We recommend to use <a href="http://spring.io/">Spring</a> (also known as springframework) that we use in our example application. However, the modules we provide typically just rely on JSR330 and can be used with any compliant container.</p>
</div>
<div class="sect3">
<h4 id="guide-dependency-injection.asciidoc_key-principles">11.1.1. Key Principles</h4>
<div class="paragraph">
<p>A Bean in CDI (Contexts and Dependency-Injection) or Spring is typically part of a larger component and encapsulates some piece of logic that should in general be replaceable. As an example we can think of a Use-Case, Data-Access-Object (DAO), etc. As best practice we use the following principles:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Separation of API and implementation</strong><br>
We create a self-contained API documented with JavaDoc. Then we create an implementation of this API that we annotate with <code>@Named</code>. This implementation is treated as secret. Code from other components that wants to use the implementation shall only rely on the API. Therefore we use dependency injection via the interface with the <code>@Inject</code> annotation.</p>
</li>
<li>
<p><strong>Stateless implementation</strong><br>
By default implementations (CDI-Beans) shall always be stateless. If you store state information in member variables you can easily run into concurrency problems and nasty bugs. This is easy to avoid by using local variables and separate state classes for complex state-information. Try to avoid stateful CDI-Beans wherever possible. Only add state if you are fully aware of what you are doing and properly document this as a warning in your JavaDoc.</p>
</li>
<li>
<p><strong>Usage of JSR330</strong><br>
We use javax.inject (JSR330) and JSR250 as a common standard that makes our code portable (works in any modern Java EE environment). However, we recommend to use the springframework as container. But we never use proprietary annotations such as <code>@Autowired</code> instead of standardized annotations like <code>@Inject</code>. Generally we avoid proprietary annotations in business code (<code>common</code> and <a href="#guide-logic-layer.asciidoc">logic layer</a>).</p>
</li>
<li>
<p><strong>Simple Injection-Style</strong><br>
In general you can choose between constructor, setter or field injection. For simplicity we recommend to do private field injection as it is very compact and easy to maintain. We believe that constructor injection is bad for maintenance especially in case of inheritance (if you change the dependencies you need to refactor all sub-classes). Private field injection and public setter injection are very similar but setter injection is much more verbose (often you are even forced to have javadoc for all public methods). If you are writing re-usable library code setter injection will make sense as it is more flexible. In a business application you typically do not need that and can save a lot of boiler-plate code if you use private field injection instead. Nowadays you are using container infrastructure also for your tests (see <a href="#guide-testing.asciidoc">spring integration tests</a>) so there is no need to inject manually (what would require a public setter).</p>
</li>
<li>
<p><strong>KISS</strong><br>
To follow the KISS (keep it small and simple) principle we avoid advanced features (e.g. <a href="#guide-aop.asciidoc">AOP</a>, non-singleton beans) and only use them where necessary.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="guide-dependency-injection.asciidoc_example-bean">11.1.2. Example Bean</h4>
<div class="paragraph">
<p>Here you can see the implementation of an example bean using JSR330 and JSR250:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Named
public class MyBeanImpl implements MyBean {
  @Inject
  private MyOtherBean myOtherBean;

  @PostConstruct
  public void init() {
    // initialization if required (otherwise omit this method)
  }

  @PreDestroy
  public void dispose() {
    // shutdown bean, free resources if required (otherwise omit this method)
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>It depends on <code>MyOtherBean</code> that should be the interface of an other component that is injected into the field because of the <code>@Inject</code> annotation. To make this work there must be exactly one implementation of <code>MyOtherBean</code> in the container (in our case spring). In order to put a Bean into the container we use the <code>@Named</code> annotation so in our example we put <code>MyBeanImpl</code> into the container. Therefore it can be injected into all setters that take the interface <code>MyBean</code> as argument and are annotated with <code>@Inject</code>.</p>
</div>
<div class="paragraph">
<p>In some situations you may have an Interface that defines a kind of "plugin" where you can have multiple implementations in your container and want to have all of them. Then you can request a list with all instances of that interface as in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">  @Inject
  private List&lt;MyConverter&gt; converters;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Please note that when writing library code instead of annotating implementation with <code>@Named</code> it is better to provide <code>@Configuration</code> classes that choose the implementation via <code>@Bean</code> methods (see <a href="http://docs.spring.io/spring-javaconfig/docs/1.0.0.M4/reference/html/ch02s02.html">@Bean documentation</a>). This way you can better "export" specific features instead of relying library users to do a component-scan to your library code and loose control on upgrades.</p>
</div>
</div>
<div class="sect3">
<h4 id="guide-dependency-injection.asciidoc_bean-configuration">11.1.3. Bean configuration</h4>
<div class="paragraph">
<p>Wiring and Bean configuration can be found in <a href="#guide-configuration.asciidoc">configuration guide</a>.</p>
</div>
<!-- toc disabled -->
</div>
</div>
<div class="sect2">
<h3 id="guide-configuration.asciidoc">11.2. Configuration</h3>
<div class="paragraph">
<p>An application needs to be configurable in order to allow internal setup (like CDI) but also to allow externalized configuration of a deployed package (e.g. integration into runtime environment). Using <a href="http://projects.spring.io/spring-boot/">Spring Boot</a> (must read: <a href="http://docs.spring.io/spring-boot/docs/current-SNAPSHOT/reference/htmlsingle/#using-boot">Spring Boot reference</a>) we rely on a comprehensive configuration approach following a "convention over configuration" pattern. This guide adds on to this by detailed instructions and best-practices how to deal with configurations.</p>
</div>
<div class="paragraph">
<p>In general we distinguish the following kinds of configuration that are explained in the following sections:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#guide-configuration.asciidoc_internal-application-configuration">Internal Application configuration</a> maintained by developers</p>
</li>
<li>
<p><a href="#guide-configuration.asciidoc_externalized-environment-configuration">Externalized Environment configuration</a> maintained by operators</p>
</li>
<li>
<p><a href="#guide-configuration.asciidoc_business-configuration">Externalized Business configuration</a> maintained by business administrators</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="guide-configuration.asciidoc_internal-application-configuration">11.2.1. Internal Application Configuration</h4>
<div class="paragraph">
<p>The application configuration contains all internal settings and wirings of the application (bean wiring, database mappings, etc.) and is maintained by the application developers at development time. There usually is a main configuration registered with main Spring Boot App, but differing configurations to support automated test of the application can be defined using profiles (not detailed in this guide).</p>
</div>
<div class="sect4">
<h5 id="guide-configuration.asciidoc_spring-boot-application">Spring Boot Application</h5>
<div class="paragraph">
<p>The devonfw recommends using <a href="http://projects.spring.io/spring-boot/">spring-boot</a> to build web applications.
For a complete documentation see the <a href="http://docs.spring.io/spring-boot/docs/current-SNAPSHOT/reference/htmlsingle/">Spring Boot Reference Guide</a>.</p>
</div>
<div class="paragraph">
<p>With spring-boot you provide a simple <em>main class</em> (also called starter class) like this:
com.devonfw.mtsj.application</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@SpringBootApplication(exclude = { EndpointAutoConfiguration.class })
@EntityScan(basePackages = { "com.devonfw.mtsj.application" }, basePackageClasses = { AdvancedRevisionEntity.class })
@EnableGlobalMethodSecurity(jsr250Enabled = true)
@ComponentScan(basePackages = { "com.devonfw.mtsj.application.general", "com.devonfw.mtsj.application" })
public class SpringBootApp {

  /**
   * Entry point for spring-boot based app
   *
   * @param args - arguments
   */
  public static void main(String[] args) {

    SpringApplication.run(SpringBootApp.class, args);
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In an devonfw application this main class is always located in the <code>&lt;basepackage&gt;</code> of the application package namespace (see <a href="coding-conventions.html#packages">package-conventions</a>). This is because a spring boot application will automatically do a classpath scan for components (spring-beans) and entities in the package where the application main class is located including all sub-packages. You can use the <code>@ComponentScan</code> and <code>@EntityScan</code> annotations to customize this behaviour.</p>
</div>
</div>
<div class="sect4">
<h5 id="guide-configuration.asciidoc_standard-beans-configuration">Standard beans configuration</h5>
<div class="paragraph">
<p>For basic bean configuration we rely on spring boot using mainly configuration classes and only occasionally XML configuration files. Some key principle to understand Spring Boot auto-configuration features:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Spring Boot auto-configuration attempts to automatically configure your Spring application based on the jar dependencies and annotated components found in your source code.</p>
</li>
<li>
<p>Auto-configuration is non-invasive, at any point you can start to define your own configuration to replace specific parts of the auto-configuration by redefining your identically named bean (see also <code>exclude</code> attribute of <code>@SpringBootApplication</code> in example code above).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Beans are configured via annotations in your java code (see <a href="#guide-dependency-injection.asciidoc">dependency-injection</a>).</p>
</div>
<div class="paragraph">
<p>For technical configuration you will typically write additional spring config classes annotated with <code>@Configuration</code> that provide bean implementations via methods annotated with <code>@Bean</code>. See <a href="http://docs.spring.io/spring-javaconfig/docs/1.0.0.M4/reference/html/ch02s02.html">spring @Bean documentation</a> for further details. Like in XML you can also use <code>@Import</code> to make a <code>@Configuration</code> class include other configurations.</p>
</div>
</div>
<div class="sect4">
<h5 id="guide-configuration.asciidoc_xml-based-beans-configuration">XML-based beans configuration</h5>
<div class="paragraph">
<p>It is still possible and allowed to provide (bean-) configurations using XML, though not recommended. These configuration files are no more bundled via a main xml config file but loaded individually from their respective owners, e.g. for unit-tests:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@SpringApplicationConfiguration(classes = { SpringBootApp.class }, locations = { "classpath:/config/app/batch/beans-productimport.xml" })
public class ProductImportJobTest extends AbstractSpringBatchIntegrationTest {
...</code></pre>
</div>
</div>
<div class="paragraph">
<p>Configuration XML-files reside in an adequately named subfolder of:</p>
</div>
<div class="paragraph">
<p><code>src/main/resources/app</code></p>
</div>
</div>
<div class="sect4">
<h5 id="guide-configuration.asciidoc_batch-configuration">Batch configuration</h5>
<div class="paragraph">
<p>In the directory <code>src/main/resources/config/app/batch</code> we place the configuration for the batch jobs. Each file within this directory represents one batch job. See <a href="#guide-batch-layer.asciidoc">batch-layer</a> for further details.</p>
</div>
</div>
<div class="sect4">
<h5 id="guide-configuration.asciidoc_beanmapper-configuration">BeanMapper Configuration</h5>
<div class="paragraph">
<p>In the directory <code>src/main/resources/config/app/common</code> we place the configuration for the bean-mapping.
See <a href="guide-beanmapping.html#bean-mapper-configuration">bean-mapper configuration</a> for further details.</p>
</div>
</div>
<div class="sect4">
<h5 id="guide-configuration.asciidoc_security-configuration">Security configuration</h5>
<div class="paragraph">
<p>The abstract base class <code>BaseWebSecurityConfig</code> should be extended to configure web application security thoroughly.
A basic and secure configuration is provided which can be overridden or extended by subclasses.
Subclasses must use the <code>@Profile</code> annotation to further discriminate between beans used in production and testing scenarios. See the following example:</p>
</div>
<div class="listingblock">
<div class="title">Listing 2. How to extend <code>BaseWebSecurityConfig</code> for Production and Test</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Configuration
@EnableWebSecurity
@Profile(SpringProfileConstants.JUNIT)
public class TestWebSecurityConfig extends BaseWebSecurityConfig {...}

@Configuration
@EnableWebSecurity
@Profile(SpringProfileConstants.NOT_JUNIT)
public class WebSecurityConfig extends BaseWebSecurityConfig {...}</code></pre>
</div>
</div>
<div class="paragraph">
<p>See <a href="https://github.com/devonfw/my-thai-star/blob/develop/java/mtsj/core/src/main/java/com/devonfw/application/mtsj/general/service/impl/config/WebSecurityConfig.java">WebSecurityConfig</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="guide-configuration.asciidoc_websocket-configuration">WebSocket configuration</h5>
<div class="paragraph">
<p>A websocket endpoint is configured within the business package as a Spring configuration class. The annotation <code>@EnableWebSocketMessageBroker</code> makes Spring Boot registering this endpoint.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">package your.path.to.the.websocket.config;
...
@Configuration
@EnableWebSocketMessageBroker
public class WebSocketConfig extends AbstractWebSocketMessageBrokerConfigurer {
...</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="guide-configuration.asciidoc_database-configuration">Database Configuration</h5>
<div class="paragraph">
<p>To choose database of your choice , set <code>spring.profiles.active=XXX</code> in <code>src/main/resources/config/application.properties</code>. Also, one has to set all the active spring profiles in this <code>application.properties</code> and not in any of the other <code>application.properies</code>.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="guide-configuration.asciidoc_externalized-configuration">11.2.2. Externalized Configuration</h4>
<div class="paragraph">
<p>Externalized configuration is a configuration that is provided separately to a deployment package and can be maintained undisturbed by re-deployments.</p>
</div>
<div class="sect4">
<h5 id="guide-configuration.asciidoc_environment-configuration">Environment Configuration</h5>
<div class="paragraph">
<p>The environment configuration contains configuration parameters (typically port numbers, host names, passwords, logins, timeouts, certificates, etc.) specific for the different environments. These are under the control of the operators responsible for the application.</p>
</div>
<div class="paragraph">
<p>The environment configuration is maintained in <code>application.properties</code> files, defining various properties (see <a href="https://docs.spring.io/spring-boot/docs/current/reference/html/common-application-properties.html">common application properties</a> for a list of properties defined by the spring framework).
These properties are explained in the corresponding configuration sections of the guides for each topic:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="guide-jpa.html#database-system-and-access">persistence configuration</a></p>
</li>
<li>
<p><a href="guide-service-layer.html#jax-rs-configuration">service configuration</a></p>
</li>
<li>
<p><a href="guide-logging.html#configuration">logging guide</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For a general understanding how spring-boot is loading and boostrapping your <code>application.properties</code> see <a href="https://docs.spring.io/spring-boot/docs/current/reference/html/boot-features-external-config.html">spring-boot external configuration</a>.
The following properties files are used in every devonfw application:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>src/main/resources/application.properties</code> providing a default configuration - bundled and deployed with the application package. It further acts as a template to derive a tailored minimal environment-specific configuration.</p>
</li>
<li>
<p><code>src/main/resources/config/application.properties</code> providing additional properties only used at development time (for all local deployment scenarios). This property file is excluded from all packaging.</p>
</li>
<li>
<p><code>src/test/resources/config/application.properties</code> providing additional properties only used for testing (JUnits based on <a href="#guide-testing.asciidoc">spring test</a>).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For other environments where the software gets deployed such as <code>test</code>, <code>acceptance</code> and <code>production</code> you need to provide a tailored copy of <code>application.properties</code>. The location depends on the deployment strategy:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>standalone run-able Spring Boot App using embedded tomcat: <code>config/application.properties</code> under the installation directory of the spring boot application.</p>
</li>
<li>
<p>dedicated tomcat (one tomcat per app): <code>$CATALINA_BASE/lib/config/application.properties</code></p>
</li>
<li>
<p>tomcat serving a number of apps (requires expanding the wars): <code>$CATALINA_BASE/webapps/&lt;app&gt;/WEB-INF/classes/config</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In this <code>application.properties</code> you only define the minimum properties that are environment specific and inherit everything else from the bundled <code>src/main/resources/application.properties</code>. In any case, make very sure that the classloader will find the file.</p>
</div>
<div class="paragraph">
<p>Make sure your properties are thoroughly documented by providing a comment to each property. This inline documentation is most valuable for your operating department.</p>
</div>
</div>
<div class="sect4">
<h5 id="guide-configuration.asciidoc_business-configuration">Business Configuration</h5>
<div class="paragraph">
<p>The business configuration contains all business configuration values of the application, which can be edited by administrators through the GUI. The business configuration values are stored in the database in key/value pairs.</p>
</div>
<div class="paragraph">
<p>The database table <code>business_configuration</code> has the following columns:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>ID</p>
</li>
<li>
<p>Property name</p>
</li>
<li>
<p>Property type (Boolean, Integer, String)</p>
</li>
<li>
<p>Property value</p>
</li>
<li>
<p>Description</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>According to the entries in this table, the administrative GUI shows a generic form to change business configuration. The hierarchy of the properties determines the place in the GUI, so the GUI bundles properties from the same hierarchy level and name. Boolean values are shown as checkboxes, integer and string values as text fields. The properties are read and saved in a typed form, an error is raised if you try to save a string in an integer property for example.</p>
</div>
<div class="paragraph">
<p>We recommend the following base layout for the hierarchical business configuration:</p>
</div>
<div class="paragraph">
<p><code>component.[subcomponent].[subcomponent].propertyname</code></p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="guide-configuration.asciidoc_security">11.2.3. Security</h4>
<div class="paragraph">
<p>Often you need to have passwords (for databases, third-party services, etc.) as part of your configuration. These are typically environment specific (see above). However, with DevOps and continuous-deployment you might be tempted to commit such configurations into your version-control (e.g. <code>git</code>). Doing that with plain text passwords is a severe problem especially for production systems. Never do that! Instead we offer some suggestions how to deal with sensible configurations:</p>
</div>
<div class="sect4">
<h5 id="guide-configuration.asciidoc_password-encryption">Password Encryption</h5>
<div class="paragraph">
<p>A simple but reasonable approach is to configure the passwords encrypted with a master-password. The master-password should be a strong secret that is specific for each environment. It must never be committed to version-control.
In order to support encrypted passwords in spring-boot <code>application.properties</code> all you need to do is to add <a href="https://github.com/ulisesbocchio/jasypt-spring-boot#jasypt-spring-boot">jasypt-spring-boot</a> as dependency in your <code>pom.xml</code>(please check for recent version):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;dependency&gt;
  &lt;groupId&gt;com.github.ulisesbocchio&lt;/groupId&gt;
  &lt;artifactId&gt;jasypt-spring-boot-starter&lt;/artifactId&gt;
  &lt;version&gt;1.17&lt;/version&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>This will smoothly integrate <a href="http://jasypt.org/">jasypt</a> into your <a href="https://projects.spring.io/spring-boot/">spring-boot</a> application. Read this <a href="https://wiki.jasig.org/display/CASUM/HOWTO+Use+Jasypt+to+encrypt+passwords+in+configuration+files">HOWTO</a> to learn how to encrypt and decrypt passwords using jasypt. Here is a simple example output of an enctrypted password (of course you have to use strong passwords instead of <code>secret</code> and <code>postgres</code> - this is only an example):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">----ARGUMENTS-------------------

input: postgres
password: secret

----OUTPUT----------------------

jd5ZREpBqxuN9ok0IhnXabgw7V3EoG2p</code></pre>
</div>
</div>
<div class="paragraph">
<p>The master-password can be configured on your target environment via the property <code>jasypt.encryptor.password</code>. As system properties given on the command-line are visible in the process list, we recommend to use an <code>config/application.yml</code> file only for this purpose (as we recommended to use <code>application.properties</code> for regular configs):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>jasypt:
    encryptor:
        password: secret</code></pre>
</div>
</div>
<div class="paragraph">
<p>(of course you will replace <code>secret</code> with a strong password). In case you happen to have multiple apps on the same machine, you can symlink the <code>application.yml</code> from a central place.
Now you are able to put encrypted passwords into your <code>application.properties</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>spring.datasource.password=ENC(jd5ZREpBqxuN9ok0IhnXabgw7V3EoG2p)</code></pre>
</div>
</div>
<div class="paragraph">
<p>To prevent jasypt to throw an exception in dev or test scenarios simply put this in your local config (<code>src/main/config/application.properties</code> and same for <code>test</code>, see above for details):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>jasypt.encryptor.password=none</code></pre>
</div>
</div>
<div class="paragraph">
<p>Is this Security by Obscurity?</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Yes, from the point of view to protect the passwords on the target environment this is nothing but security by obscurity. If an attacker somehow got full access to the machine this will only cause him to spend some more time.</p>
</li>
<li>
<p>No, if someone only gets the configuration file. So all your developers might have access to the version-control where the config is stored. Others might have access to the software releases that include this configs. But without the master-password that should only be known to specific operators none else can decrypt the password (except with brute-force what will take a very long time, see jasypt for details).</p>
</li>
</ul>
</div>
<!-- toc disabled -->
</div>
</div>
</div>
<div class="sect2">
<h3 id="guide-jpa.asciidoc">11.3. Java Persistence API</h3>
<div class="paragraph">
<p>For mapping java objects to a relational database we use the <a href="http://www.oracle.com/technetwork/java/javaee/tech/persistence-jsp-140049.html">Java Persistence API (JPA)</a>.
As JPA implementation we recommend to use <a href="http://hibernate.org/orm/">hibernate</a>. For general documentation about JPA and hibernate follow the links above as we will not replicate the documentation. Here you will only find guidelines and examples how we recommend to use it properly. The following examples show how to map the data of a database to an entity. As we use JPA we abstract from <a href="#guide-sql.asciidoc">SQL</a> here. However, you will still need a <a href="https://en.wikipedia.org/wiki/Data_definition_language">DDL</a> script for your schema and during maintenance also <a href="#guide-database-migration.asciidoc">database migrations</a>. Please follow our <a href="#guide-sql.asciidoc">SQL guide</a> for such artefacts.</p>
</div>
<div class="sect3">
<h4 id="guide-jpa.asciidoc_entity">11.3.1. Entity</h4>
<div class="paragraph">
<p>Entities are part of the persistence layer and contain the actual data. They are POJOs (Plain Old Java Objects) on which the relational data of a database is mapped and vice versa. The mapping is configured via JPA annotations (<code>javax.persistence</code>). Usually an entity class corresponds to a table of a database and a property to a column of that table. A persistent entity instance then represents a row of the database table.</p>
</div>
<div class="sect4">
<h5 id="guide-jpa.asciidoc_a-simple-entity">A Simple Entity</h5>
<div class="paragraph">
<p>The following listing shows a simple example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Entity
@Table(name="TEXTMESSAGE")
public class MessageEntity extends ApplicationPersistenceEntity implements Message {

  private String text;

  public String getText() {
    return this.text;
  }

  public void setText(String text) {
    this.text = text;
  }
 }</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>@Entity</code> annotation defines that instances of this class will be entities which can be stored in the database. The <code>@Table</code> annotation is optional and can be used to define the name of the corresponding table in the database. If it is not specified, the simple name of the entity class is used instead.</p>
</div>
<div class="paragraph">
<p>In order to specify how to map the attributes to columns we annotate the corresponding getter methods (technically also private field annotation is also possible but approaches can not be mixed).
The <code>@Id</code> annotation specifies that a property should be used as <a href="#guide-jpa.asciidoc_primary-keys">primary key</a>.
With the help of the <code>@Column</code> annotation it is possible to define the name of the column that an attribute is mapped to as well as other aspects such as <code>nullable</code> or <code>unique</code>. If no column name is specified, the name of the property is used as default.</p>
</div>
<div class="paragraph">
<p>Note that every entity class needs a constructor with public or protected visibility that does not have any arguments. Moreover, neither the class nor its getters and setters may be final.</p>
</div>
<div class="paragraph">
<p>Entities should be simple POJOs and not contain business logic.</p>
</div>
</div>
<div class="sect4">
<h5 id="guide-jpa.asciidoc_entities-and-datatypes">Entities and Datatypes</h5>
<div class="paragraph">
<p>Standard datatypes like <code>Integer</code>, <code>BigDecimal</code>, <code>String</code>, etc. are mapped automatically by JPA. Custom <a href="#guide-datatype.asciidoc">datatypes</a> are mapped as serialized <a href="#guide-jpa.asciidoc_blob">BLOB</a> by default what is typically undesired.
In order to map atomic custom datatypes (implementations of`+SimpleDatatype`) we implement an <code>AttributeConverter</code>. ere is a simple example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Converter(autoApply = true)
public class MoneyAttributeConverter implements AttributeConverter&lt;Money, BigDecimal&gt; {

  public BigDecimal convertToDatabaseColumn(Money attribute) {
    return attribute.getValue();
  }

  public Money convertToEntityAttribute(BigDecimal dbData) {
    return new Money(dbData);
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The annotation <code>@Converter</code> is detected by the JPA vendor if the annotated class is in the packages to scan. Further, <code>autoApply = true</code> implies that the converter is automatically used for all properties of the handled datatype. Therefore all entities with properties of that datatype will automatically be mapped properly (in our example <code>Money</code> is mapped as <code>BigDecimal</code>).</p>
</div>
<div class="paragraph">
<p>In case you have a composite datatype that you need to map to multiple columns the JPA does not offer a real solution. As a workaround you can use a bean instead of a real datatype and declare it as <a href="#guide-jpa.asciidoc_embeddable"><code>@Embeddable</code></a>. If you are using hibernate you can implement <code>CompositeUserType</code>. Via the <code>@TypeDef</code> annotation it can be registered to hibernate. If you want to annotate the <code>CompositeUserType</code> implementation itself you also need another annoation (e.g. <code>MappedSuperclass</code> tough not technically correct) so it is found by the scan.</p>
</div>
<div class="sect5">
<h6 id="guide-jpa.asciidoc_enumerations">Enumerations</h6>
<div class="paragraph">
<p>By default JPA maps Enums via their ordinal. Therefore the database will only contain the ordinals (0, 1, 2, etc.) . So , inside the database you can not easily understand their meaning. Using <code>@Enumerated</code> with <code>EnumType.STRING</code> allows to map the enum values to their name (<code>Enum.name()</code>). Both approaches are fragile when it comes to code changes and refactorings (if you change the order of the enum values or rename them) after the application is deployed to production. If you want to avoid this and get a robust mapping you can define a dedicated string in each enum value for database representation that you keep untouched. Then you treat the enum just like any other <a href="#guide-jpa.asciidoc_entities-and-datatypes">custom datatype</a>.</p>
</div>
</div>
<div class="sect5">
<h6 id="guide-jpa.asciidoc_blob">BLOB</h6>
<div class="paragraph">
<p>If binary or character large objects (BLOB/CLOB) should be used to store the value of an attribute, e.g. to store an icon, the <code>@Lob</code> annotation should be used as shown in the following listing:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Lob
public byte[] getIcon() {
  return this.icon;
}</code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Using a byte array will cause problems if BLOBs get large because the entire BLOB is loaded into the RAM of the server and has to be processed by the garbage collector. For larger BLOBs the type <a href="http://docs.oracle.com/javase/7/docs/api/java/sql/Blob.html">Blob</a> and streaming should be used.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public Blob getAttachment() {
  return this.attachment;
}</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="guide-jpa.asciidoc_date-and-time">Date and Time</h6>
<div class="paragraph">
<p>To store date and time related values, the temporal annotation can be used as shown in the listing below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Temporal(TemporalType.TIMESTAMP)
public java.util.Date getStart() {
  return start;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Until Java8 the java data type <code>java.util.Date</code> (or Jodatime) has to be used.
<code>TemporalType</code> defines the granularity. In this case, a precision of nanoseconds is used. If this granularity is not wanted, <code>TemporalType.DATE</code> can be used instead, which only has a granularity of milliseconds.
Mixing these two granularities can cause problems when comparing one value to another. This is why we <strong>only</strong>  use <code>TemporalType.TIMESTAMP</code>.</p>
</div>
</div>
<div class="sect5">
<h6 id="guide-jpa.asciidoc_querydsl-and-custom-types">QueryDSL and Custom Types</h6>
<div class="paragraph">
<p>Using the Aliases API of QueryDSL might result in an <code>InvalidDataAccessApiUsageException</code> when using custom datatypes in entity properties. This can be circumvented in two steps:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Ensure you have the following maven dependencies in your project (<code>core</code> module) to support custom types via the Aliases API:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;dependency&gt;
  &lt;groupId&gt;org.ow2.asm&lt;/groupId&gt;
  &lt;artifactId&gt;asm&lt;/artifactId&gt;
&lt;/dependency&gt;
&lt;dependency&gt;
  &lt;groupId&gt;cglib&lt;/groupId&gt;
  &lt;artifactId&gt;cglib&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
</li>
<li>
<p>Make sure, that all your custom types used in entities provide a non-argument constructor with at least visibility level <code>protected</code>.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect4">
<h5 id="guide-jpa.asciidoc_primary-keys">Primary Keys</h5>
<div class="paragraph">
<p>We only use simple Long values as primary keys (IDs). By default it is auto generated (<code>@GeneratedValue(strategy=GenerationType.AUTO)</code>). This is already provided by the class <code>com.devonfw.&lt;projectName&gt;.general.dataaccess.api.AbstractPersistenceEntity</code> that you can extend.
In case you have business oriented keys (often as <code>String</code>), you can define an additional property for it and declare it as unique (<code>@Column(unique=true)</code>).
Be sure to include "AUTO_INCREMENT" in your sql table field ID to be able to persist data (or similar for other databases).</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="guide-jpa.asciidoc_relationships">11.3.2. Relationships</h4>
<div class="sect4">
<h5 id="guide-jpa.asciidoc_n1-and-11-relationships">n:1 and 1:1 Relationships</h5>
<div class="paragraph">
<p>Entities often do not exist independently but are in some relation to each other. For example, for every period of time one of the StaffMember&#8217;s of the restaurant example has worked, which is represented by the class <code>WorkingTime</code>, there is a relationship to this StaffMember.</p>
</div>
<div class="paragraph">
<p>The following listing shows how this can be modeled using JPA:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">...

@Entity
public class WorkingTimeEntity {
   ...

   private StaffMemberEntity staffMember;

   @ManyToOne
   @JoinColumn(name="STAFFMEMBER")
   public StaffMemberEntity getStaffMember() {
      return this.staffMember;
   }

   public void setStaffMember(StaffMemberEntity staffMember) {
      this.staffMember = staffMember;
   }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>To represent the relationship, an attribute of the type of the corresponding entity class that is referenced has been introduced. The relationship is a n:1 relationship, because every <code>WorkingTime</code> belongs to exactly one <code>StaffMember</code>, but a <code>StaffMember</code> usually worked more often than once.<br>
This is why the <code>@ManyToOne</code> annotation is used here. For 1:1 relationships the <code>@OneToOne</code> annotation can be used which works basically the same way. To be able to save information about the relation in the database, an additional column in the corresponding table of WorkingTime is needed which contains the primary key of the referenced StaffMember. With the <code>name</code> element of the <code>@JoinColumn</code> annotation it is possible to specify the name of this column.</p>
</div>
</div>
<div class="sect4">
<h5 id="guide-jpa.asciidoc_1n-and-nm-relationships">1:n and n:m Relationships</h5>
<div class="paragraph">
<p>The relationship of the example listed above is currently an unidirectional one, as there is a getter method for retrieving the <code>StaffMember</code> from the <code>WorkingTime</code> object, but not vice versa.</p>
</div>
<div class="paragraph">
<p>To make it a bidirectional one, the following code has to be added to <code>StaffMember</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">  private Set&lt;WorkingTimeEntity&gt; workingTimes;

  @OneToMany(mappedBy="staffMember")
  public Set&lt;WorkingTimeEntity&gt; getWorkingTimes() {
    return this.workingTimes;
  }

  public void setWorkingTimes(Set&lt;WorkingTimeEntity&gt; workingTimes) {
    this.workingTimes = workingTimes;
  }</code></pre>
</div>
</div>
<div class="paragraph">
<p>To make the relationship bidirectional, the tables in the database do not have to be changed. Instead the column that corresponds to the attribute <code>staffMember</code> in class <code>WorkingTime</code> is used, which is specified by the <code>mappedBy</code> element of the <code>@OneToMany</code> annotation. Hibernate will search for corresponding <code>WorkingTime</code> objects automatically when a <code>StaffMember</code> is loaded.</p>
</div>
<div class="paragraph">
<p>The problem with bidirectional relationships is that if a <code>WorkingTime</code> object is added to the set or list <code>workingTimes</code> in <code>StaffMember</code>, this does not have any effect in the database unless
the <code>staffMember</code> attribute of that <code>WorkingTime</code> object is set. That is why the devon4j advices not to use bidirectional relationships but to use queries instead. How to do this is shown <a href="#guide-jpa.asciidoc_queries">here</a>. If a bidirectional relationship should be used nevertheless, approriate add and remove methods must be used.</p>
</div>
<div class="paragraph">
<p>For 1:n and n:m relations, the devon4j demands that (unordered) Sets and no other collection types are used, as shown in the listing above. The only exception is whenever an ordering is really needed, (sorted) lists can be used.<br>
For example, if <code>WorkingTime</code> objects should be sorted by their start time, this could be done like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">  private List&lt;WorkingTimeEntity&gt; workingTimes;

  @OneToMany(mappedBy = "staffMember")
  @OrderBy("startTime asc")
  public List&lt;WorkingTimeEntity&gt; getWorkingTimes() {
    return this.workingTimes;
  }

  public void setWorkingTimes(List&lt;WorkingTimeEntity&gt; workingTimes) {
    this.workingTimes = workingTimes;
  }</code></pre>
</div>
</div>
<div class="paragraph">
<p>The value of the <code>@OrderBy</code> annotation consists of an attribute name of the class followed by <code>asc</code> (ascending) or <code>desc</code> (descending).</p>
</div>
<div class="paragraph">
<p>To store information about a n:m relationship, a separate table has to be used, as one column cannot store several values (at least if the database schema is in first normal form).<br>
For example if one wanted to extend the example application so that all ingredients of one <code>FoodDrink</code> can be saved and to model the ingredients themselves as entities (e.g. to store additional information about them), this could be modeled as follows (extract of class <code>FoodDrink</code>):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">  private Set&lt;IngredientEntity&gt; ingredients;

  @ManyToMany()
  @JoinTable
  public Set&lt;IngredientEntity&gt; getIngredients() {
    return this.ingredients;
  }

  public void setOrders(Set&lt;IngredientEntity&gt; ingredients) {
    this.ingredients = ingredients;
  }</code></pre>
</div>
</div>
<div class="paragraph">
<p>Information about the relation is stored in a table called <code>BILL_ORDER</code> that has to have two columns, one for referencing the Bill, the other one for referencing the Order. Note that the <code>@JoinTable</code> annotation is not needed in this case because a separate table is the default solution here (same for n:m relations) unless there is a <code>mappedBy</code> element specified.</p>
</div>
<div class="paragraph">
<p>For 1:n relationships this solution has the disadvantage that more joins (in the database system) are needed to get a Bill with all the Orders it refers to. This might have a negative impact on performance so that the solution to store a reference to the Bill row/entity in the Order&#8217;s table is probably the better solution in most cases.</p>
</div>
<div class="paragraph">
<p>Note that bidirectional n:m relationships are not allowed for applications based on the devon4j. Instead a third entity has to be introduced, which "represents" the relationship (it has two n:1 relationships).</p>
</div>
</div>
<div class="sect4">
<h5 id="guide-jpa.asciidoc_eager-vs.-lazy-loading">Eager vs. Lazy Loading</h5>
<div class="paragraph">
<p>Using JPA it is possible to use either lazy or eager loading. Eager loading means that for entities retrieved from the database, other entities that are referenced by these entities are also retrieved, whereas lazy loading means that this is only done when they are actually needed, i.e. when the corresponding getter method is invoked.</p>
</div>
<div class="paragraph">
<p>Application based on the devon are strongly advised to always use lazy loading. The JPA defaults are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>@OneToMany</code>: LAZY</p>
</li>
<li>
<p><code>@ManyToMany</code>: LAZY</p>
</li>
<li>
<p><code>@ManyToOne</code>: EAGER</p>
</li>
<li>
<p><code>@OneToOne</code>: EAGER</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>So at least for <code>@ManyToOne</code> and <code>@OneToOne</code> you always need to override the default by providing <code>fetch = FetchType.LAZY</code>.
IMPORTANT: Please read the <a href="#guide-jpa-performance.asciidoc">performance guide</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="guide-jpa.asciidoc_cascading-relationships">Cascading Relationships</h5>
<div class="paragraph">
<p>For relations it is also possible to define whether operations are cascaded (like a recursion) to the related entity.
By default, nothing is done in these situations. This can be changed by using the <code>cascade</code> property of the annotation that specifies the relation type (<code>@OneToOne</code>, <code>@ManyToOne</code>, <code>@OneToMany</code>, <code>@ManyToOne</code>). This property accepts a <code>CascadeType</code> that offers the following options:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>PERSIST (for <code>EntityManager.persist</code>, relevant to inserted transient entities into DB)</p>
</li>
<li>
<p>REMOVE (for <code>EntityManager.remove</code> to delete entity from DB)</p>
</li>
<li>
<p>MERGE (for <code>EntityManager.merge</code>)</p>
</li>
<li>
<p>REFRESH (for <code>EntityManager.refresh</code>)</p>
</li>
<li>
<p>DETACH (for <code>EntityManager.detach</code>)</p>
</li>
<li>
<p>ALL (cascade all of the above operations)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>See <a href="http://meri-stuff.blogspot.de/2012/03/jpa-tutorial.html">here</a> for more information.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="guide-jpa.asciidoc_embeddable">11.3.3. Embeddable</h4>
<div class="paragraph">
<p>An embeddable Object is a way to group properties of an <a href="#guide-jpa.asciidoc_entity">entity</a> into a separate Java (child) object. Unlike with implement <a href="#guide-jpa.asciidoc_relationships">relationships</a> the embeddable is not a separate entity and its properties are stored (embedded) in the same table together with the entity. This is helpful to structure and reuse groups of properties.</p>
</div>
<div class="paragraph">
<p>The following example shows an <code>Address</code> implemented as an embeddable class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Embeddable
public class AddressEmbeddable {

  private String street;
  private String number;
  private Integer zipCode;
  private String city;

  @Column(name="STREETNUMBER")
  public String getNumber() {
    return number;
  }

  public void setNumber(String number) {
    this.number = number;
  }

  ...  // other getter and setter methods, equals, hashCode
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see an embeddable is similar to an entity class, but with an <code>@Embeddable</code> annotation instead of the <code>@Entity</code> annotation and without primary key or modification counter.
An Embeddable does not exist on its own but in the context of an entity.
As a simplification Embeddables do not require a separate interface and <a href="guide-transferobject.html#ETO">ETO</a> as the <a href="#guide-beanmapping.asciidoc">bean-mapper</a> will create a copy automatically when converting the owning entity to an ETO.
However, in this case the embeddable becoms part of your <code>api</code> module that therefore needs a dependency on the <code>JPA</code>.</p>
</div>
<div class="paragraph">
<p>In addition to that the methods <code>equals(Object)</code> and <code>hashCode()</code> need to be implemented as this is required by Hibernate (it is not required for entities because they can be unambiguously identified by their primary key). For some hints on how to implement the <code>hashCode()</code> method please have a look <a href="http://stackoverflow.com/questions/113511/hash-code-implementation">here</a>.</p>
</div>
<div class="paragraph">
<p>Using this <code>AddressEmbeddable</code> inside an entity class can be done like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">  private AddressEmbeddable address;

  @Embedded
  public AddressEmbeddable getAddress() {
    return this.address;
  }

  public void setAddress(AddressEmbeddable address) {
    this.address = address;
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>@Embedded</code> annotation needs to be used for embedded attributes. Note that if in all columns of the embeddable (here <code>Address</code>) are <code>null</code>, then the embeddable object itself is also <code>null</code> inside the entity. This has to be considered to avoid NullPointerException&#8217;s. Further this causes some issues with primitive types in embeddable classes that can be avoided by only using object types instead.</p>
</div>
</div>
<div class="sect3">
<h4 id="guide-jpa.asciidoc_inheritance">11.3.4. Inheritance</h4>
<div class="paragraph">
<p>Just like normal java classes, <a href="#guide-jpa.asciidoc_entity">entity</a> classes can inherit from others. The only difference is that you need to specify how to map a class hierarchy to database tables. Generic abstract super-classes for entities can simply be annotated with <code>@MappedSuperclass</code>.</p>
</div>
<div class="paragraph">
<p>For all other cases the JPA offers the annotation <code>@Inheritance</code> with the property <code>strategy</code> talking an <code>InheritanceType</code> that has the following options:</p>
</div>
<div class="openblock">
<div class="content">
<div class="ulist">
<ul>
<li>
<p><code>SINGLE_TABLE</code>: This strategy uses a single table that contains all columns needed to store all entity-types of the entire inheritance hierarchy. If a column is not needed for an entity because of its type, there is a null value in this column. An additional column is introduced, which denotes the type of the entity (called <code>dtype</code>).</p>
</li>
<li>
<p><code>TABLE_PER_CLASS</code>: For each concrete entity class there is a table in the database that can store such an entity with all its attributes. An entity is only saved in the table corresponding to its most concrete type. To get all entities of a super type, joins are needed.</p>
</li>
<li>
<p><code>JOINED</code>: In this case there is a table for every entity class including abstract classes, which contains only the columns for the persistent properties of that particular class. Additionally there is a primary key column in every table. To get an entity of a class that is a subclass of another one, joins are needed.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="paragraph">
<p>Each of the three approaches has its advantages and drawbacks, which are discussed in detail <a href="http://openjpa.apache.org/builds/1.0.4/apache-openjpa-1.0.4/docs/manual/jpa_overview_mapping_inher.html#jpa_overview_mapping_inher_tpc">here</a>. In most cases, the first one should be used, because it is usually the fastest way to do the mapping, as no joins are needed when retrieving, searching or persisting entities. Moreover it is rather simple and easy to understand.
One major disadvantage is that the first approach could lead to a table with a lot of null values, which might have a negative impact on the database size.</p>
</div>
<div class="paragraph">
<p>The inheritance strategy has to be annotated to the top-most entity of the class hierarchy (where `@MappedSuperclass`es are not considered) like in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Entity
@Inheritance(strategy=InheritanceType.SINGLE_TABLE)
public abstract class MyParentEntity extends ApplicationPersistenceEntity implements MyParent {
  ...
}

@Entity
public class MyChildEntity extends MyParentEntity implements MyChild {
  ...
}

@Entity
public class MyOtherEntity extends MyParentEntity implements MyChild {
  ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>As a best practice we advise you to avoid entity hierarchies at all where possible and otherwise to keep the hierarchy as small as possible. In order to just ensure reuse or establish a common API you can consider a shared interface, a <code>@MappedSuperclass</code> or an <code>@Embeddable</code> instead of an entity hierarchy.</p>
</div>
</div>
<div class="sect3">
<h4 id="guide-jpa.asciidoc_repositories-and-daos">11.3.5. Repositories and DAOs</h4>
<div class="paragraph">
<p>For each entity a code unit is created that groups all database operations for that entity. We recommend to use <a href="#guide-repository.asciidoc">spring-data respositories</a> for that as it is most efficient for developers. As an alternative there is still the classic approach using <a href="#guide-dao.asciidoc">DAOs</a>.</p>
</div>
<div class="sect4">
<h5 id="guide-jpa.asciidoc_concurrency-control">Concurrency Control</h5>
<div class="paragraph">
<p>The concurrency control defines the way concurrent access to the same data of a database is handled. When several users (or threads of application servers) concurrently access a database, anomalies may happen, e.g. a transaction is able to see changes from another transaction although that one did, not yet commit these changes. Most of these anomalies are automatically prevented by the database system, depending on the <a href="http://en.wikipedia.org/wiki/Isolation_(database_systems)"><em>isolation level</em></a> (property <code>hibernate.connection.isolation</code> in the <code>jpa.xml</code>, see <a href="http://docs.jboss.org/hibernate/orm/5.0/manual/en-US/html/ch03.html">here</a>).</p>
</div>
<div class="paragraph">
<p>Another anomaly is when two stakeholders concurrently access a record, do some changes and write them back to the database. The JPA addresses this with different locking strategies (see <a href="http://www.objectdb.com/java/jpa/persistence/lock">here</a>).</p>
</div>
<div class="paragraph">
<p>As a best practice we are using optimistic locking for regular end-user <a href="#guide-service-layer.asciidoc">services</a> (OLTP) and pessimistic locking for <a href="#guide-batch-layer.asciidoc">batches</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="guide-jpa.asciidoc_optimistic-locking">Optimistic Locking</h5>
<div class="paragraph">
<p>The class <code>com.devonfw.module.jpa.persistence.api.AbstractPersistenceEntity</code> already provides optimistic locking via a <code>modificationCounter</code> with the <code>@Version</code> annotation. Therefore JPA takes care of optimistic locking for you. When entities are transferred to clients, modified and sent back for update you need to ensure the <code>modificationCounter</code> is part of the game. If you follow our guides about <a href="#guide-transferobject.asciidoc">transfer-objects</a> and <a href="#guide-service-layer.asciidoc">services</a> this will also work out of the box.
You only have to care about two things:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>How to deal with optimistic locking in <a href="#guide-jpa.asciidoc_relationships">relationships</a>?<br>
Assume an entity <code>A</code> contains a collection of <code>B</code> entities. Should there be a locking conflict if one user modifies an instance of <code>A</code> while another user in parallel modifies an instance of <code>B</code> that is contained in the other instance? To address this , take a look at <a href="https://oasp.github.io/oasp4j_content/2.4.0/maven/apidocs/io/oasp/module/jpa/dataaccess/api/GenericDao.html#forceIncrementModificationCounter(E)">GenericDao.forceIncrementModificationCounter</a>.</p>
</li>
<li>
<p>What should happen in the UI if an <code>OptimisticLockException</code> occurred?<br>
According to KISS our recommendation is that the user gets an error displayed that tells him to do his change again on the recent data. Try to design your system and the work processing in a way to keep such conflicts rare and you are fine.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="guide-jpa.asciidoc_pessimistic-locking">Pessimistic Locking</h5>
<div class="paragraph">
<p>For back-end <a href="#guide-service-layer.asciidoc">services</a> and especially for <a href="#guide-batch-layer.asciidoc">batches</a> optimistic locking is not suitable. A human user shall not cause a large batch process to fail because he was editing the same entity. Therefore such use-cases use pessimistic locking what gives them a kind of priority over the human users.
In your <a href="#guide-jpa.asciidoc_data-access-object">DAO</a> implementation you can provide methods that do pessimistic locking via <a href="http://docs.oracle.com/javaee/7/api/javax/persistence/EntityManager.html"><code>EntityManager</code></a> operations that take a <a href="http://docs.oracle.com/javaee/7/api/javax/persistence/LockModeType.html"><code>LockModeType</code></a>. Here is a simple example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">  getEntityManager().lock(entity, LockModeType.READ);</code></pre>
</div>
</div>
<div class="paragraph">
<p>When using the <code>lock(Object, LockModeType)</code> method with <code>LockModeType.READ</code>, Hibernate will issue a <code>SELECT &#8230;&#8203; FOR UPDATE</code>. This means that no one else can update the entity (see <a href="http://docs.oracle.com/cd/B28359_01/server.111/b28286/statements_10002.htm">here</a> for more information on the statement). If <code>LockModeType.WRITE</code> is specified, Hibernate issues a <code>SELECT &#8230;&#8203; FOR UPDATE NOWAIT</code> instead, which has has the same meaning as the statement above, but if there is already a lock, the program will not wait for this lock to be released. Instead, an exception is raised.<br>
Use one of the types if you want to modify the entity later on, for read only access no lock is required.</p>
</div>
<div class="paragraph">
<p>As you might have noticed, the behavior of Hibernate deviates from what one would expect by looking at the <code>LockModeType</code> (especially <code>LockModeType.READ</code> should not cause a <code>SELECT &#8230;&#8203; FOR UPDATE</code> to be issued). The framework actually deviates from what is <a href="http://docs.oracle.com/javaee/7/api/javax/persistence/LockModeType.html">specified</a> in the JPA for unknown reasons.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="guide-jpa.asciidoc_database-auditing">11.3.6. Database Auditing</h4>
<div class="paragraph">
<p>See <a href="#guide-auditing.asciidoc">auditing guide</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="guide-jpa.asciidoc_testing-entities-and-daos">11.3.7. Testing Entities and DAOs</h4>
<div class="paragraph">
<p>See <a href="guide-testing.html#integration-testing">testing guide</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="guide-jpa.asciidoc_principles">11.3.8. Principles</h4>
<div class="paragraph">
<p>We strongly recommend these principles:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Use the JPA where ever possible and use vendor (hibernate) specific features only for situations when JPA does not provide a solution. In the latter case consider first if you really need the feature.</p>
</li>
<li>
<p>Create your entities as simple POJOs and use JPA to annotate the getters in order to define the mapping.</p>
</li>
<li>
<p>Keep your entities simple and avoid putting advanced logic into entity methods.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="guide-jpa.asciidoc_database-configuration">11.3.9. Database Configuration</h4>
<div class="paragraph">
<p>The <a href="#guide-configuration.asciidoc">configuration</a> for spring and hibernate is already provided by devonfw in our sample application and the application template. So you only need to worry about a few things to customize.</p>
</div>
<div class="sect4">
<h5 id="guide-jpa.asciidoc_database-system-and-access">Database System and Access</h5>
<div class="paragraph">
<p>Obviously you need to configure which type of database you want to use as well as the location and credentials to access it. The defaults are configured in <code>application-default.properties</code> that is bundled and deployed with the release of the software. It should therefore contain the properties as in the given example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">  database.url=jdbc:postgresql://database.enterprise.com/app
  database.user.login=appuser01
  database.hibernate.dialect = org.hibernate.dialect.PostgreSQLDialect
  database.hibernate.hbm2ddl.auto=validate</code></pre>
</div>
</div>
<div class="paragraph">
<p>The environment specific settings (especially passwords) are configured by the operators in <code>application.properties</code>. For further details consult the <a href="#guide-configuration.asciidoc">configuration guide</a>. It can also override the default values. The relevant configuration properties can be seen by the following example for the development environment (located in <code>src/test/resources</code>):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">  database.url=jdbc:postgresql://localhost/app
  database.user.password=************
  database.hibernate.hbm2ddl.auto=create</code></pre>
</div>
</div>
<div class="paragraph">
<p>For further details about <code>database.hibernate.hbm2ddl.auto</code> please see <a href="http://docs.jboss.org/hibernate/orm/5.0/manual/en-US/html/ch03.html#configuration-misc-properties">here</a>. For production and acceptance environments we use the value <code>validate</code> that should be set as default. In case you want to use Oracle RDBMS you can find additional hints <a href="guide-oracle.html#driver">here</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="guide-jpa.asciidoc_database-migration">Database Migration</h5>
<div class="paragraph">
<p>See <a href="#guide-database-migration.asciidoc">database migration</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="guide-jpa.asciidoc_database-logging">Database Logging</h5>
<div class="paragraph">
<p>Add the following properties to <code>application.properties</code> to enable logging of database queries for debugging purposes.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">spring.jpa.properties.hibernate.show_sql=true
spring.jpa.properties.hibernate.use_sql_comments=true
spring.jpa.properties.hibernate.format_sql=true</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="guide-jpa.asciidoc_pooling">Pooling</h5>
<div class="paragraph">
<p>You typically want to pool JDBC connections to boost performance by recycling previous connections. There are many libraries available to do connection pooling. We recommend to use <a href="https://github.com/brettwooldridge/HikariCP">HikariCP</a>. For Oracle RDBMS see <a href="guide-oracle.html#pooling">here</a>.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="guide-jpa.asciidoc_security">11.3.10. Security</h4>
<div class="sect4">
<h5 id="guide-jpa.asciidoc_sql-injection">SQL-Injection</h5>
<div class="paragraph">
<p>A common <a href="#guide-security.asciidoc">security</a> threat is <a href="http://en.wikipedia.org/wiki/SQL_injection">SQL-injection</a>. Never build queries with string concatenation or your code might be vulnerable as in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">  String query = "Select op from OrderPosition op where op.comment = " + userInput;
  return getEntityManager().createQuery(query).getResultList();</code></pre>
</div>
</div>
<div class="paragraph">
<p>Via the parameteter <code>userInput</code> an attacker can inject SQL (JPQL) and execute arbitrary statements in the database causing extreme damage. In order to prevent such injections you have to strictly follow our rules for <a href="#guide-jpa.asciidoc_queries">queries</a>: Use named queries for static queries and QueryDSL for dynamic queries. Please also consult the <a href="https://www.owasp.org/index.php/SQL_Injection_Prevention_Cheat_Sheet">SQL Injection Prevention Cheat Sheet</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="guide-jpa.asciidoc_limited-permissions-for-application">Limited Permissions for Application</h5>
<div class="paragraph">
<p>We suggest that you operate your application with a database user that has limited permissions so he can not modify the SQL schema (e.g. drop tables). For initializing the schema (DDL) or to do schema migrations use a separate user that is not used by the application itself.</p>
</div>
<!-- toc disabled -->
</div>
</div>
<div class="sect3">
<h4 id="guide-jpa-query.asciidoc">11.3.11. Queries</h4>
<div class="paragraph">
<p>The <a href="http://www.oracle.com/technetwork/java/javaee/tech/persistence-jsp-140049.html">Java Persistence API (JPA)</a> defines its own query language, the <a href="https://docs.oracle.com/html/E13946_01/ejb3_langref.html"><em>java persistence query language</em> (JPQL)</a> (see also <a href="https://docs.oracle.com/javaee/7/tutorial/persistence-querylanguage.htm">JPQL tutorial</a>), which is similar to SQL but operates on entities and their attributes instead of tables and columns.</p>
</div>
<div class="paragraph">
<p>The simplest CRUD-Queries (e.g. find an entity by its ID) are already build in the devonfw CRUD functionality (via <a href="#guide-repository.asciidoc">Repository</a> or <a href="#guide-dao.asciidoc">DAO</a>). For other cases you need to write your own query. We distinguish between <em>static</em> and <em>dynamic</em> queries. <a href="#guide-jpa-query.asciidoc_static-queries">Static queries</a> have a fixed JPQL query string that may only use parameters to customize the query at runtime. Instead, <a href="#guide-jpa-query.asciidoc_dynamic-queries">dynamic queries</a> can change their clauses (<code>WHERE</code>, <code>ORDER BY</code>, <code>JOIN</code>, etc.) at runtime depending on the given search criteria.</p>
</div>
<div class="sect4">
<h5 id="guide-jpa-query.asciidoc_static-queries">Static Queries</h5>
<div class="paragraph">
<p>E.g. to find all <a href="https://github.com/devonfw/my-thai-star/blob/develop/java/mtsj/core/src/main/java/com/devonfw/application/mtsj/dishmanagement/dataaccess/api/DishEntity.java">DishEntries</a> (from MTS sample app) that have a price not exceeding a given <code>maxPrice</code> we write the following JPQL query:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sql hljs" data-lang="sql">SELECT dish FROM DishEntity dish WHERE dish.price &lt;= :maxPrice</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here <code>dish</code> is used as alias (variable name) for our selected <code>DishEntity</code> (what refers to the simple name of the Java entity class). With <code>dish.price</code> we are referring to the Java property <code>price</code> (<code>getPrice()</code>/<code>setPrice(&#8230;&#8203;)</code>) in <code>DishEntity</code>. A named variable provided from outside (the search criteria at runtime) is specified with a colon (<code>:</code>) as prefix. Here with <code>:maxPrice</code> we reference to a variable that needs to be set via <code>query.setParameter("maxPrice", maxPriceValue)</code>. JPQL also supports indexed parameters (<code>?</code>) but they are discouraged because they easily cause confusion and mistakes.</p>
</div>
<div class="sect5">
<h6 id="guide-jpa-query.asciidoc_using-queries-to-avoid-bidirectional-relationships">Using Queries to Avoid Bidirectional Relationships</h6>
<div class="paragraph">
<p>With the usage of queries it is possible to avoid exposing relationships or modelling bidirectional relationships, which have some disadvantages (see <a href="guide-jpa.html#relationships">relationships</a>). This is especially desired for relationships between entities of different business components.
So for example to get all <a href="https://github.com/devonfw/my-thai-star/blob/develop/java/mtsj/core/src/main/java/com/devonfw/application/mtsj/ordermanagement/dataaccess/api/OrderLineEntity.java">OrderLineEntities</a> for a specific <a href="https://github.com/devonfw/my-thai-star/blob/develop/java/mtsj/core/src/main/java/com/devonfw/application/mtsj/ordermanagement/dataaccess/api/OrderEntity.java">OrderEntity</a> without using the <code>orderLines</code> relation from <code>OrderEntity</code> the following query could be used:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sql hljs" data-lang="sql">SELECT line FROM OrderLineEntity line WHERE line.order.id = :orderId</code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="guide-jpa-query.asciidoc_dynamic-queries">Dynamic Queries</h5>
<div class="paragraph">
<p>For dynamic queries we use <a href="http://www.querydsl.com/">QueryDSL</a>. It allows to implement queries in a powerful but readable and type-safe way (unlike Criteria API). If you already know JPQL you will quickly be able to read and write QueryDSL code. It feels like JPQL but implemented in Java instead of plain text.</p>
</div>
<div class="paragraph">
<p>Please be aware that code-generation can be painful especially with large teams. We therefore recommend to use QueryDSL without code-generation. Here is an example from our sample application:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">  public List&lt;DishEntity&gt; findOrders(DishSearchCriteriaTo criteria) {
    DishEntity dish = Alias.alias(DishEntity.class);
    JPAQuery&lt;OrderEntity&gt; query = newDslQuery(alias); // new JPAQuery&lt;&gt;(getEntityManager()).from(Alias.$(dish));
    Range&lt;BigDecimal&gt; priceRange = criteria.getPriceRange();
    if (priceRange != null) {
      BigDecimal min = priceRange.getMin();
      if (min != null) {
        query.where(Alias.$(order.getPrice()).ge(min));
      }
      BigDecimal max = priceRange.getMax();
      if (max != null) {
        query.where(Alias.$(order.getPrice()).le(max));
      }
    }
    String name = criteria.getName();
    if ((name != null) &amp;&amp; (!name.isEmpty())) {
      // query.where(Alias.$(alias.getName()).eq(name));
      QueryUtil.get().whereString(query, Alias.$(alias.getName()), name, criteria.getNameOption());
    }
    return query.fetch();
  }</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="guide-jpa-query.asciidoc_using-wildcards">Using Wildcards</h5>
<div class="paragraph">
<p>For flexible queries it is often required to allow wildcards (especially in <a href="#guide-jpa-query.asciidoc_dynamic_queries">dynamic queries</a>). While users intuitively expect glob syntax the SQL and JPQL standards work different. Therefore a mapping is required. devonfw provides this on a lower level by <a href="https://github.com/devonfw/devon4j/blob/develop/modules/basic/src/main/java/com/devonfw/module/basic/common/api/query/LikePatternSyntax.java">LikePatternSyntax</a> and on a high level by <a href="https://github.com/devonfw/devon4j/blob/develop/modules/jpa-basic/src/main/java/com/devonfw/module/jpa/dataaccess/api/QueryUtil.java#L54">QueryUtil</a> (see <a href="https://github.com/devonfw/devon4j/blob/develop/modules/jpa-basic/src/main/java/com/devonfw/module/jpa/dataaccess/api/QueryHelper.java#L199">QueryHelper.newStringClause(&#8230;&#8203;)</a>).</p>
</div>
</div>
<div class="sect4">
<h5 id="guide-jpa-query.asciidoc_pagination">Pagination</h5>
<div class="paragraph">
<p>devonfw provides pagination support. If you are using <a href="#guide-repository.asciidoc">spring-data repositories</a> you will get that directly from spring for static queries. Otherwise for dynamic or generally handwritten queries we provide this via <a href="https://github.com/devonfw/devon4j/blob/develop/modules/jpa-basic/src/main/java/com/devonfw/module/jpa/dataaccess/api/QueryUtil.java#L102">QueryUtil.findPaginated(&#8230;&#8203;)</a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">boolean determineTotalHitCount = ...;
return QueryUtil.get().findPaginated(criteria.getPageable(), query, determineTotalHitCount);</code></pre>
</div>
</div>
<div class="sect5">
<h6 id="guide-jpa-query.asciidoc_pagination-example">Pagination example</h6>
<div class="paragraph">
<p>For the table entity we can make a search request by accessing the REST endpoint with pagination support like in the following examples:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">POST mythaistar/services/rest/tablemanagement/v1/table/search
{
  "pagination": {
    "size":2,
    "total":true
  }
}

//Response
{
    "pagination": {
        "size": 2,
        "page": 1,
        "total": 11
    },
    "result": [
        {
            "id": 101,
            "modificationCounter": 1,
            "revision": null,
            "waiterId": null,
            "number": 1,
            "state": "OCCUPIED"
        },
        {
            "id": 102,
            "modificationCounter": 1,
            "revision": null,
            "waiterId": null,
            "number": 2,
            "state": "FREE"
        }
    ]
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
As we are requesting with the <code>total</code> property set to <code>true</code> the server responds with the total count of rows for the query.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>For retrieving a concrete page, we provide the <code>page</code> attribute with the desired value. Here we also left out the <code>total</code> property so the server doesn&#8217;t incur on the effort to calculate it:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">POST mythaistar/services/rest/tablemanagement/v1/table/search
{
  "pagination": {
    "size":2,
    "page":2
  }
}

//Response

{
    "pagination": {
        "size": 2,
        "page": 2,
        "total": null
    },
    "result": [
        {
            "id": 103,
            "modificationCounter": 1,
            "revision": null,
            "waiterId": null,
            "number": 3,
            "state": "FREE"
        },
        {
            "id": 104,
            "modificationCounter": 1,
            "revision": null,
            "waiterId": null,
            "number": 4,
            "state": "FREE"
        }
    ]
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="guide-jpa-query.asciidoc_query-meta-parameters">Query Meta-Parameters</h5>
<div class="paragraph">
<p>Queries can have meta-parameters and that are provided via <code>SearchCriteriaTo</code>. Besides paging (see above) we also get <a href="https://github.com/devonfw/devon4j/blob/develop/modules/jpa-basic/src/main/java/com/devonfw/module/jpa/dataaccess/api/QueryHelper.java#L51">timeout support</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="guide-jpa-query.asciidoc_advanced-queries">Advanced Queries</h5>
<div class="paragraph">
<p>Writing queries can sometimes get rather complex. The current examples given above only showed very simple basics. Within this topic a lot of advanced features need to be considered like:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://www.w3schools.com/sql/sql_join.asp">Joins</a></p>
</li>
<li>
<p><a href="https://docs.oracle.com/html/E13946_04/ejb3_langref.html#ejb3_langref_constructor">Constructor queries</a></p>
</li>
<li>
<p><a href="https://www.w3schools.com/sql/sql_orderby.asp">Order By</a> (Sorting)</p>
</li>
<li>
<p><a href="https://www.w3schools.com/sql/sql_groupby.asp">Grouping</a></p>
</li>
<li>
<p><a href="https://www.w3schools.com/sql/sql_having.asp">Having</a></p>
</li>
<li>
<p><a href="https://www.w3schools.com/sql/sql_union.asp">Unions</a></p>
</li>
<li>
<p><a href="https://docs.oracle.com/cd/E11035_01/kodo41/full/html/ejb3_langref.html#ejb3_langref_subqueries">Sub-Queries</a></p>
</li>
<li>
<p>Aggregation functions like e.g. <a href="https://www.w3schools.com/sql/sql_count_avg_sum.asp">count/avg/sum</a></p>
</li>
<li>
<p><a href="https://www.w3schools.com/sql/sql_distinct.asp">Distinct selections</a></p>
</li>
<li>
<p>SQL Hints (see e.g. <a href="https://docs.oracle.com/cd/B19306_01/server.102/b14211/hintsref.htm#i8327">Oracle hints</a> or <a href="http://sqlhints.com/">SQL-Server hints</a>) - only when required for ultimate performance tuning</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This list is just containing the most important aspects. As we can not cover all these topics here, they are linked to external documentation that can help and guide you.</p>
</div>
<!-- toc disabled -->
</div>
</div>
<div class="sect3">
<h4 id="guide-repository.asciidoc">11.3.12. Spring-Data</h4>
<div class="paragraph">
<p>If you are using the springframework and have no restrictions regarding that, we recommend to use <a href="https://projects.spring.io/spring-data-jpa/">spring-data-jpa</a> via <a href="http://repo1.maven.org/maven2/com/devonfw/java/starters/devon4j-starter-spring-data-jpa/3.0.0/">devon4j-starter-spring-data-jpa</a> that brings advanced integration (esp. for QueryDSL).</p>
</div>
<div class="sect4">
<h5 id="guide-repository.asciidoc_motivation">Motivation</h5>
<div class="paragraph">
<p>The benefits of spring-data are (for examples and explanations see next sections):</p>
</div>
<div class="ulist">
<ul>
<li>
<p>All you need is one single repository interface for each entity. No need for a separate implementation or other code artefacts like XML descriptors, <code>NamedQueries</code> class, etc.</p>
</li>
<li>
<p>You have all information together in one place (the repository interface) that actually belong together (where as in the classic approach you have the static <a href="#guide-jpa-query.asciidoc">queries</a> in an XML file, constants to them in <code>NamedQueries</code> class and referencing usages in DAO implementation classes).</p>
</li>
<li>
<p>Static <a href="#guide-jpa-query.asciidoc">queries</a> are most simple to realize as you do not need to write any method body. This means you can develop faster.</p>
</li>
<li>
<p>Support for paging is already build-in. Again for static <a href="#guide-jpa-query.asciidoc">query</a> method the is nothing you have to do except using the paging objects in the signature.</p>
</li>
<li>
<p>Still you have the freedom to write custom implementations via default methods within the repository interface (e.g. for dynamic queries).</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="guide-repository.asciidoc_repository">Repository</h5>
<div class="paragraph">
<p>For each entity <code>«Entity»Entity</code> an interface is created with the name <code>«Entity»Repository</code> extending <a href="https://github.com/devonfw/devon4j/blob/develop/modules/jpa-spring-data/src/main/java/com/devonfw/module/jpa/dataaccess/api/data/DefaultRepository.java"><code>DefaultRepository</code></a>.
Such repository is the analogy to a <a href="#guide-dao.asciidoc">Data-Access-Object (DAO)</a> used in the classic approach or when spring-data is not an option.</p>
</div>
<div class="sect5">
<h6 id="guide-repository.asciidoc_example">Example</h6>
<div class="paragraph">
<p>The following example shows how to write such a repository:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public interface ExampleRepository extends DefaultRepository&lt;ExampleEntity&gt; {

  @Query("SELECT example FROM ExampleEntity example" //
      + " WHERE example.name = :name")
  List&lt;ExampleEntity&gt; findByName(@Param("name") String name);

  @Query("SELECT example FROM ExampleEntity example" //
      + " WHERE example.name = :name")
  Page&lt;ExampleEntity&gt; findByNamePaginated(@Param("name") String name, Pageable pageable);

  default Page&lt;ExampleEntity&gt; findByCriteria(ExampleSearchCriteriaTo criteria) {
    ExampleEntity alias = newDslAlias();
    JPAQuery&lt;ExampleEntity&gt; query = newDslQuery(alias);
    String name = criteria.getName();
    if ((name != null) &amp;&amp; !name.isEmpty()) {
      QueryUtil.get().whereString(query, $(alias.getName()), name, criteria.getNameOption());
    }
    return QueryUtil.get().findPaginated(criteria.getPageable(), query, false);
  }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This <code>ExampleRepository</code> has the following features:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>CRUD support from spring-data (see <a href="https://docs.spring.io/spring-data/data-jpa/docs/current/api/org/springframework/data/jpa/repository/JpaRepository.html">JavaDoc</a> for details).</p>
</li>
<li>
<p>Support for <a href="https://github.com/devonfw/devon4j/blob/develop/modules/jpa-spring-data/src/main/java/com/devonfw/module/jpa/dataaccess/api/data/QueryDslSupport.java">QueryDSL integration</a>, <a href="https://github.com/devonfw/devon4j/blob/develop/modules/jpa-basic/src/main/java/com/devonfw/module/jpa/dataaccess/api/QueryUtil.java">paging and more</a> as well as <a href="https://github.com/devonfw/devon4j/blob/develop/modules/jpa-basic/src/main/java/com/devonfw/module/jpa/dataaccess/api/feature/FeatureForceIncrementModificationCounter.java">locking</a> via <a href="https://github.com/devonfw/devon4j/blob/develop/modules/jpa-spring-data/src/main/java/com/devonfw/module/jpa/dataaccess/api/data/GenericRepository.java">GenericRepository</a></p>
</li>
<li>
<p>A static <a href="#guide-jpa-query.asciidoc">query</a> method <code>findByName</code> to find all <code>ExampleEntity</code> instances from DB that have the given name. Please note the <code>@Param</code> annotation that links the method parameter with the variable inside the query (<code>:name</code>).</p>
</li>
<li>
<p>The same with pagination support via <code>findByNamePaginated</code> method.</p>
</li>
<li>
<p>A dynamic <a href="#guide-jpa-query.asciidoc">query</a> method <code>findByCriteria</code> showing the QueryDSL and paging integration into spring-data provided by devon.</p>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="guide-repository.asciidoc_further-examples">Further examples</h6>
<div class="paragraph">
<p>You can also read the JUnit test-case <a href="https://github.com/devonfw/devon4j/blob/develop/starters/starter-spring-data-jpa/src/test/java/com/devonfw/module/jpa/dataaccess/api/DefaultRepositoryTest.java">DefaultRepositoryTest</a> that is testing an example
<a href="https://github.com/devonfw/devon4j/blob/develop/starters/starter-spring-data-jpa/src/test/java/com/devonfw/example/component/dataaccess/api/FooRepository.java">FooRepository</a>.</p>
</div>
</div>
<div class="sect5">
<h6 id="guide-repository.asciidoc_auditing">Auditing</h6>
<div class="paragraph">
<p>In case you need <a href="#guide-auditing.asciidoc">auditing</a>, you only need to extend <code>DefaultRevisionedRepository</code> instead of <code>DefaultRepository</code>. The auditing methods can be found in <a href="https://github.com/devonfw/devon4j/blob/develop/modules/jpa-spring-data/src/main/java/com/devonfw/module/jpa/dataaccess/api/data/GenericRevisionedRepository.java">GenericRevisionedRepository</a>.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="guide-repository.asciidoc_dependency">Dependency</h5>
<div class="paragraph">
<p>In case you want to switch to or add spring-data support to your devon application all you need is this maven dependency:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;!-- Starter for consuming REST services --&gt;
&lt;dependency&gt;
  &lt;groupId&gt;com.devonfw.java.starters&lt;/groupId&gt;
  &lt;artifactId&gt;devon4j-starter-spring-data-jpa&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="guide-repository.asciidoc_drawbacks">Drawbacks</h5>
<div class="paragraph">
<p>Spring-data also has some drawbacks:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Some kind of magic behind the scenes that are not so easy to understand. So in case you want to extend all your repositories without providing the implementation via a default method in a parent repository interface you need to deep-dive into spring-data. We assume that you do not need that and hope what spring-data and devon already provides out-of-the-box is already sufficient.</p>
</li>
<li>
<p>The spring-data magic also includes guessing the query from the method name. This is not easy to understand and especially to debug. Our suggestion is not to use this feature at all and either provide a <code>@Query</code> annotation or an implementation via default method.</p>
</li>
</ul>
</div>
<!-- toc disabled -->
</div>
</div>
<div class="sect3">
<h4 id="guide-dao.asciidoc">11.3.13. Data Access Object</h4>
<div class="paragraph">
<p>The <em>Data Acccess Objects</em> (DAOs) are part of the persistence layer.
They are responsible for a specific <a href="#guide-dao.asciidoc_entity">entity</a> and should be named <code>«Entity»Dao</code> and <code>«Entity»DaoImpl</code>.
The DAO offers the so called CRUD-functionalities (create, retrieve, update, delete) for the corresponding entity.
Additionally a DAO may offer advanced operations such as <a href="#guide-jpa-query.asciidoc">query</a> or locking methods.</p>
</div>
<div class="sect4">
<h5 id="guide-dao.asciidoc_dao-interface">DAO Interface</h5>
<div class="paragraph">
<p>For each DAO there is an interface named <code>«Entity»Dao</code> that defines the API. For CRUD support and common naming we derive it from the <code>ApplicationDao</code> interface that comes with the devon application template:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public interface MyEntityDao extends ApplicationDao&lt;MyEntity&gt; {
  List&lt;MyEntity&gt; findByCriteria(MyEntitySearchCriteria criteria);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>All CRUD operations are inherited from <code>ApplicationDao</code> so you only have to declare the additional methods.</p>
</div>
</div>
<div class="sect4">
<h5 id="guide-dao.asciidoc_dao-implementation">DAO Implementation</h5>
<div class="paragraph">
<p>Implementing a DAO is quite simple. We create a class named <code>«Entity»DaoImpl</code> that extends <code>ApplicationDaoImpl</code> and implements your <code>«Entity»Dao</code> interface:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class MyEntityDaoImpl extends ApplicationDaoImpl&lt;MyEntity&gt; implements MyEntityDao {

  public List&lt;MyEntity&gt; findByCriteria(MyEntitySearchCriteria criteria) {
    TypedQuery&lt;MyEntity&gt; query = createQuery(criteria, getEntityManager());
    return query.getResultList();
  }
  ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Again you only need to implement the additional non-CRUD methods that you have declared in your <code>«Entity»Dao</code> interface.
In the DAO implementation you can use the method <code>getEntityManager()</code> to access the <code>EntityManager</code> from the JPA. You will need the <code>EntityManager</code> to create and execute <a href="#guide-jpa-query.asciidoc">queries</a>.</p>
</div>
<div class="sect5">
<h6 id="guide-dao.asciidoc_static-queries-for-dao-implementation">Static queries for DAO Implementation</h6>
<div class="paragraph">
<p>All static <a href="#guide-jpa-query.asciidoc">queries</a> are declared in the file <code>src\main\resources\META-INF\orm.xml</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;entity-mappings version="1.0" xmlns="http://java.sun.com/xml/ns/persistence/orm" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xsi:schemaLocation="http://java.sun.com/xml/ns/persistence/orm http://java.sun.com/xml/ns/persistence/orm_1_0.xsd"&gt;
  &lt;named-query name="find.dish.with.max.price"&gt;
    &lt;query&gt;&lt;![SELECT dish FROM DishEntity dish WHERE dish.price &lt;= :maxPrice]]&gt;&lt;/query&gt;
  &lt;/named-query&gt;
  ...
&lt;/hibernate-mapping&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>When your application is started, all these static queries will be created as prepared statements. This allows better performance and also ensures that you get errors for invalid JPQL queries when you start your app rather than later when the query is used.</p>
</div>
<div class="paragraph">
<p>To avoid redundant occurrences of the query name (<code>get.open.order.positions.for.order</code>) we define a constant for each named query:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class NamedQueries {
  public static final String FIND_DISH_WITH_MAX_PRICE = "find.dish.with.max.price";
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that changing the name of the java constant (<code>FIND_DISH_WITH_MAX_PRICE</code>) can be done easily with refactoring. Further you can trace where the query is used by searching the references of the constant.</p>
</div>
<div class="paragraph">
<p>The following listing shows how to use this query:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public List&lt;DishEntity&gt; findDishByMaxPrice(BigDecimal maxPrice) {
  Query query = getEntityManager().createNamedQuery(NamedQueries.FIND_DISH_WITH_MAX_PRICE);
  query.setParameter("maxPrice", maxPrice);
  return query.getResultList();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Via <code>EntityManager.createNamedQuery(String)</code> we create an instance of <code>Query</code> for our predefined static query.
Next we use <code>setParameter(String, Object)</code> to provide a parameter (<code>maxPrice</code>) to the query. This has to be done for all parameters of the query.</p>
</div>
<div class="paragraph">
<p>Note that using the <code>createQuery(String)</code> method, which takes the entire query as string (that may already contain the parameter) is not allowed to avoid SQL injection vulnerabilities.
When the method <code>getResultList()</code> is invoked, the query is executed and the result is delivered as <code>List</code>. As an alternative, there is a method called <code>getSingleResult()</code>, which returns the entity if the query returned exactly one and throws an exception otherwise.</p>
</div>
<!-- toc disabled -->
</div>
</div>
</div>
<div class="sect3">
<h4 id="guide-jpa-performance.asciidoc">11.3.14. JPA Performance</h4>
<div class="paragraph">
<p>When using JPA the developer sometimes does not see or understand where and when statements to the database are triggered.</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>Establishing expectations Developers shouldn’t expect to sprinkle magic pixie dust on POJOs in hopes they will become persistent.</p>
</div>
</blockquote>
<div class="attribution">
&#8212; Dan Allen<br>
<cite>https://epdf.tips/seam-in-action.html</cite>
</div>
</div>
<div class="paragraph">
<p>So in case you do not understand what is going on under the hood of JPA, you will easily run into performance issues due to lazy loading and other effects.</p>
</div>
<div class="sect4">
<h5 id="guide-jpa-performance.asciidoc_n-plus-1-problem">N plus 1 Problem</h5>
<div class="paragraph">
<p>The most prominent phenomena is call the <em>N+1 Problem</em>.
We use entities from our <a href="https://github.com/devonfw/my-thai-star">MTS</a> demo app as an example to explain the problem.
There is a <a href="https://github.com/devonfw/my-thai-star/blob/develop/java/mtsj/core/src/main/java/com/devonfw/application/mtsj/dishmanagement/dataaccess/api/DishEntity.java">DishEntity</a> that has a <code>@ManyToMany</code> relation to
<a href="https://github.com/devonfw/my-thai-star/blob/develop/java/mtsj/core/src/main/java/com/devonfw/application/mtsj/dishmanagement/dataaccess/api/IngredientEntity.java">IngredientEntity</a>.
Now we assume that we want to iterate all ingredients for a dish like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">DishEntity dish = dao.findDishById(dishId);
BigDecimal priceWithAllExtras = dish.getPrice();
for (IngredientEntity ingredient : dish.getExtras()) {
  priceWithAllExtras = priceWithAllExtras.add(ingredient.getPrice());
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now <code>dish.getExtras()</code> is loaded lazy. Therefore the JPA vendor will provide a list with lazy initialized instances of <code>IngredientEntity</code> that only contain the ID of that entity. Now with every call of <code>ingredient.getPrice()</code> we technically trigger an SQL query statement to load the specific <code>IngredientEntity</code> by its ID from the database.
Now <code>findDishById</code> caused 1 initial query statement and for any number <code>N</code> of ingredients we are causing an additional query statement. This makes a total of <code>N+1</code> statements. As causing statements to the database is an expensive operation with a lot of overhead (creating connection, etc.) this ends in bad performance and is therefore a problem (the N+1 Problem).</p>
</div>
</div>
<div class="sect4">
<h5 id="guide-jpa-performance.asciidoc_solving-n-plus-1-problem">Solving N plus 1 Problem</h5>
<div class="paragraph">
<p>To solve the N+1 Problem you need to change your code to only trigger a single statement instead. This can be archived in various ways. The most universal solution is to use <code>FETCH JOIN`s in order to pre-load the nested `N</code> child entities into the first level cache of the JPA vendor implementation. This will behave as if the <code>@ManyToMany</code> relation to <code>IngredientEntity</code> was having <code>FetchType.EAGER</code> but only for the that specific query and not in general. Because changing <code>@ManyToMany</code> to <code>FetchType.EAGER</code> would cause bad performance for other usecases where only the dish but not its extra ingredients are needed. For this reason all relations, including <code>@OneToOne</code> should always be <code>FetchType.LAZY</code>. Back to our example we simply replace <code>dao.findDishById(dishId)</code> with <code>dao.findDishWithExtrasById(dishId)</code> that we implement by the following JPQL query:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sql hljs" data-lang="sql">SELECT dish FROM DishEntity dish
  LEFT JOIN FETCH dish.extras
  WHERE dish.id = :dishId</code></pre>
</div>
</div>
<div class="paragraph">
<p>The rest of the code does not have to be changed but now <code>dish.getExtras()</code> will get the <code>IngredientEntity</code> from the first level cache where is was fetched by the initial query above.</p>
</div>
<div class="paragraph">
<p>Please note that if you only need the sum of the prices from the extras you can also create a query using an aggregator function:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>SELECT sum(dish.extras.price) FROM DishEntity dish</pre>
</div>
</div>
<div class="paragraph">
<p>As you can see you need to understand the concepts in order to get good performance.</p>
</div>
<div class="paragraph">
<p>There are many advanced topics such as creating database indexes or calculating statistics for the query optimizer to get the best performance. For such advanced topics we recommend to have a database expert in your team that cares about such things. However, understanding the <em>N+1 Problem</em> and its solutions is something that every Java developer in the team needs to understand.</p>
</div>
<!-- toc disabled -->
</div>
</div>
</div>
<div class="sect2">
<h3 id="guide-auditing.asciidoc">11.4. Auditing</h3>
<div class="paragraph">
<p>For database auditing we use <a href="http://envers.jboss.org/">hibernate envers</a>. If you want to use auditing ensure you have the following dependency in your pom.xml:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;dependency&gt;
  &lt;groupId&gt;com.devonfw.java.modules&lt;/groupId&gt;
  &lt;artifactId&gt;devon4j-jpa-envers&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Make sure that entity manager also scans the package from the devon4j-jpa[-envers] module in order to work properly. And make sure that correct Repository Factory Bean Class is chosen.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@EntityScan(basePackages = { "«my.base.package»" }, basePackageClasses = { AdvancedRevisionEntity.class })
...
@EnableJpaRepositories(repositoryFactoryBeanClass = GenericRevisionedRepositoryFactoryBean.class)
...
public class SpringBootApp {
  ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now let your [Entity]Repository extend from DefaultRevisionedRepository instead of DefaultRepository.</p>
</div>
<div class="paragraph">
<p>The repository now has a method getRevisionHistoryMetadata(id) and getRevisionHistoryMetadata(id, boolean lazy) available to get a list of revisions for a given entity and a method find(id, revision) to load a specific revision of an entity with the given ID or getLastRevisionHistoryMetadata(id) to load last revision.
To enable auditing for a entity simply place the @Audited annotation to your entity and all entity classes it extends from.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Entity(name = "Drink")
@Audited
public class DrinkEntity extends ProductEntity implements Drink {
...</code></pre>
</div>
</div>
<div class="paragraph">
<p>When auditing is enabled for an entity an additional database table is used to store all changes to the entity table and a corresponding revision number. This table is called &lt;ENTITY_NAME&gt;_AUD per default. Another table called REVINFO is used to store all revisions. Make sure that these tables are available. They can be generated by hibernate with the following property (only for development environments).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">  database.hibernate.hbm2ddl.auto=create</code></pre>
</div>
</div>
<div class="paragraph">
<p>Another possibility is to put them in your <a href="#guide-database-migration.asciidoc">database migration</a> scripts like so.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sql hljs" data-lang="sql">CREATE CACHED TABLE PUBLIC.REVINFO(
  id BIGINT NOT NULL generated by default as identity (start with 1),
  timestamp BIGINT NOT NULL,
  user VARCHAR(255)
);
...
CREATE CACHED TABLE PUBLIC.&lt;TABLE_NAME&gt;_AUD(
    &lt;ALL_TABLE_ATTRIBUTES&gt;,
    revtype TINYINT,
    rev BIGINT NOT NULL
);</code></pre>
</div>
</div>
<!-- toc disabled -->
</div>
<div class="sect2">
<h3 id="guide-transactions.asciidoc">11.5. Transaction Handling</h3>
<div class="paragraph">
<p>Transactions are technically processed by the <a href="#guide-dataaccess-layer.asciidoc">data access layer</a>. However, the transaction control has to be performed in upper layers. To avoid dependencies on persistence layer and technical code in upper layers, we use <a href="#guide-aop.asciidoc">AOP</a> to add transaction control via annotations as aspect.</p>
</div>
<div class="paragraph">
<p>We recommend using the <code>@Transactional</code> annotation (the JEE standard <code>javax.transaction.Transactional</code> rather than <code>org.springframework.transaction.annotation.Transactional</code>). We use this annotation in the <a href="#guide-logic-layer.asciidoc">logic layer</a> to annotate business methods that participate in transactions (what typically applies to most up to all business components):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">  @Transactional
  public MyDataTo getData(MyCriteriaTo criteria) {
    ...
  }</code></pre>
</div>
</div>
<div class="paragraph">
<p>In case a <a href="#guide-service-layer.asciidoc">service operation</a> should invoke multiple use-cases, you would end up with multiple transactions what is undesired (what if the first TX succeeds and then the second TX fails?). Therefore you would then also annotate the service operation. This is not proposed as a pattern in any case as in some rare cases you need to handle constraint-violations from the database to create a specific business exception (with specified message). In such case you have to surround the transaction with a <code>try {} catch</code> statement what is not working if that method itself is <code>@Transactional</code>.</p>
</div>
<div class="sect3">
<h4 id="guide-transactions.asciidoc_batches">11.5.1. Batches</h4>
<div class="paragraph">
<p>Transaction control for batches is a lot more complicated and is described in the <a href="#guide-batch-layer.asciidoc">batch layer</a>.</p>
</div>
<!-- toc disabled -->
</div>
</div>
<div class="sect2">
<h3 id="guide-sql.asciidoc">11.6. SQL</h3>
<div class="paragraph">
<p>For general guides on dealing or avoiding SQL, preventing SQL-injection, etc. you should study <a href="#guide-dataaccess-layer.asciidoc">data-access layer</a>.</p>
</div>
<div class="sect3">
<h4 id="guide-sql.asciidoc_naming-conventions">11.6.1. Naming Conventions</h4>
<div class="paragraph">
<p>Here we define naming conventions that you should follow whenever you write SQL files:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>All SQL-Keywords in UPPER CASE</p>
</li>
<li>
<p>Table names in upper CamlCase (e.g. <code>RestaurantOrder</code>)</p>
</li>
<li>
<p>Column names in camlCase (e.g. <code>drinkState</code>)</p>
</li>
<li>
<p>Indentation should be 2 spaces as suggested by devonfw for every format.</p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="guide-sql.asciidoc_ddl">DDL</h5>
<div class="paragraph">
<p>For DDLs follow these additional guidelines:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>ID column names without underscore (e.g. <code>tableId</code>)</p>
</li>
<li>
<p>Define columns and constraints inline in the statement to create the table</p>
</li>
<li>
<p>Indent column types so they all start in the same text column</p>
</li>
<li>
<p>Constraints should be named explicitly (to get a reasonable hint error messages) with:</p>
<div class="ulist">
<ul>
<li>
<p><code>PK_{table}</code> for primary key (name optional here as PK constraint are fundamental)</p>
</li>
<li>
<p><code>FK_{table}_{property}</code> for foreign keys (<code>{table}</code> and <code>{property}</code> are both on the source where the foreign key is defined)</p>
</li>
<li>
<p><code>UC_{table}_{property}[_{propertyN}]*</code> for unique constraints</p>
</li>
<li>
<p><code>CK_{table}_{check}</code> for check constraints (<code>{check}</code> describes the check, if it is defined on a single property it should start with the property).</p>
</li>
</ul>
</div>
</li>
<li>
<p>Databases have hard limitations for names (e.g. 30 characters). If you have to shorten names try to define common abbreviations in your project for according (business) terms. Especially do not just truncate the names at the limit.</p>
</li>
<li>
<p>If possible add comments on table and columns to help DBAs understanding your schema. This is also honored by many tools (not only DBA-tools).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Here is a brief example of a DDL:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sql hljs" data-lang="sql">CREATE SEQUENCE HIBERNATE_SEQUENCE START WITH 1000000;

-- *** Table ***
CREATE TABLE Table (
  id BIGINT NOT NULL AUTO_INCREMENT,
  modificationCounter INTEGER NOT NULL,
  seatsNumber INTEGER NOT NULL,
  CONSTRAINT PK_Table PRIMARY KEY(id)
);

-- *** UserRole ***
CREATE TABLE UserRole (
  id BIGINT NOT NULL AUTO_INCREMENT,
  modificationCounter INTEGER NOT NULL,
  name VARCHAR (255),
  active BOOLEAN,
  CONSTRAINT PK_UserRole PRIMARY KEY(id)
-- *** User ***
CREATE TABLE User (
  id BIGINT NOT NULL AUTO_INCREMENT,
  modificationCounter INTEGER NOT NULL,
  username VARCHAR (255) NULL,
  password VARCHAR (255) NULL,
  email VARCHAR (120) NULL,
  idRole BIGINT NOT NULL,
  CONSTRAINT PK_User PRIMARY KEY(id),
  CONSTRAINT PK_User_idRole FOREIGN KEY(idRole) REFERENCES UserRole(id) NOCHECK
);
COMMENT ON TABLE User is 'The users of the restaurant site';
...</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="guide-sql.asciidoc_data">Data</h5>
<div class="paragraph">
<p>For insert, update, delete, etc. of data SQL scripts should additionally follow these guidelines:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Inserts always with the same order of columns in blocks for each table.</p>
</li>
<li>
<p>Insert column values always starting with id, modificationCounter, [dtype, ] &#8230;&#8203;</p>
</li>
<li>
<p>List columns with fixed length values (boolean, number, enums, etc.) before columns with free text to support alignment of multiple insert statements</p>
</li>
<li>
<p>Pro Tip: Get familiar with column mode of <code>notepad++</code> when editing large blocks of similar insert statements.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>INSERT INTO UserRole(id, modificationCounter, name, active) VALUES (0, 1, 'Customer', true);
INSERT INTO UserRole(id, modificationCounter, name, active) VALUES (1, 1, 'Waiter', true);
INSERT INTO User(id, modificationCounter, username, password, email, idRole) VALUES (0, 1, 'user0', 'password', 'user0@mail.com', 0);
INSERT INTO User(id, modificationCounter, username, password, email, idRole) VALUES (1, 1, 'waiter', 'waiter', 'waiter@mail.com', 1);

INSERT INTO Table(id, modificationCounter, seatsNumber) VALUES (0, 1, 4);
INSERT INTO Table(id, modificationCounter, seatsNumber) VALUES (1, 1, 4);
INSERT INTO Table(id, modificationCounter, seatsNumber) VALUES (2, 1, 4);
INSERT INTO Table(id, modificationCounter, seatsNumber) VALUES (3, 1, 4);
INSERT INTO Table(id, modificationCounter, seatsNumber) VALUES (4, 1, 6);
INSERT INTO Table(id, modificationCounter, seatsNumber) VALUES (5, 1, 6);
INSERT INTO Table(id, modificationCounter, seatsNumber) VALUES (6, 1, 6);
INSERT INTO Table(id, modificationCounter, seatsNumber) VALUES (7, 1, 8);
INSERT INTO Table(id, modificationCounter, seatsNumber) VALUES (8, 1, 8);
...</pre>
</div>
</div>
<div class="paragraph">
<p>See also <a href="#guide-database-migration.asciidoc">Database Migrations</a>.</p>
</div>
<!-- toc disabled -->
</div>
</div>
</div>
<div class="sect2">
<h3 id="guide-database-migration.asciidoc">11.7. Database Migration</h3>
<div class="paragraph">
<p>For database migrations we use <a href="http://flywaydb.org/">Flyway</a>.
As illustrated <a href="https://flywaydb.org/getstarted/why">here</a> database migrations have three advantages:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Recreate a database from scratch</p>
</li>
<li>
<p>Make it clear at all times what state a database is in</p>
</li>
<li>
<p>Migrate in a deterministic way from your current version of the database to a newer one</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Flyway can be used standalone or can be integrated via its <a href="https://flywaydb.org/documentation/api/javadoc/index.html?org/flywaydb/core/Flyway.html">API</a> to make sure the database migration takes place on startup.</p>
</div>
<div class="sect3">
<h4 id="guide-database-migration.asciidoc_organizational-advice">11.7.1. Organizational Advice</h4>
<div class="paragraph">
<p>A few considerations with respect to project organization will help to implement maintainable Flyway migrations.</p>
</div>
<div class="paragraph">
<p>At first, testing and production environments must be clearly and consistently distinguished. Use the following directory structure to achieve this distinction:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-text hljs" data-lang="text">  src/main/resources/db
  src/test/resources/db</code></pre>
</div>
</div>
<div class="paragraph">
<p>Although this structure introduces redundancies, the benefit overweights this disadvantage.
An even more fine-grained production directory structure which contains one subfolder per release should be implemented:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-text hljs" data-lang="text">  src/main/resources/db/migration/releases/X.Y/x.sql</code></pre>
</div>
</div>
<div class="paragraph">
<p>Emphasizing that migration scripts below the current version must never be changed will aid the second advantage of migrations: it will always be clearly reproducible in which state the database currently is.
Here, it is important to mention that, if test data is required, it must be managed separately from the migration data in the following directory:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-text hljs" data-lang="text">  src/test/resources/db/migration/</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>migration</code> directory is added to aid easy usage of Flyway defaults.
Of course, test data should also be managed per release as like production data.</p>
</div>
<div class="paragraph">
<p>With regard to content, separation of concerns (SoC) is an important goal. SoC can be achieved by distinguishing and writing multiple scripts with respect to business components/use cases (or database tables in case of large volumes of master data <sup class="footnote">[<a id="_footnoteref_1" class="footnote" href="#_footnotedef_1" title="View footnote.">1</a>]</sup>. Comprehensible file names aid this separation.</p>
</div>
<div class="paragraph">
<p>It is important to have clear responsibilities regarding the database, the persistence layer (JPA), and migrations. Therefore a dedicated database expert should be in charge of any migrations performed or she should at least be informed before any change to any of the mentioned parts is applied.</p>
</div>
</div>
<div class="sect3">
<h4 id="guide-database-migration.asciidoc_technical-configuration">11.7.2. Technical Configuration</h4>
<div class="paragraph">
<p>Database migrations can be <a href="http://flywaydb.org/documentation/migration/sql.html">SQL</a> based or <a href="http://flywaydb.org/documentation/migration/java.html">Java</a> based.</p>
</div>
<div class="paragraph">
<p>To enable auto migration on startup (not recommended for productive environment) set the following property in the <code>application.properties</code> file for an environment.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">flyway.enabled=true
flyway.clean-on-validation-error=false</code></pre>
</div>
</div>
<div class="paragraph">
<p>For development environment it is helpful to set both properties to <code>true</code> in order to simplify development. For regular environments <code>flyway.clean-on-validation-error</code> should be <code>false</code>.</p>
</div>
<div class="paragraph">
<p>If you want to use Flyway set the following property in any case to prevent Hibernate from doing changes on the database (pre-configured by default in devonfw):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">spring.jpa.hibernate.ddl-auto=validate</code></pre>
</div>
</div>
<div class="paragraph">
<p>The setting must be communicated to and coordinated with the customer and their needs.
In acceptance testing the same configuration as for the production environment should be enabled.</p>
</div>
<div class="paragraph">
<p>Since migration scripts will also be versioned the end-of-line (EOL) style must be fixated according to <a href="https://github.com/flyway/flyway/issues/253">this issue</a>. This is however solved in flyway 4.0+ and the latest devonfw release.
Also, the version numbers of migration scripts should not consist of simple ascending integer numbers like V0001<em>&#8230;&#8203;, V0002</em>&#8230;&#8203;, &#8230;&#8203; This naming may lead to problems when merging branches. Instead the usage of timestamps as version numbers will help to avoid such problems.</p>
</div>
</div>
<div class="sect3">
<h4 id="guide-database-migration.asciidoc_naming-conventions">11.7.3. Naming Conventions</h4>
<div class="paragraph">
<p>Database migrations should follow this naming convention:
V&lt;version&gt;__&lt;description&gt; (e.g.: V12345__Add_new_table.sql).</p>
</div>
<div class="paragraph">
<p>It is also possible to use Flyway for test data. To do so place your test data migrations in src/main/resources/db/testdata/ and set property</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">flyway.locations=classpath:db/migration/releases,classpath:db/migration/testdata</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then Flyway scans the additional location for migrations and applies all in the order specified by their version. If migrations V0001__... and V0002__... exist and a test data migration should be applied in between you can name it V0001_1__....</p>
</div>
<!-- toc disabled -->
</div>
</div>
<div class="sect2">
<h3 id="guide-hana.asciidoc">11.8. SAP HANA</h3>
<div class="paragraph">
<p>This section contains hints for those who use <a href="https://www.sap.com/products/hana.html">SAP HANA</a>, a very powerful and fast RDBMS. If you have choosen a different persistence technology on purpose you can simply ignore this guide. Besides general hints about the driver there are tips for more tight integration with other SAP features or products.</p>
</div>
<div class="sect3">
<h4 id="guide-hana.asciidoc_driver">11.8.1. Driver</h4>
<div class="paragraph">
<p>The hana JDBC driver is available in Maven Central what makes your life very easy. All you need is the following maven dependency:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>&lt;dependency&gt;
  &lt;groupId&gt;com.sap.cloud.db.jdbc&lt;/groupId&gt;
  &lt;artifactId&gt;ngdbc&lt;/artifactId&gt;
  &lt;version&gt;${hana.driver.version}&lt;/version&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The variable <code>hana.driver.version</code> may be <code>2.3.55</code>, but check yourself at <a href="http://central.maven.org/maven2/com/sap/cloud/db/jdbc/ngdbc/" class="bare">http://central.maven.org/maven2/com/sap/cloud/db/jdbc/ngdbc/</a> for the proper or most recent version.</p>
</div>
</div>
<div class="sect3">
<h4 id="guide-hana.asciidoc_developer-usage">11.8.2. Developer Usage</h4>
<div class="paragraph">
<p>For your local development environment you will love the free <a href="https://developers.sap.com/topics/sap-hana-express.html">SAP HANA, Express Edition</a>.</p>
</div>
<div class="paragraph">
<p>You can run HANA in several ways:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>On-premise</p>
<div class="ulist">
<ul>
<li>
<p>Via a <a href="https://developers.sap.com/germany/tutorials/hxe-ua-install-using-docker.html">Docker image</a> (Linux only)</p>
</li>
<li>
<p>Via a pre-configured <a href="https://developers.sap.com/group.hxe-install-vm.html">virtual machine</a> (Windows, Linux, OS X)</p>
</li>
<li>
<p>Installed natively on your <a href="https://developers.sap.com/group.hxe-install-binary.html">local machine</a> (Linux only)</p>
</li>
</ul>
</div>
</li>
<li>
<p>In the cloud</p>
<div class="ulist">
<ul>
<li>
<p>Via a pre-configured machine on the <a href="https://developers.sap.com/tutorials/hxe-gcp-getting-started-launcher.html">Google Cloud Platform</a></p>
</li>
<li>
<p>Via a pre-configured machine in the <a href="https://developers.sap.com/tutorials/hxe-ms-azure-marketplace-getting-started.html">Microsoft Azure Cloud</a></p>
</li>
<li>
<p>Via a pre-configured machine on <a href="https://developers.sap.com/tutorials/hxe-aws-setup.html">Amazon Web Services</a></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>To get started with SAP HANA, Express Edition you can check out the <a href="https://developers.sap.com/topics/sap-hana-express.html#tutorials">tutorials</a> at the <a href="https://developers.sap.com/">SAP Developer Center</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="guide-hana.asciidoc_pooling">11.8.3. Pooling</h4>
<div class="paragraph">
<p>TODO</p>
</div>
</div>
<div class="sect3">
<h4 id="guide-hana.asciidoc_fuzzy-search">11.8.4. Fuzzy Search</h4>
<div class="paragraph">
<p>See <a href="https://blogs.sap.com/2015/08/28/dynamism-of-fuzzy-search-in-sap-hana/" class="bare">https://blogs.sap.com/2015/08/28/dynamism-of-fuzzy-search-in-sap-hana/</a> or the <a href="https://help.sap.com/viewer/691cb949c1034198800afde3e5be6570/latest/en-US/cc602780bb5710148aa2bf6cab3c015b.html">SAP HANA Search Developer Guide</a></p>
</div>
<!-- toc disabled -->
</div>
</div>
<div class="sect2">
<h3 id="guide-oracle.asciidoc">11.9. Oracle RDBMS</h3>
<div class="paragraph">
<p>This section contains hints for those who use Oracle RDBMS. If you use a different persistence technology you can simply ignore it. Besides general hints about the driver there are tips for more tight integration with other Oracle features or products. However, if you work for a project where Oracle RDBMS is settled and not going to be replaced (you are in a vendor lock-in anyway), you might want to use even more from Oracle technology to take advantage from a closer integration.</p>
</div>
<div class="sect3">
<h4 id="guide-oracle.asciidoc_xe">11.9.1. XE</h4>
<div class="paragraph">
<p>For local development you should setup Oracle XE (eXpress Edition).
You need an oracle account, then you can download it from <a href="https://www.oracle.com/technetwork/database/database-technologies/express-edition/downloads/index.html">here</a>.</p>
</div>
<div class="paragraph">
<p>The most comfortable way to run it as needed is using docker. You can build your own docker image from the downloaded RPM using the <a href="https://github.com/oracle/docker-images/tree/master/OracleDatabase/SingleInstance">instructions and dockerfile from oracle</a>. (In case the build of the docker-image <a href="https://github.com/oracle/docker-images/issues/1133">fails reproducably</a> and you want to give up with the Dockerfiles from Oracle you can also try this inofficial <a href="https://github.com/fuzziebrain/docker-oracle-xe">docker-oracle-xe</a> solution).</p>
</div>
<div class="paragraph">
<p>To connect to your local XE database you need to use <code>xe</code> as the <code>SID</code> of your main database that can not be changed. The <code>hostname</code> should be <code>localhost</code> and the <code>port</code> is by default <code>1521</code> if you did not remap it with docker to something else. However, starting with XE 18c you need to be aware that oracle introduced a <a href="https://docs.oracle.com/database/121/CNCPT/cdbovrvw.htm">multi-tenant architecture</a>. Hence <code>xe</code> refers to the root <code>CDB</code> while you typically want to connect to the <code>PDB</code> (pluggable database) and XE ships with exactly one of this called <code>xepdb1</code>. To connect with <code>SQL Developer</code> switch <code>Connection Type</code> from <code>Basic</code> to <code>Advanced</code> and enter the <code>Custom JDBC URL</code> like e.g.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>jdbc:oracle:thin:@//localhost:1521/xepdb1</code></pre>
</div>
</div>
<div class="paragraph">
<p>The same way you can also connect from your devon4j app via JDBC.</p>
</div>
</div>
<div class="sect3">
<h4 id="guide-oracle.asciidoc_driver">11.9.2. Driver</h4>
<div class="paragraph">
<p>The oracle JDBC driver is not available in maven central. Depending on the Oracle DB version and the Java version, you can use either the 11g/ojdbc6, 12c/ojdbc7, or 12c/ojdbc8 version of the driver. Oracle JDBC drivers usually are backward and forward compatible so you should be able to use the 12c/ojdbc8 driver with an 11g DB etc. As a rule of thumb, use the 12c/ojdbc8 driver unless you must use Java7. All JDBC drivers can be downloaded without registration: <a href="http://www.oracle.com/technetwork/database/enterprise-edition/jdbc-112010-090769.html">11g/ojdbc6</a>, <a href="http://www.oracle.com/technetwork/database/features/jdbc/jdbc-drivers-12c-download-1958347.html">12c/ojdbc7</a>, and <a href="http://www.oracle.com/technetwork/database/features/jdbc/jdbc-ucp-122-3110062.html">12c/ojdbc8</a>. Your project should use a maven repository server such as <a href="http://www.sonatype.org/nexus/">nexus</a> or <a href="https://www.jfrog.com/open-source/">artifactory</a>.
Your dependency for the oracle driver should look as follows (use artifactId "ojdbc6" or "ojdbc7" for the older drivers):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>&lt;dependency&gt;
  &lt;groupId&gt;com.oracle&lt;/groupId&gt;
  &lt;artifactId&gt;ojdbc8&lt;/artifactId&gt;
  &lt;version&gt;${oracle.driver.version}&lt;/version&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>oracle.driver.version being 11.2.0.4 for 11g/ojdbc6, or 12.1.0.1 for 12c/ojdbc7, or 12.2.0.1 for 12c/ojdbc8 or newer</p>
</div>
</div>
<div class="sect3">
<h4 id="guide-oracle.asciidoc_pooling">11.9.3. Pooling</h4>
<div class="paragraph">
<p>In order to boost performance JDBC connections should be pooled and reused. If you are using Oracle RDBMS and do not plan to change that you can use the Oracle specific connection pool "Universal Connection Pool (UCP)" that is perfectly integrated with the Oracle driver. According to the documentation, UCP can even be used to <a href="https://docs.oracle.com/database/122/JJUCP/third-party-integration.htm#JJUCP8141">manage third party data sources</a>. The 11g version of UCP can be downloaded without registration <a href="http://www.oracle.com/technetwork/database/enterprise-edition/downloads/ucp-112010-099129.html">here</a>, the 12c version of UCP is available at the same download locations as the 12c JDBC driver (see above). As a rule of thumb, use the version that is the same as the JDBC driver version.
Again, you have to upload the artefact manually to your maven repository. The dependency should look like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>&lt;dependency&gt;
  &lt;groupId&gt;com.oracle&lt;/groupId&gt;
  &lt;artifactId&gt;ucp&lt;/artifactId&gt;
  &lt;version&gt;${oracle.ucp.version}&lt;/version&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>with oracle.ucp.version being 11.2.0.4 or 12.2.0.1 or newer.</p>
</div>
<div class="paragraph">
<p>Configuration is done via application.properties like this (example):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>#Oracle UCP
# Datasource for accessing the database
spring.datasource.url=jdbc:oracle:thin:@192.168.58.2:1521:xe
spring.jpa.database-platform=org.hibernate.dialect.Oracle12cDialect
spring.datasource.user=MyUser
spring.datasource.password=ThisIsMyPassword
spring.datasource.driver-class-name=oracle.jdbc.OracleDriver
spring.datasource.schema=MySchema

spring.datasource.type=oracle.ucp.jdbc.PoolDataSourceImpl
spring.datasource.factory=oracle.ucp.jdbc.PoolDataSourceFactory
spring.datasource.factory-method=getPoolDataSource
spring.datasource.connectionFactoryClassName=oracle.jdbc.pool.OracleDataSource
spring.datasource.validateConnectionOnBorrow=true
spring.datasource.connectionPoolName=MyPool
spring.datasource.jmx-enabled=true

# Optional: Set the log level to INTERNAL_ERROR, SEVERE, WARNING, INFO, CONFIG, FINE, TRACE_10, FINER, TRACE_20, TRACE_30, or FINEST
# logging.level.oracle.ucp=INTERNAL_ERROR
# Optional: activate tracing
# logging.level.oracle.ucp.jdbc.oracle.OracleUniversalPooledConnection=TRACE

#Optional: Configures pool size manually
#spring.datasource.minPoolSize=10
#spring.datasource.maxPoolSize=40
#spring.datasource.initialPoolSize=20</code></pre>
</div>
</div>
<div class="paragraph">
<p>Resources: <a href="http://www.oracle.com/technetwork/database/application-development/default-2248812.html">FAQ</a>, <a href="https://docs.oracle.com/database/122/JJUCP/toc.htm">developer&#8217;s guide</a>, <a href="https://docs.oracle.com/database/122/JJUAR/toc.htm">Java API Reference</a>. For an in-depth discussion on how to use JDBC and UCP, see the Oracle documentation <a href="http://www.oracle.com/technetwork/database/application-development/jdbc-ucp-conn-mgmt-strategies-3045654.pdf">Connection Management Strategies for Java Applications using JDBC and UCP</a>.</p>
</div>
<div class="paragraph">
<p>Note: there is a bug in UCP 12.1.0.2 that results in the creation of thousands of java.lang.Timer threads over hours or days of system uptime (see <a href="https://stackoverflow.com/questions/37245827/too-many-ucp-timer-threads">article on stackoverflow</a>). Also, Oracle has a strange bug fixing / patching policy: instead of producing a fixed version 12.1.0.3 or 12.1.0.2.x, Oracle publishes collections of *.class files that must be manually patched into the ucp.jar! Therefore, use the newest versions only.</p>
</div>
</div>
<div class="sect3">
<h4 id="guide-oracle.asciidoc_messaging">11.9.4. Messaging</h4>
<div class="paragraph">
<p>In case you want to do messaging based on JMS you might consider the <a href="https://docs.oracle.com/cd/E11882_01/server.112/e11013/aq_intro.htm">Oracle JMS</a> also called Oracle Streams Advanced Queuing, or Oracle Advanced Queuing, or OAQ or AQ for short. OAQ is a JMS provider based on the Oracle RDBMS and included in the DB product for no extra fee. OAQ has some features that exceede the JMS standard like a retention time (i.e. a built-in backup mechanism that allows to make messages "unread" within a configurable period of time so that these messages do not have to be resent by the sending application). Also, OAQ messages are stored in relational tables so they can easily be observed by a test driver in a system test scenario.
Capgemini has used the <a href="https://projects.spring.io/spring-data-jdbc-ext/">Spring Data JDBC Extension</a> in order to process OAQ messages within <strong>the same technical transaction</strong> as the resulting Oracle RDBMS data changes <strong>without</strong> using 2PC and an XA-compliant transaction manager - which is not available out of the box in Tomcat. This is possible only due to the fact that OAQ queues and RDBMS tables actually reside in the same database. However, this is higher magic and should only be tried if high transaction rates must be achieved by avoiding 2PC.</p>
</div>
</div>
<div class="sect3">
<h4 id="guide-oracle.asciidoc_general-notes-on-the-use-of-oracle-products">11.9.5. General Notes on the use of Oracle products</h4>
<div class="paragraph">
<p>Oracle sells commercial products and receives licence fees for them. This includes access to a support organization. Therefore, at an early stage of your project, prepare for contacting <a href="https://support.oracle.com">oracle support</a> in case of technical problems. You will need the Oracle support ID <strong>of your customer</strong> [i.e. the legal entity who pays the licence fee and runs the RDBMS] and your customer must grant you permission to use it in a service request - it is not legal to use a your own support ID in a customer-related project. Your customer pays for that service anyway, so use it in case of a problem!</p>
</div>
<div class="paragraph">
<p>Software components like the JDBC driver or the UCP may be available without a registration or fee but they are protected by the Oracle Technology Network (OTN) License Agreement. The most important aspect of this licence agreement is the fact that an IT service provider is not allowed to simply download the Oracle software component, bundle it in a software artefact and deliver it to the customer. Instead, the Oracle software component must be (from a legal point of view) provided by the owner of the Oracle DB licence (i.e. your customer). This can be achieved in two ways: Advise your customer to install the Oracle software component in the application server as a library that can be used by your custom built system. Or, in cases where this is not feasible, e.g. in a OpenShift environment where the IT service provider delivers complete Docker images, you must advise your customer to (legally, i.e. documented in a written form) provide the Oracle software component to you, i.e. you don&#8217;t download the software component from the Oracle site but receive it from your customer.</p>
</div>
<!-- toc disabled -->
</div>
</div>
<div class="sect2">
<h3 id="guide-jee.asciidoc">11.10. JEE</h3>
<div class="paragraph">
<p>This section is about Jave Enterprise Edition (JEE). Regarding to our <a href="architecture.html#key-principles">key principles</a> we focus on open standards. For Java this means that we consider official standards from Java Standard and Enterprise Edition as first choice for considerations. Therefore we also decided to recommend <a href="guide-rest.html#jax-rs">JAX-RS</a> over <a href="https://spring.io/guides/gs/rest-service/">SpringMVC</a> as the latter is proprietary. Only if an existing Java standard is <strong>not</strong> suitable for current demands such as Java Server Faces (JSF), we do not officially recommend it (while you are still free to use it if you have good reasons to do so). In all other cases we officially suggest the according standard and use it in our guides, code-samples, sample application, modules, templates, etc. Examples for such standards are <a href="#guide-jpa.asciidoc">JPA</a>, <a href="guide-rest.html#jax-rs">JAX-RS</a>, <a href="guide-soap.html#jax-ws">JAX-WS</a>, <a href="#guide-dependency-injection.asciidoc">JSR330</a>, <a href="#guide-access-control.asciidoc">JSR250</a>, <a href="guide-xml.html#jaxb">JAX-B</a>, etc.</p>
</div>
<div class="sect3">
<h4 id="guide-jee.asciidoc_application-server">11.10.1. Application-Server</h4>
<div class="paragraph">
<p>We designed everything based on standards to work with different technology stacks and servlet containers. However, we strongly encourage to use <a href="https://spring.io/">spring</a> and <a href="http://projects.spring.io/spring-boot/">spring-boot</a>. You are free to decide for something else but here is a list of good reasons for our decision:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Up-to-date</strong></p>
<div class="paragraph">
<p>With spring you easily keep up to date with evolving technologies (microservices, reactive, NoSQL, etc.). Most application servers put you in a jail with old legacy technology. In many cases you are even forced to use a totally outdated version of java (JVM/JDK). This may even cause severe IT-Security vulnerabilities but with expensive support you might get updates. Also with spring and open-source you need to be aware that for IT-security you need to update recently what can cost quite a lot of additional maintenance effort.</p>
</div>
</li>
<li>
<p><strong>Development speed</strong></p>
<div class="paragraph">
<p>With spring-boot you can implement and especially test your individual logic very fast. Starting the app in your IDE is very easy, fast, and realistic (close to production). You can easily write JUnit tests that startup your server application to e.g. test calls to your remote services via HTTP fast and easy. For application servers you need to bundle and deploy your app what takes more time and limits you in various ways. We are aware that this has improved in the past but also spring continuously improves and is always way ahead in this area. Further, with spring you have your configurations bundled together with the code in version control (still with ability to handle different environments) while with application servers these are configured externally and can not be easily tested during development.</p>
</div>
</li>
<li>
<p><strong>Documentation</strong></p>
<div class="paragraph">
<p>Spring has an extremely open and active community. There is documentation for everything available for free on the web. You will find solutions to almost any problem on platforms like stackoverflow. If you have a problem you are only a google search away from your solution. This is very much different for proprietary application server products.</p>
</div>
</li>
<li>
<p><strong>Helpful Exception Messages</strong></p>
<div class="paragraph">
<p>Spring is really great for developers on exception messages. If you do something wrong you get detailed and helpful messages that guide you to the problem or even the solution. This is not as great in application servers.</p>
</div>
</li>
<li>
<p><strong>Future-proof</strong></p>
<div class="paragraph">
<p>Spring has evolved really awesome over time. Since its 1.0 release in 2004 spring has continuously been improved and always caught up with important trends and innovations. Even in critical situations, when the company behind it (interface21) was sold, spring went on perfectly.
JEE went through a lot of trouble and crisis. Just look at the EJB pain stories. This happened often in the past and also recent. See <a href="https://dzone.com/articles/java-ee-8-in-crisis">JEE 8 in crisis</a>.</p>
</div>
</li>
<li>
<p><strong>Free</strong></p>
<div class="paragraph">
<p>Spring and its ecosystem is free and open-source. It still perfectly integrates with commercial solutions for specific needs. Most application servers are commercial and cost a lot of money. As of today the ROI for this is of question.</p>
</div>
</li>
<li>
<p><strong>Fun</strong></p>
<div class="paragraph">
<p>If you go to conferences or ask developers you will see that spring is popular and fun. If new developers are forced to use an old application server product they will be less motivated or even get frustrated. Especially in today&#8217;s agile projects this is a very important aspect. In the end you will get into trouble with maintenance on the long run if you rely on a proprietary application server.</p>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>Of course the vendors of application servers will tell you a different story. This is simply because they still make a lot of money from their products. We do not get paid from application servers nor from spring. We are just developers who love to build great systems. A good reason for application servers is that they combine a set of solutions to particular aspects to one product that helps to standardize your IT. However, <a href="http://www.devonfw.com/">devonfw</a> fills exactly this gap for the spring ecosystem in a very open and flexible way. However, there is one important aspect that you need to understand and be aware of:</p>
</div>
<div class="paragraph">
<p>Some big companies decided for a specific application server as their IT strategy. They may have hundreds of apps running with this application server. All their operators and developers have learned a lot of specific skills for this product and are familiar with it. If you are implementing yet another (small) app in this context it can make sense to stick with this application server. However, also they have to be aware that with every additional app they increase their technical debt.</p>
</div>
<!-- toc disabled -->
</div>
</div>
<div class="sect2">
<h3 id="guide-logging.asciidoc">11.11. Logging</h3>
<div class="paragraph">
<p>We use <a href="http://www.slf4j.org/">SLF4J</a> as API for logging. The recommended implementation is <a href="http://logback.qos.ch/">Logback</a> for which we provide additional value such as configuration templates and an appender that prevents log-forging and reformatting of stack-traces for operational optimizations.</p>
</div>
<div class="sect3">
<h4 id="guide-logging.asciidoc_usage">11.11.1. Usage</h4>
<div class="sect4">
<h5 id="guide-logging.asciidoc_maven-integration">Maven Integration</h5>
<div class="paragraph">
<p>In the pom.xml of your application add this dependency (that also adds transitive dependencies to SLF4J and logback):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;dependency&gt;
  &lt;groupId&gt;com.devonfw.java&lt;/groupId&gt;
  &lt;artifactId&gt;devon4j-logging&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="guide-logging.asciidoc_configuration">Configuration</h5>
<div class="paragraph">
<p>The configuration file is logback.xml and is to put in the directory src/main/resources of your main application. For details consult the <a href="http://logback.qos.ch/manual/configuration.html">logback configuration manual</a>. devon4j provides a production ready configuration <a href="https://github.com/devonfw/devon4j/blob/develop/templates/server/src/main/resources/archetype-resources/server/src/main/resources/logback.xml">here</a>. Simply copy this configuration into your application in order to benefit from the provided <a href="#guide-logging.asciidoc_operations">operational</a> and <a href="#guide-logging.asciidoc_guide-logging.asciidoc_security">security</a> aspects. We do not include the configuration into the devon4j-logging module to give you the freedom of customizations (e.g. tune log levels for components and integrated products and libraries of your application).</p>
</div>
<div class="paragraph">
<p>The provided logback.xml is configured to use variables defined on the config/application.properties file. On our example, the log files path point to ../logs/ in order to log to tomcat log directory when starting tomcat on the bin folder. Change it according to your custom needs.</p>
</div>
<div class="listingblock">
<div class="title">Listing 3. config/application.properties</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">log.dir=../logs/</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="guide-logging.asciidoc_logger-access">Logger Access</h5>
<div class="paragraph">
<p>The general pattern for accessing loggers from your code is a static logger instance per class. We pre-configured the development environment so you can just type LOG and hit [ctrl][space] (and then [arrow up]) to insert the code pattern line into your class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class MyClass {
  private static final Logger LOG = LoggerFactory.getLogger(MyClass.class);
  ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Please note that in this case we are not using injection pattern but use the convenient static alternative. This is already a common solution and also has performance benefits.</p>
</div>
</div>
<div class="sect4">
<h5 id="guide-logging.asciidoc_how-to-log">How to log</h5>
<div class="paragraph">
<p>We use a common understanding of the log-levels as illustrated by the following table. This helps for better maintenance and operation of the systems by combining both views.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 6. Log-levels</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>Log-level</strong></th>
<th class="tableblock halign-left valign-top"><strong>Description</strong></th>
<th class="tableblock halign-left valign-top"><strong>Impact</strong></th>
<th class="tableblock halign-left valign-top"><strong>Active Environments</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">FATAL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only used for fatal errors that prevent the application to work at all (e.g. startup fails or shutdown/restart required)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Operator has to react immediately</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">all</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ERROR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An abnormal error indicating that the processing failed due to technical problems.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Operator should check for known issue and otherwise inform development</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">all</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">WARNING</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A situation where something worked not as expected. E.g. a business exception or user validation failure occurred.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No direct reaction required. Used for problem analysis.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">all</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">INFO</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Important information such as context, duration, success/failure of request or process</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No direct reaction required. Used for analysis.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">all</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">DEBUG</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Development information that provides additional context for debugging problems.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No direct reaction required. Used for analysis.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">development and testing</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">TRACE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Like DEBUG but exhaustive information and for code that is run very frequently. Will typically cause large log-files.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No direct reaction required. Used for problem analysis.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">none (turned off by default)</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Exceptions (with their stacktrace) should only be logged on FATAL or ERROR level. For business exceptions typically a WARNING including the message of the exception is sufficient.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="guide-logging.asciidoc_operations">11.11.2. Operations</h4>
<div class="sect4">
<h5 id="guide-logging.asciidoc_log-files">Log Files</h5>
<div class="paragraph">
<p>We always use the following log files:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Error Log</strong>: Includes log entries to detect errors.</p>
</li>
<li>
<p><strong>Info Log</strong>: Used to analyze system status and to detect bottlenecks.</p>
</li>
<li>
<p><strong>Debug Log</strong>: Detailed information for error detection.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The log file name pattern is as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>«LOGTYPE»_log_«HOST»_«APPLICATION»_«TIMESTAMP».log</code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 7. Segments of Logfilename</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>Element</strong></th>
<th class="tableblock halign-left valign-top"><strong>Value</strong></th>
<th class="tableblock halign-left valign-top"><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">«LOGTYPE»</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">info, error, debug</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Type of log file</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">«HOST»</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">e.g. mywebserver01</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name of server, where logs are generated</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">«APPLICATION»</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">e.g. myapp</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name of application, which causes logs</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">«TIMESTAMP»</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">YYYY-MM-DD_HH00</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">date of log file</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Example:
error_log_mywebserver01_myapp_2013-09-16_0900.log</p>
</div>
<div class="paragraph">
<p>Error log from mywebserver01 at application myapp at 16th September 2013 9pm.</p>
</div>
</div>
<div class="sect4">
<h5 id="guide-logging.asciidoc_output-format">Output format</h5>
<div class="paragraph">
<p>We use the following output format for all log entries to ensure that searching and filtering of log entries work consistent for all logfiles:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code> [D: «timestamp»] [P: «priority»] [C: «NDC»][T: «thread»][L: «logger»]-[M: «message»]</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>D</strong>: Date (Timestamp in ISO8601 format e.g. 2013-09-05 16:40:36,464)</p>
</li>
<li>
<p><strong>P</strong>: Priority (the log level)</p>
</li>
<li>
<p><strong>C</strong>: <a href="#guide-logging.asciidoc_correlation-id">Correlation ID</a> (ID to identify users across multiple systems, needed when application is distributed)</p>
</li>
<li>
<p><strong>T</strong>: Thread (Name of thread)</p>
</li>
<li>
<p><strong>L</strong>: Logger name (use class name)</p>
</li>
<li>
<p><strong>M</strong>: Message (log message)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code> [D: 2013-09-05 16:40:36,464] [P: DEBUG] [C: 12345] [T: main] [L: my.package.MyClass]-[M: My message...]</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="guide-logging.asciidoc_security">11.11.3. Security</h4>
<div class="paragraph">
<p>In order to prevent <a href="https://www.owasp.org/index.php/Log_Forging">log forging</a> attacks we provide a special appender for logback in <a href="#guide-logging.asciidoc">devonfw-logging</a>. If you use it (see <a href="#guide-logging.asciidoc_guide-logging.asciidoc_configuration">configuration</a>) you are safe from such attacks.</p>
</div>
</div>
<div class="sect3">
<h4 id="guide-logging.asciidoc_correlation-id">11.11.4. Correlation ID</h4>
<div class="paragraph">
<p>In order to correlate separate HTTP requests to services belonging to the same user / session, we provide a servlet filter called <code>DiagnosticContextFilter</code>. This filter takes a provided correlation ID from the HTTP header <code>X-Correlation-Id</code>. If none was found, it will generate a new correlation id as <code>UUID</code>. This correlation ID is added as MDC to the logger. Therefore, it will then be included to any log message of the current request (thread). Further concepts such as <a href="#guide-service-client.asciidoc">service invocations</a> will pass this correlation ID to subsequent calls in the application landscape. Hence you can find all log messages related to an initial request simply via the correlation ID even in highly distributed systems.</p>
</div>
</div>
<div class="sect3">
<h4 id="guide-logging.asciidoc_monitoring">11.11.5. Monitoring</h4>
<div class="paragraph">
<p>In highly distributed systems (from clustering up to microservices) it might get tedious to search for problems and details in log files. Therefore, we recommend to setup a central log and analysis server for your application landscape. Then you feed the logs from all your applications (using <a href="http://logstash.net/">logstash</a>) into that central server that adds them to a search index to allow fast searches (using <a href="http://www.elasticsearch.org/">elasticsearch</a>). This should be completed with a UI that allows dashboards and reports based on data aggregated from all the logs.
This is addressed by <a href="https://www.elastic.co/webinars/introduction-elk-stack">ELK</a> or <a href="https://www.graylog.org/">Graylog</a>.</p>
</div>
<!-- toc disabled -->
</div>
</div>
<div class="sect2">
<h3 id="guide-security.asciidoc">11.12. Security</h3>
<div class="paragraph">
<p>Security is todays most important cross-cutting concern of an application and an enterprise IT-landscape. We seriously care about security and give you detailed guides to prevent pitfalls, vulnerabilities, and other disasters. While many mistakes can be avoided by following our guidelines you still have to consider security and think about it in your design and implementation. The security guide will not only automatically prevent you from any harm, but will provide you hints and best practices already used in different software products.</p>
</div>
<div class="paragraph">
<p>An important aspect of security is proper authentication and authorization as described in <a href="#guide-access-control.asciidoc">access-control</a>. In the following we discuss about potential vulnerabilities and protection to prevent them.</p>
</div>
<div class="sect3">
<h4 id="guide-security.asciidoc_vulnerabilities-and-protection">11.12.1. Vulnerabilities and Protection</h4>
<div class="paragraph">
<p>Independent from classical authentication and authorization mechanisms there are many common pitfalls that can lead to vulnerabilities and security issues in your application such as XSS, CSRF, SQL-injection, log-forging, etc. A good source of information about this is the <a href="https://www.owasp.org">OWASP</a>.
We address these common threats individually in <em>security</em> sections of our technological guides as a concrete solution to prevent an attack typically depends on the according technology. The following table illustrates common threats and contains links to the solutions and protection-mechanisms provided by the devonfw:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 8. Security threats and protection-mechanisms</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>Threat</strong></th>
<th class="tableblock halign-left valign-top"><strong>Protection</strong></th>
<th class="tableblock halign-left valign-top"><strong>Link to details</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://www.owasp.org/index.php/Top_10_2013-A1-Injection">A1 Injection</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">validate input, escape output, use proper frameworks</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="guide-jpa.html#security">SQL Injection</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://www.owasp.org/index.php/Top_10_2013-A2-Broken_Authentication_and_Session_Management">A2 Broken Authentication and Session Management</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">encrypt all channels, use a central identity management with strong password-policy</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="guide-access-control.html#authentication">Authentication</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://www.owasp.org/index.php/Top_10_2013-A3-Cross-Site_Scripting_(XSS)">A3 XSS</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">prevent injection (see A1) for HTML, JavaScript and CSS and understand same-origin-policy</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="guide-client-layer.html#security">client-layer</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://www.owasp.org/index.php/Top_10_2013-A4-Insecure_Direct_Object_References">A4 Insecure Direct Object References</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Using direct object references (IDs) only with appropriate authorization</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="guide-logic-layer.html#direct-object-references">logic-layer</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://www.owasp.org/index.php/Top_10_2013-A5-Security_Misconfiguration">A5 Security Misconfiguration</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Use devonfw application template and guides to avoid</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://repo1.maven.org/maven2/io/oasp/java/templates/">application template</a> and <a href="guide-configuration.html#security">sensitive configuration</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://www.owasp.org/index.php/Top_10_2013-A6-Sensitive_Data_Exposure">A6 Sensitive Data Exposure</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Use secured exception facade, design your data model accordingly</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="guide-service-layer.html#rest-exception-handling">REST exception handling</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://www.owasp.org/index.php/Top_10_2013-A7-Missing_Function_Level_Access_Control">A7 Missing Function Level Access Control</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ensure proper authorization for all use-cases, use <code>@DenyAll</code> as default to enforce</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="guide-access-control.html#configuration-on-java-method-level">Method authorization</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://www.owasp.org/index.php/Top_10_2013-A8-Cross-Site_Request_Forgery_(CSRF)">A8 CSRF</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">secure mutable service operations with an explicit CSRF security token sent in HTTP header and verified on the server</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="guide-service-layer.html#csrf">service-layer security</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://www.owasp.org/index.php/Top_10_2013-A9-Using_Components_with_Known_Vulnerabilities">A9 Using Components with Known Vulnerabilities</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">subscribe to security newsletters, recheck products and their versions continuously, use devonfw dependency management</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://cve.mitre.org/news/newsletter.html">CVE newsletter</a> and <a href="#guide-security.asciidoc_dependency-check">dependency check</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://www.owasp.org/index.php/Top_10_2013-A10-Unvalidated_Redirects_and_Forwards">A10 Unvalidated Redirects and Forwards</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Avoid using redirects and forwards, in case you need them do a security audit on the solution.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">devonfw proposes to use rich-clients (SPA/RIA). We only use redirects for login in a safe way.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://www.owasp.org/index.php/Log_Forging">Log-Forging</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Escape newlines in log messages</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="guide-logging.html#security">logging security</a></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="guide-security.asciidoc_tools">11.12.2. Tools</h4>
<div class="sect4">
<h5 id="guide-security.asciidoc_dependency-check">Dependency Check</h5>
<div class="paragraph">
<p>To address <a href="https://www.owasp.org/index.php/Top_10_2013-A9-Using_Components_with_Known_Vulnerabilities">A9 Using Components with Known Vulnerabilities</a> we integrated <a href="https://www.owasp.org/index.php/OWASP_Dependency_Check">OWASP dependency check</a> into the devonfw maven build. If you build an devonfw application (sample or any app created from our <a href="#tutorial-newapp.asciidoc">app-template</a>) you can activate dependency check with the <code>security</code> profile:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">mvn clean install -P security</code></pre>
</div>
</div>
<div class="paragraph">
<p>This does not run by default as it causes a huge overhead for the build performance. However , consider to build this in your CI at least nightly.
After the dependency check is performed , you will find the results in <code>target/dependency-check-report.html</code> of each module. The report will also always be generated when the site is build (<code>mvn site</code>).</p>
</div>
</div>
<div class="sect4">
<h5 id="guide-security.asciidoc_penetration-testing">Penetration Testing</h5>
<div class="paragraph">
<p>For penetration testing (testing for vulnerabilities) of your web application, we recommend the following tools:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://www.owasp.org/index.php/OWASP_Zed_Attack_Proxy_Project">ZAP</a> (OWASP Zed Attack Proxy Project)</p>
</li>
<li>
<p><a href="http://sqlmap.org/">sqlmap</a> (or <a href="https://github.com/PaulSec/HQLmap">HQLmap</a>)</p>
</li>
<li>
<p><a href="https://nmap.org/">nmap</a></p>
</li>
<li>
<p>See the marvellous presentation <a href="https://jaxenter.com/security-open-source-toolbox-video-151314.html">Toolbox of a security professional</a> from <a href="https://www.Christian-Schneider.net">Christian Schneider</a>.</p>
</li>
</ul>
</div>
<!-- toc disabled -->
</div>
</div>
</div>
<div class="sect2">
<h3 id="guide-access-control.asciidoc">11.13. Access-Control</h3>
<div class="paragraph">
<p>Access-Control is a central and important aspect of <a href="#guide-security.asciidoc">Security</a>. It consists of two major aspects:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#guide-access-control.asciidoc_guide-access-control.asciidoc_Authentication">Authentication</a> (Who tries to access?)</p>
</li>
<li>
<p><a href="#guide-access-control.asciidoc_guide-access-control.asciidoc_Authorization">Authorization</a> (Is the one accessing allowed to do what he wants to do?)</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="guide-access-control.asciidoc_authentication">11.13.1. Authentication</h4>
<div class="paragraph">
<p>Definition:</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>Authentication is the verification that somebody interacting with the system is the actual subject for whom he claims to be.</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>The one authenticated is properly called <em>subject</em> or <a href="http://docs.oracle.com/javase/7/docs/api/java/security/Principal.html"><em>principal</em></a>. However, for simplicity we use the common term <em>user</em> even though it may not be a human (e.g. in case of a service call from an external system).</p>
</div>
<div class="paragraph">
<p>To prove his authenticity the user provides some secret called <em>credentials</em>. The most simple form of credentials is a password.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Please never implement your own authentication mechanism or credential store. You have to be aware of implicit demands such as salting and hashing credentials, password life-cycle with recovery, expiry, and renewal including email notification confirmation tokens, central password policies, etc. This is the domain of access managers and identity management systems. In a business context you will typically already find a system for this purpose that you have to integrate (e.g. via LDAP). Otherwise you should consider establishing such a system e.g. using <a href="http://keycloak.org">keycloak</a>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>We use <a href="https://projects.spring.io/spring-security/">spring-security</a> as a framework for authentication purposes.</p>
</div>
<div class="paragraph">
<p>Therefore you need to provide an implementation of <a href="https://docs.spring.io/spring-security/site/docs/4.2.x/apidocs/org/springframework/security/config/annotation/web/WebSecurityConfigurer.html">WebSecurityConfigurerAdapter</a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Configuration
@EnableWebSecurity
public class MyWebSecurityConfig extends WebSecurityConfigurerAdapter {

  @Inject
  private UserDetailsService userDetailsService;
  ...
  public void configure(HttpSecurity http) throws Exception {
    http.userDetailsService(this.userDetailsService)
        .authorizeRequests().antMatchers("/public/**").permitAll()
        .anyRequest().authenticated().and()
        ...
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see spring-security offers a fluent API for easy configuration. You can simply add invocations like <code>formLogin().loginPage("/public/login")</code> or <code>httpBasic().realmName("MyApp")</code>. Also <a href="#guide-security.asciidoc">CSRF</a> protection can be configured by invoking <code>csrf()</code>.
For further details see <a href="https://docs.spring.io/spring-security/site/docs/current/reference/html/jc.html#jc-httpsecurity">spring Java-config for HTTP security</a>.</p>
</div>
<div class="paragraph">
<p>Further, you need to provide an implementation of the <a href="https://docs.spring.io/spring-security/site/docs/4.2.x/apidocs/org/springframework/security/core/userdetails/UserDetailsService.html">UserDetailsService</a> interface.
A good starting point comes with our application template.</p>
</div>
<div class="sect4">
<h5 id="guide-access-control.asciidoc_preserve-original-request-anchors-after-form-login-redirect">Preserve original request anchors after form login redirect</h5>
<div class="paragraph">
<p>Spring Security will automatically redirect any unauthorized access to the defined login-page. After successful login, the user will be redirected to the original requested URL. The only pitfall is, that anchors in the request URL will not be transmitted to server and thus cannot be restored after successful login. Therefore the <code>devon4j-security</code> module provides the <code>RetainAnchorFilter</code>, which is able to inject javascript code to the source page and to the target page of any redirection. Using javascript this filter is able to retrieve the requested anchors and store them into a cookie. Heading the target URL this cookie will be used to restore the original anchors again.</p>
</div>
<div class="paragraph">
<p>To enable this mechanism you have to integrate the <code>RetainAnchorFilter</code> as follows:
First, declare the filter with</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>storeUrlPattern</code>: an regular expression matching the URL, where anchors should be stored</p>
</li>
<li>
<p><code>restoreUrlPattern</code>: an regular expression matching the URL, where anchors should be restored</p>
</li>
<li>
<p><code>cookieName</code>: the name of the cookie to save the anchors in the intermediate time</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can easily configure this as code in your <code>WebSecurityConfig</code> as following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">RetainAnchorFilter filter = new RetainAnchorFilter();
filter.setStoreUrlPattern("http://[^/]+/[^/]+/login.*");
filter.setRestoreUrlPattern("http://[^/]+/[^/]+/.*");
filter.setCookieName("TARGETANCHOR");
http.addFilterBefore(filter, UsernamePasswordAuthenticationFilter.class);</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="guide-access-control.asciidoc_users-vs.-systems">Users vs. Systems</h5>
<div class="paragraph">
<p>If we are talking about authentication we have to distinguish two forms of principals:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>human users</p>
</li>
<li>
<p>autonomous systems</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>While e.g. a Kerberos/SPNEGO Single-Sign-On makes sense for human users it is pointless for authenticating autonomous systems. So always keep this in mind when you design your authentication mechanisms and separate access for human users from access for systems.</p>
</div>
</div>
<div class="sect4">
<h5 id="guide-access-control.asciidoc_mixed-authentication">Mixed Authentication</h5>
<div class="paragraph">
<p>In rare cases you might need to mix multiple authentication mechanisms (form based, basic-auth, SAMLv2, OAuth, etc.) within the same app (for different URLs). For KISS this should be avoided where possible. However, when needed, you can find a solution
<a href="https://docs.spring.io/spring-security/site/docs/current/reference/htmlsingle/#multiple-httpsecurity">here</a>.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="guide-access-control.asciidoc_authorization">11.13.2. Authorization</h4>
<div class="paragraph">
<p><strong>Definition:</strong></p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>Authorization is the verification that an authenticated user is allowed to perform the operation he intends to invoke.</p>
</div>
</blockquote>
</div>
<div class="sect4">
<h5 id="guide-access-control.asciidoc_clarification-of-terms">Clarification of terms</h5>
<div class="paragraph">
<p>For clarification we also want to give a common understanding of related terms that have no unique definition and consistent usage in the wild.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 9. Security terms related to authorization</caption>
<colgroup>
<col style="width: 15%;">
<col style="width: 85%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>Term</strong></th>
<th class="tableblock halign-left valign-top"><strong>Meaning and comment</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Permission</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A permission is an object that allows a principal to perform an operation in the system. This permission can be <em>granted</em> (give) or <em>revoked</em> (taken away). Sometimes people also use the term <em>right</em> what is actually wrong as a right (such as the right to be free) can not be revoked.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Group</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">We use the term group in this context for an object that contains permissions. A group may also contain other groups. Then the group represents the set of all recursively contained permissions.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Role</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">We consider a role as a specific form of group that also contains permissions. A role identifies a specific function of a principal. A user can act in a role.</p>
<p class="tableblock">For simple scenarios a principal has a single role associated. In more complex situations a principal can have multiple roles but has only one active role at a time that he can choose out of his assigned roles. For KISS it is sometimes sufficient to avoid this by creating multiple accounts for the few users with multiple roles. Otherwise at least avoid switching roles at run-time in clients as this may cause problems with related states. Simply restart the client with the new role as parameter in case the user wants to switch his role.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Access Control</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any permission, group, role, etc., which declares a control for access management.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="guide-access-control.asciidoc_suggestions-on-the-access-model">Suggestions on the access model</h5>
<div class="paragraph">
<p>For the access model we give the following suggestions:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Each Access Control (permission, group, role, &#8230;&#8203;) is uniquely identified by a human readable string.</p>
</li>
<li>
<p>We create a unique permission for each use-case.</p>
</li>
<li>
<p>We define groups that combine permissions to typical and useful sets for the users.</p>
</li>
<li>
<p>We define roles as specific groups as required by our business demands.</p>
</li>
<li>
<p>We allow to associate users with a list of Access Controls.</p>
</li>
<li>
<p>For authorization of an implemented use case we determine the required permission. Furthermore, we determine the current user and verify that the required permission is contained in the tree spanned by all his associated Access Controls. If the user does not have the permission we throw a security exception and thus abort the operation and transaction.</p>
</li>
<li>
<p>We avoid negative permissions, that is a user has no permission by default and only those granted to him explicitly give him additional permission for specific things. Permissions granted can not be reduced by other permissions.</p>
</li>
<li>
<p>Technically we consider permissions as a secret of the application. Administrators shall not fiddle with individual permissions but grant them via groups. So the access management provides a list of strings identifying the Access Controls of a user. The individual application itself contains these Access Controls in a structured way, whereas each group forms a permission tree.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="guide-access-control.asciidoc_naming-conventions">Naming conventions</h5>
<div class="paragraph">
<p>As stated above each Access Control is uniquely identified by a human readable string. This string should follow the naming convention:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>«app-id».«local-name»</code></pre>
</div>
</div>
<div class="paragraph">
<p>For Access Control Permissions the <code>«local-name»</code> again follows the convention:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>«verb»«object»</code></pre>
</div>
</div>
<div class="paragraph">
<p>The segments are defined by the following table:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 10. Segments of Access Control Permission ID</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>Segment</strong></th>
<th class="tableblock halign-left valign-top"><strong>Description</strong></th>
<th class="tableblock halign-left valign-top"><strong>Example</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">«app-id»</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Is a unqiue technical but human readable string of the application (or microservice). It shall not contain special characters and especially no dot or whitespace. We recommend to use <code>lower-train-case-ascii-syntax</code>. The identity and access management should be organized on enterprise level rather than application level. Therefore permissions of different apps might easily clash (e.g. two apps might both define a group <code>ReadMasterData</code> but some user shall get this group for only one of these two apps). Using the <code>«app-id».</code> prefix is a simple but powerful namespacing concept that allows you to scale and grow. You may also reserve specific «app-id»s for cross-cutting concerns that do not actually reflect a single app e.g to grant access to a geographic region.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>shop</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">«verb»</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The action that is to be performed on «object». We use <code>Find</code> for searching and reading data. <code>Save</code> shall be used both for create and update. Only if you really have demands to separate these two you may use <code>Create</code> in addition to <code>Save</code>. Finally, <code>Delete</code> is used for deletions. For non CRUD actions you are free to use additional verbs such as <code>Approve</code> or <code>Reject</code>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Find</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">«object»</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The affected object or entity. Shall be named according to your data-model</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Product</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>So as an example <code>shop.FindProduct</code> will reflect the permission to search and retrieve a <code>Product</code> in the <code>shop</code> application. The group <code>shop.ReadMasterData</code> may combine all permissions to read master-data from the <code>shop</code>. However, also a group <code>shop.Admin</code> may exist for the <code>Admin</code> role of the <code>shop</code> application. Here the <code>«local-name»</code> is <code>Admin</code> that does not follow the <code>«verb»«object»</code> schema.</p>
</div>
</div>
<div class="sect4">
<h5 id="guide-access-control.asciidoc_devon4j-security">devon4j-security</h5>
<div class="paragraph">
<p>The devonfw provides a ready to use module <code>devon4j-security</code> that is based on <a href="http://projects.spring.io/spring-security/">spring-security</a> and makes your life a lot easier.</p>
</div>
<div class="imageblock text-center">
<div class="content">
<a class="image" href="images/Security-AccessControl.png"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/Security-AccessControl.png" alt="access-control"></a>
</div>
<div class="title">Figure 2. devon4j Security Model</div>
</div>
<div class="paragraph">
<p>The diagram shows the model of <code>devon4j-security</code> that separates two different aspects:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The <em>Indentity- and Access-Management</em> is provided by according products and typically already available in the enterprise landscape (e.g. an active directory). It provides a hierarchy of <em>primary access control objects</em> (roles and groups) of a user. An administrator can grant and revoke permissions (indirectly) via this way.</p>
</li>
<li>
<p>The application security defines a hierarchy of <em>secondary access control objects</em> (groups and permissions). This is done by configuration owned by the application (see following section). The "API" is defined by the IDs of the primary access control objects that will be referenced from the <em>Indentity- and Access-Management</em>.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="guide-access-control.asciidoc_access-control-config">Access Control Config</h5>
<div class="paragraph">
<p>In your application simply extend <code>AccessControlConfig</code> to configure your access control objects as code and reference it from your use-cases. An example config may look like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Named
public class ApplicationAccessControlConfig extends AccessControlConfig {

  public static final String APP_ID = "MyApp";

  private static final String PREFIX = APP_ID + ".";

  public static final String PERMISSION_FIND_OFFER = PREFIX + "FindOffer";

  public static final String PERMISSION_SAVE_OFFER = PREFIX + "SaveOffer";

  public static final String PERMISSION_DELETE_OFFER = PREFIX + "DeleteOffer";

  public static final String PERMISSION_FIND_PRODUCT = PREFIX + "FindProduct";

  public static final String PERMISSION_SAVE_PRODUCT = PREFIX + "SaveProduct";

  public static final String PERMISSION_DELETE_PRODUCT = PREFIX + "DeleteProduct";

  public static final String GROUP_READ_MASTER_DATA = PREFIX + "ReadMasterData";

  public static final String GROUP_MANAGER = PREFIX + "Manager";

  public static final String GROUP_ADMIN = PREFIX + "Admin";

  public ApplicationAccessControlConfig() {

    super();
    AccessControlGroup readMasterData = group(GROUP_READ_MASTER_DATA, PERMISSION_FIND_OFFER, PERMISSION_FIND_PRODUCT);
    AccessControlGroup manager = group(GROUP_MANAGER, readMasterData, PERMISSION_SAVE_OFFER, PERMISSION_SAVE_PRODUCT);
    AccessControlGroup admin = group(GROUP_ADMIN, manager, PERMISSION_DELETE_OFFER, PERMISSION_DELETE_PRODUCT);
  }
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="guide-access-control.asciidoc_configuration-on-java-method-level">Configuration on Java Method level</h5>
<div class="paragraph">
<p>In your use-case you can now reference a permission like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Named
public class UcSafeOfferImpl extends ApplicationUc implements UcSafeOffer {

  @Override
  @RolesAllowed(ApplicationAccessControlConfig.PERMISSION_SAVE_OFFER)
  public OfferEto save(OfferEto offer) { ... }
  ...
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="guide-access-control.asciidoc_check-data-permissions">Check Data-Permissions</h5>
<div class="paragraph">
<p>See <a href="#guide-data-permission.asciidoc">data permissions</a></p>
</div>
</div>
<div class="sect4">
<h5 id="guide-access-control.asciidoc_access-control-schema-deprecated">Access Control Schema (deprecated)</h5>
<div class="paragraph">
<p>The <code>access-control-schema.xml</code> approach is deprecated. The documentation can still be found in <a href="#guide-access-control-schema.asciidoc">access control schema</a>.</p>
</div>
<!-- toc disabled -->
</div>
</div>
</div>
<div class="sect2">
<h3 id="guide-data-permission.asciidoc">11.14. Data-permissions</h3>
<div class="paragraph">
<p>In some projects there are demands for permissions and authorization that is dependent on the processed data. E.g. a user may only be allowed to read or write data for a specific region. This is adding some additional complexity to your authorization. If you can avoid this it is always best to keep things simple. However, in various cases this is a requirement. Therefore the following sections give you guidance and patterns how to solve this properly.</p>
</div>
<div class="sect3">
<h4 id="guide-data-permission.asciidoc_structuring-your-data">11.14.1. Structuring your data</h4>
<div class="paragraph">
<p>For all your business objects (entities) that have to be secured regarding to data permissions we recommend that you create a separate interface that provides access to the relevant data required to decide about the permission. Here is a simple example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public interface SecurityDataPermissionCountry {

  /**
   * @return the 2-letter ISO code of the country this object is associated with. Users need
   *         a data-permission for this country in order to read and write this object.
   */
  String getCountry();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now related business objects (entities) can implement this interface. Often such data-permissions have to be applied to an entire object-hierarchy. For security reasons we recommend that also all child-objects implement this interface. For performance reasons we recommend that the child-objects redundantly store the data-permission properties (such as <code>country</code> in the example above) and this gets simply propagated from the parent, when a child object is created.</p>
</div>
</div>
<div class="sect3">
<h4 id="guide-data-permission.asciidoc_permissions-for-processing-data">11.14.2. Permissions for processing data</h4>
<div class="paragraph">
<p>When saving or processing objects with a data-permission, we recommend to provide dedicated methods to verify the permission in an abstract base-class such as <code>AbstractUc</code> and simply call this explicitly from your business code. This makes it easy to understand and debug the code. Here is a simple example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">protected void verifyPermission(SecurityDataPermissionCountry entity) throws AccessDeniedException;</code></pre>
</div>
</div>
<div class="sect4">
<h5 id="guide-data-permission.asciidoc_beware-of-aop">Beware of AOP</h5>
<div class="paragraph">
<p>For simple but cross-cutting data-permissions you may also use <a href="#guide-aop.asciidoc">AOP</a>. This leads to programming aspects that reflectively scan method arguments and magically decide what to do. Be aware that this quickly gets tricky:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>What if multiple of your method arguments have data-permissions (e.g. implement <code>SecurityDataPermission*</code>)?</p>
</li>
<li>
<p>What if the object to authorize is only provided as reference (e.g. <code>Long</code> or <code>IdRef</code>) and only loaded and processed inside the implementation where the AOP aspect does not apply?</p>
</li>
<li>
<p>How to express advanced data-permissions in annotations?</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>What we have learned is that annotations like <code>@PreAuthorize</code> from <code>spring-security</code> easily lead to the "programming in string literals" anti-pattern. We strongly discourage to use this anti-pattern. In such case writing your own <code>verifyPermission</code> methods that you manually call in the right places of your business-logic is much better to understand, debug and maintain.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="guide-data-permission.asciidoc_permissions-for-reading-data">11.14.3. Permissions for reading data</h4>
<div class="paragraph">
<p>When it comes to restrictions on the data to read it becomes even more tricky. In the context of a user only entities shall be loaded from the database he is permitted to read. This is simple for loading a single entity (e.g. by its ID) as you can load it and then if not permitted throw an exception to secure your code. But what if the user is performing a search query to find many entities? For performance reasons we should only find data the user is permitted to read and filter all the rest already via the database query. But what if this is not a requirement for a single query but needs to be applied cross-cutting to tons of queries? Therefore we have the following pattern that solves your problem:</p>
</div>
<div class="paragraph">
<p>For each data-permission attribute (or set of such) we create an abstract base entity:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@MappedSuperclass
@EntityListeners(PermissionCheckListener.class)
@FilterDef(name = "country", parameters = {@ParamDef(name = "countries", type = "string")})
@Filter(name = "country", condition = "country in (:countries)")
public abstract class SecurityDataPermissionCountryEntity extends ApplicationPersistenceEntity
    implements SecurityDataPermissionCountry {

  private String country;

  @Override
  public String getCountry() {
    return this.country;
  }

  public void setCountry(String country) {
    this.country = country;
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>There are some special hibernate annotations <code>@EntityListeners</code>, <code>@FilterDef</code>, and <code>@Filter</code> used here allowing to apply a filter on the <code>country</code> for any (non-native) query performed by hibernate. The entity listener may look like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class PermissionCheckListener {

  @PostLoad
  public void read(SecurityDataPermissionCountryEntity entity) {
    PermissionChecker.getInstance().requireReadPermission(entity);
  }

  @PrePersist
  @PreUpdate
  public void write(SecurityDataPermissionCountryEntity entity) {
    PermissionChecker.getInstance().requireWritePermission(entity);
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This will ensure that hibernate implicitly will call these checks for every such entity when it is read from or written to the database. Further to avoid reading entities from the database the user is not permitted to (and ending up with exceptions), we create an AOP aspect that automatically activates the above declared hibernate filter:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Named
public class PermissionCheckerAdvice implements MethodBeforeAdvice {

  @Inject
  private PermissionChecker permissionChecker;

  @PersistenceContext
  private EntityManager entityManager;

  @Override
  public void before(Method method, Object[] args, Object target) {

    Collection&lt;String&gt; permittedCountries = this.permissionChecker.getPermittedCountriesForReading();
    if (permittedCountries != null) { // null is returned for admins that may access all countries
      if (permittedCountries.isEmpty()) {
        throw new AccessDeniedException("Not permitted for any country!");
      }
      Session session = this.entityManager.unwrap(Session.class);
      session.enableFilter("country").setParameterList("countries", permittedCountries.toArray());
    }
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Finally to apply this aspect to all Repositories (can easily be changed to DAOs) implement the following advisor:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Named
public class PermissionCheckerAdvisor implements PointcutAdvisor, Pointcut, ClassFilter, MethodMatcher {

  @Inject
  private PermissionCheckerAdvice advice;

  @Override
  public Advice getAdvice() {
    return this.advice;
  }

  @Override
  public boolean isPerInstance() {
    return false;
  }

  @Override
  public Pointcut getPointcut() {
    return this;
  }

  @Override
  public ClassFilter getClassFilter() {
    return this;
  }

  @Override
  public MethodMatcher getMethodMatcher() {
    return this;
  }

  @Override
  public boolean matches(Method method, Class&lt;?&gt; targetClass) {
    return true; // apply to all methods
  }

  @Override
  public boolean isRuntime() {
    return false;
  }

  @Override
  public boolean matches(Method method, Class&lt;?&gt; targetClass, Object... args) {
    throw new IllegalStateException("isRuntime()==false");
  }

  @Override
  public boolean matches(Class&lt;?&gt; clazz) {
    // when using DAOs simply change to some class like ApplicationDao
    return DefaultRepository.class.isAssignableFrom(clazz);
  }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="guide-data-permission.asciidoc_managing-and-granting-the-data-permissions">11.14.4. Managing and granting the data-permissions</h4>
<div class="paragraph">
<p>Following our <a href="guide-access-control.html#authorization">authorization guide</a> we can simply create a permission for each country. We might simply reserve a prefix (as virtual <code>«app-id»</code>) for each data-permission to allow granting data-permissions to end-users across all applications of the IT landscape. In our example we could create access controls <code>country.DE</code>, <code>country.US</code>, <code>country.ES</code>, etc. and assign those to the users. The method <code>permissionChecker.getPermittedCountriesForReading()</code> would then scan for these access controls and only return the 2-letter country code from it.</p>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
Before you make your decisions how to design your access controls please clarify the following questions:
</td>
</tr>
</table>
</div>
<div class="ulist">
<ul>
<li>
<p>Do you need to separate data-permissions independent of the functional permissions? E.g. may it be required to express that a user can read data from the countries <code>ES</code> and <code>PL</code> but is only permitted to modify data from <code>PL</code>? In such case a single assignment of "country-permissions" to users is insufficient.</p>
</li>
<li>
<p>Do you want to grant data-permissions individually for each application (higher flexibility and complexity) or for the entire application landscape (simplicity, better maintenance for administrators)? In case of the first approach you would rather have access controls like <code>app1.country.GB</code> and <code>app2.country.GB</code>.</p>
</li>
<li>
<p>Do your data-permissions depend on objects that can be created dynamically inside your application?</p>
</li>
<li>
<p>If you want to grant data-permissions on other business objects (entities), how do you want to reference them (primary keys, business keys, etc.)? What reference is most stable? Which is most readable?</p>
</li>
</ul>
</div>
<!-- toc disabled -->
</div>
</div>
<div class="sect2">
<h3 id="guide-validation.asciidoc">11.15. Validation</h3>
<div class="paragraph">
<p>Validation is about checking syntax and semantics of input data. Invalid data is rejected by the application.
Therefore validation is required in multiple places of an application. E.g. the <a href="#guide-client-layer.asciidoc">GUI</a> will do validation for usability reasons to assist the user, early feedback and to prevent unnecessary server requests.
On the server-side validation has to be done for consistency and <a href="#guide-security.asciidoc">security</a>.</p>
</div>
<div class="paragraph">
<p>In general we distinguish these forms of validation:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>stateless validation</em> will produce the same result for given input at any time (for the same code/release).</p>
</li>
<li>
<p><em>stateful validation</em> is dependent on other states and can consider the same input data as valid in once case and as invalid in another.</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="guide-validation.asciidoc_stateless-validation">11.15.1. Stateless Validation</h4>
<div class="paragraph">
<p>For regular, stateless validation we use the JSR303 standard that is also called bean validation (BV).
Details can be found in the <a href="http://beanvalidation.org/1.1/spec/">specification</a>.
As implementation we recommend <a href="http://hibernate.org/validator/">hibernate-validator</a>.</p>
</div>
<div class="sect4">
<h5 id="guide-validation.asciidoc_example">Example</h5>
<div class="paragraph">
<p>A description of how to enable BV can be found in the relevant <a href="http://docs.spring.io/spring-framework/docs/current/spring-framework-reference/htmlsingle/#validation-beanvalidation">Spring documentation</a>. For a quick summary follow these steps:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Make sure that hibernate-validator is located in the classpath by adding a dependency to the pom.xml.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>    &lt;dependency&gt;
      &lt;groupId&gt;org.hibernate&lt;/groupId&gt;
      &lt;artifactId&gt;hibernate-validator&lt;/artifactId&gt;
    &lt;/dependency&gt;</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Add the @Validated annotation to the implementation (spring bean) to be validated. The standard use case is to annotate the logic layer implementation, i.e. the use case implementation or component facade in case of simple logic layer pattern. Thus, the validation will be executed for service requests as well as batch processing. For methods to validate go to their declaration and add constraint annotations to the method parameters.</p>
<div class="ulist">
<ul>
<li>
<p>@Valid annotation to the arguments to validate (if that class itself is annotated with constraints to check).</p>
</li>
<li>
<p>@NotNull for required arguments.</p>
</li>
<li>
<p>Other constraints (e.g. @Size) for generic arguments (e.g. of type String or Integer). However, consider to create <a href="#guide-datatype.asciidoc">custom datatypes</a> and avoid adding too much validation logic (especially redundant in multiple places).
.<strong>BookingmanagementRestServiceImpl.java</strong></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>@Validated
public class BookingmanagementRestServiceImpl implements BookingmanagementRestService {
  ...
  public BookingEto saveBooking(@Valid BookingCto booking) {
  ...</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Finally add appropriate validation constraint annotations to the fields of the ETO class.
.<strong>BookingCto.java</strong></p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>  @Valid
  private BookingEto booking;</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Listing 4. <strong>BookingEto.java</strong></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">  @NotNull
  @Future
  private Timestamp bookingDate;</code></pre>
</div>
</div>
<div class="paragraph">
<p>A list with all bean validation constraint annotations available for hibernate-validator can be found <a href="http://docs.jboss.org/hibernate/stable/validator/reference/en-US/html_single/#table-spec-constraints">here</a>. In addition it is possible to configure custom constraints. Therefor it is neccessary to implement a annotation and a corresponding validator. A description can also be found in the <a href="http://docs.spring.io/spring-framework/docs/current/spring-framework-reference/htmlsingle/#validation-beanvalidation-spring-constraints">Spring documentation</a> or with more details in the <a href="http://docs.jboss.org/hibernate/validator/4.3/reference/en-US/html/validator-customconstraints.html">hibernate documentation</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<strong>Bean Validation in Wildfly &gt;v8:</strong> Wildfly v8 is the first version of Wildfly implementing the JEE7 specification. It comes with bean validation based on <a href="https://samaxes.com/2014/04/jaxrs-beanvalidation-javaee7-wildfly/">hibernate-validator out of the box</a>. In case someone is running Spring in Wildfly for whatever reasons, the spring based annotation @Validated would duplicate bean validation at runtime and thus should be omitted.
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="guide-validation.asciidoc_gui-integration">GUI-Integration</h5>
<div class="paragraph">
<p>TODO</p>
</div>
</div>
<div class="sect4">
<h5 id="guide-validation.asciidoc_cross-field-validation">Cross-Field Validation</h5>
<div class="paragraph">
<p>BV has poor support for this. Best practice is to create and use beans for ranges, etc. that solve this. A bean for a range could look like so:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class Range&lt;V extends Comparable&lt;V&gt;&gt; {

  private V min;
  private V max;

  public Range(V min, V max) {

    super();
    if ((min != null) &amp;&amp; (max != null)) {
      int delta = min.compareTo(max);
      if (delta &gt; 0) {
        throw new ValueOutOfRangeException(null, min, min, max);
      }
    }
    this.min = min;
    this.max = max;
  }

  public V getMin() ...
  public V getMax() ...</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="guide-validation.asciidoc_stateful-validation">11.15.2. Stateful Validation</h4>
<div class="paragraph">
<p>For complex and stateful business validations we do not use BV (possible with groups and context, etc.) but follow KISS and just implement this on the server in a straight forward manner.
An example is the deletion of a table in the example application. Here the state of the table must be checked first:
<strong>BookingmanagementImpl.java</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">  private void sendConfirmationEmails(BookingEntity booking) {

    if (!booking.getInvitedGuests().isEmpty()) {
      for (InvitedGuestEntity guest : booking.getInvitedGuests()) {
        sendInviteEmailToGuest(guest, booking);
      }
    }

    sendConfirmationEmailToHost(booking);
  }</code></pre>
</div>
</div>
<div class="paragraph">
<p>Implementing this small check with BV would be a lot more effort.</p>
</div>
<!-- toc disabled -->
</div>
</div>
<div class="sect2">
<h3 id="guide-aop.asciidoc">11.16. Aspect Oriented Programming (AOP)</h3>
<div class="paragraph">
<p><a href="http://en.wikipedia.org/wiki/Aspect-oriented_programming">AOP</a> is a powerful feature for cross-cutting concerns. However, if used extensive and for the wrong things an application can get unmaintainable. Therefore we give you the best practices where and how to use AOP properly.</p>
</div>
<div class="sect3">
<h4 id="guide-aop.asciidoc_aop-key-principles">11.16.1. AOP Key Principles</h4>
<div class="paragraph">
<p>We follow these principles:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>We use <a href="http://docs.spring.io/spring/docs/2.5.4/reference/aop.html">spring AOP</a> based on dynamic proxies (and fallback to cglib).</p>
</li>
<li>
<p>We avoid AspectJ and other mighty and complex AOP frameworks whenever possible</p>
</li>
<li>
<p>We only use AOP where we consider it as necessary (see below).</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="guide-aop.asciidoc_aop-usage">11.16.2. AOP Usage</h4>
<div class="paragraph">
<p>We recommend to use AOP with care but we consider it established for the following cross cutting concerns:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#guide-transactions.asciidoc">Transaction-Handling</a></p>
</li>
<li>
<p><a href="guide-security.html#method-authorization">Authorization</a></p>
</li>
<li>
<p><a href="#guide-validation.asciidoc">Validation</a></p>
</li>
<li>
<p><a href="guide-logging.html#tracing">Trace-Logging</a> (for testing and debugging)</p>
</li>
<li>
<p>Exception facades for <a href="#guide-service-layer.asciidoc">services</a> but only if no other solution is possible (use alternatives such as <a href="guide-service-layer.html#rest-exception-handling">JAX-RS provider</a> instead).</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="guide-aop.asciidoc_aop-debugging">11.16.3. AOP Debugging</h4>
<div class="paragraph">
<p>When using AOP with dynamic proxies the debugging of your code can get nasty. As you can see by the red boxes in the call stack in the debugger there is a lot of magic happening while you often just want to step directly into the implementation skipping all the AOP clutter. When using Eclipse this can easily be archived by enabling <em>step filters</em>. Therefore you have to enable the feature in the Eclipse tool bar (highlighted in read).</p>
</div>
<div class="imageblock text-center">
<div class="content">
<a class="image" href="images/eclipse-debug-aop.png"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/eclipse-debug-aop.png" alt="AOP debugging"></a>
</div>
</div>
<div class="paragraph">
<p>In order to properly make this work you need to ensure that the step filters are properly configured:</p>
</div>
<div class="imageblock text-center">
<div class="content">
<a class="image" href="images/eclipse-debug-step-filters.png"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/eclipse-debug-step-filters.png" alt="Step Filter Configuration"></a>
</div>
</div>
<div class="paragraph">
<p>Ensure you have at least the following step-filters configured and active:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>ch.qos.logback.*
com.devonfw.module.security.*
java.lang.reflect.*
java.security.*
javax.persistence.*
org.apache.commons.logging.*
org.apache.cxf.jaxrs.client.*
org.apache.tomcat.*
org.h2.*
org.springframework.*</code></pre>
</div>
</div>
<!-- toc disabled -->
</div>
</div>
<div class="sect2">
<h3 id="guide-exceptions.asciidoc">11.17. Exception Handling</h3>
<div class="sect3">
<h4 id="guide-exceptions.asciidoc_exception-principles">11.17.1. Exception Principles</h4>
<div class="paragraph">
<p>For exceptions we follow these principles:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>We only use exceptions for <em>exceptional</em> situations and not for programming control flows, etc. Creating an exception in Java is expensive and hence you should not do it just for testing if something is present, valid or permitted. In the latter case design your API to return this as a regular result.</p>
</li>
<li>
<p>We use unchecked exceptions (RuntimeException)</p>
</li>
<li>
<p>We distinguish <em>internal exceptions</em> and <em>user exceptions</em>:</p>
<div class="ulist">
<ul>
<li>
<p>Internal exceptions have technical reasons. For unexpected and exotic situations it is sufficient to throw existing exceptions such as IllegalStateException. For common scenarios a own exception class is reasonable.</p>
</li>
<li>
<p>User exceptions contain a message explaining the problem for end users. Therefore we always define our own exception classes with a clear, brief but detailed message.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Our own exceptions derive from an exception base class supporting</p>
<div class="ulist">
<ul>
<li>
<p><a href="http://m-m-m.sourceforge.net/apidocs/net/sf/mmm/util/exception/api/NlsRuntimeException.html#getUuid%28%29">unique ID per instance</a></p>
</li>
<li>
<p><a href="http://m-m-m.sourceforge.net/apidocs/net/sf/mmm/util/exception/api/NlsRuntimeException.html#getCode%28%29">Error code per class</a></p>
</li>
<li>
<p><a href="http://m-m-m.sourceforge.net/apidocs/net/sf/mmm/util/exception/api/NlsThrowable.html#getNlsMessage%28%29">message templating</a> (see <a href="#guide-i18n.asciidoc">I18N</a>)</p>
</li>
<li>
<p><a href="http://m-m-m.sourceforge.net/apidocs/net/sf/mmm/util/exception/api/NlsRuntimeException.html#isForUser%28%29">distinguish between <em>user exceptions</em> and <em>internal exceptions</em></a></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>All this is offered by <a href="http://m-m-m.sourceforge.net/apidocs/net/sf/mmm/util/exception/api/package-summary.html#documentation">mmm-util-core</a> that we propose as solution.</p>
</div>
</div>
<div class="sect3">
<h4 id="guide-exceptions.asciidoc_exception-example">11.17.2. Exception Example</h4>
<div class="paragraph">
<p>Here is an exception class from our sample application:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class IllegalEntityStateException extends ApplicationBusinessException {

  private static final long serialVersionUID = 1L;

  public IllegalEntityStateException(Object entity, Object state) {

    this((Throwable) null, entity, state);
  }


  public IllegalEntityStateException(Object entity, Object currentState, Object newState) {

    this(null, entity, currentState, newState);
  }

  public IllegalEntityStateException(Throwable cause, Object entity, Object state) {

    super(cause, createBundle(NlsBundleApplicationRoot.class).errorIllegalEntityState(entity, state));
  }

  public IllegalEntityStateException(Throwable cause, Object entity, Object currentState, Object newState) {

    super(cause, createBundle(NlsBundleApplicationRoot.class).errorIllegalEntityStateChange(entity, currentState,
        newState));
  }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The message templates are defined in the interface NlsBundleRestaurantRoot as following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public interface NlsBundleApplicationRoot extends NlsBundle {


  @NlsBundleMessage("The entity {entity} is in state {state}!")
  NlsMessage errorIllegalEntityState(@Named("entity") Object entity, @Named("state") Object state);


  @NlsBundleMessage("The entity {entity} in state {currentState} can not be changed to state {newState}!")
  NlsMessage errorIllegalEntityStateChange(@Named("entity") Object entity, @Named("currentState") Object currentState,
      @Named("newState") Object newState);


  @NlsBundleMessage("The property {property} of object {object} can not be changed!")
  NlsMessage errorIllegalPropertyChange(@Named("object") Object object, @Named("property") Object property);

  @NlsBundleMessage("There is currently no user logged in")
  NlsMessage errorNoActiveUser();</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="guide-exceptions.asciidoc_handling-exceptions">11.17.3. Handling Exceptions</h4>
<div class="paragraph">
<p>For catching and handling exceptions we follow these rules:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>We do not catch exceptions just to wrap or to re-throw them.</p>
</li>
<li>
<p>If we catch an exception and throw a new one, we always <strong>have</strong> to provide the original exception as <a href="http://docs.oracle.com/javase/7/docs/api/java/lang/Throwable.html#getCause%28%29">cause</a> to the constructor of the new exception.</p>
</li>
<li>
<p>At the entry points of the application (e.g. a service operation) we have to catch and handle all throwables. This is done via the <em>exception-facade-pattern</em> via an explicit facade or aspect. The devon4j already provides ready-to-use implementations for this such as <a href="https://github.com/devonfw/devon4j/blob/develop/modules/rest/src/main/java/com/devonfw/module/rest/service/impl/RestServiceExceptionFacade.java">RestServiceExceptionFacade</a>. The exception facade has to&#8230;&#8203;</p>
<div class="ulist">
<ul>
<li>
<p>log all errors (user errors on info and technical errors on error level)</p>
</li>
<li>
<p>convert the error to a result appropriable for the client and secure for <a href="https://www.owasp.org/index.php/Top_10_2013-A6-Sensitive_Data_Exposure">Sensitive Data Exposure</a>. Especially for security exceptions only a generic security error code or message may be revealed but the details shall only be logged but <strong>not</strong> be exposed to the client. All <em>internal exceptions</em> are converted to a generic error with a message like:</p>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>An unexpected technical error has occurred. We apologize any inconvenience. Please try again later.</p>
</div>
</blockquote>
</div>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="guide-exceptions.asciidoc_common-errors">11.17.4. Common Errors</h4>
<div class="paragraph">
<p>The following errors may occur in any devon application:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 11. Common Exceptions</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>Code</strong></th>
<th class="tableblock halign-left valign-top"><strong>Message</strong></th>
<th class="tableblock halign-left valign-top"><strong>Link</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>TechnicalError</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An unexpected error has occurred! We apologize any inconvenience. Please try again later.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://github.com/m-m-m/util/blob/master/exception/src/main/java/net/sf/mmm/util/exception/api/TechnicalErrorUserException.java">TechnicalErrorUserException.java</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ServiceInvoke</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">«original message of the cause»</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://github.com/m-m-m/util/blob/master/exception/src/main/java/net/sf/mmm/util/exception/api/ServiceInvocationFailedException.java">ServiceInvocationFailedException.java</a></p></td>
</tr>
</tbody>
</table>
<!-- toc disabled -->
</div>
</div>
<div class="sect2">
<h3 id="guide-i18n.asciidoc">11.18. Internationalization</h3>
<div class="paragraph">
<p>Internationalization (I18N) is about writing code independent from locale-specific informations.
For I18N of text messages we are suggesting
<a href="http://m-m-m.sourceforge.net/apidocs/net/sf/mmm/util/nls/api/package-summary.html#documentation">mmm native-language-support</a>.</p>
</div>
<div class="paragraph">
<p>In devonfw we have developed a solution to manage text internationalization. devonfw solution comes into two aspects:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Bind locale information to the user.</p>
</li>
<li>
<p>Get the messages in the current user locale.</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="guide-i18n.asciidoc_binding-locale-information-to-the-user">11.18.1. Binding locale information to the user</h4>
<div class="paragraph">
<p>We have defined two different points to bind locale information to user, depending on user is authenticated or not.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>User not authenticated: devonfw intercepts unsecured request and extract locale from it. At first, we try to extract a <code>language</code> parameter from the request and if it is not possible, we extract locale from Àccept-language` header.</p>
</li>
<li>
<p>User authenticated. During login process, applications developers are responsible to fill <code>language</code> parameter in the UserProfile class. This <code>language</code> parameter could be obtain from DB, LDAP, request, etc. In devonfw sample we get the locale information from database.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This image shows the entire process:</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/i18n.png" alt="Internationalization">
</div>
</div>
</div>
<div class="sect3">
<h4 id="guide-i18n.asciidoc_getting-internationalizated-messages">11.18.2. Getting internationalizated messages</h4>
<div class="paragraph">
<p>devonfw has a bean that manage i18n message resolution, the <code>ApplicationLocaleResolver.</code> This bean is responsible to get the current user and extract locale information from it and read the correct properties file to get the message.</p>
</div>
<div class="paragraph">
<p>The i18n properties file must be called <code>ApplicationMessages_la_CO.properties</code> where la=language and CO=country. This is an example of a i18n properties file for English language to translate devonfw sample user roles:</p>
</div>
<div class="paragraph">
<p>ApplicationMessages_en_US.properties</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>waiter=Waiter
chief=Chief
cook=Cook
barkeeper=Barkeeper</code></pre>
</div>
</div>
<div class="paragraph">
<p>You should define an ApplicationMessages_la_CO.properties file for every language that your application needs.</p>
</div>
<div class="paragraph">
<p><code>ApplicationLocaleResolver</code> bean is injected in <code>AbstractComponentFacade</code> class so you have available this bean in logic layer so you only need to put this code to get an internationalizated message:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">String msg = getApplicationLocaleResolver().getMessage("mymessage");</code></pre>
</div>
</div>
<!-- toc disabled -->
</div>
</div>
<div class="sect2">
<h3 id="guide-xml.asciidoc">11.19. XML</h3>
<div class="paragraph">
<p><a href="http://en.wikipedia.org/wiki/XML">XML</a> (Extensible Markup Language) is a W3C standard format for structured information. It has a large eco-system of additional standards and tools.</p>
</div>
<div class="paragraph">
<p>In Java there are many different APIs and frameworks for accessing, producing and processing XML. For the devonfw we recommend to use <a href="#guide-xml.asciidoc_jaxb">JAXB</a> for mapping Java objects to XML and vice-versa. Further there is the popular <a href="http://docs.oracle.com/javase/7/docs/api/org/w3c/dom/package-summary.html">DOM API</a> for reading and writing smaller XML documents directly. When processing large XML documents <a href="http://en.wikipedia.org/wiki/StAX">StAX</a> is the right choice.</p>
</div>
<div class="sect3">
<h4 id="guide-xml.asciidoc_jaxb">11.19.1. JAXB</h4>
<div class="paragraph">
<p>We use <a href="http://en.wikipedia.org/wiki/Java_Architecture_for_XML_Binding">JAXB</a> to serialize Java objects to XML or vice-versa.</p>
</div>
<div class="sect4">
<h5 id="guide-xml.asciidoc_jaxb-and-inheritance">JAXB and Inheritance</h5>
<div class="paragraph">
<p>TODO @XmlSeeAlso
<a href="http://stackoverflow.com/questions/7499735/jaxb-how-to-create-xml-from-polymorphic-classes" class="bare">http://stackoverflow.com/questions/7499735/jaxb-how-to-create-xml-from-polymorphic-classes</a></p>
</div>
</div>
<div class="sect4">
<h5 id="guide-xml.asciidoc_jaxb-custom-mapping">JAXB Custom Mapping</h5>
<div class="paragraph">
<p>In order to map custom <a href="#guide-datatype.asciidoc">datatypes</a> or other types that do not follow the Java bean conventions, you need to define a custom mapping. If you create dedicated objects dedicated for the XML mapping you can easily avoid such situations. When this is not suitable follow these instructions to define the mapping: TODO</p>
</div>
<div class="paragraph">
<p><a href="https://weblogs.java.net/blog/kohsuke/archive/2005/09/using_jaxb_20s.html" class="bare">https://weblogs.java.net/blog/kohsuke/archive/2005/09/using_jaxb_20s.html</a></p>
</div>
<!-- toc disabled -->
</div>
</div>
</div>
<div class="sect2">
<h3 id="guide-json.asciidoc">11.20. JSON</h3>
<div class="paragraph">
<p><a href="http://en.wikipedia.org/wiki/JSON">JSON</a> (JavaScript Object Notation) is a popular format to represent and exchange data especially for modern web-clients. For mapping Java objects to JSON and vice-versa there is no official standard API. We use the established and powerful open-source solution <a href="http://wiki.fasterxml.com/JacksonHome">Jackson</a>.
Due to problems with the wiki of fasterxml you should try this alternative link: <a href="https://github.com/FasterXML/jackson#jackson-project-home-github">Jackson/AltLink</a>.</p>
</div>
<div class="sect3">
<h4 id="guide-json.asciidoc_configure-json-mapping">11.20.1. Configure JSON Mapping</h4>
<div class="paragraph">
<p>In order to avoid polluting business objects with proprietary Jackson annotations (e.g. <code>@JsonTypeInfo</code>, <code>@JsonSubTypes</code>, <code>@JsonProperty</code>) we propose to create a separate configuration class. Every devonfw application (sample or any app created from our <a href="#tutorial-newapp.asciidoc">app-template</a>) therefore has a class called <code>ApplicationObjectMapperFactory</code> that extends ObjectMapperFactory from the devon4j-rest module. It looks like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Named("ApplicationObjectMapperFactory")
public class ApplicationObjectMapperFactory extends ObjectMapperFactory {

  public RestaurantObjectMapperFactory() {
    super();
    // JSON configuration code goes here
  }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="guide-json.asciidoc_json-and-inheritance">11.20.2. JSON and Inheritance</h4>
<div class="paragraph">
<p>If you are using inheritance for your objects mapped to JSON then polymorphism can not be supported out-of-the box. So in general avoid polymorphic objects in JSON mapping. However, this is not always possible.
Have a look at the following example from our sample application:</p>
</div>
<div id="guide-json.asciidoc_img-rest-inheritance" class="imageblock text-center">
<div class="content">
<img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/REST-Inheritance.png" alt="inheritance class diagram">
</div>
<div class="title">Figure 3. Transfer-Objects using Inheritance</div>
</div>
<div class="paragraph">
<p>Now assume you have a <a href="guide-service-layer.html#rest">REST service operation</a> as Java method that takes a ProductEto as argument. As this is an abstract class the server needs to know the actual sub-class to instantiate.
We typically do not want to specify the classname in the JSON as this should be an implementation detail and not part of the public JSON format (e.g. in case of a service interface). Therefore we use a symbolic name for each polymorphic subtype that is provided as virtual attribute @type within the JSON data of the object:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{ "@type": "Drink", ... }</code></pre>
</div>
</div>
<div class="paragraph">
<p>Therefore you add configuration code to the constructor of <a href="#guide-json.asciidoc_configure-json-mapping">ApplicationObjectMapperFactory</a>. Here you can see an example from the sample application:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">setBaseClasses(ProductEto.class);
addSubtypes(new NamedType(MealEto.class, "Meal"), new NamedType(DrinkEto.class, "Drink"),
  new NamedType(SideDishEto.class, "SideDish"));</code></pre>
</div>
</div>
<div class="paragraph">
<p>We use <code>setBaseClasses</code> to register all top-level classes of polymorphic objects. Further we declare all concrete polymorphic sub-classes together with their symbolic name for the JSON format via <code>addSubtypes</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="guide-json.asciidoc_custom-mapping">11.20.3. Custom Mapping</h4>
<div class="paragraph">
<p>In order to map custom <a href="#guide-datatype.asciidoc">datatypes</a> or other types that do not follow the Java bean conventions, you need to define a custom mapping. If you create objects dedicated for the JSON mapping you can easily avoid such situations. When this is not suitable follow these instructions to define the mapping:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>As an example, the use of JSR354 (<code>javax.money</code>) is appreciated in order to process monetary amounts properly. However, without custom mapping, the default mapping of Jackson will produce the following JSON for a <code>MonetaryAmount</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">"currency": {"defaultFractionDigits":2, "numericCode":978, "currencyCode":"EUR"},
"monetaryContext": {...},
"number":6.99,
"factory": {...}</code></pre>
</div>
</div>
<div class="paragraph">
<p>As clearly can be seen, the JSON contains too much information and reveals implementation secrets that do not belong here. Instead the JSON output expected and desired would be:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">"currency":"EUR","amount":"6.99"</code></pre>
</div>
</div>
<div class="paragraph">
<p>Even worse, when we send the JSON data to the server, Jackson will see that <code>MonetaryAmount</code> is an interface and does not know how to instantiate it so the request will fail.
Therefore we need a customized <a href="https://github.com/FasterXML/jackson-docs/wiki/JacksonHowToCustomSerializers">Serializer</a>.</p>
</div>
</li>
<li>
<p>We implement <code>MonetaryAmountJsonSerializer</code> to define how a <code>MonetaryAmount</code> is serialized to JSON:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public final class MonetaryAmountJsonSerializer extends JsonSerializer&lt;MonetaryAmount&gt; {

  public static final String NUMBER = "amount";
  public static final String CURRENCY = "currency";

  public void serialize(MonetaryAmount value, JsonGenerator jgen, SerializerProvider provider) throws ... {
    if (value != null) {
      jgen.writeStartObject();
      jgen.writeFieldName(MonetaryAmountJsonSerializer.CURRENCY);
      jgen.writeString(value.getCurrency().getCurrencyCode());
      jgen.writeFieldName(MonetaryAmountJsonSerializer.NUMBER);
      jgen.writeString(value.getNumber().toString());
      jgen.writeEndObject();
    }
  }</code></pre>
</div>
</div>
<div class="paragraph">
<p>For composite datatypes it is important to wrap the info as an object (<code>writeStartObject()</code> and <code>writeEndObject()</code>). <code>MonetaryAmount</code> provides the information we need by the <code>getCurrency()</code> and <code>getNumber()</code>. So that we can easily write them into the JSON data.</p>
</div>
</li>
<li>
<p>Next, we implement <code>MonetaryAmountJsonDeserializer</code> to define how a <code>MonetaryAmount</code> is deserialized back as Java object from JSON:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public final class MonetaryAmountJsonDeserializer extends AbstractJsonDeserializer&lt;MonetaryAmount&gt; {
  protected MonetaryAmount deserializeNode(JsonNode node) {
    BigDecimal number = getRequiredValue(node, MonetaryAmountJsonSerializer.NUMBER, BigDecimal.class);
    String currencyCode = getRequiredValue(node, MonetaryAmountJsonSerializer.CURRENCY, String.class);
    MonetaryAmount monetaryAmount =
        MonetaryAmounts.getAmountFactory().setNumber(number).setCurrency(currencyCode).create();
    return monetaryAmount;
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>For composite datatypes we extend from <a href="https://github.com/devonfw/devon4j/blob/develop/modules/rest/src/main/java/com/devonfw/module/rest/service/impl/json/AbstractJsonDeserializer.java"><code>AbstractJsonDeserializer</code></a> as this makes our task easier. So we already get a <code>JsonNode</code> with the parsed payload of our datatype. Based on this API it is easy to retrieve individual fields from the payload without taking care of their order, etc.
<code>AbstractJsonDeserializer</code> also provides methods such as <code>getRequiredValue</code> to read required fields and get them converted to the desired basis datatype. So we can easily read the amount and currency and construct an instance of <code>MonetaryAmount</code> via the official factory API.</p>
</div>
</li>
<li>
<p>Finally we need to register our custom (de)serializers with the following configuration code in the constructor of <a href="#guide-json.asciidoc_configure-json-mapping">ApplicationObjectMapperFactory</a>:+</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre>  SimpleModule module = getExtensionModule();
  module.addDeserializer(MonetaryAmount.class, new MonetaryAmountJsonDeserializer());
  module.addSerializer(MonetaryAmount.class, new MonetaryAmountJsonSerializer());</pre>
</div>
</div>
<div class="paragraph">
<p>Now we can read and write <code>MonetaryAmount</code> from and to JSON as expected.</p>
</div>
<!-- toc disabled -->
</div>
</div>
<div class="sect2">
<h3 id="guide-rest.asciidoc">11.21. REST</h3>
<div class="paragraph">
<p>REST (<a href="https://en.wikipedia.org/wiki/Representational_state_transfer">REpresentational State Transfer</a>) is an inter-operable protocol for <a href="#guide-service-layer.asciidoc">services</a> that is more lightweight than <a href="#guide-soap.asciidoc">SOAP</a>.
However, it is no real standard and can cause confusion. Therefore we define best practices here to guide you.
<strong>ATTENTION:</strong>
REST and RESTful often implies very strict and specific rules and conventions. However different people will often have different opinions of such rules. We learned that this leads to "religious discussions" (starting from <code>PUT</code> vs. <code>POST</code> and IDs in path vs. payload up to Hypermedia and <a href="https://en.wikipedia.org/wiki/HATEOAS">HATEOAS</a>). These "religious discussions" waste a lot of time and money without adding real value in case of common business applications (if you publish your API on the internet to billions of users this is a different story). Therefore we give best practices that lead to simple, easy and pragmatic "HTTP APIs" (to avoid the term "REST services" and end "religious discussions"). Please also note that we do not want to assault anybody nor force anyone to follow our guidelines. Please read the following best practices carefully and be aware that they might slightly differ from what your first hit on the web will say about REST (see e.g. <a href="http://restcookbook.com/">RESTful cookbook</a>).</p>
</div>
<div class="sect3">
<h4 id="guide-rest.asciidoc_urls">11.21.1. URLs</h4>
<div class="paragraph">
<p>URLs are not case sensitive. Hence, we follow the best practice to use only lower-case-letters-with-hypen-to-separate-words.
For operations in REST we distinguish the following types of URLs:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A <em>collection URL</em> is build from the rest service URL by appending the name of a collection. This is typically the name of an entity. Such URI identifies the entire collection of all elements of this type. Example: <code>https://mydomain.com/myapp/services/rest/mycomponent/v1/myentity</code></p>
</li>
<li>
<p>An <em>element URL</em> is build from a collection URL by appending an element ID. It identifies a single element (entity) within the collection. Example: <code>https://mydomain.com/myapp/services/rest/mycomponent/v1/myentity/42</code></p>
</li>
<li>
<p>A <em>search URL</em> is build from a collection URL by appending the segment <code>search</code>. The search criteria is send as <code>POST</code>. Example: <code>https://mydomain.com/myapp/services/rest/mycomponent/v1/myentity/search</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This fits perfect for <a href="https://en.wikipedia.org/wiki/Create,_read,_update_and_delete">CRUD</a> operations. For business operations (processing, calculation, etc.) we simply create a collection URL with the name of the business operation instead of the entity name (use a clear naming convention to avoid collisions). Then we can <code>POST</code> the input for the business operation and get the result back.</p>
</div>
<div class="paragraph">
<p>If you want to provide an entity with a different structure do not append further details to an element URL but create a separate collection URL as base.
So use <code>https://mydomain.com/myapp/services/rest/mycomponent/v1/myentity-with-details/42</code> instead of <code>https://mydomain.com/myapp/services/rest/mycomponent/v1/myentity/42/with-details</code>.
For offering a <a href="guide-transferobject.html#CTO">CTO</a> simply append <code>-cto</code> to the collection URL (e.g. <code>&#8230;&#8203;/myentity-cto/</code>).</p>
</div>
</div>
<div class="sect3">
<h4 id="guide-rest.asciidoc_http-methods">11.21.2. HTTP Methods</h4>
<div class="paragraph">
<p>While REST was designed as a pragmatical approach it sometimes leads to "religious discussions" e.g. about using <code>PUT</code> vs. <code>POST</code> (see ATTENTION notice above).
As the devonfw has a string focus on usual business applications it proposes a more "pragmatic" approach to REST services.</p>
</div>
<div class="paragraph">
<p>On the next table we compare the main differences between the "canonical" REST approach (or RESTful) and the devonfw proposal.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 12. Usage of HTTP methods</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>HTTP Method</strong></th>
<th class="tableblock halign-left valign-top"><strong>RESTful Meaning</strong></th>
<th class="tableblock halign-left valign-top"><strong>devonfw</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>GET</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Read single element.</p>
<p class="tableblock">Search on an entity (with parametrized url)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Read a single element.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>PUT</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Replace entity data.</p>
<p class="tableblock">Replace entire collection (typically not supported)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Not used</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>POST</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Create a new element in the collection</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Create or update an element in the collection.</p>
<p class="tableblock">Search on an entity (parametrized post body)</p>
<p class="tableblock">Bulk deletion.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>DELETE</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Delete an entity.</p>
<p class="tableblock">Delete an entire collection (typically not supported)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Delete an entity.</p>
<p class="tableblock">Delete an entire collection (typically not supported)</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Please consider these guidelines and rationales:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>We use <code>POST</code> on the collection URL to save an entity (<code>create</code> if no ID provided in payload otherwise <code>update</code>). This avoids pointless discussions in distinctions between <code>PUT</code> and <code>POST</code> and what to do if a <code>create</code> contains an ID in the payload or if an <code>update</code> is missing the ID property or contains a different ID in payload than in URL.</p>
</li>
<li>
<p>Hence, we do NOT use <code>PUT</code> but always use <code>POST</code> for write operations. As we always have a technical ID for each entity, we can simply distinguish create and update by the presence of the ID property.</p>
</li>
<li>
<p>Please also note that for (large) bulk deletions you may be forced to used <code>POST</code> instead of <code>DELETE</code> as according to the HTTP standard <code>DELETE</code> must not have payload and URLs are limited in length.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="guide-rest.asciidoc_http-status-codes">11.21.3. HTTP Status Codes</h4>
<div class="paragraph">
<p>Further we define how to use the HTTP status codes for REST services properly. In general the 4xx codes correspond to an error on the client side and the 5xx codes to an error on the server side.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 13. Usage of HTTP status codes</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>HTTP Code</strong></th>
<th class="tableblock halign-left valign-top"><strong>Meaning</strong></th>
<th class="tableblock halign-left valign-top"><strong>Response</strong></th>
<th class="tableblock halign-left valign-top"><strong>Comment</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">OK</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">requested result</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Result of successful GET</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">204</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No Content</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>none</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Result of successful POST, DELETE, or PUT (void return)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">400</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Bad Request</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">error details</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The HTTP request is invalid (parse error, validation failed)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">401</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Unauthorized</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>none</em> (security)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Authentication failed</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">403</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Forbidden</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>none</em> (security)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Authorization failed</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Not found</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>none</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Either the service URL is wrong or the requested resource does not exist</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">500</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Server Error</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">error code, UUID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Internal server error occurred (used for all technical exceptions)</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="guide-rest.asciidoc_metadata">11.21.4. Metadata</h4>
<div class="paragraph">
<p>devonfw has support for the following metadata in REST service invocations:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Further information</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">X-Correlation-Id</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HTTP header for a <em>correlation ID</em> that is a unique identifier to associate different requests belonging to the same session / action</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#guide-logging.asciidoc">Logging guide</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Validation errors</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Standardized format for a service to communicate validation errors to the client</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Server-side validation is documented in the <a href="#guide-validation.asciidoc">Validation guide</a>.</p>
<p class="tableblock">The protocol to communicate these validation errors to the client is worked on at <a href="https://github.com/oasp/oasp4j/issues/218" class="bare">https://github.com/oasp/oasp4j/issues/218</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Pagination</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Standardized format for a service to offer paginated access to a list of entities</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Server-side support for pagination is documented in the <a href="guide-repository.html#pagination">Repository Guide</a>.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="guide-rest.asciidoc_jax-rs">11.21.5. JAX-RS</h4>
<div class="paragraph">
<p>For implementing REST services we use the <a href="https://jax-rs-spec.java.net/">JAX-RS</a> standard. As an implementation we recommend <a href="http://cxf.apache.org/">CXF</a>. For <a href="#guide-json.asciidoc">JSON</a> bindings we use <a href="http://wiki.fasterxml.com/JacksonHome">Jackson</a> while <a href="#guide-xml.asciidoc">XML</a> binding works out-of-the-box with <a href="http://www.oracle.com/technetwork/articles/javase/index-140168.html">JAXB</a>.
To implement a service you write an interface with JAX-RS annotations for the API and a regular implementation class annotated with <code>@Named</code> to make it a spring-bean. Here is a simple example:
com.devonfw.application.mtsj.dishmanagement.service.impl.rest</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Path("/imagemanagement/v1")
@Consumes(MediaType.APPLICATION_JSON)
@Produces(MediaType.APPLICATION_JSON)
public interface ImagemanagementRestService {

  @GET
  @Path("/image/{id}/")
  public ImageEto getImage(@PathParam("id") long id);

}

@Named("ImagemanagementRestService")
public class ImagemanagementRestServiceImpl implements ImagemanagementRestService {

  @Inject
  private Imagemanagement imagemanagement;

  @Override
  public ImageEto getImage(long id) {

    return this.imagemanagement.findImage(id);
  }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here we can see a REST service for the <a href="architecture.html#business-architecture">business component</a> <code>imagemanagement</code>. The method <code>getImage</code> can be accessed via HTTP GET (see <code>@GET</code>) under the URL path <code>imagemanagement/image/{id}</code> (see <code>@Path</code> annotations) where <code>{id}</code> is the ID of the requested table and will be extracted from the URL and provided as parameter <code>id</code> to the method <code>getImage</code>. It will return its result (<code>ImageEto</code>) as <a href="#guide-json.asciidoc">JSON</a> (see <code>@Produces</code> - should already be defined as defaults in <code>RestService</code> marker interface). As you can see it delegates to the <a href="#guide-logic-layer.asciidoc">logic</a> component <code>imagemanagement</code> that contains the actual business logic while the service itself only exposes this logic via HTTP. The REST service implementation is a regular CDI bean that can use <a href="#guide-dependency-injection.asciidoc">dependency injection</a>.
The separation of the API as a Java interface allows to use it for <a href="#guide-service-client.asciidoc">service client calls</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
With JAX-RS it is important to make sure that each service method is annotated with the proper HTTP method (<code>@GET</code>,<code>@POST</code>,etc.) to avoid unnecessary debugging. So you should take care not to forget to specify one of these annotations.
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="guide-rest.asciidoc_jax-rs-configuration">JAX-RS Configuration</h5>
<div class="paragraph">
<p>Starting from CXF 3.0.0 it is possible to enable the auto-discovery of JAX-RS roots.</p>
</div>
<div class="paragraph">
<p>When the jaxrs server is instantiated all the scanned root and provider beans (beans annotated with <code>javax.ws.rs.Path</code> and <code>javax.ws.rs.ext.Provider</code>) are configured.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="guide-rest.asciidoc_rest-exception-handling">11.21.6. REST Exception Handling</h4>
<div class="paragraph">
<p>For exceptions a service needs to have an exception façade that catches all exceptions and handles them by writing proper log messages and mapping them to a HTTP response with an according <a href="#http-status-codes.asciidoc">HTTP status code</a>. Therefore the devonfw provides a generic solution via <code>RestServiceExceptionFacade</code>. You need to follow the <a href="#guide-exceptions.asciidoc">exception guide</a> so that it works out of the box because the façade needs to be able to distinguish between business and technical exceptions.
Now your service may throw exceptions but the façade with automatically handle them for you.</p>
</div>
</div>
<div class="sect3">
<h4 id="guide-rest.asciidoc_recommendations-for-rest-requests-and-responses">11.21.7. Recommendations for REST requests and responses</h4>
<div class="paragraph">
<p>The devonfw proposes, for simplicity, a deviation from the common REST pattern:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Using <code>POST</code> for updates (instead of <code>PUT</code>)</p>
</li>
<li>
<p>Using the payload for addressing resources on POST (instead of identifier on the <code>URL</code>)</p>
</li>
<li>
<p>Using parametrized <code>POST</code> for searches</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This use of REST will lead to simpler code both on client and on server. We discuss this use on the next points.</p>
</div>
<div class="paragraph">
<p>The following table specifies how to use the HTTP methods (verbs) for collection and element URIs properly (see <a href="http://en.wikipedia.org/wiki/Representational_State_Transfer#Applied_to_web_services">wikipedia</a>).</p>
</div>
<div class="sect4">
<h5 id="guide-rest.asciidoc_unparameterized-loading-of-a-single-resource">Unparameterized loading of a single resource</h5>
<div class="ulist">
<ul>
<li>
<p><strong>HTTP Method</strong>: <code>GET</code></p>
</li>
<li>
<p><strong>URL example</strong>: <code>/products/123</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For loading of a single resource, embed the <code>identifier</code> of the resource in the URL (for example <code>/products/123</code>).</p>
</div>
<div class="paragraph">
<p>The response contains the resource in JSON format, using a JSON object at the top-level, for example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-javascript hljs" data-lang="javascript">{
    "name": "Steak",
    "color": "brown"
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="guide-rest.asciidoc_unparameterized-loading-of-a-collection-of-resources">Unparameterized loading of a collection of resources</h5>
<div class="ulist">
<ul>
<li>
<p><strong>HTTP Method</strong>: <code>GET</code></p>
</li>
<li>
<p><strong>URL example</strong>: <code>/products</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For loading of a collection of resources, make sure that the size of the collection can never exceed a reasonable maximum size. For parameterized loading (searching, pagination), see below.</p>
</div>
<div class="paragraph">
<p>The response contains the collection in JSON format, using a JSON object at the top-level, and the actual collection underneath a <code>result</code> key, for example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-javascript hljs" data-lang="javascript">{
    "result": [
        {
            "name": "Steak",
            "color": "brown"
        },
        {
            "name": "Broccoli",
            "color": "green"
        }
    ]
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="guide-rest.asciidoc_saving-a-resource">Saving a resource</h5>
<div class="ulist">
<ul>
<li>
<p><strong>HTTP Method</strong>: <code>POST</code></p>
</li>
<li>
<p><strong>URL example</strong>: <code>/products</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The resource will be passed via JSON in the request body. If updating an existing resource, include the resource&#8217;s <code>identifier</code> in the JSON and not in the URL, in order to avoid ambiguity.</p>
</div>
<div class="paragraph">
<p>If saving was successful, an empty HTTP 204 response is generated.</p>
</div>
<div class="paragraph">
<p>If saving was unsuccessful, refer below for the format to return errors to the client.</p>
</div>
</div>
<div class="sect4">
<h5 id="guide-rest.asciidoc_parameterized-loading-of-a-resource">Parameterized loading of a resource</h5>
<div class="ulist">
<ul>
<li>
<p><strong>HTTP Method</strong>: <code>POST</code></p>
</li>
<li>
<p><strong>URL example</strong>: <code>/products/search</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In order to differentiate from an unparameterized load, a special <em>subpath</em> (for example <code>search</code>) is introduced. The parameters are passed via JSON in the request body. An example of a simple, paginated search would be:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-javascript hljs" data-lang="javascript">{
    "status": "OPEN",
    "pagination": {
        "page": 2,
        "size": 25
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The response contains the requested page of the collection in JSON format, using a JSON object at the top-level, the actual page underneath a <code>result</code> key, and additional pagination information underneath a <code>pagination</code> key, for example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-javascript hljs" data-lang="javascript">{
    "pagination": {
        "page": 2,
        "size": 25,
        "total": null
    },
    "result": [
        {
            "name": "Steak",
            "color": "brown"
        },
        {
            "name": "Broccoli",
            "color": "green"
        }
    ]
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Compare the code needed on server side to accept this request:
com.devonfw.application.mtsj.dishmanagement.service.api.rest</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Path("/category/search")
  @POST
  public PaginatedListTo&lt;CategoryEto&gt; findCategorysByPost(CategorySearchCriteriaTo searchCriteriaTo) {
    return this.dishmanagement.findCategoryEtos(searchCriteriaTo);
 }</code></pre>
</div>
</div>
<div class="paragraph">
<p>With the equivalent code required if doing it the RESTful way by issuing a <code>GET</code> request:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"> @Path("/category/search")
  @POST @Path("/order")
  @GET
  public PaginatedListTo&lt;CategoryEto&gt; findCategorysByPost( @Context UriInfo info) {

    RequestParameters parameters = RequestParameters.fromQuery(info);
    CategorySearchCriteriaTo criteria = new CategorySearchCriteriaTo();
    criteria.setName(parameters.get("name", Long.class, false));
    criteria.setDescription(parameters.get("description", OrderState.class, false));
    criteria.setShowOrder(parameters.get("showOrder", OrderState.class, false));
    return this.dishmanagement.findCategoryEtos(criteria);

  }</code></pre>
</div>
</div>
<div class="sect5">
<h6 id="guide-rest.asciidoc_pagination-details">Pagination details</h6>
<div class="paragraph">
<p>The client can choose to request a count of the total size of the collection, for example to calculate the total number of available pages. It does so, by specifying the <code>pagination.total</code> property with a value of <code>true</code>.</p>
</div>
<div class="paragraph">
<p>The service is free to honour this request. If it chooses to do so, it returns the total count as the <code>pagination.total</code> property in the response.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="guide-rest.asciidoc_deletion-of-a-resource">Deletion of a resource</h5>
<div class="ulist">
<ul>
<li>
<p><strong>HTTP Method</strong>: <code>DELETE</code></p>
</li>
<li>
<p><strong>URL example</strong>: <code>/products/123</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For deletion of a single resource, embed the <code>identifier</code> of the resource in the URL (for example <code>/products/123</code>).</p>
</div>
</div>
<div class="sect4">
<h5 id="guide-rest.asciidoc_error-results">Error results</h5>
<div class="paragraph">
<p>The general format for returning an error to the client is as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-javascript hljs" data-lang="javascript">{
    "message": "A human-readable message describing the error",
    "code": "A code identifying the concrete error",
    "uuid": "An identifier (generally the correlation id) to help identify corresponding requests in logs"
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If the error is caused by a failed validation of the entity, the above format is extended to also include the list of individual validation errors:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-javascript hljs" data-lang="javascript">{
    "message": "A human-readable message describing the error",
    "code": "A code identifying the concrete error",
    "uuid": "An identifier (generally the correlation id) to help identify corresponding requests in logs",
    "errors": {
        "property failing validation": [
            "First error message on this property",
            "Second error message on this property"
        ],
        // ....
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="guide-rest.asciidoc_rest-media-types">11.21.8. REST Media Types</h4>
<div class="paragraph">
<p>The payload of a REST service can be in any format as REST by itself does not specify this. The most established ones that the devonfw recommends are <a href="#guide-xml.asciidoc">XML</a> and <a href="#guide-json.asciidoc">JSON</a>. Follow these links for further details and guidance how to use them properly. <code>JAX-RS</code> and <code>CXF</code> properly support these formats (<code>MediaType.APPLICATION_JSON</code> and <code>MediaType.APPLICATION_XML</code> can be specified for <code>@Produces</code> or <code>@Consumes</code>). Try to decide for a single format for all services if possible and NEVER mix different formats in a service.</p>
</div>
</div>
<div class="sect3">
<h4 id="guide-rest.asciidoc_rest-testing">11.21.9. REST Testing</h4>
<div class="paragraph">
<p>For testing REST services in general consult the <a href="#guide-testing.asciidoc">testing guide</a>.</p>
</div>
<div class="paragraph">
<p>For manual testing REST services there are browser plugins:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Firefox: <a href="https://addons.mozilla.org/en-US/firefox/addon/httprequester/">httprequester</a> (or <a href="https://addons.mozilla.org/en-US/firefox/addon/poster/">poster</a>)</p>
</li>
<li>
<p>Chrome: <a href="http://www.getpostman.com/">postman</a> (<a href="https://chrome.google.com/webstore/detail/advanced-rest-client/hgmloofddffdnphfgcellkdfbfbjeloo">advanced-rest-client</a>)</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="guide-rest.asciidoc_security">11.21.10. Security</h4>
<div class="paragraph">
<p>Your services are the major entry point to your application. Hence security considerations are important here.</p>
</div>
<div class="sect4">
<h5 id="guide-rest.asciidoc_csrf">CSRF</h5>
<div class="paragraph">
<p>A common security threat is <a href="https://www.owasp.org/index.php/Top_10_2013-A8-Cross-Site_Request_Forgery_(CSRF)">CSRF</a> for REST services. Therefore all REST operations that are performing modifications (PUT, POST, DELETE, etc. - all except GET) have to be secured against CSRF attacks. In devon4j we are using spring-security that already solves CSRF token generation and verification. The integration is part of the application template as well as the sample-application.</p>
</div>
<div class="paragraph">
<p>For testing in development environment the CSRF protection can be disabled using the JVM option <code>-DCsrfDisabled=true</code> when starting the application.</p>
</div>
</div>
<div class="sect4">
<h5 id="guide-rest.asciidoc_json-top-level-arrays">JSON top-level arrays</h5>
<div class="paragraph">
<p>OWASP suggests to prevent returning JSON arrays at the top-level, to prevent attacks (see <a href="https://www.owasp.org/index.php/OWASP_AJAX_Security_Guidelines" class="bare">https://www.owasp.org/index.php/OWASP_AJAX_Security_Guidelines</a>). However, no rationale is given at OWASP. We digged deep and found <a href="http://haacked.com/archive/2008/11/20/anatomy-of-a-subtle-json-vulnerability.aspx/">anatomy-of-a-subtle-json-vulnerability</a>. To sum it up the attack is many years old and does not work in any recent or relevant browser. Hence it is fine to use arrays as top-level result in a JSON REST service (means you can return <code>List&lt;Foo&gt;</code> in a Java JAX-RS service).</p>
</div>
<!-- toc disabled -->
</div>
</div>
</div>
<div class="sect2">
<h3 id="guide-soap.asciidoc">11.22. SOAP</h3>
<div class="paragraph">
<p><a href="https://en.wikipedia.org/wiki/SOAP">SOAP</a> is a common protocol for <a href="#guide-service-layer.asciidoc">services</a> that is rather complex and heavy. It allows to build inter-operable and well specified services (see WSDL). SOAP is transport neutral what is not only an advantage. We strongly recommend to use HTTPS transport and ignore additional complex standards like WS-Security and use established HTTP-Standards such as RFC2617 (and RFC5280).</p>
</div>
<div class="sect3">
<h4 id="guide-soap.asciidoc_jax-ws">11.22.1. JAX-WS</h4>
<div class="paragraph">
<p>For building web-services with Java we use the <a href="https://jcp.org/en/jsr/detail?id=224">JAX-WS</a> standard.
There are two approaches:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>code first</p>
</li>
<li>
<p>contract first</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Here is an example in case you define a code-first service.</p>
</div>
<div class="sect4">
<h5 id="guide-soap.asciidoc_web-service-interface">Web-Service Interface</h5>
<div class="paragraph">
<p>We define a regular interface to define the API of the service and annotate it with JAX-WS annotations:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@WebService
public interface TablemanagmentWebService {

  @WebMethod
  @WebResult(name = "message")
  TableEto getTable(@WebParam(name = "id") String id);

}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="guide-soap.asciidoc_web-service-implementation">Web-Service Implementation</h5>
<div class="paragraph">
<p>And here is a simple implementation of the service:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Named
@WebService(endpointInterface = "com.devonfw.application.mtsj.tablemanagement.service.api.ws.TablemanagmentWebService")
public class TablemanagementWebServiceImpl implements TablemanagmentWebService {

  private Tablemanagement tableManagement;

  @Override
  public TableEto getTable(String id) {

    return this.tableManagement.findTable(id);
  }</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="guide-soap.asciidoc_soap-custom-mapping">11.22.2. SOAP Custom Mapping</h4>
<div class="paragraph">
<p>In order to map custom <a href="#guide-datatype.asciidoc">datatypes</a> or other types that do not follow the Java bean conventions, you need to write adapters for JAXB (see <a href="#guide-xml.asciidoc">XML</a>).</p>
</div>
</div>
<div class="sect3">
<h4 id="guide-soap.asciidoc_soap-testing">11.22.3. SOAP Testing</h4>
<div class="paragraph">
<p>For testing SOAP services in general consult the <a href="#guide-testing.asciidoc">testing guide</a>.</p>
</div>
<div class="paragraph">
<p>For testing SOAP services manually we strongly recommend <a href="http://www.soapui.org/">SoapUI</a>.</p>
</div>
<!-- toc disabled -->
</div>
</div>
<div class="sect2">
<h3 id="guide-service-client.asciidoc">11.23. Service Client</h3>
<div class="paragraph">
<p>This guide is about consuming (calling) services from other applications (micro-services). For providing services see the <a href="#guide-service-layer.asciidoc">Service-Layer Guide</a>. Services can be consumed in the <a href="#guide-client-layer.asciidoc">client</a> or the server. As the client is typically not written in Java you should consult the according guide for your client technology. In case you want to call a service within your Java code this guide is the right place to get help.</p>
</div>
<div class="sect3">
<h4 id="guide-service-client.asciidoc_motivation">11.23.1. Motivation</h4>
<div class="paragraph">
<p>Various solutions already exist for calling services such as <code>RestTemplate</code> from spring or the JAX-RS client API. Further each and every service framework offers its own API as well. These solutions might be suitable for very small and simple projects (with one or two such invocations). However, with the trend of microservices the invocation of a service becomes a very common use-case that occurs all over the place. Have a look at the following features to get an idea why you want to use the solution offered here.</p>
</div>
</div>
<div class="sect3">
<h4 id="guide-service-client.asciidoc_requirements">11.23.2. Requirements</h4>
<div class="paragraph">
<p>You need to add (at least one of) these dependencies to your application:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;!-- Starter for consuming REST services --&gt;
&lt;dependency&gt;
  &lt;groupId&gt;com.devonfw.java.starters&lt;/groupId&gt;
  &lt;artifactId&gt;devon4j-starter-cxf-client-rest&lt;/artifactId&gt;
&lt;/dependency&gt;
&lt;!-- Starter for consuming SOAP services --&gt;
&lt;dependency&gt;
  &lt;groupId&gt;com.devonfw.java.starters&lt;/groupId&gt;
  &lt;artifactId&gt;devon4j-starter-cxf-client-ws&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="guide-service-client.asciidoc_features">11.23.3. Features</h4>
<div class="paragraph">
<p>When invoking a service you need to consider many cross-cutting aspects. You might not think about them in the very first place and you do not want to implement them multiple times redundantly. Therefore you should consider using this approach. The following sub-sections list the covered features and aspects:</p>
</div>
<div class="sect4">
<h5 id="guide-service-client.asciidoc_simple-usage">Simple usage</h5>
<div class="paragraph">
<p>Assuming you already have a Java interface <code>MyService</code> of the service you want to invoke:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">package com.company.department.foo.mycomponent.service.api.rest;
...

@Path("/myservice")
public interface MyService extends RestService {

  @POST
  @Path("/getresult")
  MyResult getResult(MyArgs myArgs);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then all you need to do is this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Named
public class UcMyUseCaseImpl extends MyUseCaseBase implements UcMyUseCase {
  @Inject
  private ServiceClientFactory serviceClientFactory;

  ...
  private MyResult callMyServiceMethod(MyArgs myArgs) {
    MyService myService = this.serviceClientFactory.create(MyService.class);
    MyResult myResult = myService.myMethod(myArgs); // synchronous call of service over the wire
    return myResult;
  }</code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see the synchronous invocation of a service is very simple. Still it is very flexible and powerful (see following features). The actual call of <code>myMethod</code> will technically call the remote service over the wire (e.g. via HTTP) including marshaling the arguments (e.g. converting <code>myArgs</code> to JSON) and unmarshalling the result (e.g. converting the received JSON to <code>myResult</code>).</p>
</div>
</div>
<div class="sect4">
<h5 id="guide-service-client.asciidoc_configuration">Configuration</h5>
<div class="paragraph">
<p>This solution allows a very flexible configuration on the following levels:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Global configuration (defaults)</p>
</li>
<li>
<p>Configuration per remote service application (microservice)</p>
</li>
<li>
<p>Configuration per invocation.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>A configuration on a deeper level (e.g. 3) overrides the configuration from a higher level (e.g. 1).</p>
</div>
<div class="paragraph">
<p>The configuration on Level 1 and 2 are configured via <code>application.properties</code>
(see <a href="#guide-configuration.asciidoc">configuration guide</a>).
For Level 1 the prefix <code>service.client.default.</code> is used for properties.
Further, for level 2. the prefix <code>service.client.app.«application».</code> is used where <code>«application»</code> is the
technical name of the application providing the service. This name will automatically be derived from
the java package of the service interface (e.g. <code>foo</code> in <code>MyService</code> interface before) following our
<a href="coding-conventions.html#packages">packaging conventions</a>.
In case these conventions are not met it will fallback to the fully qualified name of the service interface.</p>
</div>
<div class="paragraph">
<p>Configuration on Level 3 has to be provided as <code>Map</code> argument to the method
<code>ServiceClientFactory.create(Class&lt;S&gt; serviceInterface, Map&lt;String, String&gt; config)</code>.
The keys of this <code>Map</code> will not use prefixes (such as the ones above). For common configuration
parameters a type-safe builder is offered to create such map via <code>ServiceClientConfigBuilder</code>.
E.g. for testing you may want to do:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">this.serviceClientFactory.create(MyService.class,
  new ServiceClientConfigBuilder().authBasic().userLogin(login).userPassword(password).buildMap());</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<strong>TODO</strong> add configuration properties for external/mock service from Sneha
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="guide-service-client.asciidoc_service-discovery">Service Discovery</h5>
<div class="paragraph">
<p>You do not want to hardwire service URLs in your code, right? Therefore different strategies might apply
to <em>discover</em> the URL of the invoked service. This is done internally by an implementation of the interface
<code>ServiceDiscoverer</code>. The default implementation simply reads the base URL from the configuration (see above).
So you can simply add this to your <code>application.properties</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>service.client.app.foo.url=https://foo.company.com:8443/services/rest
service.client.app.bar.url=http://bar.company.com:8080/services/rest
service.client.default.url=https://api.company.com/services/rest</code></pre>
</div>
</div>
<div class="paragraph">
<p>Assuming your service interface would have the fully qualified name
<code>com.company.department.foo.mycomponent.service.api.rest.MyService</code> then the URL would be resolved to
<code><a href="https://foo.company.com:8443/services/rest" class="bare">https://foo.company.com:8443/services/rest</a></code> as the <code>«application»</code> is <code>foo</code>.</p>
</div>
<div class="paragraph">
<p>Additionally, the URL might use the following variables that will automatically be resolved:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>${app}</code> to <code>«application»</code> (useful for default URL)</p>
</li>
<li>
<p><code>${type}</code> to the type of the service. E.g. <code>rest</code> in case of a <a href="#guide-rest.asciidoc">REST</a> service and <code>ws</code> for a <a href="#guide-soap.asciidoc">SOAP</a> service.</p>
</li>
<li>
<p><code>${local.server.port}</code> for the port of your current Java servlet container running the JVM. Should only used for testing with spring-boot random port mechanism (technically spring can not resolve this variable but we do it for you here).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Therefore, the default URL may also be configured as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>service.client.default.url=https://api.company.com/${app}/services/${type}</code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can use any implementation of <code>ServiceDiscoverer</code>, you can also easily use <a href="https://github.com/Netflix/eureka#eureka">eureka</a> (or anything else) instead to discover your services.</p>
</div>
</div>
<div class="sect4">
<h5 id="guide-service-client.asciidoc_headers">Headers</h5>
<div class="paragraph">
<p>A very common demand is to tweak (HTTP) headers in the request to invoke the service. May it be for security (authentication data) or for other cross-cutting concerns (such as the <a href="guide-logging.html#correlation-id">Correlation ID</a>). This is done internally by implementations of the interface  <code>ServiceHeaderCustomizer</code>.
We already provide several implementations such as:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>ServiceHeaderCustomizerBasicAuth</code> for basic authentication (mainly for testing).</p>
</li>
<li>
<p><code>ServiceHeaderCustomizerOAuth</code> for OAuth (passes a security token from security context such as a <a href="https://jwt.io/">JWT</a> via OAuth).</p>
</li>
<li>
<p><code>ServiceHeaderCustomizerCorrelationId</code> passed the <a href="guide-logging.html#correlation-id">Correlation ID</a> to the service request.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Additionally, you can add further custom implementations of <code>ServiceHeaderCustomizer</code> for your individual requirements and additional headers.</p>
</div>
</div>
<div class="sect4">
<h5 id="guide-service-client.asciidoc_timeouts">Timeouts</h5>
<div class="paragraph">
<p>You can configure timeouts in a very flexible way. First of all you can configure timeouts to establish the connection (<code>timeout.connection</code>) and to wait for the response (<code>timeout.response</code>) separately. These timeouts can be configured on all three levels as described in the configuration section above.</p>
</div>
</div>
<div class="sect4">
<h5 id="guide-service-client.asciidoc_error-handling">Error Handling</h5>
<div class="paragraph">
<p>Whilst invoking a remote service an error may occur. This solution will automatically handle such errors and map them to a higher level <code>ServiceInvocationFailedException</code>. In general we separate two different types of errors:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Network error</strong><br>
In such case (host not found, connection refused, time out, etc.) there is not even a response from the server. However, in advance to a low-level exception you will get a wrapped <code>ServiceInvocationFailedException</code> (with code <code>ServiceInvoke</code>) with a readable message containing the service that could not be invoked.</p>
</li>
<li>
<p><strong>Service error</strong><br>
In case the service failed on the server-side the <a href="guide-rest.html#error-results">error result</a> will be parsed and thrown as a <code>ServiceInvocationFailedException</code> with the received message and code.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="guide-service-client.asciidoc_logging">Logging</h5>
<div class="paragraph">
<p>By default this solution will log all invocations including the URL of the invoked service, success or error status flag and the duration in seconds (with decimal nano precision as available). Therefore you can easily monitor the status and performance of the service invocations.</p>
</div>
</div>
<div class="sect4">
<h5 id="guide-service-client.asciidoc_asynchronous-support">Asynchronous Support</h5>
<div class="paragraph">
<p>An important aspect is also asynchronous (and reactive) support. So far we only propose this as an enhancement for a future release with an API like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public interface ServiceClientAsyncFactory extends ServiceClientFactory {
  AsyncClient&lt;S&gt; createAsync(Class&lt;S&gt; serviceInterface);
}

public interface AsyncClient&lt;S&gt; {
  S getClient();
  &lt;R&gt; Mono&lt;R&gt; call(R result);
  &lt;T&gt; Flux&lt;T&gt; call(Collection&lt;? extends T&gt; result);
  &lt;R&gt; void call(R result, Consumer&lt;R&gt; callback);
  &lt;R&gt; CompletableFuture&lt;R&gt; callFuture(R result);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This API would allow typesafe usage like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Named
public class UcMyUseCaseImpl extends MyUseCaseBase implements UcMyUseCase {
  @Inject private ServiceClientFactoryAsync clientFactory;

  @Override @RolesAllowed(...)
  public void doSomething(Bar bar) {
    AsyncClient&lt;MyExternalServiceApi&gt; client = this.clientFactory.createAsync(MyExternalServiceApi.class);
    Mono&lt;Some&gt; result = client.call(client.getService().doSomething(convert(bar)));
    // client.call(client.getService().doSomething(convert(bar)), x -&gt; processSync(x));
    return process(result);
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>How can this work? The ServiceClientAsyncFactory implementation would create its own dynamic proxy for the given service interface. That proxy would only track the last call that was invoked internally and always return a dummy result (<code>null</code> for Object types, <code>false</code> for boolean, <code>0</code> for primitive numbers). The actual implementation of the <code>call</code> methods can access the internal invocation that has been recorded from the last service call. It will then trigger the actual service call internally according to the desired style (using a <code>Consumer</code> callback, <code>Mono</code>, <code>Flux</code>, <code>Future</code>&#8230;&#8203;).</p>
</div>
</div>
<div class="sect4">
<h5 id="guide-service-client.asciidoc_resilience">Resilience</h5>
<div class="paragraph">
<p>Resilience adds a lot of complexity and that typically means that addressing this here would most probably result in not being up-to-date and not meeting all requirements. Therefore we recommend something completely different: the <em>sidecar</em> approach (based on <a href="https://docs.microsoft.com/en-us/azure/architecture/patterns/sidecar">sidecar pattern</a>). This means that you use a generic proxy app that runs as a separate process on the same host, VM, or container of your actual application. Then in your app you are calling the service via the sidecar proxy on <code>localhost</code> (service discovery URL is e.g. <code><a href="http://localhost:8081/${app}/services/${type}" class="bare">http://localhost:8081/${app}/services/${type}</a></code>) that then acts as proxy to the actual remote service. Now aspects such as resilience with circuit breaking and the actual service discovery can be configured in the sidecar proxy app and independent of your actual application. Therefore, you can even share and reuse configuration and experience with such a sidecar proxy app even across different technologies (Java, .NET/C#, Node.JS, etc.).</p>
</div>
<div class="paragraph">
<p>Various implementations of such sidecar proxy apps are available as free open source software.
<strong>TODO</strong>: Decide for the best available solution and suggest here as default.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Netflix Sidecar - see <a href="http://cloud.spring.io/spring-cloud-netflix/single/spring-cloud-netflix.html#_polyglot_support_with_sidecar">Spring Cloud Netflix docs</a></p>
</li>
<li>
<p><a href="https://lyft.github.io/envoy/">Envoy</a> - see <a href="https://dzone.com/articles/microservices-patterns-with-envoy-sidecar-proxy-pa">Microservices Patterns With Envoy Sidecar Proxy</a></p>
</li>
<li>
<p><a href="https://github.com/netflix/Prana">Prana</a> - see <a href="https://medium.com/netflix-techblog/prana-a-sidecar-for-your-netflix-paas-based-applications-and-services-258a5790a015">Prana: A Sidecar for your Netflix PaaS based Applications and Services</a> &#8592; <strong>Not updated as it&#8217;s not used internally by Netflix</strong></p>
</li>
<li>
<p>Keycloak - see <a href="http://www.hawkular.org/blog/2017/07/jaeger-with-security-proxy.html">Protecting Jaeger UI with a sidecar security proxy</a></p>
</li>
</ul>
</div>
<!-- toc disabled -->
</div>
</div>
</div>
<div class="sect2">
<h3 id="guide-testing.asciidoc">11.24. Testing</h3>
<div class="sect3">
<h4 id="guide-testing.asciidoc_general-best-practices">11.24.1. General best practices</h4>
<div class="paragraph">
<p>For testing please follow our general best practices:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Tests should have a clear goal that should also be documented.</p>
</li>
<li>
<p>Tests have to be classified into different <a href="#guide-testing.asciidoc_integration-levels">integration levels</a>.</p>
</li>
<li>
<p>Tests should follow a clear naming convention.</p>
</li>
<li>
<p>Automated tests need to properly assert the result of the tested operation(s) in a reliable way. E.g. avoid stuff like <code>assertThat(service.getAllEntities()).hasSize(42)</code> or even worse tests that have no assertion at all.</p>
</li>
<li>
<p>Tests need to be independent of each other. Never write test-cases or tests (in Java @Test methods) that depend on another test to be executed before.</p>
</li>
<li>
<p>Use <a href="http://joel-costigliola.github.io/assertj/">AssertJ</a> to write good readable and maintainable tests that also provide valuable feedback in case a test fails. Do not use legacy JUnit methods like <code>assertEquals</code> anymore!</p>
</li>
<li>
<p>For easy understanding divide your test in three commented sections:</p>
<div class="ulist">
<ul>
<li>
<p><code>//given</code></p>
</li>
<li>
<p><code>//when</code></p>
</li>
<li>
<p><code>//then</code></p>
</li>
</ul>
</div>
</li>
<li>
<p>Plan your tests and test data management properly before implementing.</p>
</li>
<li>
<p>Instead of having a too strong focus on test coverage better ensure you have covered your critical core functionality properly and review the code including tests.</p>
</li>
<li>
<p>Test code shall NOT be seen as second class code. You shall consider design, architecture and code-style also for your test code but do not over-engineer it.</p>
</li>
<li>
<p>Test automation is good but should be considered in relation to cost per use. Creating full coverage via <em>automated system tests</em> can cause a massive amount of test-code that can turn out as a huge maintenance hell. Always consider all aspects including product life-cycle, criticality of use-cases to test, and variability of the aspect to test (e.g. UI, test-data).</p>
</li>
<li>
<p>Use continuous integration and establish that the entire team wants to have clean builds and running tests.</p>
</li>
<li>
<p>Prefer delegation over inheritance for cross-cutting testing functionality. Good places to put this kind of code can be realized and reused via the JUnit @Rule mechanism.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="guide-testing.asciidoc_test-automation-technology-stack">11.24.2. Test Automation Technology Stack</h4>
<div class="paragraph">
<p>For test automation we use <a href="http://junit.org/">JUnit</a>. However, we are strictly doing all assertions with <a href="http://joel-costigliola.github.io/assertj/">AssertJ</a>. For <a href="#guide-testing.asciidoc_test-doubles">mocking</a> we use <a href="http://mockito.org/">mockito</a>.
In order to mock remote connections we use <a href="#guide-testing.asciidoc_wiremock">wiremock</a>.
For testing entire components or sub-systems we recommend to use <a href="https://docs.spring.io/spring-boot/docs/current/reference/html/boot-features-testing.html">spring-boot-starter-test</a> as lightweight and fast testing infrastructure that is already shipped with <code>devon4j-test</code>.</p>
</div>
<div class="paragraph">
<p>In case you have to use a full blown JEE application server, we recommend to use <a href="http://arquillian.org/">arquillian</a>. To get started with arquillian, look <a href="http://arquillian.org/guides/getting_started/index.html#add_the_arquillian_apis">here</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="guide-testing.asciidoc_test-doubles">11.24.3. Test Doubles</h4>
<div class="paragraph">
<p>We use <a href="http://xunitpatterns.com/Using%20Test%20Doubles.html">test doubles</a> as generic term for mocks, stubs, fakes, dummies, or spys to avoid confusion. Here is a short summary from <a href="http://martinfowler.com/articles/mocksArentStubs.html">stubs VS mocks</a>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Dummy</strong> objects specifying no logic at all. May declare data in a POJO style to be used as boiler plate code to parameter lists or even influence the control flow towards the test&#8217;s needs.</p>
</li>
<li>
<p><strong>Fake</strong> objects actually have working implementations, but usually take some shortcut which makes them not suitable for production (an in memory database is a good example).</p>
</li>
<li>
<p><strong>Stubs</strong> provide canned answers to calls made during the test, usually not responding at all to anything outside what&#8217;s programmed in for the test. Stubs may also record information about calls, such as an email gateway stub that remembers the messages it 'sent', or maybe only how many messages it 'sent'.</p>
</li>
<li>
<p><strong>Mocks</strong> are objects pre-programmed with expectations, which form a specification of the calls they are expected to receive.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>We try to give some examples, which should make it somehow clearer:</p>
</div>
<div class="sect4">
<h5 id="guide-testing.asciidoc_stubs">Stubs</h5>
<div class="paragraph">
<p>Best Practices for applications:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A good way to replace small to medium large boundary systems, whose impact (e.g. latency) should be ignored during load and performance tests of the application under development.</p>
</li>
<li>
<p>As stub implementation will rely on state-based verification, there is the threat, that test developers will partially reimplement the state transitions based on the replaced code. This will immediately lead to a black maintenance whole, so better use mocks to assure the certain behavior on interface level.</p>
</li>
<li>
<p>Do NOT use stubs as basis of a large amount of test cases as due to state-based verification of stubs, test developers will enrich the stub implementation to become a large monster with its own hunger after maintenance efforts.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="guide-testing.asciidoc_mocks">Mocks</h5>
<div class="paragraph">
<p>Best Practices for applications:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Replace not-needed dependencies of your system-under-test (SUT) to minimize the application context to start of your component framework.</p>
</li>
<li>
<p>Replace dependencies of your SUT to impact the control flow under test without establishing all the context parameters needed to match the control flow.</p>
</li>
<li>
<p>Remember: Not everything has to be mocked! Especially on lower levels of tests like isolated module tests you can be betrayed into a mocking delusion, where you end up in a hundred lines of code mocking the whole context and five lines executing the test and verifying the mocks behavior. Always keep in mind the benefit-cost ratio, when implementing tests using mocks.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="guide-testing.asciidoc_wiremock">Wiremock</h5>
<div class="paragraph">
<p>If you need to mock remote connections such as HTTP-Servers, wiremock offers easy to use functionality. For a full description see the <a href="http://wiremock.org/">homepage</a> or the <a href="https://github.com/tomakehurst/wiremock">github repository</a>. Wiremock can be used either as a JUnit Rule, in Java outside of JUnit or as a standalone process. The mocked server can be configured to respond to specific requests in a given way via a fluent Java API, JSON files and JSON over HTTP. An example as an integration to JUnit can look as follows.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import static com.github.tomakehurst.wiremock.core.WireMockConfiguration.wireMockConfig;
import com.github.tomakehurst.wiremock.junit.WireMockRule;

public class WireMockOfferImport{

  @Rule
  public WireMockRule mockServer = new WireMockRule(wireMockConfig().dynamicPort());

  @Test
  public void requestDataTest() throws Exception {
  int port = this.mockServer.port();
  ...}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This creates a server on a randomly chosen free port on the running machine. You can also specify the port to be used if wanted. Other than that there are several options to further configure the server. This includes HTTPs, proxy settings, file locations, logging and extensions.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">  @Test
  public void requestDataTest() throws Exception {
      this.mockServer.stubFor(get(urlEqualTo("/new/offers")).withHeader("Accept", equalTo("application/json"))
      .withHeader("Authorization", containing("Basic")).willReturn(aResponse().withStatus(200).withFixedDelay(1000)
      .withHeader("Content-Type", "application/json").withBodyFile("/wireMockTest/jsonBodyFile.json")));
  }</code></pre>
</div>
</div>
<div class="paragraph">
<p>This will stub the URL <code>localhost:port/new/offers</code> to respond with a status 200 message containing a header (<code>Content-Type: application/json</code>) and a body with content given in <code>jsonBodyFile.json</code> if the request matches several conditions.
It has to be a GET request to <code>../new/offers</code> with the two given header properties.</p>
</div>
<div class="paragraph">
<p>Note that by default files are located in <code>src/test/resources/__files/</code>. When using only one WireMock server one can omit the <code>this.mockServer</code> in before the <code>stubFor</code> call (static method).
You can also add a fixed delay to the response or processing delay with <code>WireMock.addRequestProcessingDelay(time)</code> in order to test for timeouts.</p>
</div>
<div class="paragraph">
<p>WireMock can also respond with different corrupted messages to simulate faulty behaviour.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Test(expected = ResourceAccessException.class)
public void faultTest() {

    this.mockServer.stubFor(get(urlEqualTo("/fault")).willReturn(aResponse()
    .withFault(Fault.MALFORMED_RESPONSE_CHUNK)));
...}</code></pre>
</div>
</div>
<div class="paragraph">
<p>A GET request to <code>../fault</code> returns an OK status header, then garbage, and then closes the connection.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="guide-testing.asciidoc_integration-levels">11.24.4. Integration Levels</h4>
<div class="paragraph">
<p>There are many discussions about the right level of integration for test automation. Sometimes it is better to focus on small, isolated modules of the system - whatever a "module" may be. In other cases it makes more sense to test integrated groups of modules. Because there is no universal answer to this question, devonfw only defines a common terminology for what could be tested. Each project must make its own decision where to put the focus of test automation. There is no worldwide accepted terminology for the integration levels of testing. In general we consider <a href="http://istqbexamcertification.com/what-are-software-testing-levels/">ISTQB</a>. However, with a technical focus on test automation we want to get more precise.</p>
</div>
<div class="paragraph">
<p>The following picture shows a simplified view of an application based on the <a href="architecture.html#technical-architecture">devonfw reference architecture</a>. We define four integration levels that are explained in detail below.
The boxes in the picture contain parenthesized numbers. These numbers depict the lowest integration level, a box belongs to. Higher integration levels also contain all boxes of lower integration levels. When writing tests for a given integration level, related boxes with a lower integration level must be replaced by test <a href="#guide-testing.asciidoc_test-doubles">doubles</a> or drivers.</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/integration-levels.png" alt="Integration Levels">
</div>
</div>
<div class="paragraph">
<p>The main difference between the integration levels is the amount of infrastructure needed to test them. The more infrastructure you need, the more bugs you will find, but the more instable and the slower your tests will be. So each project has to make a trade-off between pros and contras of including much infrastructure in tests and has to select the integration levels that fit best to the project.</p>
</div>
<div class="paragraph">
<p>Consider, that more infrastructure does not automatically lead to a better bug-detection. There may be bugs in your software that are masked by bugs in the infrastructure. The best way to find those bugs is to test with very few infrastructure.</p>
</div>
<div class="paragraph">
<p>External systems do not belong to any of the integration levels defined here. devonfw does not recommend involving real external systems in test automation. This means, they have to be replaced by test <a href="#guide-testing.asciidoc_test-doubles">doubles</a> in automated tests. An exception may be external systems that are fully under control of the own development team.</p>
</div>
<div class="paragraph">
<p>The following chapters describe the four integration levels.</p>
</div>
<div class="sect4">
<h5 id="guide-testing.asciidoc_level-1-module-test">Level 1 Module Test</h5>
<div class="paragraph">
<p>The goal of a <em>isolated module test</em> is to provide fast feedback to the developer. Consequently, isolated module tests must not have any interaction with the client, the database, the file system, the network, etc.</p>
</div>
<div class="paragraph">
<p>An isolated module test is testing a single classes or at least a small set of classes in isolation. If such classes depend on other components or external resources, etc. these shall be replaced with a <a href="#guide-testing.asciidoc_test-doubles">test double</a>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class MyClassTest extends ModuleTest {

  @Test
  public void testMyClass() {

    // given
    MyClass myClass = new MyClass();
    // when
    String value = myClass.doSomething();
    // then
    assertThat(value).isEqualTo("expected value");
  }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>For an advanced example see <a href="https://github.com/devonfw/devon4j/blob/develop/modules/rest/src/test/java/com/devonfw/module/rest/service/impl/RestServiceExceptionFacadeTest.java">here</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="guide-testing.asciidoc_level-2-component-test">Level 2 Component Test</h5>
<div class="paragraph">
<p>A <a href="http://istqbexamcertification.com/what-is-component-testing/"><em>component test</em></a> aims to test components or component parts as a unit.
These tests typically run with a (light-weight) infrastructure such as spring-boot-starter-test and can access resources such as a database (e.g. for DAO tests).
Further, no remote communication is intended here. Access to external systems shall be replaced by a <a href="#guide-testing.asciidoc_test-doubles">test double</a>.</p>
</div>
<div class="paragraph">
<p>With devon4j and spring you can write a component-test as easy as illustrated in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@SpringBootTest(classes = { MySpringBootApp.class }, webEnvironment = WebEnvironment.NONE)
public class UcFindCountryTest extends ComponentTest {
  @Inject
  private UcFindCountry ucFindCountry;

  @Test
  public void testFindCountry() {

    // given
    String countryCode = "de";

    // when
    TestUtil.login("user", MyAccessControlConfig.FIND_COUNTRY);
    CountryEto country = this.ucFindCountry.findCountry(countryCode);

    // then
    assertThat(country).isNotNull();
    assertThat(country.getCountryCode()).isEqualTo(countryCode);
    assertThat(country.getName()).isEqualTo("Germany");
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This test will start the entire spring-context of your app (<code>MySpringBootApp</code>). Within the test spring will inject according spring-beans into all your fields annotated with <code>@Inject</code>. In the test methods you can use these spring-beans and perform your actual tests. This pattern can be used for testing DAOs/Repositories, Use-Cases, or any other spring-bean with its entire configuration including database and transactions.</p>
</div>
<div class="paragraph">
<p>When you are testing use-cases your <a href="guide-access-control.html#configuration-on-java-method-level">authorization</a> will also be in place. Therefore, you have to simulate a logon in advance what is done via the <code>login</code> method in the above example.  The test-infrastructure will automatically do a <code>logout</code> for you after each test method in <code>doTearDown</code>.</p>
</div>
</div>
<div class="sect4">
<h5 id="guide-testing.asciidoc_level-3-subsystem-test">Level 3 Subsystem Test</h5>
<div class="paragraph">
<p>A <em>subsystem test</em> runs against the external interfaces (e.g. HTTP service) of the integrated subsystem. Subsystem tests of the client subsystem are described in the <a href="https://github.com/devonfw/devon4ng/blob/master/documentation/guide-testing">devon4ng testing guide</a>. In devon4j the server (JEE application) is the subsystem under test. The tests act as a client (e.g. service consumer) and the server has to be integrated and started in a container.</p>
</div>
<div class="paragraph">
<p>With devon4j and spring you can write a subsystem-test as easy as illustrated in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@SpringBootTest(classes = { MySpringBootApp.class }, webEnvironment = WebEnvironment.RANDOM_PORT)
public class CountryRestServiceTest extends SubsystemTest {

  @Inject
  private ServiceClientFactory serviceClientFactory;

  @Test
  public void testFindCountry() {

    // given
    String countryCode = "de";

    // when
    CountryRestService service = this.serviceClientFactory.create(CountryRestService.class);
    CountryEto country = service.findCountry(countryCode);

    // then
    assertThat(country).isNotNull();
    assertThat(country.getCountryCode()).isEqualTo(countryCode);
    assertThat(country.getName()).isEqualTo("Germany");
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Even though not obvious on the first look this test will start your entire application as a server on a free random port (so that it works in CI with parallel builds for different branches) and tests the invocation of a (REST) service including (un)marshalling of data (e.g. as JSON) and transport via HTTP (all in the invocation of the <code>findCountry</code> method).</p>
</div>
<div class="paragraph">
<p>Do not confuse a <em>subsystem test</em> with a <a href="http://istqbexamcertification.com/what-is-system-integration-testing/">system integration test</a>. A system integration test validates the interaction of several systems where we do not recommend test automation.</p>
</div>
</div>
<div class="sect4">
<h5 id="guide-testing.asciidoc_level-4-system-test">Level 4 System Test</h5>
<div class="paragraph">
<p>A <a href="http://istqbexamcertification.com/what-is-system-testing/"><em>system test</em></a> has the goal to test the system as a whole against its official interfaces such as its UI or batches. The system itself runs as a separate process in a way close to a regular deployment. Only external systems are simulated by <a href="#guide-testing.asciidoc_test-doubles">test doubles</a>.</p>
</div>
<div class="paragraph">
<p>The devonfw only gives advice for automated system test (TODO see allure testing framework). In nearly every project there must be manual system tests, too. This manual system tests are out of scope here.</p>
</div>
</div>
<div class="sect4">
<h5 id="guide-testing.asciidoc_classifying-integration-levels">Classifying Integration-Levels</h5>
<div class="paragraph">
<p>devon4j defines <a href="https://github.com/devonfw/devon4j/tree/develop/modules/test/src/main/java/com/devonfw/module/test/common/api/category">Category-Interfaces</a> that shall be used as <a href="https://github.com/junit-team/junit/wiki/Categories">JUnit Categories</a>.
Also devon4j provides <a href="https://github.com/devonfw/devon4j/tree/develop/modules/test/src/main/java/com/devonfw/module/test/common/base">abstract base classes</a> that you may extend in your test-cases if you like.</p>
</div>
<div class="paragraph">
<p>devon4j further pre-configures the maven build to only run integration levels 1-2 by default (e.g. for fast feedback in continuous integration). It offers the profiles subsystemtest (1-3) and systemtest (1-4). In your nightly build you can simply add -Psystemtest to run all tests.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="guide-testing.asciidoc_implementation">11.24.5. Implementation</h4>
<div class="paragraph">
<p>This section introduces how to implement tests on the different levels with the given devonfw infrastructure and the proposed frameworks.</p>
</div>
<div class="sect4">
<h5 id="guide-testing.asciidoc_module-test">Module Test</h5>
<div class="paragraph">
<p>In devon4j you can extend the abstract class <a href="https://github.com/devonfw/devon4j/blob/develop/modules/test/src/main/java/com/devonfw/module/test/common/base/ModuleTest.java">ModuleTest</a> to basically get access to assertions. In order to test classes embedded in dependencies  and external services one needs to provide mocks for that. As the <a href="#guide-testing.asciidoc_test-automation-technology-stack">technology stack</a> recommends we use the Mockito framework to offer this functionality. The following example shows how to implement Mockito into a JUnit test.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import static org.mockito.Mockito.when;
import static org.mockito.Mockito.mock;
...

public class StaffmanagementImplTest extends ModuleTest {
  @Rule
  public MockitoRule rule = MockitoJUnit.rule();

  @Test
  public void testFindStaffMember() {
  ...}
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that the test class does not use the <code>@SpringApplicationConfiguration</code> annotation. In a module test one does not use the whole application.
The JUnit rule is the best solution to use in order to get all needed functionality of Mockito. Static imports are a convenient option to enhance readability within Mockito tests.
You can define mocks with the <code>@Mock</code> annotation or the <code>mock(*.class)</code> call. To inject the mocked objects into your class under test you can use the <code>@InjectMocks</code> annotation. This automatically uses the setters of <code>StaffmanagementImpl</code> to inject the defined mocks into the <em>class under test (CUT)</em> when there is a setter available. In this case the <code>beanMapper</code> and the <code>staffMemberDao</code> are injected. Of course it is possible to do this manually if you need more control.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">  @Mock
  private BeanMapper beanMapper;
  @Mock
  private StaffMemberEntity staffMemberEntity;
  @Mock
  private StaffMemberEto staffMemberEto;
  @Mock
  private StaffMemberDao staffMemberDao;
  @InjectMocks
  StaffmanagementImpl staffmanagementImpl = new StaffmanagementImpl();</code></pre>
</div>
</div>
<div class="paragraph">
<p>The mocked objects do not provide any functionality at the time being. To define what happens on a method call on a mocked dependency in the CUT one can use <code>when(<em>condition</em>).thenReturn(<em>result</em>)</code>. In this case we want to test <code>findStaffMember(Long id)</code> in the <a href="https://github.com/oasp/oasp4j/blob/master/samples/core/src/main/java/io/oasp/gastronomy/restaurant/staffmanagement/logic/impl/StaffmanagementImpl.java">StaffmanagementImpl</a>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public StaffMemberEto findStaffMember(Long id) {
  return getBeanMapper().map(getStaffMemberDao().find(id), StaffMemberEto.class);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this simple example one has to stub two calls on the CUT as you can see below. For example the method call of the CUT <code>staffMemberDao.find(id)</code> is stubbed for returning a mock object <code>staffMemberEntity</code> that is also defined as mock.</p>
</div>
</div>
<div class="sect4">
<h5 id="guide-testing.asciidoc_subsystem-test">Subsystem Test</h5>
<div class="paragraph">
<p>devon4j provides a simple test infrastructure to aid with the implementation of subsystem tests. It becomes available by simply subclassing <a href="https://github.com/oasp/oasp4j/blob/master/samples/core/src/test/java/io/oasp/gastronomy/restaurant/general/common/base/AbstractRestServiceTest.java">AbstractRestServiceTest.java</a>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">//given
long id = 1L;
Class&lt;StaffMemberEto&gt; targetClass = StaffMemberEto.class;
when(this.staffMemberDao.find(id)).thenReturn(this.staffMemberEntity);
when(this.beanMapper.map(this.staffMemberEntity, targetClass)).thenReturn(this.staffMemberEto);

//when
StaffMemberEto resultEto = this.staffmanagementImpl.findStaffMember(id);

//then
assertThat(resultEto).isNotNull();
assertThat(resultEto).isEqualTo(this.staffMemberEto);</code></pre>
</div>
</div>
<div class="paragraph">
<p>After the test method call one can verify the expected results. Mockito can check whether a mocked method call was indeed called. This can be done using Mockito <code>verify</code>. Note that it does not generate any value if you check for method calls that are needed to reach the asserted result anyway. Call verification can be useful e.g. when you want to assure that statistics are written out without actually testing them.</p>
</div>
</div>
<div class="sect4">
<h5 id="guide-testing.asciidoc_todo">TODO</h5>
<div class="paragraph">
<p>As an example let us go to the class <a href="https://github.com/oasp/oasp4j/blob/master/samples/core/src/main/java/io/oasp/gastronomy/restaurant/tablemanagement/logic/api/Tablemanagement.java">Tablemanagement</a>. When testing the method <em>deleteTable()</em> there are several scenarios that can happen and thus should be covered by tests.</p>
</div>
<div class="paragraph">
<p>First let us see the valid conditions to delete a table:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>One needs permission to delete a table <a href="https://github.com/oasp/oasp4j/blob/master/samples/core/src/main/java/io/oasp/gastronomy/restaurant/general/common/api/constants/PermissionConstants.java">PermissionConstants.DELETE_TABLE</a></p>
</li>
<li>
<p>The table to delete needs to exist (the table with the given id has to be in the database) and</p>
</li>
<li>
<p>The table to delete is required to be <a href="https://github.com/oasp/oasp4j/blob/master/samples/core/src/main/java/io/oasp/gastronomy/restaurant/tablemanagement/common/api/datatype/TableState.java">TableState.FREE</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Invalid conditions are: No credentials, table does not exist or table is not free.
If you combine one invalid condition with valid conditions this yields the following test cases. Note that not working actions yield exceptions that can be expected in a test method.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The caller of the method does not have the required credentials</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>@Test(expected = AccessDeniedException.class)
public void testDeleteTableWithoutCredentials() {...}</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>The caller has the required credentials but the table to be deleted is occupied</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>@Test(expected = IllegalEntityStateException.class)
public void testDeleteTableWithCredentialsButNotDeletable() {...}</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>The caller has the required credentials but the table to be deleted does not exist</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>@Test(expected = ObjectNotFoundUserException.class)
public void testDeleteTableWithCredentialsNotExisting() {...}</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>The caller has the required credentials and the table to be deleted exists and is free</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>@Test
public void testDeleteTableWithCredentials() {...}</pre>
</div>
</div>
<div class="paragraph">
<p>This type of testing is known as <a href="http://epf.eclipse.org/wikis/xp/xp/guidances/guidelines/equivalence_class_analysis_E178943D.html">equivalence class analysis</a>. Note that this is a general practice and can be applied to every level of tests.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="guide-testing.asciidoc_deployment-pipeline">11.24.6. Deployment Pipeline</h4>
<div class="paragraph">
<p>A deployment pipeline is a semi-automated process that gets software-changes from version control into production. It contains several validation steps, e.g. automated tests of all integration levels.
Because devon4j should fit to different project types - from agile to waterfall - it does not define a standard deployment pipeline. But we recommend to define such a deployment pipeline explicitly for each project and to find the right place in it for each type of test.</p>
</div>
<div class="paragraph">
<p>For that purpose, it is advisable to have fast running test suite that gives as much confidence as possible without needing too much time and too much infrastructure. This test suite should run in an early stage of your deployment pipeline. Maybe the developer should run it even before he/she checked in the code. Usually lower integration levels are more suitable for this test suite than higher integration levels.</p>
</div>
<div class="paragraph">
<p>Note, that the deployment pipeline always should contain manual validation steps, at least manual acceptance testing. There also may be manual validation steps that have to be executed for special changes only, e.g. usability testing. Management and execution processes of those manual validation steps are currently not in the scope of devonfw.</p>
</div>
</div>
<div class="sect3">
<h4 id="guide-testing.asciidoc_test-coverage">11.24.7. Test Coverage</h4>
<div class="paragraph">
<p>We are using tools (SonarQube/Jacoco) to measure the coverage of the tests. Please always keep in mind that the only reliable message of a code coverage of X% is that (100-X)% of the code is entirely untested. It does not say anything about the quality of the tests or the software though it often relates to it.</p>
</div>
</div>
<div class="sect3">
<h4 id="guide-testing.asciidoc_test-configuration">11.24.8. Test Configuration</h4>
<div class="paragraph">
<p>This section covers test configuration in general without focusing on integration levels as in the first chapter.</p>
</div>
<div class="sect4">
<h5 id="guide-testing.asciidoc_configure-test-specific-beans">Configure Test Specific Beans</h5>
<div class="paragraph">
<p>Sometimes it can become handy to provide other or differently configured bean implementations via CDI than those available in production. For example, when creating beans using <code>@Bean</code>-annotated methods they are usually configured within those methods. <a href="https://github.com/oasp/oasp4j/blob/master/samples/core/src/main/java/io/oasp/gastronomy/restaurant/general/service/impl/config/WebSecurityBeansConfig.java">WebSecurityBeansConfig</a> shows an example of such methods.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Configuration
public class WebSecurityBeansConfig {
  //...
  @Bean
  public AccessControlSchemaProvider accessControlSchemaProvider() {
    // actually no additional configuration is shown here
    return new AccessControlSchemaProviderImpl();
  }
  //...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>AccessControlSchemaProvider</code> allows to programmatically access data defined in some XML file, e.g. <code>access-control-schema.xml</code>. Now, one can imagine that it would be helpful if <code>AccessControlSchemaProvider</code> would point to some other file than the default within a test class. That file could provide content that differs from the default.
The question is: how can I change resource path of <code>AccessControlSchemaProviderImpl</code> wihtin a test?</p>
</div>
<div class="paragraph">
<p>One very helpful solution is to use <strong>static inner classes</strong>.
Static inner classes can contain <code>@Bean</code> -annotated methods, and by placing them in the <code>classes</code> parameter in <code>@SpringBootTest(classes = { /* place class here*/ })</code> annotation the beans returned by these methods are placed in the application context during test execution. Combining this feature with inheritance allows to override methods defined in other configuration classes as shown in the following listing where <code>TempWebSecurityConfig</code> extends <code>WebSecurityBeansConfig</code>. This relationship allows to override <code>public AccessControlSchemaProvider accessControlSchemaProvider()</code>. Here we are able to configure the instance of type <code>AccessControlSchemaProviderImpl</code> before returning it (and, of course, we could also have used a completely different implementation of the <code>AccessControlSchemaProvider</code> interface). By overriding the method the implementation of the super class is ignored, hence, only the new implementation is called at runtime. Other methods defined in <code>WebSecurityBeansConfig</code> which are not overridden by the subclass are still dispatched to <code>WebSecurityBeansConfig</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">//... Other testing related annotations
@SpringBootTest(classes = { TempWebSecurityConfig.class })
public class SomeTestClass {

  public static class TempWebSecurityConfig extends WebSecurityBeansConfig {

    @Override
    @Bean
    public AccessControlSchemaProvider accessControlSchemaProvider() {

      ClassPathResource resource = new ClassPathResource(locationPrefix + "access-control-schema3.xml");
      AccessControlSchemaProviderImpl accessControlSchemaProvider = new AccessControlSchemaProviderImpl();
      accessControlSchemaProvider.setAccessControlSchema(resource);
      return accessControlSchemaProvider;
    }
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following <a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#testcontext-ctx-management-javaconfig">chapter of the Spring framework documentation</a> explains issue, but uses a slightly different way to obtain the configuration.</p>
</div>
</div>
<div class="sect4">
<h5 id="guide-testing.asciidoc_test-data">Test Data</h5>
<div class="paragraph">
<p>It is possible to obtain test data in two different ways depending on your test&#8217;s integration level.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="guide-testing.asciidoc_debugging-tests">11.24.9. Debugging Tests</h4>
<div class="paragraph">
<p>The following two sections describe two debugging approaches for tests. Tests are either run from within the IDE or from the command line using Maven.</p>
</div>
<div class="sect4">
<h5 id="guide-testing.asciidoc_debugging-with-the-ide">Debugging with the IDE</h5>
<div class="paragraph">
<p>Debugging with the IDE is as easy as always. Even if you want to execute a <code>SubsystemTest</code> which needs a Spring context and a server infrastructure to run properly, you just set your breakpoints and click on Debug As &#8594; JUnit Test. The test infrastructure will take care of initializing the necessary infrastructure - if everything is configured properly.</p>
</div>
</div>
<div class="sect4">
<h5 id="guide-testing.asciidoc_debugging-with-maven">Debugging with Maven</h5>
<div class="paragraph">
<p>Please refer to the following two links to find a guide for debugging tests when running them from Maven.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="http://maven.apache.org/surefire/maven-surefire-plugin/examples/debugging.html" class="bare">http://maven.apache.org/surefire/maven-surefire-plugin/examples/debugging.html</a></p>
</li>
<li>
<p><a href="https://www.eclipse.org/jetty/documentation/9.3.x/debugging-with-eclipse.html" class="bare">https://www.eclipse.org/jetty/documentation/9.3.x/debugging-with-eclipse.html</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In essence, you first have to start execute a test using the command line. Maven will halt just before the test execution and wait for your IDE to connect to the process. When receiving a connection the test will start and then pause at any breakpoint set in advance.
The first link states that tests are started through the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>mvn -Dmaven.surefire.debug test</code></pre>
</div>
</div>
<div class="paragraph">
<p>Although this is correct, it will run <em>every</em> test class in your project and - which is time consuming and mostly unnecessary - halt before each of these tests.
To counter this problem you can simply execute a single test class through the following command (here we execute the <code>TablemanagementRestServiceTest</code> from the restaurant sample application):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>mvn test -Dmaven.surefire.debug test -Dtest=TablemanagementRestServiceTest</code></pre>
</div>
</div>
<div class="paragraph">
<p>It is important to notice that you first have to execute the Maven command in the according submodule, e.g. to execute the <code>TablemanagementRestServiceTest</code> you have first to navigate to the core module&#8217;s directory.</p>
</div>
<!-- toc disabled -->
</div>
</div>
</div>
<div class="sect2">
<h3 id="guide-transferobject.asciidoc">11.25. Transfer-Objects</h3>
<div class="paragraph">
<p>The technical data model is defined in form of <a href="guide-jpa.html#entity">persistent entities</a>.
However, passing persistent entities via <em>call-by-reference</em> across the entire application will soon cause problems:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Changes to a persistent entity are directly written back to the persistent store when the transaction is committed. When the entity is send across the application also changes tend to take place in multiple places endangering data sovereignty and leading to inconsistency.</p>
</li>
<li>
<p>You want to send and receive data via services across the network and have to define what section of your data is actually transferred. If you have relations in your technical model you quickly end up loading and transferring way too much data.</p>
</li>
<li>
<p>Modifications to your technical data model shall not automatically have impact on your external services causing incompatibilities.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To prevent such problems transfer-objects are used leading to a <em>call-by-value</em> model and decoupling changes to persistent entities.</p>
</div>
<div class="paragraph">
<p>In the following sections the different types of transfer-objects are explained.
You will find all according naming-conventions in the <a href="coding-conventions.html#architecture-mapping">architecture-mapping</a></p>
</div>
<div class="sect4">
<h5 id="guide-transferobject.asciidoc_eto">ETO</h5>
<div class="paragraph">
<p>For each <a href="guide-jpa.html#entity">persistent entity</a> <code>«BusinessObject»Entity</code> we create or generate a corresponding <em>entity transfer object</em> (ETO) named <code>«BusinessObject»Eto</code>. It has the same properties except for relations.</p>
</div>
</div>
<div class="sect4">
<h5 id="guide-transferobject.asciidoc_bo">BO</h5>
<div class="paragraph">
<p>In order to centralize the properties (getters and setters with their javadoc) we create a common interface <code>«BusinessObject»</code> implemented both by the entity and its ETO. This also gives us compile-time safty that
<a href="#guide-beanmapping.asciidoc">bean-mapper</a> can properly map all properties between entity and ETO.</p>
</div>
</div>
<div class="sect4">
<h5 id="guide-transferobject.asciidoc_cto">CTO</h5>
<div class="paragraph">
<p>If we need to pass an entity with its relation(s) we create a corresponding <em>composite transfer object</em> (CTO) named <code>«BusinessObject»«Subset»Cto</code> that only contains other transfer-objects or collections of them. Here <code>«Subset»</code> is empty for the canonical CTO that holds the ETO together with all its relations.
This is what can be gemerated automatically with <a href="https://github.com/devonfw/tools-cobigen">CobiGen</a>.
However, be careful to generate CTOs without thinking and considering design.
If there are no relations at all a CTO is pointless and shall be omitted.
However, if there are multiple relations you typically need  multiple CTOs for the same <code>«BusinessObject»</code> that define different subsets of the related data.
These will typically be designed and implemented by hand.
E.g. you may have <code>CustomerWithAddressCto</code> and <code>CustomerWithContractCto</code>. Most CTOs correspond to a specific <code>«BusinessObject»</code> and therefore contain a <code>«BusinessObject»Eto</code>. Such CTOs should inherit from <code>MasterCto</code>.</p>
</div>
<div class="paragraph">
<p>This pattern with entities, ETOs and CTOs is illustrated by the following UML diagram from our sample application.</p>
</div>
<div id="guide-transferobject.asciidoc_img-transfer-objects" class="imageblock text-center">
<div class="content">
<a class="image" href="images/transfer-objects.png"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/transfer-objects.png" alt="ETOs and CTOs"></a>
</div>
<div class="title">Figure 4. ETOs and CTOs</div>
</div>
</div>
<div class="sect3">
<h4 id="guide-transferobject.asciidoc_to">11.25.4. TO</h4>
<div class="paragraph">
<p>Finally, there are typically transfer-objects for data that is never persistent. For very generic cases
these just carry the suffix <code>To</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="guide-transferobject.asciidoc_searchcriteriato">11.25.5. SearchCriteriaTo</h4>
<div class="literalblock">
<div class="content">
<pre>For searching we create or generate a `«BusinessObject»SearchCriteriaTo` representing a query to find instances of `«BusinessObject»`.</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="guide-transferobject.asciidoc_sto">11.25.6. STO</h4>
<div class="paragraph">
<p>We can potentially create separate <em>service transfer objects</em> (STO) (if possible named <code>«BusinessObject»Sto</code>) to keep the <a href="#guide-service-layer.asciidoc">service</a> API stable and independent of the actual data-model.
However, we usually do not need this and want to keep our architecture simple.
Only create STOs if you need <a href="guide-service-layer.html#versioning">service versioning</a> and support previous APIs or to provide legacy service technologies that require their own isolated data-model.
In such case you also need <a href="#guide-beanmapping.asciidoc">beanmapping</a> between STOs and ETOs what means extra effort and complexity that should be avoided.
In such case you also need <a href="#guide-beanmapping.asciidoc">beanmapping</a> between STOs and ETOs what means extra effort and complexity that should be avoided.</p>
</div>
<!-- toc disabled -->
</div>
</div>
<div class="sect2">
<h3 id="guide-beanmapping.asciidoc">11.26. Bean-Mapping</h3>
<div class="paragraph">
<p>For decoupling you sometimes need to create separate objects (beans) for a different view. E.g. for an external service you will use a <a href="#guide-transferobject.asciidoc">transfer-object</a> instead of the <a href="guide-jpa.html#entity">persistence entity</a> so internal changes to the entity do not implicitly change or break the service.</p>
</div>
<div class="paragraph">
<p>Therefore you have the need to map similar objects what creates a copy. This also has the benefit that modifications to the copy have no side-effect on the original source object. However, to implement such mapping code by hand is very tedious and error-prone (if new properties are added to beans but not to mapping code):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public UserEto mapUser(UserEntity source) {
  UserEto target = new UserEto();
  target.setUsername(source.getUsername());
  target.setEmail(source.getEmail());
  ...
  return target;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Therefore we are using a <code>BeanMapper</code> for this purpose that makes our lives a lot easier.</p>
</div>
<div class="sect3">
<h4 id="guide-beanmapping.asciidoc_bean-mapper-dependency">11.26.1. Bean-Mapper Dependency</h4>
<div class="paragraph">
<p>To get access to the <code>BeanMapper</code> we use this dependency in our POM:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">    &lt;dependency&gt;
      &lt;groupId&gt;com.devonfw.java&lt;/groupId&gt;
      &lt;artifactId&gt;devon4j-beanmapping&lt;/artifactId&gt;
    &lt;/dependency&gt;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="guide-beanmapping.asciidoc_bean-mapper-configuration">11.26.2. Bean-Mapper Configuration</h4>
<div class="paragraph">
<p>The <code>BeanMapper</code> implementation is based on an existing open-source bean mapping framework.
In case of Dozer the mapping is configured <code>src/main/resources/config/app/common/dozer-mapping.xml</code>.</p>
</div>
<div class="paragraph">
<p>See the my-thai-star <a href="https://github.com/devonfw/my-thai-star/blob/develop/java/mtsj/core/src/main/resources/config/app/common/dozer-mapping.xml">dozer-mapping.xml</a> as an example.
Important is that you configure all your custom datatypes as <code>&lt;copy-by-reference&gt;</code> tags and have the mapping from <code>PersistenceEntity</code> (<code>ApplicationPersistenceEntity</code>) to <code>AbstractEto</code> configured properly:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"> &lt;mapping type="one-way"&gt;
    &lt;class-a&gt;com.devonfw.module.basic.common.api.entity.PersistenceEntity&lt;/class-a&gt;
    &lt;class-b&gt;com.devonfw.module.basic.common.api.to.AbstractEto&lt;/class-b&gt;
    &lt;field custom-converter="com.devonfw.module.beanmapping.common.impl.dozer.IdentityConverter"&gt;
      &lt;a&gt;this&lt;/a&gt;
      &lt;b is-accessible="true"&gt;persistentEntity&lt;/b&gt;
    &lt;/field&gt;
&lt;/mapping&gt;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="guide-beanmapping.asciidoc_bean-mapper-usage">11.26.3. Bean-Mapper Usage</h4>
<div class="paragraph">
<p>Then we can get the <code>BeanMapper</code> via <a href="#guide-dependency-injection.asciidoc">dependency-injection</a> what we typically already provide by an abstract base class (e.g. <code>AbstractUc</code>). Now we can solve our problem very easy:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">...
UserEntity resultEntity = ...;
...
return getBeanMapper().map(resultEntity, UserEto.class);</code></pre>
</div>
</div>
<div class="paragraph">
<p>There is also additional support for mapping entire collections.</p>
</div>
<!-- toc disabled -->
</div>
</div>
<div class="sect2">
<h3 id="guide-datatype.asciidoc">11.27. Datatypes</h3>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>A datatype is an object representing a value of a specific type with the following aspects:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>It has a technical or business specific semantic.</p>
</li>
<li>
<p>Its JavaDoc explains the meaning and semantic of the value.</p>
</li>
<li>
<p>It is immutable and therefore stateless (its value assigned at construction time and can not be modified).</p>
</li>
<li>
<p>It is Serializable.</p>
</li>
<li>
<p>It properly implements #equals(Object) and #hashCode() (two different instances with the same value are equal and have the same hash).</p>
</li>
<li>
<p>It shall ensure syntactical validation so it is NOT possible to create an instance with an invalid value.</p>
</li>
<li>
<p>It is responsible for formatting its value to a string representation suitable for sinks such as UI, loggers, etc. Also consider cases like a Datatype representing a password where toString() should return something like "<strong><strong></strong></strong>**" instead of the actual password to prevent security accidents.</p>
</li>
<li>
<p>It is responsible for parsing the value from other representations such as a string (as needed).</p>
</li>
<li>
<p>It shall provide required logical operations on the value to prevent redundancies. Due to the immutable attribute all manipulative operations have to return a new Datatype instance (see e.g. BigDecimal.add(java.math.BigDecimal)).</p>
</li>
<li>
<p>It should implement Comparable if a natural order is defined.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Based on the Datatype a presentation layer can decide how to view and how to edit the value. Therefore a structured data model should make use of custom datatypes in order to be expressive.
Common generic datatypes are String, Boolean, Number and its subclasses, Currency, etc.
Please note that both Date and Calendar are mutable and have very confusing APIs. Therefore, use JSR-310 or jodatime instead.
Even if a datatype is technically nothing but a String or a Number but logically something special it is worth to define it as a dedicated datatype class already for the purpose of having a central javadoc to explain it. On the other side avoid to introduce technical datatypes like String32 for a String with a maximum length of 32 characters as this is not adding value in the sense of a real Datatype.
It is suitable and in most cases also recommended to use the class implementing the datatype as API omitting a dedicated interface.</p>
</div>
</blockquote>
<div class="attribution">
&#8212; mmm project<br>
<cite>datatype javadoc</cite>
</div>
</div>
<div class="paragraph">
<p>See <a href="http://m-m-m.sourceforge.net/apidocs/net/sf/mmm/util/lang/api/Datatype.html">mmm datatype javadoc</a>.</p>
</div>
<div class="sect3">
<h4 id="guide-datatype.asciidoc_datatype-packaging">11.27.1. Datatype Packaging</h4>
<div class="paragraph">
<p>For the devonfw we use a common <a href="coding-conventions.html#packages">packaging schema</a>.
The specifics for datatypes are as following:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>Segment</strong></th>
<th class="tableblock halign-left valign-top"><strong>Value</strong></th>
<th class="tableblock halign-left valign-top"><strong>Explanation</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt;component&gt;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">*</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Here we use the (business) component defining the datatype or general for generic datatypes.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt;layer&gt;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">common</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Datatypes are used across all layers and are not assigned to a dedicated layer.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt;scope&gt;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">api</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Datatypes are always used directly as API even tough they may contain (simple) implementation logic. Most datatypes are simple wrappers for generic Java types (e.g. String) but make these explicit and might add some validation.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="guide-datatype.asciidoc_technical-concerns">11.27.2. Technical Concerns</h4>
<div class="paragraph">
<p>Many technologies like Dozer and QueryDSL&#8217;s (alias API) are heavily based on reflection. For them to work properly with custom datatypes, the frameworks must be able to instantiate custom datatypes with no-argument constructors. It is therefore recommended to implement a no-argument constructor for each datatype of at least protected visibility.</p>
</div>
</div>
<div class="sect3">
<h4 id="guide-datatype.asciidoc_datatypes-in-entities">11.27.3. Datatypes in Entities</h4>
<div class="paragraph">
<p>The usage of custom datatypes in entities is explained in the <a href="guide-jpa.html#entities-and-datatypes">persistence layer guide</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="guide-datatype.asciidoc_datatypes-in-transfer-objects">11.27.4. Datatypes in Transfer-Objects</h4>
<div class="sect4">
<h5 id="guide-datatype.asciidoc_xml">XML</h5>
<div class="paragraph">
<p>For mapping datatypes with JAXB see <a href="#guide-xml.asciidoc">XML guide</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="guide-datatype.asciidoc_json">JSON</h5>
<div class="paragraph">
<p>For mapping datatypes from and to JSON see <a href="guide-json.html#json-custom-mapping">JSON custom mapping</a>.</p>
</div>
<!-- toc disabled -->
</div>
</div>
</div>
<div class="sect2">
<h3 id="guide-accessibility.asciidoc">11.28. Accessibility</h3>
<div class="paragraph">
<p>TODO</p>
</div>
<div class="paragraph">
<p><a href="http://www.w3.org/TR/WCAG20/" class="bare">http://www.w3.org/TR/WCAG20/</a></p>
</div>
<div class="paragraph">
<p><a href="http://www.w3.org/WAI/intro/aria" class="bare">http://www.w3.org/WAI/intro/aria</a></p>
</div>
<div class="paragraph">
<p><a href="http://www.einfach-fuer-alle.de/artikel/bitv/" class="bare">http://www.einfach-fuer-alle.de/artikel/bitv/</a></p>
</div>
<div class="paragraph">
<p><a href="http://www.banu.bund.de" class="bare">http://www.banu.bund.de</a></p>
</div>
<div class="paragraph">
<p><a href="http://www.de.capgemini.com/public-sector/igov" class="bare">http://www.de.capgemini.com/public-sector/igov</a></p>
</div>
<!-- toc disabled -->
</div>
<div class="sect2">
<h3 id="guide-caching.asciidoc">11.29. Caching</h3>
<div class="paragraph">
<p>Caching is a technical approach to improve performance. While it may appear easy on the first sight it is an advanced topic. In general, try to use caching only when required for performance reasons. If you come to the point that you need caching first think about:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>What to cache?<br>
Be sure about what you want to cache. Is it static data? How often will it change? What will happen if the data changes but due to caching you might receive "old" values? Can this be tolerated? For how long? This is not a technical question but a business requirement.</p>
</li>
<li>
<p>Where to cache?<br>
Will you cache data on client or server? Where exactly?</p>
</li>
<li>
<p>How to cache?<br>
Is a local cache sufficient or do you need a shared cache?</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="guide-caching.asciidoc_local-cache">11.29.1. Local Cache</h4>

</div>
<div class="sect3">
<h4 id="guide-caching.asciidoc_shared-cache">11.29.2. Shared Cache</h4>
<div class="sect4">
<h5 id="guide-caching.asciidoc_distributed-cache">Distributed Cache</h5>

</div>
</div>
<div class="sect3">
<h4 id="guide-caching.asciidoc_products">11.29.3. Products</h4>
<div class="ulist">
<ul>
<li>
<p><a href="http://ehcache.org/" class="bare">http://ehcache.org/</a></p>
</li>
<li>
<p><a href="http://hazelcast.org/" class="bare">http://hazelcast.org/</a></p>
</li>
<li>
<p><a href="http://terracotta.org/" class="bare">http://terracotta.org/</a></p>
</li>
<li>
<p><a href="http://memcached.org/" class="bare">http://memcached.org/</a></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="guide-caching.asciidoc_caching-of-web-resources">11.29.4. Caching of Web-Resources</h4>
<div class="ulist">
<ul>
<li>
<p><a href="http://www.mobify.com/blog/beginners-guide-to-http-cache-headers/" class="bare">http://www.mobify.com/blog/beginners-guide-to-http-cache-headers/</a></p>
</li>
<li>
<p><a href="http://en.wikipedia.org/wiki/Web_cache#Cache_control" class="bare">http://en.wikipedia.org/wiki/Web_cache#Cache_control</a></p>
</li>
<li>
<p><a href="http://en.wikipedia.org/wiki/List_of_HTTP_header_fields#Avoiding_caching" class="bare">http://en.wikipedia.org/wiki/List_of_HTTP_header_fields#Avoiding_caching</a></p>
</li>
</ul>
</div>
<!-- toc disabled -->
</div>
</div>
<div class="sect2">
<h3 id="guide-cors-support.asciidoc">11.30. CORS support</h3>
<div class="paragraph">
<p>When you are developing Javascript client and server application separately, you have to deal with cross domain issues. We have to request from a origin domain distinct to target domain and browser does not allow this.</p>
</div>
<div class="paragraph">
<p>So , we need to prepare server side to accept request from other domains. We need to cover the following points:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Accept request from other domains.</p>
</li>
<li>
<p>Accept devonfw used headers like <code>X-CSRF-TOKEN</code> or <code>correlationId.</code></p>
</li>
<li>
<p>Be prepared to receive secured request (cookies).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>It is important to note that if you are using security in your request (sending cookies) you have to set  <code>withCredentials</code> flag to <code>true</code> in your client side request and deal with special IE8 characteristics.</p>
</div>
<div class="sect3">
<h4 id="guide-cors-support.asciidoc_configuring-cors-support">11.30.1. Configuring CORS support</h4>
<div class="paragraph">
<p>On the server side we have defined a new filter in Spring security chain filters to support CORS and we have configured devonfw security chain filter to use it.</p>
</div>
<div class="paragraph">
<p>You only have to change <code>CORSDisabled</code> property value in <code>application-default.properties</code> properties file.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>#CORS support
security.cors.enabled=false</code></pre>
</div>
</div>
<!-- toc disabled -->
</div>
</div>
<div class="sect2">
<h3 id="guide-blob-support.asciidoc">11.31. BLOB support</h3>
<div class="sect3">
<h4 id="guide-blob-support.asciidoc_introduction">11.31.1. Introduction</h4>
<div class="paragraph">
<p>BLOB stands for <strong>B</strong>inary <strong>L</strong>arge <strong>Ob</strong>ject. A BLOB may be an image, an office document, ZIP archive or any other multimedia object. devon4j supports BLOB via its BinaryObject data type. The devonfw Maven archetype generates the following Java files for dealing with BLOBs:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>general.common.api.BinaryObject</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Interface for a BinaryObject</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>general.dataaccess.api.BinaryObjectEntity</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Instance of BinaryObject entity, contains the actual BLOB</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>general.dataaccess.api.dao.BinaryObjectDao.java</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DAO for BinaryObject entity</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>general.dataaccess.base.dao.BinaryObjectDaoImpl</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Implemenentation of the BinaryObjectDao</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>general.logic.api.to.BinaryObjectEto</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ETO for BinaryObject</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>general.logic.base.UcManageBinaryObject</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Use case for managing BinaryObject. This use case contains methods for finding, getting, deleting and saving a BLOB.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>general.logic.impl.UCManageBinaryObjectImpl</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Implemenentation of the UcManageBinaryObject</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="guide-blob-support.asciidoc_implementing-blob-support-an-example">11.31.2. Implementing BLOB support: an example</h4>
<div class="paragraph">
<p>In the sample application the business component Offermanagement uses BLOBs for product pictures.
Feel free to use the following approach as starting point for BLOB support in your application.</p>
</div>
<div class="sect4">
<h5 id="guide-blob-support.asciidoc_logic-layer">Logic Layer</h5>
<div class="paragraph">
<p>Use the methods declared in <code>general.logic.base.UcManageBinaryObject</code> in the implementation of your business component.
Let&#8217;s take a look at an example from the sample application.</p>
</div>
<div class="paragraph">
<p>The method</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">OffermanagementImpl.updateProductPicture(Long productId, Blob blob, BinaryObjectEto binaryObjectEto)</code></pre>
</div>
</div>
<div class="paragraph">
<p>saves a new picture for a given product.</p>
</div>
<div class="paragraph">
<p>This is done by calling an appropriate method, declared in the BinaryObject use case.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Override
@RolesAllowed(PermissionConstants.SAVE_PRODUCT_PICTURE)
public void updateProductPicture(Long productId, Blob blob, BinaryObjectEto binaryObjectEto) {

    ...
      binaryObjectEto = getUcManageBinaryObject().saveBinaryObject(blob, binaryObjectEto);
    ...
 }</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="guide-blob-support.asciidoc_service-layer">Service Layer</h5>
<div class="paragraph">
<p>Following the devonfw conventions, you must implement a REST service for each business component. There you define, how BLOBs are uploaded/downloaded. According to that, the REST service for the business component Offermanagement is implemented in a class named OffermanagementRestServiceImpl.</p>
</div>
<div class="paragraph">
<p>The coding examples below are taken from the afore mentioned class.</p>
</div>
<div class="paragraph">
<p>The sample application uses the content-type "multipart/mixed" to transfer pictures plus additional header data.</p>
</div>
<div class="paragraph">
<p><strong>Upload</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Consumes("multipart/mixed")
@POST
@Path("/product/{id}/picture")
  public void updateProductPicture(@PathParam("id") long productId,
      @Multipart(value = "binaryObjectEto", type = MediaType.APPLICATION_JSON) BinaryObjectEto binaryObjectEto,
      @Multipart(value = "blob", type = MediaType.APPLICATION_OCTET_STREAM) InputStream picture)
      throws SerialException, SQLException, IOException {

    Blob blob = new SerialBlob(IOUtils.readBytesFromStream(picture));
    this.offerManagement.updateProductPicture(productId, blob, binaryObjectEto);

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>A new Blob object is being created by reading the data (<code>IOUtils.readBytesFromStream(picture)</code>).</p>
</div>
<div class="paragraph">
<p><strong>Download</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Produces("multipart/mixed")
@GET
@Path("/product/{id}/picture")
public MultipartBody getProductPicture(@PathParam("id") long productId) throws SQLException, IOException {

    Blob blob = this.offerManagement.findProductPictureBlob(productId);
    byte[] data = IOUtils.readBytesFromStream(blob.getBinaryStream());

    List&lt;Attachment&gt; atts = new LinkedList&lt;&gt;();
    atts.add(new Attachment("binaryObjectEto", MediaType.APPLICATION_JSON, this.offerManagement
        .findProductPicture(productId)));
    atts.add(new Attachment("blob", MediaType.APPLICATION_OCTET_STREAM, new ByteArrayInputStream(data)));
    return new MultipartBody(atts, true);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>As you may have noticed, the data is loaded into the heap before it is added as an Attachement to the MultiPart body.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Caution!</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Using a byte array will cause problems, when dealing with large BLOBs.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Why is the sample application using a byte array then?</strong></p>
</div>
<div class="paragraph">
<p>As of now, there is no universal solid way of streaming a BLOB directly from a database to the client without reading the BLOB’s content to memory, when streaming over a RESTful service based on JDBC and JAX RS.
Following this approach means:  whenever a file is uploaded or downloaded as BLOB it is loaded completely to memory before it is written to the database.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="guide-blob-support.asciidoc_further-reading">11.31.3. Further Reading</h4>
<div class="ulist">
<ul>
<li>
<p><a href="http://www.w3.org/Protocols/rfc1341/7_2_Multipart.html">The multipart content type</a></p>
</li>
<li>
<p><a href="http://cxf.apache.org/docs/jax-rs-multiparts.html">JAX-RS : Support for Multiparts</a></p>
</li>
<li>
<p><a href="guide-logic-layer.html#component-implementation">Component Implementation</a></p>
</li>
<li>
<p><a href="guide-jpa.html#blob">BLOBs and the Data Access Layer</a></p>
</li>
<li>
<p><a href="https://www.owasp.org/index.php/Unrestricted_File_Upload">Security Vulnerability Unrestricted File Upload</a></p>
</li>
</ul>
</div>
<!-- toc disabled -->
</div>
</div>
<div class="sect2">
<h3 id="guide-jdk.asciidoc">11.32. Java Development Kit</h3>
<div class="paragraph">
<p>The <a href="https://en.wikipedia.org/wiki/Java_Development_Kit">Java Development Kit</a> is an implementation of the Java platform. It provides the <a href="https://en.wikipedia.org/wiki/Java_virtual_machine">Java Vitrual Machine</a> (JVM) and the Java Runtime Environment (JRE).</p>
</div>
<div class="sect3">
<h4 id="guide-jdk.asciidoc_editions">11.32.1. Editions</h4>
<div class="paragraph">
<p>The JDK exists in different editions:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://openjdk.java.net/">OpenJDK</a> is a free and open-source edition of the JDK.</p>
</li>
<li>
<p><a href="https://www.oracle.com/technetwork/java/javase/overview/index.html">OracleJDK</a> is a commercial edition of the JDK.</p>
</li>
<li>
<p><a href="https://en.wikipedia.org/wiki/List_of_Java_virtual_machines">Various alternative JDK editions</a> either commercial (e.g. IBM&#8217;s JVM) or open-source.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>As Java is evolving and also complex maintaining a JVM requires a lot of energy.
Therefore many alternative JDK editions are unable to cope with this and support latest Java versions and according compatibility.
Unfortunately OpenJDK only maintains a specific version of Java for a relative short period of time before moving to the next major version.
In the end, this technically means that OpenJDK is continuous beta and can not be used in production for reasonable software projects.
As OracleJDK changed its licensing model and can not be used for commercial usage even during development, things can get tricky.
You may want to use OpenJDK for development and OracleJDK only in production.
However, e.g. OpenJDK 11 never released a version that is stable enough for reasonable development (e.g. javadoc tool is <a href="https://bugs.openjdk.java.net/browse/JDK-8212233">broken</a> and fixes are not available of OpenJDK 11 - fixed in 11.0.3 what is only available as OracleJDK 11 or you need to go to OpenJDK 12+, what has other bugs) so in the end there is no working release of OpenJDK 11.
This more or less forces you to use OracleJDK what requires you to buy a subscription so you can use it for commercial development.
However, there is <a href="https://github.com/AdoptOpenJDK">AdoptOpenJDK</a> that provides forked releases of OpenJDK with bugfixes what might be an option.
Anyhow, as you want to have your development environment close to production, the productively used JDK (most likely OracleJDK) should be preferred also for development.</p>
</div>
</div>
<div class="sect3">
<h4 id="guide-jdk.asciidoc_upgrading">11.32.2. Upgrading</h4>
<div class="paragraph">
<p>Until Java 8 compatibility was one of the key aspects for Java version updates (after the mess on the Swing updates with Java2 many years ago).
However, Java 9 introduced a lot of breaking changes.
This documentation wants to share the experience we collected in devonfw when upgrading from Java 8 to newer versions.
First of all we separate runtime changes that you need if you want to build your software with JDK 8 but such that it can also run on newer versions (e.g. JRE 11)
from changes required to also build your software with more recent JDKs (e.g. JDK 11 or 12).</p>
</div>
<div class="sect4">
<h5 id="guide-jdk.asciidoc_runtime-changes">Runtime Changes</h5>
<div class="paragraph">
<p>This section describes required changes to your software in order to make it run also with versions newer than Java 8.</p>
</div>
<div class="sect5">
<h6 id="guide-jdk.asciidoc_classes-removed-from-jdk">Classes removed from JDK</h6>
<div class="paragraph">
<p>The first thing that most users hit when running their software with newer Java versions is a <code>ClassNotFoundException</code> like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>Caused by: java.lang.ClassNotFoundException: javax.xml.bind.JAXBException</code></pre>
</div>
</div>
<div class="paragraph">
<p>As Java 9 introduced a module system with <a href="https://www.baeldung.com/project-jigsaw-java-modularity">Jigsaw</a>, the JDK that has been a monolithic mess is now a well-defined set of structured modules.
Some of the classes that used to come with the JDK moved to modules that where not available by default in Java 9 and have even been removed entirely in later versions of Java.
Therefore you should simply treat such code just like any other 3rd pary component that you can add as a (maven) dependency.
The following table gives you the required hints to make your software work even with such classes / modules removed from the JDK (please note that the specified version is just a suggestion that worked, feel free to pick a more recent or more appropriate version):</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 14. Dependencies for classes removed from Java 8 since 9+</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>Class</strong></th>
<th class="tableblock halign-left valign-top"><strong>GroupId</strong></th>
<th class="tableblock halign-left valign-top"><strong>ArtifactId</strong></th>
<th class="tableblock halign-left valign-top"><strong>Version</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>javax.xml.bind.*</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>javax.xml.bind</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jaxb-api</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>2.3.1</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>com.sun.xml.bind.*</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.glassfish.jaxb</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jaxb-runtime</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>2.3.1</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>java.activation.*</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>javax.activation</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>javax.activation-api</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>1.2.0</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>java.transaction.*</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>javax.transaction</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>javax.transaction-api</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>1.2</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>java.xml.ws.*</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>javax.xml.ws</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jaxws-api</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>2.3.1</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>javax.jws.*</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>javax.jws</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>javax.jws-api</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>1.1</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>javax.annotation.*</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>javax.annotation</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>javax.annotation-api</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>1.3.2</code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect5">
<h6 id="guide-jdk.asciidoc_3rd-party-updates">3rd Party Updates</h6>
<div class="paragraph">
<p>Further, internal and inofficial APIs (e.g. <code>sun.misc.Unsafe</code>) have been removed.
These are typically not used by your software directly but by low-level 3rd party libraries like <code>asm</code> that need to be updated.
Also simple things like the Java version have changed (from <code>1.8.x</code> to <code>9.x</code>, <code>10.x</code>, <code>11.x</code>, <code>12.x</code>, etc.).
Some 3rd party libraries were parsing the Java version in a very naive way making them unable to be used with Java 9+:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>Caused by: java.lang.NullPointerException
   at org.apache.maven.surefire.shade.org.apache.commons.lang3.SystemUtils.isJavaVersionAtLeast (SystemUtils.java:1626)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Therefore the following table gives an overview of common 3rd party libraries that have been affected by such breaking changes and need to be updated to at least the specified version:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 15. Minimum recommended versions of common 3rd party for Java 9+</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>GroupId</strong></th>
<th class="tableblock halign-left valign-top"><strong>ArtifactId</strong></th>
<th class="tableblock halign-left valign-top"><strong>Version</strong></th>
<th class="tableblock halign-left valign-top"><strong>Issue</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.apache.commons</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>commons-lang3</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>3.7</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://issues.apache.org/jira/browse/LANG-1365">LANG-1365</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>cglib</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>cglib</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>3.2.9</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://github.com/cglib/cglib/issues/102">102</a>, <a href="https://github.com/cglib/cglib/issues/93">93</a>, <a href="https://github.com/cglib/cglib/issues/133">133</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.ow2.asm</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>asm</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>7.1</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://github.com/eclipse/jetty.project/issues/2941">2941</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.javassist</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>javassist</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>3.25.0-GA</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://github.com/jboss-javassist/javassist/issues/194">194</a>, <a href="https://github.com/jboss-javassist/javassist/issues/228">228</a>, <a href="https://github.com/jboss-javassist/javassist/issues/246">246</a>, <a href="https://github.com/jboss-javassist/javassist/issues/171">171</a></p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect4">
<h5 id="guide-jdk.asciidoc_buildtime-changes">Buildtime Changes</h5>
<div class="paragraph">
<p>If you also want to change your build to work with a recent JDK you also need to ensure that test frameworks and maven plugins properly support this.</p>
</div>
<div class="sect5">
<h6 id="guide-jdk.asciidoc_findbugs">Findbugs</h6>
<div class="paragraph">
<p>Findbugs does not work with Java 9+ and is actually a dead project.
The new findbugs is <a href="https://spotbugs.github.io/">SpotBugs</a>.
For maven the new solution is <a href="https://spotbugs.github.io/spotbugs-maven-plugin/">spotbugs-maven-plugin</a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>&lt;plugin&gt;
  &lt;groupId&gt;com.github.spotbugs&lt;/groupId&gt;
  &lt;artifactId&gt;spotbugs-maven-plugin&lt;/artifactId&gt;
  &lt;version&gt;3.1.11&lt;/version&gt;
&lt;/plugin&gt;</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="guide-jdk.asciidoc_test-frameworks">Test Frameworks</h6>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 16. Minimum recommended versions of common 3rd party test frameworks for Java 9+</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>GroupId</strong></th>
<th class="tableblock halign-left valign-top"><strong>ArtifactId</strong></th>
<th class="tableblock halign-left valign-top"><strong>Version</strong></th>
<th class="tableblock halign-left valign-top"><strong>Issue</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.mockito</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>mockito-core</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>2.23.4</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://github.com/mockito/mockito/issues/1419">1419</a>, <a href="https://github.com/mockito/mockito/issues/1696">1696</a>, <a href="https://github.com/mockito/mockito/issues/1607">1607</a>, <a href="https://github.com/mockito/mockito/issues/1594">1594</a>, <a href="https://github.com/mockito/mockito/issues/1577">1577</a>, <a href="https://github.com/mockito/mockito/issues/1482">1482</a></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect5">
<h6 id="guide-jdk.asciidoc_maven-plugins">Maven Plugins</h6>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 17. Minimum recommended versions of common maven plugins for Java 9+</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>GroupId</strong></th>
<th class="tableblock halign-left valign-top"><strong>ArtifactId</strong></th>
<th class="tableblock halign-left valign-top"><strong>(min.) Version</strong></th>
<th class="tableblock halign-left valign-top"><strong>Issue</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.apache.maven.plugins</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>maven-compiler-plugin</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>3.8.1</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.apache.maven.plugins</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>maven-surefire-plugin</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>2.22.2</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://issues.apache.org/jira/browse/SUREFIRE-1439">SUREFIRE-1439</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.apache.maven.plugins</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>maven-surefire-report-plugin</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>2.22.2</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://issues.apache.org/jira/browse/SUREFIRE-1439">SUREFIRE-1439</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.apache.maven.plugins</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>maven-archetype-plugin</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>3.1.0</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.apache.maven.plugins</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>maven-javadoc-plugin</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>3.1.0</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.jacoco</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jacoco-maven-plugin</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0.8.3</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://github.com/jacoco/jacoco/issues/663">663</a></p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="guide-jdk.asciidoc_sources-and-links">11.32.3. Sources and Links</h4>
<div class="paragraph">
<p>We want to give credits and say thanks to the following artircles that have been there before and helped us on our way:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://blog.codefx.org/java/java-9-migration-guide/">Java 9 Migration Guide: The Seven Most Common Challenges</a></p>
</li>
<li>
<p><a href="https://medium.com/criciumadev/its-time-migrating-to-java-11-5eb3868354f9">It’s time! Migrating to Java 11</a></p>
</li>
<li>
<p><a href="https://winterbe.com/posts/2018/08/29/migrate-maven-projects-to-java-11-jigsaw/">Migrate Maven Projects to Java 11</a></p>
</li>
<li>
<p><a href="https://www.jesperdj.com/2018/09/30/jaxb-on-java-9-10-11-and-beyond/">JAXB on Java 9, 10, 11 and beyond</a></p>
</li>
<li>
<p><a href="https://stackoverflow.com/questions/26413431/which-artifacts-should-i-use-for-jaxb-ri-in-my-maven-project">JAXB Artifacts</a></p>
</li>
</ul>
</div>
<!-- toc disabled -->
</div>
</div>
<div class="sect2">
<h3 id="guide-apm.asciidoc">11.33. Application Performance Management</h3>
<div class="paragraph">
<p>This guide gives hints how to manage, monitor and analyse performance of Java applications.</p>
</div>
<div class="sect3">
<h4 id="guide-apm.asciidoc_temporary-analysis">11.33.1. Temporary Analysis</h4>
<div class="paragraph">
<p>If you are facing performance issues and want to do a punctual analysis we recommend you to use <a href="https://glowroot.org/">glowroot</a>. It is ideal in cases where monitoring in your local development environment is suitable. However, it is also possible to use it in your test environment. It is entirely free and open-source. Still it is very powerful and helps to trace down bottlenecks. To get a first impression of the tool take a look at the <a href="https://demo.glowroot.org">demo</a>.</p>
</div>
<div class="sect4">
<h5 id="guide-apm.asciidoc_jeewtp">JEE/WTP</h5>
<div class="paragraph">
<p>In case you are forced to use an <a href="#guide-jee.asciidoc">JEE application server</a> and want to do a temporary analysis you can double click your server instance from the servers view in Eclipse and click on the link <code>Open launch configuration</code> in order to add the <code>-javaagent</code> JVM option.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="guide-apm.asciidoc_regular-analysis">11.33.2. Regular Analysis</h4>
<div class="paragraph">
<p>In case you want to manage application performance regularly we recommend to use <a href="https://github.com/javamelody/javamelody#javamelody">JavaMelody</a> that can be integrated into your application. More information on javamelody is available on the <a href="https://github.com/javamelody/javamelody/wiki">JavaMelody Wiki</a></p>
</div>
</div>
<div class="sect3">
<h4 id="guide-apm.asciidoc_alternatives">11.33.3. Alternatives</h4>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/naver/pinpoint">PinPoint</a></p>
</li>
<li>
<p><a href="https://openapm.io/">OpenAPM</a></p>
</li>
<li>
<p><a href="https://www.appdynamics.com/java/">AppDynamics</a></p>
</li>
<li>
<p><a href="https://www.zabbix.com/features">Zabbix</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="master-devon4j.asciidoc_devonfw-development">12. devonfw Development</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="devonfw-ide-setup.asciidoc">12.1. IDE Setup</h3>
<div class="paragraph">
<p>This Tutorial explains how to setup the development environment to work on and contribute to devonfw4j with your Windows computer.</p>
</div>
<div class="paragraph">
<p>We are using a pre-configured <a href="https://github.com/devonfw/devon-ide">devon-ide</a> for development. To get started follow these steps:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Get a Git client. For Windows use:</p>
<div class="ulist">
<ul>
<li>
<p><a href="https://gitforwindows.org/" class="bare">https://gitforwindows.org/</a></p>
<div class="paragraph">
<p>Important: install with option Use Git from the Windows Command Prompts but without Windows Explorer integration.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="https://raw.githubusercontent.com/schowalter0112/Prints-OASP4j-Tutorial/master/Git%20hub%20client/Use%20Git%20from%20the%20Windows%20Command%20Prompts.jpg" alt="command">
</div>
</div>
</li>
<li>
<p>Download TortoiseGit from <a href="https://tortoisegit.org/" class="bare">https://tortoisegit.org/</a></p>
</li>
</ul>
</div>
</li>
<li>
<p>Download the IDE</p>
<div class="ulist">
<ul>
<li>
<p>If you are a member of Capgemini: download <a href="https://coconet.capgemini.com/sf/go/projects.apps2_devon/frs.oasp4j_ide">devonfw ide package</a> or the higher integrated <a href="https://coconet.capgemini.com/sf/go/projects.apps2_devon/frs.devon_distribution">devonfw distribution</a> (for devonfw please find the setup guide within the devon-dist).</p>
</li>
<li>
<p>If you are not member of Capgemini: We cannot distribute the package. Please consult <a href="https://github.com/devonfw/devon-ide">devon-ide</a> to setup and configure the IDE manually. If you need help, please get in touch.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Choose a project location for your project (e.g. <code>C:\projects\devonfw</code>, referred to with <code>$projectLoc</code> in this setup guides following steps). Avoid long paths and white spaces to prevent trouble. Extract the downloaded ZIP files via <code>Extract Here</code> (e.g. using <a href="http://www.7-zip.org/">7-Zip</a>). Do not use the Windows native ZIP tool to extract as this is not working properly on long paths and filenames.</p>
</li>
<li>
<p>Run the script <code>update-all-workspaces.bat</code> in <code>$projectLoc</code>.</p>
<div class="imageblock">
<div class="content">
<img src="https://raw.githubusercontent.com/schowalter0112/Prints-OASP4j-Tutorial/master/Git%20hub%20client/update.jpg" alt="update">
</div>
</div>
<div class="paragraph">
<p>Hint: You can use update-all-workspaces.bat whenever you created a new folder in <code>workspaces</code> to separate different workspaces. This update will create new Eclipse start batches allowing to run a number of Eclipse instances using different workspaces in parallel.</p>
</div>
<div class="paragraph">
<p>You should end up having a structure like this in <code>$projectLoc</code></p>
</div>
<div class="imageblock">
<div class="content">
<img src="https://raw.githubusercontent.com/schowalter0112/Prints-OASP4j-Tutorial/master/Git%20hub%20client/folder%20structure.jpg" alt="folder structure">
</div>
</div>
</li>
<li>
<p>Open <code>console.bat</code> and check out the git repositories you need to work on into <code>workspaces\main</code>. with the following commands:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">cd workspaces/main
git clone --recursive https://github.com/devonfw/my-thai-star.git</code></pre>
</div>
</div>
<div class="paragraph">
<p>Do another check whether there are files in folder <code>workspaces\main\my-thai-star\</code>!</p>
</div>
</li>
<li>
<p>Run the script <code>eclipse-main.bat</code> to start the Eclipse IDE.</p>
</li>
<li>
<p><strong>In Eclipse</strong> select <code>File &gt; Import &gt; Maven &gt; Existing Maven Projects</code> and then choose the cloned projects from your workspace by clicking the <code>Browse</code> button and select the folder structure (<code>workspaces\main\my-thai-star\java\MTSJ</code>).</p>
</li>
<li>
<p><strong>Execute</strong> the application by starting the ´SpringBootApp´. Select the class and click the right mouse button. In the context menu select the entry <code>Run as &#8658; Java Application</code> (or <code>Debug as &#8230;&#8203;</code>). The application starts up and creates log entries in the Eclipse Console Tab.</p>
<div class="imageblock text-center">
<div class="content">
<img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/eclipse-run-as.png" alt="eclipse run as" width="813">
</div>
</div>
<div class="paragraph">
<p>Once started, the backend part of the application runs on <a href="http://localhost:8081/mythaistar" class="bare">http://localhost:8081/mythaistar</a>. This is protected by Spring Security, so an additional frontend needs to be started, that will be able to get the needed access tokens.</p>
</div>
</li>
<li>
<p>Now switch within command line to <code>workspaces\main\my-thai-star\angular</code> and run <code>yarn install</code> followed by <code>yarn start</code>. Finally
login with <code>waiter/waiter</code> at <code><a href="http://localhost:4200/restaurant/" class="bare">http://localhost:4200/restaurant/</a></code>.</p>
</li>
</ol>
</div>
<!-- toc disabled -->
</div>
<div class="sect2">
<h3 id="devonfw-issue-work.asciidoc">12.2. Issue creation and resolution</h3>
<div class="sect3">
<h4 id="devonfw-issue-work.asciidoc_issue-creation">12.2.1. Issue creation</h4>
<div class="paragraph">
<p>You can create an issue <a href="https://github.com/devonfw/devon4j/issues/new">here</a>. Please consider the following points:</p>
</div>
<div class="ulist square">
<ul class="square">
<li>
<p>If your issue is related to a specific building block (like e.g. devon4ng), open an issue on that specific issue tracker. If you&#8217;re unsure which building block is causing your problem open an issue on this repository.</p>
</li>
<li>
<p>Put a label on the issue to mark whether you suggest an enhancement, report an error or something else.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>When reporting errors:</p>
</div>
<div class="ulist square">
<ul class="square">
<li>
<p>Include the version of devon4j you are using.</p>
</li>
<li>
<p>Include screenshots, stack traces.</p>
</li>
<li>
<p>Include the behavior you expected.</p>
</li>
<li>
<p>using a debugger you might be able to find the cause of the problem and you could be the one to contribute a bug-fix.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="devonfw-issue-work.asciidoc_preparation-for-issue-resolution">12.2.2. Preparation for issue resolution</h4>
<div class="paragraph">
<p>Before you get started working on an issue, check out the following points:</p>
</div>
<div class="ulist square">
<ul class="square">
<li>
<p>try to complete all other issues you are working on before. Only postpone issues where you are stuck and consider giving them back in the queue (backlog).</p>
</li>
<li>
<p>check that no-one else is already assigned or working on the issue</p>
</li>
<li>
<p>read through the issue and check that you understand the task completely. Collect any remaining questions and clarify them with the one responsible for the topic.</p>
</li>
<li>
<p>ensure that you are aware on which branch the issue shall be fixed and start your work in the corresponding workspace.</p>
</li>
<li>
<p>if you are using git perform your changes on a feature branch.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="devonfw-issue-work.asciidoc_definition-of-done">12.2.3. Definition of Done</h4>
<div class="ulist square">
<ul class="square">
<li>
<p>actual issue is implemented (bug fixed, new feature implemented, etc.)</p>
</li>
<li>
<p>new situation is covered by tests (according to test strategy of the project e.g. for bugs create a unit test first proving the bug and running red, then fix the bug and check that the test gets green, for new essential features create new tests, for GUI features do manual testing)</p>
</li>
<li>
<p>check the code-style with sonar-qube in eclipse. If there are anomalies in the new or modified code, please rework.</p>
</li>
<li>
<p>check out the latest code from the branch you are working on (svn update, git pull after git commit)</p>
</li>
<li>
<p>test that all builds and tests are working (mvn clean install)</p>
</li>
<li>
<p>commit your code (svn commit, git push) - for all your commits ensure you stick to the conventions for code contributions (see <a href="#devonfw-code-contribution.asciidoc">code contribution</a>) and provide proper comments (see <a href="#coding-conventions.asciidoc">coding conventions</a>).</p>
</li>
<li>
<p>if no milestone was assigned please assign suitable milestone</p>
</li>
<li>
<p>set the issue as done</p>
</li>
</ul>
</div>
<!-- toc disabled -->
</div>
</div>
<div class="sect2">
<h3 id="devonfw-code-contribution.asciidoc">12.3. Code contribution</h3>
<div class="paragraph">
<p>We are looking forward to your contribution to devon4j. This page describes the few conventions to follow. Please note that this is an open and international project and all content has to be in (American) English language.</p>
</div>
<div class="paragraph">
<p>For contributions to the code please consider:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>We are working issue-based so check if there is already an issue in our tracker for the task you want to work on or create a new issue for it.</p>
</li>
<li>
<p>In case of more complex issues please get involved with the community and ensure that there is a common understanding of what and how to do it. You do not want to invest into something that will later be rejected by the community.</p>
</li>
<li>
<p>Before you get started ensure that you comment the issue accordingly and you are the person assigned to the issue. If there is already someone else assigned get in contact with him if you still want to contribute to the same issue. You do not want to invest into something that is already done by someone else.</p>
</li>
<li>
<p>Create a <a href="https://help.github.com/articles/fork-a-repo/">fork</a> of the repository on github to your private github space.</p>
</li>
<li>
<p>Clone this fork.</p>
</li>
<li>
<p>Before doing any change choose the branch you want to add your feature to. In most cases this will be the <code>develop</code> branch to add new features. However, if you want to fix a bug, check if an according maintenance branch <code>develop-x.y</code> already exists and switch to that one before.</p>
</li>
<li>
<p>Then the first step is to create a local feature branch (named by the feature you are planning so `feature/«issue-id»-«keyword») and checkout this branch.</p>
</li>
<li>
<p>Start your modifications.</p>
</li>
<li>
<p>Ensure to stick to our <a href="#coding-conventions.asciidoc">coding-conventions</a>.</p>
</li>
<li>
<p>Check in features or fixes as individual commits associated with an <a href="#../issues">issue</a> using the commit message format:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>#&lt;issueId&gt;: &lt;describe your change&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then github will automatically link the commit in the issue. In case you worked on an issue from a different repository (e.g. change in devon4j-sample due to issue in devon4j) we use this commit message format:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>devonfw/&lt;repository&gt;#&lt;issueId&gt;: &lt;describe your change&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>So as an example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>devonfw/devon4j#1: added REST service for tablemanagement</code></pre>
</div>
</div>
</li>
<li>
<p>If you completed your feature (bugfix, improvement, etc.) use a <a href="https://help.github.com/articles/using-pull-requests/">pull request</a> to give it back to the community.</p>
</li>
<li>
<p>Your pull request will automatically be checked if it builds correctly (no compile or test errors), can be merged without conflicts, and <a href="https://github.com/devonfw-forge/devon-guide/wiki/cookbook-cla">CLA</a> has been signed. Please ensure to do the required tasks and reworks unless all checks are satisfied.</p>
</li>
<li>
<p>From here a reviewer should take over and give feedback. In the best case, your contribution gets merged and everything is completed.</p>
</li>
<li>
<p>In case you should not get feedback for weeks, do not hesitate to ask the community.</p>
</li>
<li>
<p>If one (typically the reviewer) has to change the base branch (because the wrong develop branch was used, see above) onto which the changes will be merged, one can do the same by following the instructions at <a href="https://github.com/blog/2224-change-the-base-branch-of-a-pull-request/">here</a>.</p>
</li>
<li>
<p>see also the <a href="#devonfw-documentation.asciidoc">documentation</a> guidelines.</p>
</li>
</ul>
</div>
<!-- toc disabled -->
</div>
<div class="sect2">
<h3 id="devonfw-documentation.asciidoc">12.4. devonfw Documentation</h3>
<div class="paragraph">
<p>We are using the github AsciiDoc feature to create and maintain the documentation for devonfw. Also the documentation PDFs are generated from these AsciiDoc files.</p>
</div>
<div class="paragraph">
<p>The source of the documentation is always located in the <code>documentation</code> folder of the main git repository (see <code>Code</code> tab and then click on <code>documentation</code>). These files are automatically synchronized to the wiki. This is for pure usability reasons as people typically go to the <code>Wiki</code> tab on github repositories to look for documentation. However, the wiki is a read-only copy of the <code>documentation</code> folder from the <code>Code</code> repo.</p>
</div>
<div class="sect3">
<h4 id="devonfw-documentation.asciidoc_contribution-to-devon4j-documentation">12.4.1. Contribution to devon4j documentation</h4>
<div class="paragraph">
<p>Contributions and improvements to the documentation are welcome. However, you should be aware of the following aspects:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Your contributions will become part of the devon4j documentation and is licensed under creative commons (see footer).</p>
</li>
<li>
<p>If you want to contribute larger changes (beyond fixing a typo or a link) please consider to get in contact with the community (by creating an <a href="https://github.com/devonfw/devon4j/issues">issue</a>) before getting started. You do not want to write complete chapters and then get your work rejected afterwards.</p>
</li>
<li>
<p>Please consult the <a href="https://github.com/devonfw/devon-docgen/wiki#guidelines">DocGen manual</a> as we are using DocGen
to generate the documentation starting from <a href="#devon4j-doc.asciidoc">devon4j-doc</a>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If you consider all the aspects above you can start editing the documentation if you have a <a href="https://github.com/join">github-account</a>. For small and simple changes just go to the AsciiDoc file in the <code>documentation</code> folder. Then click on the pencil-icon (you have to be signed in). Now github will allow you to edit the raw AsciiDoc text. Do your changes and preview them (using the <code>Preview</code> tab). Once complete, commit the changes as a new branch. From there click on <code>compare and pull-request</code> and finally confirm your pull-request.
For larger changes, you should create a fork just as for <a href="#devonfw-code-contribution.asciidoc">code-contributions</a>. Often larger changes imply changes to documentation and code.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="master-devon4j.asciidoc_tutorials">13. Tutorials</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="tutorial-introduction.asciidoc">13.1. Introduction</h3>
<div class="paragraph">
<p>This is an step by step tutorial for starting an devonfw server application from setting up the environment to packaging for production.</p>
</div>
<div class="paragraph">
<p>The tutorial starts by setting up the programmer environment with the aid of the devon-ide project and verifies everything is correct by running the my-thai-start restaurant sample application of the devonfw project.</p>
</div>
<div class="paragraph">
<p>Afterwards a new blank application is created by using the provided archetypes and all generated files are reviewed to explain what devonfw is providing.</p>
</div>
<div class="paragraph">
<p>A classical CRUD use case is developed for creating, retrieving updating and deleting an entity. With this entity we introduce cross cutting concerns such as exception handling, validation and securing the access from the web.</p>
</div>
<div class="paragraph">
<p>Finally the sample will be ready for deployment to a web server so we will package it on a WAR (or EAR) file.</p>
</div>
<!-- toc disabled -->
</div>
<div class="sect2">
<h3 id="tutorial-newapp.asciidoc">13.2. Creating a new application</h3>
<div class="sect3">
<h4 id="tutorial-newapp.asciidoc_running-the-archetype">13.2.1. Running the archetype</h4>
<div class="paragraph">
<p>In order to create a new application you must use the archetype provided by devon4j which uses the maven archetype functionality.</p>
</div>
<div class="paragraph">
<p>To create a new application, you should have installed devonfw IDE.
You can choose between 2 alternatives, create it from command line or, in more visual manner, within eclipse.</p>
</div>
<div class="sect4">
<h5 id="tutorial-newapp.asciidoc_from-command-line">From command Line</h5>
<div class="paragraph">
<p>To create a new devon4j application from command line, you can simply run the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">devon java create com.example.application.sampleapp</code></pre>
</div>
</div>
<div class="paragraph">
<p>For low-level creation you can also manually call this command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">mvn -DarchetypeVersion=3.1.0 -DarchetypeGroupId=com.devonfw.java.templates -DarchetypeArtifactId=devon4j-template-server archetype:generate -DgroupId=com.example.application -DartifactId=sampleapp -Dversion=1.0.0-SNAPSHOT -Dpackage=com.devonfw.application.sampleapp</code></pre>
</div>
</div>
<div class="paragraph">
<p>Further providing additional properties (using <code>-D</code> parameter) you can customize the generated app:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 18. Options for app template</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>property</strong></th>
<th class="tableblock halign-left valign-top"><strong>comment</strong></th>
<th class="tableblock halign-left valign-top"><strong>example</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>dbType</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Choose the type of RDBMS to use (<code>hana</code>, <code>oracle</code>, <code>mssql</code>, <code>postgresql</code>, <code>mariadb</code>, <code>mysql</code>, etc.)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-DdbTpye=postgresql</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>batch</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Option to add an <code>batch</code> module</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-Dbatch=batch</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>earProjectName</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Option to add an EAR module with the given name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-DearProjectName=ear</code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="tutorial-newapp.asciidoc_from-eclipse">From Eclipse</h5>
<div class="literalblock">
<div class="content">
<pre>After that, you should follow this Eclipse steps to create your application:</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Create a new Maven Project.</p>
</li>
<li>
<p>Choose the devon4j-template-server archetype, just like the image.</p>
</li>
</ul>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/eclipse-m2e-create-devon4j-project.png" alt="Select archetype">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Fill the Group Id, Artifact Id, Version and Package for your project.
If you want to add an EAR generation mechanism to your project, you should fill the property earProjectName with the value Artifact Id + "-ear". For example, "sampleapp-ear". If you only want WAR generation, you can remove the property earProjectName.</p>
</li>
</ul>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/eclipse-m2e-create-devon4j-project-parameters.png" alt="Configure archetype">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Finish the Eclipse assistant and you are ready to start your project.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="tutorial-newapp.asciidoc_what-is-generated">13.2.2. What is generated</h4>
<div class="paragraph">
<p>The application template (archetype) generates a Maven multi-module project. It has the following modules:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>api</code>: module with the API (REST service interfaces, transferobjects, datatypes, etc.) to be imported by other apps as a maven dependency in order to invoke and consume the offered (micro)services.</p>
</li>
<li>
<p><code>core</code>: maven module containing the core of the application.</p>
</li>
<li>
<p><code>batch</code>: optional module for <a href="#guide-batch-layer.asciidoc">batch</a>(es)</p>
</li>
<li>
<p><code>server</code>: module that bundles the entire app (<code>core</code> with optional <code>batch</code>) as a WAR file.</p>
</li>
<li>
<p><code>ear</code>: optional maven module is responsible to packaging the application as a EAR file.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The toplevel <code>pom.xml</code> of the generated project has the following features:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Properties definition: Spring-boot version, Java version, etc.</p>
</li>
<li>
<p>Modules definition for the modules (described above)</p>
</li>
<li>
<p>Dependency management: define versions for dependencies of the technology stack that are recommended and work together in a compatible way.</p>
</li>
<li>
<p>Maven plugins with desired versions and configuration</p>
</li>
<li>
<p>Profiles for <a href="#guide-testing.asciidoc">test stages</a></p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="tutorial-newapp.asciidoc_core-module">Core Module</h5>
<div class="paragraph">
<p>Core module constains the base classes and the base configuration for the application. We are going to describe each Java file and each XML configuration file that archetype has generated.</p>
</div>
<div class="sect5">
<h6 id="tutorial-newapp.asciidoc_java">Java</h6>
<div class="paragraph">
<p>Those are the different Java files contained in each package:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>general.common</p>
</li>
</ul>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 40%;">
<col style="width: 60%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>File</strong></th>
<th class="tableblock halign-left valign-top"><strong>Descripcion</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">api.ApplicationEntity.java</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Abstract interface for a MutableGenericEntity of this application.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">api.BinaryObject.java</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Interface for a BinaryObject.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">api.NlsBundleApplicationRoot.java</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NlsBundle for this application.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">api.Usermanagement.java</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Interface to get a user from its login.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">api.UserProfile.java</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Interface for the profile of a logged user.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">api.constants.PermissionConstants.java</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Constants for AccessControlPermission´s keys.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">api.datatype.OrderBy.java</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enum for sort order.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">api.datatype.Role.java</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enum for roles.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">api.exception.ApplicationBusinessException.java</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Abstract business main exception.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">api.exception.ApplicationException.java</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Abstract main exception.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">api.exception.ApplicationTechnicalException.java</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Abstract technical main exception.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">api.exception.IllegalEntityStateException.java</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Manage entities illegal state exceptions.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">api.exception.IllegalPropertyChangeException.java</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Manage entities illegal property changes exceptions.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">api.exception.NoActiveUserException.java</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Manage exceptions when user require to be logged in.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">api.security.UserData.java</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Container class for the profile of a user.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">api.to.AbstractCto.java</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Abstract class for Composite Transfer Object.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">api.to.AbstractEto.java</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Abstract class for Entity Transfer Object.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">api.to.AbstractTo.java</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Abstract class for a plain Transfer Object.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">api.to.SearchCriteriaTo.java</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Abstract class for a Transfer Object with the criteria for a search query.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">api.to.UserDetailsClientTo.java</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">base.AbstractBeanMapperSupport.java</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Provides access to the BeanMapper.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">impl.security.ApplicationAuthenticationProvider.java</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Responsible for the security aspects of authentication.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">impl.security.
PrincipalAccessControlProviderImpl.java</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Implementation of PrincipalAccessControlProvider.</p></td>
</tr>
</tbody>
</table>
<div class="ulist">
<ul>
<li>
<p>general.dataaccess</p>
</li>
</ul>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>File</strong></th>
<th class="tableblock halign-left valign-top"><strong>Descripcion</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">api.ApplicationPersistenceEntity.java</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Abstract Entity for all Entities with an id and a version field.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">api.BinaryObjectEntity.java</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">BinaryObject entity.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">api.dao.ApplicationDao.java</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Interface for all DAOs of the application.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">api.dao.ApplicationRevisionedDao.java</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Interface for all revisioned DAOs of the application.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">api.dao.BinaryObjectDao.java</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DAO for BinaryObject entity.</p></td>
</tr>
</tbody>
</table>
<div class="ulist">
<ul>
<li>
<p>general.gui.api</p>
</li>
</ul>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>File</strong></th>
<th class="tableblock halign-left valign-top"><strong>Descripcion</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LoginController.java</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Controller for login page.</p></td>
</tr>
</tbody>
</table>
<div class="ulist">
<ul>
<li>
<p>general.logic</p>
</li>
</ul>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>File</strong></th>
<th class="tableblock halign-left valign-top"><strong>Descripcion</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">api.UseCase.java</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Annotation to mark all use-cases.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">api.to.BinaryObjectEto.java</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ETO for a BinaryObject.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">base.AbstractUc.java</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Abstract base class for any use case in the application.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">base.UcManageBinaryObject.java</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Use case for managing BinaryObject.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">impl.UcManageBinaryObjectImpl.java</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Implementation of the UcManageBinaryObject interface.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">impl.UsermanagementDummyImpl.java</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Implementation of Usermanagement.</p></td>
</tr>
</tbody>
</table>
<div class="ulist">
<ul>
<li>
<p>general.service.impl.rest</p>
</li>
</ul>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>File</strong></th>
<th class="tableblock halign-left valign-top"><strong>Descripcion</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ApplicationAccessDeniedHandler.java</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Class to manage denied access.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ApplicationObjectMapperFactory.java</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">MappingFactory class to resolve polymorphic conflicts within the application.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SecurityRestServiceImpl.java</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Class that represents REST service for security.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect5">
<h6 id="tutorial-newapp.asciidoc_resources">Resources</h6>
<div class="paragraph">
<p>Those are the different XML files contained in resources folder:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>config</p>
</li>
</ul>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>File</strong></th>
<th class="tableblock halign-left valign-top"><strong>Descripcion</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">app.common.beans-common.xml</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Constains beans definition for application common beans like propertyConfigurer bean.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">app.common.beans-dozer.xml</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Beans relationated with Dozer Mappers.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">app.common.dozer-mapping.xml</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Dozer mapping configuration.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">app.dataaccess.beans-dataaccess.xml</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Parent from the other data access files.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">app.dataaccess.beans-db-plain.xml</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Data source configuration for profile <code>db-plain</code> (testing).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">app.dataaccess.beans-db-server.xml</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Data source configuration for profile distinct to <code>db-plain.</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">app.dataaccess.beans-jpa.xml</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Contains neccessary beans to configure JPA.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">app.dataaccess.NamedQueries.xml</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">app.gui.dispatcher-servlet.xml</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">app.logic.beans-logic.xml</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Component scan configuration for classes in <code>logic</code> path.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">app.security.access-control-schema.xml</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">app.security.beans-security-filters.xml</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Security filters definition.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">app.security.beans-security.xml</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Application security configuration.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">app.service.beans-monitoring.xml</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">app.service.beans-service.xml</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Importing configuration files, REST beans definition and configuration.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">app.websocket.websocket-context.xml</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Scan component package definition for websockects.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">app.application.default.properties</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Default application properties values.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">app</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">beans-application</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Root file configuration. It starts the chain and imports other configuration files.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">env</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">application</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specific application properties values.</p></td>
</tr>
</tbody>
</table>
<div class="ulist">
<ul>
<li>
<p>db</p>
</li>
</ul>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>File</strong></th>
<th class="tableblock halign-left valign-top"><strong>Descripcion</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">migration.V0001__Create_schema.slq</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Script template to create the database schema and tables definition.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect5">
<h6 id="tutorial-newapp.asciidoc_test">Test</h6>
<div class="paragraph">
<p>Those are different Java files to serve as base classes in testing:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>general.common</p>
</li>
</ul>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>File</strong></th>
<th class="tableblock halign-left valign-top"><strong>Descripcion</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">AbstractSpringIntegrationTest.java</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">AccessControlSchemaXmlValidationTest.java</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Tests if the access-control-schema.xml is valid.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">PermissionCheckTest.java</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Test to check if all relevant methods in use case implementations have permission checks.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect4">
<h5 id="tutorial-newapp.asciidoc_server-module">Server Module</h5>
<div class="paragraph">
<p>This module is constains two files:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>lockback.xml: This file is in the resources folder and it is the responsible to configure the log.</p>
</li>
<li>
<p>pom.xml: This file has Maven configuration for packaging the application as a WAR. Also, this file has a profile to package the Javascript client ZIP file into the WAR.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="tutorial-newapp.asciidoc_ear-module">EAR Module</h5>
<div class="paragraph">
<p>This module only contains a pom.xml file to packaging the application as EAR from the WAR generated.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="tutorial-newapp.asciidoc_database-configuration-and-creation">13.2.3. Database configuration and creation</h4>
<div class="paragraph">
<p>Including driver installation if oracle or other db is required.</p>
</div>
</div>
<div class="sect3">
<h4 id="tutorial-newapp.asciidoc_editing-the-pom.xml">13.2.4. Editing the pom.xml</h4>
<div class="paragraph">
<p>How to edit the pom.xml file for the project to add dependencies and modules for the application.</p>
</div>
</div>
<div class="sect3">
<h4 id="tutorial-newapp.asciidoc_known-issues">13.2.5. Known Issues</h4>
<div class="ulist">
<ul>
<li>
<p>Could not resolve archetype com.devonfw.java.templates:devon4j-template-server:.. from any of the configured repositories.
In Eclipse:
Open Window &gt; Preferences
Open Maven &gt; Archetypes
Click 'Add Remote Catalog' and add the following:
Catalog File: <a href="http://repo1.maven.org/maven2/archetype-catalog.xml" class="bare">http://repo1.maven.org/maven2/archetype-catalog.xml</a>
Description: maven catalog</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="master-devon4j.asciidoc_for-core-developers">14. For Core-Developers</h2>
<div class="sectionbody">
<!-- toc disabled -->
<div class="sect2">
<h3 id="devonfw-release.asciidoc">14.1. Creating a Release</h3>
<div class="paragraph">
<p>This page documents how to create and publish a release of devon4j.</p>
</div>
<div class="paragraph">
<p>For each release there is a <a href="https://github.com/devonfw/devon4j/milestones">milestone</a> that contains an issue for creating the release itself (the github issue of that issue is referred as <code>«issue»</code>). The release version is referred as «x.y.z».</p>
</div>
<div class="sect3">
<h4 id="devonfw-release.asciidoc_releasing-the-code">14.1.1. Releasing the code</h4>
<div class="paragraph">
<p>To release the code follow these steps.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Create a clean clone of the repository:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">git clone https://github.com/devonfw/devon4j.git</code></pre>
</div>
</div>
</li>
<li>
<p>In case you want to build a (bug fix) release from a different branch, switch to that branch:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">git checkout -b develop-«x.y» origin/develop-«x.y»</code></pre>
</div>
</div>
</li>
<li>
<p>Ensure your branch is up-to-date:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">git pull</code></pre>
</div>
</div>
</li>
<li>
<p>Ensure that the result is what you want to release (<code>mvn clean install</code>).</p>
</li>
<li>
<p>Bump the release version by removing the <code>-SNAPSHOT</code> from <code>devon4j.version</code> property in top-level <code>pom.xml</code>.</p>
</li>
<li>
<p>Create an annotated tag for your release:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">git tag -a release/x.y.z -m "#«issue»: tagged x.y.z"</code></pre>
</div>
</div>
<div class="paragraph">
<p>e.g For release 2.5.0 the command would look like</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">git tag -a release/2.5.0 -m "#618: tagged 2.5.0"</code></pre>
</div>
</div>
<div class="paragraph">
<p>where #618 is the issue number created for release itself under release milestone.
You can confirm if the tag is created by listing out the tags with the following command</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>git tag</code></pre>
</div>
</div>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="devonfw-release.asciidoc_configure-ossrh">Configure OSSRH</h5>
<div class="paragraph">
<p>For publishing artifacts to OSSRH, we need an OSSRH account with necessary rights for publishing and managing staging repositories. And configure this account in devonfw distribution to create connection and deploy to OSSRH.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If you do not already have an account on OSSRH, create an account on the link below
<a href="https://issues.sonatype.org/secure/Signup!default.jspa" class="bare">https://issues.sonatype.org/secure/Signup!default.jspa</a></p>
</li>
<li>
<p>You need manager access to deploy artifacts to OSSRH. For same contact devonfw administrators for OSSRH.</p>
</li>
<li>
<p>Open file <code>conf/.m2/setting.xml</code> in your devon distribution (devon-ide) and add a new server with following details</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;server&gt;
   &lt;id&gt;ossrh&lt;/id&gt;
   &lt;username&gt;«ossrh_username»&lt;/username&gt;
   &lt;password&gt;«ossrh_password»&lt;/password&gt;
&lt;/server&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here <code>«ossrh_username»</code> and <code>«ossrh_password»</code> are the account details used to login into OSSRH and should have rights to publish artifacts to OSSRH for <code>groupId</code> name <code>com.devonfw</code> (and its children).
Please use <a href="http://maven.apache.org/guides/mini/guide-encryption.html">password encryption</a> and prevent
storing passwords in plain text.
The id <code>ossrh</code> points to the OSSRH repository for snaphost and release declared in the  <code>&lt;distributionManagement&gt;</code> section of the <code>devon4j/pom.xml</code>.</p>
</div>
</li>
<li>
<p>Optionally you may want to explicitly define PGP key via the associated email-address:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;profile&gt;
  &lt;id&gt;devon.ossrh&lt;/id&gt;
  &lt;activation&gt;
    &lt;activeByDefault&gt;true&lt;/activeByDefault&gt;
  &lt;/activation&gt;
  &lt;properties&gt;
    &lt;gpg.keyname&gt;your.email@address.com&lt;/gpg.keyname&gt;
  &lt;/properties&gt;
&lt;/profile&gt;</code></pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="devonfw-release.asciidoc_configure-pgp">Configure PGP</h5>
<div class="paragraph">
<p>Artifacts should be PGP signed before they can be deployed to OSSRH. Artifacts can be signed either by using command line tool GnuPG or GUI based tool Gpg4win Kleopetra (preferred). Follow the steps below to sign artifacts using either of the two tools.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Download tools
GnuPg - <a href="https://www.gnupg.org/download/" class="bare">https://www.gnupg.org/download/</a>
gpg4win - <a href="https://www.gpg4win.org/download.html" class="bare">https://www.gpg4win.org/download.html</a></p>
</li>
<li>
<p>Installation
Installation is self explanatory for GnuPG and gpg4win. To verify installation of GnuPg, open windows command line and run "gpg --version or gpg2 --version"</p>
</li>
<li>
<p>Generate PGP key pair for signing artifacts.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Remember the passphrase set for PGP keys as it will be used later for authentication during signing of artifacts by maven.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Using GnuPg follow either of the link below</p>
</div>
<div class="paragraph">
<p><a href="http://central.sonatype.org/pages/working-with-pgp-signatures.html#generating-a-key-pair" class="bare">http://central.sonatype.org/pages/working-with-pgp-signatures.html#generating-a-key-pair</a></p>
</div>
<div class="paragraph">
<p><a href="https://www.youtube.com/watch?v=DE3FVty3NgE&amp;feature=youtu.be" class="bare">https://www.youtube.com/watch?v=DE3FVty3NgE&amp;feature=youtu.be</a></p>
</div>
<div class="paragraph">
<p>Using Kleopetra follow link below</p>
</div>
<div class="paragraph">
<p><a href="https://www.deepdotweb.com/2015/02/21/pgp-tutorial-for-windows-kleopatra-gpg4win/" class="bare">https://www.deepdotweb.com/2015/02/21/pgp-tutorial-for-windows-kleopatra-gpg4win/</a></p>
</div>
<div class="paragraph">
<p>Exporting PGP key to public key-server</p>
</div>
<div class="paragraph">
<p>Using GnuPg - <a href="http://central.sonatype.org/pages/working-with-pgp-signatures.html#distributing-your-public-key" class="bare">http://central.sonatype.org/pages/working-with-pgp-signatures.html#distributing-your-public-key</a></p>
</div>
<div class="paragraph">
<p>Using Kleopetra, click on the certificate entry you want to publish to OpenPGP certificate servers and select File &gt; Publish on Server as shown below. These instructions are as per Kleopatra 3.0.1-gpg4win-3.0.2, for latest versions there might be some variation.</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/release/pgp_key_publish.png"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/release/pgp_key_publish.png" alt="pgp key publish" width="450"></a>
</div>
</div>
</div>
<div class="sect4">
<h5 id="devonfw-release.asciidoc_deploy-to-ossrh">Deploy to OSSRH</h5>
<div class="ulist">
<ul>
<li>
<p>Go to the root of devon4j project and run following command. Make sure there are no spaces between comma separated profiles.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">mvn clean deploy -P deploy</code></pre>
</div>
</div>
</li>
<li>
<p>A pop will appear asking for passphrase for PGP key. Enter the passphrase and press "OK".</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/release/pgpkey_passphrase.png"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/release/pgpkey_passphrase.png" alt="pgpkey passphrase" width="950"></a>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If you face the error below, contact one of the people who have access to the repository for access rights.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/release/ossrh_publish_error_forbidden.png"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/release/ossrh_publish_error_forbidden.png" alt="ossrh publish error forbidden" width="950"></a>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Open <a href="https://oss.sonatype.org/">OSSRH</a>, login and open staging repositories.</p>
</li>
<li>
<p>Find your deployment repository as <code>comdevonfw-NNNN</code> and check its <code>Content</code>.</p>
</li>
<li>
<p>Then click on <code>Close</code> to close the repository and wait a minute.</p>
</li>
<li>
<p>Refresh the repository and copy the URL.</p>
</li>
<li>
<p>Create a vote for the release and paste the URL of the staging repository.</p>
</li>
<li>
<p>After the vote has passed with success go back to OSSRH and and click on <code>Release</code> to publish the release and stage to maven central.</p>
</li>
<li>
<p>Edit the top-level <code>pom.xml</code> and change <code>devon4j.version</code> property to the next planned release version including the <code>-SNAPSHOT</code> suffix.</p>
</li>
<li>
<p>Commit and push the changes:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">git commit -m "#«issue»: open next snapshot version"
git push</code></pre>
</div>
</div>
</li>
<li>
<p>In case you build the release from a branch other that <code>develop</code> ensure to follow the next steps. Otherwise you are done here and can continue to the next section. To merge the changes (bug fixes) onto develop do:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">git checkout develop
git merge develop-«x.y»</code></pre>
</div>
</div>
</li>
<li>
<p>You most probably will have a conflict in the top-level <code>pom.xml</code>. Then resolve this conflict. In any case edit this <code>pom.xml</code> and ensure that it is still pointing to the latest planned <code>SNAPSHOT</code> for the <code>develop</code> branch.</p>
</li>
<li>
<p>If there are local changes to the top-level <code>pom.xml</code>, commit them:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">git commit -m "#«issue»: open next snapshot version"</code></pre>
</div>
</div>
</li>
<li>
<p>Push the changes of your <code>develop</code> branch:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">git push</code></pre>
</div>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="devonfw-release.asciidoc_releasing-the-maven-site">14.1.2. Releasing the maven-site</h4>
<div class="ulist">
<ul>
<li>
<p>Create a new folder for your version in your checkout of <a href="https://github.com/devonfw/devonfw.github.io/tree/master/devon4j">devonfw.github.io/devon4j</a> (as <code>«x.y.z»</code>).</p>
</li>
<li>
<p>Copy the just generated <code>devon4j-doc.pdf</code> into the new release version folder.</p>
</li>
<li>
<p>Copy the <code>index.html</code> from the previous release to the new release version folder.</p>
</li>
<li>
<p>Edit the new copy of <code>index.html</code> and replace all occurrences of the version to the new release as well as the release date.</p>
</li>
<li>
<p>Generate the maven site from the <code>devon4j</code> release checkout (see <a href="#devonfw-release.asciidoc_releasing-the-core">code release</a>):</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">mvn site
mvn site:deploy</code></pre>
</div>
</div>
</li>
<li>
<p>Review that the maven site is intact and copy it to the new release version folder (from <code>devon4j/target/devon4j/maven</code> to <code>devonfw.github.io/devon4j/«x.y.z»/maven</code>).</p>
</li>
<li>
<p>Update the link in the <code>devon4j/index.html</code> to the latest stable documentation.</p>
</li>
<li>
<p>Add, commit and push the new release version folder.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">git add «x.y.z»
git commit -m "devonfw/devon4j#«issue»: released documentation"
git push</code></pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="devonfw-release.asciidoc_finalize-the-release">14.1.3. Finalize the Release</h4>
<div class="ulist">
<ul>
<li>
<p>Close the issue of the release.</p>
</li>
<li>
<p>Close the milestone of the release (if necessary correct the release date).</p>
</li>
<li>
<p>Ensure that the new release is available in maven central.</p>
</li>
<li>
<p>Write an announcement for the new release.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<h1 id="master-devon4ng.asciidoc" class="sect0">IV: devon4ng</h1>
<div class="sect1">
<h2 id="master-devon4ng.asciidoc_architecture">15. Architecture</h2>
<div class="sectionbody">
<!-- toc disabled -->
<div class="sect2">
<h3 id="architecture.asciidoc">15.1. Architecture</h3>
<div class="paragraph">
<p>The following principles and guidelines are based on Angular Styleguide - especially Angular modules (see <a href="https://angular.io/guide/ngmodule">Angular Docs</a>).
It extends those where additional guidance is needed to define an architecture which is</p>
</div>
<div class="ulist">
<ul>
<li>
<p>maintainable across applications and teams</p>
</li>
<li>
<p>easy to understand, especially when coming from a classic Java/.Net perspective - so whenever possible the same principles apply both to the server and the client</p>
</li>
<li>
<p>pattern based to solve common problems</p>
</li>
<li>
<p>based on best of breed solutions coming from open source and Capgemini project experiences</p>
</li>
<li>
<p>gives as much guidance as necessary and as little as possible</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="architecture.asciidoc_overview">15.1.1. Overview</h4>
<div class="paragraph">
<p>When using Angular the web client architecture is driven by the framework in a certain way Google and the Angular community think about web client architecture.
Angular gives an opinion on how to look at architecture.
It is component based like devon4j but uses different terms which are common language in web application development.
The important term is <em>module</em> which is used instead of <em>component</em>. The primary reason is the naming collision with the <em>Web Components</em> standard (see <a href="https://www.w3.org/standards/techs/components">Web Components</a>).<br>
To clarify this:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A <em>component</em> describes an UI element containing HTML, CSS and JavaScript - structure, design and logic encapsulated inside a reusable container called component.</p>
</li>
<li>
<p>A <em>module</em> describes an applications feature area. The application flight-app may have a module called booking.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>An application developed using Angular consists of multiple modules.
There are feature modules and special modules described by the Angular Styleguide - <a href="https://angular.io/guide/ngmodule#the-core-module"><em>core</em></a> and <a href="https://angular.io/guide/ngmodule#shared-module"><em>shared</em></a>.
Angular or Angular Styleguide give no guidance on how to structure a module internally.
This is where this architecture comes in.</p>
</div>
<div class="sect4">
<h5 id="architecture.asciidoc_layers">Layers</h5>
<div class="paragraph">
<p>The architecture describes two layers. The terminology is based on common language in web development.</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/architecture-layers.svg"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/architecture-layers.svg" alt="Architecture - Layers" width="450"></a>
</div>
<div class="title">Figure 5. Layers</div>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#components-layer.asciidoc"><strong>Components Layer</strong></a> encapsulates components which present the current application state.
Components are separated into <a href="#components-layer.asciidoc"><em>Smart</em> and <em>Dumb Components</em></a>.
The only logic present is view logic inside <em>Smart Components</em>.</p>
</li>
<li>
<p><a href="#services-layer.asciidoc"><strong>Services Layer</strong></a> is more or less what we call 'business logic layer' on the server side.
The layer defines the applications state, the transitions between state and classic business logic.
Stores contain application state over time to which <em>Smart Components</em> subscribe to.
Adapters are used to perform XHRs, WebSocket connections, etc.
The business model is described inside the module.
Use case services perform business logic needed for use cases.
A use case services interacts with the store and adapters.
Methods of use case services are the API for <em>Smart Components</em>.
Those methods are <em>Actions</em> in reactive terminology.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="architecture.asciidoc_modules">Modules</h5>
<div class="paragraph">
<p>Angular requires a module called <em>app</em> which is the main entrance to an application at runtime - this module gets bootstrapped.
Angular Styleguide defines feature modules and two special modules - <a href="https://angular.io/guide/ngmodule#the-core-module"><em>core</em></a> and <a href="https://angular.io/guide/ngmodule#shared-module"><em>shared</em></a>.</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/architecture-modules.svg"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/architecture-modules.svg" alt="Architecture - Modules" width="450"></a>
</div>
<div class="title">Figure 6. Modules</div>
</div>
<div class="paragraph">
<p>A feature module is basically a vertical cut through both layers.
The <em>shared</em> module consists of components shared across feature modules.
The <em>core</em> module holds services shared across modules.
So <em>core</em> module is a module only having a services layer
and <em>shared</em> module is a module only having a components layer.</p>
</div>
<!-- toc disabled -->
</div>
</div>
</div>
<div class="sect2">
<h3 id="meta-architecture.asciidoc">15.2. Meta Architecture</h3>
<div class="sect3">
<h4 id="meta-architecture.asciidoc_introduction">15.2.1. Introduction</h4>
<div class="sect4">
<h5 id="meta-architecture.asciidoc_purpose-of-this-document">Purpose of this document</h5>
<div class="paragraph">
<p>In our business applications, the client easily gets underestimated. Sometimes the client is more complex to develop and design than the server. While the server architecture is nowadays easily to agree as common sense, for clients this is not as obvious and stable especially as it typically depends on the client framework used. Finding a concrete architecture applicable for all clients may therefore be difficult to accomplish.</p>
</div>
<div class="paragraph">
<p>This document tries to define on a high abstract level, a reference architecture which is supposed to be a mental image and frame for orientation regarding the evaluation and appliance of different client frameworks. As such it defines terms and concepts required to be provided for in any framework and thus gives a common ground of understanding for those acquainted with the reference architecture. This allows better comparison between the various frameworks out there, each having their own terms for essentially the same concepts. It also means that for each framework we need to explicitly map how it implements the concepts defined in this document.</p>
</div>
<div class="paragraph">
<p>The architecture proposed herein is neither new nor was it developed from scratch. Instead it is the gathered and consolidated knowledge and best practices of various projects (s. References).</p>
</div>
</div>
<div class="sect4">
<h5 id="meta-architecture.asciidoc_goal-of-the-client-architecture">Goal of the Client Architecture</h5>
<div class="paragraph">
<p>The goal of the client architecture is to support the non-functional requirements for the client, i.e. mostly maintainability, scalability, efficiency and portability. As such it provides a component-oriented architecture following the same principles listed already in the devonfw architecture overview. Furthermore it ensures a homogeneity regarding how different concrete UI technologies are being applied in the projects, solving the common requirements in the same way.</p>
</div>
</div>
<div class="sect4">
<h5 id="meta-architecture.asciidoc_architecture-views">Architecture Views</h5>
<div class="paragraph">
<p>As for the server we distinguish between the business and the technical architecture. Where the business architecture is different from project to project and relates to the concrete design of dialog components given concrete requirements, the technical architecture can be applied to multiple projects.</p>
</div>
<div class="paragraph">
<p>The focus of this document is to provide a technical reference architecture on the client on a very abstract level defining required layers and components. How the architecture is implemented has to be defined for each UI technology.</p>
</div>
<div class="paragraph">
<p>The technical infrastructure architecture is out of scope for this document and although it needs to be considered, the concepts of the reference architecture should work across multiple TI architecture, i.e. native or web clients.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="meta-architecture.asciidoc_devonfw-reference-client-architecture">15.2.2. devonfw Reference Client Architecture</h4>
<div class="paragraph">
<p>The following gives a complete overview of the proposed reference architecture. It will be built up incrementally in the following sections.</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/devonfw-methodology/OASP_ClientArchitecture_CompleteOverview.png"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/devonfw-methodology/OASP_ClientArchitecture_CompleteOverview.png" alt="Complete Client Architecture Overview" width="450"></a>
</div>
</div>
<div class="paragraph">
<p><em>Figure 1 Overview</em></p>
</div>
<div class="sect4">
<h5 id="meta-architecture.asciidoc_client-architecture">Client Architecture</h5>
<div class="paragraph">
<p>On the highest level of abstraction we see the need to differentiate between dialog components and their container they are managed in, as well as the access to the application server being the backend for the client (e.g. an devon4j instance). This section gives a summary of these components and how they relate to each other. Detailed architectures for each component will be supplied in subsequent sections</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/devonfw-methodology/OASP_ClientArchitecture_Overview.png"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/devonfw-methodology/OASP_ClientArchitecture_Overview.png" alt="Client Architecture Overview" width="450"></a>
</div>
</div>
<div class="paragraph">
<p><em>Figure 2 Overview of Client Architecture</em></p>
</div>
<div class="sect5">
<h6 id="meta-architecture.asciidoc_dialog-component">Dialog Component</h6>
<div class="paragraph">
<p>A dialog component is a logical, self-contained part of the user interface. It accepts user input and actions and controls communication with the user. Dialog components use the services provided by the dialog container in order to execute the business logic. They are self-contained, i.e. they possess their own user interface together with the associated logic, data and states.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Dialog components can be composed of other dialog components forming a hierarchy</p>
</li>
<li>
<p>Dialog components can interact with each other. This includes communication of a parent to its children, but also between components independent of each other regarding the hierarchy.</p>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="meta-architecture.asciidoc_dialog-container">Dialog Container</h6>
<div class="paragraph">
<p>Dialog components need to be managed in their lifecycle and how they can be coupled to each other. The dialog container is responsible for this along with the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Bootstrapping the client application and environment</p>
<div class="ulist">
<ul>
<li>
<p>Configuration of the client</p>
</li>
<li>
<p>Initialization of the application server access component</p>
</li>
</ul>
</div>
</li>
<li>
<p>Dialog Component Management</p>
<div class="ulist">
<ul>
<li>
<p>Controlling the lifecycle</p>
</li>
<li>
<p>Controlling the dialog flow</p>
</li>
<li>
<p>Providing means of interaction between the dialogs</p>
</li>
<li>
<p>Providing application server access</p>
</li>
<li>
<p>Providing services to the dialog components<br>
(e.g. printing, caching, data storage)</p>
</li>
</ul>
</div>
</li>
<li>
<p>Shutdown of the application</p>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="meta-architecture.asciidoc_application-server-access">Application Server Access</h6>
<div class="paragraph">
<p>Dialogs will require a backend application server in order to execute their business logic. Typically in an devonfw application the service layer will provide interfaces for the functionality exposed to the client. These business oriented interfaces should also be present on the client backed by a proxy handling the concrete call of the server over the network. This component provides the set of interfaces as well as the proxy.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="meta-architecture.asciidoc_dialog-container-architecture">Dialog Container Architecture</h5>
<div class="paragraph">
<p>The dialog container can be further structured into the following components with their respective tasks described in own sections:</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/devonfw-methodology/OASP_ClientArchitecture_DialogContainer.png"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/devonfw-methodology/OASP_ClientArchitecture_DialogContainer.png" alt="Dialog Container Architecture Overview" width="450"></a>
</div>
</div>
<div class="paragraph">
<p><em>Figure 3 Dialog Container Architecture</em></p>
</div>
<div class="sect5">
<h6 id="meta-architecture.asciidoc_application">Application</h6>
<div class="paragraph">
<p>The application component represents the overall client in our architecture. It is responsible for bootstrapping all other components and connecting them with each other. As such it initializes the components below and provides an environment for them to work in.</p>
</div>
</div>
<div class="sect5">
<h6 id="meta-architecture.asciidoc_configuration-management">Configuration Management</h6>
<div class="paragraph">
<p>The configuration management manages the configuration of the client, so the client can be deployed in different environments. This includes configuration of the concrete application server to be called or any other environment-specific property.</p>
</div>
</div>
<div class="sect5">
<h6 id="meta-architecture.asciidoc_dialog-management">Dialog Management</h6>
<div class="paragraph">
<p>The Dialog Management component provides the means to define, create and destroy dialog components. It therefore offers basic lifecycle capabilities for a component. In addition it also allows composition of dialog components in a hierarchy. The lifecycle is then managed along the hierarchy, meaning when creating/destroying a parent dialog, this affects all child components, which are created/destroyed as well.</p>
</div>
</div>
<div class="sect5">
<h6 id="meta-architecture.asciidoc_service-registry">Service Registry</h6>
<div class="paragraph">
<p>Apart from dialog components, a client application also consists of services offered to these. A service can thereby encompass among others:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Access to the application server</p>
</li>
<li>
<p>Access to the dialog container functions for managing dialogs or accessing the configuration</p>
</li>
<li>
<p>Dialog independent client functionality such as Printing, Caching, Logging, Encapsulated business logic such as tax calculation</p>
</li>
<li>
<p>Dialog component interaction</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The service registry offers the possibility to define, register and lookup these services. Note that these services could be dependent on the dialog hierarchy, meaning different child instances could obtain different instances / implementations of a service via the service registry, depending on which service implementations are registered by the parents.</p>
</div>
<div class="paragraph">
<p>Services should be defined as interfaces allowing for different implementations and thus loose coupling.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="meta-architecture.asciidoc_dialog-component-architecture">Dialog Component Architecture</h5>
<div class="paragraph">
<p>A dialog component has to support all or a subset of the following tasks:<br>
(T1)	Displaying the user interface incl. internationalization<br>
(T2)	Displaying business data incl. changes made to the data due to user interactions and localization of the data<br>
(T3)	Accepting user input including possible conversion from e.g. entered Text to an Integer<br>
(T4)	Displaying the dialog state<br>
(T5)	Validation of user input<br>
(T6)	Managing the business data incl. business logic altering it due to user interactions<br>
(T7)	Execution of user interactions<br>
(T8)	Managing the state of the dialog (e.g. Edit vs. View)<br>
(T9)	Calling the application server in the course of user interactions</p>
</div>
<div class="paragraph">
<p>Following the principle of separation of concerns, we further structure a dialog component in an own architecture allowing us the distribute responsibility for these tasks along the defined components:</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/devonfw-methodology/OASP_ClientArchitecture_DialogComponent.png"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/devonfw-methodology/OASP_ClientArchitecture_DialogComponent.png" alt="Dialog Component Architecture" width="450"></a>
</div>
</div>
<div class="paragraph">
<p><em>Figure 4 Overview of dialog component architecture</em></p>
</div>
<div class="sect5">
<h6 id="meta-architecture.asciidoc_presentation-layer">Presentation Layer</h6>
<div class="paragraph">
<p>The presentation layer generates and displays the user interface, accepts user input and user actions and binds these to the dialog core layer (T1-5). The tasks of the presentation layer fall into two categories:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Provision of the visual representation (View component)</strong><br>
The presentation layer generates and displays the user interface and accepts user input and user actions. The logical processing of the data, actions and states is performed in the dialog core layer. The data and user interface are displayed in localized and internationalized form.</p>
</li>
<li>
<p><strong>Binding of the visual representation to the dialog core layer</strong><br>
The presentation layer itself does not contain any dialog logic. The data or actions entered by the user are then processed in the dialog core layer. There are three aspects to the binding to the dialog core layer. We refer to “data binding”, “state binding” and “action binding”. Syntactical and (to a certain extent) semantic validations are performed during data binding (e.g. cross-field plausibility checks). Furthermore, the formatted, localized data in the presentation layer is converted into the presentation-independent, neutral data in the dialog core layer (parsing) and vice versa (formatting).</p>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="meta-architecture.asciidoc_dialog-core-layer">Dialog Core Layer</h6>
<div class="paragraph">
<p>The dialog core layer contains the business logic, the control logic, and the logical state of the dialog. It therefore covers tasks T5-9:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Maintenance of the logical dialog state and the logical data</strong><br>
The dialog core layer maintains the logical dialog state and the logical data in a form which is independent of the presentation. The states of the presentation (e.g. individual widgets) must not be maintained in the dialog core layer, e.g. the view state could lead to multiple presentation states disabling all editable widgets on the view.</p>
</li>
<li>
<p><strong>Implementation of the dialog and dialog control logic</strong><br>
The component parts in the dialog core layer implement the client specific business logic and the dialog control logic. This includes, for example, the manipulation of dialog data and dialog states as well as the opening and closing of dialogs.</p>
</li>
<li>
<p><strong>Communication with the application server</strong><br>
The dialog core layer calls the interfaces of the application server via the application server access component services.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The dialog core layer should not depend on the presentation layer enforcing a strict layering and thus minimizing dependencies.</p>
</div>
</div>
<div class="sect5">
<h6 id="meta-architecture.asciidoc_interactions-between-dialog-components">Interactions between dialog components</h6>
<div class="paragraph">
<p>Dialog components can interact in the following ways:</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/devonfw-methodology/OASP_ClientArchitecture_DialogInteractions.png"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/devonfw-methodology/OASP_ClientArchitecture_DialogInteractions.png" alt="Dialog Interactions" width="450"></a>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Embedding of dialog components</strong><br>
As already said dialog components can be hierarchically composed. This composition works by embedding on dialog component within the other. Apart from the lifecycle managed by the dialog container, the embedding needs to cope for the visual embedding of the presentation and core layer.</p>
<div class="ulist">
<ul>
<li>
<p><strong>Embedding dialog presentation</strong><br>
The parent dialog needs to either integrate the embedded dialog in its layout or open it in an own model window.</p>
</li>
<li>
<p><strong>Embedding dialog core</strong><br>
The parent dialog needs to be able to access the embedded instance of its children. This allows initializing and changing their data and states. On the other hand the children might require context information offered by the parent dialog by registering services in the hierarchical service registry.</p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>Dialog flow</strong><br>
Apart from the embedding of dialog components representing a tight coupling, dialogs can interact with each other by passing the control of the UI, i.e. switching from one dialog to another.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>When interacting, dialog components should interact only between the same or lower layers, i.e. the dialog core should not access the presentation layer of another dialog component.</p>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="meta-architecture.asciidoc_appendix">15.2.3. Appendix</h4>
<div class="sect4">
<h5 id="meta-architecture.asciidoc_notes-about-quasar-client">Notes about Quasar Client</h5>
<div class="paragraph">
<p>The Quasar client architecture as the consolidated knowledge of our CSD projects is the major source for the above drafted architecture. However, the above is a much simplified and more agile version thereof:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Quasar Client tried to abstract from the concrete UI library being used, so it could decouple the business from the technical logic of a dialog. The presentation layer should be the only one knowing the concrete UI framework used. This level of abstraction was dropped in this reference architecture, although it might of course still make sense in some projects. For fast-moving agile projects in the web however introducing such a level of abstraction takes effort with little gained benefits. With frameworks like Angular 2 we would even introduce one additional seemingly artificial and redundant layer, since it already separates the dialog core from its presentation.</p>
</li>
<li>
<p>In the past and in the days of Struts, JSF, etc. the concept of session handling was important for the client since part of the client was sitting on a server with a session relating it to its remote counterpart on the users PC. Quasar Client catered for this need, by very prominently differentiating between session and application in the root of the dialog component hierarchy. However, in the current days of SPA applications and the lowered importance of servers-side web clients, this prominent differentiation was dropped. When still needed the referenced documents will provide in more detail how to tailor the respective architecture to this end.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="meta-architecture.asciidoc_references">15.2.4. References</h4>
<div class="ulist">
<ul>
<li>
<p>Architecture Guidelines for Application Design:
<a href="https://troom.capgemini.com/sites/vcc/engineering/Cross%20Cutting/ArchitectureGuide/Architecture_Guidelines_for_Application_Design_v2.0.docx" class="bare">https://troom.capgemini.com/sites/vcc/engineering/Cross%20Cutting/ArchitectureGuide/Architecture_Guidelines_for_Application_Design_v2.0.docx</a></p>
</li>
<li>
<p>Quasar Client Architekturen:
<a href="https://troom.capgemini.com/sites/vcc/Shared%20Documents/CrossCuttingContent/TopicOrientedCCC/QuasarOverview/NCE%20Quasar%20Review%20Workshop%202009-11-17/Quasar%20Development/Quasar-Client-Architectures.doc" class="bare">https://troom.capgemini.com/sites/vcc/Shared%20Documents/CrossCuttingContent/TopicOrientedCCC/QuasarOverview/NCE%20Quasar%20Review%20Workshop%202009-11-17/Quasar%20Development/Quasar-Client-Architectures.doc</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="master-devon4ng.asciidoc_layers">16. Layers</h2>
<div class="sectionbody">
<!-- toc disabled -->
<div class="sect2">
<h3 id="components-layer.asciidoc">16.1. Components Layer</h3>
<div class="paragraph">
<p>The components layer encapsulates all components presenting the current application view state, which means data to be shown to the user.
The term component refers to a component described by the standard <a href="https://www.w3.org/standards/techs/components">Web Components</a>.
So this layer has all Angular components, directives and pipes defined for an application.
The main challenges are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>how to structure the components layer (see <a href="#guide-file-structure.asciidoc">File Structure Guide</a>)</p>
</li>
<li>
<p>decompose components into maintainable chunks (see <a href="#guide-component-decomposition.asciidoc">Component Decomposition Guide</a>)</p>
</li>
<li>
<p>handle component interaction</p>
</li>
<li>
<p>manage calls to the services layer</p>
</li>
<li>
<p>apply a maintainable data and eventflow throughout the component tree</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="components-layer.asciidoc_smart-and-dumb-components">16.1.1. Smart and Dumb Components</h4>
<div class="paragraph">
<p>The architecture applies the concept of <em>Smart</em> and <em>Dumb Components</em> (syn. <em>Containers</em> and <em>Presenters</em>).
The concept means that components are devided into <em>Smart</em> and <em>Dumb Components</em>.</p>
</div>
<div class="paragraph">
<p>A <em>Smart Component</em> typically is a toplevel dialog inside the component tree.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>a component, that can be routed to</p>
</li>
<li>
<p>a modal dialog</p>
</li>
<li>
<p>a component, which is placed inside <code>AppComponent</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>A <em>Dumb Component</em> can be used by one to many <em>Smart Components</em>.
Inside the component tree a <em>Dumb Component</em> is a child of a <em>Smart Component</em>.</p>
</div>
<div class="imageblock text-center">
<div class="content">
<a class="image" href="images/component-tree.svg"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/component-tree.svg" alt="Component Tree" width="450"></a>
</div>
<div class="title">Figure 7. Component tree example</div>
</div>
<div class="paragraph">
<p>As shown the topmost component is always the <code>AppComponent</code> in Angular applications.
The component tree describes the hierarchy of components starting from <code>AppComponent</code>.
The figure shows <em>Smart Components</em> in blue and <em>Dumb Components</em> in green.
<code>AppComponent</code> is a <em>Smart Component</em> by definition.
Inside the template of <code>AppComponent</code> placed components are static components inside the component tree.
So they are always displayed.
In the example <code>OverviewComponent</code> and <code>DetailsComponent</code> are rendered by Angular compiler depending on current URL the application displays.
So <code>OverviewComponents</code> subtree is displayed if the URL is <code>/overview</code> and <code>DetailsComponents</code> subtree is displayed if the URL is <code>/details</code>.
To clarify this distinction further the following table shows the main differences.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 19. Smart vs Dumb Components</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><em>Smart Components</em></th>
<th class="tableblock halign-left valign-top"><em>Dumb Components</em></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">contain the current view state</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">show data via binding (<code>@Input</code>) and contain no view state</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">handle events emited by <em>Dumb Components</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">pass events up the component tree to be handled by <em>Smart Components</em> (<code>@Output</code>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">call the services layer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">never call the services layer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">use services</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">do not use services</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">consists of n <em>Dumb Components</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">is independent of <em>Smart Components</em></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="components-layer.asciidoc_interaction-of-smart-and-dumb-components">16.1.2. Interaction of Smart and Dumb Components</h4>
<div class="paragraph">
<p>With the usage of the <em>Smart</em> and <em>Dumb Components</em> pattern one of the most important part is component interaction.
Angular comes with built in support for component interaction with <code>@Input()</code> and <code>@Output()</code> Decorators.
The following figure illustrates an unidirectional data flow.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Data always goes down the component tree - from a <em>Smart Component</em> down its children.</p>
</li>
<li>
<p>Events bubble up, to be handled by a <em>Smart Component</em>.</p>
</li>
</ul>
</div>
<div class="imageblock text-center">
<div class="content">
<a class="image" href="images/smart-dumb-components-interaction.svg"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/smart-dumb-components-interaction.svg" alt="Smart and Dumb Components Interaction" width="450"></a>
</div>
<div class="title">Figure 8. Smart and Dumb Component Interaction</div>
</div>
<div class="paragraph">
<p>As shown a <em>Dumb Components</em> role is to define a signature by declaring Input and Output Bindings.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>@Input()</code> defines what data is necessary for that component to work</p>
</li>
<li>
<p><code>@Output()</code> defines which events can be listened on by the parent component</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Listing 5. Dumb Components define a signature</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-ts hljs" data-lang="ts">export class ValuePickerComponent {

  @Input() columns: string[];
  @Input() items: {}[];
  @Input() selected: {};
  @Input() filter: string;
  @Input() isChunked = false;
  @Input() showInput = true;
  @Input() showDropdownHeader = true;

  @Output() elementSelected = new EventEmitter&lt;{}&gt;();
  @Output() filterChanged = new EventEmitter&lt;string&gt;();
  @Output() loadNextChunk = new EventEmitter();
  @Output() escapeKeyPressed = new EventEmitter();

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The example shows the <em>Dumb Component</em> <code>ValuePickerComponent</code>.
It describes seven input bindings with <code>isChunked</code>, <code>showHeader</code> and <code>showDropdownHeader</code> being non mandatory as they have a default value.
Four output bindings are present. Typically, a <em>Dumb Component</em> has very little code to no code inside the TypeScript class.</p>
</div>
<div class="listingblock">
<div class="title">Listing 6. Smart Components use the Dumb Components signature inside the template</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-html hljs" data-lang="html">&lt;div&gt;

  &lt;value-input
    ...&gt;
  &lt;/value-input&gt;

  &lt;value-picker
    *ngIf="isValuePickerOpen"
    [columns]="columns"
    [items]="filteredItems"
    [isChunked]="isChunked"
    [filter]="filter"
    [selected]="selectedItem"
    [showDropdownHeader]="showDropdownHeader"
    (loadNextChunk)="onLoadNextChunk()"
    (elementSelected)="onElementSelected($event)"
    (filterChanged)="onFilterChanged($event)"
    (escapeKeyPressed)="onEscapePressedInsideChildTable()"&gt;
  &lt;/value-picker&gt;

&lt;/div&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Inside the <em>Smart Components</em> template the events emitted by <em>Dumb Components</em> are handled.
It is a good practice to name the handlers with the prefix <code>on*</code> (e.g. <code>onInputChanged()</code>).</p>
</div>
<!-- toc disabled -->
</div>
</div>
<div class="sect2">
<h3 id="services-layer.asciidoc">16.2. Services Layer</h3>
<div class="paragraph">
<p>The services layer is more or less what we call 'business logic layer' on the server side.
It is the layer where the business logic is placed.
The main challenges are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Define application state and an API for the components layer to use it</p>
</li>
<li>
<p>Handle application state transitions</p>
</li>
<li>
<p>Perform backend interaction (XHR, WebSocket, etc.)</p>
</li>
<li>
<p>Handle business logic in a maintainable way</p>
</li>
<li>
<p>Configuration management</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>All parts of the services layer are described in this chapter.
An example which puts the concepts together can be found at the end <a href="#services-layer.asciidoc_interaction-of-smart-components-through-the-services-layer">Interaction of Smart Components through the services layer</a>.</p>
</div>
<div class="sect3">
<h4 id="services-layer.asciidoc_boundaries">16.2.1. Boundaries</h4>
<div class="paragraph">
<p>There are two APIs for the components layer to interact with the services layer:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A store can be subscribed to for receiving state updates over time</p>
</li>
<li>
<p>A use case service can be called to trigger an action</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To illustrate the fact the follwing figure shows an abstract overview.</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/components-layer-service-layer-boundaries.svg"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/components-layer-service-layer-boundaries.svg" alt="Smart and Dumb Components Interaction" width="450"></a>
</div>
<div class="title">Figure 9. Boundaries to components layer</div>
</div>
</div>
<div class="sect3">
<h4 id="services-layer.asciidoc_store">16.2.2. Store</h4>
<div class="paragraph">
<p>A store is a class which defines and handles application state with its transitions over time.
Interaction with a store is always synchronous.
A basic implementation using <code>rxjs</code> can look like this.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
A more profound implementation taken from a real-life project can be found here (<a href="#cookbook-abstract-class-store.asciidoc">Abstract Class Store</a>).
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Listing 7. Store defined using rxjs</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-ts hljs" data-lang="ts">@Injectable()
export class ProductSearchStore {

  private stateSource = new BehaviorSubject&lt;ProductSearchState&gt;(defaultProductSearchState);
  state$ = this.stateSource.asObservable();

  setLoading(isLoading: boolean) {
    const currentState = this.stateSource.getValue();
    this.stateSource.next({
      isLoading: isLoading,
      products: currentState.products,
      searchCriteria: currentState.searchCriteria
    });
  }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the example <code>ProductSearchStore</code> handles state of type <code>ProductSearchState</code>.
The public API is the property <code>state$</code> which is an observable of type <code>ProductSearchState</code>.
The state can be changed with method calls.
So every desired change to the state needs to be modeled with an method.
In reactive terminology this would be an <em>Action</em>.
The store does not use any services.
Subscribing to the <code>state$</code> observable leads to the subscribers receiving every new state.</p>
</div>
<div class="paragraph">
<p>This is basically the <em>Observer Pattern</em>:<br>
The store consumer registeres itself to the observable via <code>state$.subscribe()</code> method call.
The first parameter of <code>subscribe()</code> is a callback function to be called when the subject changes.
This way the consumer - the observer - is registered.
When next() is called with a new state inside the store, all callback functions are called with the new value.
So every observer is notified of the state change.
This equals the <em>Observer Pattern</em> push type.</p>
</div>
<div class="paragraph">
<p>A store is the API for <em>Smart Components</em> to receive state from the service layer.
State transitions are handled automatically with <em>Smart Components</em> registering to the <code>state$</code> observable.</p>
</div>
</div>
<div class="sect3">
<h4 id="services-layer.asciidoc_use-case-service">16.2.3. Use Case Service</h4>
<div class="paragraph">
<p>A use case service is a service which has methods to perform asynchronous state transitions.
In reactive terminology this would be an <em>Action of Actions</em> - a thunk (<code>redux</code>) or an effect (<code>@ngrx</code>).</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/use-case-service.svg"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/use-case-service.svg" alt="Use Case Service" width="450"></a>
</div>
<div class="title">Figure 10. Use case services are the main API to trigger state transitions</div>
</div>
<div class="paragraph">
<p>A use case services method - an action - interacts with adapters, business services and stores.
So use case services orchestrate whole use cases.
For an example see <a href="#usecaseservice-example">use case service example</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="services-layer.asciidoc_adapter">16.2.4. Adapter</h4>
<div class="paragraph">
<p>An adapter is used to communicate with the backend.
This could be a simple XHR request, a WebSocket connection, etc.
An adapter is simple in the way that it does not add anything other than the pure network call.
So there is no caching or logging performed here.
The following listing shows an example.</p>
</div>
<div class="paragraph">
<p>For further information on backend interaction see <a href="#guide-consuming-rest-services.asciidoc">Consuming REST Services</a></p>
</div>
<div class="listingblock">
<div class="title">Listing 8. Calling the backend via an adapter</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-ts hljs" data-lang="ts">@Injectable()
export class ProducsAdapter {

  private baseUrl = environment.baseUrl;

  constructor(private http: HttpClient) { }

  getAll(): Observable&lt;Product[]&gt; {
    return this.http.get&lt;Product[]&gt;(this.baseUrl + '/products');
  }

}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="services-layer.asciidoc_interaction-of-smart-components-through-the-services-layer">16.2.5. Interaction of Smart Components through the services layer</h4>
<div class="paragraph">
<p>The interaction of smart components is a classic problem which has to be solved in every UI technology.
It is basically how one dialog tells the other something has changed.</p>
</div>
<div class="paragraph">
<p>An example is <em>adding an item to the shopping basket</em>.
With this action there need to be multiple state updates.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The small logo showing how many items are currently inside the basket needs to be updated from 0 to 1</p>
</li>
<li>
<p>The price needs to be recalculated</p>
</li>
<li>
<p>Shipping costs need to be checked</p>
</li>
<li>
<p>Discounts need to be updated</p>
</li>
<li>
<p>Ads need to be updated with related products</p>
</li>
<li>
<p>etc.</p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="services-layer.asciidoc_pattern">Pattern</h5>
<div class="paragraph">
<p>To handle this interaction in a scalable way we apply the following pattern.</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/smart-component-interaction-via-services-layer.svg"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/smart-component-interaction-via-services-layer.svg" alt="Interaction of Smart Components via services layer" width="450"></a>
</div>
<div class="title">Figure 11. Smart Component interaction</div>
</div>
<div class="paragraph">
<p>The state of interest is encapsualted inside a store. All <em>Smart Components</em> interested in the state have to subscibe to the store&#8217;s API served by the public observable. Thus, with every update to the store the subscribed components receive the new value. The components basically react to state changes. Altering a store can be done directly if the desired change is synchronous. Most actions are of asynchronous nature so the <code>UseCaseService</code> comes into play. Its actions are <code>void</code> methods, which implement a use case, i.e., adding a new item to the basket. It calls asynchronous actions and can perform multiple store updates over time.</p>
</div>
<div class="paragraph">
<p>To put this pattern into perspective the <code>UseCaseService</code> is a programmatic alternative to <code>redux-thunk</code> or <code>@ngrx/effects</code>. The main motivation here is to use the full power of TypeScript&#8217;s <code>--strictNullChecks</code> and to let the learning curve not to become as steep as it would be when learning a new state management framework. This way actions are just <code>void</code> method calls.</p>
</div>
</div>
<div class="sect4">
<h5 id="services-layer.asciidoc_example">Example</h5>
<div class="imageblock">
<div class="content">
<a class="image" href="images/smart-smart-components-example.svg"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/smart-smart-components-example.svg" alt="Smart component interaction example" width="450"></a>
</div>
<div class="title">Figure 12. Smart Components interaction example</div>
</div>
<div class="paragraph">
<p>The example shows two <em>Smart Components</em> sharing the <code>FlightSearchState</code> by using the <code>FlightSearchStore</code>.
The use case shown is started by an event in the <em>Smart Component</em> <code>FlightSearchComponent</code>. The action <code>loadFlight()</code> is called. This could be submitting a search form.
The UseCaseService is <code>FlightSearchService</code>, which handles the use case <em>Load Flights</em>.</p>
</div>
<div class="paragraph">
<div class="title">UseCaseService example</div>
<p><a id="usecaseservice-example"></a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-ts hljs" data-lang="ts">export class FlightSearchService {

  constructor(
    private flightSearchAdapter: FlightSearchAdapter,
    private store: FlightSearchStore
  ) { }

  loadFlights(criteria: FlightSearchCriteria): void {
    this.store.setLoadingFlights(true);
    this.store.clearFlights();

    this.flightSearchAdapter.getFlights(criteria.departureDate,
        {
          from: criteria.departureAirport,
          to: criteria.destinationAirport
        })
      .finally(() =&gt; this.store.setLoadingFlights(false))
      .subscribe((result: FlightTo[]) =&gt; this.store.setFlights(result, criteria));
  }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>First the loading flag is set to <code>true</code> and the current flights are cleared. This leads the <em>Smart Component</em> showing a spinner indicating the loading action. Then the asynchronous XHR is triggert by calling the adapter. After completion the loading flag is set to <code>false</code> causing the loading indication no longer to be shown. If the XHR was successful, the data would be put into the store. If the XHR was not successful, this would be the place to handle a custom error. All general network issues should be handled in a dedicated class, i.e., an interceptor. So for example the basic handling of 404 errors is not done here.</p>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="master-devon4ng.asciidoc_guides">17. Guides</h2>
<div class="sectionbody">
<!-- toc disabled -->
<div class="sect2">
<h3 id="guide-package-managers.asciidoc">17.1. Package Managers</h3>
<div class="paragraph">
<p>There are two major package managers currently used for JavaScript / TypeScript projects which leverage node.js as a build platform.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="https://www.npmjs.com/">npm</a></p>
</li>
<li>
<p><a href="https://yarnpkg.com">yarn</a></p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Our recommendation is to use yarn but both package managers are fine.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
When using npm it is important to use a version greater 5.0 as npm 3 has major drawbacks compared to yarn.
The following guide assumes that you are using npm &gt;= 5 or yarn.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Before you start reading further, please take a look at the docs:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://yarnpkg.com/en/docs/getting-started">yarn getting started</a></p>
</li>
<li>
<p><a href="https://docs.npmjs.com/getting-started/what-is-npm">npm getting started</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following guide will describe best practices for working with yarn / npm.</p>
</div>
<div class="sect3">
<h4 id="guide-package-managers.asciidoc_semantic-versioning">17.1.1. Semantic Versioning</h4>
<div class="paragraph">
<p>When working with package managers it is very important to understand the concept of <a href="https://semver.org/">semantic versioning</a>.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 20. Version example 1.2.3</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-right valign-top">Version</th>
<th class="tableblock halign-center valign-top">1.</th>
<th class="tableblock halign-center valign-top">2.</th>
<th class="tableblock halign-center valign-top">3</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock">Version name when incrementing</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">Major (2.0.0)</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">Minor (1.3.0)</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">Patch (1.2.4)</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock">Has breaking changes</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">yes</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock">Has features</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">yes</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">yes</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock">Has bugfixes</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">yes</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">yes</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">yes</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The table gives an overview of the most important parts of semantic versioning.
In the header version 1.2.3 is displayed.
The first row shows the name and the resulting version when incrementing a part of the version.
The next rows show specifics of the resulting version - e.g. a major version can have breaking changes, features and bugfixes.</p>
</div>
<div class="paragraph">
<p>Packages from npm and yarn leverage semantic versioning and instead of selecting a fixed version one can specify a selector.
The most common selectors are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>^1.2.3</strong>
At least 1.2.3 - 1.2.4 or 1.3.0 can be used, 2.0.0 can not be used</p>
</li>
<li>
<p><strong>~1.2.3</strong>
At lease 1.2.3 - 1.2.4 can be used, 2.0.0 and 1.3.0 can not be used</p>
</li>
<li>
<p><strong>&gt;=1.2.3</strong>
At least 1.2.3 - every version greater can also be used</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This achieves a lower number of duplicates.
To give an example:</p>
</div>
<div class="paragraph">
<p>If package A needs version 1.3.0 of package C and package B needs version 1.4.0 of package C one would end up with 4 packages.</p>
</div>
<div class="paragraph">
<p>If package A needs version ^1.3.0 of package C and package B needs version 1.4.0 of package C one would end up with 3 packages.
A would use the same version of C as B - 1.4.0.</p>
</div>
</div>
<div class="sect3">
<h4 id="guide-package-managers.asciidoc_do-not-modify-package.json-and-lock-files-by-hand">17.1.2. Do not modify package.json and lock files by hand</h4>
<div class="paragraph">
<p>Dependencies are always added using a yarn or npm command.
Altering the package.json, package-json.lock or yarn.lock file by hand is not recommended.</p>
</div>
<div class="paragraph">
<p>Always use a yarn or npm command to add a new dependency.</p>
</div>
<div class="paragraph">
<p>Adding the package <code>express</code> with yarn to dependencies.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">yarn add express</code></pre>
</div>
</div>
<div class="paragraph">
<p>Adding the package <code>express</code> with npm to dependencies.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">npm install express</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="guide-package-managers.asciidoc_what-does-the-lock-file-do">17.1.3. What does the lock file do</h4>
<div class="paragraph">
<p>The purpose of files <code>yarn.lock</code> and <code>package-json.lock</code> is to freeze versions for a short time.</p>
</div>
<div class="paragraph">
<p>The following problem is solved:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Developer A upgrades the dependency <code>express</code> to fixed version <code>4.16.3</code>.</p>
</li>
<li>
<p><code>express</code> has sub-dependency <code>accepts</code> with version selector <code>~1.3.5</code></p>
</li>
<li>
<p>His local <code>node_modules</code> folder receives <code>accepts</code> in version <code>1.3.5</code></p>
</li>
<li>
<p>On his machine everything is working fine</p>
</li>
<li>
<p>Afterward version <code>1.3.6</code> of <code>accepts</code> is published - it contains a major bug</p>
</li>
<li>
<p>Developer B now clones the repo and loads the dependencies.</p>
</li>
<li>
<p>He receives version <code>1.3.6</code> of <code>accepts</code> and blames developer A for upgrading to a broken version.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Both <code>yarn.lock</code> and <code>package-json.lock</code> freeze all the dependencies.
For example in yarn lock you will find.</p>
</div>
<div class="listingblock">
<div class="title">Listing 9. yarn.lock example (excerp)</div>
<div class="content">
<pre class="highlightjs highlight"><code>accepts@~1.3.5:
  version "1.3.5"
  resolved "[...URL to registry]"
  dependencies:
    mime-types "~2.1.18"
    negotiator "0.6.1"

mime-db@~1.33.0:
  version "1.33.0"
  resolved "[...URL to registry]"

mime-types@~2.1.18:
  version "2.1.18"
  resolved "[...URL to registry]"
  dependencies:
    mime-db "~1.33.0"

negotiator@0.6.1:
  version "0.6.1"
  resolved "[...URL to registry]"</code></pre>
</div>
</div>
<div class="paragraph">
<p>The described problem is solved by the example yarn.lock file.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>accepts</code> is frozen at version <code>~1.3.5</code></p>
</li>
<li>
<p>All of its sub-dependencies are also frozen.
It needs <code>mime-types</code> at version <code>~2.1.18</code> which is frozen at <code>2.1.18</code>.
<code>mime-types</code> needs <code>mime-db</code> at <code>~1.33.0</code> which is frozen at <code>1.33.0</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Every developer will receive the same versions of every dependency.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
You have to make sure all your developers are using the same npm/yarn version - this includes the CI build.
</td>
</tr>
</table>
</div>
<!-- toc disabled -->
</div>
</div>
<div class="sect2">
<h3 id="guide-npm-yarn-workflow.asciidoc">17.2. Package Managers Workflow</h3>
<div class="sect3">
<h4 id="guide-npm-yarn-workflow.asciidoc_introduction">17.2.1. Introduction</h4>
<div class="paragraph">
<p>This document aims to provide you the necessary documentation and sources in order to help you understand the importance of dependencies between packages.</p>
</div>
<div class="paragraph">
<p>Projects in node.js make use of modules, chunks of reusable code made by other people or teams. These small chunks of reusable code are called packages <sup class="footnote">[<a id="_footnoteref_2" class="footnote" href="#_footnotedef_2" title="View footnote.">2</a>]</sup>. Packages are used to solve specific problems or tasks. These relations between your project and the external packages are called dependencies.</p>
</div>
<div class="paragraph">
<p>For example, imagine we are doing a small program that takes your birthday as an input and tells you how many days are left until your birthday. We search in the repository if someone has published a package to retrieve the actual date and manage date types, and maybe we could search for another package to show a calendar, because we want to optimize our time, and we wish the user to click a calendar button and choose the day in the calendar instead of typing it.</p>
</div>
<div class="paragraph">
<p>As you can see, packages are convenient. In some cases, they may be even needed, as they can manage aspects of your program you may not be proficient in, or provide an easier use of them.</p>
</div>
<div class="paragraph">
<p>For more comprehensive information visit <a href="https://docs.npmjs.com/getting-started/what-is-npm">npm definition</a></p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="sect4">
<h5 id="guide-npm-yarn-workflow.asciidoc_package.json">Package.json</h5>
<div class="paragraph">
<p>Dependencies in your project are stored in a file called package.json. Every package.json must contain, at least, the name and version of your project.</p>
</div>
<div class="paragraph">
<p>Package.json is located in the root of your project.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
If package.json is not on your root directory refer to <a href="#guide-npm-yarn-workflow.asciidoc_problems-you-may-encounter">Problems you may encounter</a> section
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If you wish to learn more information about package.json, click on the following links:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://yarnpkg.com/en/docs/package-json">Yarn Package.json</a></p>
</li>
<li>
<p><a href="https://docs.npmjs.com/getting-started/using-a-package.json">npm Package.json</a></p>
</li>
</ul>
</div>
<div class="sect5">
<h6 id="guide-npm-yarn-workflow.asciidoc_content-of-package.json">Content of package.json</h6>
<div class="paragraph">
<p>As you noticed, package.json is a really important file in your project. It contains essential information about our project, therefore you need to understand what&#8217;s inside.</p>
</div>
<div class="paragraph">
<p>The structure of package.json is divided in blocks, inside the first one you can find essential information of your project such as the name, version, license and optionally some <a href="#guide-npm-yarn-workflow.asciidoc_scripts">Scripts</a>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "name": "exampleproject",
  "version": "0.0.0",
  "license": "MIT",
  "scripts": {
    "ng": "ng",
    "start": "ng serve",
    "build": "ng build",
    "test": "ng test",
    "lint": "ng lint",
    "e2e": "ng e2e"
  }</code></pre>
</div>
</div>
<div class="paragraph">
<p>The next block is called <em>dependencies</em> and contains the packages that project needs in order to be developed, compiled and executed.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">"private": true,
  "dependencies": {
    "@angular/animations": "^4.2.4",
    "@angular/common": "^4.2.4",
    "@angular/forms": "^4.2.4",
    ...
    "zone.js": "^0.8.14"
  }</code></pre>
</div>
</div>
<div class="paragraph">
<p>After <em>dependencies</em> we find <strong><em>devDependencies</em></strong>, another kind of dependencies present in the development of the application but unnecessary for its execution. One example is typescript. Code is written in typescript, and then, <em>transpiled</em> to javascript. This means the application is not using typescript in execution and consequently not included in the deployment of our application.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">"devDependencies": {
    "@angular/cli": "1.4.9",
    "@angular/compiler-cli": "^4.2.4",
    ...
    "@types/node": "~6.0.60",
    "typescript": "~2.3.3"
  }</code></pre>
</div>
</div>
<div class="paragraph">
<p>Having a peer dependency means that your package needs a dependency that is the same exact dependency as the person installing your package</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">"peerDependencies": {
    "package-123": "^2.7.18"
  }</code></pre>
</div>
</div>
<div class="paragraph">
<p>Optional dependencies are just that: optional. If they fail to install, Yarn will still say the install process was successful.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">"optionalDependencies": {
    "package-321": "^2.7.18"
  }</code></pre>
</div>
</div>
<div class="paragraph">
<p>Finally you can have bundled dependencies which are packages bundled together when publishing your package in a repository.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "bundledDependencies": [
    "package-4"
  ]
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here is the link to an in-depth explanation of <a href="https://yarnpkg.com/en/docs/dependency-types">dependency types</a>&#8203;.</p>
</div>
</div>
<div class="sect5">
<h6 id="guide-npm-yarn-workflow.asciidoc_scripts">Scripts</h6>
<div class="paragraph">
<p>Scripts are a great way of automating tasks related to your package, such as simple build processes or development tools.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "name": "exampleproject",
  "version": "0.0.0",
  "license": "MIT",
  "scripts": {
    "build-project": "node hello-world.js",
  }</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can run that script by running the command <code>yarn (run) script</code> or <code>npm run script</code>, check the example below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ yarn (run) build-project    # run is optional
$ npm run build-project</code></pre>
</div>
</div>
<div class="paragraph">
<p>There are special reserved words for scripts, like preinstall, which will execute the script automatically
before the package you install are installed.</p>
</div>
<div class="paragraph">
<p>Chech different uses for scripts in the following links:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://yarnpkg.com/en/docs/package-json#toc-scripts">Yarn scripts documentation</a></p>
</li>
<li>
<p><a href="https://docs.npmjs.com/misc/scripts">npm scripts documentation</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Or you can go back to
<a href="#guide-npm-yarn-workflow.asciidoc_content-of-package.json">Content of package.json</a>&#8203;.<br></p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="guide-npm-yarn-workflow.asciidoc_managing-dependencies">Managing dependencies</h5>
<div class="paragraph">
<p>In order to manage dependencies we recommend using package managers in your projects.</p>
</div>
<div class="paragraph">
<p>A big reason is their usability. Adding or removing a package is really easy, and by doing so, packet manager update the package.json and copies (or removes) the package in the needed location, with a single comand.</p>
</div>
<div class="paragraph">
<p>Another reason, closely related to the first one, is reducing human error by automating the package management process.</p>
</div>
<div class="paragraph">
<p>Two of the package managers you can use in node.js projects are "yarn" and "npm". While you can use both, we encourage you to use only one of them while working on projects. Using both may lead to different dependencies between members of the team.</p>
</div>
<div class="sect5">
<h6 id="guide-npm-yarn-workflow.asciidoc_npm">npm</h6>
<div class="paragraph">
<p>We&#8217;ll start by installing npm following this small guide <a href="https://docs.npmjs.com/getting-started/installing-node">here</a>.</p>
</div>
<div class="paragraph">
<p>As stated on the web, npm comes inside of node.js, and must be updated after installing node.js, in the same guide you used earlier are written the instructions to update npm.</p>
</div>
<div class="paragraph">
<p><strong>How npm works</strong></p>
</div>
<div class="paragraph">
<p>In order to explain how npms works, let&#8217;s take a command as an example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ npm install @angular/material @angular/cdk</code></pre>
</div>
</div>
<div class="paragraph">
<p>This command tells npm to look for the packages @angular/material and @angular/cdk in the npm registry, download and decompress them in the folder node_modules along with their own dependencies. Additionally, npm will update package.json and create a new file called package-lock.json.</p>
</div>
<div class="paragraph">
<p>After initializating and installing the first package there will be a new folder called node_modules in your project. This folder is where your packages are unzipped and stored, following a tree scheme.</p>
</div>
<div class="paragraph">
<p>Take in consideration both npm and yarn need a package.json in the root of your project in order to work properly. If after creating your project don&#8217;t have it, download again the package.json from the repository or you&#8217;ll have to start again.</p>
</div>
<div class="paragraph">
<p><strong>Brief overview of commands</strong></p>
</div>
<div class="paragraph">
<p>If we need to create a package.json from scratch, we can use the comand <strong>init</strong>. This command asks the user for basic information about the project and creates a brand new package.json.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ npm init</code></pre>
</div>
</div>
<div class="paragraph">
<p>Install (or i) installs all modules listed as dependencies in package.json <strong>locally</strong>. You can also specify a package, and install that package. Install can also be used with the parameter <code>-g</code>, which tells npm to install the <a href="#guide-npm-yarn-workflow.asciidoc_global-package">Global package</a>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ npm install
$ npm i
$ npm install Package</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Earlier versions of npm did <strong>not</strong> add dependencies to package.json unless it was used with the flag <code>--save</code>, so npm install package would be npm install <code>--save</code> package, you have one example below.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ npm install --save Package</code></pre>
</div>
</div>
<div class="paragraph">
<p>Npm needs flags in order to know what kind of dependency you want in your project, in npm you need to put the flag <code>-D</code> or <code>--save-dev</code> to install devdependencies, for more information consult the links at the end of this section.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ npm install -D package
$ npm install --save-dev package</code></pre>
</div>
</div>
<div class="paragraph">
<p>&#8203;</p>
</div>
<div class="paragraph">
<p>The next command uninstalls the module you specified in the command.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ npm uninstall Package</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>ls</code> command shows us the dependencies like a nested tree, useful if you have few packages, not so useful when you need a lot of packages.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ npm ls</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>npm@@VERSION@ /path/to/npm
└─┬ init-package-json@0.0.4
  └── promzard@0.1.5</pre>
</div>
</div>
<div class="paragraph">
<div class="title">example tree</div>
<p>We recommend you to learn more about npm commands in the following <a href="https://docs.npmjs.com/">link</a>, navigating to the section cli commands.</p>
</div>
<div class="paragraph">
<p><strong>About Package-lock.json</strong></p>
</div>
<div class="paragraph">
<p>Package-lock.json describes the dependency tree resulting of using package.json and npm.
Whenever you update, add or remove a package, package-lock.json is deleted and redone with
the new dependencies.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json"> "@angular/animations": {
      "version": "4.4.6",
      "resolved": "https://registry.npmjs.org/@angular/animations/-/animations-4.4.6.tgz",
      "integrity": "sha1-+mYYmaik44y3xYPHpcl85l1ZKjU=",
      "requires": {
        "tslib": "1.8.0"
      }</code></pre>
</div>
</div>
<div class="paragraph">
<p>This lock file is checked everytime the command npm i (or npm install) is used without specifying a package,
in the case it exists and it&#8217;s valid, npm will install the exact tree that was generated, such that subsequent
installs are able to generate identical dependency trees.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
It is <strong>not</strong> recommended to modify this file yourself. It&#8217;s better to leave its management to npm.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>More information is provided by the npm team at <a href="https://docs.npmjs.com/files/package-lock.json">package-lock.json</a></p>
</div>
</div>
<div class="sect5">
<h6 id="guide-npm-yarn-workflow.asciidoc_yarn">Yarn</h6>
<div class="paragraph">
<p>Yarn is an alternative to npm, if you wish to install yarn follow the guide <a href="https://yarnpkg.com/en/docs/install">getting started with yarn</a> and download the correct version for your operative system. Node.js is also needed you can find it <a href="https://nodejs.org/en/">here</a>.</p>
</div>
<div class="paragraph">
<p><strong>Working with yarn</strong></p>
</div>
<div class="paragraph">
<p>Yarn is used like npm, with small differences in syntax, for example <em>npm install module</em> is changed to <em>yarn add module</em>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ yarn add @covalent</code></pre>
</div>
</div>
<div class="paragraph">
<p>This command is going to download the required packages, modify package.json, put the package in the folder node_modules and makes a new yarn.lock with the new dependency.</p>
</div>
<div class="paragraph">
<p>However, unlike npm, yarn maintains a cache with packages you download inside. You don&#8217;t need to download every file every time you do a general installation. This means installations faster than npm.</p>
</div>
<div class="paragraph">
<p>Similarly to npm, yarn creates and maintains his own lock file, called yarn.lock. Yarn.lock gives enough information about the project for dependency tree to be reproduced.</p>
</div>
<div class="paragraph">
<p><strong>yarn commands</strong></p>
</div>
<div class="paragraph">
<p>Here we have a brief description of yarn&#8217;s most used commands:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ yarn add Package
$ yarn add --dev Package</code></pre>
</div>
</div>
<div class="paragraph">
<p>Adds a package <strong>locally</strong> to use in your package. Adding the flags <code>--dev</code> or <code>-D</code> will add them to devDependencies instead of the default dependencies, if you need more information check the links at the end of the section.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ yarn init</code></pre>
</div>
</div>
<div class="paragraph">
<p>Initializes the development of a package.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ yarn install</code></pre>
</div>
</div>
<div class="paragraph">
<p>Installs all the dependencies defined in a package.json file, you can also write "yarn" to achieve the same effect.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ yarn remove Package</code></pre>
</div>
</div>
<div class="paragraph">
<p>You use it when you wish to remove a package from your project.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ yarn global add Package</code></pre>
</div>
</div>
<div class="paragraph">
<p>Installs the <a href="#guide-npm-yarn-workflow.asciidoc_global-package">Global package</a>.</p>
</div>
<div class="paragraph">
<p>Please, refer to the documentation to learn more about yarn commands and their attributes: <a href="https://yarnpkg.com/en/docs/cli/">yarn commands</a></p>
</div>
<div class="paragraph">
<p><strong>yarn.lock</strong></p>
</div>
<div class="paragraph">
<p>This file has the same purpose as Package-lock.json, to guide the packet manager, in this case yarn,
to install the dependency tree specified in yarn.lock.</p>
</div>
<div class="paragraph">
<p>Yarn.lock and package.json are
essential files when collaborating in a project more co-workers and may be a
source of errors if programmers do not use the same manager.</p>
</div>
<div class="paragraph">
<p>Yarn.lock follows the same structure as package-lock.json, you can find an example of dependency below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">"@angular/animations@^4.2.4":
  version "4.4.6"
  resolved "https://registry.yarnpkg.com/@angular/animations/-/animations-4.4.6.tgz#fa661899a8a4e38cb7c583c7a5c97ce65d592a35"
  dependencies:
    tslib "^1.7.1"</code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
As with package-lock.json, it&#8217;s strongly <strong>not</strong> adviced to modify this file. Leave its management to yarn
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You can learn more about yarn.lock here: <a href="https://yarnpkg.com/en/docs/yarn-lock">yarn.lock</a></p>
</div>
</div>
<div class="sect5">
<h6 id="guide-npm-yarn-workflow.asciidoc_global-package">Global package</h6>
<div class="paragraph">
<p>Global packages are packages installed in your operative system instead of your local project,
global packages useful for developer tooling that is not part of any individual project but instead is used for local commands.</p>
</div>
<div class="paragraph">
<p>A good example of global package is angular/cli, a command line interface for angular used in our projects. You can install
a global package in npm with "npm install -g package" and "yarn global add package" with yarn, you have a npm example below:</p>
</div>
<div class="listingblock">
<div class="title">Listing 10. npm global package</div>
<div class="content">
<pre>npm install –g @angular/cli</pre>
</div>
</div>
<div class="paragraph">
<p><a href="https://docs.npmjs.com/getting-started/installing-npm-packages-globally">Global npm</a><br>
<a href="https://yarnpkg.com/lang/en/docs/cli/global/">Global yarn</a></p>
</div>
</div>
<div class="sect5">
<h6 id="guide-npm-yarn-workflow.asciidoc_package-version">Package version</h6>
<div class="paragraph">
<p>Dependencies are critical to the success of a package. You must be extra careful about
which version packages are using, one package in a different version may break your code.</p>
</div>
<div class="paragraph">
<p>Versioning in npm and yarn, follows a semantic called semver, following the logic
MAJOR.MINOR.PATCH, like for example, @angular/animations: 4.4.6.</p>
</div>
<div class="paragraph">
<p><strong>Different versions</strong></p>
</div>
<div class="paragraph">
<p>Sometimes, packages are installed with a different version from the one initially installed.
This happens because package.json also contains the range of versions we allow yarn or npm to
install or update to, example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">"@angular/animations": "^4.2.4"</code></pre>
</div>
</div>
<div class="paragraph">
<p>And here the installed one:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json"> "@angular/animations": {
      "version": "4.4.6",
      "resolved": "https://registry.npmjs.org/@angular/animations/-/animations-4.4.6.tgz",
      "integrity": "sha1-+mYYmaik44y3xYPHpcl85l1ZKjU=",
      "requires": {
        "tslib": "1.8.0"
      }</code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see, the version we initially added is 4.2.4, and the version finally installed after
a global installation of all packages, 4.4.6.</p>
</div>
<div class="paragraph">
<p>Installing packages without package-lock.json or yarn.lock using their respective packet managers, will always
end with npm or yarn installing the latest version allowed by package.json.</p>
</div>
<div class="paragraph">
<p>"@angular/animations": "^4.2.4" contains not only the version we added, but also the range we allow npm and yarn
to update. Here are some examples:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">"@angular/animations": "&lt;4.2.4"</code></pre>
</div>
</div>
<div class="paragraph">
<p>The version installed must be lower than 4.2.4 .</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">"@angular/animations": "&gt;=4.2.4"</code></pre>
</div>
</div>
<div class="paragraph">
<p>The version installed must be greater than or equal to 4.2.4 .</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">"@angular/animations": "=4.2.4"</code></pre>
</div>
</div>
<div class="paragraph">
<p>the version installed must be equal to 4.2.4 .</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">"@angular/animations": "^4.2.4"</code></pre>
</div>
</div>
<div class="paragraph">
<p>The version installed cannot modify the first non zero digit, for example in this case
it cannot surpass 5.0.0 or be lower than 4.2.4 .</p>
</div>
<div class="paragraph">
<p>You can learn more about this in <a href="https://yarnpkg.com/en/docs/dependency-versions">Versions</a></p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="guide-npm-yarn-workflow.asciidoc_problems-you-may-encounter">Problems you may encounter</h5>
<div class="paragraph">
<p>If you can&#8217;t find package.json, you may have deleted the one you had previously,
which means you have to download the package.json from the repository.
In the case you are creating a new project you can create a new package.json. More information
in the links below. Click on <a href="#guide-npm-yarn-workflow.asciidoc_package.json">Package.json</a> if you come from that section. <br></p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://yarnpkg.com/en/docs/cli/init">Creating new package.json in yarn</a><br></p>
</li>
<li>
<p><a href="https://docs.npmjs.com/cli/init">Creating new package.json in npm</a><br></p>
</li>
</ul>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Using npm install or yarn without package.json in your projects will
result in compilation errors. As we mentioned earlier,
Package.json contains essential information about your project.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If you have package.json, but you don&#8217;t have package-lock.json or yarn.lock the use of
command "npm install" or "yarn"  may result in a different dependency tree.</p>
</div>
<div class="paragraph">
<p>If you are trying to import a module and visual code studio is not able to find it,
is usually caused by error adding the package to the project, try to add the module again with yarn or npm,
and restart Visual Studio Code.</p>
</div>
<div class="paragraph">
<p>Be careful with the semantic versioning inside your package.json of the packages,
or you may find a new update on one of your dependencies breaking your code.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
In the following <a href="https://yarnpkg.com/en/docs/selective-version-resolutions">link</a>
there is a solution to a problematic update to one package.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>A list of common errors of npm can be found in: <a href="https://docs.npmjs.com/troubleshooting/common-errors">npm errors</a></p>
</div>
<div class="sect5">
<h6 id="guide-npm-yarn-workflow.asciidoc_recomendations">Recomendations</h6>
<div class="paragraph">
<p>Use yarn <strong>or</strong> npm in your project, reach an agreement with your team in order to choose one, this will avoid
undesired situations like forgetting to upload an updated yarn.lock or package-lock.json.
Be sure to have the latest version of your project when possible.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Pull your project every time it&#8217;s updated. Erase your node_modules folder and reinstall all
dependencies. This assures you to be working with the same dependencies your team has.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>AD Center recommends the use of yarn.</p>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="master-devon4ng.asciidoc_angular">18. Angular</h2>
<div class="sectionbody">
<!-- toc disabled -->
<div class="sect2">
<h3 id="guide-accessibility.asciidoc">18.1. Accessibility</h3>
<div class="paragraph">
<p>Multiple studies suggest that around 15-20% of the population are living with a disability of some kind. In comparison, that number is higher than any single browser demographic currently, other than Chrome2. Not considering those users when developing an application means excluding a large number of people from being able to use it comfortable or at all.</p>
</div>
<div class="paragraph">
<p>Some people are unable to use the mouse, view a screen, see low contrast text, Hear dialogue or music and some people having difficulty to understanding the complex language.This kind of people needed the support like Keyboard support, screen reader support, high contrast text, captions and transcripts and Plain language support. This disability may change the from permanent to the situation.</p>
</div>
<div class="sect3">
<h4 id="guide-accessibility.asciidoc_key-concerns-of-accessible-web-applications">18.1.1. Key Concerns of Accessible Web Applications</h4>
<div class="ulist">
<ul>
<li>
<p><strong>Semantic Markup</strong> - Allows the application to be understood on a more general level rather than just details of whats being rendered</p>
</li>
<li>
<p><strong>Keyboard Accessibility</strong> - Applications must still be usable when using only a keyboard</p>
</li>
<li>
<p><strong>Visual Assistance</strong> - color contrast, focus of elements and text representations of audio and events</p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="guide-accessibility.asciidoc_semantic-markup">Semantic Markup</h5>
<div class="paragraph">
<p>If you&#8217;re creating custom element directives, Web Components or HTML in general, use native elements wherever possible to utilize built-in events and properties. Alternatively, use ARIA to communicate semantic meaning.</p>
</div>
<div class="paragraph">
<p>HTML tags have attributes that providers extra context on what&#8217;s being displayed on the browser. For example, the  img  tag&#8217;s  alt  attribute lets the reader know what is being shown using a short description.However, native tags don&#8217;t cover all cases. This is where ARIA fits in. ARIA attributes can provide context on what roles specific elements have in the application or on how elements within the document relate to each other.</p>
</div>
<div class="paragraph">
<p>A modal component can be given the  role  of dialog or alertdialog to let the browser know that that component is acting as a modal. The modal component template can use the ARIA attributes  aria-labelledby  and  aria-described  to describe to readers what the title and purpose of the modal is.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-TypeScript hljs" data-lang="TypeScript">@Component({
    selector: 'ngc2-app',
    template: `
      &lt;ngc2-notification-button
        message="Hello!"
        label="Greeting"
        role="button"&gt;
      &lt;/ngc2-notification-button&gt;
      &lt;ngc2-modal
        [title]="modal.title"
        [description]="modal.description"
        [visible]="modal.visible"
        (close)="modal.close()"&gt;
      &lt;/ngc2-modal&gt;
    `
})
export class AppComponent {
  constructor(private modal: ModalService) { }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>notification-button.component.ts</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-TypeScript hljs" data-lang="TypeScript">@Component({
  selector: 'ngc2-modal',
  template: `
    &lt;div
      role="dialog"
      aria-labelledby="modal-title"
      aria-describedby="modal-description"&gt;
      &lt;div id="modal-title"&gt;{{title}}&lt;/div&gt;
      &lt;p id="modal-description"&gt;{{description}}&lt;/p&gt;
      &lt;button (click)="close.emit()"&gt;OK&lt;/button&gt;
    &lt;/div&gt;
  `
})
export class ModalComponent {
  ...
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="guide-accessibility.asciidoc_keyboard-accessibility">Keyboard Accessibility</h5>
<div class="paragraph">
<p>Keyboard accessibility is the ability of your application to be interacted with using just a keyboard. The more streamlined the site can be used this way, the more keyboard accessible it is. Keyboard accessibility is one of the largest aspects of web accessibility since it targets:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>those with motor disabilities who can&#8217;t use a mouse</p>
</li>
<li>
<p>users who rely on screen readers and other assistive technology, which require keyboard navigation</p>
</li>
<li>
<p>those who prefer not to use a mouse</p>
</li>
</ul>
</div>
<div class="sect5">
<h6 id="guide-accessibility.asciidoc_focus">Focus</h6>
<div class="paragraph">
<p>Keyboard interaction is driven by something called focus. In web applications, only one element on a document has focus at a time, and keypresses will activate whatever function is bound to that element.
Focus element border can be styled with CSS using the  outline  property, but it should not be removed. Elements can also be styled using the  :focus  psuedo-selector.</p>
</div>
</div>
<div class="sect5">
<h6 id="guide-accessibility.asciidoc_tabbing">Tabbing</h6>
<div class="paragraph">
<p>The most common way of moving focus along the page is through the  tab  key. Elements will be traversed in the order they appear in the document outline - so that order must be carefully considered during development.
There is way change the default behaviour or tab order. This can be done through the  tabindex  attribute. The  tabindex  can be given the values:
* less than zero - to let readers know that an element should be focusable but not keyboard accessible
* 0 - to let readers know that that element should be accessible by keyboard
* greater than zero - to let readers know the order in which the focusable element should be reached using the keyboard. Order is calculated from lowest to highest.</p>
</div>
</div>
<div class="sect5">
<h6 id="guide-accessibility.asciidoc_transitions">Transitions</h6>
<div class="paragraph">
<p>The majority of transitions that happen in an Angular application will not involve a page reload. This means that developers will need to carefully manage what happens to focus in these cases.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-TypeScript hljs" data-lang="TypeScript">@Component({
  selector: 'ngc2-modal',
  template: `
    &lt;div
      role="dialog"
      aria-labelledby="modal-title"
      aria-describedby="modal-description"&gt;
      &lt;div id="modal-title"&gt;{{title}}&lt;/div&gt;
      &lt;p id="modal-description"&gt;{{description}}&lt;/p&gt;
      &lt;button (click)="close.emit()"&gt;OK&lt;/button&gt;
    &lt;/div&gt;
  `,
})
export class ModalComponent {
  constructor(private modal: ModalService, private element: ElementRef) { }

  ngOnInit() {
    this.modal.visible$.subscribe(visible =&gt; {
      if(visible) {
        setTimeout(() =&gt; {
          this.element.nativeElement.querySelector('button').focus();
        }, 0);
      }
    })
  }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="guide-accessibility.asciidoc_visual-assistance">18.1.2. Visual Assistance</h4>
<div class="paragraph">
<p>One large category of disability is visual impairment. This includes not just the blind, but those who are color blind or partially sighted, and require some additional consideration.</p>
</div>
<div class="sect4">
<h5 id="guide-accessibility.asciidoc_color-contrast">Color Contrast</h5>
<div class="paragraph">
<p>When choosing colors for text or elements on a website, the contrast between them needs to be considered. For WCAG 2.0 AA, this means that the contrast ratio for text or visual representations of text needs to be at least 4.5:1. There are tools online to measure the contrast ratio such as this color contrast checker from WebAIM or be checked with using automation tests.</p>
</div>
</div>
<div class="sect4">
<h5 id="guide-accessibility.asciidoc_visual-information">Visual Information</h5>
<div class="paragraph">
<p>Color can help a user&#8217;s understanding of information, but it should never be the only way to convey information to a user. For example, a user with red/green color-blindness may have trouble discerning at a glance if an alert is informing them of success or failure.</p>
</div>
</div>
<div class="sect4">
<h5 id="guide-accessibility.asciidoc_audiovisual-media">Audiovisual Media</h5>
<div class="paragraph">
<p>Audiovisual elements in the application such as video, sound effects or audio (ie. podcasts) need related textual representations such as transcripts, captions or descriptions. They also should never auto-play and playback controls should be provided to the user.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="guide-accessibility.asciidoc_accessibility-with-angular-material">18.1.3. Accessibility with Angular Material</h4>
<div class="paragraph">
<p>The <code>a11y</code> package provides a number of tools to improve accessibility. Import</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-TypeScript hljs" data-lang="TypeScript">import { A11yModule } from '@angular/cdk/a11y';</code></pre>
</div>
</div>
<div class="sect4">
<h5 id="guide-accessibility.asciidoc_listkeymanager">ListKeyManager</h5>
<div class="paragraph">
<p><code>ListKeyManager</code> manages the active option in a list of items based on keyboard interaction. Intended to be used with components that correspond to a <code>role="menu"</code> or <code>role="listbox"</code> pattern . Any component that uses a ListKeyManager will generally do three things:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Create a <code>@ViewChildren</code> query for the options being managed.</p>
</li>
<li>
<p>Initialize the <code>ListKeyManager</code>, passing in the options.</p>
</li>
<li>
<p>Forward keyboard events from the managed component to the <code>ListKeyManager</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Each option should implement the <code>ListKeyManagerOption</code> interface:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-TypeScript hljs" data-lang="TypeScript">interface ListKeyManagerOption {
  disabled?: boolean;
  getLabel?(): string;
}</code></pre>
</div>
</div>
<div class="sect5">
<h6 id="guide-accessibility.asciidoc_types-of-listkeymanager">Types of ListKeyManager</h6>
<div class="paragraph">
<p>There are two varieties of <code>ListKeyManager</code>, <code>FocusKeyManager</code> and <code>ActiveDescendantKeyManager</code>.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="guide-accessibility.asciidoc_focuskeymanager">FocusKeyManager</h5>
<div class="paragraph">
<p>Used when options will directly receive browser focus. Each item managed must implement the FocusableOption interface:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-TypeScript hljs" data-lang="TypeScript">interface FocusableOption extends ListKeyManagerOption {
  focus(): void;
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="guide-accessibility.asciidoc_activedescendantkeymanager">ActiveDescendantKeyManager</h5>
<div class="paragraph">
<p>Used when options will be marked as active via aria-activedescendant. Each item managed must implement the Highlightable interface:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-TypeScript hljs" data-lang="TypeScript">interface Highlightable extends ListKeyManagerOption {
  setActiveStyles(): void;
  setInactiveStyles(): void;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Each item must also have an ID bound to the listbox&#8217;s or menu&#8217;s aria-activedescendant.</p>
</div>
</div>
<div class="sect4">
<h5 id="guide-accessibility.asciidoc_focustrap">FocusTrap</h5>
<div class="paragraph">
<p>The <code>cdkTrapFocus</code> directive traps Tab key focus within an element. This is intended to be used to create accessible experience for components like modal dialogs, where focus must be constrained. This directive is declared in <code>A11yModule</code>.</p>
</div>
<div class="paragraph">
<p>This directive will not prevent focus from moving out of the trapped region due to mouse interaction.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-HTML hljs" data-lang="HTML">&lt;div class="my-inner-dialog-content" cdkTrapFocus&gt;
  &lt;!-- Tab and Shift + Tab will not leave this element. --&gt;
&lt;/div&gt;</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="guide-accessibility.asciidoc_regions">Regions</h5>
<div class="paragraph">
<p>Regions can be declared explicitly with an initial focus element by using the <code>cdkFocusRegionStart</code>, <code>cdkFocusRegionEnd</code> and <code>cdkFocusInitial</code> DOM attributes. When using the tab key, focus will move through this region and wrap around on either end.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-HTML hljs" data-lang="HTML">&lt;a mat-list-item routerLink cdkFocusRegionStart&gt;Focus region start&lt;/a&gt;
&lt;a mat-list-item routerLink&gt;Link&lt;/a&gt;
&lt;a mat-list-item routerLink cdkFocusInitial&gt;Initially focused&lt;/a&gt;
&lt;a mat-list-item routerLink cdkFocusRegionEnd&gt;Focus region end&lt;/a&gt;</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="guide-accessibility.asciidoc_interactivitychecker">InteractivityChecker</h5>
<div class="paragraph">
<p><code>InteractivityChecker</code> is used to check the interactivity of an element, capturing disabled, visible, tabbable, and focusable states for accessibility purposes.</p>
</div>
</div>
<div class="sect4">
<h5 id="guide-accessibility.asciidoc_liveannouncer">LiveAnnouncer</h5>
<div class="paragraph">
<p><code>LiveAnnouncer</code> is used to announce messages for screen-reader users using an aria-live region.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-HTML hljs" data-lang="HTML">@Component({...})
export class MyComponent {

 constructor(liveAnnouncer: LiveAnnouncer) {
   liveAnnouncer.announce("Hey Google");
 }
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="guide-accessibility.asciidoc_api-reference-for-angular-cdk-a11y">API reference for Angular CDK a11y</h5>
<div class="paragraph">
<p><a href="https://material.angular.io/cdk/a11y/api">API reference for Angular CDK a11y</a></p>
</div>
<!-- toc disabled -->
</div>
</div>
</div>
<div class="sect2">
<h3 id="guide-angular-elements.asciidoc">18.2. Angular Elements</h3>
<div class="sect3">
<h4 id="guide-angular-elements.asciidoc_what-are-angular-elements">18.2.1. What are Angular Elements?</h4>
<div class="paragraph">
<p><a href="https://angular.io/guide/elements">Angular elements</a> are Angular components packaged as custom elements, a web standard for defining new HTML elements in a framework-agnostic way.</p>
</div>
<div class="paragraph">
<p>Custom elements are a Web Platform feature currently supported by Chrome, Firefox, Opera, and Safari, and available in other browsers through <a href="https://angular.io/guide/elements#browser-support">Polyfills</a>. A custom element extends HTML by allowing you to define a tag whose content is created and controlled by JavaScript code. The browser maintains a CustomElementRegistry of defined custom elements (also called Web Components), which maps an instantiable JavaScript class to an HTML tag.</p>
</div>
</div>
<div class="sect3">
<h4 id="guide-angular-elements.asciidoc_why-use-angular-elements">18.2.2. Why use Angular Elements?</h4>
<div class="paragraph">
<p>Angular Elements allows Angular to work with different frameworks by using input and output elements. This allows Angular to work with many different frameworks if needed. This is an ideal situation if a slow transformation of an application to <code>Angular</code> is needed or some Angular needs to be added in other web applications(For example. <code>ASP.net</code>, <code>JSP</code> etc )</p>
</div>
</div>
<div class="sect3">
<h4 id="guide-angular-elements.asciidoc_negative-points-about-elements">18.2.3. Negative points about Elements</h4>
<div class="paragraph">
<p>Angular Elements is really powerful but since, the transition between views between views is going to be handled by another framework or html/javascript, using Angular <code>Router</code> is not possible. the view transitions have to be handled manually. This fact also eliminates the possibility of just porting an application completely.</p>
</div>
</div>
<div class="sect3">
<h4 id="guide-angular-elements.asciidoc_how-to-use-angular-elements">18.2.4. How to use Angular Elements?</h4>
<div class="paragraph">
<p>In a generalized way, a simple <code>Angular component</code> could be transformed to an <code>Angular Element</code> with this steps:</p>
</div>
<div class="sect4">
<h5 id="guide-angular-elements.asciidoc_installing-angular-elements">Installing Angular Elements</h5>
<div class="paragraph">
<p>The first step is going to be install the library using our prefered packet manager:</p>
</div>
<div class="sect6">
<h7 id="guide-angular-elements.asciidoc_npm">NPM</h7>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>npm install @angular/elements</code></pre>
</div>
</div>
</div>
<div class="sect6">
<h7 id="guide-angular-elements.asciidoc_yarn">YARN</h7>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>yarn add @angular/elements</code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="guide-angular-elements.asciidoc_preparing-the-components-in-the-modules">Preparing the components in the modules</h5>
<div class="paragraph">
<p>Inside the <code>app.module.ts</code>, in addition to the normal declaration of the components inside <code>declarations</code>, the modules inside <code>imports</code> and the services inside <code>providers</code>, the components need to added in <code>entryComponents</code>. If there are components that have their own module, the same logic is going to be applied for them, only adding in the <code>app.module.ts</code> the components that dont have their own module. Here is an example of this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">....
@NgModule({
  declarations: [
    DishFormComponent,
    DishviewComponent
  ],
  imports: [
    CoreModule,  // Module containing Angular Materials
    FormsModule
  ],
  entryComponents: [
    DishFormComponent,
    DishviewComponent
  ],
  providers: [DishShareService]
})
....</code></pre>
</div>
</div>
<div class="paragraph">
<p>After that is done, the constructor of the module is going to be modified to use injector and boostrap the application defining the components. This is going to allow the <code>Angular Element</code> to get the injections and to define a component tag that will be used later:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">....
})
export class AppModule {
  constructor(private injector: Injector) {

  }

  ngDoBootstrap() {
    const el = createCustomElement(DishFormComponent, {injector: this.injector});
    customElements.define('dish-form', el);

    const elView = createCustomElement(DishviewComponent, {injector: this.injector});
    customElements.define('dish-view', elView);
  }
}
....</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="guide-angular-elements.asciidoc_a-component-example">A component example</h5>
<div class="paragraph">
<p>In order to be able to use a component, <code>@Input()</code> and <code>@Output()</code> variables are used. These variables are going to be the ones that will allow the Angular Element to communicate with the framework/javascript:</p>
</div>
<div class="paragraph">
<p>Component html</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-html hljs" data-lang="html">&lt;mat-card&gt;
    &lt;mat-grid-list cols="1" rowHeight="100px" rowWidth="50%"&gt;
				&lt;mat-grid-tile colspan="1" rowspan="1"&gt;
					&lt;span&gt;{{ platename }}&lt;/span&gt;
				&lt;/mat-grid-tile&gt;
				&lt;form (ngSubmit)="onSubmit(dishForm)" #dishForm="ngForm"&gt;
					&lt;mat-grid-tile colspan="1" rowspan="1"&gt;
						&lt;mat-form-field&gt;
							&lt;input matInput placeholder="Name" name="name" [(ngModel)]="dish.name"&gt;
						&lt;/mat-form-field&gt;
					&lt;/mat-grid-tile&gt;
					&lt;mat-grid-tile colspan="1" rowspan="1"&gt;
						&lt;mat-form-field&gt;
							&lt;textarea matInput placeholder="Description" name="description" [(ngModel)]="dish.description"&gt;&lt;/textarea&gt;
						&lt;/mat-form-field&gt;
					&lt;/mat-grid-tile&gt;
					&lt;mat-grid-tile colspan="1" rowspan="1"&gt;
						&lt;button mat-raised-button color="primary" type="submit"&gt;Submit&lt;/button&gt;
					&lt;/mat-grid-tile&gt;
				&lt;/form&gt;
		&lt;/mat-grid-list&gt;
&lt;/mat-card&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Component ts</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">@Component({
  templateUrl: './dish-form.component.html',
  styleUrls: ['./dish-form.component.scss']
})
export class DishFormComponent implements OnInit {

  @Input() platename;

  @Input() platedescription;

  @Output()
  submitDishEvent = new EventEmitter();

  submitted = false;
  dish = {name: '', description: ''};

  constructor(public dishShareService: DishShareService) { }

  ngOnInit() {
    this.dish.name = this.platename;
    this.dish.description = this.platedescription;
  }

  onSubmit(dishForm: NgForm): void {
    console.log('SUBMIT');
    console.log(dishForm.value);
    this.dishShareService.createDish(dishForm.value.name, dishForm.value.description);
    this.submitDishEvent.emit('dishSubmited');
  }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this file there are definitions of multiple variables that will be used as input and output. Since the input variables are going to be used directly by html, only lowercase and underscore strategies can be used for them. On the <code>onSubmit(dishForm: NgForm)</code> a service is used to pass this variables to another component. Finally, as a last thing, the selector inside <code>@Component</code> has been removed since a tag that will be used dynamically was already defined in the last step.</p>
</div>
</div>
<div class="sect4">
<h5 id="guide-angular-elements.asciidoc_solving-the-error">Solving the error</h5>
<div class="paragraph">
<p>In order to be able to use this <code>Angular Element</code> a <code>Polyfills</code>/<code>Browser support</code> related error needs to solved. This error can be solved in two ways:</p>
</div>
<div class="sect6">
<h7 id="guide-angular-elements.asciidoc_changing-the-target">Changing the target</h7>
<div class="paragraph">
<p>One solution is to change the target in <code>tsconfig.json</code> to <code>es2015</code>. This might not be doable for every application since maybe a specific target is required.</p>
</div>
</div>
<div class="sect6">
<h7 id="guide-angular-elements.asciidoc_installing-polyfaces">Installing Polyfaces</h7>
<div class="paragraph">
<p>Another solution is to use AutoPollyfill. In order to do so, the library is going to be installed with a packet manager:</p>
</div>
<div class="paragraph">
<p>Yarn</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>yarn add @webcomponents/webcomponentsjs</code></pre>
</div>
</div>
<div class="paragraph">
<p>Npm</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>npm install @webcomponents/webcomponentsjs</code></pre>
</div>
</div>
<div class="paragraph">
<p>After the packet manager has finished, inside the src folder a new file <code>polyfills.ts</code> is found. To solve the error, importing the corresponding adapter (<code>custom-elements-es5-adapter.js</code>) is necessary:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">....
/***************************************************************************************************
 * APPLICATION IMPORTS
 */

import '@webcomponents/webcomponentsjs/custom-elements-es5-adapter.js';
....</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you want to learn more about polyfills in angular you can do it <a href="https://angular.io/guide/browser-support">here</a></p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="guide-angular-elements.asciidoc_building-the-angular-element">Building the Angular Element</h5>
<div class="paragraph">
<p>First, before building the <code>Angular Element</code>, every element inside that app component except the module need to be removed. After that, a bash script is created in the root folder,. This script will allow to put every necessary file into a js.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>ng build "projectName" --prod --output-hashing=none &amp;&amp; cat dist/"projectName"/runtime.js dist/"projectName"/polyfills.js dist/"projectName"/scripts.js dist/"projectName"/main.js &gt; ./dist/"projectName"/"nameWantedAngularElement".js</code></pre>
</div>
</div>
<div class="paragraph">
<p>After executing the bash script, it will generate inside the path <code>dist/"projectName"</code> a js file named <code>"nameWantedAngularElement".js</code> and a css file.</p>
</div>
<div class="sect6">
<h7 id="guide-angular-elements.asciidoc_building-with-ngx-build-plus-recommended">Building with ngx-build-plus (Recommended)</h7>
<div class="paragraph">
<p>The library <a href="https://github.com/manfredsteyer/ngx-build-plus">ngx-build-plus</a> allows to add different options when building. In addition, it solves some errors that will occur when trying to use multiple angular elements in an application. In order to use it, yarn or npm can be used:</p>
</div>
<div class="paragraph">
<p>Yarn</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>yarn add ngx-build-plus</code></pre>
</div>
</div>
<div class="paragraph">
<p>Npm</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>npm install ngx-build-plus</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you want to add it to a specific sub project in your projects folder, use the --project:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>.... ngx-build-plus --project "project-name"</code></pre>
</div>
</div>
<div class="paragraph">
<p>Using this library and the following command, an isolated <code>Angular Element</code> which won&#8217;t have conflict with others can be generated. This <code>Angular Element</code> will not have a polyfill so, the project where we use them will need to include a <code>poliyfill</code> with the <code>Angular Element</code> requirements.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>ng build "projectName" --output-hashing none --single-bundle true --prod --bundle-styles false</code></pre>
</div>
</div>
<div class="paragraph">
<p>This command will generate three things:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The main js bundle</p>
</li>
<li>
<p>The script js</p>
</li>
<li>
<p>The css</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>These files will be used later instead of the single js generated in the last step.</p>
</div>
<div class="sect7">
<h8 id="guide-angular-elements.asciidoc_extra-parameters">Extra parameters</h8>
<div class="paragraph">
<p>Here are some extra useful parameters that <code>ngx-build-plus</code> provides:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>--keep-polyfills</code>: This paremeter is going to allow us to keep the polyfills. This needs to be used with caution, avoiding using multiple different polyfills that could cause an error is necessary.</p>
</li>
<li>
<p><code>--extraWebpackConfig webpack.extra.js</code>: This parameter allows us to create a javascript file inside our <code>Angular Elements</code> project with the name of different libraries. Using <code>webpack</code> these libraries will not be included in the <code>Angular Element</code>. This is useful to lower the size of our <code>Angular Element</code> by removing libraries shared. Example:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-javascript hljs" data-lang="javascript">const webpack = require('webpack');

module.exports = {
    "externals": {
        "rxjs": "rxjs",
        "@angular/core": "ng.core",
        "@angular/common": "ng.common",
        "@angular/common/http": "ng.common.http",
        "@angular/platform-browser": "ng.platformBrowser",
        "@angular/platform-browser-dynamic": "ng.platformBrowserDynamic",
        "@angular/compiler": "ng.compiler",
        "@angular/elements": "ng.elements",
        "@angular/router": "ng.router",
        "@angular/forms": "ng.forms"
    }
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="literalblock">
<div class="content">
<pre>If some libraries are excluded from the `Angular Element` you will need to add the bundled umd files of those libraries manually.</pre>
</div>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="guide-angular-elements.asciidoc_using-the-angular-element">Using the Angular Element</h5>
<div class="paragraph">
<p>The <code>Angular Element</code> that got generated in the last step can be used in almost every framework. In this case, the <code>Angular Element</code> is going to be used in html:</p>
</div>
<div class="listingblock">
<div class="title">Listing 11. Sample index.html version without ngx-build-plus</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-HTML hljs" data-lang="HTML">&lt;html&gt;
    &lt;head&gt;
        &lt;link rel="stylesheet" href="styles.css"&gt;
    &lt;/head&gt;
    &lt;body&gt;
        &lt;div id="container"&gt;

        &lt;/div&gt;
        &lt;!--Use of the element non dynamically--&gt;
        &lt;!--&lt;plate-form platename="test" platedescription="test"&gt;&lt;/plate-form&gt;--&gt;
        &lt;script src="./devon4ngAngularElements.js"&gt; &lt;/script&gt;
        &lt;script&gt;
                var elContainer = document.getElementById('container');
                var el= document.createElement('dish-form');
                el.setAttribute('platename','test');
                el.setAttribute('platedescription','test');
                el.addEventListener('submitDishEvent',(ev)=&gt;{
                    var elView= document.createElement('dish-view');
                    elContainer.innerHTML = '';
                    elContainer.appendChild(elView);
                });
                elContainer.appendChild(el);
        &lt;/script&gt;
    &lt;/body&gt;
&lt;/html&gt;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Listing 12. Sample index.html version with ngx-build-plus</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-HTML hljs" data-lang="HTML">&lt;html&gt;
    &lt;head&gt;
        &lt;link rel="stylesheet" href="styles.css"&gt;
    &lt;/head&gt;
    &lt;body&gt;
        &lt;div id="container"&gt;

        &lt;/div&gt;
        &lt;!--Use of the element non dynamically--&gt;
        &lt;!--&lt;plate-form platename="test" platedescription="test"&gt;&lt;/plate-form&gt;--&gt;
         &lt;script src="./polyfills.js"&gt; &lt;/script&gt; &lt;!-- Created using --keep-polyfills options --&gt;
        &lt;script src="./scripts.js"&gt; &lt;/script&gt;
         &lt;script src="./main.js"&gt; &lt;/script&gt;
        &lt;script&gt;
                var elContainer = document.getElementById('container');
                var el= document.createElement('dish-form');
                el.setAttribute('platename','test');
                el.setAttribute('platedescription','test');
                el.addEventListener('submitDishEvent',(ev)=&gt;{
                    var elView= document.createElement('dish-view');
                    elContainer.innerHTML = '';
                    elContainer.appendChild(elView);
                });
                elContainer.appendChild(el);
        &lt;/script&gt;
    &lt;/body&gt;
&lt;/html&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this html, the css generated in the last step is going to be imported inside the <code>&lt;head&gt;</code> and then, the javascript element is going to be imported at the end of the body. After that is done, There is two uses of <code>Angular Elements</code> in the html, one directly whith use of the <code>@input()</code> variables as parameters commented in the html:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-html hljs" data-lang="html">....
        &lt;!--Use of the element non dynamically--&gt;
        &lt;!--&lt;plate-form platename="test" platedescription="test"&gt;&lt;/plate-form&gt;--&gt;
....</code></pre>
</div>
</div>
<div class="paragraph">
<p>and one dynamically inside the script:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-html hljs" data-lang="html">....
        &lt;script&gt;
                var elContainer = document.getElementById('container');
                var el= document.createElement('dish-form');
                el.setAttribute('platename','test');
                el.setAttribute('platedescription','test');
                el.addEventListener('submitDishEvent',(ev)=&gt;{
                    var elView= document.createElement('dish-view');
                    elContainer.innerHTML = '';
                    elContainer.appendChild(elView);
                });
                elContainer.appendChild(el);
        &lt;/script&gt;
....</code></pre>
</div>
</div>
<div class="paragraph">
<p>This javascript is an example of how to create dynamically an <code>Angular Element</code> inserting attributed to fill our <code>@Input()</code> variables and listen to the <code>@Output()</code> that was defined earlier. This is done with:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-html hljs" data-lang="html">                el.addEventListener('submitDishEvent',(ev)=&gt;{
                    var elView= document.createElement('dish-view');
                    elContainer.innerHTML = '';
                    elContainer.appendChild(elView);
                });</code></pre>
</div>
</div>
<div class="paragraph">
<p>This allows javascript to hook with the <code>@Output()</code> event emitter that was defined. When this event gets called, another component that was defined gets inserted dynamically.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="guide-angular-elements.asciidoc_angular-element-within-another-angular-project">18.2.5. Angular Element within another Angular project</h4>
<div class="paragraph">
<p>In order to use an <code>Angular Element</code> within another <code>Angular</code> project the following steps need to be followed:</p>
</div>
<div class="sect4">
<h5 id="guide-angular-elements.asciidoc_copy-bundled-script-and-css-to-resources">Copy bundled script and css to resources</h5>
<div class="paragraph">
<p>First copy the generated <code>.js</code> and <code>.css</code> inside assets in the corresponding folder.</p>
</div>
</div>
<div class="sect4">
<h5 id="guide-angular-elements.asciidoc_add-bundled-script-to-angular.json">Add bundled script to angular.json</h5>
<div class="paragraph">
<p>Inside <code>angular.json</code> both of the files that were copied in the last step are going to be included. This will be done both, in <code>test</code> and in <code>build</code>. Including it on the test, will allow to perform unitary tests.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
....
  "architect": {
    ....
    "build": {
      ....
      "styles": [
        ....
          "src/assets/css/devon4ngAngularElements.css"
        ....
      ]
      ....
      "scripts": [
        "src/assets/js/devon4ngAngularElements.js"
      ]
      ....
    }
    ....
    "test": {
      ....
      "styles": [
        ....
          "src/assets/css/devon4ngAngularElements.css"
        ....
      ]
      ....
      "scripts": [
        "src/assets/js/devon4ngAngularElements.js"
      ]
      ....
    }
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>By declaring the files in the <code>angular.json</code> angular will take care of including them in a proper way.</p>
</div>
</div>
<div class="sect4">
<h5 id="guide-angular-elements.asciidoc_using-angular-element">Using Angular Element</h5>
<div class="paragraph">
<p>There are two ways that <code>Angular Element</code> can be used:</p>
</div>
<div class="sect6">
<h7 id="guide-angular-elements.asciidoc_create-component-dynamicly">Create component dynamicly</h7>
<div class="paragraph">
<p>In order to add the component in a dynamic way, first adding a container is necessary:</p>
</div>
<div class="paragraph">
<p><code>app.component.html</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-html hljs" data-lang="html">....
&lt;div id="container"&gt;
&lt;/div&gt;
....</code></pre>
</div>
</div>
<div class="paragraph">
<p>With this container created, inside the <code>app.component.ts</code> a method is going to be created. This method is going to find the container, create the dynamic element and append it into the container.</p>
</div>
<div class="paragraph">
<p><code>app.component.ts</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">export class AppComponent implements OnInit {
  ....
  ngOnInit(): void {
    this.createComponent();
  }
  ....
  createComponent(): void {
    const container = document.getElementById('container');
    const component = document.createElement('dish-form');
    container.appendChild(component);
  }
  ....</code></pre>
</div>
</div>
</div>
<div class="sect6">
<h7 id="guide-angular-elements.asciidoc_using-it-directly">Using it directly</h7>
<div class="paragraph">
<p>In order to use it directly on the templates, in the <code>app.module.ts</code> the <code>CUSTOM_ELEMENTS_SCHEMA</code> needs to be added:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">....
import { NgModule, CUSTOM_ELEMENTS_SCHEMA } from '@angular/core';
....
@NgModule({
  ....
  schemas: [ CUSTOM_ELEMENTS_SCHEMA ],</code></pre>
</div>
</div>
<div class="paragraph">
<p>This is going to allow the use of the <code>Angular Element</code> in the templates directly:</p>
</div>
<div class="paragraph">
<p><code>app.component.html</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-html hljs" data-lang="html">....
&lt;div id="container"&gt;
  &lt;dish-form&gt;&lt;/dish-form&gt;
&lt;/div&gt;</code></pre>
</div>
</div>
<!-- toc disabled -->
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="guide-angular-lazy-loading.asciidoc">18.3. Angular Lazy loading</h3>
<div class="paragraph">
<p>When the development of an application starts, it just contains a small set of features so the app usually loads fast. However, as new features are added, the overall application size grows up  and its loading speed decreases, is in this context where Lazy loading finds its place.
Lazy loading is a dessign pattern that defers initialization of objects until it is needed so, for example, Users that just access to a website&#8217;s home page do not need to have other areas loaded.
Angular handles lazy loading through the routing module which redirect to requested pages. Those pages can be loaded at start or on demand.</p>
</div>
<div class="sect3">
<h4 id="guide-angular-lazy-loading.asciidoc_an-example-with-angular">18.3.1. An example with Angular</h4>
<div class="paragraph">
<p>To explain how lazy loading is implemented using angular, a basic sample app is going to be developed. This app will consist in a window named "level 1" that contains two buttons that redirects to other windows in a "second level". It is a simple example, but useful to understand the relation between angular modules and lazy loading.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/angular/angular-lazy/levels-app.png" alt="Levels app structure" width="500 link="images/angular/angular-lazy/levels-app.png"">
</div>
<div class="title">Figure 13. Levels app structure.</div>
</div>
<div class="paragraph">
<p>This graphic shows that modules acts as gates to access components "inside" them.</p>
</div>
<div class="paragraph">
<p>Because the objective of this guide is related mainly with logic, the html structure and scss styles are less relevant, but the complete code can be found as a sample <a href="https://github.com/devonfw/devon4ng/tree/master/samples/AngularLazyLoading">here</a>.</p>
</div>
<div class="sect4">
<h5 id="guide-angular-lazy-loading.asciidoc_implementation">Implementation</h5>
<div class="paragraph">
<p>First write in a console <code>ng new level-app --routing</code>, to generate a new project called level-app including an app-routing.module.ts file (<strong>--routing</strong> flag).</p>
</div>
<div class="paragraph">
<p>In the file app.component.html delete all the content except the router-outlet tag.</p>
</div>
<div class="listingblock">
<div class="title">Listing 13. File app.component.html</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-html hljs" data-lang="html">&lt;router-outlet&gt;&lt;/router-outlet&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The next steps consists on creating features modules.</p>
</div>
<div class="paragraph">
<p>run <code>ng generate module first --routing</code>  to generate a module named <em>first</em>.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>run <code>ng generate module first/second-left --routing</code> to generate a module named <em>second-left</em> under <em>first</em>.</p>
</li>
<li>
<p>run <code>ng generate module first/second-right --routing</code> to generate a module <em>second-right</em> under <em>first</em>.</p>
</li>
<li>
<p>run <code>ng generate component first/first</code> to generate a component named <em>first</em> inside the module <em>first</em>.</p>
</li>
<li>
<p>run <code>ng generate component first/second-left/content</code> to generate a component <em>content</em> inside the module <em>second-left</em>.</p>
</li>
<li>
<p>run <code>ng generate component first/second-right/content</code> to generate a component <em>content</em> inside the module <em>second-right</em>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To move between components we have to configure the routes used:</p>
</div>
<div class="paragraph">
<p>In <strong>app-routing.module.ts</strong> add a path <strong>'first'</strong> to FirstComponent and a redirection from <strong>''</strong> to <strong>'first'</strong>.</p>
</div>
<div class="listingblock">
<div class="title">Listing 14. File app-routing.module.ts.</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-ts hljs" data-lang="ts">...
import { FirstComponent } from './first/first/first.component';

const routes: Routes = [
  {
    path: 'first',
    component: FirstComponent
  },
  {
    path: '',
    redirectTo: 'first',
    pathMatch: 'full',
  },
];

@NgModule({
  imports: [RouterModule.forRoot(routes)],
  exports: [RouterModule],
})
export class AppRoutingModule {}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In <strong>app.module.ts</strong> import the module which includes FirstComponent.</p>
</div>
<div class="listingblock">
<div class="title">Listing 15. File app.module.ts</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-ts hljs" data-lang="ts">....
import { FirstModule } from './first/first.module';

@NgModule({
  ...
  imports: [
    ....
    FirstModule
  ],
  ...
})
export class AppModule { }</code></pre>
</div>
</div>
<div class="paragraph">
<p>In <strong>first-routing.module.ts</strong> add routes that direct to the content of SecondRightModule and SecondLeftModule. The content of both modules have the same name so, in order to avoid conflicts the name of the components are going to be changed using <strong>as</strong> ( original-name as new-name).</p>
</div>
<div class="listingblock">
<div class="title">Listing 16. File first-routing.module.ts</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-ts hljs" data-lang="ts">...
import { ContentComponent as ContentLeft} from './second-left/content/content.component';
import { ContentComponent as ContentRight} from './second-right/content/content.component';
import { FirstComponent } from './first/first.component';

const routes: Routes = [
  {
    path: '',
    component: FirstComponent
  },
  {
    path: 'first/second-left',
    component: ContentLeft
  },
  {
    path: 'first/second-right',
    component: ContentRight
  }
];

@NgModule({
  imports: [RouterModule.forChild(routes)],
  exports: [RouterModule]
})
export class FirstRoutingModule { }</code></pre>
</div>
</div>
<div class="paragraph">
<p>In first.module.ts import SecondLeftModule and SecondRightModule.</p>
</div>
<div class="listingblock">
<div class="title">Listing 17. File first.module.ts</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-ts hljs" data-lang="ts">...
import { SecondLeftModule } from './second-left/second-left.module';
import { SecondRightModule } from './second-right/second-right.module';

@NgModule({
  ...
  imports: [
    ...
    SecondLeftModule,
    SecondRightModule,
  ]
})
export class FirstModule { }</code></pre>
</div>
</div>
<div class="paragraph">
<p>Using the current configuration, we have a project that loads all the modules in a eager way. Run <code>ng serve</code> to see what happens.</p>
</div>
<div class="paragraph">
<p>First, during the compilation we can see that just a main file is built.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/angular/angular-lazy/compile-eager.png" alt="Compile eager" width="800 link="images/angular/angular-lazy/compile-eager.png"">
</div>
<div class="title">Figure 14. Compile eager.</div>
</div>
<div class="paragraph">
<p>If we go to http//localhost:4200/first and open developer options (F12 on Chrome), it is found that a document named "first" is loaded.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/angular/angular-lazy/first-lvl-eager.png" alt="First level eager" width="800 link="images/angular/angular-lazy/first-lvl-eager.png"">
</div>
<div class="title">Figure 15. First level eager.</div>
</div>
<div class="paragraph">
<p>If we click on <strong>[Go to right module]</strong> a second level module opens, but there is no 'second-right' document.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/angular/angular-lazy/second-lvl-right-eager.png" alt="Second level right eager" width="800 link="images/angular/angular-lazy/second-lvl-right-eager.png"">
</div>
<div class="title">Figure 16. Second level right eager.</div>
</div>
<div class="paragraph">
<p>But, typing the url directly will load 'second-right' but no 'first', even if we click on <strong>[Go back]</strong></p>
</div>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/angular/angular-lazy/second-lvl-right-eager-d.png" alt="Second level right eager" width="800 link="images/angular/angular-lazy/second-lvl-right-eager-d.png"">
</div>
<div class="title">Figure 17. Second level right eager direct url.</div>
</div>
<div class="paragraph">
<p>Modifying an angular application to load its modules lazily is easy, you have to change the routing configuration of the desired module (for example FirstModule).</p>
</div>
<div class="listingblock">
<div class="title">Listing 18. File app-routing.module.ts.</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-ts hljs" data-lang="ts">const routes: Routes = [
  {
    path: 'first',
    loadChildren: () =&gt; import('./first/first.module').then(m =&gt; m.FirstModule),
  },
  {
    path: '',
    redirectTo: 'first',
    pathMatch: 'full',
  },
];

@NgModule({
  imports: [RouterModule.forRoot(routes)],
  exports: [RouterModule],
})
export class AppRoutingModule {}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Notice that instead of loading a component, you dynamically import it in a <em>loadChildren</em> attribute because modules acts as gates to access components "inside" them. Updating the app to load lazily has four consecuences:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>No component attribute.</p>
</li>
<li>
<p>No import of FirstComponent.</p>
</li>
<li>
<p>FirstModule import has to be removed from the imports array at app.module.ts.</p>
</li>
<li>
<p>Change of context.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>If we check <strong>first-routing.module.ts</strong> again, the can see that the path for ContentLeft and ContentRight is set to 'first/second-left' and 'first/second-right' respectively, so writing 'http//localhost:4200/first/second-left' will redirect us to ContentLeft. However, after loading a module with loadChildren setting the path to '<em>second-left</em>' and '<em>second-right</em>' is enough because it adquires the context set by AppRoutingModule.</p>
</div>
<div class="listingblock">
<div class="title">Listing 19. File first-routing.module.ts</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-ts hljs" data-lang="ts">const routes: Routes = [
  {
    path: '',
    component: FirstComponent
  },
  {
    path: 'second-left',
    component: ContentLeft
  },
  {
    path: 'second-right',
    component: ContentRight
  }
];</code></pre>
</div>
</div>
<div class="paragraph">
<p>If we go to '<em>first</em>' then FirstModule is situated in '<em>/first</em>' but also its children ContentLeft and ContentRight, so it is not necessary to write in their path '<em>first/second-left</em>' and '<em>first/second-right</em>', because that will situate the components on '<em>first/first/second-left</em>' and  '<em>first/first/second-right</em>'.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/angular/angular-lazy/first-lvl-wrong-path.png" alt="First level wrong path" width="800 link="images/angular/angular-lazy/first-lvl-wrong-path.png"">
</div>
<div class="title">Figure 18. First level lazy wrong path.</div>
</div>
<div class="paragraph">
<p>When we compile an app with lazy loaded modules, files containing them will be generated</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/angular/angular-lazy/compile-first-lazy.png" alt="First level lazy compilation" width="800 link="images/angular/angular-lazy/compile-first-lazy.png"">
</div>
<div class="title">Figure 19. First level lazy compilation.</div>
</div>
<div class="paragraph">
<p>And if we go to <em>developer tools &#8594; network</em>, we can find those modules loaded (if they are needed).</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/angular/angular-lazy/first-lvl-lazy.png" alt="First level lazy" width="800 link="images/angular/angular-lazy/first-lvl-lazy.png"">
</div>
<div class="title">Figure 20. First level lazy.</div>
</div>
<div class="paragraph">
<p>To load the component ContentComponent of SecondLeftModule lazily, we have to load SecondLeftModule as a children of FirstModule:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Change <strong>component</strong> to <strong>loadChildren</strong> and reference SecondLeftModule.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Listing 20. File first-routing.module.ts.</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-ts hljs" data-lang="ts">const routes: Routes = [
  {
    path: '',
    component: FirstComponent
  },
  {
    path: 'second-left',
    loadChildren: () =&gt; import('./second-left/second-left.module').then(m =&gt; m.SecondLeftModule),
  },
  {
    path: 'second-right',
    component: ContentRight
  }
];</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Remove SecondLeftModule at first.component.ts</p>
</li>
<li>
<p>Route the components inside SecondLeftModule. Without this step nothing would be displayed.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Listing 21. File second-left-routing.module.ts.</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-ts hljs" data-lang="ts">...
import { ContentComponent } from './content/content.component';

const routes: Routes = [
  {
    path: '',
    component: ContentComponent
  }
];

@NgModule({
  imports: [RouterModule.forChild(routes)],
  exports: [RouterModule]
})
export class SecondLeftRoutingModule { }</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>run <code>ng serve</code> to generate files containing the lazy modules.</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/angular/angular-lazy/second-lvl-lazy.png" alt="Second level lazy" width="800 link="images/angular/angular-lazy/second-lvl-lazy.png"">
</div>
<div class="title">Figure 21. Second level lazy loading compilation.</div>
</div>
<div class="paragraph">
<p>Clicking on <strong>[Go to left module]</strong> triggers the load of SecondLeftModule.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/angular/angular-lazy/second-lvl-left-lazy.png" alt="Second level lazy network" width="800 link="images/angular/angular-lazy/second-lvl-left-lazy.png"">
</div>
<div class="title">Figure 22. Second level lazy loading network.</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="guide-angular-lazy-loading.asciidoc_conclusion">18.3.2. Conclusion</h4>
<div class="paragraph">
<p>Lazy loading is a pattern useful when new features are added, these features are usually identified as modules which can be loaded only if needed as shown in this document, reducing the time spent loading an application.</p>
</div>
<!-- toc disabled -->
</div>
</div>
<div class="sect2">
<h3 id="guide-angular-library.asciidoc">18.4. Angular Library</h3>
<div class="paragraph">
<p><code>Angular CLI</code> provides us with methods that allow the creation of a library. After that, using either packet manager (<code>npm</code> or <code>yarn</code>) the library can be build and packed which will allow later to install/publish it.</p>
</div>
<div class="sect3">
<h4 id="guide-angular-library.asciidoc_whats-a-library">18.4.1. Whats a library?</h4>
<div class="paragraph">
<p>From <a href="https://en.wikipedia.org/wiki/Library_(computing)">wikipedia</a>: a library is a collection of non-volatile resources used by computer programs, often for software development. These may include configuration data, documentation, help data, message templates, pre-written code and subroutines, classes, values or type specifications.</p>
</div>
</div>
<div class="sect3">
<h4 id="guide-angular-library.asciidoc_how-to-build-a-library">18.4.2. How to build a library</h4>
<div class="paragraph">
<p>In this section, a library is going to be build step by step.</p>
</div>
<div class="sect4">
<h5 id="guide-angular-library.asciidoc_creating-an-empty-application">Creating an empty application</h5>
<div class="paragraph">
<p>First, using <code>Angular CLI</code> we are going to generate a empty application which will be later filled with the generated library. In order to do so, <code>Angular CLI</code> allows us to add to <code>ng new "application-name"</code> an option (<code>--create-application</code>). This option is going to tell <code>Angular CLI</code> not to create the initial <code>app</code> project. This is convenient since a library is going to be generated in later steps. Using this command <code>ng new "application-name" --create-application=false</code> an empty project with the name wanted is created.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>ng new "application-name" --create-application=false</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="guide-angular-library.asciidoc_generating-a-library">Generating a library</h5>
<div class="paragraph">
<p>After generating an empty application, a library is going to be generated. Inside the folder of the project, the <code>Angular CLI</code> command <code>ng generate library "library-name"</code> is going to generate the library as a project (<code>projects/"library-name"</code>). As an addition, the option <code>--prefix="library-prefix-wanted"</code> allows us to switch the default prefix that Angular generated with (<code>lib</code>). Using the option to change the prefix the command will look like this <code>ng generate library "library-name" --prefix="library-prefix-wanted"</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>ng generate library "library-name" --prefix="library-prefix-wanted"</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="guide-angular-library.asciidoc_generatingmodifying-in-our-library">Generating/Modifying in our library</h5>
<div class="paragraph">
<p>In the last step we generated a library. This generates automaticly a <code>module</code>,<code>service</code> and <code>component</code> inside (<code>projects/"library-name"</code>) that we can modify adding new methods, components etc that we want to use in other projects. We can generate other elements, using the usual <code>Angular CLI</code> generate commands adding the option <code>--project="library-name"</code> is going to allow to generate elements within our project . An example of this is: <code>ng generate service "name" --project="library-name"</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>ng generate "element" "name" --project="library-name"</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="guide-angular-library.asciidoc_exporting-the-generated-things">Exporting the generated things</h5>
<div class="paragraph">
<p>Inside the library (<code>projects/"library-name</code>) theres a <code>public_api.ts</code> which is the file that exports the elements inside the library. In case we generated other things, that file needs to be modified adding the extra exports with the generated elements. In addition, changing the library version is possible in the file <code>package.json</code>.</p>
</div>
</div>
<div class="sect4">
<h5 id="guide-angular-library.asciidoc_building-our-library">Building our library</h5>
<div class="paragraph">
<p>Once we added the necessary exports, in order to use the library in other applications, we need to build the library. The command <code>ng build "library-name"</code> is going to build the library, generating in <code>"project-name"/dist/"library-name"</code> the necessary files.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>ng build "library-name"</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="guide-angular-library.asciidoc_packing-the-library">Packing the library</h5>
<div class="paragraph">
<p>In this step we are going to pack the build library. In order to do so, we need to go inside <code>dist/"library-name"</code> and then run either <code>npm pack</code> or <code>yarn pack</code> to generate a <code>"library-name-version.tgz"</code> file.</p>
</div>
<div class="listingblock">
<div class="title">Listing 22. Packing using npm</div>
<div class="content">
<pre class="highlightjs highlight"><code>npm pack</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Listing 23. Packing using yarn</div>
<div class="content">
<pre class="highlightjs highlight"><code>yarn pack</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="guide-angular-library.asciidoc_publishing-to-npm-repository-optional">Publishing to npm repository (optional)</h5>
<div class="ulist">
<ul>
<li>
<p>Add a <em>README.md</em> and <em>LICENSE</em> file. The text inside <em>README.md</em> will be used in you npm package web page as documentation.</p>
</li>
<li>
<p>run <code>npm adduser</code> if you do not have a npm account to create it, otherwise run <code>npm login</code> and introduce your credentials.</p>
</li>
<li>
<p>run <code>npm publish</code> inside <code>dist/"library-name"</code> folder.</p>
</li>
<li>
<p>Check that the library is published: <a href="https://npmjs.com/package/library-name" class="bare">https://npmjs.com/package/library-name</a></p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="guide-angular-library.asciidoc_installing-our-library-in-other-projects">Installing our library in other projects</h5>
<div class="paragraph">
<p>In this step we are going to install/add the library on other projects.</p>
</div>
<div class="sect5">
<h6 id="guide-angular-library.asciidoc_npm">npm</h6>
<div class="paragraph">
<p>In order to add the library in other applications, there are two ways:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Option 1</strong>: From inside the application where the library is going to get used, using the command <code>npm install "path-to-tgz"/"library-name-version.tgz"</code> allows us to install the <code>.tgz</code> generated in <a href="#guide-angular-library.asciidoc_id-packing-library">Packing the library</a>.</p>
</li>
<li>
<p><strong>Option 2</strong>: run <code>npm install "library-name"</code> to install it from npm repository.</p>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="guide-angular-library.asciidoc_yarn">yarn</h6>
<div class="paragraph">
<p>To add the package using yarn:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Option 1</strong>: From inside the application where the library is going to get used, using the command <code>yarn add "path-to-tgz"/"library-name-version.tgz"</code> allows us to install the <code>.tgz</code>  generated in <a href="#guide-angular-library.asciidoc_id-packing-library">Packing the library</a>.</p>
</li>
<li>
<p><strong>Option 2</strong>: run <code>yarn add "library-name"</code> to install it from npm repository.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect4">
<h5 id="guide-angular-library.asciidoc_using-the-library">Using the library</h5>
<div class="paragraph">
<p>Finally, once the library was installed with either packet manager, you can start using the elements from inside like they would be used in a normal element inside the application. Example <code>app.component.ts</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-TypeScript hljs" data-lang="TypeScript">import { Component, OnInit } from '@angular/core';
import { MyLibraryService } from 'my-library';

@Component({
  selector: 'app-root',
  templateUrl: './app.component.html',
  styleUrls: ['./app.component.scss']
})
export class AppComponent implements OnInit {

  toUpper: string;

  constructor(private myLibraryService: MyLibraryService) {}
  title = 'devon4ng library test';
  ngOnInit(): void {
    this.toUpper = this.myLibraryService.firstLetterToUpper('test');
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Example <code>app.component.html</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-TypeScript hljs" data-lang="TypeScript">&lt;!--The content below is only a placeholder and can be replaced.--&gt;
&lt;div style="text-align:center"&gt;
  &lt;h1&gt;
    Welcome to {{ title }}!
  &lt;/h1&gt;
  &lt;img width="300" alt="Angular Logo" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAyNTAgMjUwIj4KICAgIDxwYXRoIGZpbGw9IiNERDAwMzEiIGQ9Ik0xMjUgMzBMMzEuOSA2My4ybDE0LjIgMTIzLjFMMTI1IDIzMGw3OC45LTQzLjcgMTQuMi0xMjMuMXoiIC8+CiAgICA8cGF0aCBmaWxsPSIjQzMwMDJGIiBkPSJNMTI1IDMwdjIyLjItLjFWMjMwbDc4LjktNDMuNyAxNC4yLTEyMy4xTDEyNSAzMHoiIC8+CiAgICA8cGF0aCAgZmlsbD0iI0ZGRkZGRiIgZD0iTTEyNSA1Mi4xTDY2LjggMTgyLjZoMjEuN2wxMS43LTI5LjJoNDkuNGwxMS43IDI5LjJIMTgzTDEyNSA1Mi4xem0xNyA4My4zaC0zNGwxNy00MC45IDE3IDQwLjl6IiAvPgogIDwvc3ZnPg=="&gt;
&lt;/div&gt;
&lt;h2&gt;Here is my library service being used: {{toUpper}}&lt;/h2&gt;
&lt;lib-my-library&gt;&lt;/lib-my-library&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Example <code>app.module.ts</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-TypeScript hljs" data-lang="TypeScript">import { BrowserModule } from '@angular/platform-browser';
import { NgModule } from '@angular/core';

import { AppRoutingModule } from './app-routing.module';
import { AppComponent } from './app.component';

import { MyLibraryModule } from 'my-library';
@NgModule({
  declarations: [
    AppComponent
  ],
  imports: [
    BrowserModule,
    AppRoutingModule,
    MyLibraryModule
  ],
  providers: [],
  bootstrap: [AppComponent]
})
export class AppModule { }</code></pre>
</div>
</div>
<div class="paragraph">
<p>The result from using the library:</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/angular-library/result.png"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/angular-library/result.png" alt="result"></a>
</div>
</div>
</div>
<div class="sect4">
<h5 id="guide-angular-library.asciidoc_devon4ng-libraries">devon4ng libraries</h5>
<div class="paragraph">
<p>In <a href="https://github.com/devonfw/devon4ng-library">devonfw/devon4ng-library</a> you can find some useful libraries:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Authorization module</strong>: This devon4ng Angular module adds rights-based authorization to your Angular app.</p>
</li>
<li>
<p><strong>Cache module</strong>: Use this devon4ng Angular module when you want to cache requests to server. You may configure it to store in cache only the requests you need and to set the duration you want.</p>
</li>
</ul>
</div>
<!-- toc disabled -->
</div>
</div>
</div>
<div class="sect2">
<h3 id="guide-angular-theming.asciidoc">18.5. Angular Material Theming</h3>
<div class="paragraph">
<p>Angular Material library offers UI components for developers, those components follows Google Material desing baselines but characteristics like colors can be modified in order to adapt them to the needs of the client: corporative colors, corporative identity, dark themes, &#8230;&#8203;</p>
</div>
<div class="sect3">
<h4 id="guide-angular-theming.asciidoc_theming-basics">18.5.1. Theming basics</h4>
<div class="paragraph">
<p>In Angular Material, a theme is created mixing multiple colors. Colors and its light and dark variants conform a <strong>palette</strong>. In general, a theme consists of the following palettes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>primary</strong>: Most used across screens and componets.</p>
</li>
<li>
<p><strong>accent</strong>: Floating action button and interactive elements.</p>
</li>
<li>
<p><strong>warn</strong>: Error state.</p>
</li>
<li>
<p><strong>foreground</strong>: Text and icons.</p>
</li>
<li>
<p><strong>background</strong>: Element backgrounds.</p>
</li>
</ul>
</div>
<div id="guide-angular-theming.asciidoc_id_palette_variants" class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/angular/angular-theming/palette.PNG" alt="Theme palette" width="600 link="images/angular/angular-theming/palette.PNG"">
</div>
<div class="title">Figure 23. Palettes and variants.</div>
</div>
<div class="paragraph">
<p>In angular material, a palette is represented as a scss map.</p>
</div>
<div id="guide-angular-theming.asciidoc_id_scss_map" class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/angular/angular-theming/scss-map.png" alt="Scss map" width="600 link="images/angular/angular-theming/scss-map.png"">
</div>
<div class="title">Figure 24. Scss map and palettes.</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Some components can be forced to use primary, accent or warn palettes using the attribute <strong>color</strong>, for example: &lt;mat-toolbar color="primary"&gt;.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="guide-angular-theming.asciidoc_prebuilt-themes">18.5.2. Prebuilt themes</h4>
<div class="paragraph">
<p>Available prebuilt themes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>deeppurple-amber.css</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/angular/angular-theming/deeppurple-amber.png" alt="deeppurple-amber theme" width="600 link="images/angular/angular-theming/deeppurple-amber.png"">
</div>
<div class="title">Figure 25. deeppurple-amber theme.</div>
</div>
<div class="ulist">
<ul>
<li>
<p>indigo-pink.css</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/angular/angular-theming/indigo-pink.png" alt="indigo-pink theme" width="600 link="images/angular/angular-theming/indigo-pink.png"">
</div>
<div class="title">Figure 26. indigo-pink theme.</div>
</div>
<div class="ulist">
<ul>
<li>
<p>pink-bluegrey.css</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/angular/angular-theming/pink-bluegrey.png" alt="pink-bluegrey theme" width="600 link="images/angular/angular-theming/pink-bluegrey.png"">
</div>
<div class="title">Figure 27. ink-bluegrey theme.</div>
</div>
<div class="ulist">
<ul>
<li>
<p>purple-green.css</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/angular/angular-theming/purple-green.png" alt="purple-green theme" width="600 link="images/angular/angular-theming/purple-green.png"">
</div>
<div class="title">Figure 28. purple-green theme.</div>
</div>
<div class="paragraph">
<p>The prebuilt themes can be added using <strong>@import</strong>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-css hljs" data-lang="css">@import '@angular/material/prebuilt-themes/deeppurple-amber.css';</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="guide-angular-theming.asciidoc_custom-themes">18.5.3. Custom themes</h4>
<div class="paragraph">
<p>Somethimes prebuild themes do not meet the needs of a project, because color schemas are too specific or do not incorporate branding colors, in those situations custom themes can be built to offer a better solution to the client.</p>
</div>
<div class="paragraph">
<p>For this topic, we are going to use a basic layout project that can be found in <a href="https://github.com/devonfw/devon4ng/tree/master/samples/AngularMaterialBasicLayout">devon4ng repository</a>.</p>
</div>
<div class="sect4">
<h5 id="guide-angular-theming.asciidoc_basics">Basics</h5>
<div class="paragraph">
<p>Before starting writing custom themes, there are some necessary things that have to be mentioned:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Add a default theme: The project mentioned before has just one global scss stylesheet <strong>styles.scss</strong> that includes indigo-pink.scss which will be the default theme.</p>
</li>
<li>
<p>Add <em>@import '~@angular/material/theming';</em> at the begining of the every stylesheet to be able to use angular material prebuilt color palettes and functions.</p>
</li>
<li>
<p>Add <em>@include mat-core();</em> <strong>once</strong> per project, so if you are writing multiple themes in multiple files you could import those files from a 'central' one (for example styles.scss). This includes all common styles that are used by multiple components.</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/angular/angular-theming/theme-files-structure.png" alt="Theme files structure" width="600 link="images/angular/angular-theming/theme-files-structure.png"">
</div>
<div class="title">Figure 29. Theme files structure.</div>
</div>
</div>
<div class="sect4">
<h5 id="guide-angular-theming.asciidoc_basic-custom-theme">Basic custom theme</h5>
<div class="paragraph">
<p>To create a new custom theme, the .scss file containing it has to have imported the angular _theming.scss file (angular/material/theming) file and mat-core included. _theming.scss includes multiple color palettes and some functions that we are going to see below. The file for this basic theme is going to be named <strong>styles-custom-dark.scss</strong>.</p>
</div>
<div class="paragraph">
<p>First, declare new variables for primary, accent and warn palettes. Those variables are going to store the result of the function <strong>mat-palette</strong>.</p>
</div>
<div class="paragraph">
<p><strong>mat-palette</strong> accepts four arguments: base color palette, main, lighter and darker variants (See <a href="#id_palette_variants">[id_palette_variants]</a>) and returns a new palette including some additional map values: default, lighter and darker (<a href="#id_scss_map">[id_scss_map]</a>). Only the first argument is mandatory.</p>
</div>
<div class="listingblock">
<div class="title">Listing 24. File styles-custom-dark.scss.</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-scss hljs" data-lang="scss">$custom-dark-theme-primary: mat-palette($mat-pink);
$custom-dark-theme-accent: mat-palette($mat-blue);
$custom-dark-theme-warn: mat-palette($mat-red);
);</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this example we are using colors available in _theming.scss: mat-pink, mat-blue, mat-red. If you want to use a custom color you need to define a new map, for instance:</p>
</div>
<div class="listingblock">
<div class="title">Listing 25. File styles-custom-dark.scss custom pink.</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-scss hljs" data-lang="scss">$my-pink: (
    50 : #fcf3f3,
    100 : #f9e0e0,
    200 : #f5cccc,
    300 : #f0b8b8,
    500 : #ea9999,
    900 : #db6b6b,
    A100 : #ffffff,
    A200 : #ffffff,
    A400 : #ffeaea,
    A700 : #ffd0d0,
    contrast: (
        50 : #000000,
        100 : #000000,
        200 : #000000,
        300 : #000000,
        900 : #000000,
        A100 : #000000,
        A200 : #000000,
        A400 : #000000,
        A700 : #000000,
    )
);

$custom-dark-theme-primary: mat-palette($my-pink);
...</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Some pages allows to create these palettes easily, for instance: <a href="http://mcg.mbitson.com" class="bare">http://mcg.mbitson.com</a>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Until now, we just have defined primary, accent and warn palettes but what about foreground and background? Angular material has two functions to change both:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>mat-light-theme</strong>: Receives as arguments primary, accent and warn palettes and return a theme whose foreground is basically black (texts, icons, &#8230;&#8203;), the background is white and the other palettes are the received ones.</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/angular/angular-theming/custom-light.png" alt="deeppurple-amber theme" width="600 link="images/angular/angular-theming/custom-light.png"">
</div>
<div class="title">Figure 30. Custom light theme.</div>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>mat-dark-theme</strong>: Similar to mat-light-theme but returns a theme whose foreground is basically white and background black.</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/angular/angular-theming/custom-dark.png" alt="deeppurple-amber theme" width="600 link="images/angular/angular-theming/custom-dark.png"">
</div>
<div class="title">Figure 31. Custom dark theme.</div>
</div>
<div class="paragraph">
<p>For this example we are going to use mat-dark-theme and save its result in $custom-dark-theme.</p>
</div>
<div class="listingblock">
<div class="title">Listing 26. File styles-custom-dark.scss updated with mat-dark-theme.</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-scss hljs" data-lang="scss">...

$custom-dark-theme: mat-dark-theme(
  $custom-dark-theme-primary,
  $custom-dark-theme-accent,
  $custom-dark-theme-warn
);</code></pre>
</div>
</div>
<div class="paragraph">
<p>To apply the saved theme, we have to go to <strong>styles.scss</strong> and import our <strong>styles-custom-dark.scss</strong> and include a function called <strong>angular-material-theme</strong> using the theme variable as argument.</p>
</div>
<div class="listingblock">
<div class="title">Listing 27. File styles.scss.</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-scss hljs" data-lang="scss">...
@import 'styles-custom-dark.scss';
@include angular-material-theme($custom-dark-theme);</code></pre>
</div>
</div>
<div class="paragraph">
<p>If we have multiple themes it is necessary to add the include statement inside a css class and use it in <strong>src/index.html &#8594; app-root component</strong>.</p>
</div>
<div class="listingblock">
<div class="title">Listing 28. File styles.scss updated with custom-dark-theme class.</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-scss hljs" data-lang="scss">...
@import 'styles-custom-dark.scss';

.custom-dark-theme {
  @include angular-material-theme($custom-dark-theme);
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Listing 29. File src/index.html.</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-html hljs" data-lang="html">...
&lt;app-root class="custom-dark-theme"&gt;&lt;/app-root&gt;
...</code></pre>
</div>
</div>
<div class="paragraph">
<p>This will apply <strong>$custom-dark-theme</strong> theme for the entire application.</p>
</div>
</div>
<div class="sect4">
<h5 id="guide-angular-theming.asciidoc_full-custom-theme">Full custom theme</h5>
<div class="paragraph">
<p>Sometimes it is needed to custom different elementsw from background and foreground, in those situations we have to create a new function similar to <em>mat-light-theme</em> and <em>mat-dark-theme</em>. Let&#8217;s focus con mat-light-theme:</p>
</div>
<div id="guide-angular-theming.asciidoc_source-mat-light" class="listingblock">
<div class="title">Listing 30. Source code of mat-light-theme</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-scss hljs" data-lang="scss">@function mat-light-theme($primary, $accent, $warn: mat-palette($mat-red)) {
  @return (
    primary: $primary,
    accent: $accent,
    warn: $warn,
    is-dark: false,
    foreground: $mat-light-theme-foreground,
    background: $mat-light-theme-background,
  );
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>As we can se, <em>mat-light-theme</em> takes three arguments and returs a map including them as primary, accent and warn color; but there are three more keys in that map: is-dark, foreground and background.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>is-dark</strong>: Boolean true if it is a dark theme, false otherwise.</p>
</li>
<li>
<p><strong>background</strong>: Map that stores the color for multiple background elements.</p>
</li>
<li>
<p><strong>foreground</strong>: Map that stores the color for multiple foreground elements.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To show which elements can be colored lets create a new theme in a file <strong>styles-custom-cap.scss</strong>:</p>
</div>
<div class="listingblock">
<div class="title">Listing 31. File styles-custom-cap.scss: Background and foreground variables.</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-scss hljs" data-lang="scss">@import '~@angular/material/theming';

// custom background and foreground palettes
$my-cap-theme-background: (
  status-bar: #0070ad,
  app-bar: map_get($mat-blue, 900),
  background: #12abdb,
  hover: rgba(white, 0.04),
  card: map_get($mat-red, 800),
  dialog: map_get($mat-grey, 800),
  disabled-button: $white-12-opacity,
  raised-button: map-get($mat-grey, 800),
  focused-button: $white-6-opacity,
  selected-button: map_get($mat-grey, 900),
  selected-disabled-button: map_get($mat-grey, 800),
  disabled-button-toggle: black,
  unselected-chip: map_get($mat-grey, 700),
  disabled-list-option: black,
);

$my-cap-theme-foreground: (
  base: yellow,
  divider: $white-12-opacity,
  dividers: $white-12-opacity,
  disabled: rgba(white, 0.3),
  disabled-button: rgba(white, 0.3),
  disabled-text: rgba(white, 0.3),
  hint-text: rgba(white, 0.3),
  secondary-text: rgba(white, 0.7),
  icon: white,
  icons: white,
  text: white,
  slider-min: white,
  slider-off: rgba(white, 0.3),
  slider-off-active: rgba(white, 0.3),
);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Function which uses the variables defined before to create a new theme:</p>
</div>
<div class="listingblock">
<div class="title">Listing 32. File styles-custom-cap.scss: Creating a new theme function.</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-scss hljs" data-lang="scss">// instead of creating a theme with mat-light-theme or mat-dark-theme,
// we will create our own theme-creating function that lets us apply our own foreground and background palettes.
@function create-my-cap-theme($primary, $accent, $warn: mat-palette($mat-red)) {
  @return (
    primary: $primary,
    accent: $accent,
    warn: $warn,
    is-dark: false,
    foreground: $my-cap-theme-foreground,
    background: $my-cap-theme-background
  );
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Calling the new function and storing its value in <strong>$custom-cap-theme</strong>.</p>
</div>
<div class="listingblock">
<div class="title">Listing 33. File styles-custom-cap.scss: Storing the new theme.</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-scss hljs" data-lang="scss">// We use create-my-cap-theme instead of mat-light-theme or mat-dark-theme
$custom-cap-theme-primary: mat-palette($mat-green);
$custom-cap-theme-accent: mat-palette($mat-blue);
$custom-cap-theme-warn: mat-palette($mat-red);

$custom-cap-theme: create-my-cap-theme(
  $custom-cap-theme-primary,
  $custom-cap-theme-accent,
  $custom-cap-theme-warn
);</code></pre>
</div>
</div>
<div class="paragraph">
<p>After defining our new theme, we can import it from styles.scss.</p>
</div>
<div class="listingblock">
<div class="title">Listing 34. File styles.scss updated with custom-cap-theme class.</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-scss hljs" data-lang="scss">...
@import 'styles-custom-cap.scss';
.custom-cap-theme {
  @include angular-material-theme($custom-cap-theme);
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="guide-angular-theming.asciidoc_multiple-themes-and-overlay-based-components">Multiple themes and overlay-based components</h5>
<div class="paragraph">
<p>Certain components (e.g. menu, select, dialog, etc.) that are inside of a global overlay container,require an additional step to be affected by the theme&#8217;s css class selector.</p>
</div>
<div class="listingblock">
<div class="title">Listing 35. File app.module.ts</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-ts hljs" data-lang="ts">import {OverlayContainer} from '@angular/cdk/overlay';

@NgModule({
  // ...
})
export class AppModule {
  constructor(overlayContainer: OverlayContainer) {
    overlayContainer.getContainerElement().classList.add('custom-cap-theme');
  }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="guide-angular-theming.asciidoc_useful-resources">18.5.4. Useful resources</h4>
<div class="ulist">
<ul>
<li>
<p><a href="https://material.angular.io/guide/theming">Angular Material&#8217;s oficial theming guide</a></p>
</li>
<li>
<p><a href="https://material.io/design/color/#color-theme-creation">Material Desing: Color theme creation</a></p>
</li>
<li>
<p><a href="http://mcg.mbitson.com">Palette generator</a></p>
</li>
<li>
<p><a href="https://sass-lang.com/guide">SCSS tutorial</a></p>
</li>
</ul>
</div>
<!-- toc disabled -->
</div>
</div>
<div class="sect2">
<h3 id="guide-angular-pwa.asciidoc">18.6. Angular Progressive Web App</h3>
<div class="paragraph">
<p>Progresive web applications (PWAs) are web application that offer better user experience than the traditional ones. In general, they solve problems related with reliability and speed:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>Reliability</em>:  PWAs are stable. In this context stability means than even with slow connections or even with no network at all, the application still works. To achieve this, some basic resources like styles, fonts, requests, &#8230;&#8203; are stored; due to this caching, it is not possible to assure that the content is always up-to-date.</p>
</li>
<li>
<p><em>Speed</em>: When an users opens an application, he or she will expect it to load almost inmediately (almost 53% of users abandon sites that take longer that 3 seconds, source: <a href="https://developers.google.com/web/progressive-web-apps/#fast" class="bare">https://developers.google.com/web/progressive-web-apps/#fast</a>).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>PWAs uses a script called <a href="https://developers.google.com/web/fundamentals/primers/service-workers/">service worker</a>, which runs in background and essentially act as proxy between web app and network, intercepting requests and acting depending on the network conditions.</p>
</div>
<div class="sect3">
<h4 id="guide-angular-pwa.asciidoc_assumptions">18.6.1. Assumptions</h4>
<div class="paragraph">
<p>This guide assumes that you already have installed:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Node.js</p>
</li>
<li>
<p>npm package manager</p>
</li>
<li>
<p>Angular CLI</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="guide-angular-pwa.asciidoc_sample-application">18.6.2. Sample Application</h4>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/angular/angular-pwa/mts-pwa-rec.png" alt="My thai star recommendation" width="800 link="images/angular/angular-pwa/mts-pwa-rec.png"">
</div>
<div class="title">Figure 32. Basic angular PWA.</div>
</div>
<div class="paragraph">
<p>To explain how to build PWAs using angular, a basic application is going to be built. This app will be able to ask for resources and save in the cache in order to work even offline.</p>
</div>
<div class="sect4">
<h5 id="guide-angular-pwa.asciidoc_step-1-create-a-new-project">Step 1: Create a new project</h5>
<div class="paragraph">
<p>This step can be completed with one simple command: <code>ng new &lt;name&gt;</code>, where &lt;names&gt; is the name for the app. In this case, the app is going to be named <strong>basic-ng-pwa</strong>.</p>
</div>
</div>
<div class="sect4">
<h5 id="guide-angular-pwa.asciidoc_step-2-create-a-service">Step 2: Create a service</h5>
<div class="paragraph">
<p>Web applications usually uses external resources, making necessary the addition of services which can get those resources. This application gets a dish from My Thai Star&#8217;s back-end and shows it. To do so, a new service is going to be created.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>go to project folder: <code>cd basic-ng-pwa</code></p>
</li>
<li>
<p>run <code>ng generate service data</code></p>
</li>
<li>
<p>Modify <strong>data.service.ts</strong>, <strong>environment.ts</strong>, <strong>environment.prod.ts</strong></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To retrieve data with this service, you have to import the module HttpClient and add it to the service&#8217;s contructor. Once added, use it to create a function <strong>getDishes()</strong> that sends http request to My Thai Start&#8217;s back-end. The URL of the back-end can be stored as an environment variable <strong>MY_THAI_STAR_DISH</strong>.</p>
</div>
<div class="paragraph">
<p><strong>data.service.ts</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-ts hljs" data-lang="ts">  ...
  import { HttpClient } from '@angular/common/http';
  import { MY_THAI_STAR_DISH } from '../environments/environment';
  ...

  export class DataService {
    constructor(private http: HttpClient) {}

    /* Get data from Back-end */
    getDishes() {
      return this.http.get(MY_THAI_STAR_DISH);
    }
    ...
  }</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>environments.ts</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-ts hljs" data-lang="ts">  ...
  export const MY_THAI_STAR_DISH =
  'http://de-mucdevondepl01:8090/api/services/rest/dishmanagement/v1/dish/1';
  ...</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>environments.prod.ts</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-ts hljs" data-lang="ts">  ...
  export const MY_THAI_STAR_DISH =
  'http://de-mucdevondepl01:8090/api/services/rest/dishmanagement/v1/dish/1';
  ...</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="guide-angular-pwa.asciidoc_step-3-use-the-service">Step 3: Use the service</h5>
<div class="paragraph">
<p>The component AppComponent implements the interface OnInit and inside its method ngOnInit() the suscription to the services is done. When a dish arrives, it is saved and shown (app.component.html).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-ts hljs" data-lang="ts">  ...
  import { DataService } from './data.service';
  export class AppComponent implements OnInit {
  dish: { name: string; description: string } = { name: '', description: ''};

  ...
  ngOnInit() {
    this.data
      .getDishes()
      .subscribe(
        (dishToday: { dish: { name: string; description: string } }) =&gt; {
          this.dish = {
            name: dishToday.dish.name,
            description: dishToday.dish.description,
          };
        },
      );
  }
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="guide-angular-pwa.asciidoc_step-4-structures">Step 4: Structures, styles and updates</h5>
<div class="paragraph">
<p>This step shows code interesting inside the sample app. The complete content can be found in <a href="https://github.com/devonfw/devon4ng/tree/master/samples/AngularBasicPWA">devon4ng samples</a>.</p>
</div>
<div class="paragraph">
<p><strong>index.html</strong></p>
</div>
<div class="paragraph">
<p>To use the Montserrat font add the following link inside the tag header.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-html hljs" data-lang="html">  &lt;link href="https://fonts.googleapis.com/css?family=Montserrat" rel="stylesheet"&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>styles.scss</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-css hljs" data-lang="css">  body {
    ...
    font-family: 'Montserrat', sans-serif;
  }</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>app.component.ts</strong></p>
</div>
<div class="paragraph">
<p>This file is also used to reload the app if there are any changes.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>SwUpdate</em>: This object comes inside the @angular/pwa package and it is used to detect changes and reload the page if needed.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-ts hljs" data-lang="ts">  ...
  import { SwUpdate } from '@angular/service-worker';

  export class AppComponent implements OnInit {

  ...
    constructor(updates: SwUpdate, private data: DataService) {
      updates.available.subscribe((event) =&gt; {
        updates.activateUpdate().then(() =&gt; document.location.reload());
      });
    }
    ...
  }</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="guide-angular-pwa.asciidoc_step-5-make-it-progressive.">Step 5: Make it Progressive.</h5>
<div class="paragraph">
<p>Turining an angular app into a PWA is pretty easy, just one module has to be added. To do so, run: <code>ng add @angular/pwa</code>. This command also adds two important files, explained below.</p>
</div>
<div class="paragraph">
<p>&#160;<br>
&#160;<br></p>
</div>
<div class="ulist">
<ul>
<li>
<p>manifest.json</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>manifest.json is a file that allows to control how the app is displayed in places where native apps are displayed.</p>
</div>
<div class="paragraph">
<p><strong>Fields</strong></p>
</div>
<div class="paragraph">
<p><em>name</em>: Name of the web application.</p>
</div>
<div class="paragraph">
<p><em>short_name</em>: Short version of name.</p>
</div>
<div class="paragraph">
<p><em>theme_color</em>: Default theme color for an application context.</p>
</div>
<div class="paragraph">
<p><em>background_color</em>: Expected background color of the web application.</p>
</div>
<div class="paragraph">
<p><em>display</em>: Preferred display mode.</p>
</div>
<div class="paragraph">
<p><em>scope</em>: Navigation scope of tghis web application&#8217;s application context.</p>
</div>
<div class="paragraph">
<p><em>start_url</em>: URL loaded when the user launches the web application.</p>
</div>
<div class="paragraph">
<p><em>icons</em>: Array of icons that serve as representations of the web app.</p>
</div>
<div class="paragraph">
<p>Additional information can be found <a href="https://developers.google.com/web/fundamentals/web-app-manifest/">here</a>.</p>
</div>
<div class="paragraph">
<p>&#160;<br>
&#160;<br></p>
</div>
<div class="ulist">
<ul>
<li>
<p>ngsw-config.json</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>nsgw-config.json specifies which files and data URLs have to be cached and updated by the Angular service worker.</p>
</div>
<div class="paragraph">
<p><strong>Fields</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>index</em>: File that serves as index page to satisfy navigation requests.</p>
</li>
<li>
<p><em>assetGroups</em>: Resources that are part of the app version that update along with the app.</p>
<div class="ulist">
<ul>
<li>
<p><em>name</em>: Identifies the group.</p>
</li>
<li>
<p><em>installMode</em>: How the resources are cached (prefetch or lazy).</p>
</li>
<li>
<p><em>updateMode</em>: Caching behaviour when a new version of the app is found (prefetch or lazy).</p>
</li>
<li>
<p><em>resources</em>: Resources to cache. There are three groups.</p>
<div class="ulist">
<ul>
<li>
<p><em>files</em>: Lists patterns that match files in the distribution directory.</p>
</li>
<li>
<p><em>urls</em>:  URL patterns matched at runtime.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
<li>
<p><em>dataGroups</em>: UsefulIdentifies the group. for API requests.</p>
<div class="ulist">
<ul>
<li>
<p><em>name</em>: Identifies the group.</p>
</li>
<li>
<p><em>urls</em>: URL patterns matched at runtime.</p>
</li>
<li>
<p><em>version</em>:  Indicates that the resources being cached have been updated in a backwards-incompatible way.</p>
</li>
<li>
<p><em>cacheConfig</em>: Policy by which matching requests will be cached</p>
<div class="ulist">
<ul>
<li>
<p><em>maxSize</em>: The maximum number of entries, or responses, in the cache.</p>
</li>
<li>
<p><em>maxAge</em>: How long responses are allowed to remain in the cache.</p>
<div class="ulist">
<ul>
<li>
<p>d: days. (5d = 5 days).</p>
</li>
<li>
<p>h: hours</p>
</li>
<li>
<p>m: minutes</p>
</li>
<li>
<p>s: seconds. (5m20s = 5 minutes and 20 seconds).</p>
</li>
<li>
<p>u: milliseconds</p>
</li>
</ul>
</div>
</li>
<li>
<p><em>timeout</em>: How long the Angular service worker will wait for the network to respond before using a cached response. Same dataformat as maxAge.</p>
</li>
<li>
<p><em>strategy</em>: Caching strategies (performance or freshness).</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
<li>
<p><em>navigationUrls</em>: List of URLs that will be redirected to the index file.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Additional information can be found <a href="https://angular.io/guide/service-worker-config">here</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="guide-angular-pwa.asciidoc_step-6-configure-the-app">Step 6: Configure the app</h5>
<div class="paragraph">
<p><strong>manifest.json</strong></p>
</div>
<div class="paragraph">
<p>Default configuration.</p>
</div>
<div class="paragraph">
<p>&#160;<br>
&#160;<br>
<strong>ngsw-config.json</strong></p>
</div>
<div class="paragraph">
<p>At <em>assetGroups &#8594; resources &#8594; urls</em>: In this field the google fonts api is added in order to use Montserrat font even without network.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>  "urls": [
          "https://fonts.googleapis.com/**"
        ]</code></pre>
</div>
</div>
<div class="paragraph">
<p>At the root of the json: A data group to cache API calls.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>  {
    ...
    "dataGroups": [{
      "name": "mythaistar-dishes",
      "urls": [
        "http://de-mucdevondepl01:8090/api/services/rest/dishmanagement/v1/dish/1"
      ],
      "cacheConfig": {
        "maxSize": 100,
        "maxAge": "1h",
        "timeout": "10s",
        "strategy": "freshness"
      }
    }]
  }</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="guide-angular-pwa.asciidoc_step-7-check-that-your-app-is-a-pwa">Step 7: Check that your app is a PWA</h5>
<div class="paragraph">
<p>To check if an app is a PWA lets compare its normal behaviour against itself but built for production. Run in the project&#8217;s root folder the commands below:</p>
</div>
<div class="paragraph">
<p><code>ng build --prod</code> to build the app using production settings.</p>
</div>
<div class="paragraph">
<p><code>npm install http-server</code> to install an npm module that can serve your built application. Documentation <a href="https://www.npmjs.com/package/http-server">here</a>.</p>
</div>
<div class="paragraph">
<p>Go to the dist/basic-ng-pwa/ folder running <code>cd dist/basic-ng-pwa</code>.</p>
</div>
<div class="paragraph">
<p><code>http-server -o</code> to serve your built app.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/angular/angular-pwa/http-serve.png" alt="Http server running" width="600 link="images/angular/angular-pwa/http-serve.png"">
</div>
<div class="title">Figure 33. Http server running on localhost:8081.</div>
</div>
<div class="paragraph">
<p>&#160;</p>
</div>
<div class="paragraph">
<p>In another console instance run <code>ng serve</code> to open the common app (not built).</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/angular/angular-pwa/ng-serve.png" alt=".Angular server running" width="600 link="images/angular/angular-pwa/ng-serve.png"">
</div>
<div class="title">Figure 34. Angular server running on localhost:4200.</div>
</div>
<div class="paragraph">
<p>&#160;</p>
</div>
<div class="paragraph">
<p>The first difference can be found on <em>Developer tools &#8594; application</em>, here it is seen that the PWA application (left) has a service worker and the common (right) one does not.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/angular/angular-pwa/pwa-nopwa-app-ng.png" alt="Application comparison" width="800 link="images/angular/angular-pwa/pwa-nopwa-app-ng.png"">
</div>
<div class="title">Figure 35. Application service worker comparison.</div>
</div>
<div class="paragraph">
<p>&#160;</p>
</div>
<div class="paragraph">
<p>If the "offline" box is checked, it will force a disconnection from network. In situations where users do not have connectivity or have a slow, one the PWA can still be accesed and used.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/angular/angular-pwa/online-offline-ng.png" alt="Online offline apps" width="800 link="images/angular/angular-pwa/online-offline-ng.png"">
</div>
<div class="title">Figure 36. Offline application.</div>
</div>
<div class="paragraph">
<p>&#160;</p>
</div>
<div class="paragraph">
<p>Finally, browser extensions like <a href="https://chrome.google.com/webstore/detail/lighthouse/blipmdconlkpinefehnmjammfjpmpbjk">Lighthouse</a> can be used to test whether an application is progressive or not.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/angular/angular-pwa/lighthouse-ng.png" alt="Lighthouse report" width="800 link="images/angular/angular-pwa/lighthouse-ng.png"">
</div>
<div class="title">Figure 37. Lighthouse report.</div>
</div>
<!-- toc disabled -->
</div>
</div>
</div>
<div class="sect2">
<h3 id="guide-app-initializer.asciidoc">18.7. APP_INITIALIZER</h3>
<div class="sect3">
<h4 id="guide-app-initializer.asciidoc_what-is-the-app_initializer-pattern">18.7.1. What is the APP_INITIALIZER pattern</h4>
<div class="paragraph">
<p>The APP_INITIALIZER pattern allows an aplication to choose which configuration is going to be used in the start of the application, this is useful because it allows to setup different configurations, for example, for docker or a remote configuration. This provides benefits since this is done on <code>runtime</code>, so theres no need to recompile the whole application to switch from configuration.</p>
</div>
</div>
<div class="sect3">
<h4 id="guide-app-initializer.asciidoc_what-is-app_initializer">18.7.2. What is APP_INITIALIZER</h4>
<div class="paragraph">
<p>APP_INITIALIZER allows to provide a service in the initialization of the application in a <code>@NgModule</code>. It also allows to use a factory, allowing to create a singleton in the same service. An example can be found in MyThaiStar <code>/core/config/config.module.ts</code>:</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The provider expects the return of a <code>Promise</code>, if it is using Observables, a change with the method <code>toPromise()</code> will allow a switch from <code>Observable</code> to <code>Promise</code></p>
</div>
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-TypeScript hljs" data-lang="TypeScript">import { NgModule, APP_INITIALIZER } from '@angular/core';
import { HttpClientModule } from '@angular/common/http';

import { ConfigService } from './config.service';

@NgModule({
  imports: [HttpClientModule],
  providers: [
    ConfigService,
    {
      provide: APP_INITIALIZER,
      useFactory: ConfigService.factory,
      deps: [ConfigService],
      multi: true,
    },
  ],
})
export class ConfigModule {}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This is going to allow the creation of a <code>ConfigService</code> where, using a singleton, the service is going to load an external config depending on a route. This dependence with a route, allows to setup diferent configuration for docker etc. This is seen in the <code>ConfigService</code> of MyThaiStar:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-TypeScript hljs" data-lang="TypeScript">import { Injectable } from '@angular/core';
import { HttpClient } from '@angular/common/http';
import { Config, config } from './config';

@Injectable()
export class ConfigService {
  constructor(private httpClient: HttpClient) {}

  static factory(appLoadService: ConfigService) {
    return () =&gt; appLoadService.loadExternalConfig();
  }

  // this method gets external configuration calling /config endpoint
  //and merges into config object
  loadExternalConfig(): Promise&lt;any&gt; {
    if (!environment.loadExternalConfig) {
      return Promise.resolve({});
    }

    const promise = this.httpClient
      .get('/config')
      .toPromise()
      .then((settings) =&gt; {
        Object.keys(settings || {}).forEach((k) =&gt; {
          config[k] = settings[k];
        });
        return settings;
      })
      .catch((error) =&gt; {
        return 'ok, no external configuration';
      });

    return promise;
  }

  getValues(): Config {
    return config;
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>As it is mentioned earlier, you can see the use of a factory to create a singleton at the start. After that, <code>loadExternalConfig</code> is going to look for a boolean inside the corresponding environment file inside the path <code>src/environments/</code>, this boolean <code>loadExternalConfig</code> is going to easily allow to switch to a external config. If it is true, it generates a promise that overwrites the parameters of the local config, allowing to load the external config. Finally, the last method <code>getValues()</code> is going to allow to return the file config with the values (overwritten or not). The local <code>config</code> file from MyThaiStar can be seen here:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-TypeScript hljs" data-lang="TypeScript">export enum BackendType {
  IN_MEMORY,
  REST,
  GRAPHQL,
}

interface Role {
  name: string;
  permission: number;
}

interface Lang {
  label: string;
  value: string;
}

export interface Config {
  version: string;
  backendType: BackendType;
  restPathRoot: string;
  restServiceRoot: string;
  pageSizes: number[];
  pageSizesDialog: number[];
  roles: Role[];
  langs: Lang[];
}

export const config: Config = {
  version: 'dev',
  backendType: BackendType.REST,
  restPathRoot: 'http://localhost:8081/mythaistar/',
  restServiceRoot: 'http://localhost:8081/mythaistar/services/rest/',
  pageSizes: [8, 16, 24],
  pageSizesDialog: [4, 8, 12],
  roles: [
    { name: 'CUSTOMER', permission: 0 },
    { name: 'WAITER', permission: 1 },
  ],
  langs: [
    { label: 'English', value: 'en' },
    { label: 'Deutsch', value: 'de' },
    { label: 'Español', value: 'es' },
    { label: 'Català', value: 'ca' },
    { label: 'Français', value: 'fr' },
    { label: 'Nederlands', value: 'nl' },
    { label: 'हिन्दी', value: 'hi' },
    { label: 'Polski', value: 'pl' },
    { label: 'Русский', value: 'ru' },
    { label: 'български', value: 'bg' },
  ],
};</code></pre>
</div>
</div>
<div class="paragraph">
<p>Finally, inside a environment file <code>src/environments/environment.ts</code> the use of the boolean <code>loadExternalConfig</code> is seen:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-TypeScript hljs" data-lang="TypeScript">// The file contents for the current environment will overwrite these during build.
// The build system defaults to the dev environment which uses `environment.ts`, but if you do
// `ng build --env=prod` then `environment.prod.ts` will be used instead.
// The list of which env maps to which file can be found in `.angular-cli.json`.

export const environment: {
  production: boolean;
  loadExternalConfig: boolean;
} = { production: false, loadExternalConfig: false };</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="guide-app-initializer.asciidoc_creating-a-app_initializer-configuration">18.7.3. Creating a APP_INITIALIZER configuration</h4>
<div class="paragraph">
<p>This section is going to be used to create a new <code>APP_INITIALIZER</code> basic example. For this, a basic app with angular is going to be generated using <code>ng new "appname"</code> substituting <code>appname</code> for the name of the app choosed.</p>
</div>
</div>
<div class="sect3">
<h4 id="guide-app-initializer.asciidoc_setting-up-the-config-files">18.7.4. Setting up the config files</h4>
<div class="sect4">
<h5 id="guide-app-initializer.asciidoc_docker-external-configuration-optional">Docker external configuration (Optional)</h5>
<div class="paragraph">
<p>This section is only done if theres a docker configuration in the app you are setting up this type of configuration.</p>
</div>
<div class="paragraph">
<p>1.- Create in the root folder <code>/docker-external-config.json</code>. This external config is going to be used when the application is loaded with docker (if the boolean to load the external configuration is set to true). Here you need to add all the config parameter you want to load with docker:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
    "version": "docker-version"
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>2.- In the root, in the file <code>/Dockerfile</code> angular is going to copy the <code>docker-external-config.json</code> that was created before into the nginx html route:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>....
COPY docker-external-config.json /usr/share/nginx/html/docker-external-config.json
....</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="guide-app-initializer.asciidoc_external-json-configuration">External json configuration</h5>
<div class="paragraph">
<p>1.- Create a json file in the route <code>/src/external-config.json</code>. This external config is going to be used when the application is loaded with the start script (if the boolean to load the external configuration is set to true). Here you need to add all the config parameter you want to load:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
    "version": "external-config"
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>2.- The file named <code>/angular.json</code> located at the root is going to be modified to add the file <code>external-config.json</code> that was just created to both <code>"assets"</code> inside <code>Build</code> and <code>Test</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">	....
	"build": {
          ....
            "assets": [
              "src/assets",
              "src/data",
              "src/favicon.ico",
              "src/manifest.json",
              "src/external-config.json"
            ]
	        ....
        "test": {
	  ....
	   "assets": [
              "src/assets",
              "src/data",
              "src/favicon.ico",
              "src/manifest.json",
              "src/external-config.json"
            ]
	  ....</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="guide-app-initializer.asciidoc_setting-up-the-proxies">18.7.5. Setting up the proxies</h4>
<div class="paragraph">
<p>This step is going to setup two proxies. This is going to allow to load the config desired by the context, in case that it is using docker to load the app or in case it loads the app with angular. Loading diferent files is made posible by the fact that the <code>ConfigService</code> method <code>loadExternalConfig()</code> looks for the path <code>/config</code>.</p>
</div>
<div class="sect4">
<h5 id="guide-app-initializer.asciidoc_docker-optional">Docker (Optional)</h5>
<div class="paragraph">
<p>1.- This step is going to be for docker. Add <code>docker-external-config.json</code> to nginx configuration (<code>/nginx.conf</code>) that is in the root of the application:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>....
  location  ~ ^/config {
        alias /usr/share/nginx/html/docker-external-config.json;
  }
....</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="guide-app-initializer.asciidoc_external-configuration">External Configuration</h5>
<div class="paragraph">
<p>1.- Now the file <code>/proxy.conf.json</code>, needs to be created/modified this file can be found in the root of the application. In this file you can add the route of the external configuration in <code>target</code> and the name of the file in <code>^/config:</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">....
  "/config": {
    "target": "http://localhost:4200",
    "secure": false,
    "pathRewrite": {
      "^/config": "/external-config.json"
    }
  }
....</code></pre>
</div>
</div>
<div class="paragraph">
<p>2.- The file <code>package.json</code> found in the root of the application is gonna use the start script to load the proxy config that was just created:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">  "scripts": {
....
    "start": "ng serve --proxy-config proxy.conf.json -o",
....</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="guide-app-initializer.asciidoc_adding-the-loadexternalconfig-boolean-to-the-environments">18.7.6. Adding the loadExternalConfig boolean to the environments</h4>
<div class="paragraph">
<p>In order to load an external config we need to add the loadExternalConfig boolean to the environments. To do so, inside the folder <code>environments/</code> the files are going to get modified adding this boolean to each environment that is going to be used. In this case, only two environments are going to be modified (<code>environment.ts</code> and <code>environment.prod.ts</code>). Down below theres an example of the modification being done in the <code>environment.prod.ts</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-TypeScript hljs" data-lang="TypeScript">export const environment: {
  production: boolean;
  loadExternalConfig: boolean;
} = { production: false, loadExternalConfig: false };</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the file in first instance theres the declaration of the types of the variables. After that, theres the definition of those variables. This variable <code>loadExternalConfig</code> is going to be used by the service, allowing to setup a external config just by switching the <code>loadExternalConfig</code> to true.</p>
</div>
</div>
<div class="sect3">
<h4 id="guide-app-initializer.asciidoc_creating-core-configuration-service">18.7.7. Creating core configuration service</h4>
<div class="paragraph">
<p>In order to create the whole configuration module three are going to be created:</p>
</div>
<div class="paragraph">
<p>1.- Create in the core <code>app/core/config/</code> a <code>config.ts</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-TypeScript hljs" data-lang="TypeScript">  export interface Config {
    version: string;
  }

  export const config: Config = {
    version: 'dev'
  };</code></pre>
</div>
</div>
<div class="paragraph">
<p>Taking a look to this file, it creates a interface (<code>Config</code>) that is going to be used by the variable that exports (<code>export const config: Config</code>). This variable <code>config</code> is going to be used by the service that is going to be created.</p>
</div>
<div class="paragraph">
<p>2.- Create in the core <code>app/core/config/</code> a <code>config.service.ts</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-TypeScript hljs" data-lang="TypeScript">import { Injectable } from '@angular/core';
import { HttpClient } from '@angular/common/http';
import { Config, config } from './config';

@Injectable()
export class ConfigService {
  constructor(private httpClient: HttpClient) {}

  static factory(appLoadService: ConfigService) {
    return () =&gt; appLoadService.loadExternalConfig();
  }

  // this method gets external configuration calling /config endpoint
  // and merges into config object
  loadExternalConfig(): Promise&lt;any&gt; {
    if (!environment.loadExternalConfig) {
      return Promise.resolve({});
    }

    const promise = this.httpClient
      .get('/config')
      .toPromise()
      .then((settings) =&gt; {
        Object.keys(settings || {}).forEach((k) =&gt; {
          config[k] = settings[k];
        });
        return settings;
      })
      .catch((error) =&gt; {
        return 'ok, no external configuration';
      });

    return promise;
  }

  getValues(): Config {
    return config;
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>As it was explained in previous steps, at first, there is a factory that uses the method <code>loadExternalConfig()</code>, this factory is going to be used in later steps in the module. After that, the <code>loadExternalConfig()</code> method checks if the boolean in the environment is false. If it is false it will return the promise resolved with the normal config. Else, it is going to load the external config in the path (<code>/config</code>), and overwrite the values from the external config to the config thats going to be used by the app, this is all returned in a promise.</p>
</div>
<div class="paragraph">
<p>3.- Create in the core a module for the config <code>app/core/config/</code> a <code>config.module.ts</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-TypeScript hljs" data-lang="TypeScript">import { NgModule, APP_INITIALIZER } from '@angular/core';
import { HttpClientModule } from '@angular/common/http';

import { ConfigService } from './config.service';

@NgModule({
  imports: [HttpClientModule],
  providers: [
    ConfigService,
    {
      provide: APP_INITIALIZER,
      useFactory: ConfigService.factory,
      deps: [ConfigService],
      multi: true,
    },
  ],
})
export class ConfigModule {}</code></pre>
</div>
</div>
<div class="paragraph">
<p>As seen earlier, the <code>ConfigService</code> is added to the module. In this addition, the app is initialized(<code>provide</code>) and it uses the factory that was created in the <code>ConfigService</code> loading the config with or without the external values depending on the boolean in the <code>config</code>.</p>
</div>
<div class="sect4">
<h5 id="guide-app-initializer.asciidoc_using-the-config-service">Using the Config Service</h5>
<div class="paragraph">
<p>As a first step, in the file <code>/app/app.module.ts</code> the <code>ConfigModule</code> created earlier in the other step is going to be imported:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-TypeScript hljs" data-lang="TypeScript">  imports: [
    ....
    ConfigModule,
    ....
  ]</code></pre>
</div>
</div>
<div class="paragraph">
<p>After that, the <code>ConfigService</code> is going to be injected into the <code>app.component.ts</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-TypeScript hljs" data-lang="TypeScript">....
import { ConfigService } from './core/config/config.service';
....
export class AppComponent {
....
  constructor(public configService: ConfigService) { }
....</code></pre>
</div>
</div>
<div class="paragraph">
<p>Finally, for this demonstration app, the component <code>app/app.component.html</code> is going to show the version of the config it is using at that moment.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-html hljs" data-lang="html">&lt;div style="text-align:center"&gt;
  &lt;h1&gt;
    Welcome to {{ title }}!
  &lt;/h1&gt;
&lt;/div&gt;
&lt;h2&gt;Here is the configuration version that is using angular right now: {{configService.getValues().version}}&lt;/h2&gt;</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="guide-app-initializer.asciidoc_final-steps">Final steps</h5>
<div class="paragraph">
<p>The script <code>start</code> that was created earlier in the <code>package.json</code> (<code>npm start</code>) is going to be used to start the application. After that, modifying the boolean <code>loadExternalConfig</code> inside the corresponding environment file inside <code>/app/environments/</code> should show the different config versions.</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/loadExternalConfigFalse.png"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/app-initializer/loadExternalConfigFalse.png" alt="loadExternalConfigFalse"></a>
</div>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/loadExternalConfigTrue.png"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/app-initializer/loadExternalConfigTrue.png" alt="loadExternalConfigTrue"></a>
</div>
</div>
<!-- toc disabled -->
</div>
</div>
</div>
<div class="sect2">
<h3 id="guide-component-decomposition.asciidoc">18.8. Component Decomposition</h3>
<div class="paragraph">
<p>When implementing a new requirement there are a few design decisions, which need to be considered.
A decomposition in <em>Smart</em> and <em>Dumb Components</em> should be done first.
This includes the definition of state and responsibilities.
Implementing a new dialog will most likely be done by defining a new <em>Smart Component</em> with multiple <em>Dumb Component</em> children.</p>
</div>
<div class="paragraph">
<p>In the component tree this would translate to the definition of a new subtree.</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/component-tree-highlighted-subtree.svg"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/component-tree-highlighted-subtree.svg" alt="Component Tree With Highlighted Sub Tree" width="450"></a>
</div>
<div class="title">Figure 38. Component Tree with highlighted subtree</div>
</div>
<div class="sect3">
<h4 id="guide-component-decomposition.asciidoc_defining-components">18.8.1. Defining Components</h4>
<div class="paragraph">
<p>The following gives an example for component decomposition.
Shown is a screenshot from a styleguide to be implemented.
It is a widget called <code>Listpicker</code>.</p>
</div>
<div class="paragraph">
<p>The basic function is an <code>input</code> field accepting direct input.
So typing <code>otto</code> puts <code>otto</code> inside the <code>FormControl</code>.
With arrow down key or by clicking the icon displayed in the inputs right edge a dropdown is opened.
Inside possible values can be selected and filtered beforehand.
After pressing arrow down key the focus should move into the filter input field.
Up and down arrow keys can be used to select an element from the list.
Typing into the filter input field filters the list from which the elements can be selected.
The current selected element is highlighted with green background color.</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/component-decomposition-example-1.svg"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/component-decomposition-example-1.svg" alt="Component Decomposition Example 1v2" width="450"></a>
</div>
<div class="title">Figure 39. Component decomposition example before</div>
</div>
<div class="paragraph">
<p>What should be done, is to define small reusable <em>Dumb Components</em>.
This way the complexity becomes manageable.
In the example every colored box describes a component with the purple box being a <em>Smart Component</em>.</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/component-decomposition-example-2.svg"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/component-decomposition-example-2.svg" alt="Component Decomposition Example 2v2" width="450"></a>
</div>
<div class="title">Figure 40. Component decomposition example after</div>
</div>
<div class="paragraph">
<p>This leads to the following component tree.</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/component-decomposition-example-component-tree.svg"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/component-decomposition-example-component-tree.svg" alt="Component Decomposition Example component tree" width="450"></a>
</div>
<div class="title">Figure 41. Component decomposition example component tree</div>
</div>
<div class="paragraph">
<p>Note the uppermost component is a <em>Dumb Component</em>.
It is a wrapper for the label and the component to be displayed inside a form.
The <em>Smart Component</em> is <code>Listpicker</code>.
This way the widget can be reused without a form needed.</p>
</div>
<div class="paragraph">
<p>A widgets is a typical <em>Smart Component</em> to be shared across feature modules.
So the <code>SharedModule</code> is the place for it to be defined.</p>
</div>
</div>
<div class="sect3">
<h4 id="guide-component-decomposition.asciidoc_defining-state">18.8.2. Defining state</h4>
<div class="paragraph">
<p>Every UI has state.
There are different kinds of state, for example</p>
</div>
<div class="ulist">
<ul>
<li>
<p>View State: e.g. is a panel open, a css transition pending, etc.</p>
</li>
<li>
<p>Application State: e.g. is a payment pending, current URL, user info, etc.</p>
</li>
<li>
<p>Business Data: e.g. products loaded from backend</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>It is good practice to base the component decomposition on the state handled by a component and to define a simplified state model beforehand.
Starting with the parent - the <em>Smart Component</em>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>What overall state does the dialog have: e.g. loading, error, valid data loaded, valid input, invalid input, etc.
Every defined value should correspond to an overall appearance of the whole dialog.</p>
</li>
<li>
<p>What events can occur to the dialog: e.g. submitting a form, changing a filter, pressing buttons, pressing keys, etc.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For every <em>Dumb Component</em>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>What data does a component display: e.g. a header text, user information to be displayed, a loading flag, etc.<br>
This will be a slice of the overall state of the parent <em>Smart Component</em>.
In general a <em>Dumb Component</em> presents a slice of its parent <em>Smart Components</em> state to the user.</p>
</li>
<li>
<p>What events can occur: keyboard events, mouse events, etc.<br>
These events are all handled by its parent <em>Smart Component</em> - every event is passed up the tree to be handled by a <em>Smart Component</em>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>These information should be reflected inside the modeled state.
The implementation is a TypeScript type - an interface or a class describing the model.</p>
</div>
<div class="paragraph">
<p>So there should be a type describing all state relevant for a <em>Smart Component</em>.
An instance of that type is send down the component tree at runtime.
Not every <em>Dumb Component</em> will need the whole state.
For instance a single <em>Dumb Component</em> could only need a single string.</p>
</div>
<div class="paragraph">
<p>The state model for the previous <code>Listpicker</code> example is shown in the following listing.</p>
</div>
<div class="listingblock">
<div class="title">Listing 36. Listpicker state model</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-ts hljs" data-lang="ts">export class ListpickerState {

  items: {}[]|undefined;
  columns = ['key', 'value'];
  keyColumn = 'key';
  displayValueColumn = 'value';
  filteredItems: {}[]|undefined;
  filter = '';
  placeholder = '';
  caseSensitive = true;
  isDisabled = false;
  isDropdownOpen = false;
  selectedItem: {}|undefined;
  displayValue = '';

}</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>Listpicker</code> holds an instance of <code>ListpickerState</code> which is passed down the component tree via <code>@Input()</code> bindings in the <em>Dumb Components</em>.
Events emitted by children - <em>Dumb Components</em> - create a new instance of <code>ListpickerState</code> based on the current instance and the event and its data.
So a state transition is just setting a new instance of <code>ListpickerState</code>.
Angular Bindings propagate the value down the tree after exchanging the state.</p>
</div>
<div class="listingblock">
<div class="title">Listing 37. Listpicker State transition</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-ts hljs" data-lang="ts">export class ListpickerComponent {

  // initial default values are set
  state = new ListpickerState();

  /** User changes filter */
  onFilterChange(filter: string): void {
    // apply filter ...
    const filteredList = this.filterService.filter(...);

    // important: A new instance is created, instead of altering the existing one.
    //            This makes change detection easier and prevents hard to find bugs.
    this.state = Object.assing({}, this.state, {
      filteredItems: filteredList,
      filter: filter
    });
  }

}</code></pre>
</div>
</div>
<div class="paragraph">
<div class="title">Note:</div>
<p>It is not always necessary to define the model as independent type.
So there would be no state property and just properties for every state defined directly in the component class.
When complexity grows and state becomes larger this is usually a good idea.
If the state should be shared between <em>Smart Components</em> a store is to be used.</p>
</div>
</div>
<div class="sect3">
<h4 id="guide-component-decomposition.asciidoc_when-are-dumb-components-needed">18.8.3. When are Dumb Components needed</h4>
<div class="paragraph">
<p>Sometimes it is not necessary to perform a full decomposition. The architecture does not enforce it generally. What you should keep in mind is, that there is always a point when it becomes recommendable.</p>
</div>
<div class="paragraph">
<p>For example a template with 800 loc is:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>not understandable</p>
</li>
<li>
<p>not maintanable</p>
</li>
<li>
<p>not testable</p>
</li>
<li>
<p>not reusable</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>So when implementing a template with more than 50 loc you should think about decomposition.</p>
</div>
<!-- toc disabled -->
</div>
</div>
<div class="sect2">
<h3 id="guide-consuming-rest-services.asciidoc">18.9. Consuming REST services</h3>
<div class="paragraph">
<p>A good introduction to working with Angular HttpClient can be found in <a href="https://angular.io/guide/http">Angular Docs</a></p>
</div>
<div class="paragraph">
<p>This guide will cover, how to embed Angular HttpClient in the application architecture.
For backend request a special service with the suffix <code>Adapter</code> needs to be defined.</p>
</div>
<div class="sect3">
<h4 id="guide-consuming-rest-services.asciidoc_defining-adapters">18.9.1. Defining Adapters</h4>
<div class="paragraph">
<p>It is a good practice to have a Angular service whose single responsibility is to call the backend and parse the received value to a transfer data model (e.g. Swagger generated TOs).
Those services need to have the suffix <code>Adapter</code> to make them easy to recognize.</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/rest-adapter.svg"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/rest-adapter.svg" alt="Adapters handle backend communication" width="450"></a>
</div>
<div class="title">Figure 42. Adapters handle backend communication</div>
</div>
<div class="paragraph">
<p>As illustrated in the figure a Use Case service does not use Angular HttpClient directly but uses an adapter.
A basic adapter could look like this:</p>
</div>
<div class="listingblock">
<div class="title">Listing 38. Example adapter</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-ts hljs" data-lang="ts">import { Injectable } from '@angular/core';
import { HttpClient } from '@angular/common/http';
import { Observable } from 'rxjs/Observable';

import { FlightTo } from './flight-to';

@Injectable()
export class FlightsAdapter {

  constructor(
    private httpClient: HttpClient
  ) {}

  getFlights(): Observable&lt;FlightTo&gt; {
    return this.httpClient.get&lt;FlightTo&gt;('/relative/url/to/flights');
  }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The adapters should use a well-defined transfer data model.
This could be generated from server endpoints with CobiGen, Swagger, typescript-maven-plugin, etc.
If inside the application there is a business model defined, the adapter has to parse to the transfer model.
This is illustrated in the following listing.</p>
</div>
<div class="listingblock">
<div class="title">Listing 39. Example adapter mapping from business model to transfer model</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-ts hljs" data-lang="ts">import { Injectable } from '@angular/core';
import { HttpClient } from '@angular/common/http';
import { Observable } from 'rxjs/Observable';
import { map } from 'rxjs/operators';

import { FlightTo } from './flight-to';
import { Flight } from '../../../model/flight';

@Injectable()
export class FlightsAdapter {

  constructor(
    private httpClient: HttpClient
  ) {}

  updateFlight(flight: Flight): Observable&lt;Flight&gt; {
    const to = this.mapFlight(flight);

    return this.httpClient.post&lt;FlightTo&gt;('/relative/url/to/flights', to).pipe(
      map(to =&gt; this.mapFlightTo(to))
    );
  }

  private mapFlight(flight: Flight): FlightTo {
    // mapping logic
  }

  private mapFlightTo(flightTo: FlightTo): Flight {
    // mapping logic
  }

}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="guide-consuming-rest-services.asciidoc_token-management">18.9.2. Token management</h4>
<!-- toc disabled -->
</div>
</div>
<div class="sect2">
<h3 id="guide-error-handler.asciidoc">18.10. Error Handler in angular</h3>
<div class="paragraph">
<p>Angular allows us to set up a custom error handler that can be used to control the different errors and them in a correct way. Using a global error handler will avoid mistakes and provide a use friendly interface allowing us to indicate the user what problem is happening.</p>
</div>
<div class="sect3">
<h4 id="guide-error-handler.asciidoc_what-is-errorhandler">18.10.1. What is ErrorHandler</h4>
<div class="paragraph">
<p><code>ErrorHandler</code> is the class that <code>Angular</code> uses by default to control the errors. This means that, even if the application doesnt have a <code>ErrorHandler</code> it is going to use the one setup by default in <code>Angular</code>. This can be tested by trying to find a page not existing in any app, instantly <code>Angular</code> will print the error in the console.</p>
</div>
</div>
<div class="sect3">
<h4 id="guide-error-handler.asciidoc_creating-your-custom-errorhandler-step-by-step">18.10.2. Creating your custom ErrorHandler step by step</h4>
<div class="paragraph">
<p>In order to create a custom <code>ErrorHandler</code> three steps are going to be needed:</p>
</div>
<div class="sect4">
<h5 id="guide-error-handler.asciidoc_creating-the-custom-errorhandler-class">Creating the custom ErrorHandler class</h5>
<div class="paragraph">
<p>In this first step the custom <code>ErrorHandler</code> class is going to be created inside the folder <code>/app/core/errors/errors-handler.ts</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-TypeScript hljs" data-lang="TypeScript">import { ErrorHandler, Injectable, Injector } from '@angular/core';
import { HttpErrorResponse } from '@angular/common/http';

@Injectable()
export class ErrorsHandler implements ErrorHandler {

    constructor(private injector: Injector) {}

    handleError(error: Error | HttpErrorResponse) {
      //  To do: Use injector to get the necessary services to redirect or
      // show a message to the user
      const classname  = error.constructor.name;
      switch ( classname )  {
        case 'HttpErrorResponse':
          console.error('HttpError:' + error.message);
          if (!navigator.onLine) {
            console.error('Theres no internet connection');
            // To do: control here in internet what you wanna do if user has no internet
          } else {
            console.error('Server Error:' + error.message);
            // To do: control here if the server gave an error
          }
          break;
        default:
          console.error('Error:' + error.message);
          // To do: control here if the client/other things gave an error
      }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This class can be used to control the different type of errors. If wanted, the <code>classname</code> variable could be used to add more switch cases. This would allow control of more specific situations.</p>
</div>
</div>
<div class="sect4">
<h5 id="guide-error-handler.asciidoc_creating-a-errorinterceptor">Creating a ErrorInterceptor</h5>
<div class="paragraph">
<p>Inside the same folder created in the last step we are going to create the <code>ErrorInterceptor</code>(<code>errors-handler-interceptor.ts</code>). This <code>ErrorInterceptor</code> is going to retry any failed calls to the server to make sure it is not being found before showing the error:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-TypeScript hljs" data-lang="TypeScript">import { HttpInterceptor, HttpRequest, HttpHandler, HttpEvent } from '@angular/common/http';
import { Injectable } from '@angular/core';
import { Observable } from 'rxjs';
import { retry } from 'rxjs/operators';

@Injectable()
export class ErrorsHandlerInterceptor implements HttpInterceptor {

    constructor() {}
    intercept(req: HttpRequest&lt;any&gt;, next: HttpHandler): Observable&lt;HttpEvent&lt;any&gt;&gt; {
        return next.handle(req).pipe(
            retryWhen((errors: Observable&lt;any&gt;) =&gt; errors.pipe(
                delay(500),
                take(5),
                concatMap((error: any, retryIndex: number) =&gt; {
                    if (++retryIndex === 5) {
                        throw error;
                    }
                    return of(error);
                })
            ))
        );
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This custom made interceptor is implementing the <code>HttpInterceptor</code> and inside the method <code>intercept</code> using the method <code>pipe</code>,<code>retryWhen</code>,<code>delay</code>,<code>take</code> and <code>concatMap</code> from <a href="https://rxjs-dev.firebaseapp.com/api">RxJs</a> it is going to do the next things if there is errors:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>With <code>delay(500)</code> do a delay to allow some time in between requests</p>
</li>
<li>
<p>With <code>take(5)</code> retry five times.</p>
</li>
<li>
<p>With <code>concatMap</code> if the index that <code>take()</code> gives is not 5 it returns the error, else, it throws the error.</p>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="guide-error-handler.asciidoc_creating-a-error-module">Creating a Error Module</h5>
<div class="paragraph">
<p>Finally, creating a module(<code>errors-handler.module.ts</code>) is necessary to include the <code>interceptor</code> and the custom error handler. In this case, the module is going to be created in the same folder as the last two:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-TypeScript hljs" data-lang="TypeScript">import { NgModule, ErrorHandler } from '@angular/core';
import { CommonModule } from '@angular/common';
import { ErrorsHandler } from './errors-handler';
import { HTTP_INTERCEPTORS } from '@angular/common/http';
import { ErrorsHandlerInterceptor } from './errors-handler-interceptor';

@NgModule({
  declarations: [], // Declare here component if you want to use routing to error component
  imports: [
    CommonModule
  ],
  providers: [
    {
      provide: ErrorHandler,
      useClass: ErrorsHandler,
    },
    {
      provide: HTTP_INTERCEPTORS,
      useClass: ErrorsHandlerInterceptor,
      multi: true,
    }
  ]
})
export class ErrorsHandlerModule { }</code></pre>
</div>
</div>
<div class="paragraph">
<p>This module simply is providing the services that are implemented by our custom classes and then telling angular to use our custom made classes instead of the default ones. After doing this, the module has to be included in the app module <code>app.module.ts</code> in order to be used.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-TypeScript hljs" data-lang="TypeScript">....
  imports: [
    ErrorsHandlerModule,
    ....</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="guide-error-handler.asciidoc_handling-errors">18.10.3. Handling Errors</h4>
<div class="paragraph">
<p>As a final step, handling these errors is necessary. Theres different ways that can be used to control the errors, here are a few:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Creating a custom page and using with <code>Router</code> to redirect to a page showing an error.</p>
</li>
<li>
<p>Creating a service in the server side or <code>Backend</code> to create a log with the error and calling it with <code>HttpClient</code>.</p>
</li>
<li>
<p>Showing a custom made <code>SnackBar</code> with the error message.</p>
</li>
</ul>
</div>
<div class="sect5">
<h6 id="guide-error-handler.asciidoc_using-snackbarservice-and-ngzone">Using <code>SnackBarService</code> and <code>NgZone</code></h6>
<div class="paragraph">
<p>If the <a href="https://material.angular.io/components/snack-bar/overview">SnackBar</a> is used directly, some errors can ocurr, this is due to <code>SnackBar</code> being out of the <code>Angular</code> zone. In order to use this service properly, <a href="https://angular.io/api/core/NgZone">NgZone</a> is necessary. The method <code>run()</code> from <code>NgZone</code> will allow the service to be inside the <code>Angular Zone</code>. An example on how to use it:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-TypeScript hljs" data-lang="TypeScript">import { ErrorHandler, Injectable, Injector, NgZone } from '@angular/core';
import { HttpErrorResponse } from '@angular/common/http';
import { MatSnackBar } from '@angular/material';

@Injectable()
export class ErrorsHandler implements ErrorHandler {

    constructor(private injector: Injector, private zone: NgZone) {}

    handleError(error: Error | HttpErrorResponse) {
      // Use injector to get the necessary services to redirect or
      const snackBar: MatSnackBar = this.injector.get(MatSnackBar);
      const classname  = error.constructor.name;
      let message: string;
      switch ( classname )  {
        case 'HttpErrorResponse':
          message = !(navigator.onLine) ? 'There is no internet connection' : error.message;
          break;
        default:
          message = error.message;
      }
      this.zone.run(
        () =&gt; snackBar.open(message, 'danger', { duration : 4000})
      );
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Using <code>Injector</code> the <code>MatSnackBar</code> is obtained, then the correct message is obtained inside the switch. Finally, using <code>NgZone</code> and <code>run()</code>, we open the <code>SnackBar</code> passing the message, and the paremeters wanted.</p>
</div>
<!-- toc disabled -->
</div>
</div>
</div>
<div class="sect2">
<h3 id="guide-file-structure.asciidoc">18.11. File Structure</h3>
<div class="sect3">
<h4 id="guide-file-structure.asciidoc_toplevel">18.11.1. Toplevel</h4>
<div class="paragraph">
<p>The toplevel file structure is defined by Angular CLI. You might put this "toplevel file structure" into a subdirectory to facilitate your build, but this is not relevant for this guide. So the applications file structure relevant to this guide is the folder <code>/src/app</code> inside the part managed by Angular CLI.</p>
</div>
<div class="listingblock">
<div class="title">Listing 40. Toplevel file structure shows feature modules</div>
<div class="content">
<pre class="highlightjs highlight"><code>    /src
    └── /app
        ├── /account-management
        ├── /billing
        ├── /booking
        ├── /core
        ├── /shared
        ├── /status
        |
        ├── app.module.ts
        ├── app.component.spec.ts
        ├── app.component.ts
        └── app.routing-module.ts</code></pre>
</div>
</div>
<div class="paragraph">
<p>Besides the definition of app module the <code>app</code> folder has feature modules on toplevel.
The special modules <em>shared</em> and <em>core</em> are present as well.</p>
</div>
</div>
<div class="sect3">
<h4 id="guide-file-structure.asciidoc_feature-modules">18.11.2. Feature Modules</h4>
<div class="paragraph">
<p>A feature module contains the modules definition and two folders representing both layers.</p>
</div>
<div class="listingblock">
<div class="title">Listing 41. Feature module file structure has both layers</div>
<div class="content">
<pre class="highlightjs highlight"><code>    /src
    └── /app
        └── /account-management
            ├── /components
            ├── /services
            |
            ├── account-management.module.ts
            ├── account-management.component.spec.ts
            ├── account-management.component.ts
            └── account-management.routing-module.ts</code></pre>
</div>
</div>
<div class="paragraph">
<p>Additionally an entry component is possible. This would be the case in lazy loading scenarios.
So <code>account-management.component.ts</code> would be only present if <code>account-management</code> is lazy loaded.
Otherwise, the module&#8217;s routes would be defined <em>Component-less</em>
(see <a href="http://vsavkin.tumblr.com/post/146722301646/angular-router-empty-paths-componentless-routes">vsavkin blog post</a>).</p>
</div>
</div>
<div class="sect3">
<h4 id="guide-file-structure.asciidoc_components-layer">18.11.3. Components Layer</h4>
<div class="paragraph">
<p>The component layer reflects the distinction between <em>Smart Components</em> and <em>Dumb Components</em>.</p>
</div>
<div class="listingblock">
<div class="title">Listing 42. Components layer file structure shows Smart Components on toplevel</div>
<div class="content">
<pre class="highlightjs highlight"><code>    /src
    └── /app
        └── /account-management
            └── /components
                ├── /account-overview
                ├── /confirm-modal
                ├── /create-account
                ├── /forgot-password
                └── /shared</code></pre>
</div>
</div>
<div class="paragraph">
<p>Every folder inside the <code>/components</code> folder represents a smart component. The only exception is <code>/shared</code>.
<code>/shared</code> contains <em>Dumb Components</em> shared across <em>Smart Components</em> inside the components layer.</p>
</div>
<div class="listingblock">
<div class="title">Listing 43. Smart components contain Dumb components</div>
<div class="content">
<pre class="highlightjs highlight"><code>    /src
    └── /app
        └── /account-management
            └── /components
                └── /account-overview
                    ├── /user-info-panel
                    |   ├── /address-tab
                    |   ├── /last-activities-tab
                    |   |
                    |   ├── user-info-panel.component.html
                    |   ├── user-info-panel.component.scss
                    |   ├── user-info-panel.component.spec.ts
                    |   └── user-info-panel.component.ts
                    |
                    ├── /user-header
                    ├── /user-toolbar
                    |
                    ├── account-overview.component.html
                    ├── account-overview.component.scss
                    ├── account-overview.component.spec.ts
                    └── account-overview.component.ts</code></pre>
</div>
</div>
<div class="paragraph">
<p>Inside the folder of a <em>Smart Component</em> the component is defined.
Besides that are folders containing the <em>Dumb Components</em> the <em>Smart Component</em> consists of.
This can be recursive - a <em>Dumb Component</em> can consist of other <em>Dumb Components</em>.
This is reflected by the file structure as well. This way the structure of a view becomes very readable.
As mentioned before, if a <em>Dumb Component</em> is used by multiple <em>Smart Components</em> inside the components layer
it is put inside the <code>/shared</code> folder inside the components layer.</p>
</div>
<div class="paragraph">
<p>With this way of thinking the <em>shared</em> module makes a lot of sense. If a <em>Dumb Component</em> is used by multiple <em>Smart Components</em>
from different feature modules, the <em>Dumb Component</em> is placed into the <em>shared</em> module.</p>
</div>
<div class="listingblock">
<div class="title">Listing 44. The shared module contains Dumb Components shared across Smart Components from different feature modules</div>
<div class="content">
<pre class="highlightjs highlight"><code>    /src
    └── /app
        └── /shared
            └── /user-panel
                |
                ├── user-panel.component.html
                ├── user-panel.component.scss
                ├── user-panel.component.spec.ts
                └── user-panel.component.ts</code></pre>
</div>
</div>
<div class="paragraph">
<p>The layer folder <code>/components</code> is not necessary inside the <em>shared</em> module.
The <em>shared</em> module only contains components!</p>
</div>
<!-- toc disabled -->
</div>
</div>
<div class="sect2">
<h3 id="guide-internationalization.asciidoc">18.12. Internationalization</h3>
<div class="paragraph">
<p>Nowadays, a common scenario in front-end applications is to have the ability to translate labels and locate numbers, dates, currency and so on when the user clicks over a language selector or similar. devon4ng and specifically Angular has a default mechanism in order to fill the gap of such features, and besides there are some wide used libraries that make even easier to translate applications.</p>
</div>
<div class="paragraph">
<p>More info at <a href="https://angular.io/guide/i18n">Angular i18n official documentation</a></p>
</div>
<div class="sect3">
<h4 id="guide-internationalization.asciidoc_devon4ng-i18n-approach">18.12.1. devon4ng i18n approach</h4>
<div class="paragraph">
<p>The official approach could be a bit complicated, therefore the recommended one is to use the recommended library <strong>NGX Translate</strong> from <a href="http://www.ngx-translate.com/" class="bare">http://www.ngx-translate.com/</a>.</p>
</div>
<div class="sect4">
<h5 id="guide-internationalization.asciidoc_install-ngx-translate">Install NGX Translate</h5>
<div class="paragraph">
<p>In order to include this library in your devon4ng <strong>Angular &gt;= 4.3</strong> project you will need to execute in a terminal:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ npm install @ngx-translate/core @ngx-translate/http-loader --save
# or if you use yarn
$ yarn add @ngx-translate/core @ngx-translate/http-loader</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>@ngx-translate/core</strong> is the core library to provide i18n capabilities.</p>
</li>
<li>
<p><strong>@ngx-translate/http-loader</strong> is a loader for ngx-translate that loads translations using http.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="guide-internationalization.asciidoc_configure-ngx-translate">Configure NGX Translate</h5>
<div class="paragraph">
<p>Depending on the volume of the devon4ng application we will include the NGX Translate library in the <code>app.module.ts</code> or in the <code>core.module.ts</code> transversal to the application.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">import { BrowserModule } from '@angular/platform-browser';
import { NgModule } from '@angular/core';
import { HttpClientModule, HttpClient } from '@angular/common/http';
import { TranslateModule, TranslateLoader } from '@ngx-translate/core';
import { TranslateHttpLoader } from '@ngx-translate/http-loader';</code></pre>
</div>
</div>
<div class="paragraph">
<p>Next, an exported function for factories has to be created:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">// AoT requires an exported function for factories
export function HttpLoaderFactory(http: HttpClient) {
    return new TranslateHttpLoader(http);
}

@NgModule({
    imports: [
        BrowserModule,
        HttpClientModule,
        TranslateModule.forRoot({
            loader: {
                provide: TranslateLoader,
                useFactory: HttpLoaderFactory,
                deps: [HttpClient]
            }
        })
    ],
    bootstrap: [AppComponent]
})
export class AppModule { } // or CoreModule</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>TranslateHttpLoader</code> also has two optional parameters:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>prefix: string = "/assets/i18n/"</p>
</li>
<li>
<p>suffix: string = ".json"</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>By using those default parameters, it will load the translations files for the lang "en" from: <code>/assets/i18n/en.json</code>. In general, any translation file will loaded from the <code>/assets/i18n/</code> folder.</p>
</div>
<div class="paragraph">
<p>Those parameters can be changed in the <code>HttpLoaderFactory</code> method just defined. For example if you want to load the "en" translations from <code>/public/lang-files/en-lang.json</code> you would use:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">export function HttpLoaderFactory(http: HttpClient) {
    return new TranslateHttpLoader(http, "/public/lang-files/", "-lang.json");
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>For now this loader only support the json format.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If you&#8217;re still on Angular &lt; 4.3, please use <code>Http</code> from <code>@angular/http</code> with <code>http-loader@0.1.0</code>.
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="guide-internationalization.asciidoc_usage">Usage</h5>
<div class="paragraph">
<p>In order to translate any label in any HTML template you will need to use the <code>translate</code> pipe available:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-html hljs" data-lang="html">{{ 'HELLO' | translate }}</code></pre>
</div>
</div>
<div class="paragraph">
<p>An <strong>optional</strong> parameter from the component TypeScript class could be included as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-html hljs" data-lang="html">{{ 'HELLO' | translate:param }}</code></pre>
</div>
</div>
<div class="paragraph">
<p>So, <code>param</code> has to be defined in the class. The default language used is defined as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">// imports

@Component({
    selector: 'app',
    template: `
        &lt;div&gt;{{ 'HELLO' | translate }}&lt;/div&gt;            // Without param
        &lt;div&gt;{{ 'HELLO' | translate:param }}&lt;/div&gt;      // With param
    `
})
export class AppComponent {
    // This param will be used in the translation
    param = { value: 'world' };

    constructor(translate: TranslateService) {
        // this language will be used as a fallback when a translation isn't found in the current language
        translate.setDefaultLang('en');

        // the lang to use, if the lang isn't available, it will use the current loader to get them
        translate.use('en');
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In order to change the language used you will need to create a button or selector that calls the <code>this.translate.use(language: string)</code> method from <code>TranslateService</code>. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">toggleLanguage(option) {
    this.translate.use(option);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The translations will be included in the <code>en.json</code>, <code>es.json</code>, <code>de.json</code>, etc. files inside the <code>/assets/i18n</code> folder. For example <code>en.json</code> would be (using the previous param):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
    "HELLO": "hello"
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Or with an <strong>optional param</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
    "HELLO": "hello {{value}}"
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>TranslateParser</code> understands nested JSON objects. This means that you can have a translation that looks like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
    "HOME": {
        "HELLO": "hello {{value}}"
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In order to access access the value, use the dot notation, in this case <code>HOME.HELLO</code>.</p>
</div>
</div>
<div class="sect4">
<h5 id="guide-internationalization.asciidoc_using-the-service">Using the service, pipe or directive</h5>
<div class="sect5">
<h6 id="guide-internationalization.asciidoc_service">Service</h6>
<div class="paragraph">
<p>If you need to access translations in any component or service you can do it injecting the <code>Translateservice</code> into them:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">translate.get('HELLO', {value: 'world'}).subscribe((res: string) =&gt; {
    console.log(res);
    //=&gt; 'hello world'
});</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="guide-internationalization.asciidoc_pipe">Pipe</h6>
<div class="paragraph">
<p>The use of pipes can be possible too:</p>
</div>
<div class="paragraph">
<p>template:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">&lt;div&gt;{{ 'HELLO' | translate:param }}&lt;/div&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>component:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">param = {value: 'world'};</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="guide-internationalization.asciidoc_directives">Directives</h6>
<div class="paragraph">
<p>Finally, it can also be used with directives:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">&lt;div [translate]="'HELLO'" [translateParams]="{value: 'world'}"&gt;&lt;/div&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>or, using the content of your element as a key</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">&lt;div translate [translateParams]="{value: 'world'}"&gt;HELLO&lt;/div&gt;</code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
You can find a complete example at <a href="https://github.com/devonfw/devon4ng-application-template" class="bare">https://github.com/devonfw/devon4ng-application-template</a>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Please, visit <a href="https://github.com/ngx-translate/core" class="bare">https://github.com/ngx-translate/core</a> for more info.</p>
</div>
<!-- toc disabled -->
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="guide-routing.asciidoc">18.13. Routing</h3>
<div class="paragraph">
<p>A basic introduction to the Angular Router can be found in <a href="https://angular.io/guide/router">Angular Docs</a>.</p>
</div>
<div class="paragraph">
<p>This guide will show common tasks and best practices.</p>
</div>
<div class="sect3">
<h4 id="guide-routing.asciidoc_defining-routes">18.13.1. Defining Routes</h4>
<div class="paragraph">
<p>For each feature module and the app module all routes should be defined in a seperate module with the suffix <code>RoutingModule</code>.
This way the routing modules are the only place where routes are defined.
This pattern achieves a clear seperation of concernes.
The following figure illustrates this.</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/module-declaration.svg"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/module-declaration.svg" alt="Routing module declaration" width="450"></a>
</div>
<div class="title">Figure 43. Routing module declaration</div>
</div>
<div class="paragraph">
<p>It is important to define routes inside app routing module with <code>.forRoot()</code> and in feature routing modules with <code>.forChild()</code>.</p>
</div>
<div class="sect4">
<h5 id="guide-routing.asciidoc_example-1---no-lazy-loading">Example 1 - No Lazy Loading</h5>
<div class="paragraph">
<p>In this example two modules need to be configured with routes - AppModule and FlightModule.</p>
</div>
<div class="paragraph">
<p>The following routes will be configured</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>/</code> will redirect to <code>/search</code></p>
</li>
<li>
<p><code>/search</code> displays FlightSearchComponent (FlightModule)</p>
</li>
<li>
<p><code>/search/print/:flightId/:date</code> displays FlightPrintComponent (FlightModule)</p>
</li>
<li>
<p><code>/search/details/:flightId/:date</code> displays FlightDetailsComponent (FlightModule)</p>
</li>
<li>
<p>All other routes will display ErrorPage404 (AppModule)</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Listing 45. app-routing.module.ts</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-ts hljs" data-lang="ts">const routes: Routes = [
  { path: '', redirectTo: 'search', pathMatch: 'full' },
  { path: '**', component: ErrorPage404 }
];

@NgModule({
  imports: [RouterModule.forRoot(routes)],
  exports: [RouterModule]
})
export class AppRoutingModule { }</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Listing 46. flight-search-routing.module.ts</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-ts hljs" data-lang="ts">const routes: Routes = [
  {
    path: 'search', children: [
      { path: '', component: FlightSearchComponent },
      { path: 'print/:flightId/:date', component: FlightPrintComponent },
      { path: 'details/:flightId/:date', component: FlightDetailsComponent }
    ]
  }
];

@NgModule({
  imports: [RouterModule.forChild(routes)],
  exports: [RouterModule],
})
export class FlightSearchRoutingModule { }</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
The import order inside AppModule is important.
AppRoutingModule needs to be imported <strong>after</strong> FlightModule.
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="guide-routing.asciidoc_example-2---lazy-loading">Example 2 - Lazy Loading</h5>
<div class="paragraph">
<p>Lazy Loading is a good practice when the application has multiple feature areas and a user might not visit every dialog.
Or at least he might not need every dialog up front.</p>
</div>
<div class="paragraph">
<p>The following example will configure the same routes as example 1 but will lazy load FlightModule.</p>
</div>
<div class="listingblock">
<div class="title">Listing 47. app-routing.module.ts</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-ts hljs" data-lang="ts">const routes: Routes = [
  { path: '/search', loadChildren: 'app/flight-search/flight-search.module#FlightSearchModule' },
  { path: '**', component: ErrorPage404 }
];

@NgModule({
  imports: [RouterModule.forRoot(routes)],
  exports: [RouterModule]
})
export class AppRoutingModule { }</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Listing 48. flight-search-routing.module.ts</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-ts hljs" data-lang="ts">const routes: Routes = [
  {
    path: '', children: [
      { path: '', component: FlightSearchComponent },
      { path: 'print/:flightId/:date', component: FlightPrintComponent },
      { path: 'details/:flightId/:date', component: FlightDetailsComponent }
    ]
  }
];

@NgModule({
  imports: [RouterModule.forChild(routes)],
  exports: [RouterModule],
})
export class FlightSearchRoutingModule { }</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="guide-routing.asciidoc_triggering-route-changes">18.13.2. Triggering Route Changes</h4>
<div class="paragraph">
<p>With Angular you have two ways of triggering route changes.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Declarative with bindings in component HTML templates</p>
</li>
<li>
<p>Programmatic with Angular <code>Router</code> service inside component classes</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>On the one hand, architecture-wise it is a much cleaner solution to trigger route changes in <em>Smart Components</em>.
This way you have every UI event that should trigger a navigation handled in one place - in a <em>Smart Component</em>.
It becomes very easy to look inside the code for every navigation, that can occure.
Refactoring is also much easier, as there are no navigation events "hidden" in the HTML templates</p>
</div>
<div class="paragraph">
<p>On the other hand, in terms of accessibility and SEO it is a better solution to rely on bindings in the view - e.g. by using Angulars router-link directive.
This way screen readers and the Google crawler can move through the page easily.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
If you do not have to support accessibility (screen readers, etc.) and to care about SEO (Google rank, etc.),
then you should aim for triggering navigations only in <em>Smart Components</em>.
</td>
</tr>
</table>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/triggering-navigation.svg"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/triggering-navigation.svg" alt="Triggering navigation" width="350" height="200"></a>
</div>
<div class="title">Figure 44. Triggering navigation</div>
</div>
</div>
<div class="sect3">
<h4 id="guide-routing.asciidoc_guards">18.13.3. Guards</h4>
<div class="paragraph">
<p>Guards are Angular services implemented on routes which determines whether a user can naviagate to/from the route. There are examples below which will explain things better. We have the following types of Guards:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>CanActivate</strong>: It is used to determine whether a user can visit a route. The most common scenario for this guard is to check if the user is authenticated. For example, if we want only logged in users to be able to go to a particular route, we will implement the <code>CanActivate</code> guard on this route.</p>
</li>
<li>
<p><strong>CanActivateChild</strong>: Same as above, only implemented on child routes.</p>
</li>
<li>
<p><strong>CanDeactivate</strong>: It is used to determine if a user can naviagate away from a route. Most common example is when a user tries to go to a different page after filling up a form and does not save/submit the changes, we can use this guard to confirm whether the user really wants to leave the page without saving/submiting.</p>
</li>
<li>
<p><strong>Resolve</strong>: For resolving dynamic data.</p>
</li>
<li>
<p><strong>CanLoad</strong>: It is used to determine whether an <em>Angular module</em> can be loaded lazily. Example below will be helpful to understand it.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Let&#8217;s have a look at some examples.</p>
</div>
<div class="sect4">
<h5 id="guide-routing.asciidoc_example-1---canactivate-and-canactivatechild-guards">Example 1 - CanActivate and CanActivateChild guards</h5>
<div class="sect5">
<h6 id="guide-routing.asciidoc_canactivate-guard">CanActivate guard</h6>
<div class="paragraph">
<p>As mentioned earlier, a guard is an Angular service and services are simply TypeScript classes. So we begin by creating a class. This class has to implement the <code>CanActivate</code> interface (imported from <code>angular/router</code>), and therefore, must have a <code>canActivate</code> function. The logic of this function determines whether the requested route can be navigated to or not. It returns either a <code>boolean</code> value or an <code>Observable</code> or a <code>Promise</code> which resolves to a <code>boolean</code> value. If it is true, the route is loaded, else not.</p>
</div>
<div class="listingblock">
<div class="title">Listing 49. CanActivate example</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-ts hljs" data-lang="ts">...
import {CanActivate} from "@angular/router";

@Injectable()
class ExampleAuthGuard implements CanActivate {
  constructor(private authService: AuthService) {}

  canActivate(route: ActivatedRouterSnapshot, state: RouterStateSnapshot) {
	if (this.authService.isLoggedIn()) {
      return true;
    } else {
	  window.alert('Please log in first');
      return false;
    }
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the above example, let&#8217;s assume we have a <code>AuthService</code> which has a <code>isLoggedIn()</code> method which returns a boolean value depending on whether the user is logged in. We use it to return <code>true</code> or <code>false</code> from the <code>canActivate</code> function.
The <code>canActivate</code> function accepts two parameters (provided by Angular). The first parameter of type <code>ActivatedRouterSnapshot</code> is the snapshot of the route the user is trying to naviagate to (where the guard is implemented); we can extract the route parameters from this instance. The second parameter of type <code>RouterStateSnapshot</code> is a snapshot of the router state the user is trying to naviagate to; we can fetch the URL from it&#8217;s <code>url</code> property.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
We can also redirect the user to another page (maybe a login page) if the <code>authService</code> returns false. To do that, inject <code>Router</code> and use it&#8217;s <code>naviagate</code> function to redirect to the appropriate page.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Since it is a service, it needs to be provided in our module:</p>
</div>
<div class="listingblock">
<div class="title">Listing 50. provide the guard in a module</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-ts hljs" data-lang="ts">@NgModule({
  ...
  providers: [
    ...
    ExampleAuthGuard
  ]
})</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now this guard is ready to use on our routes. We implement it where we define our array of routes in the application:</p>
</div>
<div class="listingblock">
<div class="title">Listing 51. Implementing the guard</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-ts hljs" data-lang="ts">...
const routes: Routes = [
  { path: '', redirectTo: 'home', pathMatch: 'full' },
  { path: 'home', component: HomeComponent },
  { path: 'page1', component: Page1Component, canActivate: [ExampleAuthGuard] }
];</code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see, the <code>canActivate</code> property accepts an array of guards. So we can implement more than one guard on a route.</p>
</div>
</div>
<div class="sect5">
<h6 id="guide-routing.asciidoc_canactivatechild-guard">CanActivateChild guard</h6>
<div class="paragraph">
<p>To use the guard on nested (children) routes, we add it to the <code>canActivateChild</code> property like so:</p>
</div>
<div class="listingblock">
<div class="title">Listing 52. Implementing the guard on child routes</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-ts hljs" data-lang="ts">...
const routes: Routes = [
  { path: '', redirectTo: 'home', pathMatch: 'full' },
  { path: 'home', component: HomeComponent },
  { path: 'page1', component: Page1Component, canActivateChild: [ExampleAuthGuard], children: [
	{path: 'sub-page1', component: SubPageComponent},
    {path: 'sub-page2', component: SubPageComponent}
  ] }
];</code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="guide-routing.asciidoc_example-2---canload-guard">Example 2 - CanLoad guard</h5>
<div class="paragraph">
<p>Similar to <code>CanActivate</code>, to use this guard we implement the <code>CanLoad</code> interface and overwrite it&#8217;s <code>canLoad</code> function. Again, this function returns either a boolean value or an <code>Observable</code> or a <code>Promise</code> which resolves to a boolean value. The fundamental difference between <code>CanActivate</code> and <code>CanLoad</code> is that <code>CanLoad</code> is used to determine whether an entire module can be lazily loaded or not. If the guard returns <code>false</code> for a module protected by <code>CanLoad</code>, the entire module is not loaded.</p>
</div>
<div class="listingblock">
<div class="title">Listing 53. CanLoad example</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-ts hljs" data-lang="ts">...
import {CanLoad, Route} from "@angular/router";

@Injectable()
class ExampleCanLoadGuard implements CanLoad {
  constructor(private authService: AuthService) {}

  canLoad(route: Route) {
	if (this.authService.isLoggedIn()) {
      return true;
    } else {
	  window.alert('Please log in first');
      return false;
    }
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Again, let&#8217;s assume we have a <code>AuthService</code> which has a <code>isLoggedIn()</code> method which returns a boolean value depending on whether the user is logged in. The <code>canLoad</code> function accepts a parameter of type Route which we can use to fetch the path a user is trying to navigate to (using the <code>path</code> property of <code>Route</code>).</p>
</div>
<div class="paragraph">
<p>This guard needs to be provided in our module like any other service.</p>
</div>
<div class="paragraph">
<p>To implement the guard, we use the <code>canLoad</code> property:</p>
</div>
<div class="listingblock">
<div class="title">Listing 54. Implementing the guard</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-ts hljs" data-lang="ts">...
const routes: Routes = [
  { path: 'home', component: HomeComponent },
  { path: 'admin', loadChildren: 'app/admin/admin.module#AdminModule', canLoad: [ExampleCanLoadGuard] }
];</code></pre>
</div>
</div>
<!-- toc disabled -->
</div>
</div>
</div>
<div class="sect2">
<h3 id="guide-testing.asciidoc">18.14. Testing</h3>
<div class="paragraph">
<p>This guide will cover the basics of testing logic inside your code with UnitTests.
The guide assumes that you are familiar with Angular CLI (<a href="#guide-working-with-angular-cli.asciidoc">see the guide</a>)</p>
</div>
<div class="paragraph">
<p>For testing your Angular application with UnitTests there are two main strategies:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Isolated UnitTests<br>
Isolated unit tests examine an instance of a class all by itself without any dependence on Angular or any injected values.
The amount of code and effort needed to create such tests in minimal.</p>
</li>
<li>
<p>Angular Testing Utilities<br>
Let you test components including their interaction with Angular.
The amount of code and effort needed to create such tests is a little higher.</p>
</li>
</ol>
</div>
<div class="sect3">
<h4 id="guide-testing.asciidoc_testing-concept">18.14.1. Testing Concept</h4>
<div class="paragraph">
<p>The following figure shows you an overview of the application architecture devided in testing areas.</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/testing-areas.svg"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/testing-areas.svg" alt="Testing Areas" width="450"></a>
</div>
<div class="title">Figure 45. Testing Areas</div>
</div>
<div class="paragraph">
<p>There are three areas, which need to be covered by different testing strategies.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Components:<br>
Smart Components need to be tested because they contain view logic.
Also the interaction with 3rd party components needs to be tested.
When a 3rd party component changes with an upgrade a test will be failing and warn you, that there is something wrong with the new version.
Most of the time Dumb Components do not need to be teste because they mainly display data and do not contain any logic.
Smart Components are alway tested with <strong>Angular Testing Utilities</strong>.
For example selectors, which select data from the store and transform it further, need to be tested.</p>
</li>
<li>
<p>Stores:<br>
A store contains methods representing state transitions.
If these methods contain logic, they need to be tested.
Stores are always testet using <strong>Isolated UnitTests</strong>.</p>
</li>
<li>
<p>Services:<br>
Services contain Business Logic, which needs to be tested.
UseCase Services represent a whole business use case.
For instance this could be initializing a store with all the data that is needed for a dialog - loading, transforming, storing.
Often <strong>Angular Testing Utilities</strong> are the optimal solution for testing UseCase Services, because they allow for an easy stubbing of the backend.
All other services should be tested with <strong>Isolated UnitTests</strong> as they are much easier to write and maintain.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="guide-testing.asciidoc_testing-smart-components">18.14.2. Testing Smart Components</h4>
<div class="paragraph">
<p>Testing Smart Components should assure the following.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Bindings are correct.</p>
</li>
<li>
<p>Selectors which load data from the store are correct.</p>
</li>
<li>
<p>Asynchronous behavior is correct (loading state, error state, "normal" state).</p>
</li>
<li>
<p>Oftentimes through testing one realizes, that important edge cases are forgotten.</p>
</li>
<li>
<p>Do these test become very complex, it is often an indicator for poor code quality in the component.
Then the implementation is to be adjusted / refactored.</p>
</li>
<li>
<p>When testing values received from the native DOM, you will test also that 3rd party libraries did not change with a version upgrade.
A failing test will show you what part of a 3rd party library has changed.
This is much better than the users doing this for you.
For example a binding might fail because the property name was changed with a newer version of a 3rd party library.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>In the function <code>beforeEach()</code> the TestBed imported from <strong>Angular Testing Utilities</strong> needs to be initialized.
The goal should be to define a minimal test-module with TestBed.
The following code gives you an example.</p>
</div>
<div class="listingblock">
<div class="title">Listing 55. Example test setup for Smart Components</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-ts hljs" data-lang="ts">describe('PrintFlightComponent', () =&gt; {

  let fixture: ComponentFixture&lt;PrintCPrintFlightComponentomponent&gt;;
  let store: FlightStore;
  let printServiceSpy: jasmine.SpyObj&lt;FlightPrintService&gt;;

  beforeEach(() =&gt; {
    const urlParam = '1337';
    const activatedRouteStub = { params: of({ id: urlParam }) };
    printServiceSpy = jasmine.createSpyObj('FlightPrintService', ['initializePrintDialog']);
    TestBed.configureTestingModule({
      imports: [
        TranslateModule.forRoot(),
        RouterTestingModule
      ],
      declarations: [
        PrintFlightComponent,
        PrintContentComponent,
        GeneralInformationPrintPanelComponent,
        PassengersPrintPanelComponent
      ],
      providers: [
        FlightStore,
        {provide: FlightPrintService, useValue: printServiceSpy},
        {provide: ActivatedRoute, useValue: activatedRouteStub}
      ]
    });
    fixture = TestBed.createComponent(PrintFlightComponent);
    store = fixture.debugElement.injector.get(FlightStore);
    fixture.detectChanges();
  });

  // ... test cases
})</code></pre>
</div>
</div>
<div class="paragraph">
<p>It is important:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Use <code>RouterTestingModule`</code> instead of <code>RouterModule</code></p>
</li>
<li>
<p>Use <code>TranslateModule.forRoot()</code> without translations
This way you can test language-neutral without translation marks.</p>
</li>
<li>
<p>Do not add a whole module from your application - in declarations add the tested Smart Component with all its Dumb Components</p>
</li>
<li>
<p>The store should never be stubbed.
If you need a complex test setup, just use the regular methods defined on the store.</p>
</li>
<li>
<p>Stub all services used by the Smart Component.
These are mostly UseCase services.
They should not be tested by these tests.
Only the correct call to their functions should be assured.
The logic inside the UseCase services is tested with seperate tests.</p>
</li>
<li>
<p><code>detectChanges()</code> performance an Angular Change Detection cycle (Angular refreshes all the bindings present in the view)</p>
</li>
<li>
<p><code>tick()</code> performance a virtual marco task, <code>tick(1000)</code> is equal to the virtual passing of 1s.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following test cases show the testing strategy in action.</p>
</div>
<div class="listingblock">
<div class="title">Listing 56. Example</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-ts hljs" data-lang="ts">it('calls initializePrintDialog for url parameter 1337', fakeAsync(() =&gt; {
  expect(printServiceSpy.initializePrintDialog).toHaveBeenCalledWith(1337);
}));

it('creates correct loading subtitle', fakeAsync(() =&gt; {
  store.setPrintStateLoading(123);
  tick();
  fixture.detectChanges();

  const subtitle = fixture.debugElement.query(By.css('app-header-element .print-header-container span:last-child'));
  expect(subtitle.nativeElement.textContent).toBe('PRINT_HEADER.FLIGHT STATE.IS_LOADING');
}));

it('creates correct subtitle for loaded flight', fakeAsync(() =&gt; {
  store.setPrintStateLoadedSuccess({
    id: 123,
    description: 'Description',
    iata: 'FRA',
    name: 'Frankfurt',
    // ...
  });
  tick();
  fixture.detectChanges();

  const subtitle = fixture.debugElement.query(By.css('app-header-element .print-header-container span:last-child'));
  expect(subtitle.nativeElement.textContent).toBe('PRINT_HEADER.FLIGHT "FRA (Frankfurt)" (ID: 123)');
}));</code></pre>
</div>
</div>
<div class="paragraph">
<p>The examples show the basic testing method</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Set the store to a well-defined state</p>
</li>
<li>
<p>check if the component displays the correct values</p>
</li>
<li>
<p>&#8230;&#8203; via checking values inside the native DOM.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="guide-testing.asciidoc_testing-state-transitions-performed-by-stores">18.14.3. Testing state transitions performed by stores</h4>
<div class="paragraph">
<p>Stores are always tested with <strong>Isolated UnitTests</strong>.</p>
</div>
<div class="paragraph">
<p>Actions triggered by <code>dispatchAction()</code> calls are asynchronously performed to alter the state.
A good solution to test such a state transition is to use the done callback from Jasmine.</p>
</div>
<div class="listingblock">
<div class="title">Listing 57. Example for testing a store</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-ts hljs" data-lang="ts">let sut: FlightStore;

beforeEach(() =&gt; {
  sut = new FlightStore();
});

it('setPrintStateLoading sets print state to loading', (done: Function) =&gt; {
  sut.setPrintStateLoading(4711);

  sut.state$.pipe(first()).subscribe(result =&gt; {
    expect(result.print.isLoading).toBe(true);
    expect(result.print.loadingId).toBe(4711);
    done();
  });
});

it('toggleRowChecked adds flight with given id to selectedValues Property', (done: Function) =&gt; {
  const flight: FlightTO = {
    id: 12
    // dummy data
  };
  sut.setRegisterabgleichListe([flight]);
  sut.toggleRowChecked(12);

  sut.state$.pipe(first()).subscribe(result =&gt; {
    expect(result.selectedValues).toContain(flight);
    done();
  });
});</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="guide-testing.asciidoc_testing-services">18.14.4. Testing services</h4>
<div class="paragraph">
<p>When testing services both strategies - <strong>Isolated UnitTests</strong> and <strong>Angular Testing Utilities</strong> - are valid options.</p>
</div>
<div class="paragraph">
<p>The goal of such tests are</p>
</div>
<div class="ulist">
<ul>
<li>
<p>assuring the behavior for valid data.</p>
</li>
<li>
<p>assuring the behavior for invalid data.</p>
</li>
<li>
<p>documenting functionality</p>
</li>
<li>
<p>savely performing refactorings</p>
</li>
<li>
<p>thinking about edge case behavior while testing</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For simple services <strong>Isolated UnitTests</strong> can be written.
Writing these tests takes lesser effort and they can be written very fast.</p>
</div>
<div class="paragraph">
<p>The following listing gives an example of such tests.</p>
</div>
<div class="listingblock">
<div class="title">Listing 58. Testing a simple services with <strong>Isolated UnitTests</strong></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-ts hljs" data-lang="ts">let sut: IsyDatePipe;

beforeEach(() =&gt; {
  sut = new IsyDatePipe();
});

it('transform should return empty string if input value is empty', () =&gt; {
  expect(sut.transform('')).toBe('');
});

it('transform should return empty string if input value is null', () =&gt; {
  expect(sut.transform(undefined)).toBe('');
});

// ...more tests</code></pre>
</div>
</div>
<div class="paragraph">
<p>For testing Use Case services the Angular Testing Utilities should be used.
The following listing gives an example.</p>
</div>
<div class="listingblock">
<div class="title">Listing 59. Test setup for testing use case services with Angular Testing Utilities</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-ts hljs" data-lang="ts">let sut: FlightPrintService;
let store: FlightStore;
let httpController: HttpTestingController;
let flightCalculationServiceStub: jasmine.SpyObj&lt;FlightCalculationService&gt;;
const flight: FlightTo = {
  // ... valid dummy data
};

beforeEach(() =&gt; {
  flightCalculationServiceStub = jasmine.createSpyObj('FlightCalculationService', ['getFlightType']);
  flightCalculationServiceStub.getFlightType.and.callFake((catalog: string, type: string, key: string) =&gt; of(`${key}_long`));
  TestBed.configureTestingModule({
    imports: [
      HttpClientTestingModule,
      RouterTestingModule,
    ],
    providers: [
      FlightPrintService,
      FlightStore,
      FlightAdapter,
      {provide: FlightCalculationService, useValue: flightCalculationServiceStub}
    ]
  });

  sut = TestBed.get(FlightPrintService);
  store = TestBed.get(FlightStore);
  httpController = TestBed.get(HttpTestingController);
});</code></pre>
</div>
</div>
<div class="paragraph">
<p>When using TestBed, it is important</p>
</div>
<div class="ulist">
<ul>
<li>
<p>to import HttpClientTestingModule for stubbing the backend</p>
</li>
<li>
<p>to import RouterTestingModule for stubbing the Angular router</p>
</li>
<li>
<p>not to stub stores, adapters and business services</p>
</li>
<li>
<p>to stub services from libraries like FlightCalculationService - the correct implementation of libraries should not be tested by these tests.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Testing backend communication looks like this:</p>
</div>
<div class="listingblock">
<div class="title">Listing 60. Testing backend communication with Angular HttpTestingController</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-ts hljs" data-lang="ts">it('loads flight if not present in store', fakeAsync(() =&gt; {
  sut.initializePrintDialog(1337);
  const processRequest = httpController.expectOne('/path/to/flight');
  processRequest.flush(flight);

  httpController.verify();
}));

it('does not load flight if present in store', fakeAsync(() =&gt; {
  const flight = {...flight, id: 4711};
  store.setRegisterabgleich(flight);

  sut.initializePrintDialog(4711);
  httpController.expectNone('/path/to/flight');

  httpController.verify();
}));</code></pre>
</div>
</div>
<div class="paragraph">
<p>The first test assures a correct XHR request is performed if <code>initializePrintDialog()</code> is called and no data is in the store.
The second test assures no XHR request ist performed if the needed data is already in the store.</p>
</div>
<div class="paragraph">
<p>The next steps are checks for the correct implementation of logic.</p>
</div>
<div class="listingblock">
<div class="title">Listing 61. Example testing a Use Case service</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-ts hljs" data-lang="ts">it('creates flight destination for valid key in svz', fakeAsync(() =&gt; {
  const flightTo: FlightTo = {
    ...flight,
    id: 4712,
    profile: '77'
  };
  store.setFlight(flightTo);
  let result: FlightPrintContent|undefined;

  sut.initializePrintDialog(4712);
  store.select(s =&gt; s.print.content).subscribe(content =&gt; result = content);
  tick();

  expect(result!.destination).toBe('77_long (ID: 77)');
}));</code></pre>
</div>
</div>
<!-- toc disabled -->
</div>
</div>
<div class="sect2">
<h3 id="guide-update-angular-cli.asciidoc">18.15. Update Angular CLI</h3>
<div class="sect3">
<h4 id="guide-update-angular-cli.asciidoc_angular-cli-common-issues">18.15.1. Angular CLI common issues</h4>
<div class="paragraph">
<p>There are constant updates for the official Angular framework dependencies. These dependencies are directly related with the Angular CLI package. Since this package comes installed by default inside the devonfw distribution folder for Windows OS and the distribution is updated every few months it needs to be updated in order to avoid known issues.</p>
</div>
</div>
<div class="sect3">
<h4 id="guide-update-angular-cli.asciidoc_angular-cli-update-guide">18.15.2. Angular CLI update guide</h4>
<div class="paragraph">
<p>For <strong>Linux users</strong> is as easy as updating the global package:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ npm unistall -g @angular/cli
$ npm install -g @angular/cli</code></pre>
</div>
</div>
<div class="paragraph">
<p>For <strong>Windows users</strong> the process is only a bit harder. Open the <strong>devonfw bundled console</strong> and do as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ cd [devonfw_dist_folder]
$ cd software/nodejs
$ npm uninstall @angular/cli --no-save
$ npm install @angular/cli --no-save</code></pre>
</div>
</div>
<div class="paragraph">
<p>After following these steps you should have the latest Angular CLI version installed in your system. In order to check it run in the distribution console:</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
At the time of this writing, the Angular CLI is at 1.7.4 version.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">λ ng version

     _                      _                 ____ _     ___
    / \   _ __   __ _ _   _| | __ _ _ __     / ___| |   |_ _|
   / △ \ | '_ \ / _` | | | | |/ _` | '__|   | |   | |    | |
  / ___ \| | | | (_| | |_| | | (_| | |      | |___| |___ | |
 /_/   \_\_| |_|\__, |\__,_|_|\__,_|_|       \____|_____|___|
                |___/


Angular CLI: 7.2.3
Node: 10.13.0
OS: win32 x64
Angular:
...</code></pre>
</div>
</div>
<!-- toc disabled -->
</div>
</div>
<div class="sect2">
<h3 id="guide-working-with-angular-cli.asciidoc">18.16. Working with Angular CLI</h3>
<div class="paragraph">
<p>Angular CLI provides a facade for building, testing, linting, debugging and generating code.
Under the hood Angular CLI uses specific tools to achieve these tasks.
The user does no need to maintain them and can rely on Angular to keep them up to date and maybe switch to other tools which come up in the future.</p>
</div>
<div class="paragraph">
<p>The Angular CLI provides a wiki with common tasks you encounter when working on applications with the Angular CLI.
<a href="https://github.com/angular/angular-cli/wiki">The Angular CLI Wiki can be found here.</a></p>
</div>
<div class="paragraph">
<p>In this guide we will go through the most important tasks.
To go into more details, please visit the Angular CLI wiki.</p>
</div>
<div class="sect3">
<h4 id="guide-working-with-angular-cli.asciidoc_installing-angular-cli">18.16.1. Installing Angular CLI</h4>
<div class="paragraph">
<p>Angular CLI should be added as global and local dependency.
The following commands add Angular CLI as global Dependency.</p>
</div>
<div class="paragraph">
<p>yarn command</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">yarn global add @angular/cli</code></pre>
</div>
</div>
<div class="paragraph">
<p>npm command</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">npm install -g @angular/cli</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can check a successful installtion with <code>ng --version</code>.
This should print out the version installed.</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/install-cli-success.png"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/install-cli-success.png" alt="Printing Angular CLI Version" width="450"></a>
</div>
<div class="title">Figure 46. Printing Angular CLI Version</div>
</div>
</div>
<div class="sect3">
<h4 id="guide-working-with-angular-cli.asciidoc_running-a-live-development-server">18.16.2. Running a live development server</h4>
<div class="paragraph">
<p>The Angular CLI can be used to start a live development server.
First your application will be compiled and then the server will be started.
If you change the code of a file, the server will reload the displayed page.
Run your application with the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">ng serve -o</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="guide-working-with-angular-cli.asciidoc_running-unit-tests">18.16.3. Running Unit Tests</h4>
<div class="paragraph">
<p>All unit tests can be executed with the command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">ng test</code></pre>
</div>
</div>
<div class="paragraph">
<p>To make a single run and create a code coverage file use the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">ng test -sr -cc</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
You can configure the output format for code coverage files to match your requirements in the file <code>karma.conf.js</code> which can be found on toplevel of your project folder.
For instance, this can be useful for exporting the results to a SonarQube.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="guide-working-with-angular-cli.asciidoc_linting-the-code-quality">18.16.4. Linting the code quality</h4>
<div class="paragraph">
<p>You can lint your files with the command</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">ng lint --type-check</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
You can adjust the linting rules in the file tslint.json which can be found on toplevel of your project folder.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="guide-working-with-angular-cli.asciidoc_generating-code">18.16.5. Generating Code</h4>
<div class="sect4">
<h5 id="guide-working-with-angular-cli.asciidoc_creating-a-new-angular-cli-project">Creating a new Angular CLI project</h5>
<div class="paragraph">
<p>For creating a new Angular CLI project the command <code>ng new</code> is used.</p>
</div>
<div class="paragraph">
<p>The following command creates a new application named my-app.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">ng create my-app</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="guide-working-with-angular-cli.asciidoc_creating-a-new-feature-module">Creating a new feature module</h5>
<div class="paragraph">
<p>A new feature module can be created via <code>ng generate module`</code> command.</p>
</div>
<div class="paragraph">
<p>The following command generates a new feature module named todo.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">ng generate module todo</code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/generate-module.png"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/generate-module.png" alt="Generate a module with Angular CLI" width="450"></a>
</div>
<div class="title">Figure 47. Generate a module with Angular CLI</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
The created feature module needs to be added to the AppModule by hand.
Other option would be to define a lazy route in AppRoutingModule to make this a lazy loaded module.
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="guide-working-with-angular-cli.asciidoc_creating-a-new-component">Creating a new component</h5>
<div class="paragraph">
<p>To create components the command <code>ng generate component</code> can be used.</p>
</div>
<div class="paragraph">
<p>The following command will generate the component todo-details inside the components layer of todo module.
It will generate a class, a html file, a css file and a test file.
Also, it will register this component as declaration inside the nearest module - this ist TodoModule.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">ng generate component todo/components/todo-details</code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/generate-component.png"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/generate-component.png" alt="Generate a component with Angular CLI" width="450"></a>
</div>
<div class="title">Figure 48. Generate a component with Angular CLI</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
If you want to export the component, you have to add the component to exports array of the module.
This would be the case if you generate a component inside shared module.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="guide-working-with-angular-cli.asciidoc_configuring-an-angular-cli-project">18.16.6. Configuring an Angular CLI project</h4>
<div class="paragraph">
<p>Inside an Angular CLI project the file <code>.angular-cli.json</code> can be used to configure the Angular CLI.</p>
</div>
<div class="paragraph">
<p>The following options are very important to understand.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The property <code>defaults`</code> can be used to change the default style extension.
The following settings will make the Angular CLI generate <code>.less</code> files, when a new component is generated.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">"defaults": {
  "styleExt": "less",
  "component": {}
}</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>The property <code>apps</code> contains all applications maintained with Angular CLI.
Most of the time you will have only one.</p>
<div class="ulist">
<ul>
<li>
<p><code>assets</code> configures all the static files, that the application needs - this can be images, fonts, json files, etc.
When you add them to assets the Angular CLI will put these files to the build target and serve them while debugging.
The following will put all files in <code>/i18n</code> to the output folder <code>/i18n</code></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">"assets": [
  { "glob": "**/*.json", "input": "./i18n", "output": "./i18n" }
]</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>styles</code> property contains all style files that will be globally available.
The Angular CLI will create a styles bundle that goes directly into index.html with it.
The following will make all styles in <code>styles.less</code> globally available.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">"styles": [
  "styles.less"
]</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>environmentSource</code> and <code>environments</code> are used to configure configuration with the Angular CLI.
Inside the code always the file specified in <code>environmentSource</code> will be referenced.
You can define different environments - eg. production, staging, etc. - which you list in <code>enviroments</code>.
At compile time the Angular CLI will override all values in <code>environmentSource</code> with the values from the matching environment target.
The following code will build the application for the environment staging.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">ng build --environment=staging</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="master-devon4ng.asciidoc_ionic">19. Ionic</h2>
<div class="sectionbody">
<!-- toc disabled -->
<div class="sect2">
<h3 id="guide-ionic-getting-started.asciidoc">19.1. Ionic 4 Getting started</h3>
<div class="paragraph">
<p>Ionic is a front-end focused framework which offers different tools for developing hybrid mobile applications. The web technologies used for this purpose are CSS, Sass, HTML5 and Typescript.</p>
</div>
<div class="sect3">
<h4 id="guide-ionic-getting-started.asciidoc_why-ionic">19.1.1. Why Ionic?</h4>
<div class="paragraph">
<p>Ionic is used for developing hybrid applications, which means not having to rely on a specifyc IDE such as Android Studio or Xcode. Furthermore, development of native apps require learning different languages (Java/Kotlin for Android and Objective-C/Swift for Apple), with Ionic, a developer does not have to code the same functionality for multiple platforms, just use the adecuate libraries and components.</p>
</div>
</div>
<div class="sect3">
<h4 id="guide-ionic-getting-started.asciidoc_basic-environment-set-up">19.1.2. Basic environment set up</h4>
<div class="sect4">
<h5 id="guide-ionic-getting-started.asciidoc_install-ionic-cli">Install Ionic CLI</h5>
<div class="paragraph">
<p>Although the devonfw distribution comes with and already installed Ionic CLI, here are the steps to install it. The instalation of Ionic is easy, just one command has to be written:</p>
</div>
<div class="paragraph">
<p><code>npm install -g ionic</code></p>
</div>
</div>
<div class="sect4">
<h5 id="guide-ionic-getting-started.asciidoc_update-ionic-cli">Update Ionic CLI</h5>
<div class="paragraph">
<p>To update the installed version of the CLI run:</p>
</div>
<div class="paragraph">
<p><code>npm install -g ionic@latest</code></p>
</div>
<div class="paragraph">
<p>If the devonfw&#8217;s ionic CLI has to be updated, the steps are a little bit different:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>open the devonfw bundled console.</p>
</li>
<li>
<p><code>cd [devonfw_dist_folder]</code></p>
</li>
<li>
<p><code>cd software/nodejs</code></p>
</li>
<li>
<p><code>npm uninstall ionic --no-save</code></p>
</li>
<li>
<p><code>npm install ionic@latest --no-save</code></p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/ionic-getting-started/update-ionic-cli.PNG"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/ionic-getting-started/update-ionic-cli.PNG" alt="devonfw&#8217;s Ionic CLI uptaded"></a>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="basic-proyect-set-up">19.2. Basic proyect set up</h3>
<div class="paragraph">
<p>The set up of an ionic application is pretty inmediate and can be done in one line:</p>
</div>
<div class="paragraph">
<p><code>ionic start &lt;name&gt; &lt;template&gt; --type=angular</code></p>
</div>
<div class="ulist">
<ul>
<li>
<p>ionic start: Command to create an app.</p>
</li>
<li>
<p>&lt;name&gt;: Name of the application.</p>
</li>
<li>
<p>&lt;template&gt;: Model of the application.</p>
</li>
<li>
<p>--type=angular: With this flag, the app produced will be based on angular.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To create an empty project, the following command can be used:</p>
</div>
<div class="paragraph">
<p><code>ionic start MyApp blank --type=angular</code></p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/ionic-getting-started/ionic-blank-project.PNG"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/ionic-getting-started/ionic-blank-project.PNG" alt="Ionic blank project"></a>
</div>
</div>
<div class="paragraph">
<p>The image above shows the directory structure generated.</p>
</div>
<div class="paragraph">
<p>There are more templates available that can be seen with the command
<code>ionic start --list</code></p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/ionic-getting-started/ionic-start-list.png"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/ionic-getting-started/ionic-start-list.png" alt="List of ionic templates"></a>
</div>
</div>
<div class="paragraph">
<p>The templates surrounded by red line are based on angular and comes with Ionic v4, while the others belong to earlier versions (before v4).</p>
</div>
<!-- toc disabled -->
</div>
<div class="sect2">
<h3 id="guide-ionic-from-code-to-android.asciidoc">19.3. Ionic 4 to android</h3>
<div class="paragraph">
<p>This page is written to help developers to go from the source code of an ionic application to an android one, with this in mind, topics such as: environment, commands, modifications,&#8230;&#8203;  are covered.</p>
</div>
<div class="sect3">
<h4 id="guide-ionic-from-code-to-android.asciidoc_assumptions">19.3.1. Assumptions</h4>
<div class="paragraph">
<p>This document assumes that the reader has already:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Source code of an ionic 4 application and wants to build it on an android device,</p>
</li>
<li>
<p>A working installation of Node.js</p>
</li>
<li>
<p>An Ionic CLI installed and up-to-date.</p>
</li>
<li>
<p>Android Studio and Android SDK.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="guide-ionic-from-code-to-android.asciidoc_from-ionic-4-to-android-project">19.3.2. From ionic 4 to Android project</h4>
<div class="paragraph">
<p>When a native application is being dessigned, sometimes, functionalities that uses camera, geolocation, push notification, &#8230;&#8203; are requested. To resolve these requests, Capacitor can be used.</p>
</div>
<div class="paragraph">
<p>In general terms, Capacitor wraps apps made with Ionic (HTML, SCSS, Typescript) into WebViews that can be displayed in native applications (Android, IOS) and allows the developer to access native functionalities like the ones said before.</p>
</div>
<div class="paragraph">
<p>Installing capacitor is as easy as installing any node module, just a few commands have to be run in a console:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>cd name-of-ionic-4-app</code></p>
</li>
<li>
<p><code>npm install --save @capacitor/core @capacitor/cli</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Then, it is necessary to initialize capacitor with some information: app id, name of the app and the directory where your app is stored. To fill this information, run:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>npx cap init</code></p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="guide-ionic-from-code-to-android.asciidoc_modifications">Modifications</h5>
<div class="paragraph">
<p>Throughout the development process, usually back-end and front-end are on a local computer, so it&#8217;s a common practice to have diferent configuration files for each environment (commonly production and development). Ionic 4 uses an angular.json file to store those configurations and some rules to be applied.</p>
</div>
<div class="paragraph">
<p>If a back-end is hosted on <a href="http://localhost:8081" class="bare">http://localhost:8081</a>, and that direction is used in every environment, the application built for android will not work because computer and device do not have the same localhost. Fortunately, different configurations can be defined.</p>
</div>
<div class="paragraph">
<p>Android Studio uses 10.0.0.2 as alias for 127.0.0.1 (computer&#8217;s localhost) so adding http//10.0.0.2:8081 in a new environment file and modifying angular.json accordingly, will make possible connect front-end and back-end.</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/ionic-to-android/environments.png"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/ionic-to-android/environments.png" alt="Android environment and angular.json"></a>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>"build": {
...
    "configurations": {
        ...
        "android": {
            "fileReplacements": [
                {
                    "replace": "src/environments/environment.ts",
                    "with": "src/environments/environment.android.ts"
                }
            ]
        },
    }
}</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="guide-ionic-from-code-to-android.asciidoc_build">Build</h5>
<div class="paragraph">
<p>Once configured, it is necessary to build the Ionic 4 app using this new configuration:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>ionic build --configuration=android</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The next commands copy the build application on a folder named android and open android studio.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>npx cap add android</code></p>
</li>
<li>
<p><code>npx cap copy</code></p>
</li>
<li>
<p><code>npx cap open android</code></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="guide-ionic-from-code-to-android.asciidoc_from-android-project-to-emulated-device">19.3.3. From Android project to emulated device</h4>
<div class="paragraph">
<p>Once Android Studio is opened, follow these steps:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Click on "Build" &#8594; Make project.</p>
</li>
<li>
<p>Click on "Build" &#8594; Make Module 'app' (default name).</p>
</li>
</ol>
</div>
<div class="paragraph">
<p><span class="image"><a class="image" href="images/ionic-to-android/and-vsc-make.png"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/ionic-to-android/and-vsc-make.png" alt="Click on make project" width="400"></a></span>
<span class="image"><a class="image" href="images/ionic-to-android/and-vsc-make-app.png"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/ionic-to-android/and-vsc-make-app.png" alt="click on make app" width="400"></a></span></p>
</div>
<div class="olist arabic">
<ol class="arabic" start="3">
<li>
<p>Click on" Build" &#8594; Build Bundle(s) / APK(s) &#8594; Build APK(s).</p>
</li>
<li>
<p>Click on run and choose a device.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p><span class="image"><a class="image" href="images/ionic-to-android/and-vsc-build-apk.png"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/ionic-to-android/and-vsc-build-apk.png" alt="click on build APK" width="400"></a></span>
<span class="image"><a class="image" href="images/ionic-to-android/and-vsc-build-run.png"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/ionic-to-android/and-vsc-build-run.png" alt="click on running device" width="400"></a></span></p>
</div>
<div class="paragraph">
<p>If there are no devices available, a new one can be created:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Click on "Create new device"</p>
</li>
<li>
<p>Select hardware and click "Next". For example: Phone &#8594; Nexus 5X.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p><span class="image"><a class="image" href="images/ionic-to-android/create-new-device.png"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/ionic-to-android/create-new-device.png" alt="Create new device" width="400"></a></span>
<span class="image"><a class="image" href="images/ionic-to-android/new-phone-nexus.png"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/ionic-to-android/new-phone-nexus.png" alt="Select hardware" width="400"></a></span></p>
</div>
<div class="olist arabic">
<ol class="arabic" start="3">
<li>
<p>Download a system image.</p>
<div class="olist loweralpha">
<ol class="loweralpha">
<li>
<p>Click on download.</p>
</li>
<li>
<p>Wait until the installation finished and then click "Finish".</p>
</li>
<li>
<p>Click "Next".</p>
</li>
</ol>
</div>
</li>
<li>
<p>Verify configuration (default configuration should be enough) and click "Next".</p>
</li>
</ol>
</div>
<div class="paragraph">
<p><span class="image"><a class="image" href="images/ionic-to-android/download-so.png"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/ionic-to-android/download-so.png" alt="Download system image" width="400"></a></span>
<span class="image"><a class="image" href="images/ionic-to-android/config-device.png"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/ionic-to-android/config-device.png" alt="Check configuration" width="400"></a></span></p>
</div>
<div class="olist arabic">
<ol class="arabic" start="5">
<li>
<p>Check that the new device is created correctly.</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/ionic-to-android/new-phone-created.png"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/ionic-to-android/new-phone-created.png" alt="New created device" width="400"></a>
</div>
</div>
</div>
<div class="sect3">
<h4 id="guide-ionic-from-code-to-android.asciidoc_from-android-project-to-real-device">19.3.4. From Android project to real device</h4>
<div class="paragraph">
<p>To test on a real android device, an easy aproach to comunicate a smartphone (front-end) and computer (back-end) is to configure a Wi-fi hotspot and connect the computer to it. A guide about this process can be found at <a href="https://support.google.com/nexus/answer/9059108?hl=en" class="bare">https://support.google.com/nexus/answer/9059108?hl=en</a></p>
</div>
<div class="paragraph">
<p>Once connected, run <code>ipconfig</code> on a console if you are using windows or <code>ifconfig</code> on a linux machine to get the IP address of your machine&#8217;s Wireless LAN adapter Wi-fi.</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/ionic-to-android/ipconfig-short.png"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/ionic-to-android/ipconfig-short.png" alt="Result of ipconfig command on Windows 10" width="700"></a>
</div>
</div>
<div class="paragraph">
<p>This obtained IP must be used instead of "localhost" or "10.0.2.2" at environment.android.ts.</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/ionic-to-android/new-backend-url.PNG"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/ionic-to-android/new-backend-url.PNG" alt="Android environment file server URL" width="700"></a>
</div>
</div>
<div class="paragraph">
<p>After this configuration, follow the build steps in "From ionic 4 to Android project" and the first three steps in "From Android project to emulated device".</p>
</div>
<div class="sect4">
<h5 id="guide-ionic-from-code-to-android.asciidoc_send-apk-to-android-through-usb">Send APK to Android through USB</h5>
<div class="paragraph">
<p>To send the built application to a device, you can connect computer and mobile through USB, but first, it is necessary to unlock developer options.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Open "Settings" and go to "System".</p>
</li>
<li>
<p>Click on "About".</p>
</li>
<li>
<p>Click "Build number" seven times to unlock developer options.</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/ionic-to-android/enable-developer-options1_2_3.png"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/ionic-to-android/enable-developer-options1_2_3.png" alt="Steps to enable developer options: 1, 2, 3" width="700"></a>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="4">
<li>
<p>Go to "System" again an then to "Developer options"</p>
</li>
<li>
<p>Check that the options are "On".</p>
</li>
<li>
<p>Check that "USB debugging" is activated.</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/ionic-to-android/enable-developer-options4_5_6.png"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/ionic-to-android/enable-developer-options4_5_6.png" alt="Steps to enable developer options: 4, 5, 6" width="700"></a>
</div>
</div>
<div class="paragraph">
<p>After this, do the step four in "From Android project to emulated device" and choose the connected smartphone.</p>
</div>
</div>
<div class="sect4">
<h5 id="guide-ionic-from-code-to-android.asciidoc_send-apk-to-android-throught-email">Send APK to Android throught email</h5>
<div class="paragraph">
<p>When you build an APK, a dialog gives two options: locate or analyze. If the first one is chosen, Windows file explorer will be opened showing an APK that can be send using email. Download the APK on your phone and click it to install.</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/ionic-to-android/locate-apk.png"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/ionic-to-android/locate-apk.png" alt="Steps to enable developer options: 4, 5, 6" width="300"></a>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="guide-ionic-from-code-to-android.asciidoc_result">19.3.5. Result</h4>
<div class="paragraph">
<p>If everything goes correctly, the Ionic 4 application will be ready to be tested.</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/ionic-to-android/real-device.png"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/ionic-to-android/real-device.png" alt="Application running on a real device" width="300"></a>
</div>
</div>
<!-- toc disabled -->
</div>
</div>
<div class="sect2">
<h3 id="guide-ionic-pwa.asciidoc">19.4. Ionic Progressive Web App</h3>
<div class="paragraph">
<p>This guide is a continuation of the guide <a href="#guide-angular-pwa.asciidoc">Angular PWAs</a>, therefore, valid concepts explained there are still valid in this page but focused on Ionic.</p>
</div>
<div class="sect3">
<h4 id="guide-ionic-pwa.asciidoc_assumptions">19.4.1. Assumptions</h4>
<div class="paragraph">
<p>This guide assumes that you already have installed:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Node.js</p>
</li>
<li>
<p>npm package manager</p>
</li>
<li>
<p>Angular CLI</p>
</li>
<li>
<p>Ionic 4 CLI</p>
</li>
<li>
<p>Capacitor</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Also, it is a good idea to read the document about PWA using Angular.</p>
</div>
</div>
<div class="sect3">
<h4 id="guide-ionic-pwa.asciidoc_sample-application">19.4.2. Sample Application</h4>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/ionic/ionic-pwa/base.png" alt="Ionic 4 PWA Base" width="250 link="images/ionic/ionic-pwa/base.png"">
</div>
<div class="title">Figure 49. Basic ionic PWA.</div>
</div>
<div class="paragraph">
<p>To explain how to build progressive web apps (PWA) using Ionic 4, a basic application is going to be built. This app will be able to take photos even without network using PWA elements.</p>
</div>
<div class="sect4">
<h5 id="guide-ionic-pwa.asciidoc_step-1-create-a-new-project">Step 1: Create a new project</h5>
<div class="paragraph">
<p>This step can be completed with one simple command: <code>ionic start &lt;name&gt; &lt;template&gt;</code>, where &lt;name&gt; is the name and &lt;template&gt; a model for the app. In this case, the app is going to be named <strong>basic-ion-pwa</strong>.</p>
</div>
</div>
<div class="sect4">
<h5 id="guide-ionic-pwa.asciidoc_step-2-structures-and-styles">Step 2: Structures and styles</h5>
<div class="paragraph">
<p>The styles (scss) and structures (html) do not have anything specially relevant, just colors and ionic web components. The code can be found in <a href="https://github.com/devonfw/devon4ng/tree/master/samples/IonicBasicPWA">devon4ng samples</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="guide-ionic-pwa.asciidoc_step-3-add-functionality">Step 3: Add functionality</h5>
<div class="paragraph">
<p>After this step, the app will allow users take photos and display them in the main screen.
First we have to import three important elements:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>DomSanitizer: Sanitizes values to be safe to use.</p>
</li>
<li>
<p>SafeResourceUrl: Interface for values that are safe to use as URL.</p>
</li>
<li>
<p>Plugins: Capacitor constant value used to access to the device&#8217;s camera and toast dialogs.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-ts hljs" data-lang="ts">  import { DomSanitizer, SafeResourceUrl } from '@angular/platform-browser';
  import { Plugins, CameraResultType } from '@capacitor/core';
  const { Camera, Toast } = Plugins;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The process of taking a picture is enclosed in a <strong>takePicture</strong> method. takePicture calls the Camera&#8217;s <em>getPhoto</em> function which returs an URL or an exception. If a photo is taken then the image displayed in the main page will be changed for the new picture, else, if the app is closed without changing it, a toast message will be displayed.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-ts hljs" data-lang="ts">  export class HomePage {
    image: SafeResourceUrl;
    ...

    async takePicture() {
      try {
        const image = await Camera.getPhoto({
          quality: 90,
          allowEditing: true,
          resultType: CameraResultType.Uri,
        });

        // Change last picture shown
        this.image = this.sanitizer.bypassSecurityTrustResourceUrl(image.webPath);
      } catch (e) {
        this.show('Closing camera');
      }
    }

    async show(message: string) {
      await Toast.show({
        text: message,
      });
    }
  }</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="guide-ionic-pwa.asciidoc_step-4-pwa-elements">Step 4: PWA Elements</h5>
<div class="paragraph">
<p>When Ionic apps are not running natively, some resources like Camera do not work by default but can be enabled using PWA Elements. To use Capacitor&#8217;s PWA elements run <code>npm install @ionic/pwa-elements</code> and modify src/main.ts as shown below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-ts hljs" data-lang="ts">...

// Import for PWA elements
import { defineCustomElements } from '@ionic/pwa-elements/loader';

if (environment.production) {
  enableProdMode();
}

platformBrowserDynamic().bootstrapModule(AppModule)
  .catch(err =&gt; console.log(err));

// Call the element loader after the platform has been bootstrapped
defineCustomElements(window);</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="guide-ionic-pwa.asciidoc_step-5-make-it-progressive.">Step 5: Make it Progressive.</h5>
<div class="paragraph">
<p>Turining an ionic 4 app into a PWA is pretty easy, the same module used to turn Angular apps into PWAs has to be added, to do so, run: <code>ng add @angular/pwa</code>. This command also creates an <strong>icons</strong> folder inside <strong>src/assets</strong> and contains angular icons for multiple resolutions. If you want use other images, be sure that they have the same resolution, the names can be different but the file <strong>manifest.json</strong> has to be changed accordingly.</p>
</div>
</div>
<div class="sect4">
<h5 id="guide-ionic-pwa.asciidoc_step-6-configure-the-app">Step 6: Configure the app</h5>
<div class="paragraph">
<p><strong>manifest.json</strong></p>
</div>
<div class="paragraph">
<p>Default configuration.</p>
</div>
<div class="paragraph">
<p><strong>ngsw-config.json</strong></p>
</div>
<div class="paragraph">
<p>At <em>assetGroups &#8594; resources</em> add a urls field and a pattern to match PWA Elements scripts and other resources (images, styles, &#8230;&#8203;):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>  "urls": ["https://unpkg.com/@ionic/pwa-elements@1.0.2/dist/**"]</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="guide-ionic-pwa.asciidoc_step-7-check-that-your-app-is-a-pwa">Step 7: Check that your app is a PWA</h5>
<div class="paragraph">
<p>To check if an app is a PWA lets compare its normal behaviour against itself but built for production. Run in the project&#8217;s root folder the commands below:</p>
</div>
<div class="paragraph">
<p><code>ionic build --prod</code> to build the app using production settings.</p>
</div>
<div class="paragraph">
<p><code>npm install http-server</code> to install an npm module that can serve your built application. Documentation <a href="https://www.npmjs.com/package/http-server">here</a>.</p>
</div>
<div class="paragraph">
<p>Go to the <strong>www</strong> folder running <code>cd www</code>.</p>
</div>
<div class="paragraph">
<p><code>http-server -o</code> to serve your built app.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/ionic/ionic-pwa/http-server.png" alt="Http server running" width="600 link="images/ionic/ionic-pwa/http-server.png"">
</div>
<div class="title">Figure 50. Http server running on localhost:8081.</div>
</div>
<div class="paragraph">
<p>&#160;<br>
In another console instance run <code>ionic serve</code> to open the common app (not built).</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/ionic/ionic-pwa/ionic-serve.png" alt="Ionic serve on Visual Studio Code console" width="600 link="images/ionic/ionic-pwa/ionic-serve.png"">
</div>
<div class="title">Figure 51. Ionic server running on localhost:8100.</div>
</div>
<div class="paragraph">
<p>&#160;<br>
The first difference can be found on <em>Developer tools &#8594; application</em>, here it is seen that the PWA application (left) has a service worker and the common one does not.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/ionic/ionic-pwa/pwa-nopwa-app.png" alt="Application comparison" width="800 link="images/ionic/ionic-pwa/pwa-nopwa-app.png"">
</div>
<div class="title">Figure 52. Application service worker comparison.</div>
</div>
<div class="paragraph">
<p>&#160;<br>
If the "offline" box is checked, it will force a disconnection from network. In situations where users do not have connectivity or have a slow, one the PWA can still be accesed and used.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/ionic/ionic-pwa/online-offline.png" alt="Online offline apps" width="800 link="images/ionic/ionic-pwa/online-offline.png"">
</div>
<div class="title">Figure 53. Offline application.</div>
</div>
<div class="paragraph">
<p>&#160;<br>
Finally, plugins like <a href="https://chrome.google.com/webstore/detail/lighthouse/blipmdconlkpinefehnmjammfjpmpbjk">Lighthouse</a> can be used to test whether an application is progressive or not.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/ionic/ionic-pwa/lighthouse.png" alt="Lighthouse report" width="800 link="images/ionic/ionic-pwa/lighthouse.png"">
</div>
<div class="title">Figure 54. Lighthouse report.</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="master-devon4ng.asciidoc_layouts">20. Layouts</h2>
<div class="sectionbody">
<!-- toc disabled -->
<div class="sect2">
<h3 id="guide-layout-with-angular-material.asciidoc">20.1. Angular Material Layout</h3>
<div class="paragraph">
<p>The purpose of this guide is to get a basic understanding of creating layouts using <a href="https://material.angular.io">Angular Material</a> in a devon4ng application. We will create an application with a header containing some menu links and a sidenav with some navigation links.</p>
</div>
<div class="imageblock text-center">
<div class="content">
<a class="image" href="images/layout-angular-material/1-finished-application.png"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/layout-angular-material/1-finished-application.png" alt="Finished application" width="700"></a>
</div>
<div class="title">Figure 55. This is what the finished application will look like</div>
</div>
<div class="sect3">
<h4 id="guide-layout-with-angular-material.asciidoc_lets-begin">20.1.1. Let&#8217;s begin</h4>
<div class="paragraph">
<p>We start with opening the console(running console.bat in the Devon distribution folder) and running the following command to start a project named devon4ng-mat-layout</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>ng new devon4ng-mat-layout</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Select <code>y</code> when it asks whether it would like to add Angular routing and select <code>SCSS</code> when it asks for the stylesheet format.
You can also use the Devcon to create a new devon4ng application.</p>
</div>
<div class="paragraph">
<p>Once the creation process is complete, open your newly created application in Visual Studio Code. Try running the empty application by running the following command in the integrated terminal:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>ng serve</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Angular will spin up a server and you can check your application by visiting <a href="http://localhost:4200/" class="bare">http://localhost:4200/</a> in your browser.</p>
</div>
<div class="imageblock text-center">
<div class="content">
<a class="image" href="images/layout-angular-material/2-blank-application.png"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/layout-angular-material/2-blank-application.png" alt="Blank application" width="700"></a>
</div>
<div class="title">Figure 56. Blank application</div>
</div>
</div>
<div class="sect3">
<h4 id="guide-layout-with-angular-material.asciidoc_adding-angular-material-library-to-the-project">20.1.2. Adding Angular Material library to the project</h4>
<div class="paragraph">
<p>Next we will add Angular Material to our application. In the integrated terminal, press <code>Ctrl + C</code> to terminate the running application and run the following command:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>npm install --save @angular/material @angular/cdk @angular/animations</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can also use Yarn to install the dependencies if you prefer that:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>yarn add @angular/material @angular/cdk @angular/animations</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Once the dependencies are installed, we need to import the <code>BrowserAnimationsModule</code> in our AppModule for animations support.</p>
</div>
<div class="listingblock">
<div class="title">Listing 62. Importing BrowserAnimationsModule in AppModule</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-ts hljs" data-lang="ts">import {BrowserAnimationsModule} from '@angular/platform-browser/animations';

@NgModule({
  ...
  imports: [BrowserAnimationsModule],
  ...
})
export class AppModule { }</code></pre>
</div>
</div>
<div class="paragraph">
<p>Angular Material provides a host of components for designing our application. All the components are well structured into NgModules. For each component from the Angular Material library that we want to use, we have to import the respective NgModule.</p>
</div>
<div class="listingblock">
<div class="title">Listing 63. We will be using the following components in our application:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-ts hljs" data-lang="ts">import { MatIconModule, MatButtonModule, MatMenuModule, MatListModule, MatToolbarModule, MatSidenavModule } from '@angular/material';

@NgModule({
  ...
  imports: [
	...
    MatIconModule,
    MatButtonModule,
    MatMenuModule,
    MatListModule,
    MatToolbarModule,
    MatSidenavModule,
	...
	],
  ...
})
export class AppModule { }</code></pre>
</div>
</div>
<div class="paragraph">
<p>A better approach is to import and then export all the required components in a shared  module. But for the sake of simplicity, we are importing all the required components in the AppModule itself.</p>
</div>
<div class="paragraph">
<p>Next, we include a theme in our application. Angular Material comes with four inbuilt themes: indigo-pink, deeppurple-amber, pink-bluegrey and purple-green. It is also possible to create our own custom theme, but that is beyond the scope of this guide. Including a theme is required to apply all of the core and theme styles to your application.
We will include the indigo-pink theme in our application by importing the <code>indigo-pink.css</code> file in our <code>src/styles.scss</code>:</p>
</div>
<div class="listingblock">
<div class="title">Listing 64. In src/styles.scss:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-css hljs" data-lang="css">@import "~@angular/material/prebuilt-themes/indigo-pink.css";</code></pre>
</div>
</div>
<div class="paragraph">
<p>Some Angular Material components depend on HammerJs for gestures. So it is a good idea to install HammerJs as a dependency in our application. To do so, run the following command in the terminal:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>npm install --save hammerjs</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Then import it in the <code>src/main.ts</code> file</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>import 'hammerjs';</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To use <a href="https://material.io/icons/">Material Design Icons</a> along with the <code>mat-icon</code> component, we will load the Material Icons library in our <code>src/index.html</code> file</p>
</div>
<div class="listingblock">
<div class="title">Listing 65. In src/index.html:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-html hljs" data-lang="html">&lt;link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet"&gt;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="guide-layout-with-angular-material.asciidoc_development">20.1.3. Development</h4>
<div class="paragraph">
<p>Now that we have all the Angular Material related dependencies set up in our project, we can start coding. Let&#8217;s begin by adding a suitable <code>margin</code> and <code>font</code> to the <code>body</code> element of our single page application. We will add it in the <code>src/styles.scss</code> file to apply it globally:</p>
</div>
<div class="listingblock">
<div class="title">Listing 66. In src/styles.scss:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-css hljs" data-lang="css">body {
  margin: 0;
  font-family: "Segoe UI", Roboto, sans-serif;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>At this point, if we run our application with <code>ng serve</code>, this is how it will look like:</p>
</div>
<div class="imageblock text-center">
<div class="content">
<a class="image" href="images/layout-angular-material/3-material-added.png"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/layout-angular-material/3-material-added.png" alt="Angular Material added to the application" width="700"></a>
</div>
<div class="title">Figure 57. Application with Angular Material set up</div>
</div>
<div class="paragraph">
<p>We will clear the <code>app.component.html</code> file and setup a header with a menu button and some navigational links. We will use <code>mat-toolbar</code>, <code>mat-button</code>, <code>mat-menu</code>, <code>mat-icon</code> and <code>mat-icon-button</code> for this:</p>
</div>
<div class="listingblock">
<div class="title">Listing 67. app.component.html:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-html hljs" data-lang="html">&lt;mat-toolbar color="primary"&gt;
  &lt;button mat-icon-button aria-label="menu"&gt;
    &lt;mat-icon&gt;menu&lt;/mat-icon&gt;
  &lt;/button&gt;
  &lt;button mat-button [matMenuTriggerFor]="submenu"&gt;Menu 1&lt;/button&gt;
  &lt;button mat-button&gt;Menu 2&lt;/button&gt;
  &lt;button mat-button&gt;Menu 3&lt;/button&gt;

  &lt;mat-menu #submenu="matMenu"&gt;
    &lt;button mat-menu-item&gt;Sub-menu 1&lt;/button&gt;
    &lt;button mat-menu-item [matMenuTriggerFor]="submenu2"&gt;Sub-menu 2&lt;/button&gt;
  &lt;/mat-menu&gt;

  &lt;mat-menu #submenu2="matMenu"&gt;
    &lt;button mat-menu-item&gt;Menu Item 1&lt;/button&gt;
    &lt;button mat-menu-item&gt;Menu Item 2&lt;/button&gt;
    &lt;button mat-menu-item&gt;Menu Item 3&lt;/button&gt;
  &lt;/mat-menu&gt;

&lt;/mat-toolbar&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The color attribute on the <code>mat-toolbar</code> element will give it the primary (indigo) color as defined by our theme. The color attribute works with most Angular Material components; the possible values are 'primary', 'accent' and 'warn'.
The mat-toolbar is a suitable component to represent a header. It serves as a placeholder for elements we want in our header.
Inside the mat-toolbar, we start with a button having mat-icon-button attribute, which itself contains a mat-icon element having the value <code>menu</code>. This will serve as a menu button which we can use to toggle the sidenav.
We follow it with some sample buttons having the mat-button attribute. Notice the first button has a property <code>matMenuTriggerFor</code> binded to a local reference <code>submenu</code>. As the property name suggests, the click of this button will display the <code>mat-menu</code> element with the specified local reference as a drop-down menu. The rest of the code is self explanatory.</p>
</div>
<div class="imageblock text-center">
<div class="content">
<a class="image" href="images/layout-angular-material/4-header.png"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/layout-angular-material/4-header.png" alt="Header added to the application" width="700"></a>
</div>
<div class="title">Figure 58. This is how our application looks with the first menu button (Menu 1) clicked.</div>
</div>
<div class="paragraph">
<p>We want to keep the sidenav toggling menu button on the left and move the rest to the right to make it look better. To do this we add a class to the menu icon button:</p>
</div>
<div class="listingblock">
<div class="title">Listing 68. app.component.html:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-html hljs" data-lang="html">...
  &lt;button mat-icon-button aria-label="menu" class="menu"&gt;
    &lt;mat-icon&gt;menu&lt;/mat-icon&gt;
  &lt;/button&gt;
...</code></pre>
</div>
</div>
<div class="paragraph">
<p>And in the <code>app.component.scss</code> file, we add the following style:</p>
</div>
<div class="listingblock">
<div class="title">Listing 69. app.component.scss:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-css hljs" data-lang="css">.menu {
    margin-right: auto;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The mat-toolbar element already has it&#8217;s display property set to <code>flex</code>. Setting the menu icon button&#8217;s <code>margin-right</code> property to <code>auto</code> keeps itself on the left and pushes the other elements to the right.</p>
</div>
<div class="imageblock text-center">
<div class="content">
<a class="image" href="images/layout-angular-material/5-header-layout-final.png"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/layout-angular-material/5-header-layout-final.png" alt="Final look of the header" width="700"></a>
</div>
<div class="title">Figure 59. Final look of the header.</div>
</div>
<div class="paragraph">
<p>Next, we will create a sidenav. But before that lets create a couple of components to navgate between, the links of which we will add to the sidenav.
We will use the <code>ng generate component</code> (or <code>ng g c</code> command for short) to create <em>Home</em> and <em>Data</em> components. We nest them in the <code>pages</code> sub-directory since they represent our pages.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>ng g c pages/home</code></p>
</li>
<li>
<p><code>ng g c pages/data';</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Let us set up the routing such that when we visit <code><a href="http://localhost:4200/" class="bare">http://localhost:4200/</a></code> root url we see the <code>HomeComponent</code> and when we visit <code><a href="http://localhost:4200/data" class="bare">http://localhost:4200/data</a></code> url we see the <code>DataComponent</code>.
We had opted for routing while creating the application, so we have the routing module <code>app-routing.module.ts</code> setup for us. In this file, we have the empty <code>routes</code> array where we set up our routes.</p>
</div>
<div class="listingblock">
<div class="title">Listing 70. app-routing.module.ts:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-ts hljs" data-lang="ts">...
import { HomeComponent } from './pages/home/home.component';
import { DataComponent } from './pages/data/data.component';

	const routes: Routes = [
	  { path: '', component: HomeComponent },
	  { path: 'data', component: DataComponent }
	];
...</code></pre>
</div>
</div>
<div class="paragraph">
<p>We need to provide a hook where the components will be loaded when their respective URLs are loaded. We do that by using the <code>router-outlet</code> directive in the <code>app.component.html</code>.</p>
</div>
<div class="listingblock">
<div class="title">Listing 71. app.component.html:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-html hljs" data-lang="html">...
	&lt;/mat-toolbar&gt;
	&lt;router-outlet&gt;&lt;/router-outlet&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now when we visit the defined URLs we see the appropriate components rendered on screen.</p>
</div>
<div class="paragraph">
<p>Lets change the contents of the components to have something better.</p>
</div>
<div class="listingblock">
<div class="title">Listing 72. home.component.html:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-html hljs" data-lang="html">&lt;h2&gt;Home Page&lt;/h2&gt;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Listing 73. home.component.scss:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-css hljs" data-lang="css">h2 {
    text-align: center;
    margin-top: 50px;
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Listing 74. data.component.html:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-html hljs" data-lang="html">&lt;h2&gt;Data Page&lt;/h2&gt;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Listing 75. data.component.scss:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-css hljs" data-lang="css">h2 {
    text-align: center;
    margin-top: 50px;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The pages look somewhat better now:</p>
</div>
<div class="imageblock text-center">
<div class="content">
<a class="image" href="images/layout-angular-material/6-home-page.png"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/layout-angular-material/6-home-page.png" alt="Home page" width="700"></a>
</div>
<div class="title">Figure 60. Home page</div>
</div>
<div class="imageblock text-center">
<div class="content">
<a class="image" href="images/layout-angular-material/7-data-page.png"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/layout-angular-material/7-data-page.png" alt="Data page" width="700"></a>
</div>
<div class="title">Figure 61. Data page</div>
</div>
<div class="paragraph">
<p>Let us finally create the sidenav. To implement the sidenav we need to use 3 Angular Material components: <code>mat-sidenav-container</code>, <code>mat-sidenav</code> and <code>mat-sidenav-content</code>.
The <code>mat-sidenav-container</code>, as the name suggests, acts as a container for the sidenav and the associated content. So it is the parent element, and <code>mat-sidenav</code> and <code>mat-sidenav-content</code> are the children sibling elements. <code>mat-sidenav</code> represents the sidenav. We can put any content we want, though it is usually used to conatain a list of navigational links. The <code>mat-sidenav-content</code> element is for conataining our main page content. Since we need the sidenav application-wide, we will put it in the <code>app.component.html</code>.</p>
</div>
<div class="listingblock">
<div class="title">Listing 76. app.component.html:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-html hljs" data-lang="html">...
&lt;/mat-toolbar&gt;

&lt;mat-sidenav-container&gt;
  &lt;mat-sidenav mode="over" [disableClose]="false" #sidenav&gt;
    Sidenav
  &lt;/mat-sidenav&gt;
  &lt;mat-sidenav-content&gt;
    &lt;router-outlet&gt;&lt;/router-outlet&gt;
  &lt;/mat-sidenav-content&gt;
&lt;/mat-sidenav-container&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>mat-sidenav</code> has a <code>mode</code> property, which accepts one of the 3 values: <code>over</code>, <code>push</code> and <code>side</code>. It decides the behavior of the sidenav. <code>mat-sidenav</code> also has a <code>disableClose</code> property which accents a boolean value. It toggles the behavior where we click on the backdrop or press the <code>Esc</code> key to close the sidenav. There are other properties which we can use to customize the appearance, behavior and position of the sidenav. You can find the properties documented online at <a href="https://material.angular.io/components/sidenav/api" class="bare">https://material.angular.io/components/sidenav/api</a>
We moved the <code>router-outlet</code> directive inside the <code>mat-sidenav-content</code> where it will render the routed component.
But if you check the running application in the browser, we don&#8217;t see the sidenav yet. That is because it is closed. We want to have the sidenav opened/closed at the click of the menu icon button on the left side of the header we implemented earlier. Notice we have set a local reference <code>#sidenav</code> on the <code>mat-sidenav</code> element. We can access this element and call its <code>toggle()</code> function to toggle open or close the sidenav.</p>
</div>
<div class="listingblock">
<div class="title">Listing 77. app.component.html:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-html hljs" data-lang="html">...
  &lt;button mat-icon-button aria-label="menu" class="menu" (click)="sidenav.toggle()"&gt;
    &lt;mat-icon&gt;menu&lt;/mat-icon&gt;
  &lt;/button&gt;
...</code></pre>
</div>
</div>
<div class="imageblock text-center">
<div class="content">
<a class="image" href="images/layout-angular-material/8-sidenav-started.png"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/layout-angular-material/8-sidenav-started.png" alt="Sidenav works" width="700"></a>
</div>
<div class="title">Figure 62. Sidenav is implemented</div>
</div>
<div class="paragraph">
<p>We can now open the sidenav by clicking the menu icon button. But it does not look right. The sidenav is only as wide as its content. Also the page does not stretch the entire viewport due to lack of content.
Let&#8217;s add the following styles to make the page fill the viewport:</p>
</div>
<div class="listingblock">
<div class="title">Listing 78. app.component.scss:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-css hljs" data-lang="css">...
mat-sidenav-container {
    position: absolute;
    top: 64px;
    left: 0;
    right: 0;
    bottom: 0;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The sidenav&#8217;s width will be corrected when we add the navigational links to it. That is the only thing remaining to be done. Lets implement it now:</p>
</div>
<div class="listingblock">
<div class="title">Listing 79. app.component.html:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-html hljs" data-lang="html">...
  &lt;mat-sidenav [disableClose]="false" mode="over" #sidenav&gt;
	&lt;mat-nav-list&gt;
      &lt;a
        id="home"
        mat-list-item
        [routerLink]="['./']"
        (click)="sidenav.close()"
        routerLinkActive="active"
        [routerLinkActiveOptions]="{exact: true}"
      &gt;
        &lt;mat-icon matListAvatar&gt;home&lt;/mat-icon&gt;
        &lt;h3 matLine&gt;Home&lt;/h3&gt;
        &lt;p matLine&gt;sample home page&lt;/p&gt;
      &lt;/a&gt;
      &lt;a
        id="sampleData"
        mat-list-item
        [routerLink]="['./data']"
        (click)="sidenav.close()"
        routerLinkActive="active"
      &gt;
        &lt;mat-icon matListAvatar&gt;grid_on&lt;/mat-icon&gt;
        &lt;h3 matLine&gt;Data&lt;/h3&gt;
        &lt;p matLine&gt;sample data page&lt;/p&gt;
      &lt;/a&gt;
    &lt;/mat-nav-list&gt;
  &lt;/mat-sidenav&gt;
...</code></pre>
</div>
</div>
<div class="paragraph">
<p>We use the <code>mat-nav-list</code> element to set a list of navigational links. We use the <code>a</code> tags with <code>mat-list-item</code> directive. We implement a <code>click</code> listener on each link to close the sidenav when it is clicked. The <code>routerLink</code> directive is used to provide the URLs to navigate to. The <code>routerLinkActive</code> directive is used to provide the class name which will be added to the link when it&#8217;s URL is visited. Here we name the class`active`. To stye it, let' modify the <code>app.component.scss</code> file:</p>
</div>
<div class="listingblock">
<div class="title">Listing 80. app.component.scss:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-css hljs" data-lang="css">...
mat-sidenav-container {
...
	a.active {
        background: #8e8d8d;
        color: #fff;

        p {
            color: #4a4a4a;
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now we have a working application with a basic layout: a header with some menu and a sidenav with some navigational links.</p>
</div>
<div class="imageblock text-center">
<div class="content">
<a class="image" href="images/layout-angular-material/9-finished.png"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/layout-angular-material/9-finished.png" alt="Finished application" width="700"></a>
</div>
<div class="title">Figure 63. Finished application</div>
</div>
</div>
<div class="sect3">
<h4 id="guide-layout-with-angular-material.asciidoc_conclusion">20.1.4. Conclusion</h4>
<div class="paragraph">
<p>The purpose of this guide was to provide a basic understanding of creating layouts with Angular Material. The Angular Material library has a huge collection of ready to use components which can be found at <a href="https://material.angular.io/components/categories" class="bare">https://material.angular.io/components/categories</a>
It has provided documentation and example usage for each of its components.  Going through the documentation will give a better understanding of using Angular Material components in our devon4ng applications.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="master-devon4ng.asciidoc_ngrx">21. NgRx</h2>
<div class="sectionbody">
<!-- toc disabled -->
<div class="sect2">
<h3 id="guide-ngrx-getting-started.asciidoc">21.1. Introduction to NgRx</h3>
<div class="paragraph">
<p><a href="https://github.com/ngrx">NgRx</a> is a state management framework for Angular based on the <a href="https://redux.js.org/">Redux</a> pattern.</p>
</div>
<div class="sect3">
<h4 id="guide-ngrx-getting-started.asciidoc_the-need-for-client-side-state-management">21.1.1. The need for client side state management</h4>
<div class="paragraph">
<p>You may wonder why you should bother with state management. Usually data resides in a backend storage system, e.g. a database, and is retrieved by the client on a per-need basis. To add, update, or delete entities from this store, clients have to invoke API endpoints at the backend. Mimicking database-like transactions on the client side may seem redundant. However, there are many use cases for which a global client-side state is appropriate:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the client has some kind of global state which should survive the destruction of a component, but does not warrant server side persistence, for example: volume level of media, expansion status of menus</p>
</li>
<li>
<p>sever side data should not be retrieved every time it is needed, either because multiple components consume it, or because it should be cached, e.g. the personal watchlist in an online streaming app</p>
</li>
<li>
<p>the app provides a rich experience with offline functionality, e.g. a native app built with <a href="#guilde-ionic-getting-started.asciidoc">Ionic</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Saving global states inside the services they originates from results in a data flow that is hard to follow and state becoming inconsistent due to unordered state mutations. Following the <em>single source of truth</em> principle, there should be a central location holding all your application&#8217;s state, just like a server side database does. State managament libraries for Angular provide tools for storing, retrieving, and updating client-side state.</p>
</div>
</div>
<div class="sect3">
<h4 id="guide-ngrx-getting-started.asciidoc_why-ngrx">21.1.2. Why NgRx?</h4>
<div class="paragraph">
<p>As stated in the <a href="#home.asciidoc">introduction</a>, devon4ng does not stipulate a particular state library, or require using one at all. However, NgRx has proven to be a robust, mature solution for this task, with good tooling and 3rd-party library support. Albeit introducing a level of indirection that requires additional effort even for simple features, the redux concept enforces a clear separation of concerns leading to a cleaner architecture.</p>
</div>
<div class="paragraph">
<p>Nonetheless, you should always compare different approaches to state management and pick the best one suiting your use case. Here&#8217;s a (non-exhaustive) list of competing state management libraries:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Plain Rxjs using the simple store described in <a href="#cookbook-abstract-class-store.asciidoc">Abstract Class Store</a></p>
</li>
<li>
<p><a href="https://github.com/ngxs">NgXS</a> reduces some boilerplate of NgRx by leveraging the power of decorators and moving side effects to the store</p>
</li>
<li>
<p><a href="https://github.com/mobxjs/mobx">MobX</a> follows a more imperative approach in contrast to the functional Redux pattern</p>
</li>
<li>
<p><a href="https://github.com/datorama/akita">Akita</a> also uses an imperative approach with direct setters in the store, but keeps the concept of immutable state transitions</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="guide-ngrx-getting-started.asciidoc_setup">21.1.3. Setup</h4>
<div class="paragraph">
<p>To get a quick start, use the provided <a href="https://github.com/devonfw-forge/devon4ng-ngrx-template">template for devon4ng + NgRx</a>.</p>
</div>
<div class="paragraph">
<p>To manually install the core store package together with a set of useful extensions:</p>
</div>
<div class="paragraph">
<p>NPM:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>npm install @ngrx/store @ngrx/effects @ngrx/entity @ngrx/store-devtools --save</pre>
</div>
</div>
<div class="paragraph">
<p>Yarn:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>yarn add @ngrx/store @ngrx/effects @ngrx/entity @ngrx/store-devtools</pre>
</div>
</div>
<div class="paragraph">
<p>We recommend to add the NgRx schematics to your project so you can create code artifacts from the command line:</p>
</div>
<div class="paragraph">
<p>NPM:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>npm install @ngrx/schematics --save-dev</pre>
</div>
</div>
<div class="paragraph">
<p>Yarn:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>yarn add @ngrx/schematics --dev</pre>
</div>
</div>
<div class="paragraph">
<p>Afterwards, make NgRx your default schematics provider, so you don&#8217;t have to type the qualified package name every time:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>ng config cli.defaultCollection @ngrx/schematics</pre>
</div>
</div>
<div class="paragraph">
<p>If you have custom settings for Angular schematics, you have to <a href="https://ngrx.io/guide/schematics">configure them as described here</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="guide-ngrx-getting-started.asciidoc_concept">21.1.4. Concept</h4>
<div class="imageblock text-center">
<div class="content">
<a class="image" href="images/ngrx-concept.svg"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/ngrx-concept.svg" alt="NgRx Architecture"></a>
</div>
<div class="title">Figure 64. NgRx architecture overview</div>
</div>
<div class="paragraph">
<p>Figure 1 gives an overview of the NgRx data flow. The single source of truth is managed as an immutable state object by the store. Components dispatch actions to trigger state changes. Actions are handed over to reducers, which take the current state and action data to compute the next state. Actions are also consumed byeffects, which perform side-effects such as retrieving data from the backend, and may dispatch new actions as a result. Components subscribe to state changes using selectors.</p>
</div>
<div class="paragraph">
<p>Continue with <a href="#guide-ngrx-simple-store.asciidoc">Creating a Simple Store</a>.</p>
</div>
<!-- toc disabled -->
</div>
</div>
<div class="sect2">
<h3 id="guide-ngrx-simple-store.asciidoc">21.2. State, Selection and Reducers</h3>
<div class="sect3">
<h4 id="guide-ngrx-simple-store.asciidoc_creating-a-simple-store">21.2.1. Creating a Simple Store</h4>
<div class="paragraph">
<p>In the following pages we use the example of an online streaming service. We will model a particular feature, a watchlist that can be populated by the user with movies she or he wants to see in the future.</p>
</div>
<div class="sect4">
<h5 id="guide-ngrx-simple-store.asciidoc_initializing-ngrx">Initializing NgRx</h5>
<div class="paragraph">
<p>If you&#8217;re starting fresh, you first have to initialize NgRx and create a root state. The fastest way to do this is using the schematic:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>ng generate @ngrx/schematics:store State --root --module app.module.ts</pre>
</div>
</div>
<div class="paragraph">
<p>This will automatically generate a root store and register it in the app module. Next we generate a feature module for the watchlist:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>ng generate module watchlist</pre>
</div>
</div>
<div class="paragraph">
<p>and create a corresponding feature store:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>ng generate store watchlist/Watchlist -m watchlist.module.ts</pre>
</div>
</div>
<div class="paragraph">
<p>This generates a file <code>watchlist/reducers/index.ts</code> with the reducer function, and registers the store in the watchlist module declaration.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If you&#8217;re getting an error <em>Schematic "store" not found in collection "@schematics/angular"</em>, this means you forgot to register the NgRx schematics as default.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Next, add the WatchlistModule to the AppModule imports so the feature store is registered when the application starts. We also added the <strong>store devtools</strong> which we will use later, resulting in the following file:</p>
</div>
<div class="paragraph">
<p><strong>app.module.ts</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">import { BrowserModule } from '@angular/platform-browser';
import { NgModule } from '@angular/core';

import { AppComponent } from './app.component';
import { EffectsModule } from '@ngrx/effects';
import { AppEffects } from './app.effects';
import { StoreModule } from '@ngrx/store';
import { reducers, metaReducers } from './reducers';
import { StoreDevtoolsModule } from '@ngrx/store-devtools';
import { environment } from '../environments/environment';
import { WatchlistModule } from './watchlist/watchlist.module';

@NgModule({
  declarations: [
    AppComponent
  ],
  imports: [
    BrowserModule,
    WatchlistModule,
    StoreModule.forRoot(reducers, { metaReducers }),
    // Instrumentation must be imported after importing StoreModule (config is optional)
    StoreDevtoolsModule.instrument({
      maxAge: 25, // Retains last 25 states
      logOnly: environment.production, // Restrict extension to log-only mode
    }),
    !environment.production ? StoreDevtoolsModule.instrument() : []
  ],
  providers: [],
  bootstrap: [AppComponent]
})
export class AppModule { }</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="guide-ngrx-simple-store.asciidoc_create-an-entity-model-and-initial-state">Create an entity model and initial state</h5>
<div class="paragraph">
<p>We need a simple model for our list of movies. Create a file <code>watchlist/models/movies.ts</code> and insert the following code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">export interface Movie {
    id: number;
    title: string;
    releaseYear: number;
    runtimeMinutes: number;
    genre: Genre;
}

export type Genre = 'action' | 'fantasy' | 'sci-fi' | 'romantic' | 'comedy' | 'mystery';

export interface WatchlistItem {
    id: number;
    movie: Movie;
    added: Date;
    playbackMinutes: number;
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>We discourage putting several types into the same file and do this only for the sake of keeping this tutorial brief.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Later we will learn how to retrieve data from the backend using effects. For now we will create an initial state for the user with a default movie.</p>
</div>
<div class="paragraph">
<p>State is defined and transforms by a reducer function. Let&#8217;s create a watchlist reducer:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>cd watchlist/reducers
ng g reducer WatchlistData --reducers index.ts</pre>
</div>
</div>
<div class="paragraph">
<p>Open the generated file <code>watchlist-data.reducer.ts</code>. You see three exports: The <strong>State</strong> interface defines the shape of the state. There is only one instance of a feature state in the store at all times. The <strong>initialState</strong> constant is the state at application creation time. The <strong>reducer</strong> function will later be called by the store to produce the next state instance based on the current state and an action object.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s put a movie into the user&#8217;s watchlist:</p>
</div>
<div class="paragraph">
<p><strong>watchlist-data.reducer.ts</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">export interface State {
  items: WatchlistItem[];
}

export const initialState: State = {
  items: [
    {
      id: 42,
      movie: {
        id: 1,
        title: 'Die Hard',
        genre: 'action',
        releaseYear: 1988,
        runtimeMinutes: 132
      },
      playbackMinutes: 0,
      added: new Date(),
    }
  ]
};</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="guide-ngrx-simple-store.asciidoc_select-the-current-watchlist">Select the current watchlist</h5>
<div class="paragraph">
<p>State slices can be retrieved from the store using selectors.</p>
</div>
<div class="paragraph">
<p>Create a watchlist component:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>ng g c watchlist/Watchlist</pre>
</div>
</div>
<div class="paragraph">
<p>and add it to the exports of WatchlistModule. Also, replace <code>app.component.html</code> with</p>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;app-watchlist&gt;&lt;/app-watchlist&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>State observables are obtained using selectors. They are memoized by default, meaning that you don&#8217;t have to worry about performance if you use complicated calculations when deriving state&#8201;&#8212;&#8201;these are only performed once per state emission.</p>
</div>
<div class="paragraph">
<p>Add a selector to <code>watchlist-data.reducer.ts</code>:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>export const getAllItems = (state: State) =&gt; state.items;</pre>
</div>
</div>
<div class="paragraph">
<p>Next, we have to re-export the selector for this substate in the feature reducer. Modify the <code>watchlist/reducers/index.ts</code> like this:</p>
</div>
<div class="paragraph">
<p><strong>watchlist/reducers/index.ts</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">import {
  ActionReducer,
  ActionReducerMap,
  createFeatureSelector,
  createSelector,
  MetaReducer
} from '@ngrx/store';
import { environment } from 'src/environments/environment';
import * as fromWatchlistData from './watchlist-data.reducer';
import * as fromRoot from 'src/app/reducers/index';

export interface WatchlistState { <i class="conum" data-value="1"></i><b>(1)</b>
  watchlistData: fromWatchlistData.State;
}

export interface State extends fromRoot.State { <i class="conum" data-value="2"></i><b>(2)</b>
  watchlist: WatchlistState;
}

export const reducers: ActionReducerMap&lt;WatchlistState&gt; = { <i class="conum" data-value="3"></i><b>(3)</b>
  watchlistData: fromWatchlistData.reducer,
};

export const metaReducers: MetaReducer&lt;WatchlistState&gt;[] = !environment.production ? [] : [];

export const getFeature = createFeatureSelector&lt;State, WatchlistState&gt;('watchlist'); <i class="conum" data-value="4"></i><b>(4)</b>

export const getWatchlistData = createSelector( <i class="conum" data-value="5"></i><b>(5)</b>
  getFeature,
  state =&gt; state.watchlistData
);

export const getAllItems = createSelector( <i class="conum" data-value="6"></i><b>(6)</b>
  getWatchlistData,
  fromWatchlistData.getAllItems
);</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The feature state, each member is managed by a different reducer</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Feature states are registered by the <code>forFeature</code> method. This interface provides a typesafe path from root to feature state.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Tie substates of a feature state to the corresponding reducers</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Create a selector to access the 'watchlist' feature state</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>select the watchlistData sub state</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>re-export the selector</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Note how <code>createSelector</code> allows to chain selectors. This is a powerful tool that also allows for selecting from multiple states.</p>
</div>
<div class="paragraph">
<p>You can use selectors as pipeable operators:</p>
</div>
<div class="paragraph">
<p><strong>watchlist.component.ts</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">export class WatchlistComponent {
  watchlistItems$: Observable&lt;WatchlistItem[]&gt;;

  constructor(
    private store: Store&lt;fromWatchlist.State&gt;
  ) {
    this.watchlistItems$ = this.store.pipe(select(fromWatchlist.getAllItems));
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>watchlist.component.html</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">&lt;h1&gt;Watchlist&lt;/h1&gt;
&lt;ul&gt;
    &lt;li *ngFor="let item of watchlistItems$ | async"&gt;{{item.movie.title}} ({{item.movie.releaseYear}}): {{item.playbackMinutes}}/{{item.movie.runtimeMinutes}} min watched&lt;/li&gt;
&lt;/ul&gt;</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="guide-ngrx-simple-store.asciidoc_dispatching-an-action-to-update-watched-minutes">Dispatching an action to update watched minutes</h5>
<div class="paragraph">
<p>We track the user&#8217;s current progress at watching a movie as the <code>playbackMinutes</code> property. After closing a video, the watched minutes have to be updated. In NgRx, state is being updated by dispatching actions. An action is an option with a (globally unique) type discriminator and an optional payload.</p>
</div>
<div class="sect5">
<h6 id="guide-ngrx-simple-store.asciidoc_creating-the-action">Creating the action</h6>
<div class="paragraph">
<p>Create a file <code>playback/actions/index.ts</code>. In this example, we do not further separate the actions per sub state. Actions can be defined by using action creators:</p>
</div>
<div class="paragraph">
<p><strong>playback/actions/index.ts</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">import { createAction, props, union } from '@ngrx/store';

export const playbackFinished = createAction('[Playback] Playback finished', props&lt;{ movieId: number, stoppedAtMinute: number }&gt;());

const actions = union({
    playbackFinished
});

export type ActionsUnion = typeof actions;</code></pre>
</div>
</div>
<div class="paragraph">
<p>First we specify the type, followed by a call to the payload definition function. Next, we create a union of all possible actions for this file using <code>union</code>, which allows us a to access action payloads in the reducer in a typesafe way.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Action types should follow the naming convention <code>[Source] Event</code>, e.g. <code>[Recommended List] Hide Recommendation</code> or <code>[Auth API] Login Success</code>. Think of actions rather as events than commands. You should never use the same action at two different places (you can still handle multiple actions the same way). This faciliates tracing the source of an action. For details see <a href="https://www.youtube.com/watch?v=JmnsEvoy-gY">Good Action Hygiene with NgRx</a> by Mike Ryan (video).</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect5">
<h6 id="guide-ngrx-simple-store.asciidoc_dispatch">Dispatch</h6>
<div class="paragraph">
<p>We skip the implementation of an actual video playback page and simulate wathcing a movie in 10 minute segments by adding a link in the template:</p>
</div>
<div class="paragraph">
<p><strong>watchlist-component.html</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">&lt;li *ngFor="let item of watchlistItems$ | async"&gt;... &lt;button (click)="stoppedPlayback(item.movie.id, item.playbackMinutes + 10)"&gt;Add 10 Minutes&lt;/button&gt;&lt;/li&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>watchlist-component.ts</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">import * as playbackActions from 'src/app/playback/actions';
...
  stoppedPlayback(movieId: number, stoppedAtMinute: number) {
    this.store.dispatch(playbackActions.playbackFinished({ movieId, stoppedAtMinute }));
  }</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="guide-ngrx-simple-store.asciidoc_state-reduction">State reduction</h6>
<div class="paragraph">
<p>Next, we handle the action inside the watchlistData reducer. Note that actions can be handled by multiple reducers and effects at the same time to update different states, for example if we&#8217;d like to show a rating modal after playback has finished.</p>
</div>
<div class="paragraph">
<p><strong>watchlist-data.reducer.ts</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">export function reducer(state = initialState, action: playbackActions.ActionsUnion): State {
  switch (action.type) {
    case playbackActions.playbackFinished.type:
      return {
        ...state,
        items: state.items.map(updatePlaybackMinutesMapper(action.movieId, action.stoppedAtMinute))
      };

    default:
      return state;
  }
}

export function updatePlaybackMinutesMapper(movieId: number, stoppedAtMinute: number) {
  return (item: WatchlistItem) =&gt; {
    if (item.movie.id === movieId) {
      return {
        ...item,
        playbackMinutes: stoppedAtMinute
      };
    } else {
      return item;
    }
  };
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note how we changed the reducer&#8217;s function signature to reference the actions union. The switch-case handles all incoming actions to produce the next state. The default case handles all actions a reducer is not interested in by returning the state unchanged. Then we find the watchlist item corresponding to the movie with the given id and update the playback minutes. Since state is immutable, we have to clone all objects down to the one we would like to change using the object spread operator (<code>&#8230;&#8203;</code>).</p>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Selectors rely on object identity to decide whether the value has to be recalculated. Do not clone objects that are not on the path to the change you want to make. This is why <code>updatePlaybackMinutesMapper</code> returns the same item if the movie id does not match.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect5">
<h6 id="guide-ngrx-simple-store.asciidoc_alternative-state-mapping-with-immer">Alternative state mapping with immer</h6>
<div class="paragraph">
<p>It can be hard to think in immutable changes, especially if your team has a strong background in imperative programming. In this case, you may find the <a href="https://github.com/immerjs/immer">immer</a> library convenient, which allows to produce immutable objects by manipulating a proxied draft. The same reducer can then be written as:</p>
</div>
<div class="paragraph">
<p><strong>watchlist-data.reducer.ts</strong> with immer</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">import { produce } from 'immer';
...
case playbackActions.playbackFinished.type:
      return produce(state, draft =&gt; {
        const itemToUpdate = draft.items.find(item =&gt; item.movie.id === action.movieId);
        if (itemToUpdate) {
          itemToUpdate.playbackMinutes = action.stoppedAtMinute;
        }
      });</code></pre>
</div>
</div>
<div class="paragraph">
<p>Immer works out of the box with plain objects and arrays.</p>
</div>
</div>
<div class="sect5">
<h6 id="guide-ngrx-simple-store.asciidoc_redux-devtools">Redux devtools</h6>
<div class="paragraph">
<p>If the <code>StoreDevToolsModule</code> is instrumented as described above, you can use the browser extension <a href="https://github.com/reduxjs/redux-devtools">Redux devtools</a> to see all dispatched actions and the resulting state diff, as well as the current state, and even travel back in time by undoing actions.</p>
</div>
<div class="imageblock text-center">
<div class="content">
<a class="image" href="images/ngrx-devtools.png"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/ngrx-devtools.png" alt="Redux Devtools"></a>
</div>
<div class="title">Figure 65. Redux devtools</div>
</div>
<div class="paragraph">
<p>Continue with <a href="#guide-ngrx-effects.asciidoc">learning about effects</a></p>
</div>
<!-- toc disabled -->
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="guide-ngrx-effects.asciidoc">21.3. Side effects with NgRx/Effects</h3>
<div class="paragraph">
<p>Reducers are pure functions, meaning they are side-effect free and deterministic. Many actions however have side effects like sending messages or displaying a toast notification. NgRx encapsulates these actions in effects.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s build a recommended movies list so the user can add movies to their watchlist.</p>
</div>
<div class="sect3">
<h4 id="guide-ngrx-effects.asciidoc_obtaining-the-recommendation-list-from-the-server">21.3.1. Obtaining the recommendation list from the server</h4>
<div class="paragraph">
<p>Create a module for recommendations and add stores and states as in the previous chapter. Add <code>EffectsModule.forRoot([])</code> to the imports in <code>AppModule</code> below <code>StoreModule.forRoot()</code>. Add effects to the feature module:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>ng generate effect recommendation/Recommendation -m recommendation/recommendation.module.ts</pre>
</div>
</div>
<div class="paragraph">
<p>We need actions for loading the movie list, success and failure cases:</p>
</div>
<div class="paragraph">
<p><strong>recommendation/actions/index.ts</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">import { createAction, props, union } from '@ngrx/store';
import { Movie } from 'src/app/watchlist/models/movies';

export const loadRecommendedMovies = createAction('[Recommendation List] Load movies');
export const loadRecommendedMoviesSuccess = createAction('[Recommendation API] Load movies success', props&lt;{movies: Movie[]}&gt;());
export const loadRecommendedMoviesFailure = createAction('[Recommendation API] Load movies failure', props&lt;{error: any}&gt;());

const actions = union({
    loadRecommendedMovies,
    loadRecommendedMoviesSuccess,
    loadRecommendedMoviesFailure
});

export type ActionsUnion = typeof actions;</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the reducer, we use a loading flag so the UI can show a loading spinner. The store is updated with arriving data.</p>
</div>
<div class="paragraph">
<p><strong>recommendation/actions/index.ts</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">export interface State {
  items: Movie[];
  loading: boolean;
}

export const initialState: State = {
  items: [],
  loading: false
};

export function reducer(state = initialState, action: recommendationActions.ActionsUnion): State {
  switch (action.type) {
    case '[Recommendation List] Load movies':
      return {
        ...state,
        items: [],
        loading: true
      };

    case '[Recommendation API] Load movies failure':
      return {
        ...state,
          loading: false
      };

    case '[Recommendation API] Load movies success':
      return {
        ...state,
        items: action.movies,
        loading: false
      };

    default:
      return state;
  }
}

export const getAll = (state: State) =&gt; state.items;
export const isLoading = (state: State) =&gt; state.loading;</code></pre>
</div>
</div>
<div class="paragraph">
<p>We need an API service to talk to the server. For demonstration purposes, we simulate an answer delayed by one second:</p>
</div>
<div class="paragraph">
<p><strong>recommendation/services/recommendation-api.service.ts</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">@Injectable({
  providedIn: 'root'
})
export class RecommendationApiService {

  private readonly recommendedMovies: Movie[] = [
    {
      id: 2,
      title: 'The Hunger Games',
      genre: 'sci-fi',
      releaseYear: 2012,
      runtimeMinutes: 144
    },
    {
      id: 4,
      title: 'Avengers: Endgame',
      genre: 'fantasy',
      releaseYear: 2019,
      runtimeMinutes: 181
    }
  ];

  loadRecommendedMovies(): Observable&lt;Movie[]&gt; {
    return of(this.recommendedMovies).pipe(delay(1000));
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here are the effects:</p>
</div>
<div class="paragraph">
<p><strong>recommendation/services/recommendation-api.service.ts</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">@Injectable()
export class RecommendationEffects {

  constructor(
    private actions$: Actions,
    private recommendationApi: RecommendationApiService,
  ) { }

  @Effect()
  loadBooks$ = this.actions$.pipe(
    ofType(recommendationActions.loadRecommendedMovies.type),
    switchMap(() =&gt; this.recommendationApi.loadRecommendedMovies().pipe(
      map(movies =&gt; recommendationActions.loadRecommendedMoviesSuccess({ movies })),
      catchError(error =&gt; of(recommendationActions.loadRecommendedMoviesFailure({ error })))
    ))
  );
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Effects are always observables and return actions. In this example, we consume the actions observable provided by NgRx and listen only for the <code>loadRecommendedMovies</code> actions by using the <code>ofType</code> operator. Using <code>switchMap</code>, we map to a new observable, one that loads movies and maps the successful result to a new <code>loadRecommendedMoviesSuccess</code> action or a failure to <code>loadRecommendedMoviesFailure</code>. In a real application we would show a notification in the error case.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If an effect should not dispatch another action, return an empty observable.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><a href="#guide-ngrx-entity.asciidoc">Continue reading how to simplify CRUD (Create Read Update Delete) operations using @ngrx/entity</a>.</p>
</div>
<!-- toc disabled -->
</div>
</div>
<div class="sect2">
<h3 id="guide-ngrx-entity.asciidoc">21.4. Simplifying CRUD with NgRx/Entity</h3>
<div class="paragraph">
<p>Most of the time when manipulating entries in the store, we like to create, add, update, or delete entries (CRUD). NgRx/Entity provides convenience functions if each item of a collection has an id property. Luckily all our entities already have this property.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s add functionality to add a movie to the watchlist. First, create the required action:</p>
</div>
<div class="paragraph">
<p><strong>recommendation/actions/index.ts</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">export const addToWatchlist = createAction('[Recommendation List] Add to watchlist',
    props&lt;{ watchlistItemId: number, movie: Movie, addedAt: Date }&gt;());</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>You may wonder why the Date object is not created inside the reducer instead, since it should always be the current time. However, remember that reducers should be deterministic state machines&#8201;&#8212;&#8201;State A + Action B should always result in the same State C. This makes reducers easily testable.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Then, rewrite the watchlistData reducer to make use of NgRx/Entity:</p>
</div>
<div class="paragraph">
<p><strong>recommendation/actions/index.ts</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">export interface State extends EntityState&lt;WatchlistItem&gt; { <i class="conum" data-value="1"></i><b>(1)</b>
}

export const entityAdapter = createEntityAdapter&lt;WatchlistItem&gt;(); <i class="conum" data-value="2"></i><b>(2)</b>

export const initialState: State = entityAdapter.getInitialState(); <i class="conum" data-value="3"></i><b>(3)</b>

const entitySelectors = entityAdapter.getSelectors();

export function reducer(state = initialState, action: playbackActions.ActionsUnion | recommendationActions.ActionsUnion): State {
  switch (action.type) {
    case playbackActions.playbackFinished.type:
      const itemToUpdate = entitySelectors
      .selectAll(state) <i class="conum" data-value="4"></i><b>(4)</b>
      .find(item =&gt; item.movie.id === action.movieId);
      if (itemToUpdate) {
        return entityAdapter.updateOne({ <i class="conum" data-value="5"></i><b>(5)</b>
          id: itemToUpdate.id,
          changes: { playbackMinutes: action.stoppedAtMinute } <i class="conum" data-value="6"></i><b>(6)</b>
        }, state);
      } else {
        return state;
      }

    case recommendationActions.addToWatchlist.type:
      return entityAdapter.addOne({id: action.watchlistItemId, movie: action.movie, added: action.addedAt, playbackMinutes: 0}, state);

    default:
      return state;
  }
}


export const getAllItems = entitySelectors.selectAll;</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>NgRx/Entity requires state to extend EntityState. It provides a list of ids and a dictionary of id &#8658; entity entries</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The entity adapter provides data manipulation operations and selectors</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The state can be initialized with <code>getInitialState()</code>, which accepts an optional object to define any additional state beyond EntityState</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td><code>selectAll</code> returns an array of all entities</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>All adapter operations consume the state object as the last argument and produce a new state</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Update methods accept a partial change definition; you don&#8217;t have to clone the object</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>This concludes the tutorial on NgRx. If you want to learn about advanced topics such as selectors with arguments, testing, or router state, head over to the <a href="https://ngrx.io/docs">official NgRx documentation</a>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="master-devon4ng.asciidoc_cookbook">22. Cookbook</h2>
<div class="sectionbody">
<!-- toc disabled -->
<div class="sect2">
<h3 id="cookbook-abstract-class-store.asciidoc">22.1. Abstract Class Store</h3>
<div class="paragraph">
<p>The following solution presents a base class for implementing stores which handle state and its transitions.
Working with the base class achieves:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>common API across all stores</p>
</li>
<li>
<p>logging (when activated in the constructor)</p>
</li>
<li>
<p>state transitions are asynchronous by design - sequential order problems are avoided</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Listing 81. Usage Example</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-ts hljs" data-lang="ts">@Injectable()
export class ModalStore extends Store&lt;ModalState&gt; {

  constructor() {
    super({ isOpen: false }, !environment.production);
  }

  closeDialog() {
    this.dispatchAction('Close Dialog', (currentState) =&gt; ({...currentState, isOpen: false}));
  }

  openDialog() {
    this.dispatchAction('Open Dialog', (currentState) =&gt; ({...currentState, isOpen: true}));
  }

}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Listing 82. Abstract Base Class Store</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-ts hljs" data-lang="ts">import { OnDestroy } from '@angular/core';
import { BehaviorSubject } from 'rxjs/BehaviorSubject';
import { Observable } from 'rxjs/Observable';
import { intersection, difference } from 'lodash';
import { map, distinctUntilChanged, observeOn } from 'rxjs/operators';
import { Subject } from 'rxjs/Subject';
import { queue } from 'rxjs/scheduler/queue';
import { Subscription } from 'rxjs/Subscription';

interface Action&lt;T&gt; {
  name: string;
  actionFn: (state: T) =&gt; T;
}

/** Base class for implementing stores. */
export abstract class Store&lt;T&gt; implements OnDestroy {

  private actionSubscription: Subscription;
  private actionSource: Subject&lt;Action&lt;T&gt;&gt;;
  private stateSource: BehaviorSubject&lt;T&gt;;
  state$: Observable&lt;T&gt;;

  /**
   * Initializes a store with initial state and logging.
   * @param initialState Initial state
   * @param logChanges When true state transitions are logged to the console.
   */
  constructor(initialState: T, public logChanges = false) {
    this.stateSource = new BehaviorSubject&lt;T&gt;(initialState);
    this.state$ = this.stateSource.asObservable();
    this.actionSource = new Subject&lt;Action&lt;T&gt;&gt;();

    this.actionSubscription = this.actionSource.pipe(observeOn(queue)).subscribe(action =&gt; {
      const currentState = this.stateSource.getValue();
      const nextState = action.actionFn(currentState);

      if (this.logChanges) {
        this.log(action.name, currentState, nextState);
      }

      this.stateSource.next(nextState);
    });
  }

  /**
   * Selects a property from the stores state.
   * Will do distinctUntilChanged() and map() with the given selector.
   * @param selector Selector function which selects the needed property from the state.
   * @returns Observable of return type from selector function.
   */
  select&lt;TX&gt;(selector: (state: T) =&gt; TX): Observable&lt;TX&gt; {
    return this.state$.pipe(
      map(selector),
      distinctUntilChanged()
    );
  }

  protected dispatchAction(name: string, action: (state: T) =&gt; T) {
    this.actionSource.next({ name, actionFn: action });
  }

  private log(actionName: string, before: T, after: T) {
    const result: { [key: string]: { from: any, to: any} } = {};
    const sameProbs = intersection(Object.keys(after), Object.keys(before));
    const newProbs = difference(Object.keys(after), Object.keys(before));
    for (const prop of newProbs) {
      result[prop] = { from: undefined, to: (&lt;any&gt;after)[prop] };
    }

    for (const prop of sameProbs) {
      if ((&lt;any&gt;before)[prop] !== (&lt;any&gt;after)[prop]) {
        result[prop] = { from: (&lt;any&gt;before)[prop], to: (&lt;any&gt;after)[prop] };
      }
    }

    console.log(this.constructor.name, actionName, result);
  }

  ngOnDestroy() {
    this.actionSubscription.unsubscribe();
  }

}</code></pre>
</div>
</div>
<!-- toc disabled -->
</div>
<div class="sect2">
<h3 id="guide-add-electron.asciidoc">22.2. Angular Electron</h3>
<div class="sect3">
<h4 id="guide-add-electron.asciidoc_add-electron-to-an-angular-application">22.2.1. Add Electron to an Angular application</h4>
<div class="paragraph">
<p>This cookbook recipe explains how to integrate Electron in an Angular 6+ application. <a href="https://electronjs.org/">Electron</a> is a framework for creating native applications with web technologies like JavaScript, HTML, and CSS. As an example, very well known applications as Visual Studio Code, Atom, Slack or Skype (and many more) are using Electron too.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
At the moment of this writing Angular 7.2.3 and Electron 4.0.2 were the versions available.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Here are the steps to achieve this goal. Follow them in order.</p>
</div>
<div class="sect4">
<h5 id="guide-add-electron.asciidoc_add-electron-and-other-relevant-dependencies">Add Electron and other relevant dependencies</h5>
<div class="paragraph">
<p>There are two different approaches to add the dependencies in the <code>package.json</code> file:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Writing the dependencies directly in that file.</p>
</li>
<li>
<p>Installing using <code>npm install</code> or <code>yarn add</code>.</p>
</li>
</ul>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Please remember if the project has a <code>package-lock.json</code> or <code>yarn.lock</code> file use <code>npm</code> or <code>yarn</code> respectively.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In order to add the dependencies directly in the <code>package.json</code> file, include the following lines in the <code>devDependencies</code> section:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">"devDependencies": {
...
    "electron": "^4.0.2",
    "electron-builder": "^20.38.5",
    "electron-reload": "^1.4.0",
    "npm-run-all": "^4.1.5",
    "npx": "^10.2.0",
    "wait-on": "^3.2.0",
    "webdriver-manager": "^12.1.1"
...
},</code></pre>
</div>
</div>
<div class="paragraph">
<p>As indicated above, instead of this <code>npm install</code> can be used:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ npm install -D electron electron-builder electron-reload npm-run-all npx wait-on webdriver-manager</code></pre>
</div>
</div>
<div class="paragraph">
<p>Or with <code>yarn</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ yarn add -D electron electron-builder electron-reload npm-run-all npx wait-on webdriver-manager</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="guide-add-electron.asciidoc_add-electron-build-configuration">Add Electron build configuration</h5>
<div class="paragraph">
<p>In order to configure electron builds properly a <code>electron-builder.json</code> must be included in the root folder of the application. For more information and fine tuning please refer to the <a href="https://www.electron.build/configuration/configuration">Electron Builder official documentation</a>.</p>
</div>
<div class="paragraph">
<p>The contents of the file will be something similar to the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "productName": "app-name",
  "directories": {
    "output": "release/"
  },
  "files": [
    "**/*",
    "!**/*.ts",
    "!*.code-workspace",
    "!LICENSE.md",
    "!package.json",
    "!package-lock.json",
    "!src/",
    "!e2e/",
    "!hooks/",
    "!angular.json",
    "!_config.yml",
    "!karma.conf.js",
    "!tsconfig.json",
    "!tslint.json"
  ],
  "win": {
    "icon": "dist/assets/icons",
    "target": ["portable"]
  },
  "mac": {
    "icon": "dist/assets/icons",
    "target": ["dmg"]
  },
  "linux": {
    "icon": "dist/assets/icons",
    "target": ["AppImage"]
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Theres two important things in this file:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>"output": this is where electron builder is going to build our application</p>
</li>
<li>
<p>"icon": in every OS possible theres an icon parameter, the route to the icon folder that will be created after building with angular needs to be used here. This will make it so the electron builder can find the icons and build.</p>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="guide-add-electron.asciidoc_create-the-necessary-typescript-configurations">Create the necessary typescript configurations</h5>
<div class="paragraph">
<p>In order to initiate electron in an angular app we need to modify the <code>tsconfig.json</code> file and create a new one named <code>tsconfig-serve.json</code> in the root folder.</p>
</div>
<div class="sect5">
<h6 id="guide-add-electron.asciidoc_tsconfig.json">tsconfig.json</h6>
<div class="paragraph">
<p>This file needs to be modified to add the <code>main.ts</code> and <code>src/**/*</code> folders excluding the <code>node_modules</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
....
  },
  "include": [
    "main.ts",
    "src/**/*"
  ],
  "exclude": [
    "node_modules"
  ]
....
}</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="guide-add-electron.asciidoc_tsconfig-serve.json">tsconfig-serve.json</h6>
<div class="paragraph">
<p>In the root, <code>tsconfig-serve.json</code> needs to be created. This typescript config file is going to be used when we serve electron:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "compilerOptions": {
    "sourceMap": true,
    "declaration": false,
    "moduleResolution": "node",
    "emitDecoratorMetadata": true,
    "experimentalDecorators": true,
    "target": "es5",
    "typeRoots": [
      "node_modules/@types"
    ],
    "lib": [
      "es2017",
      "es2016",
      "es2015",
      "dom"
    ]
  },
  "include": [
    "main.ts"
  ],
  "exclude": [
    "node_modules",
    "**/*.spec.ts"
  ]
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="guide-add-electron.asciidoc_modify-angular.json">Modify angular.json</h5>
<div class="paragraph">
<p><code>angular.json</code> has to to be modified so the project is build inside <em>/dist</em> without an intermediate folder.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-TypeScript hljs" data-lang="TypeScript">{
....
  "architect": {
    ....
    "build": {
      outputPath": "dist",
      ....
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="guide-add-electron.asciidoc_add-angular-electron-directives">Add Angular Electron directives</h5>
<div class="paragraph">
<p>In order to use Electron&#8217;s webview tag and its methods inside an Angular application our project needs the directive <code>webview.directive.ts</code> file. We recommend to create this file inside a <strong>shared</strong> module folder, although it has to be declared inside the main module <code>app.module.ts</code>.</p>
</div>
<div class="listingblock">
<div class="title">Listing 83. File webview.directive.ts</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-TypeScript hljs" data-lang="TypeScript">import { Directive } from '@angular/core';

@Directive({
  selector: '[webview]',
})
export class WebviewDirective {}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="guide-add-electron.asciidoc_add-access-electron-apis">Add access Electron APIs</h5>
<div class="paragraph">
<p>To call Electron APIs from the Renderer process, install ngx-electron module.</p>
</div>
<div class="paragraph">
<p>With <code>npm</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ npm install ngx-electron --save</code></pre>
</div>
</div>
<div class="paragraph">
<p>Or with <code>yarn</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ yarn add ngx-electron --save</code></pre>
</div>
</div>
<div class="paragraph">
<p>This package contains a module named <strong>NgxElectronModule</strong> which exposes Electron APIs through a service called <strong>ElectronService</strong></p>
</div>
<div class="sect5">
<h6 id="guide-add-electron.asciidoc_update-app.module.ts-and-app-routing.module.ts">Update <code>app.module.ts</code> and <code>app-routing.module.ts</code></h6>
<div class="paragraph">
<p>As an example, the <code>webview.directive.ts</code> file is located inside a <code>shared</code> module:</p>
</div>
<div class="listingblock">
<div class="title">Listing 84. File app.module.ts</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-TypeScript hljs" data-lang="TypeScript">// imports
import { NgxElectronModule } from 'ngx-electron';
import { WebviewDirective } from './shared/directives/webview.directive';

@NgModule({
  declarations: [AppComponent, WebviewDirective],
  imports: [
    ...
    NgxElectronModule
    ...
    ],
  providers: [],
  bootstrap: [AppComponent],
})
export class AppModule {}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here NgxElectronModule is also added so ElectronService can be injected wherever is needed.</p>
</div>
<div class="paragraph">
<p>After that is done, the use of hash has to be allowed so electron can reload content properly. On the <code>app-routing.module.ts</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-TypeScript hljs" data-lang="TypeScript">....
  imports: [RouterModule.forRoot(routes,
    {
      ....
      useHash: true,
    },
  )],</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="guide-add-electron.asciidoc_usage">Usage</h6>
<div class="paragraph">
<p>In order to use Electron in any component class the ElectronService must be injected:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-TypeScript hljs" data-lang="TypeScript">import { ElectronService } from 'ngx-electron';

...

constructor(
  // other injected services
  public electronService: ElectronService,
) {
  // previous code...

  if (electronService.isElectronApp) {
    // Do electron stuff
  } else {
    // Do other web stuff
  }

}</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
A list of all accesible APIs can be found at <a href="https://github.com/ThorstenHans/ngx-electron">Thorsten Hans' ngx-electron repository</a>.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect4">
<h5 id="guide-add-electron.asciidoc_create-the-electron-window-in-main.ts">Create the electron window in <code>main.ts</code></h5>
<div class="paragraph">
<p>In order to use electron, a file needs to be created at the root of the application (<code>main.ts</code>). This file will create a window with different settings checking if we are using <code>--serve</code> as an argument:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">import { app, BrowserWindow, screen } from 'electron';
import * as path from 'path';
import * as url from 'url';

let win: any;
let serve: any;
const args: any = process.argv.slice(1);
serve = args.some((val) =&gt; val === '--serve');

 function createWindow(): void {
  const electronScreen: any = screen;
  const size: any = electronScreen.getPrimaryDisplay().workAreaSize;

   // Create the browser window.
  win = new BrowserWindow({
    x: 0,
    y: 0,
    width: size.width,
    height: size.height,

    // Needed if you are using service workers
    webPreferences: {
      nodeIntegration: true,
      nodeIntegrationInWorker: true,
    }
  });

   if (serve) {
    // tslint:disable-next-line:no-require-imports
    require('electron-reload')(__dirname, {
      electron: require(`${__dirname}/node_modules/electron`),
    });
    win.loadURL('http://localhost:4200');
  } else {
    win.loadURL(
      url.format({
        pathname: path.join(__dirname, 'dist/index.html'),
        protocol: 'file',
        slashes: true,
      }),
    );
  }

   // Uncoment the following line if you want to open the DevTools by default
  // win.webContents.openDevTools();

   // Emitted when the window is closed.
  win.on('closed', () =&gt; {
    // Dereference the window object, usually you would store window
    // in an array if your app supports multi windows, this is the time
    // when you should delete the corresponding element.
    // tslint:disable-next-line:no-null-keyword
    win = null;
  });
}

 try {
  // This method will be called when Electron has finished
  // initialization and is ready to create browser windows.
  // Some APIs can only be used after this event occurs.
  app.on('ready', createWindow);

   // Quit when all windows are closed.
  app.on('window-all-closed', () =&gt; {
    // On OS X it is common for applications and their menu bar
    // to stay active until the user quits explicitly with Cmd + Q
    if (process.platform !== 'darwin') {
      app.quit();
    }
  });

   app.on('activate', () =&gt; {
    // On OS X it's common to re-create a window in the app when the
    // dock icon is clicked and there are no other windows open.
    if (win === null) {
      createWindow();
    }
  });
} catch (e) {
  // Catch Error
  // throw e;
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="guide-add-electron.asciidoc_add-the-electron-window-and-improve-the-package.json-scripts">Add the electron window and improve the <code>package.json</code> scripts</h5>
<div class="paragraph">
<p>Inside <code>package.json</code> the electron window that will be transformed to <code>main.js</code> when building needs to be added.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  ....
  "main": "main.js",
  "scripts": {
  ....
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>scripts</code> section in the <code>package.json</code> can be improved to avoid running too verbose commands. As a very complete example we can take a look to the My Thai Star&#8217;s <code>scripts</code> section and copy the lines useful in your project.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">  "scripts": {
    "postinstall": "npx electron-builder install-app-deps",
    ".": "sh .angular-gui/.runner.sh",
    "ng": "ng",
    "start": "ng serve --proxy-config proxy.conf.json -o",
    "start:electron": "npm-run-all -p serve electron:serve",
    "compodoc": "compodoc -p src/tsconfig.app.json -s",
    "test": "ng test --browsers Chrome",
    "test:ci": "ng test --browsers ChromeHeadless --watch=false",
    "test:firefox": "ng test --browsers Firefox",
    "test:ci:firefox": "ng test --browsers FirefoxHeadless --watch=false",
    "test:firefox-dev": "ng test --browsers FirefoxDeveloper",
    "test:ci:firefox-dev": "ng test --browsers FirefoxDeveloperHeadless --watch=false",
    "test:electron": "ng test",
    "lint": "ng lint",
    "e2e": "ng e2e",
    "ngsw-config": "npx ngsw-config dist ngsw-config.json",
    "ngsw-copy": "cp node_modules/@angular/service-worker/ngsw-worker.js dist/",
    "serve": "ng serve",
    "serve:open": "npm run start",
    "serve:pwa": "npm run build:pwa &amp;&amp; http-server dist -p 8080",
    "serve:prod": "ng serve --open --prod",
    "serve:prodcompose": "ng serve --open --configuration=prodcompose",
    "serve:node": "ng serve --open --configuration=node",
    "build": "ng build",
    "build:pwa": "ng build --configuration=pwa --prod --build-optimizer &amp;&amp; npm run ngsw-config &amp;&amp; npm run ngsw-copy",
    "build:prod": "ng build --prod --build-optimizer",
    "build:prodcompose": "ng build --configuration=prodcompose ",
    "build:electron": "npm run electron:serve-tsc &amp;&amp; ng build --base-href ./",
    "build:electron:dev": "npm run build:electron -- -c dev",
    "build:electron:prod": "npm run build:electron -- -c production",
    "electron:start": "npm-run-all -p serve electron:serve",
    "electron:serve-tsc": "tsc -p tsconfig-serve.json",
    "electron:serve": "wait-on http-get://localhost:4200/ &amp;&amp; npm run electron:serve-tsc &amp;&amp; electron . --serve",
    "electron:local": "npm run build:electron:prod &amp;&amp; electron .",
    "electron:linux": "npm run build:electron:prod &amp;&amp; npx electron-builder build --linux",
    "electron:windows": "npm run build:electron:prod &amp;&amp; npx electron-builder build --windows",
    "electron:mac": "npm run build:electron:prod &amp;&amp; npx electron-builder build --mac"
  },</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here the important thing to look out for is that the base href when building electron can be changed as needed. In our case:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">    "build:electron": "npm run postinstall:electron &amp;&amp; npm run electron:serve-tsc &amp;&amp; ng build --base-href \"\" ",</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Some of these lines are intended to be shortcuts used in other scripts. Do not hesitate to modify them depending on your needs.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Some usage examples:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ npm run electron:start                # Serve Angular app and run it inside electron
$ npm run electron:local                # Serve Angular app for production and run it inside electron
$ npm run electron:windows              # Build Angular app for production and package it for Windows OS</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ yarn run electron:start                # Serve Angular app and run it inside electron
$ yarn run electron:local                # Serve Angular app for production and run it inside electron
$ yarn run electron:windows              # Build Angular app for production and package it for Windows OS</code></pre>
</div>
</div>
<!-- toc disabled -->
</div>
</div>
</div>
<div class="sect2">
<h3 id="guide-angular-mock-service.asciidoc">22.3. Angular Mock Service</h3>
<div class="paragraph">
<p>We&#8217;ve all been there: A new idea comes, let&#8217;s quickly prototype it. But wait, there&#8217;s no backend. What can we do?</p>
</div>
<div class="paragraph">
<p>Below you will find o solution that will get your started quick and easy. The idea is to write a simple mock service that helps us by feeding data into our components.</p>
</div>
<div class="sect3">
<h4 id="guide-angular-mock-service.asciidoc_the-app-we-start-with">22.3.1. The app we start with</h4>
<div class="paragraph">
<p>Let&#8217;s say you have a simple boilerplate code, with your favorite styling library hooked up and you&#8217;re ready to go. The <a href="https://github.com/devonfw/devon4ng/tree/develop/samples/AngularMaterialBasicLayout">Angular Material</a> sample is a good starting place.</p>
</div>
</div>
<div class="sect3">
<h4 id="guide-angular-mock-service.asciidoc_the-components">22.3.2. The Components</h4>
<div class="paragraph">
<p>Components - are the building blocks of our application. Their main role is to enable fragments of user interfaces. They will either display data (a list, a table, a chart, etc.), or 'collect' user interaction (e.g: a form, a menu, etc.)</p>
</div>
<div class="paragraph">
<p>Components stay at the forefront of the application. They should also be reusable (as much as possible). Reusability is key for what we are trying to achieve - a stable, maintainable frontend where multiple people can contribute and collaborate.</p>
</div>
<div class="paragraph">
<p>In our project, we are at the beginning. That means we may have more ideas than plans. We are exploring possibilites. In order to code eficiently:<br>
1) We will not store mock data in the components.<br>
2) We will not fetch or save data directly in the components.</p>
</div>
<div class="paragraph">
<p><a href="https://github.com/devonfw/devon4ng/wiki/components-layer">Learn more about Angular Components</a></p>
</div>
</div>
<div class="sect3">
<h4 id="guide-angular-mock-service.asciidoc_the-service">22.3.3. The Service</h4>
<div class="paragraph">
<p>So, how do we get data in our app? How do we propagate the data to the components and how can we send user interaction from the components to the our data "manager" logic.</p>
</div>
<div class="paragraph">
<p>The answer to all these questions is an Angular Service (that we will just call a service from now on).</p>
</div>
<div class="paragraph">
<p>A service is an injectable logic that can be consumed by all the components that need it. It can carry manipulation functions and ,in our case, fetch data from a provider.</p>
</div>
<div id="guide-angular-mock-service.asciidoc_id_service_architecture" class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/architecture.png" alt="Service Architecture" width="600 link="images/architecture.png"">
</div>
<div class="title">Figure 66. Angular Components &amp; Services architecture.</div>
</div>
<div class="paragraph">
<p>Inside the Angular App, an Injector gives access to each component to their required services. It&#8217;s good coding practice to use a distinct service to each data type you want to manipulate. The type is described in a interface.</p>
</div>
<div class="paragraph">
<p>Still, our ideas drive in diferent ways, so we have to stay flexible. We cannot use a database at the moment, but we want a way to represent data on screen, which can grow organically.</p>
</div>
<div class="paragraph">
<p><a href="https://github.com/devonfw/devon4ng/wiki/services-layer">Learn more about Angular Services</a></p>
</div>
</div>
<div class="sect3">
<h4 id="guide-angular-mock-service.asciidoc_the-model">22.3.4. The Model</h4>
<div id="guide-angular-mock-service.asciidoc_id_data_box" class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/data-box.jpg" alt="Data Box" width="600 link="images/data-box.jpg"">
</div>
<div class="title">Figure 67. Data box in relation to services and components.</div>
</div>
<div class="paragraph">
<p>Let&#8217;s consider a 'box of data' represented in JSON. Phisicly this means a folder with some JSON/TS files in it. They are located in the <strong>app/mock</strong> folder. The example uses only one mock data file. The file is typed according to our data model.</p>
</div>
<div class="paragraph">
<p>Pro tip: separate your files based on purpose. In your source code, put the <strong>mock files</strong> in the <strong>mock folder</strong>, <strong>components</strong> in the <strong>components folder</strong>, <strong>services</strong> in the <strong>services folder</strong> and <strong>data models</strong> in the <strong>models folder</strong>.</p>
</div>
<div id="guide-angular-mock-service.asciidoc_id_project_structure" class="imageblock">
<div class="content">
<a class="image" href="images/data-box.png"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/project-structure.png" alt="Project Structure" width="auto"></a>
</div>
<div class="title">Figure 68. Project structure.</div>
</div>
<div class="paragraph">
<p>Aligned with the Angular way of development, we are implementing a model-view-controler pattern.</p>
</div>
<div class="paragraph">
<p>The <strong>model</strong> is represented by the interfaces we make. These interfaces describe the data structures we will use in our application. In this example, there is one data model, coresponding with the 'type' of data that was mocked. In the models folder you will find the .ts script file that describes chemical elements. The corresponding mock file defines a set is chemical emlements objects, in accordance to our interface definition.</p>
</div>
</div>
<div class="sect3">
<h4 id="guide-angular-mock-service.asciidoc_use-case">22.3.5. Use case</h4>
<div class="paragraph">
<p>Enough with the theory, let&#8217;s see what we have here. The app presents 3 pages as follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A leader bord with the top 3 elements</p>
</li>
<li>
<p>A data table with all the elements</p>
</li>
<li>
<p>A details page that reads a route paramenter and displays the details of the element.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>There are a lot of business cases which have these requirements:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A leader board can be understood as "the most popular items in a set", "the latest updated items", "you favorite items" etc.</p>
</li>
<li>
<p>A data table with CRUD operations is very useful (in our case we only view details or delete an item, but they illustrate two important things: the details view shows how to navigate and consume a parametric route, the delete action shows how to invoke service operations over the loaded data - this means that the component is reusable and when the data comes with and API, only the service will need it&#8217;s implementation changed)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Check out the <a href="https://github.com/devonfw/devon4ng/tree/develop/samples/AngularMockService">Angular Mock Service</a> sample from the samples folder and easily get started with fast data roundtrips between your mock data and your components.</p>
</div>
</div>
</div>
</div>
</div>
<h1 id="master-devon4net.asciidoc" class="sect0">V: devon4net</h1>
<div class="sect1">
<h2 id="master-devon4net.asciidoc_arquitecture-basics">23. Arquitecture basics</h2>
<div class="sectionbody">
<!-- toc disabled -->
<div class="sect2">
<h3 id="architecture_guide.asciidoc">23.1. <span class="navy">Introduction</span></h3>
<div class="paragraph">
<p>The <a href="http://oasp.io"><em>Open Application Standard Platform</em> (OASP)</a> provides a solution to building applications which combine best-in-class frameworks and libraries as well as industry proven practices and code conventions.
It massively speeds up development, reduces risks and helps you to deliver better results.</p>
</div>
<div class="sect3">
<h4 id="architecture_guide.asciidoc_navyoverview-onion-design">23.1.1. <span class="navy">Overview Onion Design</span></h4>
<div class="paragraph">
<p>This guide shows the overall proposed architecture in terms of separated layers making use the Onion architecture pattern. Each layers represents a logical group of components and functionality. In this guide you will learn the basics of the proposed architecture based in layers in order to develop software making use of the best practices.</p>
</div>
</div>
<div class="sect3">
<h4 id="architecture_guide.asciidoc_-navylayer-specification">23.1.2. <span class="navy">Layer specification</span></h4>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>It is important to understand the distinction between layers and tiers. <em>Layers</em> describe the logical groupings of the functionality and components in an application; whereas <em>tiers</em> describe the physical distribution of the functionality and components on separate servers, computers, networks, or remote locations. Although both layers and tiers use the same set of names (presentation, business, services, and data), remember that only tiers imply a physical separation. It is quite common to locate more than one layer on the same physical machine (the same tier). You can think of the term tier as referring to physical distribution patterns such as two-tier, three-tier, and <em>n</em>-tier.</p>
</div>
</blockquote>
<div class="attribution">
&#8212; Layered Application Guidelines<br>
<cite>MSDN Microsoft</cite>
</div>
</div>
<div class="paragraph">
<p>The proposed architecture makes use of cooperating components called layers. Each layer contains a set of components capable to develop a specific functionality.</p>
</div>
<div class="paragraph">
<p>The next figure represents the different layers:</p>
</div>
<div id="architecture_guide.asciidoc_img-t-architecture" class="imageblock">
<div class="content">
<a class="image" href="images/onion.png"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/onion.png" alt="technical architecture" width="450"></a>
</div>
<div class="title">Figure 69. High level architecture representation</div>
</div>
<div class="paragraph">
<p>The layers are separated in phisical tiers making use of interfaces. This pattern makes possible to be flexible in different kind of projects maximizing performance and deployment strategies (synchronous/asynchronous access, security, component deployment in different environments, microservices&#8230;&#8203;). Another important point is to provide automated unit testing or test-driven development (TDD) facilities.</p>
</div>
<div class="sect5">
<h6 id="architecture_guide.asciidoc_navyapplication-layer"><span class="navy">Application layer</span></h6>
<div class="paragraph">
<p>The <em>Application Layer</em> encapsulates the different .Net projects and its resource dependencies and manages the user interaction depending on the project&#8217;s nature.</p>
</div>
<div id="architecture_guide.asciidoc_img-t-architecture" class="imageblock">
<div class="content">
<a class="image" href="images/project_nature.png"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/project_nature.png" alt="technical architecture" width="850"></a>
</div>
<div class="title">Figure 70. Net application stack</div>
</div>
<div class="paragraph">
<p>The given application template integrates Swagger contract automatic generation. This provides the possibility to external applications (angular, mobile apps, external services&#8230;&#8203;) to consume the data from a well defined exposed contract.</p>
</div>
</div>
<div class="sect5">
<h6 id="architecture_guide.asciidoc_navybusiness-layer"><span class="navy">Business layer</span></h6>
<div class="paragraph">
<p>The business layer implements the core functionality of the application and encapsulates the component&#8217;s logic.
This layer provides the interface between the data transformation and the application expositure. This allow the data to be optimized and ready for different data consumers.</p>
</div>
</div>
<div class="sect5">
<h6 id="architecture_guide.asciidoc_navyservice-layer"><span class="navy">Service layer</span></h6>
<div class="paragraph">
<p>The service layer orchestrates the data obtained between the <em>Domain Layer</em> and the <em>Business Layer</em>. Also transforms the data to be used more efficently between layers.</p>
</div>
<div class="paragraph">
<p>So, if a service needs the help of another service or repository, the implemented Dependency Injection is the solution to accomplish the task.</p>
</div>
<div class="paragraph">
<p>In order to be as flexible as the implementation of <em>Repository Pattern</em> in the <em>Data Layer</em> , each service implementation inherits from EntityService class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c# hljs" data-lang="c#">    public class Service&lt;TContext&gt; : IService where TContext: DbContext</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Once more &lt;T&gt; is the mapped class which reference the entity from the database context. This abstraction allows to write services implementation with different database contexts
</td>
</tr>
</table>
</div>
</div>
<div class="sect5">
<h6 id="architecture_guide.asciidoc_navydomain-layer"><span class="navy">Domain layer</span></h6>
<div class="paragraph">
<p>The data layer provides access to data directly exposed from other systems. The main source use to be a data base system. The provided template makes use of <em>Entity Framwork</em> solution from Microsoft in order to achieve this functionality.</p>
</div>
<div class="paragraph">
<p>To make a good use of this technology, <em>Repository Pattern</em> has been implemented with the help of <em>Unit Of Work</em> pattern. Also, the use of generic types are makes this solution to be the most flexible.</p>
</div>
<div class="paragraph">
<p>Regarding to data base source, each entity is mapped as a class. Repository pattern allows to use this mapped clasess to acces the data base via Entity framework:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C# hljs" data-lang="C#"> public class UnitOfWork&lt;TContext&gt; : IUnitOfWork&lt;TContext&gt; where TContext : DbContext</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Where &lt;T&gt; is the mapped class which reference the entity from the database.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The repository and unit of work patterns are create an abstraction layer between the data access layer and the business logic layer of an application.</p>
</div>
</div>
<div class="sect5">
<h6 id="architecture_guide.asciidoc_navycross-cutting-concerns"><span class="navy">Cross-Cutting concerns</span></h6>
<div class="paragraph">
<p>Cross-cutting provides the implementation functionality that spans layers. Each functionality is implemented through components able to work stand alone. This approach provides better reusability and mantainability.</p>
</div>
<div class="paragraph">
<p>A common component set of cross cutting components include different types of functionality regarding to athentication, authorization, security, caching, configuration, logging, and communication.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="architecture_guide.asciidoc_-navycommunication-between-layers-interfaces">23.1.3. <span class="navy">Communication between Layers: Interfaces</span></h4>
<div class="paragraph">
<p>The main target of the use of interfaces is to loose coupling between layers and minimize dependencies.</p>
</div>
<div class="paragraph">
<p>Public interfaces allow to hide implementation details of the components within the layers making use of dependency inversion.</p>
</div>
<div class="paragraph">
<p>In order to make this possible, we make use of <em>Dependency Injection Pattern</em> (implementation of dependency inversion) given by default in <em>.Net Core</em>.</p>
</div>
<div class="paragraph">
<p>The provided <em>Data Layer</em> contains the abstract clases to inherite from. All new repository and service classes must inherit from them, also the must implement their own interfaces.</p>
</div>
<div id="architecture_guide.asciidoc_img-t-architecture" class="imageblock">
<div class="content">
<a class="image" href="images/laryer_arch_detail.png"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/laryer_arch_detail.png" alt="technical architecture" width="750"></a>
</div>
<div class="title">Figure 71. Architecture representation in deep</div>
</div>
</div>
<div class="sect3">
<h4 id="architecture_guide.asciidoc_navytemplates">23.1.4. <span class="navy">Templates</span></h4>
<div class="sect4">
<h5 id="architecture_guide.asciidoc_navystate-of-the-art"><span class="navy">State of the art</span></h5>
<div class="paragraph">
<p>The provided bundle contains two .Net templates (Classic .Net Framework 4.5+ and .Net Core Framework).</p>
</div>
<div class="paragraph">
<p>Both templates share the same architecture. the current version contains the next functionalities implemented:</p>
</div>
<div id="architecture_guide.asciidoc_img-t-architecture" class="imageblock">
<div class="content">
<a class="image" href="images/functionality_stack.png"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/functionality_stack.png" alt="technical architecture" width="820"></a>
</div>
<div class="title">Figure 72. Current available functionality</div>
</div>
</div>
<div class="sect4">
<h5 id="architecture_guide.asciidoc_navysoftware-stack"><span class="navy">Software stack</span></h5>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 21. Technology Stack of OASP</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>Topic</strong></th>
<th class="tableblock halign-left valign-top"><strong>Detail</strong></th>
<th class="tableblock halign-left valign-top"><strong>Implementation</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">runtime</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">language &amp; VM</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Microsoft .Net 4.6 oder .Net Core Version</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#guide-dataaccess-layer.asciidoc">persistence</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">OR-mapper</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://msdn.microsoft.com/en-us/data/ee712907.aspx">Entity Framework Core / Entity Framework 6 - Code TBD</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#guide-service-layer.asciidoc">service</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="guide-service-layer.html#rest">REST services</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://www.asp.net/web-api">Web API</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#guide-service-layer.asciidoc">service - integration to external systems - optional</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="guide-service-layer.html#soap">SOAP services</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://msdn.microsoft.com/en-us/library/dd456779(v=vs.110).aspx">WCF</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#guide-logging.asciidoc">logging</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">framework</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://github.com/serilog/serilog-extensions-logging">Serilog</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#guide-validation.asciidoc">validation</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">framework</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://www.newtonsoft.com/jsonschema/help/html/GenerateWithDataAnnotations.htm">NewtonSoft Json</a>, <a href="http://www.asp.net/mvc/overview/older-versions-1/models-data/validation-with-the-data-annotation-validators-cs">DataAnnotations</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">component management</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#guide-dependency-injection.asciidoc">dependency injection</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://unity.codeplex.com">Unity</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#guide-security.asciidoc">security</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Authentication &amp; Authorization</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://jwt.io">JWT</a> <a href="https://msdn.microsoft.com/en-us/library/fkytk30f(v=vs.110).aspx">.Net Security - Token based, local Authentication Provider</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">unit tests</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">framework</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://xunit.github.io/">xUnit</a></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="architecture_guide.asciidoc_navytarget-platforms"><span class="navy">Target platforms</span></h5>
<div class="paragraph">
<p>Thanks to the new .Net Core platform from Microsoft, the developed software can be published Windows, Linux, OS X and Android platforms.</p>
</div>
<div class="paragraph">
<p>The compete RID (Runtime Identifier) catalog is this:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Windows</p>
<div class="ulist">
<ul>
<li>
<p>Portable</p>
<div class="ulist">
<ul>
<li>
<p>win-x86</p>
</li>
<li>
<p>win-x64</p>
</li>
</ul>
</div>
</li>
<li>
<p>Windows 7 / Windows Server 2008 R2</p>
<div class="ulist">
<ul>
<li>
<p>win7-x64</p>
</li>
<li>
<p>win7-x86</p>
</li>
</ul>
</div>
</li>
<li>
<p>Windows 8 / Windows Server 2012</p>
<div class="ulist">
<ul>
<li>
<p>win8-x64</p>
</li>
<li>
<p>win8-x86</p>
</li>
<li>
<p>win8-arm</p>
</li>
</ul>
</div>
</li>
<li>
<p>Windows 8.1 / Windows Server 2012 R2</p>
<div class="ulist">
<ul>
<li>
<p>win81-x64</p>
</li>
<li>
<p>win81-x86</p>
</li>
<li>
<p>win81-arm</p>
</li>
</ul>
</div>
</li>
<li>
<p>Windows 10 / Windows Server 2016</p>
<div class="ulist">
<ul>
<li>
<p>win10-x64</p>
</li>
<li>
<p>win10-x86</p>
</li>
<li>
<p>win10-arm</p>
</li>
<li>
<p>win10-arm64</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Linux</p>
<div class="ulist">
<ul>
<li>
<p>Portable</p>
<div class="ulist">
<ul>
<li>
<p>linux-x64</p>
</li>
</ul>
</div>
</li>
<li>
<p>CentOS</p>
<div class="ulist">
<ul>
<li>
<p>centos-x64</p>
</li>
<li>
<p>centos.7-x64</p>
</li>
</ul>
</div>
</li>
<li>
<p>Debian</p>
<div class="ulist">
<ul>
<li>
<p>debian-x64</p>
</li>
<li>
<p>debian.8-x64</p>
</li>
</ul>
</div>
</li>
<li>
<p>Fedora</p>
<div class="ulist">
<ul>
<li>
<p>fedora-x64</p>
</li>
<li>
<p>fedora.24-x64</p>
</li>
<li>
<p>fedora.25-x64 (.NET Core 2.0 or later versions)</p>
</li>
<li>
<p>fedora.26-x64 (.NET Core 2.0 or later versions)</p>
</li>
</ul>
</div>
</li>
<li>
<p>Gentoo (.NET Core 2.0 or later versions)</p>
<div class="ulist">
<ul>
<li>
<p>gentoo-x64</p>
</li>
</ul>
</div>
</li>
<li>
<p>openSUSE</p>
<div class="ulist">
<ul>
<li>
<p>opensuse-x64</p>
</li>
<li>
<p>opensuse.42.1-x64</p>
</li>
</ul>
</div>
</li>
<li>
<p>Oracle Linux</p>
<div class="ulist">
<ul>
<li>
<p>ol-x64</p>
</li>
<li>
<p>ol.7-x64</p>
</li>
<li>
<p>ol.7.0-x64</p>
</li>
<li>
<p>ol.7.1-x64</p>
</li>
<li>
<p>ol.7.2-x64</p>
</li>
</ul>
</div>
</li>
<li>
<p>Red Hat Enterprise Linux</p>
<div class="ulist">
<ul>
<li>
<p>rhel-x64</p>
</li>
<li>
<p>rhel.6-x64 (.NET Core 2.0 or later versions)</p>
</li>
<li>
<p>rhel.7-x64</p>
</li>
<li>
<p>rhel.7.1-x64</p>
</li>
<li>
<p>rhel.7.2-x64</p>
</li>
<li>
<p>rhel.7.3-x64 (.NET Core 2.0 or later versions)</p>
</li>
<li>
<p>rhel.7.4-x64 (.NET Core 2.0 or later versions)</p>
</li>
</ul>
</div>
</li>
<li>
<p>Tizen (.NET Core 2.0 or later versions)</p>
<div class="ulist">
<ul>
<li>
<p>tizen</p>
</li>
</ul>
</div>
</li>
<li>
<p>Ubuntu</p>
<div class="ulist">
<ul>
<li>
<p>ubuntu-x64</p>
</li>
<li>
<p>ubuntu.14.04-x64</p>
</li>
<li>
<p>ubuntu.14.10-x64</p>
</li>
<li>
<p>ubuntu.15.04-x64</p>
</li>
<li>
<p>ubuntu.15.10-x64</p>
</li>
<li>
<p>ubuntu.16.04-x64</p>
</li>
<li>
<p>ubuntu.16.10-x64</p>
</li>
</ul>
</div>
</li>
<li>
<p>Ubuntu derivatives</p>
<div class="ulist">
<ul>
<li>
<p>linuxmint.17-x64</p>
</li>
<li>
<p>linuxmint.17.1-x64</p>
</li>
<li>
<p>linuxmint.17.2-x64</p>
</li>
<li>
<p>linuxmint.17.3-x64</p>
</li>
<li>
<p>linuxmint.18-x64</p>
</li>
<li>
<p>linuxmint.18.1-x64 (.NET Core 2.0 or later versions)</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>OS X</p>
<div class="ulist">
<ul>
<li>
<p>osx-x64 (.NET Core 2.0 or later versions)</p>
</li>
<li>
<p>osx.10.10-x64</p>
</li>
<li>
<p>osx.10.11-x64</p>
</li>
<li>
<p>osx.10.12-x64 (.NET Core 1.1 or later versions)</p>
</li>
</ul>
</div>
</li>
<li>
<p>Android</p>
<div class="ulist">
<ul>
<li>
<p>android</p>
</li>
<li>
<p>android.21</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="architecture_guide.asciidoc_navyexternal-links">23.1.5. <span class="navy">External links</span></h4>
<div class="paragraph">
<p><a href="https://docs.microsoft.com/en-us/dotnet/standard/frameworks">.Net Frameworks</a></p>
</div>
<div class="paragraph">
<p><a href="https://docs.microsoft.com/en-us/ef/">Entity Framwork documentation from Microsoft</a></p>
</div>
<div class="paragraph">
<p><a href="https://swagger.io/">Swagger API tooling</a></p>
</div>
<div class="paragraph">
<p><a href="https://docs.microsoft.com/en-us/aspnet/core/fundamentals/dependency-injection">Dependency Injection in .NET Core</a></p>
</div>
<div class="paragraph">
<p><a href="https://jwt.io">Json Web Token</a></p>
</div>
<div class="paragraph">
<p><a href="https://xunit.github.io/">Unit Testing (xUnit)</a></p>
</div>
<div class="paragraph">
<p><a href="https://docs.microsoft.com/en-us/dotnet/core/rid-catalog">Runtime IDentifier for publishing</a></p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="master-devon4net.asciidoc_coding-conventions">24. Coding conventions</h2>
<div class="sectionbody">
<!-- toc disabled -->
<div class="sect2">
<h3 id="codeconvention.asciidoc">24.1. Code conventions</h3>
<div class="sect3">
<h4 id="codeconvention.asciidoc_navyintroduction">24.1.1. <span class="navy">Introduction</span></h4>
<div class="paragraph">
<p>This document covers .NET Coding Standards and is recommended to be read by team leaders/sw architects and developing teams operating in the Microsoft .NET environment.</p>
</div>
<div class="paragraph">
<p>“All the code in the system looks as if it was written by a single – very competent – individual” (K. Beck)</p>
</div>
</div>
<div class="sect3">
<h4 id="codeconvention.asciidoc_navycapitalization-conventions">24.1.2. <span class="navy">Capitalization Conventions</span></h4>
<div class="sect4">
<h5 id="codeconvention.asciidoc_navyterminology"><span class="navy">Terminology</span></h5>
<div class="sect5">
<h6 id="codeconvention.asciidoc_camel-case-camelcase">Camel Case (camelCase)</h6>
<div class="paragraph">
<p>Each word or abbreviation in the middle of the phrase begins with a capital letter, with no intervening spaces or punctuation.</p>
</div>
<div class="paragraph">
<p>The camelCasing convention, used only for parameter names, capitalizes the first character of each word except the first word, as shown in the following examples. As the example also shows, two-letter acronyms that begin a camel-cased identifier are both lowercase.</p>
</div>
<div class="paragraph">
<p><span class="icon"><i class="fa fa-= fa-thumbs-o-up"></i></span> use camelCasing for parameter names.</p>
</div>
</div>
<div class="sect5">
<h6 id="codeconvention.asciidoc_pascal-case-pascalcase">Pascal Case (PascalCase)</h6>
<div class="paragraph">
<p>The first letter of each concatenated word is capitalized. No other characters are used to separate the words, like hyphens or underscores.</p>
</div>
<div class="paragraph">
<p>The PascalCasing convention, used for all identifiers except parameter names, capitalizes the first character of each word (including acronyms over two letters in length).</p>
</div>
<div class="paragraph">
<p><span class="icon"><i class="fa fa-= fa-thumbs-o-up"></i></span> use PascalCasing for all public member, type, and namespace names consisting of multiple words.</p>
</div>
</div>
<div class="sect5">
<h6 id="codeconvention.asciidoc_underscore-prefix-_underscore">Underscore Prefix (_underScore)</h6>
<div class="paragraph">
<p>For underscore ( _ ), the word after _ use camelCase terminology.</p>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="codeconvention.asciidoc_navygeneral-naming-conventions">24.1.3. <span class="navy">General Naming Conventions</span></h4>
<div class="paragraph">
<p><span class="icon"><i class="fa fa-= fa-thumbs-o-up"></i></span> choose easily readable identifier names.</p>
</div>
<div class="paragraph">
<p><span class="icon"><i class="fa fa-= fa-thumbs-o-up"></i></span> favor readability over brevity.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>◦ e.g.: GetLength is a better name than GetInt.
◦ Aim for the “ubiquitous language” (E. Evans): A language distilled from the domain language, which helps the team clarifying domain concepts and communicating with domain experts.</pre>
</div>
</div>
<div class="paragraph">
<p><span class="icon"><i class="fa fa-= fa-thumbs-o-up"></i></span> prefer adding a suffix rather than a prefix to indicate a new version of an existing API.</p>
</div>
<div class="paragraph">
<p><span class="icon"><i class="fa fa-= fa-thumbs-o-up"></i></span> use a numeric suffix to indicate a new version of an existing API, particularly if the existing name of the API is the only name that makes sense (i.e., if it is an industry standard) and if adding any meaningful suffix (or changing the name) is not an appropriate option.</p>
</div>
<div class="paragraph">
<p><span class="icon"><i class="fa fa-= fa-thumbs-o-down"></i></span> do not use underscores, hyphens, or any other nonalphanumeric characters.</p>
</div>
<div class="paragraph">
<p><span class="icon"><i class="fa fa-= fa-thumbs-o-down"></i></span> do not use Hungarian notation.</p>
</div>
<div class="paragraph">
<p><span class="icon"><i class="fa fa-= fa-thumbs-o-down"></i></span> avoid using identifiers that conflict with keywords of widely used programming languages.</p>
</div>
<div class="paragraph">
<p><span class="icon"><i class="fa fa-= fa-thumbs-o-down"></i></span> do not use abbreviations or contractions as part of identifier names.</p>
</div>
<div class="paragraph">
<p><span class="icon"><i class="fa fa-= fa-thumbs-o-down"></i></span> do not use any acronyms that are not widely accepted, and even if they are, only when necessary.</p>
</div>
<div class="paragraph">
<p><span class="icon"><i class="fa fa-= fa-thumbs-o-down"></i></span> do not use the "Ex" (or a similar) suffix for an identifier to distinguish it from an earlier version of the same API.</p>
</div>
<div class="paragraph">
<p><span class="icon"><i class="fa fa-= fa-thumbs-o-down"></i></span> do not use C# reserved words as names.</p>
</div>
<div class="paragraph">
<p><span class="icon"><i class="fa fa-= fa-thumbs-o-down"></i></span> do not use Hungarian notation. Hungarian notation is the practice of including a prefix in identifiers to encode some metadata about the parameter, such as the data type of the identifier.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>◦ e.g.: iNumberOfClients, sClientName</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="codeconvention.asciidoc_navynames-of-assemblies-and-dlls">24.1.4. <span class="navy">Names of Assemblies and DLLs</span></h4>
<div class="paragraph">
<p>An assembly is the unit of deployment and identity for managed code programs. Although assemblies can span one or more files, typically an assembly maps one-to-one with a DLL. Therefore, this section describes only DLL naming conventions, which then can be mapped to assembly naming conventions.</p>
</div>
<div class="paragraph">
<p><span class="icon"><i class="fa fa-= fa-thumbs-o-up"></i></span> choose names for your assembly DLLs that suggest large chunks of functionality, such as System.Data.</p>
</div>
<div class="paragraph">
<p>Assembly and DLL names don’t have to correspond to namespace names, but it is reasonable to follow the namespace name when naming assemblies. A good rule of thumb is to name the DLL based on the common prefix of the assemblies contained in the assembly. For example, an assembly with two namespaces, MyCompany.MyTechnology.FirstFeature and MyCompany.MyTechnology.SecondFeature, could be called MyCompany.MyTechnology.dll.</p>
</div>
<div class="paragraph">
<p><span class="icon"><i class="fa fa-= fa-thumbs-o-up"></i></span> consider naming DLLs according to the following pattern:<br>
&lt;Company&gt;.&lt;Component&gt;.dll
where &lt;Component&gt; contains one or more dot-separated clauses.</p>
</div>
<div class="paragraph">
<p>For example:
Litware.Controls.dll.</p>
</div>
</div>
<div class="sect3">
<h4 id="codeconvention.asciidoc_navygeneral-coding-style">24.1.5. <span class="navy">General coding style</span></h4>
<div class="ulist">
<ul>
<li>
<p>Source files: One Namespace per file and one class per file.</p>
</li>
<li>
<p>Braces: On new line. Always use braces when optional.</p>
</li>
<li>
<p>Indention: Use tabs with size of 4.</p>
</li>
<li>
<p>Comments: Use // for simple comment or /// for sumaries. Do not /* … */ and do not flowerbox.</p>
</li>
<li>
<p>Use Use built-in C# native data types vs .NET CTS types (string instead of String)</p>
</li>
<li>
<p>Avoid changing default type in Enums.</p>
</li>
<li>
<p>Use <em>base</em> or <em>this</em> only in constructors or within an override.</p>
</li>
<li>
<p>Always check for null before invoking events.</p>
</li>
<li>
<p>Avoid using <em>Finalize</em>. Use C# Destructors and do not create Finalize() method.</p>
</li>
<li>
<p>Suggetion: Use blank lines, to make it much more readable by dividing it into small, easy-to-digest sections:</p>
<div class="literalblock">
<div class="content">
<pre>◦ Use a single blank line to separate logical groups of code, such as control structures.
◦ Use two blank lines to separate method definitions</pre>
</div>
</div>
</li>
</ul>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>Case</strong></th>
<th class="tableblock halign-left valign-top"><strong>Convention</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Source File</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Pascal case. Match class name and file name</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Namespace</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Pascal case</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Class</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Pascal case</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Interface</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Pascal case</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Generics</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Single capital letter (T or K)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Methods</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Pascal case (use a Verb or Verb+Object)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Public field</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Pascal case</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Private field</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Camel case with underscore (_) prefix</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Static field</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Pascal case</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Porperty</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Pascal case. Try to use get and and set convention {get;set;}</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Constant</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Pascal case</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enum</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Pascal case</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Variable (inline)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Camel case</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Param</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Camel case</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="codeconvention.asciidoc_navyuse-of-region-guideline">24.1.6. <span class="navy">Use of Region guideline</span></h4>
<div class="paragraph">
<p>Regions can be used to collapse code inside Visual Studio .NET. Regions are ideal candidates to hide boiler plate style code that adds little value to the reader on your code. Regions can then be expanded to provide progressive disclosure of the underlying details of the class or method.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Do Not regionalise entire type definitions that are of an important nature. Types such as enums (which tend to be fairly static in their nature) can be regionalised – their permissible values show up in Intellisense anyway.</p>
</li>
<li>
<p>Do Not regionalise an entire file. When another developer opens the file, all they will see is a single line in the code editor pane.</p>
</li>
<li>
<p>Do regionalise boiler plate type code.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="codeconvention.asciidoc_navyuse-of-comment-guideline">24.1.7. <span class="navy">Use of Comment guideline</span></h4>
<div class="paragraph">
<p>Code is the only completely reliable documentation: write “good code” first!</p>
</div>
<div class="sect4">
<h5 id="codeconvention.asciidoc_navyavoid-unnecessary-comments"><span class="navy">Avoid Unnecessary comments</span></h5>
<div class="ulist">
<ul>
<li>
<p>Choosing good names for fields, methods, paramteres, etc. “let the code speak” (K. Beck) by itself reducing the need for comments and documentation</p>
</li>
<li>
<p>Avoid “repeating the code” and commenting the obvious</p>
</li>
<li>
<p>Avoid commenting “tricky code”: rewrite it! If there’s no time at present to refactor a tricky section, mark it with a TODO and schedule time to take care of it as soon as possible.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="codeconvention.asciidoc_navyeffective-comments"><span class="navy">Effective comments</span></h5>
<div class="ulist">
<ul>
<li>
<p>Use comments to summarize a section of code</p>
</li>
<li>
<p>Use comments to clarify sensitive pieces of code</p>
</li>
<li>
<p>Use comments to clarify the intent of the code</p>
</li>
<li>
<p>Bad written or out-of-date comments are more damaging than helpful:</p>
</li>
<li>
<p>Write clear and effective comments</p>
</li>
<li>
<p>Pay attention to pre-existing comments when modifying code or copying&amp;pasting code</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="codeconvention.asciidoc_navyexternal-links">24.1.8. <span class="navy">External links</span></h4>
<div class="paragraph">
<p><a href="https://docs.microsoft.com/en-us/dotnet/standard/design-guidelines/naming-guidelines">Naming guidelines</a></p>
</div>
<div class="paragraph">
<p><a href="https://docs.microsoft.com/en-us/dotnet/standard/design-guidelines/general-naming-conventions">General naming conventions</a></p>
</div>
<div class="paragraph">
<p><a href="https://docs.microsoft.com/en-us/dotnet/standard/design-guidelines/capitalization-conventions">Capitalization conventions</a></p>
</div>
<div class="paragraph">
<p><a href="https://docs.microsoft.com/en-us/dotnet/standard/design-guidelines/names-of-assemblies-and-dlls">Assembly and Name Spaces conventions</a></p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="master-devon4net.asciidoc_environment">25. Environment</h2>
<div class="sectionbody">
<!-- toc disabled -->
<div class="sect2">
<h3 id="environment.asciidoc">25.1. Environment</h3>
<div class="sect3">
<h4 id="environment.asciidoc_navyoverview">25.1.1. <span class="navy">Overview</span></h4>

</div>
<div class="sect3">
<h4 id="environment.asciidoc_navyrequired-software">25.1.2. <span class="navy">Required software</span></h4>
<div class="paragraph">
<p><a href="https://code.visualstudio.com/">Visual Studio Code</a></p>
</div>
<div class="paragraph">
<p><a href="https://marketplace.visualstudio.com/items?itemName=ms-vscode.csharp">C# Extension for VS Code</a></p>
</div>
<div class="paragraph">
<p><a href="https://www.microsoft.com/net/core">.Net Core SDK</a></p>
</div>
</div>
<div class="sect3">
<h4 id="environment.asciidoc_navysetting-up-the-environment">25.1.3. <span class="navy">Setting up the environment</span></h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Download and install <a href="https://code.visualstudio.com/">Visual Studio Code</a></p>
</li>
<li>
<p>Download and install <a href="https://www.microsoft.com/net/core">.Net Core SDK</a></p>
</li>
<li>
<p><a href="https://code.visualstudio.com/docs/editor/extension-gallery">Intall the extension</a> <a href="https://marketplace.visualstudio.com/items?itemName=ms-vscode.csharp">Omnisharp</a> in Visual Studio Code</p>
</li>
</ol>
</div>
<div class="sect5">
<h6 id="environment.asciidoc_navyhello-world"><span class="navy">Hello world</span></h6>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Open a project:</p>
<div class="ulist">
<ul>
<li>
<p>Open Visual Studio Code.</p>
</li>
<li>
<p>Click on the Explorer icon on the left menu and then click <strong>Open Folder</strong>.</p>
</li>
<li>
<p>Select the folder you want your C# project to be in and click <strong>Select Folder</strong>. For our example, we&#8217;ll create a folder for our project named 'HelloWorld'.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Initialize a C# project:</p>
<div class="ulist">
<ul>
<li>
<p>Open the Integrated Terminal from Visual Studio Code by typing CTRL+` (backtick). Alternatively, you can select <strong>View</strong> &gt; <strong>Integrated Terminal</strong> from the main menu.</p>
</li>
<li>
<p>In the terminal window, type <code>dotnet new console</code>.</p>
</li>
<li>
<p>This creates a <code>Program.cs</code> file in your folder with a simple "Hello World" program already written, along with a C# project file named <code>HelloWorld.csproj</code>.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Resolve the build assets:</p>
<div class="ulist">
<ul>
<li>
<p>For <strong>.NET Core 2.0</strong>, this step is optional. The <code>dotnet restore</code> command executes automatically when a new project is created.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Run the "Hello World" program:</p>
<div class="ulist">
<ul>
<li>
<p>Type <code>dotnet run</code>.</p>
</li>
</ul>
</div>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="environment.asciidoc_navydebug"><span class="navy">Debug</span></h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Open Program.cs by clicking on it. The first time you open a C# file in Visual Studio Code, OmniSharp will load in the editor.</p>
</li>
<li>
<p>Visual Studio Code will prompt you to add the missing assets to build and debug your app. Select Yes.</p>
</li>
<li>
<p>To open the Debug view, click on the Debugging icon on the left side menu.</p>
</li>
<li>
<p>Locate the green arrow at the top of the pane. Make sure the drop-down next to it has <code>.NET Core Launch (console)</code> selected.</p>
</li>
<li>
<p>Add a breakpoint to your project by clicking on the <strong>editor margin</strong> (the space on the left of the line numbers in the editor).</p>
</li>
<li>
<p>Select F5 or the green arrow to start debugging. The debugger stops execution of your program when it reaches the breakpoint you set in the previous step.</p>
<div class="ulist">
<ul>
<li>
<p>While debugging you can view your local variables in the top left pane or use the debug console.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Select the green arrow at the top to continue debugging, or select the red square at the top to stop.</p>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>For more information and troubleshooting tips on .NET Core debugging with OmniSharp in Visual Studio Code, see <a href="https://github.com/OmniSharp/omnisharp-vscode/blob/master/debugger.md">Instructions for setting up the .NET Core debugger</a>.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="environment.asciidoc_navyexternal-links">25.1.4. <span class="navy">External links</span></h4>
<div class="paragraph">
<p><a href="https://www.microsoft.com/net/core">.Net Core</a></p>
</div>
<div class="paragraph">
<p><a href="https://code.visualstudio.com/docs/other/dotnet">Using .NET Core in Visual Studio Code</a></p>
</div>
<div class="paragraph">
<p><a href="https://docs.microsoft.com/dotnet/core/tutorials/with-visual-studio-code">.Net Core in Visual Studio Code tutorial</a></p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="master-devon4net.asciidoc_user-guide">26. User guide</h2>
<div class="sectionbody">
<!-- toc disabled -->
<div id="userguide.asciidoc_img-t-architecture" class="imageblock">
<div class="content">
<a class="image" href="images/devon.png"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/devon.png" alt="technical architecture" width="450"></a>
</div>
</div>
<div class="sect2">
<h3 id="userguide.asciidoc">26.1. <span class="navy">OASP4NET Guide</span></h3>
<div class="sect3">
<h4 id="userguide.asciidoc_navyintroduction">26.1.1. <span class="navy">Introduction</span></h4>
<div class="paragraph">
<p>Welcome to OASP4Net framework user guide. In this documment you will find the information reagarding how to start and deploy your project using the guidelines proposed in our solution.</p>
</div>
<div class="paragraph">
<p>All the  guidelines shown and used in this document are a set of rules and conventions proposed and supported by Microsoft and the industry.</p>
</div>
</div>
<div class="sect3">
<h4 id="userguide.asciidoc_navythe-package">26.1.2. <span class="navy">The package</span></h4>
<div class="paragraph">
<p>Devon4Net package solution contains:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>File / Folder</strong></th>
<th class="tableblock halign-left valign-top"><strong>Content</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Documentation</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">User documentation in HTML format</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Samples</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Different samples implemented in .NET and .NET Core. Also includes My Thai Star Devon flagship restaurant</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Template</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Main .net and .NET Core templates to start developing from scratch</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">License</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">License agreement</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">README.md</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Github main page</p></td>
</tr>
</tbody>
</table>
<div class="sect4">
<h5 id="userguide.asciidoc_navyapplication-templates"><span class="navy">Application templates</span></h5>
<div class="paragraph">
<p>The application templates given in the bundle are ready to use.</p>
</div>
<div class="paragraph">
<p>At the moment .NET Core and .NET templates ar supported. Each template is ready to be used as a simple console application or being deployed in a web server like IIS.</p>
</div>
</div>
<div class="sect4">
<h5 id="userguide.asciidoc_navysamples"><span class="navy">Samples</span></h5>
<div class="sect5">
<h6 id="userguide.asciidoc_navymy-thai-star"><span class="navy">My Thai Star</span></h6>
<div class="paragraph">
<p>You can find My Thai Star .NET port application at <a href="https://github.com/oasp/my-thai-star/tree/develop/net">Github</a>.</p>
</div>
</div>
<div class="sect5">
<h6 id="userguide.asciidoc_navygmailapiconsumer"><span class="navy">GMailAPIConsumer</span></h6>
<div class="paragraph">
<p>The GMailAPIConsumer sample contains both implementations (.NET and :ET Core) of a microservice able to connect to Google API services in order to send emails. The Microservice uses the My Thai Star email address to show how to comunicate with Google API.</p>
</div>
</div>
<div class="sect5">
<h6 id="userguide.asciidoc_navymultiplatform"><span class="navy">Multiplatform</span></h6>
<div class="paragraph">
<p>The main purppose of this sample is how to deploy the .NET Core template to different platforms. The sample shows how to build a micro webserver able to be deployed to Linux and iOS.</p>
</div>
<div class="paragraph">
<p>The main purppose of this sample is how to deploy the .NET Core template to different platforms. The sample shows how to build a micro webserver able to be deployed to Linux and iOS.</p>
</div>
<div class="paragraph">
<p>Please take a look to the .csproj file in order to see how it works. The next lines in the .csproj show how achieve this:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;PropertyGroup&gt;
  &lt;TargetFramework&gt;netcoreapp2.0&lt;/TargetFramework&gt;
  &lt;RuntimeIdentifiers&gt;win10-x64;osx.10.11-x64;ubuntu.14.04-x64&lt;/RuntimeIdentifiers&gt;
&lt;/PropertyGroup&gt;</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="userguide.asciidoc_navycookbook">26.1.3. <span class="navy">Cookbook</span></h4>
<div class="sect4">
<h5 id="userguide.asciidoc_navydata-management"><span class="navy">Data management</span></h5>
<div class="paragraph">
<p>To use EF Core, install the package for the database provider(s) you want to target. This walkthrough uses SQL Server.</p>
</div>
<div class="paragraph">
<p>For a list of available providers see <a href="https://docs.microsoft.com/en-us/ef/core/providers/index">Database Providers</a></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Go to <strong>Tools &gt; NuGet Package Manager &gt; Package Manager Console</strong></p>
</li>
<li>
<p>Run <strong>Install-Package Microsoft.EntityFrameworkCore.SqlServer</strong></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>We will be using some Entity Framework Tools to create a model from the database. So we will install the tools package as well:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Run <strong>Install-Package Microsoft.EntityFrameworkCore.Tools</strong></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>We will be using some ASP.NET Core Scaffolding tools to create controllers and views later on. So we will install this design package as well:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Run <strong>Install-Package Microsoft.VisualStudio.Web.CodeGeneration.Design</strong></p>
</li>
</ul>
</div>
<div class="sect5">
<h6 id="userguide.asciidoc_navyef-code-first"><span class="navy">EF Code first</span></h6>
<div class="paragraph">
<p>In order to design your database model from scratch, we encourage to follow the Microsoft guidelines described  <a href="https://docs.microsoft.com/en-us/aspnet/core/data/ef-mvc/complex-data-model">here</a>.</p>
</div>
</div>
<div class="sect5">
<h6 id="userguide.asciidoc_navyef-database-first"><span class="navy">EF Database first</span></h6>
<div class="ulist">
<ul>
<li>
<p>Go to <strong>Tools &gt; NuGet Package Manager &gt; Package Manager Console</strong></p>
</li>
<li>
<p>Run the following command to create a model from the existing database:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>Scaffold-DbContext "Your connection string to existing database" Microsoft.EntityFrameworkCore.SqlServer -OutputDir Models</pre>
</div>
</div>
<div class="paragraph">
<p>The command will create the database context and the mapped entities as well inside of Models folder.</p>
</div>
</div>
<div class="sect5">
<h6 id="userguide.asciidoc_navyregister-your-context-with-dependency-injection"><span class="navy">Register your context with dependency injection</span></h6>
<div class="paragraph">
<p>Services are registered with dependency injection during application startup.</p>
</div>
<div class="paragraph">
<p>In order to register your database context (or multiple database context as well) you can add the following line at ConfigureDbService method at startup.cs:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>services.AddDbContext&lt;YourModelContext&gt;(
                options =&gt; options.UseSqlServer(Configuration.GetConnectionString("Connection name at appsettings.json")));</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
You should put your Model and Entities in the template&#8217;s OASP4Net.Domain.Entities project.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect4">
<h5 id="userguide.asciidoc_navyrepositories-and-services"><span class="navy">Repositories and Services</span></h5>
<div class="paragraph">
<p><em>Services</em> and <em>Repositories</em> are an important part of OASP4NET proposal. To make them worl properly, first of all must be declared and injected at Startup.cs at <em>DI</em> Region.</p>
</div>
<div class="paragraph">
<p><em>Services</em> are declared in OASP4Net.Business.Common and injected in Controller classes when needed. Use services to build your application logic.</p>
</div>
<div id="userguide.asciidoc_img-t-architecture" class="imageblock">
<div class="content">
<a class="image" href="images/business_ide_ext.png"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/business_ide_ext.png" alt="technical architecture" width="450"></a>
</div>
<div class="title">Figure 73. Scrennshot of OASP4Net.Business.Common project in depth</div>
</div>
<div class="paragraph">
<p>For example, My Thai Star Booking controller contructor looks like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>        public BookingController(IBookingService bookingService, IMapper mapper)
        {
            BookingService = bookingService;
            Mapper = mapper;

        }</pre>
</div>
</div>
<div class="paragraph">
<p>Currently OASP4NET has a <em>Unit of Work</em> class in order to perform CRUD operations to database making use of your designed model context.</p>
</div>
<div class="paragraph">
<p><em>Repositories</em> are declared at <em>OASP4Net.Domain.UnitOfWork</em> project and make use of <em>Unit of Work</em> class.</p>
</div>
<div class="paragraph">
<p>The common methods to perform CRUD operations (where &lt;T&gt; is an entity from your model) are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Sync methods:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>IList&lt;T&gt; GetAll(Expression&lt;Func&lt;T, bool&gt;&gt; predicate = null);
T Get(Expression&lt;Func&lt;T, bool&gt;&gt; predicate = null);
IList&lt;T&gt; GetAllInclude(IList&lt;string&gt; include, Expression&lt;Func&lt;T, bool&gt;&gt; predicate = null);
T Create(T entity);
void Delete(T entity);
void DeleteById(object id);
void Delete(Expression&lt;Func&lt;T, bool&gt;&gt; where);
void Edit(T entity);</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Async methods:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>Task&lt;IList&lt;T&gt;&gt; GetAllAsync(Expression&lt;Func&lt;T, bool&gt;&gt; predicate = null);
Task&lt;T&gt; GetAsync(Expression&lt;Func&lt;T, bool&gt;&gt; predicate = null);
Task&lt;IList&lt;T&gt;&gt; GetAllIncludeAsync(IList&lt;string&gt; include, Expression&lt;Func&lt;T, bool&gt;&gt; predicate = null);</pre>
</div>
</div>
<div class="paragraph">
<p>If you perform a Commit operation and an error happens, changes will be rolled back.</p>
</div>
</div>
<div class="sect4">
<h5 id="userguide.asciidoc_navyswagger-integration"><span class="navy">Swagger integration</span></h5>
<div class="paragraph">
<p>The given templates allow you to specify the API contract through Swagger integration and the controller classes are the responsable of exposing methods making use of comments in the source code.</p>
</div>
<div class="paragraph">
<p>The next example shows how to comment the method with summaries in order to define the contract. Add (Triple Slash) XML Documentation To Swagger:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>/// &lt;summary&gt;
/// Method to get reservations
/// &lt;/summary&gt;
/// &lt;response code="201"&gt;Ok.&lt;/response&gt;
/// &lt;response code="400"&gt;Bad request. Parser data error.&lt;/response&gt;
/// &lt;response code="401"&gt;Unathorized. Autentication fail&lt;/response&gt;
/// &lt;response code="403"&gt;Forbidden. Authorization error.&lt;/response&gt;
/// &lt;response code="500"&gt;Internal Server Error. The search process ended with error.&lt;/response&gt;
[HttpPost]
[Route("/mythaistar/services/rest/bookingmanagement/v1/booking/search")]
//[Authorize(Policy = "MTSWaiterPolicy")]
[AllowAnonymous]
[EnableCors("CorsPolicy")]
public async Task&lt;IActionResult&gt; BookingSearch([FromBody]BookingSearchDto bookingSearchDto)
{</pre>
</div>
</div>
<div class="paragraph">
<p>In order to be efective and make use of the comments to build the API contract, the project which contains the controller classes must generate the XML document file. To achieve this, the XML documentation file must be checked in project settings tab:</p>
</div>
<div id="userguide.asciidoc_img-t-architecture" class="imageblock">
<div class="content">
<a class="image" href="images/project_doc.png"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/project_doc.png" alt="technical architecture" width="450"></a>
</div>
<div class="title">Figure 74. Project settings tab</div>
</div>
<div class="paragraph">
<p>We propose to generate the file under the XmlDocumentation folder. For example in OASP4Net.Domain.Entities project in My Thai Star .NET implementation the ootput folder is:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>XmlDocumentation\OASP4Net.Business.Common.xml</pre>
</div>
</div>
<div class="paragraph">
<p>The file <em>OASP4Net.Business.Common.xml</em> won&#8217;t appear until you build the project. Once the file is generated, please modify its properties as a resource and set it to be <em>Copy always</em> .</p>
</div>
<div id="userguide.asciidoc_img-t-architecture" class="imageblock">
<div class="content">
<a class="image" href="images/doc_copy_always.png"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/doc_copy_always.png" alt="technical architecture" width="450"></a>
</div>
<div class="title">Figure 75. Swagger XML document file properties</div>
</div>
<div class="paragraph">
<p>Once you have this, the swagger user interface will show the method properties defined in your controller comments.</p>
</div>
<div class="paragraph">
<p>Making use of this technique controller are not encapsulated to the application project. Also, you can develop your controller classes in different projects obtain code reusability.</p>
</div>
<div class="paragraph">
<p>Swagger comment:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>Comment</strong></th>
<th class="tableblock halign-left valign-top"><strong>Functionality</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt;summary&gt;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Will map to the operation&#8217;s summary</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt;remarks&gt;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Will map to the operation&#8217;s description (shown as "Implementation Notes" in the UI)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt;response code="###"&gt;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specifies the different response of the target method</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt;param&gt;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Will define the parameter(s) of the target method</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Please check <a href="https://docs.microsoft.com/en-us/dotnet/csharp/programming-guide/xmldoc/recommended-tags-for-documentation-comments">Microsoft&#8217;s site</a> regarding to summary notations.</p>
</div>
</div>
<div class="sect4">
<h5 id="userguide.asciidoc_navylogging-module"><span class="navy">Logging module</span></h5>
<div class="paragraph">
<p>An important part of life software is the need of using log and traces. OASP4NET has a log module preconfigured to achieve this important point.</p>
</div>
<div class="paragraph">
<p>By default Microsoft provides a loging module on .NET Core applications. This module is open and can it can be extended. OASP4NET uses the <a href="https://serilog.net/">serilog</a> implementation. This implememntation provides a huge quantity information about events and traces.</p>
</div>
<div class="sect5">
<h6 id="userguide.asciidoc_navylog-file"><span class="navy">Log file</span></h6>
<div class="paragraph">
<p>OASP4NET can write the log information to a simple text file. You can configure the file name and folder at appsettings.json file (LogFile attribute) at OASP4Net.Application.WebApi project.</p>
</div>
</div>
<div class="sect5">
<h6 id="userguide.asciidoc_navydatabase-log"><span class="navy">Database log</span></h6>
<div class="paragraph">
<p>OASP4NET can write the log information to a SQLite database. You can configure the file name and folder at appsettings.json file (LogDatabase attribute) at OASP4Net.Application.WebApi project.</p>
</div>
<div class="paragraph">
<p>With this method you can launch queries in order to search the information you are looking for.</p>
</div>
</div>
<div class="sect5">
<h6 id="userguide.asciidoc_navyseq-log"><span class="navy">Seq log</span></h6>
<div class="paragraph">
<p>OASP4NET can write the log information to a serilog server. You can configure the serilog URL at appsettings.json file (SeqLogServerUrl attribute) at OASP4Net.Application.WebApi project.</p>
</div>
<div class="paragraph">
<p>With this method you can make querys via HTTP.</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/serilog_seq.png"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/serilog_seq.png" alt="serilog seq"></a>
</div>
</div>
<div class="paragraph">
<p>By default you can find the log information at <em>Logs</em> folder.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="userguide.asciidoc_navyjwt-module"><span class="navy">JWT module</span></h5>
<div class="paragraph">
<p>JSON Web Tokens are an open, industry standard RFC 7519 method for representing claims securely between two parties allowing you to decode, verify and generate JWT.</p>
</div>
<div class="paragraph">
<p>You should use JWT for:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Authentication : allowing the user to access routes, services, and resources that are permitted with that token.</p>
</li>
<li>
<p>Information Exchange: JSON Web Tokens are a good way of securely transmitting information between parties.  Additionally, as the signature is calculated using the header and the payload, you can also verify that the content.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The JWT module is configured at Startup.cs inside OASP4Net.Application.WebApi project from .NET Core template. In this class you can configure the different authentication policy and JWT properties.</p>
</div>
<div class="paragraph">
<p>Once the user has been authenticated, the client perform the call to the backend with the attribute <em>Bearer</em> plus the token generated at server side.</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/jwt.png"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/jwt.png" alt="jwt"></a>
</div>
</div>
<div class="paragraph">
<p>On My Thai Star sample there are two predefined users: user0 and Waiter. Once they log in the application, the client (Angular/Xamarin) will manage the server call with the json web token. With this method we can manage the server authetication and athorization.</p>
</div>
<div class="paragraph">
<p>You can find more information about JWT at  <a href="https://jwt.io">jwt.io</a></p>
</div>
</div>
<div class="sect4">
<h5 id="userguide.asciidoc_navyaop-module"><span class="navy">AOP module</span></h5>
<div class="paragraph">
<p>AOP (Aspect Oriented Programming) tracks al information when a method is call. AOP also tracks the input and output data when a method is call.</p>
</div>
<div class="paragraph">
<p>By default OASP4NET has AOP module precunfigured and activated for controllers at Startup.cs file at OASP4Net.Application.WebApi:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>options.Filters.Add(new Infrastructure.AOP.AopControllerAttribute(Log.Logger));

options.Filters.Add(new Infrastructure.AOP.AopExceptionFilter(Log.Logger));</pre>
</div>
</div>
<div class="paragraph">
<p>This configuration allows all Controller clases to be tracked. If you don&#8217;t need to track the info comment the lines written before.</p>
</div>
</div>
<div class="sect4">
<h5 id="userguide.asciidoc_navydocker-support"><span class="navy">Docker support</span></h5>
<div class="paragraph">
<p>OASP4NET Core projects are ready to be integrated with docker.</p>
</div>
<div class="paragraph">
<p><a href="https://github.com/oasp/my-thai-star/tree/develop/net">My Thai Star application</a> sample is ready to be use with linux docker containers. The Readme file explains how to launch and setup the sample application.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>angular</strong> : Angular client to support backend. Just binaries.</p>
</li>
<li>
<p><strong>database</strong> : Database scripts and .bak file</p>
</li>
<li>
<p><strong>mailservice</strong>: Microservice implementation to send notifications.</p>
</li>
<li>
<p><strong>netcore</strong>: Server side using .net core 2.0.x.</p>
</li>
<li>
<p><strong>xamarin</strong>: Xamarin client based on Excalibur framework from The Netherlands using XForms.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Docker configuration and docker-compose files are provided.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="userguide.asciidoc_navytesting-with-xunit">26.1.4. <span class="navy">Testing with XUnit</span></h4>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>xUnit.net is a free, open source, community-focused unit testing tool for the .NET Framework. Written by the original inventor of NUnit v2, xUnit.net is the latest technology for unit testing C#, F#, VB.NET and other .NET languages. xUnit.net works with ReSharper, CodeRush, TestDriven.NET and Xamarin. It is part of the .NET Foundation, and operates under their code of conduct. It is licensed under Apache 2 (an OSI approved license).</p>
</div>
</blockquote>
<div class="attribution">
&#8212; About xUnit.net<br>
<cite>https://xunit.github.io/#documentation</cite>
</div>
</div>
<div class="paragraph">
<p><em>Facts</em> are tests which are always true. They test invariant conditions.</p>
</div>
<div class="paragraph">
<p><em>Theories</em> are tests which are only true for a particular set of data.</p>
</div>
<div class="sect4">
<h5 id="userguide.asciidoc_navythe-first-test"><span class="navy">The first test</span></h5>
<div class="listingblock">
<div class="content">
<pre>using Xunit;

namespace MyFirstUnitTests
{
    public class Class1
    {
        [Fact]
        public void PassingTest()
        {
            Assert.Equal(4, Add(2, 2));
        }

        [Fact]
        public void FailingTest()
        {
            Assert.Equal(5, Add(2, 2));
        }

        int Add(int x, int y)
        {
            return x + y;
        }
    }
}</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="userguide.asciidoc_navythe-first-test-with-theory"><span class="navy">The first test with theory</span></h5>
<div class="paragraph">
<p><em>Theory</em> attribute is used to create tests with input params:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>[Theory]
[InlineData(3)]
[InlineData(5)]
[InlineData(6)]
public void MyFirstTheory(int value)
{
    Assert.True(IsOdd(value));
}

bool IsOdd(int value)
{
    return value % 2 == 1;
}</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="userguide.asciidoc_cheat-sheet">Cheat Sheet</h5>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Operation</th>
<th class="tableblock halign-left valign-top">Example</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Test</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">[Fact]</p>
<p class="tableblock">public void Test()
{
}</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Setup</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">public class TestFixture {
public TestFixture()
{</p>
<p class="tableblock">&#8230;&#8203;</p>
<p class="tableblock">    }</p>
<p class="tableblock">}</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Teardown</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">public class TestFixture : IDisposable</p>
<p class="tableblock">{</p>
<p class="tableblock">public void Dispose() {</p>
<p class="tableblock"> &#8230;&#8203;
 }</p>
<p class="tableblock">}</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="userguide.asciidoc_console-runner-return-codes">Console runner return codes</h5>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Code</th>
<th class="tableblock halign-left valign-top">Meaning</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The tests ran successfully.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">One or more of the tests failed.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The help page was shown, either because it was requested, or because the user did not provide any command line arguments.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">There was a problem with one of the command line options passed to the runner.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">There was a problem loading one or more of the test assemblies (for example, if a 64-bit only assembly is run with the 32-bit test runner).</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect3">
<h4 id="userguide.asciidoc_navypublishing">26.1.5. <span class="navy">Publishing</span></h4>
<div class="sect5">
<h6 id="userguide.asciidoc_navynginx"><span class="navy">Nginx</span></h6>
<div class="paragraph">
<p>In order to deploy your application to a Nginx server on Linux platform you can follow the instructions from <em>Microsoft</em> <a href="#./offline/nginx.html">here</a>.</p>
</div>
</div>
<div class="sect5">
<h6 id="userguide.asciidoc_navyiis"><span class="navy">IIS</span></h6>
<div class="paragraph">
<p>In this point is shown the configuration options that must implement the .Net Core application.</p>
</div>
<div class="paragraph">
<p>Supported operating systems:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Windows 7 and newer</p>
</li>
<li>
<p>Windows Server 2008 R2 and newer*</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>WebListener server will not work in a reverse-proxy configuration with IIS. You must use the <a href="https://docs.microsoft.com/en-us/aspnet/core/fundamentals/servers/kestrel?tabs=aspnetcore2x">Kestrel server</a>.</p>
</div>
<div class="paragraph">
<p><span class="underline">IIS configuration</span></p>
</div>
<div class="paragraph">
<p>Enable the Web Server (IIS) role and establish role services.</p>
</div>
<div class="paragraph">
<p><strong>Windows desktop operating systems</strong></p>
</div>
<div class="paragraph">
<p>Navigate to Control Panel &gt; Programs &gt; Programs and Features &gt; Turn Windows features on or off (left side of the screen). Open the group for Internet Information Services and Web Management Tools. Check the box for IIS Management Console. Check the box for World Wide Web Services. Accept the default features for World Wide Web Services or customize the IIS features to suit your needs.</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/iis_1.png"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/iis_1.png" alt="iis 1"></a>
</div>
</div>
<div class="paragraph">
<p>*Conceptually, the IIS configuration described in this document also applies to hosting ASP.NET Core applications on Nano Server IIS, but refer to ASP.NET Core with IIS on Nano Server for specific instructions.</p>
</div>
<div class="paragraph">
<p><strong>Windows Server operating systems</strong>
For server operating systems, use the Add Roles and Features wizard via the Manage menu or the link in Server Manager. On the Server Roles step, check the box for Web Server (IIS).</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/iis_2.png"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/iis_2.png" alt="iis 2"></a>
</div>
</div>
<div class="paragraph">
<p>On the Role services step, select the IIS role services you desire or accept the default role services provided.</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/iis_3.png"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/iis_3.png" alt="iis 3"></a>
</div>
</div>
<div class="paragraph">
<p>Proceed through the Confirmation step to install the web server role and services. A server/IIS restart is not required after installing the Web Server (IIS) role.</p>
</div>
<div class="paragraph">
<p><span class="underline">Install the .NET Core Windows Server Hosting bundle</span></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Install the .NET Core Windows Server Hosting bundle on the hosting system. The bundle will install the .NET Core Runtime, .NET Core Library, and the ASP.NET Core Module. The module creates the reverse-proxy between IIS and the Kestrel server. Note: If the system doesn&#8217;t have an Internet connection, obtain and install the Microsoft Visual C++ 2015 Redistributable before installing the .NET Core Windows Server Hosting bundle.</p>
</li>
<li>
<p>Restart the system or execute net stop was /y followed by net start w3svc from a command prompt to pick up a change to the system PATH.</p>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If you use an IIS Shared Configuration, see ASP.NET Core Module with IIS Shared Configuration.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To configure IISIntegration service options, include a service configuration for IISOptions in ConfigureServices:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c# hljs" data-lang="c#">services.Configure&lt;IISOptions&gt;(options =&gt;
{
    ...
});</code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Option</th>
<th class="tableblock halign-left valign-top">Default</th>
<th class="tableblock halign-left valign-top">Setting</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">AutomaticAuthentication</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If true, the authentication middleware sets the HttpContext.User and responds to generic challenges. If false, the authentication middleware only provides an identity (HttpContext.User) and responds to challenges when explicitly requested by the AuthenticationScheme. Windows Authentication must be enabled in IIS for AutomaticAuthentication to function.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">AuthenticationDisplayName</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">null</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sets the display name shown to users on login pages.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ForwardClientCertificate</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If true and the  MS-ASPNETCORE-CLIENTCERT request header is present, the HttpContext.Connection.ClientCertificate is populated.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><span class="underline">web.config</span></p>
</div>
<div class="paragraph">
<p>The web.config file configures the ASP.NET Core Module and provides other IIS configuration. Creating, transforming, and publishing web.config is handled by Microsoft.NET.Sdk.Web, which is included when you set your project&#8217;s SDK at the top of your .csproj file, &lt;Project Sdk="Microsoft.NET.Sdk.Web"&gt;. To prevent the MSBuild target from transforming your web.config file, add the &lt;IsTransformWebConfigDisabled&gt; property to your project file with a setting of true:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;PropertyGroup&gt;
  &lt;IsTransformWebConfigDisabled&gt;true&lt;/IsTransformWebConfigDisabled&gt;
&lt;/PropertyGroup&gt;</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="userguide.asciidoc_navyazure"><span class="navy">Azure</span></h6>
<div class="paragraph">
<p>In order to deploy your application to Azure platform you can follow the instructions from <em>Microsoft</em>:</p>
</div>
<div class="paragraph">
<p><strong>Set up the development environment</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Install the latest&nbsp;<a href="https://www.visualstudio.com/vs/azure-tools/">Azure SDK for Visual Studio</a>. The SDK installs Visual Studio if you don&#8217;t already have it.</p>
</li>
<li>
<p>Verify your&nbsp;<a href="https://portal.azure.com/">Azure account</a>. You can&nbsp;<a href="https://azure.microsoft.com/pricing/free-trial/">open a free Azure account</a>&nbsp;or&nbsp;<a href="https://azure.microsoft.com/pricing/member-offers/msdn-benefits-details/">Activate Visual Studio subscriber benefits</a>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Create a web app</strong></p>
</div>
<div class="paragraph">
<p>In the Visual Studio Start Page, select&nbsp;<strong>File &gt; New &gt; Project&#8230;&#8203;</strong></p>
</div>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/offline/azure_files/file_new_project.png" alt="File menu">
</div>
</div>
<div class="paragraph">
<p>Complete the&nbsp;<strong>New Project</strong>&nbsp;dialog:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>In the left pane, select&nbsp;<strong>.NET Core</strong>.</p>
</li>
<li>
<p>In the center pane, select&nbsp;<strong>ASP.NET Core Web Application</strong>.</p>
</li>
<li>
<p>Select&nbsp;<strong>OK</strong>.</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/offline/azure_files/new_prj.png" alt="New Project dialog">
</div>
</div>
<div class="paragraph">
<p>In the&nbsp;<strong>New ASP.NET Core Web Application</strong>&nbsp;dialog:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Select&nbsp;<strong>Web Application</strong>.</p>
</li>
<li>
<p>Select&nbsp;<strong>Change Authentication</strong>.</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/offline/azure_files/new_prj_2.png" alt="New Project dialog">
</div>
</div>
<div class="paragraph">
<p>The&nbsp;<strong>Change Authentication</strong>&nbsp;dialog appears.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Select&nbsp;<strong>Individual User Accounts</strong>.</p>
</li>
<li>
<p>Select&nbsp;<strong>OK</strong>&nbsp;to return to the&nbsp;<strong>New ASP.NET Core Web Application</strong>, then select&nbsp;<strong>OK</strong>&nbsp;again.</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/offline/azure_files/new_prj_auth.png" alt="New ASP.NET Core Web authentication dialog">
</div>
</div>
<div class="paragraph">
<p>Visual Studio creates the solution.</p>
</div>
<div class="paragraph">
<p><strong>Run the app locally</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Choose&nbsp;<strong>Debug</strong>&nbsp;then&nbsp;<strong>Start Without Debugging</strong>&nbsp;to run the app locally.</p>
</li>
<li>
<p>Click the&nbsp;<strong>About</strong>&nbsp;and&nbsp;<strong>Contact</strong>&nbsp;links to verify the web application works.</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/offline/azure_files/show.png" alt="Web application open in Microsoft Edge on localhost">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Select&nbsp;<strong>Register</strong>&nbsp;and register a new user. You can use a fictitious email address. When you submit, the page displays the following error:</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><em>"Internal Server Error: A database operation failed while processing the request. SQL exception: Cannot open the database. Applying existing migrations for Application DB context may resolve this issue."</em></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Select&nbsp;<strong>Apply Migrations</strong>&nbsp;and, once the page updates, refresh the page.</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/offline/azure_files/mig.png" alt="Internal Server Error: A database operation failed while processing the request. SQL exception: Cannot open the database. Applying existing migrations for Application DB context may resolve this issue.">
</div>
</div>
<div class="paragraph">
<p>The app displays the email used to register the new user and a&nbsp;<strong>Log out</strong>&nbsp;link.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/offline/azure_files/hello.png" alt="Web application open in Microsoft Edge. The Register link is replaced by the text Hello email@domain.com!">
</div>
</div>
<div class="paragraph">
<p><strong>Deploy the app to Azure</strong></p>
</div>
<div class="paragraph">
<p>Close the web page, return to Visual Studio, and select&nbsp;<strong>Stop Debugging</strong>&nbsp;from the&nbsp;<strong>Debug</strong>&nbsp;menu.</p>
</div>
<div class="paragraph">
<p>Right-click on the project in Solution Explorer and select&nbsp;<strong>Publish&#8230;&#8203;</strong>.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/offline/azure_files/pub.png" alt="Contextual menu open with Publish link highlighted">
</div>
</div>
<div class="paragraph">
<p>In the&nbsp;<strong>Publish</strong>&nbsp;dialog, select&nbsp;<strong>Microsoft Azure App Service</strong>&nbsp;and click&nbsp;<strong>Publish</strong>.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/offline/azure_files/maas1.png" alt="Publish dialog">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Name the app a unique name.</p>
</li>
<li>
<p>Select a subscription.</p>
</li>
<li>
<p>Select&nbsp;<strong>New&#8230;&#8203;</strong>&nbsp;for the resource group and enter a name for the new resource group.</p>
</li>
<li>
<p>Select&nbsp;<strong>New&#8230;&#8203;</strong>&nbsp;for the app service plan and select a location near you. You can keep the name that is generated by default.</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/offline/azure_files/newrg1.png" alt="App Service dialog">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Select the&nbsp;<strong>Services</strong>&nbsp;tab to create a new database.</p>
</li>
<li>
<p>Select the green&nbsp;<strong>+</strong>&nbsp;icon to create a new SQL Database</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/offline/azure_files/sql.png" alt="New SQL Database">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Select&nbsp;<strong>New&#8230;&#8203;</strong>&nbsp;on the&nbsp;<strong>Configure SQL Database</strong>&nbsp;dialog to create a new database.</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/offline/azure_files/conf.png" alt="New SQL Database and server">
</div>
</div>
<div class="paragraph">
<p>The&nbsp;<strong>Configure SQL Server</strong>&nbsp;dialog appears.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Enter an administrator user name and password, and then select&nbsp;<strong>OK</strong>. Don&#8217;t forget the user name and password you create in this step. You can keep the default&nbsp;<strong>Server Name</strong>.</p>
</li>
<li>
<p>Enter names for the database and connection string.</p>
</li>
</ul>
</div>
<div class="sect6">
<h7 id="userguide.asciidoc_note">Note</h7>
<div class="paragraph">
<p>"admin" is not allowed as the administrator user name.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/offline/azure_files/conf_servername.png" alt="Configure SQL Server dialog">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Select&nbsp;<strong>OK</strong>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Visual Studio returns to the&nbsp;<strong>Create App Service</strong>&nbsp;dialog.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Select&nbsp;<strong>Create</strong>&nbsp;on the&nbsp;<strong>Create App Service</strong>&nbsp;dialog.</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/azure_files/conf_final.png" alt="Configure SQL Database dialog">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Click the&nbsp;<strong>Settings</strong>&nbsp;link in the&nbsp;<strong>Publish</strong>&nbsp;dialog.</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/offline/azure_files/pubc.png" alt="Publish dialog: Connection panel">
</div>
</div>
<div class="paragraph">
<p>On the&nbsp;<strong>Settings</strong>&nbsp;page of the&nbsp;<strong>Publish</strong>&nbsp;dialog:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Expand&nbsp;<strong>Databases</strong>&nbsp;and check&nbsp;<strong>Use this connection string at runtime</strong>.</p>
</li>
<li>
<p>Expand&nbsp;<strong>Entity Framework Migrations</strong>&nbsp;and check&nbsp;<strong>Apply this migration on publish</strong>.</p>
</li>
<li>
<p>Select&nbsp;<strong>Save</strong>. Visual Studio returns to the&nbsp;<strong>Publish</strong>&nbsp;dialog.</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/offline/azure_files/pubs.png" alt="Publish dialog: Settings panel">
</div>
</div>
<div class="paragraph">
<p>Click&nbsp;<strong>Publish</strong>. Visual Studio will publish your app to Azure and launch the cloud app in your browser.</p>
</div>
<div class="paragraph">
<p><strong>Test your app in Azure</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Test the&nbsp;<strong>About</strong>&nbsp;and&nbsp;<strong>Contact</strong>&nbsp;links</p>
</li>
<li>
<p>Register a new user</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/offline/azure_files/register.png" alt="Web application opened in Microsoft Edge on Azure App Service">
</div>
</div>
<div class="paragraph">
<p><strong>Update the app</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Edit the&nbsp;<em>Pages/About.cshtml</em>&nbsp;Razor page and change its contents. For example, you can modify the paragraph to say "Hello ASP.NET Core!":</p>
<div class="literalblock">
<div class="content">
<pre>html&lt;button class="action copy" data-bi-name="copy"&gt;Copy&lt;/button&gt;</pre>
</div>
</div>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c# hljs" data-lang="c#">@page
@model AboutModel
@{
    ViewData["Title"] = "About";
}
&lt;h2&gt;@ViewData["Title"]&lt;/h2&gt;
&lt;h3&gt;@Model.Message&lt;/h3&gt;

    &lt;p&gt;Hello ASP.NET Core!&lt;/p&gt;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Right-click on the project and select&nbsp;<strong>Publish&#8230;&#8203;</strong>&nbsp;again.</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/offline/azure_files/pub.png" alt="Contextual menu open with Publish link highlighted">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>After the app is published, verify the changes you made are available on Azure.</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/offline/azure_files/final.png" alt="Verify task is complete">
</div>
</div>
<div class="paragraph">
<p><strong>Clean up</strong></p>
</div>
<div class="paragraph">
<p>When you have finished testing the app, go to the&nbsp;<a href="https://portal.azure.com/">Azure portal</a>&nbsp;and delete the app.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Select&nbsp;<strong>Resource groups</strong>, then select the resource group you created.</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/offline/azure_files/portalrg.png" alt="Azure Portal: Resource Groups in sidebar menu">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>In the&nbsp;<strong>Resource groups</strong>&nbsp;page, select&nbsp;<strong>Delete</strong>.</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/offline/azure_files/rgd.png" alt="Azure Portal: Resource Groups page">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Enter the name of the resource group and select&nbsp;<strong>Delete</strong>. Your app and all other resources created in this tutorial are now deleted from Azure.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="userguide.asciidoc_navyexternal-links">26.1.6. <span class="navy">External links</span></h4>
<div class="paragraph">
<p><a href="https://docs.microsoft.com/en-us/aspnet/core/publishing/iis?tabs=aspnetcore2x">Publishing .Net Core on IIS</a></p>
</div>
<div class="paragraph">
<p><a href="https://docs.microsoft.com/en-us/aspnet/core/hosting/aspnet-core-module#aspnet-core-module-with-an-iis-shared-configuration">IIS Shared configuration</a></p>
</div>
<div class="paragraph">
<p><a href="https://docs.microsoft.com/en-us/aspnet/core/publishing/linuxproduction?tabs=aspnetcore2x">Publishing to Nginx</a></p>
</div>
<div class="paragraph">
<p><a href="https://docs.microsoft.com/en-us/aspnet/core/publishing/docker">Publishing to Docker</a></p>
</div>
<div class="paragraph">
<p><a href="https://docs.microsoft.com/en-us/ef/core/miscellaneous/connection-strings">Connection strings</a></p>
</div>
<div class="paragraph">
<p><a href="https://docs.microsoft.com/en-us/ef/core/get-started/aspnetcore/new-db#create-the-model">EF basics</a></p>
</div>
<div class="paragraph">
<p><a href="https://docs.microsoft.com/en-us/aspnet/core/data/ef-mvc/complex-data-model">Entity framework advanced design</a></p>
</div>
<div class="paragraph">
<p><a href="https://github.com/domaindrivendev/Swashbuckle.AspNetCore#include-descriptions-from-xml-comments">Swagger annotations</a></p>
</div>
<div class="paragraph">
<p><a href="https://docs.microsoft.com/en-us/dotnet/csharp/programming-guide/xmldoc/recommended-tags-for-documentation-comments">Summary notation</a></p>
</div>
<div class="paragraph">
<p><a href="https://jwt.io/">JWT Official Site</a></p>
</div>
<div class="paragraph">
<p><a href="https://serilog.net/">Serilog</a></p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="master-devon4net.asciidoc_packages">27. Packages</h2>
<div class="sectionbody">
<!-- toc disabled -->
<div class="sect2">
<h3 id="packages.asciidoc">27.1. Packages</h3>
<div class="sect3">
<h4 id="packages.asciidoc_navypackages-overview">27.1.1. <span class="navy">Packages overview</span></h4>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<em>OASP4Net</em> is composed by a number of packages that increases the functionality and boosts time development. Each package has it&#8217;s own configuration to make them work properly. In <em>appsettings.json</em> set up your environment. On <em>appsettings.{environment}.json</em> you can configure each component.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="packages.asciidoc_navythe-packages">27.1.2. <span class="navy">The packages</span></h4>
<div class="paragraph">
<p>You can get the OASP packages on <a href="https://www.nuget.org/packages?q=oasp">nuget.org</a>.</p>
</div>
<div class="sect4">
<h5 id="packages.asciidoc_navyoasp4net.domain.context"><span class="navy">OASP4Net.Domain.Context</span></h5>
<div class="sect5">
<h6 id="packages.asciidoc_navydescription"><span class="navy">Description</span></h6>
<div class="paragraph">
<p>OASP4Net.Domain.Context contains the extended class OASP4NetBaseContext in order to make easier the process of having a model context configured against different database engines. This configuration allows an easier testing configuration against local and in memory databases.</p>
</div>
</div>
<div class="sect5">
<h6 id="packages.asciidoc_navyconfiguration"><span class="navy">Configuration</span></h6>
<div class="ulist">
<ul>
<li>
<p>Install package on your solution:</p>
<div class="literalblock">
<div class="content">
<pre>PM&gt; Install-Package OASP4Net.Domain.Context</pre>
</div>
</div>
</li>
<li>
<p>Add to <em>appsettings.{environment}.json</em> file your database connections:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">"ConnectionStrings":
{
"DefaultConnection":
"Server=localhost;Database=MyThaiStar;User Id=sa;Password=sa;MultipleActiveResultSets=True;",

"AuthConnection":
"Server=(localdb)\\mssqllocaldb;Database=aspnet-DualAuthCore-5E206A0B-D4DA-4E71-92D3-87FD6B120C5E;Trusted_Connection=True;MultipleActiveResultSets=true",

"SqliteConnection": "Data Source=c:\\tmp\\membership.db;"
}</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>On Startup.cs :</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c# hljs" data-lang="c#">void ConfigureServices(IServiceCollection services)</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Add your database connections defined on previous point:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c# hljs" data-lang="c#">services.ConfigureDataBase(
new Dictionary&lt;string, string&gt; {
{ConfigurationConst.DefaultConnection, Configuration.GetConnectionString(ConfigurationConst.DefaultConnection) }});</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>On OASP4Net.Application.Configuration.Startup/DataBaseConfiguration/ConfigureDataBase configure your connections.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect4">
<h5 id="packages.asciidoc_navyoasp4net.domain.unitofwork"><span class="navy">OASP4Net.Domain.UnitOfWork</span></h5>
<div class="sect5">
<h6 id="packages.asciidoc_navydescription"><span class="navy">Description</span></h6>
<div class="paragraph">
<p>Unit of work implementation for OASP solution. This unit of work provides the different methods to access the data layer with an atomic context. Sync and Async repository operations are provided. Customized Eager Loading method also provided for custom entity properties.</p>
</div>
</div>
<div class="sect5">
<h6 id="packages.asciidoc_navyconfiguration"><span class="navy">Configuration</span></h6>
<div class="ulist">
<ul>
<li>
<p>Install package on your solution:</p>
<div class="literalblock">
<div class="content">
<pre>PM&gt; Install-Package OASP4Net.Domain.UnitOfWork</pre>
</div>
</div>
</li>
<li>
<p>Add this line of code:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c# hljs" data-lang="c#">services.AddUnitOfWorkDependencyInjection();</code></pre>
</div>
</div>
<div class="paragraph">
<p>On</p>
</div>
<div class="literalblock">
<div class="content">
<pre>Startup.cs/ConfigureServices(IServiceCollection services)</pre>
</div>
</div>
<div class="paragraph">
<p>or on:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>OASP4Net.Application.Configuration.Startup/DependencyInjectionConfiguration/ConfigureDependencyInjectionService method.</pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="packages.asciidoc_navynotes"><span class="navy">Notes</span></h6>
<div class="paragraph">
<p>Now you can use the unit of work via dependency injection on your classes:</p>
</div>
<div id="packages.asciidoc_img-t-architecture" class="imageblock">
<div class="content">
<a class="image" href="images/uow_sample.png"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/uow_sample.png" alt="UOW DI Sample" width="*"></a>
</div>
<div class="title">Figure 76. Use of Unit of work via dependency injection</div>
</div>
<div class="paragraph">
<p>As you can see in the image, you can use Unit Of Work class with your defined ModelContext classes.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="packages.asciidoc_navyoasp4net.infrastructure.aop"><span class="navy">OASP4Net.Infrastructure.AOP</span></h5>
<div class="sect5">
<h6 id="packages.asciidoc_navydescription"><span class="navy">Description</span></h6>
<div class="paragraph">
<p>Simple AOP Exception handler for .Net Controller classes integrated with Serilog.</p>
</div>
</div>
<div class="sect5">
<h6 id="packages.asciidoc_navyconfiguration"><span class="navy">Configuration</span></h6>
<div class="ulist">
<ul>
<li>
<p>Install package on your solution:</p>
<div class="literalblock">
<div class="content">
<pre>PM&gt; Install-Package OASP4Net.Domain.AOP</pre>
</div>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>Add this line of code on ConfigureServices method on Startup.cs</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c# hljs" data-lang="c#">services.AddAopAttributeService();</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="packages.asciidoc_navynotes"><span class="navy">Notes</span></h6>
<div class="paragraph">
<p>Now automatically your exposed API methods exposed on controller classes will be tracked on the methods:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>OnActionExecuting</p>
</li>
<li>
<p>OnActionExecuted</p>
</li>
<li>
<p>OnResultExecuting</p>
</li>
<li>
<p>OnResultExecuted</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If an exception occuers, a message will be displayed on log with the stack trace.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="packages.asciidoc_navyoasp4net.infrastructure.applicationuser"><span class="navy">OASP4Net.Infrastructure.ApplicationUser</span></h5>
<div class="sect5">
<h6 id="packages.asciidoc_navydescription"><span class="navy">Description</span></h6>
<div class="paragraph">
<p>OASP4NET Application user classes to implement basic Microsoft&#8217;s basic authentication in order to be used on authentication methodologies such Jason Web Token (JWT).</p>
</div>
</div>
<div class="sect5">
<h6 id="packages.asciidoc_navyconfiguration"><span class="navy">Configuration</span></h6>
<div class="ulist">
<ul>
<li>
<p>Install package on your solution:</p>
<div class="literalblock">
<div class="content">
<pre>PM&gt; OASP4Net.Infrastructure.ApplicationUser</pre>
</div>
</div>
</li>
<li>
<p>Add the database connection string for user management on <em>appsettings.{environment}.json</em>:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">"ConnectionStrings":
{
"AuthConnection":
"Server=(localdb)\\mssqllocaldb;Database=aspnet-DualAuthCore-5E206A0B-D4DA-4E71-92D3-87FD6B120C5E;Trusted_Connection=True;MultipleActiveResultSets=true"
}</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Add the following line of code</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c# hljs" data-lang="c#">services.AddApplicationUserDependencyInjection();</code></pre>
</div>
</div>
<div class="paragraph">
<p>On</p>
</div>
<div class="literalblock">
<div class="content">
<pre>Startup.cs/ConfigureServices(IServiceCollection services)</pre>
</div>
</div>
<div class="paragraph">
<p>or on:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>OASP4Net.Application.Configuration.Startup/DependencyInjectionConfiguration/ConfigureDependencyInjectionService method.</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Add the data seeder on Configure method on start.cs class:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c# hljs" data-lang="c#">public void Configure(IApplicationBuilder app, IHostingEnvironment env, DataSeeder seeder)
{
    ...

    app.UseAuthentication();
    seeder.SeedAsync().Wait();

    ...
}</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="packages.asciidoc_navynotes"><span class="navy">Notes</span></h6>
<div class="ulist">
<ul>
<li>
<p>You can use the following methods to set up the database configuration:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>public static void AddApplicationUserDbContextInMemoryService(this IServiceCollection services)

public static void AddApplicationUserDbContextSQliteService(this IServiceCollection services, string connectionString)

public static void AddApplicationUserDbContextSQlServerService(this IServiceCollection services, string connectionString)</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>The method <em>AddApplicationUserDbContextInMemoryService</em> uses the <em>AuthContext</em> connection string name to set up the database.</p>
</li>
<li>
<p>This component is used with the components <em>OASP4Net.Infrastructure.JWT</em> and <em>OASP4Net.Infrastructure.JWT.MVC</em>.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect4">
<h5 id="packages.asciidoc_navyoasp4net.infrastructure.communication"><span class="navy">OASP4Net.Infrastructure.Communication</span></h5>
<div class="sect5">
<h6 id="packages.asciidoc_navydescription"><span class="navy">Description</span></h6>
<div class="paragraph">
<p>Basic client classes to  invoke GET/POST methods asynchronously. This component has the minimal clases to send basic data. For more complex operations please use <em>ASP4Net.Infrastructure.Extensions</em>.</p>
</div>
</div>
<div class="sect5">
<h6 id="packages.asciidoc_navyconfiguration"><span class="navy">Configuration</span></h6>
<div class="ulist">
<ul>
<li>
<p>Install package on your solution:</p>
<div class="literalblock">
<div class="content">
<pre>PM&gt; OASP4Net.Infrastructure.Communication</pre>
</div>
</div>
</li>
<li>
<p>Create an instance of <em>RestManagementService</em> class.</p>
</li>
<li>
<p>Use next methods to use GET/POST basic options:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c# hljs" data-lang="c#">public Task&lt;string&gt; CallGetMethod(string url);
public Task&lt;Stream&gt; CallGetMethodAsStream(string url);
public Task&lt;string&gt; CallPostMethod&lt;T&gt;(string url, T dataToSend);
public Task&lt;string&gt; CallPutMethod&lt;T&gt;(string url, T dataToSend);</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="packages.asciidoc_navynotes"><span class="navy">Notes</span></h6>
<div class="ulist">
<ul>
<li>
<p>Example:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c# hljs" data-lang="c#">private async Task RestManagementServiceSample(EmailDto dataToSend)
{
    var url = Configuration["EmailServiceUrl"];
    var restManagementService = new RestManagementService();
    await restManagementService.CallPostMethod(url, dataToSend);
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="packages.asciidoc_navyoasp4net.infrastructure.cors"><span class="navy">OASP4Net.Infrastructure.Cors</span></h5>
<div class="sect5">
<h6 id="packages.asciidoc_navydescription"><span class="navy">Description</span></h6>
<div class="paragraph">
<p>Enables CORS configuration for OASP4Net application. Multiple domains can be configured from configuration. Mandatory to web clients (p.e. Angular) to prevent making AJAX requests to another domain.</p>
</div>
<div class="paragraph">
<p>Cross-Origin Resource Sharing (CORS) is a mechanism that uses additional HTTP headers to tell a browser to let a web application running at one origin (domain) have permission to access selected resources from a server at a different origin. A web application makes a cross-origin HTTP request when it requests a resource that has a different origin (domain, protocol, and port) than its own origin.</p>
</div>
<div class="paragraph">
<p>Plase reffer to <a href="https://docs.microsoft.com/en-us/aspnet/core/security/cors?view=aspnetcore-2.1">this link</a> to get more information about CORS and .Net core.</p>
</div>
</div>
<div class="sect5">
<h6 id="packages.asciidoc_navyconfiguration"><span class="navy">Configuration</span></h6>
<div class="ulist">
<ul>
<li>
<p>Install package on your solution:</p>
<div class="literalblock">
<div class="content">
<pre>PM&gt; OASP4Net.Infrastructure.Cors</pre>
</div>
</div>
</li>
<li>
<p>You can configure your Cors configuration on <em>appsettings.{environment}.json</em>:</p>
<div class="literalblock">
<div class="content">
<pre>CorsPolicy: indicates the name of the policy. You can use this name to add security headers on your API exposed methods.</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>Origins: The alowed domains</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>Headers: The allowed headers such accept,content-type,origin,x-custom-header</pre>
</div>
</div>
</li>
<li>
<p>If you specify the cors configuration as empty array, a default Corspolicy will be enabled enabled with all origins enabled:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">  "Cors": []</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>On the other hand, you can specify different Cors policies in your solution as follows:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">"Cors": []
[
  {
    "CorsPolicy": "CorsPolicy1",
    "Origins": "http:example.com,http:www.contoso.com",
    "Headers": "accept,content-type,origin,x-custom-header",
    "Methods": "GET,POST,HEAD",
    "AllowCredentials": true
  },
  {
    "CorsPolicy": "CorsPolicy2",
    "Origins": "http:example.com,http:www.contoso.com",
    "Headers": "accept,content-type,origin,x-custom-header",
    "Methods": "GET,POST,HEAD",
    "AllowCredentials": true
  }
]</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="packages.asciidoc_navynotes"><span class="navy">Notes</span></h6>
<div class="ulist">
<ul>
<li>
<p>To use CORS in your API methods, use the next notation:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C# hljs" data-lang="C#">[EnableCors("YourCorsPolicy")]
public IActionResult Index() {
    return View();
}</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>if you want to disble the CORS check use the following annotation:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C# hljs" data-lang="C#">[DisableCors]
public IActionResult Index() {
    return View();
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="packages.asciidoc_navyoasp4net.infrastructure.extensions"><span class="navy">OASP4Net.Infrastructure.Extensions</span></h5>
<div class="sect5">
<h6 id="packages.asciidoc_navydescription"><span class="navy">Description</span></h6>
<div class="paragraph">
<p>Miscellaneous extension libreray which contains :
- Predicate expression builder
- DateTime formatter
- HttpClient
- HttpContext (Middleware support)</p>
</div>
</div>
<div class="sect5">
<h6 id="packages.asciidoc_navyconfiguration"><span class="navy">Configuration</span></h6>
<div class="ulist">
<ul>
<li>
<p>Install package on your solution:</p>
<div class="literalblock">
<div class="content">
<pre>PM&gt; OASP4Net.Infrastructure.Extensions</pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="packages.asciidoc_navynotes"><span class="navy">Notes</span></h6>
<div class="paragraph">
<p><em>Predicate expression builder</em></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Use this expression builder to generate lambda expressions dynamically.</p>
<div class="literalblock">
<div class="content">
<pre>var predicate =  PredicateBuilder.True&lt;T&gt;();</pre>
</div>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>Where T is a class. At this moment, you can build your expression and apply it to obtain your results in a efficient way and not retrieving data each time you apply an expression.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Exaple from My Thai Star .Net Core implementation:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C# hljs" data-lang="C#">public async Task&lt;PaginationResult&lt;Dish&gt;&gt; GetpagedDishListFromFilter(int currentpage, int pageSize, bool isFav, decimal maxPrice, int minLikes, string searchBy, IList&lt;long&gt; categoryIdList, long userId)
{
    var includeList = new List&lt;string&gt;{"DishCategory","DishCategory.IdCategoryNavigation", "DishIngredient","DishIngredient.IdIngredientNavigation","IdImageNavigation"};

    //Here we create our predicate builder
    var dishPredicate = PredicateBuilder.True&lt;Dish&gt;();


    //Now we start applying the different criterias:
    if (!string.IsNullOrEmpty(searchBy))
    {
        var criteria = searchBy.ToLower();
        dishPredicate = dishPredicate.And(d =&gt; d.Name.ToLower().Contains(criteria) || d.Description.ToLower().Contains(criteria));
    }

    if (maxPrice &gt; 0) dishPredicate = dishPredicate.And(d=&gt;d.Price&lt;=maxPrice);

    if (categoryIdList.Any())
    {
        dishPredicate = dishPredicate.And(r =&gt; r.DishCategory.Any(a =&gt; categoryIdList.Contains(a.IdCategory)));
    }

    if (isFav &amp;&amp; userId &gt;= 0)
    {
        var favourites = await UoW.Repository&lt;UserFavourite&gt;().GetAllAsync(w=&gt;w.IdUser == userId);
        var dishes = favourites.Select(s =&gt; s.IdDish);
        dishPredicate = dishPredicate.And(r=&gt; dishes.Contains(r.Id));
    }

    // Now we can use the predicate to retrieve data from database with just one call
    return await UoW.Repository&lt;Dish&gt;().GetAllIncludePagedAsync(currentpage, pageSize, includeList, dishPredicate);

}</code></pre>
</div>
</div>
<div class="paragraph">
<p><em>HttpContext</em></p>
</div>
<div class="ulist">
<ul>
<li>
<p>TryAddHeader method is used on <em>OASP4Net.Infrastructure.Middleware</em> component to add automatically response header options such authorization.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><em>Cryptography</em></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Adds to <em>string</em> class the following conversion methods:</p>
<div class="literalblock">
<div class="content">
<pre>ToSHA256
ToSHA512
ToMD5</pre>
</div>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p><em>Datetime</em></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Adds the <em>ConvertDateTimeToMilliseconds</em> method to <em>DateTime</em> class. It is very helpfull to get aligned with frontend frameworks.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><em>Http Client</em></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Contains synchronous and asyncrhonous methods to perform Http method calls such:</p>
<div class="literalblock">
<div class="content">
<pre>Post
Put
Patch</pre>
</div>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect4">
<h5 id="packages.asciidoc_navyoasp4net.infrastructure.jwt"><span class="navy">OASP4Net.Infrastructure.JWT</span></h5>
<div class="sect5">
<h6 id="packages.asciidoc_navydescription"><span class="navy">Description</span></h6>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>JSON Web Token (JWT) is an open standard (RFC 7519) that defines a compact and self-contained way for securely transmitting information between parties as a JSON object. This information can be verified and trusted because it is digitally signed. JWTs can be signed using a secret (with the HMAC algorithm) or a public/private key pair using RSA or ECDSA.</p>
</div>
</blockquote>
<div class="attribution">
&#8212; What is JSON Web Token?<br>
<cite>https://jwt.io/introduction/</cite>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>OASP component to manage JWT standard to provide security to .Net API applications.</p>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="packages.asciidoc_navyconfiguration"><span class="navy">Configuration</span></h6>
<div class="ulist">
<ul>
<li>
<p>Install package on your solution:</p>
<div class="literalblock">
<div class="content">
<pre>PM&gt; OASP4Net.Infrastructure.JWT</pre>
</div>
</div>
</li>
<li>
<p>You can configure your JWT configuration on <em>appsettings.{environment}.json</em>:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">"JWT": {
    "Audience": "MyThaiStar",
    "Issuer": "MyThaiStar",
    "TokenExpirationTime": 60,
    "ValidateIssuerSigningKey": true,
    "ValidateLifetime": true,
    "ClockSkew": 5,
    "Certificate": "oasp4net.pfx",
    "CertificatePassword": "oasp4net"
}</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><em>ClockSkew</em> indicates the token expiration time in minutes</p>
</li>
<li>
<p><em>Certificate</em> you can especify the name of your certificate (if it is on the same path) or the full path of the certificate. If the certificate does not exists an exception will be raised.</p>
</li>
<li>
<p>Add this line of code:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c# hljs" data-lang="c#">services.AddBusinessCommonJwtPolicy();</code></pre>
</div>
</div>
<div class="paragraph">
<p>On</p>
</div>
<div class="literalblock">
<div class="content">
<pre>Startup.cs/ConfigureServices(IServiceCollection services)</pre>
</div>
</div>
<div class="paragraph">
<p>or on:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>OASP4Net.Application.Configuration.Startup/JwtApplicationConfiguration/ConfigureJwtPolicy method.</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Inside the <em>AddBusinessCommonJwtPolicy</em> method you can add your JWT Policy like in My Thai Star application sample:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c# hljs" data-lang="c#"> services.ConfigureJwtAddPolicy("MTSWaiterPolicy", "role", "waiter");</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="packages.asciidoc_navynotes"><span class="navy">Notes</span></h6>
<div class="ulist">
<ul>
<li>
<p>The certificate will be used to generate the simetric key to encrypt the json web token.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect4">
<h5 id="packages.asciidoc_navyoasp4net.infrastructure.jwt.mvc"><span class="navy">OASP4Net.Infrastructure.JWT.MVC</span></h5>
<div class="sect5">
<h6 id="packages.asciidoc_navydescription"><span class="navy">Description</span></h6>
<div class="ulist">
<ul>
<li>
<p>OASP Extended controller to interact with JWT features</p>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="packages.asciidoc_navyconfiguration"><span class="navy">Configuration</span></h6>
<div class="ulist">
<ul>
<li>
<p>Extend your _ Microsoft.AspNetCore.Mvc.Controller_ class with <em>OASP4NetJWTController</em> class:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c# hljs" data-lang="c#">public class LoginController : OASP4NetJWTController
{
    private readonly ILoginService _loginService;

    public LoginController(ILoginService loginService,  SignInManager&lt;ApplicationUser&gt;  signInManager, UserManager&lt;ApplicationUser&gt; userManager, ILogger&lt;LoginController&gt; logger, IMapper mapper) : base(logger,mapper)
    {
        _loginService = loginService;
    }

    ....</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="packages.asciidoc_navynotes"><span class="navy">Notes</span></h6>
<div class="ulist">
<ul>
<li>
<p>In order to generate a JWT, you should implement the JWT generation on user login. For example, in My Thai Star is created as follows:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c# hljs" data-lang="c#">public async Task&lt;IActionResult&gt; Login([FromBody]LoginDto loginDto)
{
    try
    {
        if (loginDto == null) return Ok();
        var loged = await _loginService.LoginAsync(loginDto.UserName, loginDto.Password);

        if (loged)
        {
            var user = await _loginService.GetUserByUserNameAsync(loginDto.UserName);

            var encodedJwt = new JwtClientToken().CreateClientToken(_loginService.GetUserClaimsAsync(user));



            Response.Headers.Add("Access-Control-Expose-Headers", "Authorization");

            Response.Headers.Add("Authorization", $"{JwtBearerDefaults.AuthenticationScheme} {encodedJwt}");

            return Ok(encodedJwt);
        }
        else
        {
            Response.Headers.Clear();
            return StatusCode((int)HttpStatusCode.Unauthorized, "Login Error");
        }

    }
    catch (Exception ex)
    {
        return StatusCode((int)HttpStatusCode.InternalServerError, $"{ex.Message} : {ex.InnerException}");
    }
}</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>In My Thai Star the JWT will contain the user information such id, roles&#8230;&#8203;</p>
</li>
<li>
<p>Once you extend your controller with <em>OASP4NetJWTController</em> you will have available these methods to simplify user management:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c# hljs" data-lang="c#">    public interface IOASP4NetJWTController
    {
        // Gets the current user
        JwtSecurityToken GetCurrentUser();

        // Gets an specific asigned claim of current user
        Claim GetUserClaim(string claimName, JwtSecurityToken jwtUser = null);

        // Gets all the asigned claims of current user
        IEnumerable&lt;Claim&gt; GetUserClaims(JwtSecurityToken jwtUser = null);
    }</code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="packages.asciidoc_navyoasp4net.infrastructure.middleware"><span class="navy">OASP4Net.Infrastructure.Middleware</span></h5>
<div class="sect5">
<h6 id="packages.asciidoc_navydescription"><span class="navy">Description</span></h6>
<div class="ulist">
<ul>
<li>
<p>OASP4Net support for middleware classes.</p>
</li>
<li>
<p>In ASP.NET Core, middleware classes can handle an HTTP request or response. Middleware can either:</p>
<div class="ulist">
<ul>
<li>
<p>Handle an incoming HTTP request by generating an HTTP response.</p>
</li>
<li>
<p>Process an incoming HTTP request, modify it, and pass it on to another piece of middleware.</p>
</li>
<li>
<p>Process an outgoing HTTP response, modify it, and pass it on to either another piece of middleware, or the ASP.NET Core web server.</p>
</li>
</ul>
</div>
</li>
<li>
<p>OASP4Net supports the following automatic response headers:</p>
<div class="ulist">
<ul>
<li>
<p>AccessControlExposeHeader</p>
</li>
<li>
<p>StrictTransportSecurityHeader</p>
</li>
<li>
<p>XFrameOptionsHeader</p>
</li>
<li>
<p>XssProtectionHeader</p>
</li>
<li>
<p>XContentTypeOptionsHeader</p>
</li>
<li>
<p>ContentSecurityPolicyHeader</p>
</li>
<li>
<p>PermittedCrossDomainPoliciesHeader</p>
</li>
<li>
<p>ReferrerPolicyHeader:toc: macro</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="packages.asciidoc_navyconfiguration"><span class="navy">Configuration</span></h6>
<div class="ulist">
<ul>
<li>
<p>Install package on your solution:</p>
<div class="literalblock">
<div class="content">
<pre>PM&gt; OASP4Net.Infrastructure.Middleware</pre>
</div>
</div>
</li>
<li>
<p>You can configure your Middleware configuration on <em>appsettings.{environment}.json</em>:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">"Middleware": {
    "Headers": {
      "AccessControlExposeHeader": "Authorization",
      "StrictTransportSecurityHeader": "",
      "XFrameOptionsHeader": "DENY",
      "XssProtectionHeader": "1;mode=block",
      "XContentTypeOptionsHeader": "nosniff",
      "ContentSecurityPolicyHeader": "",
      "PermittedCrossDomainPoliciesHeader": "",
      "ReferrerPolicyHeader": ""
    }
}</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>On the above sample, the server aplication will add to response header the AccessControlExposeHeader, XFrameOptionsHeader, XssProtectionHeader and XContentTypeOptionsHeader headers.</p>
</li>
<li>
<p>If the header response type does not have a value, it will not be added to the response headers.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect4">
<h5 id="packages.asciidoc_navyoasp4net.infrastructure.mvc"><span class="navy">OASP4Net.Infrastructure.MVC</span></h5>
<div class="sect5">
<h6 id="packages.asciidoc_navydescription"><span class="navy">Description</span></h6>
<div class="paragraph">
<p>Common classes to extend controller functionality on API. Also provides support for paged results in OASP applications and autommaper injected class.</p>
</div>
</div>
<div class="sect5">
<h6 id="packages.asciidoc_navyconfiguration"><span class="navy">Configuration</span></h6>
<div class="ulist">
<ul>
<li>
<p>Install package on your solution:</p>
<div class="literalblock">
<div class="content">
<pre>PM&gt; OASP4Net.Infrastructure.MVC</pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="packages.asciidoc_navynotes"><span class="navy">Notes</span></h6>
<div class="ulist">
<ul>
<li>
<p>The generic class <em>ResultObjectDto&lt;T&gt;</em> provides a typed result object with pagination.</p>
</li>
<li>
<p>The extended class provides the following methods:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c# hljs" data-lang="c#">        ResultObjectDto&lt;T&gt; GenerateResultDto&lt;T&gt;(int? page, int? size, int? total);
        ResultObjectDto&lt;T&gt; GenerateResultDto&lt;T&gt;(List&lt;T&gt; result, int? page = null, int? size = null);</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><em>GenerateResultDto</em> provides typed <em>ResultObjectDto</em> object or a list of typed <em>ResultObjectDto</em> object. The aim of this methods is to provide a clean management for result objects and not repeating code through the different controller classes.</p>
</li>
<li>
<p>The following sample from <em>My Thai Star</em> shows how to use it:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c# hljs" data-lang="c#">public async Task&lt;IActionResult&gt; Search([FromBody] FilterDtoSearchObject filterDto)
{
    if (filterDto == null) filterDto = new FilterDtoSearchObject();

    try
    {
        var dishList = await _dishService.GetDishListFromFilter(false, filterDto.GetMaxPrice(), filterDto.GetMinLikes(), filterDto.GetSearchBy(),filterDto.GetCategories(), -1);


        return new OkObjectResult(GenerateResultDto(dishList).ToJson());
    }
    catch (Exception ex)
    {
        return StatusCode((int)HttpStatusCode.InternalServerError, $"{ex.Message} : {ex.InnerException}");
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="packages.asciidoc_navyoasp4net.infrastructure.swagger"><span class="navy">OASP4Net.Infrastructure.Swagger</span></h5>
<div class="sect5">
<h6 id="packages.asciidoc_navydescription"><span class="navy">Description</span></h6>
<div class="ulist">
<ul>
<li>
<p>OASP Swagger abstraction to provide full externalized easy configuration.</p>
</li>
<li>
<p>Swagger offers the easiest to use tools to take full advantage of all the capabilities of the OpenAPI Specification (OAS).</p>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="packages.asciidoc_navyconfiguration"><span class="navy">Configuration</span></h6>
<div class="ulist">
<ul>
<li>
<p>Install package on your solution:</p>
<div class="literalblock">
<div class="content">
<pre>PM&gt; OASP4Net.Infrastructure.Swagger</pre>
</div>
</div>
</li>
<li>
<p>You can configure your Swagger configuration on <em>appsettings.{environment}.json</em>:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">"Swagger": {
    "Version": "v1",
    "Title": "OASP4Net API",
    "Description": "A simple ASP.NET Core Web API capable project",
    "Terms": "OASP",
    "Contact": {
      "Name": "OASP4Net",
      "Email": "",
      "Url": ""
    },
    "License": {
      "Name": "OASP4Net",
      "Url": ""
    },
    "Endpoint": {
      "Name": "V1 Docs",
      "Url": "/swagger/v1/swagger.json"
    }
}</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Add this line of code:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c# hljs" data-lang="c#">services.ConfigureSwaggerService();</code></pre>
</div>
</div>
<div class="paragraph">
<p>On</p>
</div>
<div class="literalblock">
<div class="content">
<pre>Startup.cs/ConfigureServices(IServiceCollection services)</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Also add this line of code:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c# hljs" data-lang="c#">app.ConfigureSwaggerApplication();</code></pre>
</div>
</div>
<div class="paragraph">
<p>On</p>
</div>
<div class="literalblock">
<div class="content">
<pre>Startup.cs/Configure(IApplicationBuilder app, IHostingEnvironment env)</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Ensure your API actions and non-route parameters are decorated with explicit "Http" and "From" bindings.</p>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="packages.asciidoc_navynotes"><span class="navy">Notes</span></h6>
<div class="ulist">
<ul>
<li>
<p>To access to swagger UI launch your API project and type in your html browser the url <em><a href="http://localhost:yourPort/swagger" class="bare">http://localhost:yourPort/swagger</a></em>.</p>
</li>
<li>
<p>In order to generate the documentation annotate your actions with summary, remarks and response tags:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>/// &lt;summary&gt;
/// Method to make a reservation with potentiel guests. The method returns the reservation token with the format: {(CB_|GB_)}{now.Year}{now.Month:00}{now.Day:00}{_}{MD5({Host/Guest-email}{now.Year}{now.Month:00}{now.Day:00}{now.Hour:00}{now.Minute:00}{now.Second:00})}
/// &lt;/summary&gt;
/// &lt;param name="bookingDto"&gt;&lt;/param&gt;
/// &lt;response code="201"&gt;Ok.&lt;/response&gt;
/// &lt;response code="400"&gt;Bad request. Parser data error.&lt;/response&gt;
/// &lt;response code="401"&gt;Unathorized. Autentication fail&lt;/response&gt;
/// &lt;response code="403"&gt;Forbidden. Authorization error.&lt;/response&gt;
/// &lt;response code="500"&gt;Internal Server Error. The search process ended with error.&lt;/response&gt;
[HttpPost]
[HttpOptions]
[Route("/mythaistar/services/rest/bookingmanagement/v1/booking")]
[AllowAnonymous]
[EnableCors("CorsPolicy")]
public async Task&lt;IActionResult&gt; BookingBooking([FromBody]BookingDto bookingDto)
{
    try
    {

    ...</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Ensure that your project has the <em>generate XML documentation file</em> check active on buid menu:</p>
</li>
</ul>
</div>
<div id="packages.asciidoc_img-t-architecture" class="imageblock">
<div class="content">
<a class="image" href="images/swaggerDocXMLCheck.png"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/swaggerDocXMLCheck.png" alt="Generate documentation XML check" width="*"></a>
</div>
<div class="title">Figure 77. Swagger documentation</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Ensure that your XML files has the attribute copy always to true:</p>
</li>
</ul>
</div>
<div id="packages.asciidoc_img-t-architecture" class="imageblock">
<div class="content">
<a class="image" href="images/swaggerDoc.png"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/swaggerDoc.png" alt="Generate documentation XML check" width="*"></a>
</div>
<div class="title">Figure 78. Swagger documentation</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="packages.asciidoc_navyoasp4net.infrastructure.test"><span class="navy">OASP4Net.Infrastructure.Test</span></h5>
<div class="sect5">
<h6 id="packages.asciidoc_navydescription"><span class="navy">Description</span></h6>
<div class="paragraph">
<p>OASP Base classes to create unit tests and integration tests with Moq and xUnit.</p>
</div>
</div>
<div class="sect5">
<h6 id="packages.asciidoc_navyconfiguration"><span class="navy">Configuration</span></h6>
<div class="ulist">
<ul>
<li>
<p>Load the template:
&gt; dotnet new -i OASP4Net.Test.Template
&gt; dotnet new OASP4NetTest</p>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="packages.asciidoc_navynotes"><span class="navy">Notes</span></h6>
<div class="ulist">
<ul>
<li>
<p>At this point you can find this classes:</p>
<div class="ulist">
<ul>
<li>
<p>BaseManagementTest</p>
</li>
<li>
<p>DatabaseManagementTest&lt;T&gt; (Where T is a <em>OASP4NetBaseContext</em> class)</p>
</li>
</ul>
</div>
</li>
<li>
<p>For unit testing, inherit a class from <em>BaseManagementTest</em>.</p>
</li>
<li>
<p>For integration tests, inherit a class from <em>DatabaseManagementTest</em>.</p>
</li>
<li>
<p>The recomended databases in integration test are <em>in memory database</em> or <em>SQlite database</em>.</p>
</li>
<li>
<p>Please check <em>My thai Star</em> test project.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="packages.asciidoc">27.2. <span class="navy">Required software</span></h3>
<div class="paragraph">
<p><a href="https://code.visualstudio.com/">Visual Studio Code</a></p>
</div>
<div class="paragraph">
<p><a href="https://marketplace.visualstudio.com/items?itemName=ms-vscode.csharp">C# Extension for VS Code</a></p>
</div>
<div class="paragraph">
<p><a href="https://www.microsoft.com/net/core">.Net Core SDK</a></p>
</div>
<div class="paragraph">
<p><a href="https://docs.microsoft.com/en-us/aspnet/core/security/cors?view=aspnetcore-2.1">CORS in .Net Core</a></p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="master-devon4net.asciidoc_templates">28. Templates</h2>
<div class="sectionbody">
<!-- toc disabled -->
<div class="sect2">
<h3 id="templates.asciidoc">28.1. <span class="navy">Templates</span></h3>
<div class="sect3">
<h4 id="templates.asciidoc_navyoverview">28.1.1. <span class="navy">Overview</span></h4>
<div class="paragraph">
<p>The .Net Core and .Net Framework given templates allows to start coding an application with the following functionality ready to use:</p>
</div>
<div id="templates.asciidoc_img-t-architecture" class="imageblock">
<div class="content">
<a class="image" href="images/functionality_stack.png"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/functionality_stack.png" alt="technical architecture" width="820"></a>
</div>
<div class="title">Figure 79. Current available functionality</div>
</div>
<div class="paragraph">
<p>Plase refer to <a href="#userguide.html">User guide</a> in order to start developing.S</p>
</div>
</div>
<div class="sect3">
<h4 id="templates.asciidoc_navy.net-core-2.1.x">28.1.2. <span class="navy">.Net Core 2.1.x</span></h4>
<div class="paragraph">
<p>The <em>.Net Core 2.1.x</em> template allows you to start developing an n-layer server application to provide the latest features. The template can be used in Visual Studio Code and Visiual Studio 2017.</p>
</div>
<div class="paragraph">
<p>The application result can be deployed as a console application, microservice or web page.</p>
</div>
<div class="paragraph">
<p>To start developing with OASP4Net template, please follow this instructions:</p>
</div>
<div class="sect5">
<h6 id="templates.asciidoc_navyusing-oasp4net-template"><span class="navy">Using OASP4Net template</span></h6>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Open your favourite terminal (Win/Linux/iOS)</p>
</li>
<li>
<p>Go to future project&#8217;s path</p>
</li>
<li>
<p>Type <em>dotnet new -i OASP4Net.WebAPI.Template</em></p>
</li>
<li>
<p>Type <em>dotnet new OASP4NetAPI</em></p>
</li>
<li>
<p>Go to project&#8217;s path</p>
</li>
<li>
<p>You are ready to start developing with <em>OASP4Net</em></p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect3">
<h4 id="templates.asciidoc_navylinks">28.1.3. <span class="navy">Links</span></h4>
<div class="paragraph">
<p><span class="icon"><i class="fa fa-= fa-floppy-o"></i></span>  <a href="https://github.com/oasp/oasp4net/tree/develop/Templates">.Net templates</a></p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="master-devon4net.asciidoc_samples">29. Samples</h2>
<div class="sectionbody">
<!-- toc disabled -->
<div class="sect2">
<h3 id="samples.asciidoc">29.1. <span class="navy">Samples</span></h3>
<div class="sect3">
<h4 id="samples.asciidoc_navymy-thai-star-restaurant">29.1.1. <span class="navy">My Thai Star Restaurant</span></h4>
<div class="paragraph">
<p><span class="icon"><i class="fa fa-= fa-floppy-o"></i></span>  <a href="#resources/samples/mts/MyThaiStar.zip">My Thai Star (.Net Core Server + Angular client)</a></p>
</div>
<div class="videoblock">
<div class="content">
<video src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/videos/mts_startup.mp4#t=0" width="640" autoplay controls>
Your browser does not support the video tag.
</video>
</div>
</div>
<div class="sect4">
<h5 id="samples.asciidoc_navyangular-requeriments"><span class="navy">Angular requeriments</span></h5>
<div class="ulist">
<ul>
<li>
<p><a href="https://nodejs.org/es/download/">Node</a></p>
</li>
<li>
<p><a href="https://cli.angular.io/">Angular CLI</a></p>
</li>
<li>
<p><a href="https://yarnpkg.com/lang/en/docs/install/">Yarn</a></p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="samples.asciidoc_navyangular-client"><span class="navy">Angular client</span></h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Install Node.js LTS version</p>
</li>
<li>
<p>Install Angular CLI from command line:</p>
<div class="ulist">
<ul>
<li>
<p>npm install -g @angular/cli</p>
</li>
</ul>
</div>
</li>
<li>
<p>Install Yarn</p>
</li>
<li>
<p>Go to Angular client from command line</p>
</li>
<li>
<p>Execute : <em>yarn install</em></p>
</li>
<li>
<p>Launch the app from command line: <em>ng serve</em> and check <em><a href="http://localhost:4200" class="bare">http://localhost:4200</a></em></p>
</li>
<li>
<p>You are ready</p>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="samples.asciidoc_navy.net-core-server"><span class="navy">.Net Core server</span></h5>
<div class="sect5">
<h6 id="samples.asciidoc_navybasic-architecture-details"><span class="navy">Basic architecture details</span></h6>
<div class="paragraph">
<p>Following the OASP conventions the .Net Core 2.0 My Thai Star backend is going to be developed dividing the application in <em>Components</em> and using a n-layer architecture.</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/project_modules.png"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/project_modules.png" alt="project modules"></a>
</div>
</div>
</div>
<div class="sect5">
<h6 id="samples.asciidoc_navycomponents"><span class="navy">Components</span></h6>
<div class="paragraph">
<p>The application is going to be divided in different components to encapsulate the different domains of the application functionalities.</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/mtsn_components.png"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/mtsn_components.png" alt="mtsn components"></a>
</div>
</div>
<div class="paragraph">
<p>As <em>main components</em> we will find:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>_BookingService: Manages the bookings part of the application. With this component the users (anonymous/logged in) can create new bookings or cancel an existing booking. The users with waiter role can see all scheduled bookings.</p>
</li>
<li>
<p><em>OrderService</em>: This component handles the process to order dishes (related to bookings). A user (as a host or as a guest) can create orders (that contain dishes) or cancel an existing one. The users with waiter role can see all ordered orders.</p>
</li>
<li>
<p><em>DishService</em>: This component groups the logic related to the menu (dishes) view. Its main feature is to provide the client with the data of the available dishes but also can be used by other components (Ordermanagement) as a data provider in some processes.</p>
</li>
<li>
<p><em>UserService</em>: Takes care of the User Profile management, allowing to create and update the data profiles.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>As <em>common components</em> (that don&#8217;t exactly represent an application&#8217;s area but provide functionalities that can be used by the <em>main components</em>):</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>Mailservice</em>: with this service we will provide the functionality for sending email notifications. This is a shared service between different app components such as <em>bookingmanagement</em> or <em>ordercomponent</em>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Other components:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Security (will manage the access to the <em>private</em> part of the application using a <a href="https://jwt.io/">jwt</a> implementation).</p>
</li>
<li>
<p>Twitter integration: planned as a <em>Microservice</em> will provide the twitter integration needed for some specific functionalities of the application.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect4">
<h5 id="samples.asciidoc_navylayers"><span class="navy">Layers</span></h5>
<div class="sect5">
<h6 id="samples.asciidoc_navyintroduction"><span class="navy">Introduction</span></h6>
<div class="paragraph">
<p>The .Net Core backend for My Thai Star application is going to be based on:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>OASP4NET</strong> as the .Net Core framework</p>
</li>
<li>
<p><strong>VSCode</strong> as the Development environment</p>
</li>
<li>
<p><strong>TOBAGO</strong> as code generation tool</p>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="samples.asciidoc_navyapplication-layer"><span class="navy">Application layer</span></h6>
<div class="paragraph">
<p>This layer will expose the REST api to exchange information with the client applications.</p>
</div>
<div class="paragraph">
<p>The application will expose the services on port 8081 and it can be lauches as a self host console application (microservice approach) and as a Web Api application hosted on IIS/IIS Express.</p>
</div>
</div>
<div class="sect5">
<h6 id="samples.asciidoc_navybusiness-layer"><span class="navy">Business layer</span></h6>
<div class="paragraph">
<p>This layer will define the controllers which will be used on the application layer to expose the different services. Also, will define the swagger contract making use of summary comments and framwork attributes.</p>
</div>
<div class="paragraph">
<p>This layer also includes the object response classes in order to interact with external clients.</p>
</div>
</div>
<div class="sect5">
<h6 id="samples.asciidoc_navyservice-layer"><span class="navy">Service layer</span></h6>
<div class="paragraph">
<p>The layer in charge of hosting the business logic of the application. Also orchestrates the object conversion between object response and entity objects defined in <em>Data layer</em>.</p>
</div>
</div>
<div class="sect5">
<h6 id="samples.asciidoc_navydata-layer"><span class="navy">Data layer</span></h6>
<div class="paragraph">
<p>The layer to communicate with the data base.</p>
</div>
<div class="paragraph">
<p>Data layer makes use of <em>Entity Framework</em>.
The Database context is defined on <em>DataAccessLayer</em> assembly (ModelContext).</p>
</div>
<div class="paragraph">
<p>In this layer will make use of the <em>Repository patter</em> and <em>Unit of work</em> in order to encapsulte the complexibility. Making use of this combined patters we ensure an organized a common and easy work model.</p>
</div>
<div class="paragraph">
<p>As in the previous layers, the <em>data access</em> layer will have both <em>interface</em> and <em>implementation</em> tiers. However, in this case, the implementation will be slightly different due to the use of <em>generics</em>.</p>
</div>
</div>
<div class="sect5">
<h6 id="samples.asciidoc_navycross-cutting-concerns"><span class="navy">Cross-Cutting concerns</span></h6>
<div class="paragraph">
<p>the layer to make use of transversal components such JWT and mailing.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="samples.asciidoc_navyjwt-basics"><span class="navy">Jwt basics</span></h5>
<div class="ulist">
<ul>
<li>
<p>A user will provide a username / password combination to our auth server.</p>
</li>
<li>
<p>The auth server will try to identify the user and, if the credentials match, will issue a token.</p>
</li>
<li>
<p>The user will send the token as the <em>Authorization</em> header to access resources on server protected by JWT Authentication.</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/jwt_schema.png"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/jwt_schema.png" alt="jwt schema"></a>
</div>
</div>
</div>
<div class="sect4">
<h5 id="samples.asciidoc_navyjwt-implementation-details"><span class="navy">Jwt implementation details</span></h5>
<div class="paragraph">
<p>The <em>Json Web Token</em> pattern will be implemented based on the <a href="https://blogs.msdn.microsoft.com/webdev/2017/04/06/jwt-validation-and-authorization-in-asp-net-core/"><em>jwt on .net core</em></a> framework that is provided by default in the <em>Oasp4Net</em> projects.</p>
</div>
</div>
<div class="sect4">
<h5 id="samples.asciidoc_navyauthentication"><span class="navy">Authentication</span></h5>
<div class="paragraph">
<p>Based on <em>Microsoft</em> approach, we will implement a class to define the security <em>entry point</em> and filters. Also, as <em>My Thai Star</em> is a mainly <em>public</em> application, we will define here the resources that won&#8217;t be secured.</p>
</div>
<div class="paragraph">
<p>On Oasp4Net.Infrastructure.JWT assembly is defined a subset of <em>Microsfot&#8217;s authorization schema</em> Database. It is started up the first time the application launches.</p>
</div>
<div class="paragraph">
<p>YOu can read more about _Authorization on:</p>
</div>
<div class="paragraph">
<p><a href="https://docs.microsoft.com/en-us/aspnet/core/security/authorization/">Authorization in ASP.NET Core</a></p>
</div>
<div class="paragraph">
<p><a href="https://docs.microsoft.com/en-us/aspnet/core/security/authorization/claims">Claim based authorization</a></p>
</div>
</div>
<div class="sect4">
<h5 id="samples.asciidoc_navydependency-injection"><span class="navy">Dependency injection</span></h5>
<div class="paragraph">
<p>As it is explained in the <a href="https://docs.microsoft.com/en-us/aspnet/core/fundamentals/dependency-injection">Microsoft documentation</a> we are going to implement the <em>dependency injection</em> pattern basing our solution on <em>.Net Core</em>.</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/dependency_injection.png"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/dependency_injection.png" alt="dependency injection"></a>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Separation of API and implementation: Inside each layer we will separate the elements in different tiers: <em>interface</em> and <em>implementation</em>. The <em>interface</em> tier will store the <em>interface</em> with the methods definition and inside the <em>implementation</em> we will store the class that implements the <em>interface</em>.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="samples.asciidoc_navylayer-communication-method"><span class="navy">Layer communication method</span></h5>
<div class="paragraph">
<p>The connection between layers, to access to the functionalities of each one, will be solved using the <em>dependency injection</em>.</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/layer_impl.png"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/layer_impl.png" alt="layer impl"></a>
</div>
</div>
<div class="paragraph">
<p><strong>Connection BookingService - Logic</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c# hljs" data-lang="c#"> public class BookingService : EntityService&lt;Booking&gt;, IBookingService
    {
        private readonly IBookingRepository _bookingRepository;
        private readonly IRepository&lt;Order&gt; _orderRepository;
        private readonly IRepository&lt;InvitedGuest&gt; _invitedGuestRepository;
        private readonly IOrderLineRepository _orderLineRepository;
        private readonly IUnitOfWork _unitOfWork;

        public BookingService(IUnitOfWork unitOfWork,
            IBookingRepository repository,
            IRepository&lt;Order&gt; orderRepository,
            IRepository&lt;InvitedGuest&gt; invitedGuestRepository,
            IOrderLineRepository orderLineRepository) : base(unitOfWork, repository)
        {
            _unitOfWork = unitOfWork;
            _bookingRepository = repository;
            _orderRepository = orderRepository;
            _invitedGuestRepository = invitedGuestRepository;
            _orderLineRepository = orderLineRepository;
        }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>To give service to the defined <em>User Stories</em> we will need to implement the following services:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>provide all available dishes.</p>
</li>
<li>
<p>save a booking.</p>
</li>
<li>
<p>save an order.</p>
</li>
<li>
<p>provide a list of bookings (only for waiters) and allow filtering.</p>
</li>
<li>
<p>provide a list of orders (only for waiters) and allow filtering.</p>
</li>
<li>
<p>login service (see the <em>Security</em> section).</p>
</li>
<li>
<p>provide the <em>current user</em> data (see the <em>Security</em> section)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Following the [naming conventions] proposed for <em>Oasp4Net</em> applications we will define the following <em>end points</em> for the listed services.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>(POST) <code>/mythaistar/services/rest/dishmanagement/v1/dish/search</code>.</p>
</li>
<li>
<p>(POST) <code>/mythaistar/services/rest/bookingmanagement/v1/booking</code>.</p>
</li>
<li>
<p>(POST) <code>/mythaistar/services/rest/ordermanagement/v1/order</code>.</p>
</li>
<li>
<p>(POST) <code>/mythaistar/services/rest/bookingmanagement/v1/booking/search</code>.</p>
</li>
<li>
<p>(POST) <code>/mythaistar/services/rest/ordermanagement/v1/order/search</code>.</p>
</li>
<li>
<p>(POST) <code>/mythaistar/services/rest/ordermanagement/v1/order/filter</code> (to filter with fields that does not belong to the Order entity).</p>
</li>
<li>
<p>(POST) <code>/mythaistar/login</code>.</p>
</li>
<li>
<p>(GET) <code>/mythaistar/services/rest/security/v1/currentuser/</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can find all the details for the services implementation in the <a href="https://github.com/oasp/my-thai-star/blob/develop/swagger/mythaistar.yaml">Swagger definition</a> included in the My Thai Star project on Github.</p>
</div>
</div>
<div class="sect4">
<h5 id="samples.asciidoc_navyapi-exposed"><span class="navy">Api Exposed</span></h5>
<div class="paragraph">
<p>The <em>Oasp4Net.Business.Controller</em> assembly in the <em>business</em> layer of a <em>component</em> will store the definition of the service by a  <em>interface</em>. In this definition of the service we will set-up the <em>endpoints</em> of the service, the type of data expected and returned, the <em>HTTP</em> method for each endpoint of the service and other configurations if needed.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c# hljs" data-lang="c#">        /// &lt;summary&gt;
        /// Method to make a reservation with potentiel guests. The method returns the reservation token with the format: {(CB_|GB_)}{now.Year}{now.Month:00}{now.Day:00}{_}{MD5({Host/Guest-email}{now.Year}{now.Month:00}{now.Day:00}{now.Hour:00}{now.Minute:00}{now.Second:00})}
        /// &lt;/summary&gt;

        /// &lt;param name="bookingView"&gt;&lt;/param&gt;
        /// &lt;response code="201"&gt;Ok.&lt;/response&gt;
        /// &lt;response code="400"&gt;Bad request. Parser data error.&lt;/response&gt;
        /// &lt;response code="401"&gt;Unathorized. Autentication fail&lt;/response&gt;
        /// &lt;response code="403"&gt;Forbidden. Authorization error.&lt;/response&gt;
        /// &lt;response code="500"&gt;Internal Server Error. The search process ended with error.&lt;/response&gt;
        [HttpPost]
        [HttpOptions]
        [Route("/mythaistar/services/rest/bookingmanagement/v1/booking")]
        [AllowAnonymous]
        [EnableCors("CorsPolicy")]
        public IActionResult BookingBooking([FromBody]BookingView bookingView)
        {
...</code></pre>
</div>
</div>
<div class="paragraph">
<p>Using the summary anotations and attributes will tell to swagger the contract via the XML doc generated on compiling time. This doc will be stored in <em>XmlDocumentation</em> folder.</p>
</div>
<div class="paragraph">
<p>The Api methods will be exposed on the application layer.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="samples.asciidoc_navygoogle-mail-api-consumer">29.1.2. <span class="navy">Google Mail API Consumer</span></h4>
<div class="paragraph">
<p><span class="icon"><i class="fa fa-= fa-floppy-o"></i></span>  <a href="#resources/samples/components/GMailAPIConsumer.zip">Google Mail API Consumer</a></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Application</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">MyThaiStarEmailService.exe</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Config file</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">MyThaiStarEmailService.exe.Config</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Default port</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8080</p></td>
</tr>
</tbody>
</table>
<div class="sect4">
<h5 id="samples.asciidoc_navyoverview"><span class="navy">Overview</span></h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Execute MyThaiStarEmailService.exe.</p>
</li>
<li>
<p>The first time google will ask you for credentials
(just one time) in your default browser:</p>
<div class="ulist">
<ul>
<li>
<p>Account: <a href="mailto:mythaistarrestaurant@gmail.com">mythaistarrestaurant@gmail.com</a></p>
</li>
<li>
<p>Password: mythaistarrestaurant2501</p>
</li>
</ul>
</div>
</li>
<li>
<p>Visit the url: <a href="http://localhost:8080/swagger" class="bare">http://localhost:8080/swagger</a></p>
</li>
<li>
<p>Your server is ready!</p>
</li>
</ol>
</div>
<div id="samples.asciidoc_img-t-architecture" class="imageblock">
<div class="content">
<a class="image" href="images/email_swagger.png"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/email_swagger.png" alt="GMail Service" width="820"></a>
</div>
<div class="title">Figure 80. GMail Server Swager contract page</div>
</div>
</div>
<div class="sect4">
<h5 id="samples.asciidoc_navyjson-example"><span class="navy">JSON Example</span></h5>
<div class="paragraph">
<p>This is the JSON example to test with swagger client. Please read the swagger documentation.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
   "EmailFrom":"mythaistarrestaurant@gmail.com",
   "EmailAndTokenTo":{
      "MD5Token1":" Email_Here!@gmail.com",
      "MD5Token2":" Email_Here!@gmail.com"
   },
   "EmailType":0,
   "DetailMenu":[
      "Thai Spicy Basil Fried Rice x2",
      "Thai green chicken curry x2"
   ],
   "BookingDate":"2017-05-31T12:53:39.7864723+02:00",
   "Assistants":2,
   "BookingToken":"MD5Booking",
   "Price":20.0,
   "ButtonActionList":{
      "http://accept.url":"Accept",
      "http://cancel.url":"Cancel"
   },
   "Host":{
      " Email_Here!@gmail.com":"José Manuel"
   }
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="samples.asciidoc_navyconfigure-the-service-port"><span class="navy">Configure the service port</span></h5>
<div class="paragraph">
<p>If you want to change the default port, please edit the config file and
change the next entry in appSettings node:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;appSettings&gt;
   &lt;add key="LocalListenPort" value="8080" /&gt;
&lt;/appSettings&gt;</code></pre>
</div>
</div>
<div class="sect5">
<h6 id="samples.asciidoc_navyexternal-links"><span class="navy">External links</span></h6>
<div class="paragraph">
<p><a href="https://console.developers.google.com/flows/enableapi?apiid=gmail">Google API Account Configuration</a></p>
</div>
<div class="paragraph">
<p><a href="https://developers.google.com/gmail/api/auth/scopes">About Scopes</a></p>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="samples.asciidoc_navydownloads">29.1.3. <span class="navy">Downloads</span></h4>
<div class="paragraph">
<p><span class="icon"><i class="fa fa-= fa-floppy-o"></i></span>  <a href="https://github.com/oasp/my-thai-star/tree/develop/net">My Thai Star (.Net Core Server + Angular client)</a></p>
</div>
<div class="paragraph">
<p><span class="icon"><i class="fa fa-= fa-floppy-o"></i></span>  <a href="https://github.com/oasp/oasp4net/tree/pre/Samples">Google Mail API Consumer</a></p>
</div>
</div>
</div>
</div>
</div>
<h1 id="master-devonfw-shop-floor.asciidoc" class="sect0">VI: devonfw shop floor</h1>
<div class="sect1">
<h2 id="Home.asciidoc">30. What is devonfw shop floor?</h2>
<div class="sectionbody">
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/devonfw-shop-floor.jpg" alt="devonfw shop floor">
</div>
</div>
<div class="paragraph">
<p>devonfw shop floor is a platform to industrialize continuous delivery and continuous integration processes.</p>
</div>
<div class="paragraph">
<p>devonfw shop floor is a set of documentation, tools and methodologies used to configure the provisioning, development and uat environments used in your projects. devonfw shop floor allows the administrators of those environments to apply CI/CD operations and enables automated application deployment.</p>
</div>
<div class="paragraph">
<p>devonfw shop floor is mainly oriented to configure the provisioning environment provided by Production Line and deploy applications on an OpenShift cluster. In the cases where Production Line or OpenShift cluster are not available, there will be alternatives to achieve similar goals.</p>
</div>
<div class="paragraph">
<p>The <strong>devonfw shop floor 4 OpenShift</strong> is a solution based on the experience of priming devonfw for OpenShift by RedHat.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/dsf4openshift/primed.jpg" alt="primed">
</div>
</div>
<div class="paragraph">
<p><a href="#dsf-how-to-use.asciidoc">Let&#8217;s start</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="dsf-how-to-use.asciidoc">31. How to use it</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This is the documentation about shop floor and its different tools. Here you are going to learn how to create new projects, so that they can include continuous integration and continuous delivery processes, and be deployed automatically in different environments.</p>
</div>
<div class="sect2">
<h3 id="dsf-how-to-use.asciidoc_prerequisites---provisioning-environment">31.1. Prerequisites - Provisioning environment</h3>
<div class="paragraph">
<p>To start working you need to have some services running in your provisioning environment, such as Jenkins (automation server), GitLab (git repository), SonarQube (program analysis), Nexus (software repository) or similar.</p>
</div>
<div class="paragraph">
<p>To host those services we recommend to have a Production Line instance but you can use other platforms. Here is the list for the different options:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#dsf-provisioning-production-line.asciidoc">Production Line</a>.</p>
</li>
<li>
<p><a href="#dsf-provisioning-dsf4docker.asciidoc">dsf4docker</a>.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="dsf-how-to-use.asciidoc_step-1---configuration-and-services-integration">31.2. Step 1 - Configuration and services integration</h3>
<div class="paragraph">
<p>The first step is configuring your services and integrate them with jenkins. Here you have an example about how to manually configure the next services:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#dsf-configure-nexus.asciidoc">Nexus</a>.</p>
</li>
<li>
<p><a href="#dsf-configure-sonarqube.asciidoc">SonarQube</a>.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="dsf-how-to-use.asciidoc_step-2---create-the-project">31.3. Step 2 - Create the project</h3>
<div class="sect3">
<h4 id="dsf-how-to-use.asciidoc_create-and-integrate-git-repository">31.3.1. Create and integrate git repository</h4>
<div class="paragraph">
<p>The second is create or git repository and integrate it with Jenkins.</p>
</div>
<div class="paragraph">
<p>Here you can find a manual guide about how it:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#dsf-configure-gitlab.asciidoc">GitLab</a> new project.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="dsf-how-to-use.asciidoc_start-new-devonfw-project">31.3.2. Start new devonfw project</h4>
<div class="paragraph">
<p>It is time to create your devonfw project:</p>
</div>
<div class="paragraph">
<p>You can find all that you need about how to create a <a href="#dsf-create-new-devonfw-project.asciidoc">new devonfw project</a></p>
</div>
</div>
<div class="sect3">
<h4 id="dsf-how-to-use.asciidoc_cicd-configuration">31.3.3. cicd configuration</h4>
<div class="paragraph">
<p>Now you need to add cicd files in your project.</p>
</div>
<div class="sect4">
<h5 id="dsf-how-to-use.asciidoc_manual-configuration">Manual configuration</h5>
<div class="sect5">
<h6 id="dsf-how-to-use.asciidoc_jenkinsfile">Jenkinsfile</h6>
<div class="paragraph">
<p>Here you can find all that you need to know to do your <a href="#dsf-configure-jenkinsfile.asciidoc">Jenkinsfile</a>.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="dsf-how-to-use.asciidoc_dockerfile">Dockerfile</h5>
<div class="paragraph">
<p>Here you can find all that you need to know to do your <a href="#dsf-configure-dockerfile.asciidoc">Dockerfile</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="dsf-how-to-use.asciidoc_automatic-configuration">Automatic configuration</h5>
<div class="sect5">
<h6 id="dsf-how-to-use.asciidoc_cicdgen">cicdgen</h6>
<div class="paragraph">
<p>If you are using production line for provisioning you could use cicdgen to configure automatically almost everything explained in the manual configuration. To do it see the <a href="https://github.com/devonfw/cicdgen/wiki">cicdgen</a> documentation.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="dsf-how-to-use.asciidoc_step-3---deployment">31.4. Step 3 - Deployment</h3>
<div class="paragraph">
<p>The third is configure our deployment environment. Here is the list for the different options:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#dsf-deployment-dsf4openshift.asciidoc">dsf4openshift</a>.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="dsf-how-to-use.asciidoc_step-4---monitoring">31.5. Step 4 - Monitoring</h3>
<div class="paragraph">
<p>Here you can find information about tools for monitoring:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#dsf-configure-jenkins-build-monitor-view.asciidoc">build monitor view</a> for Jenkins. With this tool you will be able to see in real time what is the state of your Jenkins pipelines.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="master-devonfw-shop-floor.asciidoc_provisioning-environments">32. Provisioning environments</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="dsf-provisioning-production-line.asciidoc">32.1. Production Line provisioning environment</h3>
<div class="paragraph">
<p><span class="image"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/dsf4pl/pl.png" alt="pl"></span></p>
</div>
<div class="paragraph">
<p>The Production Line Project is a set of server-side collaboration tools for Capgemini engagements. It has been developed for supporting project engagements with individual tools like issue tracking, continuous integration, continuous deployment, documentation, binary storage and much more!</p>
</div>
<div class="paragraph">
<p>For additional information use the <a href="https://km3.capgemini.com/community/1042857/home">official documentation</a>.</p>
</div>
<div class="sect3">
<h4 id="dsf-provisioning-production-line.asciidoc_how-to-obtain-your-production-line">32.1.1. How to obtain your Production Line</h4>
<div class="paragraph">
<p>You can order your Production Line environment instance following the <a href="https://km3.capgemini.com/book/1082360">official guide</a>. Remember that you need to order at least the next tools:
 * Jenkins
 * GitLab
 * SonarQube
 * Nexus</p>
</div>
<hr>
<div class="paragraph">
<p><a href="dsf-how-to-use.html#Step-1---Configuration-and-services-integration">Back</a>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="dsf-provisioning-dsf4docker.asciidoc">32.2. dsf4docker provisioning environment</h3>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/dsf4docker/docker.png" alt="docker">
</div>
</div>
<div class="sect3">
<h4 id="dsf-provisioning-dsf4docker.asciidoc_architecture-overview">32.2.1. Architecture overview</h4>
<div class="paragraph">
<p><span class="image"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/dsf4docker/dsf-docker-arch.png" alt="dsf docker arch"></span></p>
</div>
</div>
<div class="sect3">
<h4 id="dsf-provisioning-dsf4docker.asciidoc_prerequisite">32.2.2. Prerequisite</h4>
<div class="paragraph">
<p>To use dsf4docker provisioning environment you need a remote server and you must clone or download devonfw shop floor.</p>
</div>
</div>
<div class="sect3">
<h4 id="dsf-provisioning-dsf4docker.asciidoc_how-to-use-it">32.2.3. How to use it</h4>
<div class="paragraph">
<p>Navigate to <code>./devonfw-shop-floor/dsf4docker/environment</code> and here you can find one scripts to install it, and another one to uninstall it.</p>
</div>
<div class="sect4">
<h5 id="dsf-provisioning-dsf4docker.asciidoc_install-devonfw-shop-floor-4-docker">Install devonfw shop floor 4 Docker</h5>
<div class="paragraph">
<p>There is an installation script to do so, so the complete installation should be completed by running it. Make sure this script has execution permissions in the Docker Host:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash"># chmod +x dsf4docker-install.sh
# sudo ./dsf4docker-install.sh</code></pre>
</div>
</div>
<div class="paragraph">
<p>This script, besides the container "installation" itself, will also adapt the <code>docker-compose.yml</code> file to your host (using <code>sed</code> to replace the <strong>IP_ADDRESS</strong> word of the file for your real Docker Host&#8217;s IP address).</p>
</div>
</div>
<div class="sect4">
<h5 id="dsf-provisioning-dsf4docker.asciidoc_uninstall-devonfw-shop-floor-4-docker">Uninstall devonfw shop floor 4 Docker</h5>
<div class="paragraph">
<p>As well as for the installation, if we want to remove everything concerning <strong>devonfw shop floor 4 Docker</strong> from our Docker Host, we&#8217;ll run this script:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash"># chmod +x dsf4docker-uninstall.sh
# sudo ./dsf4docker-uninstall.sh</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="dsf-provisioning-dsf4docker.asciidoc_a-little-history">32.2.4. A little history</h4>
<div class="paragraph">
<p>The <strong>Docker</strong> part of the shop floor is created based on the experience of the environment setup of the project <strong>Mirabaud Advisory</strong>, and intended to be updated to latest versions. Mirabaud Advisory is a web service developed with devonfw (Java) that, alongside its own implementation, it needed an environment both for the team to follow CICD rules through their 1-week-long sprints and for the client (Mirabaud) to check the already done work.</p>
</div>
<div class="paragraph">
<p>There is a practical experience about the <a href="#dsf-mirabaud-cicd-environment-setup.asciidoc">Mirabaud Case</a>.</p>
</div>
<hr>
<div class="paragraph">
<p><a href="dsf-how-to-use.html#Step-1---Configuration-and-services-integration">Back</a>.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="master-devonfw-shop-floor.asciidoc_configuration-and-services-integration">33. Configuration and services integration</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="dsf-configure-nexus.asciidoc">33.1. Nexus Configuration</h3>
<div class="paragraph">
<p>In this document you will see how you can configure Nexus repository and how to integrate it with jenkins.</p>
</div>
<div class="sect3">
<h4 id="dsf-configure-nexus.asciidoc_prerequisites">33.1.1. Prerequisites</h4>
<div class="sect4">
<h5 id="dsf-configure-nexus.asciidoc_repositories">Repositories</h5>
<div class="paragraph">
<p>You need to have one repository for snapshots, another for releases and another one for release-candidates. Normally you use maven2 (hosted) repositories and if you are going to use a docker registry, you need docker (hosted) too.</p>
</div>
<div class="paragraph">
<p>To create a repository in Nexus go to the administration clicking on the gear icon at top menu bar. Then on the left menu click on Repositories and press the <strong><em>Create repository</em></strong> button.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/configuration/nexus-create-repository.png" alt="nexus create repository">
</div>
</div>
<div class="paragraph">
<p>Now you must choose the type of the repository and configure it. This is an example for Snapshot:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/configuration/nexus-create-repository-form.png" alt="nexus create repository form">
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="dsf-configure-nexus.asciidoc_create-user-to-uploaddownload-content">33.1.2. Create user to upload/download content</h4>
<div class="paragraph">
<p>Once you have the repositories, you need a user to upload/download content. To do it go to the administration clicking on the gear icon at top menu bar. Then on the left menu click on Users and press the <strong><em>Create local</em></strong> user button.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/configuration/nexus-create-user.png" alt="nexus create user">
</div>
</div>
<div class="paragraph">
<p>Now you need to fill a form like this:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/configuration/nexus-create-user-form.png" alt="nexus create user form">
</div>
</div>
</div>
<div class="sect3">
<h4 id="dsf-configure-nexus.asciidoc_jenkins-integration">33.1.3. Jenkins integration</h4>
<div class="paragraph">
<p>To use Nexus in our pipelines you need to configure Jenkins.</p>
</div>
<div class="sect4">
<h5 id="dsf-configure-nexus.asciidoc_add-nexus-user-credentials">Add nexus user credentials</h5>
<div class="paragraph">
<p>First of all you need to add the user created in the step before to Jenkins. To do it (on the left menu) click on Credentials, then on System. Now you could access to <strong><em>Global credentials (unrestricted)</em></strong>.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/configuration/nexus-jenkins-credentials.png" alt="nexus jenkins credentials">
</div>
</div>
<div class="paragraph">
<p>Enter on it and you could see a button on the left to <strong><em>Add credentials</em></strong>. Click on it and fill a form like this:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/configuration/nexus-jenkins-credentials-form.png" alt="nexus jenkins credentials form">
</div>
</div>
</div>
<div class="sect4">
<h5 id="dsf-configure-nexus.asciidoc_add-the-nexus-user-to-maven-global-settings">Add the nexus user to maven global settings</h5>
<div class="paragraph">
<p>Now you need to go to Manage Jenkins clicking on left menu and enter in <strong><em>Managed files</em></strong>.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/configuration/jenkins-global-maven.png" alt="jenkins global maven">
</div>
</div>
<div class="paragraph">
<p>Edit the Global Maven settings.xml to add your nexus repositories credentials as you could see in the next image:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/configuration/nexus-jenkins-global-maven-form.png" alt="nexus jenkins global maven form">
</div>
</div>
<div class="paragraph">
<p>And you are done.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="dsf-configure-sonarqube.asciidoc">33.2. SonarQube Configuration</h3>
<div class="paragraph">
<p>To use SonarQube you need to use a token to connect, and to know the results of the analysis you need a webhook. Also, you need to install and configure SonarQube in Jenkins.</p>
</div>
<div class="sect3">
<h4 id="dsf-configure-sonarqube.asciidoc_generate-user-token">33.2.1. Generate user token</h4>
<div class="paragraph">
<p>To generate the user token, go to your account clicking in the left icon on the top menu bar.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/configuration/sonarqube-administration.png" alt="sonarqube administration">
</div>
</div>
<div class="paragraph">
<p>Go to security tab and generate the token.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/configuration/sonarqube-token.png" alt="sonarqube token">
</div>
</div>
</div>
<div class="sect3">
<h4 id="dsf-configure-sonarqube.asciidoc_webhook">33.2.2. Webhook</h4>
<div class="paragraph">
<p>When you execute our SonarQube scanner in our pipeline job, you need to ask SonarQube if the quality gate has been passed. To do it you need to create a webhook.</p>
</div>
<div class="paragraph">
<p>Go to administration clicking the option on the top bar menu and select the tab for Configuration.</p>
</div>
<div class="paragraph">
<p>Then search in the left menu to go to webhook section and create your webhook.</p>
</div>
<div class="paragraph">
<p>An example for Production Line:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/configuration/sonarqube-webhook.png" alt="sonarqube webhook">
</div>
</div>
</div>
<div class="sect3">
<h4 id="dsf-configure-sonarqube.asciidoc_jenkins-integration">33.2.3. Jenkins integration</h4>
<div class="paragraph">
<p>To use SonarQube in our pipelines you need to configure Jenkins to integrate SonarQube.</p>
</div>
<div class="sect4">
<h5 id="dsf-configure-sonarqube.asciidoc_sonarqube-scanner">SonarQube Scanner</h5>
<div class="paragraph">
<p>First, you need to configure the scanner. Go to Manage Jenkins clicking on left menu and enter in <strong><em>Global Tool Configuration</em></strong>.</p>
</div>
<div class="paragraph">
<p>Go to SonarQube Scanner section and add a new SonarQube scanner like this.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/configuration/sonarqube-jenkins-scanner.png" alt="sonarqube jenkins scanner">
</div>
</div>
</div>
<div class="sect4">
<h5 id="dsf-configure-sonarqube.asciidoc_sonarqube-server">SonarQube Server</h5>
<div class="paragraph">
<p>Now you need to configure where is our SonarQube server using the user token that you create before. Go to Manage Jenkins clicking on left menu and enter in <strong><em>Configure System</em></strong>.</p>
</div>
<div class="paragraph">
<p>For example, in Production Line the server is the next:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/configuration/sonarqube-jenkins-server.png" alt="sonarqube jenkins server">
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Remember, the token was created at the beginning  of this SonarQube configuration.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="dsf-configure-sonarqube.asciidoc_sonarqube-configuration">33.2.4. SonarQube configuration</h4>
<div class="paragraph">
<p>Now is time to configure your sonar in order to check correctly the quality of the project. To do it, please follow the official documentation about our plugins and Quality Gates and Profiles <a href="https://github.com/devonfw/sonar-devon-plugin">here</a>.</p>
</div>
<div class="sect4">
<h5 id="dsf-configure-sonarqube.asciidoc_how-to-ignore-files">How to ignore files</h5>
<div class="paragraph">
<p>Normaly the developers needs to ignore some files from Sonar analysis. To do it, they must add the next line as a parameter of the sonar execution to their Jenkinsfile in the SonarQube code analysis step.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>-Dsonar.exclusions='**/*.spec.ts, **/*.model.ts, **/*mock.ts'</pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="master-devonfw-shop-floor.asciidoc_create-project">34. Create project</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="master-devonfw-shop-floor.asciidoc_create-and-integrate-git-repository">34.1. Create and integrate git repository</h3>
<div class="sect3">
<h4 id="dsf-configure-gitlab.asciidoc">34.1.1. GitLab Configuration</h4>
<div class="sect4">
<h5 id="dsf-configure-gitlab.asciidoc_create-new-repository">Create new repository</h5>
<div class="paragraph">
<p>To create a new project in GitLab, go to your dashboard and click the green <em>New project</em> button or use the plus icon in the navigation bar.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/configuration/gitlab-new-prject.jpg" alt="gitlab new prject">
</div>
</div>
<div class="paragraph">
<p>This opens the New project page. Choose your group and fill the name of your project, the description and the visibility level in the next form:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/configuration/gitlab-new-prject-form.jpg" alt="gitlab new prject form">
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
more information about how to create projects in <a href="https://docs.gitlab.com/ee/gitlab-basics/create-project.html">GitLab in the official documentation</a>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="dsf-configure-gitlab.asciidoc_service-integration">Service integration</h5>
<div class="paragraph">
<p>To learn how to configure the integration between GitLab and Jenkins see the next <a href="#dsf-mirabaud-jenkins-gitLab-integration.asciidoc">example</a></p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="master-devonfw-shop-floor.asciidoc_start-new-devonfw-project">34.2. start new devonfw project</h3>
<div class="paragraph">
<p>It is time to create your devonfw project:</p>
</div>
<div class="sect3">
<h4 id="dsf-create-new-devonfw-project.asciidoc">34.2.1. How to create new devonfw project</h4>
<div class="paragraph">
<p>Here you can find the official guides to start new devonfw projects:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>visit our <a href="https://github.com/devonfw/devonfw-tutorial-sources/wiki/build-devon4ng-application">devon4ng</a> guide.</p>
</li>
<li>
<p>visit our <a href="https://github.com/devonfw/devonfw-tutorial-sources/wiki/build-devon4j-application">devon4j</a> guide.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="master-devonfw-shop-floor.asciidoc_cicd-configuration">34.3. cicd configuration</h3>
<div class="sect3">
<h4 id="master-devonfw-shop-floor.asciidoc_manual-configuration">34.3.1. Manual configuration</h4>
<div class="sect4">
<h5 id="dsf-configure-jenkinsfile.asciidoc">Jenkinsfile</h5>
<div class="sect5">
<h6 id="dsf-configure-jenkinsfile.asciidoc_introduction">Introduction</h6>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/configuration/jenkinsfile-cicd-activity-diagram.jpg" alt="jenkinsfile cicd activity diagram">
</div>
</div>
<div class="paragraph">
<p>Here you are going to learn how you should configure the jenkinsfile of your project to apply CI/CD operations and enables automated application deployment.</p>
</div>
<div class="paragraph">
<p>Here you can find examples of the Jenkinsfile generated by cicdgen:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://raw.githubusercontent.com/devonfw/cicdgen/develop/schematics/src/devon4j/files/Jenkinsfile">devon4j</a></p>
</li>
<li>
<p><a href="https://raw.githubusercontent.com/devonfw/cicdgen/develop/schematics/src/devon4ng/files/Jenkinsfile">devon4ng</a></p>
</li>
<li>
<p><a href="https://raw.githubusercontent.com/devonfw/cicdgen/develop/schematics/src/devon4node/files/Jenkinsfile">devon4node</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Next you could find an explanation about what is done in these Jenkinsfiles.</p>
</div>
</div>
<div class="sect5">
<h6 id="dsf-configure-jenkinsfile.asciidoc_environment-values">Environment values</h6>
<div class="paragraph">
<p>At the top of the pipeline you should add the environment variables. in this tutorial you need the next variables:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>    // sonarQube
    // Name of the sonarQube tool
    sonarTool = 'SonarQube'
    // Name of the sonarQube environment
    sonarEnv = "SonarQube"

    // Nexus
    // Artifact groupId
    groupId = '&lt;%= groupid %&gt;'
    // Nexus repository ID
    repositoryId = 'pl-nexus'
    // Nexus internal URL
    repositoryUrl = 'http://nexus3-core:8081/nexus3/repository/'
    // Maven global settings configuration ID
    globalSettingsId = 'MavenSettings'
    // Maven tool id
    mavenInstallation = 'Maven3'

    // Docker registry
    dockerRegistry = 'docker-registry-&lt;%= plurl %&gt;'
    dockerRegistryCredentials = 'nexus-docker'
    dockerTool = 'docker-global'

    // OpenShift
    openshiftUrl = '&lt;%= ocurl %&gt;'
    openShiftCredentials = 'openshift'
    openShiftNamespace = '&lt;%= ocn %&gt;'</pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="dsf-configure-jenkinsfile.asciidoc_stages">Stages</h6>
<div class="paragraph">
<p>The pipeline consists of stages, and at the beginning of each stage it is declared for which branches the step will be executed.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/configuration/jenkinsfile-stages.jpg" alt="jenkinsfile stages">
</div>
</div>
<div class="paragraph">
<p>Now it is time to create the stages.</p>
</div>
<div class="sect6">
<h7 id="dsf-configure-jenkinsfile.asciidoc_setup-jenkins-tools">Setup Jenkins tools</h7>
<div class="paragraph">
<p>The first stage is one of the most dangerous, because in it on one hand the tools are added to the pipeline and to the path and on other hand the values are tagged depending on the branch that is being executed. If you are going to create a ci/cd for a new branch or you are going to modify something, be very careful with everything that this first step declares.</p>
</div>
<div class="paragraph">
<p>This is an example of this stage:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>script {
    tool yarn
    tool Chrome-stable
    tool dockerTool

    if (env.BRANCH_NAME.startsWith('release')) {
        dockerTag = "release"
        repositoryName = 'maven-releases'
        dockerEnvironment = "_uat"
        openShiftNamespace += "-uat"
        sonarProjectKey = '-release'
    }

    if (env.BRANCH_NAME == 'develop') {
        dockerTag = "latest"
        repositoryName = 'maven-snapshots'
        dockerEnvironment = "_dev"
        openShiftNamespace += "-dev"
        sonarProjectKey = '-develop'
    }

    if (env.BRANCH_NAME == 'master') {
        dockerTag = "production"
        repositoryName = 'maven-releases'
        dockerEnvironment = '_prod'
        openShiftNamespace += "-prod"
        sonarProjectKey = ''
    }

    sh "yarn"
}</pre>
</div>
</div>
</div>
<div class="sect6">
<h7 id="dsf-configure-jenkinsfile.asciidoc_code-lint-analysis">Code lint analysis</h7>
<div class="paragraph">
<p>The next stage is to analyze the code making a lint analysis. To do it your project should have a tslint file with the configuration (<em>tslint.json</em>).</p>
</div>
<div class="paragraph">
<p>analyzing the code in your pipeline is as simple as executing the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>sh """yarn lint"""</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Your project need to have an script with tslint configuration (<em>tslint.json</em>).
</td>
</tr>
</table>
</div>
</div>
<div class="sect6">
<h7 id="dsf-configure-jenkinsfile.asciidoc_execute-tests">Execute tests</h7>
<div class="paragraph">
<p>To test you application first of all your application should have created the tests and you should use one of the next two options:</p>
</div>
<div class="paragraph">
<p><strong>Execute test with maven</strong> (It should be used by devon4j).</p>
</div>
<div class="listingblock">
<div class="content">
<pre>withMaven(globalMavenSettingsConfig: globalSettingsId, maven: mavenInstallation) {
    sh "mvn clean test"
}</pre>
</div>
</div>
<div class="paragraph">
<p><strong>Execute test with yarn</strong> (It should be used by devon4ng or devon4node).</p>
</div>
<div class="listingblock">
<div class="content">
<pre>sh """yarn test:ci"""</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Remember that your project should have the tests created and in case of do it with yarn or npm, you package.json should have the script declared. This is an example <code>"test:ci": "ng test --browsers ChromeHeadless --watch=false"</code>.
</td>
</tr>
</table>
</div>
</div>
<div class="sect6">
<h7 id="dsf-configure-jenkinsfile.asciidoc_sonarqube-analisys">SonarQube Analisys</h7>
<div class="paragraph">
<p>It is time to see if your application complies the requirements of the sonar analysis.</p>
</div>
<div class="paragraph">
<p>To do it you could use one of the next two options:</p>
</div>
<div class="paragraph">
<p><strong>Execute Sonar with sonarTool</strong> (It should be used by devon4ng or devon4node).</p>
</div>
<div class="listingblock">
<div class="content">
<pre>script {
    def scannerHome = tool sonarTool
    def props = readJSON file: 'package.json'
    withSonarQubeEnv(sonarEnv) {
        sh """
            ${scannerHome}/bin/sonar-scanner \
                -Dsonar.projectKey=${props.name}${sonarProjectKey} \
                -Dsonar.projectName=${props.name}${sonarProjectKey} \
                -Dsonar.projectVersion=${props.version} \
                -Dsonar.sources=${srcDir} \
                -Dsonar.typescript.lcov.reportPaths=coverage/lcov.info
        """
    }
    timeout(time: 1, unit: 'HOURS') {
        def qg = waitForQualityGate()
        if (qg.status != 'OK') {
            error "Pipeline aborted due to quality gate failure: ${qg.status}"
        }
    }
}</pre>
</div>
</div>
<div class="paragraph">
<p><strong>Execute Sonar with maven</strong> (It should be used by devon4j).</p>
</div>
<div class="listingblock">
<div class="content">
<pre>script {
    withMaven(globalMavenSettingsConfig: globalSettingsId, maven: mavenInstallation) {
        withSonarQubeEnv(sonarEnv) {
            // Change the project name (in order to simulate branches with the free version)
            sh "cp pom.xml pom.xml.bak"
            sh "cp api/pom.xml api/pom.xml.bak"
            sh "cp core/pom.xml core/pom.xml.bak"
            sh "cp server/pom.xml server/pom.xml.bak"

            def pom = readMavenPom file: './pom.xml';
            pom.artifactId = "${pom.artifactId}${sonarProjectKey}"
            writeMavenPom model: pom, file: 'pom.xml'

            def apiPom = readMavenPom file: 'api/pom.xml'
            apiPom.parent.artifactId = pom.artifactId
            apiPom.artifactId = "${pom.artifactId}-api"
            writeMavenPom model: apiPom, file: 'api/pom.xml'

            def corePom = readMavenPom file: 'core/pom.xml'
            corePom.parent.artifactId = pom.artifactId
            corePom.artifactId = "${pom.artifactId}-core"
            writeMavenPom model: corePom, file: 'core/pom.xml'

            def serverPom = readMavenPom file: 'server/pom.xml'
            serverPom.parent.artifactId = pom.artifactId
            serverPom.artifactId = "${pom.artifactId}-server"
            writeMavenPom model: serverPom, file: 'server/pom.xml'

            sh "mvn sonar:sonar"

            sh "mv pom.xml.bak pom.xml"
            sh "mv api/pom.xml.bak api/pom.xml"
            sh "mv core/pom.xml.bak core/pom.xml"
            sh "mv server/pom.xml.bak server/pom.xml"
        }
    }
    timeout(time: 1, unit: 'HOURS') {
        def qg = waitForQualityGate()
        if (qg.status != 'OK') {
            error "Pipeline aborted due to quality gate failure: ${qg.status}"
        }
    }
}</pre>
</div>
</div>
</div>
<div class="sect6">
<h7 id="dsf-configure-jenkinsfile.asciidoc_build">Build</h7>
<div class="paragraph">
<p>If SonarQube is passed, you could build your application. To do it, if you are using devon4ng or devon4node you only need to add the next command:</p>
</div>
<div class="paragraph">
<p>sh """yarn build"""</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If you are using devon4j this and the next step <em>Store in Nexus</em> are making together using <code>mvn deploy</code>.
</td>
</tr>
</table>
</div>
</div>
<div class="sect6">
<h7 id="dsf-configure-jenkinsfile.asciidoc_store-in-nexus">Store in Nexus</h7>
<div class="paragraph">
<p>One time the application has been built the code of the application you could find the artifacts stored in the dist folder. You should push these artifacts to store them in Nexus.</p>
</div>
<div class="paragraph">
<p>You can do it following one of the next options:</p>
</div>
<div class="paragraph">
<p><strong>Use maven deploy config of your project</strong> (It should be used by devon4j).</p>
</div>
<div class="listingblock">
<div class="content">
<pre>withMaven(globalMavenSettingsConfig: globalSettingsId, maven: mavenInstallation) {
    sh "mvn deploy -Dmaven.test.skip=true"
}</pre>
</div>
</div>
<div class="paragraph">
<p><strong>Configure maven deploy in your pipeline</strong> (It should be used by devon4ng and devon4node).</p>
</div>
<div class="listingblock">
<div class="content">
<pre>script {
    def props = readJSON file: 'package.json'
    zip dir: 'dist/', zipFile: """${props.name}.zip"""
    version = props.version
    if (!version.endsWith("-SNAPSHOT") &amp;&amp; env.BRANCH_NAME == 'develop') {
        version = "${version}-SNAPSHOT"
        version = version.replace("-RC", "")
    }

    if (!version.endsWith("-RC") &amp;&amp; env.BRANCH_NAME.startsWith('release')) {
        version = "${version}-RC"
        version = version.replace("-SNAPSHOT", "")
    }

    if (env.BRANCH_NAME == 'master' &amp;&amp; (version.endsWith("-RC") || version.endsWith("-SNAPSHOT"))){
        version = version.replace("-RC", "")
        version = version.replace("-SNAPSHOT", "")
    }

    withMaven(globalMavenSettingsConfig: globalSettingsId, maven: mavenInstallation) {
        sh """
            mvn deploy:deploy-file \
                -DgroupId=${groupId} \
                -DartifactId=${props.name} \
                -Dversion=${version} \
                -Dpackaging=zip \
                -Dfile=${props.name}.zip \
                -DrepositoryId=${repositoryId} \
                -Durl=${repositoryUrl}${repositoryName}
        """
    }
}</pre>
</div>
</div>
</div>
<div class="sect6">
<h7 id="dsf-configure-jenkinsfile.asciidoc_create-docker-image">Create docker image</h7>
<div class="paragraph">
<p>Now we need to use this artifacts to create a Docker image. To create the docker image you need an external server to do it. You could do it using one of the next:</p>
</div>
<div class="paragraph">
<p><strong>Create docker image using OpenShift cluster</strong></p>
</div>
<div class="paragraph">
<p>To create the docker image with this option you need to configure your OpenShift. You could read how to configure it <a href="dsf-deployment-dsf4openshift.html#configure-builds-to-create-docker-image-using-OpenShift">here</a>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>props = readJSON file: 'package.json'
withCredentials([usernamePassword(credentialsId: "${openShiftCredentials}", passwordVariable: 'pass', usernameVariable: 'user')]) {
    sh "oc login -u ${user} -p ${pass} ${openshiftUrl} --insecure-skip-tls-verify"
    try {
        sh "oc start-build ${props.name} --namespace=${openShiftNamespace} --from-dir=dist --wait"
        sh "oc import-image ${props.name} --namespace=${openShiftNamespace} --from=${dockerRegistry}/${props.name}:${dockerTag} --confirm"
    } catch (e) {
        sh """
            oc logs \$(oc get builds -l build=${props.name} --namespace=${openShiftNamespace} --sort-by=.metadata.creationTimestamp -o name | tail -n 1) --namespace=${namespace}
            throw e
        """
    }
}</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
if your project is a maven project you should read the <em>pom.xml</em> file instead of the <em>package.json</em>, you could do it with the next command <code>def pom = readMavenPom file: 'pom.xml'</code>. Due to the fact that there are different variable names between those two files, remember to modify <strong>${props.name}</strong> for <strong>${pom.artifactId}</strong> in the code.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>Create docker image using docker server</strong></p>
</div>
<div class="paragraph">
<p>To create the docker image with this option you need to install docker and configure where is the docker host in your jenkins.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>docker.withRegistry("""${dockerRegistryProtocol}${dockerRegistry}""", dockerRegistryCredentials) {
    def props = readJSON file: 'package.json'
    def customImage = docker.build("${props.name}:${props.version}", "-f ${dockerFileName} .")
    customImage.push()
    customImage.push(dockerTag);
}</pre>
</div>
</div>
<div class="paragraph">
<p><a href="dsf-deployment-dsf4openshift.html#configure-builds-to-create-docker-image-using-OpenShift">here</a></p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
if your project is a maven project you should read the <em>pom.xml</em> file instead of the <em>package.json</em>, you could do it with the next command <code>def pom = readMavenPom file: 'pom.xml'</code>. Due to the fact that there are different variable names between those two files, remember to modify <strong>${props.name}</strong> for <strong>${pom.artifactId}</strong> and <strong>${props.version}</strong> for <strong>${pom.version}</strong> in the code.
</td>
</tr>
</table>
</div>
</div>
<div class="sect6">
<h7 id="dsf-configure-jenkinsfile.asciidoc_deploy-docker-image">Deploy docker image</h7>
<div class="paragraph">
<p>Once you have the docker image in the registry we only need to import it into your deployment environment. We can do it executing one of the next commands:</p>
</div>
<div class="paragraph">
<p><strong>Deploy docker image in OpenShift cluster</strong></p>
</div>
<div class="paragraph">
<p>To deploy the docker image with this option you need to configure your OpenShift. You could read how to configure it <a href="dsf-deployment-dsf4openshift.html#configure-new-environment">here</a>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>script {
    props = readJSON file: 'package.json'
    withCredentials([usernamePassword(credentialsId: "${openShiftCredentials}", passwordVariable: 'pass', usernameVariable: 'user')]) {
        sh "oc login -u ${user} -p ${pass} ${openshiftUrl} --insecure-skip-tls-verify"
        try {
            sh "oc import-image ${props.name} --namespace=${openShiftNamespace} --from=${dockerRegistry}/${props.name}:${dockerTag} --confirm"
        } catch (e) {
            sh """
                oc logs \$(oc get builds -l build=${props.name} --namespace=${openShiftNamespace} --sort-by=.metadata.creationTimestamp -o name | tail -n 1) --namespace=${openShiftNamespace}
                throw e
            """
        }
    }
}</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
if your project is a maven project you should read the <em>pom.xml</em> file instead of the <em>package.json</em>, you could do it with the next command <code>def pom = readMavenPom file: 'pom.xml'</code>. Due to the fact that there are different variable names between those two files, remember to modify <strong>${props.name}</strong> for <strong>${pom.artifactId}</strong> in the code.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>Deploy docker image using docker server</strong></p>
</div>
<div class="paragraph">
<p>To deploy the docker image with this option you need to install docker and configure your docker server and also integrate it with Jenkins.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>script {
    docker.withRegistry("""${dockerRegistryProtocol}${dockerRegistry}""", dockerRegistryCredentials) {
        def props = readJSON file: 'package.json'
        docker.image("${props.name}:${props.version}").pull()

        def containerId = sh returnStdout: true, script: """docker ps -aqf "name=${containerName}${dockerEnvironment}" """
        if (containerId?.trim()) {
            sh "docker rm -f ${containerId.trim()}"
        }

        println """docker run -d --name ${containerName}${dockerEnvironment} --network=${networkName} ${dockerRegistry}/${props.name}:${props.version}"""
        sh """docker run -d --name ${containerName}${dockerEnvironment} --network=${networkName} ${dockerRegistry}/${props.name}:${props.version}"""
    }
}</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
if your project is a maven project you should read the <em>pom.xml</em> file instead of the <em>package.json</em>, you could do it with the next command <code>def pom = readMavenPom file: 'pom.xml'</code>. Due to the fact that there are different variable names between those two files, remember to modify <strong>${props.name}</strong> for <strong>${pom.artifactId}</strong> and <strong>${props.version}</strong> for <strong>${pom.version}</strong> in the code.
</td>
</tr>
</table>
</div>
</div>
<div class="sect6">
<h7 id="dsf-configure-jenkinsfile.asciidoc_check-status">Check status</h7>
<div class="paragraph">
<p>Now is time to check if your pods are running ok.</p>
</div>
<div class="paragraph">
<p>To check if your pods are ok in OpenShift you should add the next code to your pipeline:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>script {
    props = readJSON file: 'package.json'
    sleep 30
    withCredentials([usernamePassword(credentialsId: "${openShiftCredentials}", passwordVariable: 'pass', usernameVariable: 'user')]) {
        sh "oc login -u ${user} -p ${pass} ${openshiftUrl} --insecure-skip-tls-verify"
        sh "oc project ${openShiftNamespace}"

        def oldRetry = -1;
        def oldState = "";

        sh "oc get pods -l app=${props.name} &gt; out"
        def status = sh (
            script: "sed 's/[\t ][\t ]*/ /g' &lt; out | sed '2q;d' | cut -d' ' -f3",
            returnStdout: true
        ).trim()

        def retry = sh (
            script: "sed 's/[\t ][\t ]*/ /g' &lt; out | sed '2q;d' | cut -d' ' -f4",
            returnStdout: true
        ).trim().toInteger();

        while (retry &lt; 5 &amp;&amp; (oldRetry != retry || oldState != status)) {
            sleep 30
            oldRetry = retry
            oldState = status

            sh """oc get pods -l app=${props.name} &gt; out"""
            status = sh (
                script: "sed 's/[\t ][\t ]*/ /g' &lt; out | sed '2q;d' | cut -d' ' -f3",
                returnStdout: true
            ).trim()

            retry = sh (
                script: "sed 's/[\t ][\t ]*/ /g' &lt; out | sed '2q;d' | cut -d' ' -f4",
                returnStdout: true
            ).trim().toInteger();
        }

        if(status != "Running"){
            try {
                sh """oc logs \$(oc get pods -l app=${props.name} --sort-by=.metadata.creationTimestamp -o name | tail -n 1)"""
            } catch (e) {
                sh "echo error reading logs"
            }
            error("The pod is not running, cause: " + status)
        }
    }
}</pre>
</div>
</div>
</div>
</div>
<div class="sect5">
<h6 id="dsf-configure-jenkinsfile.asciidoc_post-operations">Post operations</h6>
<div class="paragraph">
<p>When all its finish, remember to clean your workspace.</p>
</div>
<div class="paragraph">
<p>post {
    cleanup {
        cleanWs()
    }
}</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
You could also delete your dir adding the next command <code>deleteDir()</code>.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect4">
<h5 id="dsf-configure-dockerfile.asciidoc">Dockerfile</h5>
<div class="paragraph">
<p>You have examples of dockerfiles in cicdgen repository.</p>
</div>
<div class="paragraph">
<p>inside these folders you could find all the files that you need to use those dockerfiles. Two dockerfiles are provaided, <em>Dockerfile</em> and <em>Dockerfile.ci</em>, the first one is to compile the code and create the docker image used normally in local, and <em>Dockerfile.ci</em> is to use in Jenkins or similar, after building the application.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>visit our <a href="https://github.com/Jorge-Dacal/cicdgen/tree/develop/schematics/src/devon4ng/docker">devon4ng</a> Dockerfiles.</p>
</li>
<li>
<p>visit our <a href="https://github.com/Jorge-Dacal/cicdgen/tree/develop/schematics/src/devon4j/docker">devon4j</a> Dockerfiles.</p>
</li>
<li>
<p>visit our <a href="https://github.com/Jorge-Dacal/cicdgen/tree/develop/schematics/src/devon4node/docker">devon4node</a> Dockerfiles.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Dockerfile.ci should be copied to de artifacts and renamed as Dockerfile to work. In the case or <em>devon4ng</em> and <em>devon4node</em> this is the <code>dist</code> folder, in case of <em>devon4ng</em> is on <code>server/target</code> folder.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="master-devonfw-shop-floor.asciidoc_automatic-configuration">34.3.2. Automatic configuration</h4>
<div class="sect4">
<h5 id="master-devonfw-shop-floor.asciidoc_cicdgen">cicdgen</h5>
<div class="paragraph">
<p>If you are using production line for provisioning you could use cicdgen to configure automatically almost everything explained in the manual configuration. To do it see the <a href="https://github.com/devonfw/cicdgen/wiki">cicdgen</a> documentation.</p>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="master-devonfw-shop-floor.asciidoc_deployment-environments">35. Deployment environments</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="master-devonfw-shop-floor.asciidoc_openshift">35.1. OpenShift</h3>
<div class="sect3">
<h4 id="dsf-deployment-dsf4openshift.asciidoc">35.1.1. dsf4openshift deployment environment</h4>
<div class="paragraph">
<p>In this section you will see how you can create a new environment instance in OpenShift and the things that you must add to the Jenkinsfiles of your repository to deploy a branch in this new environment. To conclude you are going to see how to add config files for environment in the source code of the applications.</p>
</div>
<div class="sect4">
<h5 id="dsf-deployment-dsf4openshift.asciidoc_configure-your-openshift-to-deploy-your-devonfw-projects">Configure your OpenShift to deploy your devonfw projects</h5>
<div class="sect5">
<h6 id="dsf-deployment-dsf4openshift.asciidoc_prerequisites">Prerequisites</h6>
<div class="sect6">
<h7 id="dsf-deployment-dsf4openshift.asciidoc_openshift-cluster">OpenShift Cluster</h7>
<div class="paragraph">
<p>To have your deployment environment with OpenShift you need to have an OpenShift Cluster.</p>
</div>
</div>
</div>
<div class="sect5">
<h6 id="dsf-deployment-dsf4openshift.asciidoc_manual-configuration">Manual configuration</h6>
<div class="paragraph">
<p>Here you can find all that you need to know to <a href="#dsf-deployment-dsf4openshift-manual-configuration.asciidoc">configure OpenShift</a> manually.</p>
</div>
</div>
<div class="sect5">
<h6 id="dsf-deployment-dsf4openshift.asciidoc_automatic-configuration">Automatic configuration</h6>
<div class="paragraph">
<p>Here you can find all that you need to know to <a href="#dsf-deployment-dsf4openshift-automatic-configuration.asciidoc">configure OpenShift</a> automatically.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="dsf-deployment-dsf4openshift.asciidoc_service-integration-with-jenkins">Service integration with jenkins</h5>
<div class="sect5">
<h6 id="dsf-deployment-dsf4openshift.asciidoc_prerequisites">Prerequisites</h6>
<div class="paragraph">
<p>To integrate it, you need to have installed the plugin OpenShift Client. To install it go to Manage Jenkins clicking on left menu and enter in <strong><em>Manage Plugins</em></strong>. Go to Available tab and search it using the filter textbox in the top right corner and install it.</p>
</div>
</div>
<div class="sect5">
<h6 id="dsf-deployment-dsf4openshift.asciidoc_configuration">Configuration</h6>
<div class="paragraph">
<p>Second, you need to configure the OC Client. Go to Manage Jenkins clicking on left menu and enter in <strong><em>Global Tool Configuration</em></strong>.</p>
</div>
<div class="paragraph">
<p>Go to OpenShift Client Tools section and add a new one like this.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/configuration/openshift-jenkins-plugin.png" alt="openshift jenkins plugin">
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="dsf-deployment-dsf4openshift.asciidoc_upgrade-your-jenkinsfile">Upgrade your Jenkinsfile</h5>
<div class="paragraph">
<p>Now it is time to add/upgrade the next stages in to your Jenkinsfile:</p>
</div>
<div class="paragraph">
<p>Add <a href="dsf-configure-jenkinsfile.html#create-docker-image">create docker image</a> stage.</p>
</div>
<div class="paragraph">
<p>Add <a href="dsf-configure-jenkinsfile.html#deploy-docker-image">deploy docker image</a> stage.</p>
</div>
<div class="paragraph">
<p>Add <a href="dsf-configure-jenkinsfile.html#check-status">check status</a> stage.</p>
</div>
<div class="paragraph">
<p>Upgrade <a href="dsf-configure-jenkinsfile.html#setup-Jenkins-tools">Setup Jenkins tools</a> stage.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Remember to upgrade your parameters to difference which environment is used per branch.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="dsf-deployment-dsf4openshift-manual-configuration.asciidoc">35.1.2. OpenShift deployment environment manual configuration</h4>
<div class="paragraph">
<p>In this section you will see how you can create a new environment instance in your OpenShift cluster to deploy devonfw projects using docker images.</p>
</div>
<div class="sect4">
<h5 id="dsf-deployment-dsf4openshift-manual-configuration.asciidoc_prerequisites">Prerequisites</h5>
<div class="sect5">
<h6 id="dsf-deployment-dsf4openshift-manual-configuration.asciidoc_devonfw-project">devonfw project</h6>
<div class="paragraph">
<p>Yo need to have a devonfw project in a git repository or a docker image uploaded to a docker registry.</p>
</div>
</div>
<div class="sect5">
<h6 id="dsf-deployment-dsf4openshift-manual-configuration.asciidoc_comunication-between-components">Comunication between components</h6>
<div class="paragraph">
<p>Openshift must have access to docker registry.</p>
</div>
</div>
<div class="sect5">
<h6 id="dsf-deployment-dsf4openshift-manual-configuration.asciidoc_download-openshift-client-tools">Download OpenShift Client Tools</h6>
<div class="paragraph">
<p>First of all you need to download the OpenShift client, you can find it <a href="https://www.okd.io/download.html">here</a>.</p>
</div>
<div class="paragraph">
<p>Remember that what you need to download <strong>oc Client Tools</strong> and not <em>OKD Server</em>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
This tutorial has been made with the version 3.10.0 of the client, it is recommended to use the most current client, but if it does not work, it is possible that the instructions have become obsolete or that the OpenShift used needs another older/newer version of the client. To download a specific version of the client you can find here the <a href="https://github.com/openshift/origin/releases/">older versions</a> and the <a href="https://github.com/openshift/origin/releases/tag/v3.10.0">version 3.10.0</a>.
</td>
</tr>
</table>
</div>
</div>
<div class="sect5">
<h6 id="dsf-deployment-dsf4openshift-manual-configuration.asciidoc_add-oc-client-to-path">Add oc client to path</h6>
<div class="paragraph">
<p>Once you have downloaded the client you have to add it to the <strong>PATH</strong> environment variable.</p>
</div>
</div>
<div class="sect5">
<h6 id="dsf-deployment-dsf4openshift-manual-configuration.asciidoc_log-into-openshift-with-admin-account">Log into OpenShift with admin account</h6>
<div class="paragraph">
<p>You can log using a terminal and executing the next instructions:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-Shell hljs" data-lang="Shell">oc login $OpenShiftUrl</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
You need a valid user to log in.
</td>
</tr>
</table>
</div>
</div>
<div class="sect5">
<h6 id="dsf-deployment-dsf4openshift-manual-configuration.asciidoc_select-the-project-where-you-are-going-to-create-the-environment">Select the project where you are going to create the environment</h6>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-Shell hljs" data-lang="Shell">oc project $projectName</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="dsf-deployment-dsf4openshift-manual-configuration.asciidoc_add-all-the-secrets-that-you-need">Add all the secrets that you need</h6>
<div class="paragraph">
<p>For example, to create a secret for a nexus repository you should execute the next commands:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-Shell hljs" data-lang="Shell">oc create secret docker-registry $nameForSecret --docker-server=${dockerRegistry} --docker-username=${user} --docker-password=${pass} --docker-email=no-reply@email.com</code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="dsf-deployment-dsf4openshift-manual-configuration.asciidoc_configure-openshift">Configure OpenShift</h5>
<div class="sect5">
<h6 id="dsf-deployment-dsf4openshift-manual-configuration.asciidoc_configure-builds-to-create-docker-image-using-openshift">Configure builds to create docker image using OpenShift</h6>
<div class="paragraph">
<p>If you need to create docker images of your projects you could use OpenShift to do it <em>(Off course only if you have enough rights)</em>.</p>
</div>
<div class="paragraph">
<p>To do it, follow the next steps.</p>
</div>
<div class="sect6">
<h7 id="dsf-deployment-dsf4openshift-manual-configuration.asciidoc_create-new-builds-configs">Create new builds configs</h7>
<div class="paragraph">
<p>The first thing you need to do for create a new environment is prepare the buildconfigs for the front and for the middleware and rise default memory limits for the middleware. You can do it using a terminal and executing the next instructions:</p>
</div>
<div class="paragraph">
<p>These are a summary about the parameters used in our commands:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>${dockerRegistry}</strong>: The url of the docker repository.</p>
</li>
<li>
<p><strong>${props.name}</strong>: The name of the project (for example could be find on package.json)</p>
</li>
<li>
<p><strong>${dockerTag}</strong>: The tag of the image</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
From now on you will refer to the name that you are going to give to the environment as <strong>$enviroment</strong>. Remember to modify it for the correct value in all instructions.
</td>
</tr>
</table>
</div>
<div class="sect7">
<h8 id="dsf-deployment-dsf4openshift-manual-configuration.asciidoc_devon4ng-build-config">devon4ng build config</h8>
<div class="paragraph">
<p>You need to create nginx build config with docker.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-Shell hljs" data-lang="Shell">oc new-build --strategy docker --binary --docker-image nginx:alpine-perl --name=${props.name}-$environment --to=${dockerRegistry}/${props.name}:${dockerTag} --to-docker=true</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
You need nginx:alpine-perl to read the environment config file in openshift, if you are not going to use it, you could use nginx:latest instead.
</td>
</tr>
</table>
</div>
</div>
<div class="sect7">
<h8 id="dsf-deployment-dsf4openshift-manual-configuration.asciidoc_devon4node-build-config">devon4node build config</h8>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-Shell hljs" data-lang="Shell">oc new-build --strategy docker --binary --docker-image node:lts --name=${props.name}-$environment --to=${dockerRegistry}/${props.name}:${dockerTag} --to-docker=true</code></pre>
</div>
</div>
</div>
<div class="sect7">
<h8 id="dsf-deployment-dsf4openshift-manual-configuration.asciidoc_devon4j-build-config">devon4j build config</h8>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-Shell hljs" data-lang="Shell">oc new-build --strategy docker --binary --docker-image openjdk:&lt;version&gt; --name=${props.name}-$environment --to=${dockerRegistry}/${props.name}:${dockerTag} --to-docker=true</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
You need to specify the &lt;version&gt; of java used for your project. Also you can use the -alpine image. This image is based on the popular <a href="https://alpinelinux.org/">Alpine Linux project</a>. Alpine Linux is much smaller than most distribution base images (~5MB), and thus leads to much slimmer images in general. More information on <a href="https://hub.docker.com/_/openjdk/">docker hub</a>.
</td>
</tr>
</table>
</div>
</div>
<div class="sect7">
<h8 id="dsf-deployment-dsf4openshift-manual-configuration.asciidoc_how-to-use-the-build">How to use the build</h8>
<div class="paragraph">
<p>In this step is where you will build a docker image from a compiled application.</p>
</div>
<div class="sect8">
<h9 id="dsf-deployment-dsf4openshift-manual-configuration.asciidoc_prerequisite">Prerequisite</h9>
<div class="paragraph">
<p>To build the source in OpenShift, first of all you need to compile your source and <strong>obtain the artifacts</strong> <em>"dist folder"</em> or download it from a repository. Normally the artifacts have been built on Jenkins and have been stored in Nexus.</p>
</div>
<div class="paragraph">
<p>To download it, you can access to your registry, select the last version and download the <em>".tar"</em>. The next image shows an example of where is the link to download it, marked in yellow:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/configuration/nexus-stored-artifacts.png" alt="nexus stored artifacts">
</div>
</div>
</div>
<div class="sect8">
<h9 id="dsf-deployment-dsf4openshift-manual-configuration.asciidoc_build-in-openshift">Build in OpenShift</h9>
<div class="paragraph">
<p>When you have the artifacts, you can send them to your openshift and build them using your buildconfig that you created on the previous step. This is going to create a new docker image and push it to your registry.</p>
</div>
<div class="paragraph">
<p>If your docker registry need credentials you should use a secret. You could add it to your buildconfig using the next command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-Shell hljs" data-lang="Shell">oc set build-secret --push bc/${props.name}-$environment ${nameForSecret}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now you can use your build config and push the docker image to your registry. To do it you need to use a terminal and execute the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-Shell hljs" data-lang="Shell">oc start-build ${props.name}-$environment --from-dir=${artifactsPath} --follow</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
${artifactsPath} is the path where you have the artifacts of the prerequisite (On jenkins is the dist folder generated by the build).
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Maybe you need to <a href="dsf-deployment-dsf4openshift.html#Raise/decrease-memory-or-CPU-limits">raise your memory or CPU limits</a>.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
</div>
<div class="sect5">
<h6 id="dsf-deployment-dsf4openshift-manual-configuration.asciidoc_configure-new-environment">Configure new environment</h6>
<div class="paragraph">
<p>Now it is time to configure the environment.</p>
</div>
<div class="sect6">
<h7 id="dsf-deployment-dsf4openshift-manual-configuration.asciidoc_prerequisite">Prerequisite</h7>
<div class="paragraph">
<p>You need a docker image of your application. You could create it using OpenShift as you see in the last step.</p>
</div>
</div>
<div class="sect6">
<h7 id="dsf-deployment-dsf4openshift-manual-configuration.asciidoc_create-new-app-on-openshift">Create new app on OpenShift</h7>
<div class="paragraph">
<p>To create new app you need to use the next command.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-Shell hljs" data-lang="Shell">oc new-app --docker-image=${artifactsPath} --name=${props.name}-$environment --source-secret=${nameForSecret}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
You could add environment variables using <code>-e $name=$value</code>
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If you do not need to use a secret remove the end part of the command <code>--source-secret=${nameForSecret}</code>
</td>
</tr>
</table>
</div>
</div>
<div class="sect6">
<h7 id="dsf-deployment-dsf4openshift-manual-configuration.asciidoc_create-routes">Create routes</h7>
<div class="paragraph">
<p>Finally, you need add a route to access the service.</p>
</div>
<div class="paragraph">
<p><strong>Add http route</strong></p>
</div>
<div class="paragraph">
<p>If you want to create an http route execute the following command in a terminal:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-Shell hljs" data-lang="Shell">oc expose svc/${props.name}-$environment</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Add https route</strong></p>
</div>
<div class="paragraph">
<p>If you want to create an https route you can do it executing the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-Shell hljs" data-lang="Shell">oc create route edge --service=${props.name}-$environment</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you want to change the default route path you can use the command --hostname=$url. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-Shell hljs" data-lang="Shell">oc expose svc/${props.name}-$environment --hostname=$url

oc create route edge --service=${props.name}-$environment --hostname=$url</code></pre>
</div>
</div>
</div>
</div>
<div class="sect5">
<h6 id="dsf-deployment-dsf4openshift-manual-configuration.asciidoc_import-new-images-from-registry">Import new images from registry</h6>
<div class="paragraph">
<p>When you have new images in the registry you must import them to OpenShift. You could do it executing the next commands:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-Shell hljs" data-lang="Shell">oc import-image ${props.name}-$environment --from=${dockerRegistry}/${props.name}:${dockerTag} --confirm</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Maybe you need to raise your memory or CPU limits. It is explained below.
</td>
</tr>
</table>
</div>
</div>
<div class="sect5">
<h6 id="dsf-deployment-dsf4openshift-manual-configuration.asciidoc_raisedecrease-memory-or-cpu-limits">Raise/decrease memory or CPU limits</h6>
<div class="paragraph">
<p>If you need to raise (or decrease) the memory or CPU limits that you need you could do it for your deployments and builders configurations following the next steps.</p>
</div>
<div class="sect6">
<h7 id="dsf-deployment-dsf4openshift-manual-configuration.asciidoc_for-deployments">For deployments</h7>
<div class="paragraph">
<p>You could do it in OpenShift using the user interface. To do it you should enter in OpenShift and go to deployments.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/configuration/openshift-deployments-menu.png" alt="openshift deployments menu">
</div>
</div>
<div class="paragraph">
<p>At the right top, you could see a drop down actions, click on it and you could edit the resource limits of the container.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/configuration/openshift-deployments-actions.png" alt="openshift deployments actions">
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/configuration/openshift-deployments-resource-limits.png" alt="openshift deployments resource limits">
</div>
</div>
<div class="paragraph">
<p>Maybe you should modify the resource limits of the pod too. To do it you should click on drop down actions and go to edit YAML. Then you could see something like the next image.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/configuration/openshift-deployments-yaml-resources.png" alt="openshift deployments yaml resources">
</div>
</div>
<div class="paragraph">
<p>In the image, you could see that appear resources two times. One at the bottom of the image, this are the container resources that you modified on the previous paragraph and another one at the top of the image. The resources of the top are for the pod, you should give to it at least the same of the sum for all containers that the pod use.</p>
</div>
<div class="paragraph">
<p>Also you could do it using command line interface and executing the next command:</p>
</div>
<div class="paragraph">
<p><strong>To modify pod limits</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-Shell hljs" data-lang="Shell">oc patch dc/boat-frontend-test --patch '{"spec":{"strategy":{"resources":{"limits":{"cpu": "100m", "memory": "100Mi"}, "requests":{"cpu": "100m", "memory": "100Mi"}}}}}'</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>To modify container limits</strong></p>
</div>
<div class="paragraph">
<p>When this guide was written Openshift have a bug and you cannot do it from command line interface.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If that command did not work and you received an error like this <code>error: unable to parse "'{spec:&#8230;&#8203;": yaml: found unexpected end of stream</code>, try to use the patch using "" instead of ''. It looks like this: <code>--patch "{\"spec\":&#8230;&#8203;\"}}}}"</code>
</td>
</tr>
</table>
</div>
</div>
<div class="sect6">
<h7 id="dsf-deployment-dsf4openshift-manual-configuration.asciidoc_for-builders">For builders</h7>
<div class="paragraph">
<p>You could do it using command line interface and executing the next command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-Shell hljs" data-lang="Shell">oc patch bc/${props.name}${APP_NAME_SUFFIX} --patch '{"spec":{"resources":{"limits":{"cpu": "125m", "memory": "400Mi"},"requests":{"cpu": "125m", "memory": "400Mi"}}}}'</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If that command did not work and you received an error like this <code>error: unable to parse "'{spec:&#8230;&#8203;": yaml: found unexpected end of stream</code>, try to use the patch using "" instead of ''. It looks like this: <code>--patch "{\"spec\":&#8230;&#8203;\"}}}}"</code>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="dsf-deployment-dsf4openshift-automatic-configuration.asciidoc">35.1.3. OpenShift deployment environment automatic configuration</h4>
<div class="paragraph">
<p>In this section you will see how you can create a new environment instance in your OpenShift cluster to deploy devonfw projects using docker images.</p>
</div>
<div class="sect4">
<h5 id="dsf-deployment-dsf4openshift-automatic-configuration.asciidoc_prerequisites">Prerequisites</h5>
<div class="sect5">
<h6 id="dsf-deployment-dsf4openshift-automatic-configuration.asciidoc_add-openshift-client-to-jenkins">Add OpenShift Client to Jenkins</h6>
<div class="paragraph">
<p>To integrate it, you need to have installed the plugin OpenShift Client. To install it go to Manage Jenkins clicking on left menu and enter in <strong><em>Manage Plugins</em></strong>. Go to Available tab and search it using the filter textbox in the top right corner and install it.</p>
</div>
</div>
<div class="sect5">
<h6 id="dsf-deployment-dsf4openshift-automatic-configuration.asciidoc_configuration-openshift-client-in-jenkins">Configuration OpenShift Client in Jenkins</h6>
<div class="paragraph">
<p>Second, you need to configure the OC Client. Go to Manage Jenkins clicking on left menu and enter in <strong><em>Global Tool Configuration</em></strong>.</p>
</div>
<div class="paragraph">
<p>Go to OpenShift Client Tools section and add a new one like this.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/configuration/openshift-jenkins-plugin.png" alt="openshift jenkins plugin">
</div>
</div>
</div>
<div class="sect5">
<h6 id="dsf-deployment-dsf4openshift-automatic-configuration.asciidoc_devonfw-project">devonfw project</h6>
<div class="paragraph">
<p>You need to have a devonfw project in a git repository or a docker image uploaded to a docker registry.</p>
</div>
</div>
<div class="sect5">
<h6 id="dsf-deployment-dsf4openshift-automatic-configuration.asciidoc_comunication-between-components">Comunication between components</h6>
<div class="paragraph">
<p>Jenkins must have access to git, docker registry and OpenShift.</p>
</div>
<div class="paragraph">
<p>Openshift must have access to docker registry.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="dsf-deployment-dsf4openshift-automatic-configuration.asciidoc_jenkinsfiles-to-configure-openshift">Jenkinsfiles to Configure OpenShift</h5>
<div class="paragraph">
<p>You can find one Jenkinsfile per devonfw technology in <a href="https://github.com/devonfw/devonfw-shop-floor/tree/develop/dsf4openshift/configure-environments">devonfw shop floor</a> repository to configure automatically your OpenShift cluster.</p>
</div>
<div class="sect5">
<h6 id="dsf-deployment-dsf4openshift-automatic-configuration.asciidoc_how-to-use-it">How to use it</h6>
<div class="paragraph">
<p>To use it you need to follow the next steps</p>
</div>
</div>
<div class="sect5">
<h6 id="dsf-deployment-dsf4openshift-automatic-configuration.asciidoc_create-a-new-pipeline">Create a new pipeline</h6>
<div class="paragraph">
<p>You need to create a new pipeline in your repository and point it to Jenkinsfile in devonfw shop floor repository.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/configuration/openshift-jenkins-configure-environments-repo.jpg" alt="openshift jenkins configure environments repo">
</div>
</div>
<div class="paragraph">
<p>Note: In the script path section you should use the Jenkinsfile of the technology that you need.</p>
</div>
</div>
<div class="sect5">
<h6 id="dsf-deployment-dsf4openshift-automatic-configuration.asciidoc_build-with-parameters">Build with parameters</h6>
<div class="paragraph">
<p>The first time that you execute the pipeline is going to fail because Jenkins does not know that this pipeline needs parameters to execute. The better that you can do is stop it manually when <em>Declarative: Checkout SCM</em> is over.</p>
</div>
<div class="paragraph">
<p>Then you could see a button to Build with Parameters, click on it and fill the next form, these are the parameters:</p>
</div>
<div class="paragraph">
<p><strong>Docker registry credentials for OpenShift</strong></p>
</div>
<div class="paragraph">
<p><code>CREATE_SECRET</code>: This option allows you to add the credentials of your docker registry in your OpenShift and stored it as a secret called docker-registry + registry_secret_name_suffix value.</p>
</div>
<div class="paragraph">
<p>Remember that you only need one secret to connect with your registry per namespace, if you are going to add more than one application in the same namespace that use the same registry, use the same name suffix and please do not create more than one secret in the same namespace. The namespace is the OpenShift project when you are going to deploy your application.</p>
</div>
<div class="paragraph">
<p>You can see your secrets stored in OpenShift going to OpenShift and click on the left menu:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/configuration/openshift-secrets-menu.jpg" alt="openshift secrets menu">
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If the secret exists, you should uncheck the checkbox and fill the name suffix to use it.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><code>REGISTRY_SECRET_NAME_SUFFIX</code>: This is the suffix of the name for your docker registry credentials stored in OpenShift as a secret. The name is going to be docker-registry + this suffix, if you use more than one docker-registry in the same namespace you need to add a suffix. For example you could add the name of your project, then to have the name as docker-registry-myprojectname you should use -myprojectname value.</p>
</div>
<div class="paragraph">
<p><strong>Build your docker image using OpenShift and store it in your docker registry</strong></p>
</div>
<div class="paragraph">
<p><code>CREATE_DOCKER_BUILDER</code>: This option allows you to create a build configuration in your OpenShift to create the docker images of your project and store them in your docker registry. If you are going to create the builder, your application is needed, you need to specify where is your git repository and which is the branch and credentials to use it.</p>
</div>
<div class="paragraph">
<p>The following parameters of this section are only necessary if a builder is to be created.</p>
</div>
<div class="paragraph">
<p><code>GIT_REPOSITORY</code>: This is the url of your git repository.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If you are using production line, remember to use the internal rout of your repository, to use it you must change the base url of your production line for the internal route <code><a href="http://gitlab-core:80/gitlab" class="bare">http://gitlab-core:80/gitlab</a></code>. For example, if your production line repository is for example <code><a href="https://shared-services.pl.s2-eu.capgemini.com/gitlab/boat/boat-frontend.git" class="bare">https://shared-services.pl.s2-eu.capgemini.com/gitlab/boat/boat-frontend.git</a></code> use <code><a href="http://gitlab-core:80/gitlab/boat/boat-frontend.git" class="bare">http://gitlab-core:80/gitlab/boat/boat-frontend.git</a></code>)
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><code>GIT_BRANCH</code>: This is the branch that we are going to use for creating the first docker image. The next time that you are going to use the builder you could use another branches.</p>
</div>
<div class="paragraph">
<p><code>GIT_CREDENTIALS</code>: This is the credentials id stored in your jenkins to download the code from your git repository.</p>
</div>
<div class="paragraph">
<p><code>BUILD_SCRIPT</code>: In case of use devon4ng or devon4node you could specify which is the build script used to build and create the first docker image with this builder.</p>
</div>
<div class="paragraph">
<p><code>JAVA_VERSION</code> In case of use devon4j this is the java version used for your docker image.</p>
</div>
<div class="paragraph">
<p><strong>Docker registry information</strong></p>
</div>
<div class="paragraph">
<p><code>DOCKER_REGISTRY</code>: This is the url of your docker registry.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If you are using production line, the url of your registry is docker-registry- + your production line url. For example, if your production line is <code>shared-services.pl.s2-eu.capgemini.com</code> your docker registry is <code>docker-registry-shared-services.pl.s2-eu.capgemini.com</code>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If you cannot access to your docker registry, please open an incident in i4u.</p>
</div>
<div class="paragraph">
<p><code>DOCKER_REGISTRY_CREDENTIALS</code>: This is the credentials id stored in your jenkins to download or upload docker images in your docker registry.</p>
</div>
<div class="paragraph">
<p><code>DOCKER_TAG</code>: This is the tag that is going to be used for the builder to push the docker image and for the deployment config to pull and deploy it.</p>
</div>
<div class="paragraph">
<p><strong>OpenShift cluster information</strong></p>
</div>
<div class="paragraph">
<p><code>OPENSHIFT_URL</code>: This is the url of your OpenShift cluster.</p>
</div>
<div class="paragraph">
<p><code>OPENSHIFT_CREDENTIALS</code>: This is the credentials id stored in your jenkins to use OpenShift.</p>
</div>
<div class="paragraph">
<p><code>OPENSHIFT_NAMESPACE</code>: This is the name of the project in your OpenShift where you are going to use. The name of the project in OpenShift is called namespace.</p>
</div>
<div class="paragraph">
<p>Take care because although you see at the top of your OpenShift interface the name of the project that you are using, this name is the display-name and not the value that you need. To obtain the correct value you must check your OpenShift url like you see in the next image:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/configuration/openshift-namespace-name.jpg" alt="openshift namespace name">
</div>
</div>
<div class="paragraph">
<p><code>APP_NAME_SUFFIX</code>: The name of all things created in your OpenShift project are going to be called as the configuration of your application says. Normaly, our projects use a suffix that depends on the environment. You can see the values in the next list:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>For develop branch we use <code>-dev</code></p>
</li>
<li>
<p>For release branch we use <code>-uat</code></p>
</li>
<li>
<p>For master branch we use <code>-prod</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><code>HOSTNAME</code>: If you do not specify nothing, OpenShift is going to autogenerate a valid url for your application. You could modify the value by default but be sure that you configure everything to server your application in the route that you specify.</p>
</div>
<div class="paragraph">
<p><code>SECURED_PROTOCOL</code>: If true, the protocol for the route will be https otherwise will be http.</p>
</div>
<div class="paragraph">
<p><strong>Jenkins tools</strong></p>
</div>
<div class="paragraph">
<p>All those parameters are the name of the tools in your Jenkinsfile.</p>
</div>
<div class="paragraph">
<p>To obtain it you need enter in your Jenkins and go to Manage Jenkins clicking on left menu and enter in <strong><em>Global Tool Configuration</em></strong> or in <strong><em>Managed files</em></strong>.</p>
</div>
<div class="paragraph">
<p><code>OPENSHIFT_TOOL</code>: Is located in Global tool configuration.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/configuration/openshift-jenkins-plugin-name.jpg" alt="openshift jenkins plugin name">
</div>
</div>
<div class="paragraph">
<p><code>NODEJS_TOOL</code>: Is located in Global tool configuration.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/configuration/jenkins-openshift-tool.jpg" alt="jenkins openshift tool">
</div>
</div>
<div class="paragraph">
<p><code>YARN_TOOL</code>: Is located in Global tool configuration, inside the custom tools.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/configuration/jenkins-yarn-tool-name.jpg" alt="jenkins yarn tool name">
</div>
</div>
<div class="paragraph">
<p><code>GLOBAL_SETTINGS_ID</code> Is located in Managed files. You need to click on edit button and take the id.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/configuration/jenkins-config-file-management.jpg" alt="jenkins config file management">
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/configuration/jenkins-edit-configuration-file.jpg" alt="jenkins edit configuration file">
</div>
</div>
<div class="paragraph">
<p><code>MAVEN_INSTALLATION</code> Is located in Global tool configuration.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/configuration/jenkins-mave-tool-name.jpg" alt="jenkins mave tool name">
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="master-devonfw-shop-floor.asciidoc_monitoring">36. Monitoring</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="dsf-configure-jenkins-build-monitor-view.asciidoc">36.1. Build monitor view</h3>
<div class="paragraph">
<p>This tool you will be able to see in real time what is the state of your Jenkins pipelines.</p>
</div>
<div class="sect3">
<h4 id="dsf-configure-jenkins-build-monitor-view.asciidoc_prerequisites">36.1.1. Prerequisites</h4>
<div class="sect4">
<h5 id="dsf-configure-jenkins-build-monitor-view.asciidoc_add-build-monitor-view-plugin">Add build monitor view plugin</h5>
<div class="paragraph">
<p>To integrate it, you need to have installed the build monitor view. To install it go to Manage Jenkins clicking on left menu and enter in <strong><em>Manage Plugins</em></strong>. Go to Available tab and search it using the filter textbox in the top right corner and install it.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="dsf-configure-jenkins-build-monitor-view.asciidoc_how-to-use-it">36.1.2. How to use it</h4>
<div class="paragraph">
<p>When you have build monitor view installed, you could add a new view clicking on the <strong><code>+</code></strong> tab in the top bar.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/configuration/jenkins-new-view.jpg" alt="jenkins new view">
</div>
</div>
<div class="paragraph">
<p>Now you need to fill which is the name that you are goint to give to your view and select <em>Build Monitor View</em> option.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/configuration/jenkins-build-monitor-view-add.jpg" alt="jenkins build monitor view add">
</div>
</div>
<div class="paragraph">
<p>Then you can see the configuration.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/configuration/jenkins-build-monitor-view-configuration.jpg" alt="jenkins build monitor view configuration">
</div>
</div>
<div class="paragraph">
<p>In <strong>Job Filters</strong> section you can specify which resources are going to be showed and whether subfolders should be included in the search.</p>
</div>
<div class="paragraph">
<p>In <strong>Build Monitor - View Settings</strong> you could specify which is the name at the top of the view and what is the ordering criterion.</p>
</div>
<div class="paragraph">
<p>In <strong>Build Monitor - Widget Settings</strong> you could specify if you want to show the committers and which is the field to display if it fails.</p>
</div>
<div class="paragraph">
<p>And this is the output:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/configuration/jenkins-build-monitor-view-output.jpg" alt="jenkins build monitor view output">
</div>
</div>
<div class="paragraph">
<p>You could limit the colums and the text scale clicking on the <em>gear button</em> at the right top corner.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/configuration/jenkins-build-monitor-view-output-config.jpg" alt="jenkins build monitor view output config">
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="master-devonfw-shop-floor.asciidoc_annexes">37. Annexes</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="master-devonfw-shop-floor.asciidoc_bitbucket">37.1. BitBucket</h3>
<div class="paragraph">
<p><em>[Under construction]</em></p>
</div>
<hr>
<div class="paragraph">
<p>The purpose of the present document is to provide the basic steps carried out to setup a BitBucket server in OpenShift.</p>
</div>
<div class="sect4">
<h5 id="dsf-openshift-services-bitbucket-basic-server-setup.asciidoc_introduction">Introduction</h5>
<div class="paragraph">
<p>BitBucket is the Atlassian tool that extends the Git functionality, by adding integration with JIRA, Confluence, or Trello, as well as incorporates extra features for security or management of user accounts (See <a href="https://www.atlassian.com/software/bitbucket/features">BitBucket</a>).</p>
</div>
<div class="paragraph">
<p>BitBucket server is the Atlassian tool that runs the BitBucket services (See <a href="https://www.atlassian.com/software/bitbucket/server">BitBucket server</a>).</p>
</div>
<div class="paragraph">
<p>The followed approach has been not using command line, but OpenShift Web Console, by deploying the Docker image <strong>atlassian/bitbucket-server</strong> (available in <a href="https://hub.docker.com/r/atlassian/bitbucket-server/">Docker Hub</a>) in the existing project <strong>Deployment</strong>.</p>
</div>
<div class="paragraph">
<p>The procedure below exposed consists basically in three main steps:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Deploy the BitBucket server image (from OpenShift web console)</p>
</li>
<li>
<p>Add a route for the external traffic (from OpenShift web console)</p>
</li>
<li>
<p>Configure the BitBucket server (from BitBucket server web console)</p>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="dsf-openshift-services-bitbucket-basic-server-setup.asciidoc_prerequisites">Prerequisites</h5>
<div class="ulist">
<ul>
<li>
<p>OpenShift up &amp; running</p>
</li>
<li>
<p>Atlassian account (with personal account key). Not required for OpenShift, but for the initial BitBucket server configuration.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="dsf-openshift-services-bitbucket-basic-server-setup.asciidoc_procedure">Procedure</h5>
<div class="paragraph">
<p><a id="dsf-openshift-services-bitbucket-basic-server-setup.asciidoc_step-0-log-into-our-linkhttps10.68.26.1638443consolelogoutopenshift-web-console"></a>]
=== Step 0: Log into our <a href="https://10.68.26.163:8443/console/logout">OpenShift Web console</a></p>
</div>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/others/bitbucket/step0.png" alt="step0">
</div>
</div>
<div class="sect5">
<h6 id="dsf-openshift-services-bitbucket-basic-server-setup.asciidoc_step-1-get-into-development-project">Step 1: Get into Development project</h6>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/others/bitbucket/step1.png" alt="]">
</div>
</div>
</div>
<div class="sect5">
<h6 id="dsf-openshift-services-bitbucket-basic-server-setup.asciidoc_step-2.1-deploy-a-new-image-to-the-project">Step 2.1: Deploy a new image to the project</h6>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/others/bitbucket/step2.1.png" alt="step2.1">
</div>
</div>
</div>
<div class="sect5">
<h6 id="dsf-openshift-services-bitbucket-basic-server-setup.asciidoc_step-2.2-introduce-the-image-name-available-in-linkhttpshub.docker.comratlassianbitbucket-serverdocker-hub-and-search">Step 2.2: Introduce the image name (available in <a href="https://hub.docker.com/r/atlassian/bitbucket-server/">Docker Hub</a>) and search</h6>
<div class="paragraph">
<p>Image name: <strong>atlassian/bitbucket-server</strong></p>
</div>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/others/bitbucket/step2.2.png" alt="step2.2">
</div>
</div>
</div>
<div class="sect5">
<h6 id="dsf-openshift-services-bitbucket-basic-server-setup.asciidoc_step-2.3-leave-by-the-moment-the-default-config.-since-it-is-enough-for-the-basic-setup.-press-create">Step 2.3: Leave by the moment the default config. since it is enough for the basic setup. Press Create</h6>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/others/bitbucket/step2.3.png" alt="step2.3">
</div>
</div>
</div>
<div class="sect5">
<h6 id="dsf-openshift-services-bitbucket-basic-server-setup.asciidoc_step-2.4-copy-the-oc-commands-in-case-it-is-required-to-work-via-command-line">Step 2.4: Copy the oc commands in case it is required to work via command line, and Go to overview</h6>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/others/bitbucket/step2.4.png" alt="step2.4">
</div>
</div>
</div>
<div class="sect5">
<h6 id="dsf-openshift-services-bitbucket-basic-server-setup.asciidoc_step-2.5-wait-until-openshift-deploys-and-starts-up-the-image.-all-the-info-will-be-available.">Step 2.5: Wait until OpenShift deploys and starts up the image. All the info will be available.</h6>
<div class="paragraph">
<p>Please notice that there are no pre-configured routes, hence the application is not accessible from outside the cluster.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/others/bitbucket/step2.5.png" alt="step2.5">
</div>
</div>
</div>
<div class="sect5">
<h6 id="dsf-openshift-services-bitbucket-basic-server-setup.asciidoc_step-3-create-a-route-in-order-for-the-application-to-be-accessible-from-outside-the-cluster-external-traffic.-press-create">Step 3: Create a route in order for the application to be accessible from outside the cluster (external traffic). Press Create</h6>
<div class="paragraph">
<p>Please notice that there are different fields that can be specified (hostname, port). If required, the value of those fields can be modified later.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/others/bitbucket/step3a.png" alt="step3a">
</div>
</div>
<div class="paragraph">
<p>Leave by the moment the default config. as it is enough for the basic setup.</p>
</div>
<div class="paragraph">
<p>The route for external traffic is now available.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/others/bitbucket/step3b.png" alt="step3b">
</div>
</div>
<hr>
<div class="paragraph">
<p>Now the BitBucker server container is up &amp; running in our cluster.</p>
</div>
<div class="paragraph">
<p>The below steps correspond to the basic configuration of our BitBucket server.</p>
</div>
<hr>
</div>
<div class="sect5">
<h6 id="dsf-openshift-services-bitbucket-basic-server-setup.asciidoc_step-4.1-click-on-the-link-of-the-external-traffic-route.-this-will-open-our-bitbucket-server-setup-wizard">Step 4.1: Click on the link of the external traffic route. This will open our BitBucket server setup wizard</h6>

</div>
<div class="sect5">
<h6 id="dsf-openshift-services-bitbucket-basic-server-setup.asciidoc_step-4.2-leave-by-the-moment-the-internal-database-since-it-is-enough-for-the-basic-setup-and-it-can-be-modified-later">Step 4.2: Leave by the moment the Internal database since it is enough for the basic setup (and it can be modified later), and click Next</h6>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/others/bitbucket/step4.2.png" alt="step4.2">
</div>
</div>
</div>
<div class="sect5">
<h6 id="dsf-openshift-services-bitbucket-basic-server-setup.asciidoc_step-4.3-select-the-evaluation-license">Step 4.3: Select the evaluation license, and click I have an account</h6>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/others/bitbucket/step4.3.png" alt="step4.3">
</div>
</div>
</div>
<div class="sect5">
<h6 id="dsf-openshift-services-bitbucket-basic-server-setup.asciidoc_step-4.4-select-the-option-bitbucker-server">Step 4.4: Select the option Bitbucker (Server)</h6>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/others/bitbucket/step4.4.png" alt="step4.4">
</div>
</div>
</div>
<div class="sect5">
<h6 id="dsf-openshift-services-bitbucket-basic-server-setup.asciidoc_step-4.5-introduce-your-organization-capgemini">Step 4.5: Introduce your organization (Capgemini), and click Generate License</h6>

</div>
<div class="sect5">
<h6 id="dsf-openshift-services-bitbucket-basic-server-setup.asciidoc_step-4.6-confirm-that-you-want-to-install-the-license-on-the-bitbucket-server">Step 4.6: Confirm that you want to install the license on the BitBucket server</h6>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/others/bitbucket/step4.6.png" alt="step4.6">
</div>
</div>
<div class="paragraph">
<p>The license key will be automatically generated. Click <strong>Next</strong></p>
</div>
</div>
<div class="sect5">
<h6 id="dsf-openshift-services-bitbucket-basic-server-setup.asciidoc_step-4.7-introduce-the-details-of-the-administration-account.">Step 4.7: Introduce the details of the Administration account.</h6>
<div class="paragraph">
<p>Since our BitBucket server is not going to be integrated with JIRA, click on Go to Bitbucket. The integration with JIRA can be configured later.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/others/bitbucket/step4.7.png" alt="step4.7">
</div>
</div>
</div>
<div class="sect5">
<h6 id="dsf-openshift-services-bitbucket-basic-server-setup.asciidoc_step-4.8-log-in-with-the-admin-account-that-has-been-just-created">Step 4.8: Log in with the admin account that has been just created</h6>

</div>
<div class="sect5">
<h6 id="dsf-openshift-services-bitbucket-basic-server-setup.asciidoc_done-">DONE !!</h6>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/others/bitbucket/done.png" alt="done">
</div>
</div>
<div class="paragraph">
<p><em>[Under construction]</em></p>
</div>
<hr>
<div class="paragraph">
<p>The purpose of the present document is to provide the basic steps carried out to improve the configuration of BitBucket server in OpenShift.</p>
</div>
<div class="paragraph">
<p>The improved configuration consists on:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Persistent Volume Claims</p>
</li>
<li>
<p>Health Checks <em>(pending to be completed)</em></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect4">
<h5 id="dsf-openshift-services-bitbucket-extra-server-configuration.asciidoc_persistent-volume-claims.">Persistent Volume Claims.</h5>
<div class="paragraph">
<p>Please notice that the BitBucket server container does not use persistent volume claims by default, which means that the data (e.g.: BitBucket server config.) will be lost from one deployment to another.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/others/bitbucket/xtraconfig/pvc0.png" alt="pvc0">
</div>
</div>
<div class="paragraph">
<p><strong>It is very important to create a persistent volume claim in order to prevent the mentioned loss of data.</strong></p>
</div>
<div class="sect5">
<h6 id="dsf-openshift-services-bitbucket-extra-server-configuration.asciidoc_step-1-add-storage">Step 1: Add storage</h6>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/others/bitbucket/xtraconfig/pvc1.png" alt="pvc1">
</div>
</div>
</div>
<div class="sect5">
<h6 id="dsf-openshift-services-bitbucket-extra-server-configuration.asciidoc_step-2-select-the-appropriate-storage">Step 2: Select the appropriate storage, or create it from scratch if necessary</h6>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/others/bitbucket/xtraconfig/pvc2.png" alt="pvc2">
</div>
</div>
</div>
<div class="sect5">
<h6 id="dsf-openshift-services-bitbucket-extra-server-configuration.asciidoc_step-3-introduce-the-required-information">Step 3: Introduce the required information</h6>
<div class="ulist">
<ul>
<li>
<p><strong>Path</strong> as it is specified in the <a href="https://hub.docker.com/r/atlassian/bitbucket-server/">BitBucket server Docker image</a> (/var/atlassian/application-data/bitbucket)</p>
</li>
<li>
<p><strong>Volume name</strong> with a unique name to clearly identify the volume</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/others/bitbucket/xtraconfig/pvc3.png" alt="pvc3">
</div>
</div>
</div>
<div class="sect5">
<h6 id="dsf-openshift-services-bitbucket-extra-server-configuration.asciidoc_the-change-will-be-inmediately-applied">The change will be inmediately applied</h6>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/others/bitbucket/xtraconfig/done.png" alt="done">
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="dsf-openshift-services-selenium-basic-grid.asciidoc">37.2. Basic Selenium Grid setup in OpenShift</h3>
<div class="paragraph">
<p><em>[Under construction]</em></p>
</div>
<hr>
<div class="paragraph">
<p>The purpose of the present document is to provide the basic steps carried out to setup a Selenium Grid (Hub + Nodes) in OpenShift.</p>
</div>
<div class="sect3">
<h4 id="dsf-openshift-services-selenium-basic-grid.asciidoc_introduction">37.2.1. Introduction</h4>
<div class="paragraph">
<p>Selenium is a tool to automate web browser across many platforms. It allows the automation of the testing in many different browsers, operating systems, programing laguages, or testing frameworks. (for further information pelase see <a href="http://www.seleniumhq.org/">Selenium</a>)</p>
</div>
<div class="paragraph">
<p>Selenium Grid is the platform provided by Selenium in order to perform the execution of tests in parallel and in a distributed way.</p>
</div>
<div class="paragraph">
<p>It basically consists on a Selenium Server (also known as hub or simply server) which redirects the requests it receives to the appropriate node (Firefox node, Chrome node, &#8230;&#8203;) depending on how the Selenium WebDriver is configured or implemented (See <a href="http://www.seleniumhq.org/docs/">Selenium Doc.</a>)</p>
</div>
<div class="sect4">
<h5 id="dsf-openshift-services-selenium-basic-grid.asciidoc_additional-documentacion">Additional documentacion:</h5>
<div class="ulist">
<ul>
<li>
<p><a href="https://www.tutorialspoint.com/selenium/selenium_grids.htm" class="bare">https://www.tutorialspoint.com/selenium/selenium_grids.htm</a></p>
</li>
<li>
<p><a href="http://www.softwaretestinghelp.com/selenium-ide-download-and-installation-selenium-tutorial-2" class="bare">http://www.softwaretestinghelp.com/selenium-ide-download-and-installation-selenium-tutorial-2</a></p>
</li>
<li>
<p><a href="https://examples.javacodegeeks.com/enterprise-java/selenium/selenium-standalone-server-example" class="bare">https://examples.javacodegeeks.com/enterprise-java/selenium/selenium-standalone-server-example</a></p>
</li>
<li>
<p><a href="https://tripleqa.com/2016/09/26/hello-world-selenium" class="bare">https://tripleqa.com/2016/09/26/hello-world-selenium</a></p>
</li>
<li>
<p><a href="http://queirozf.com/entries/selenium-hello-world-style-tutorial" class="bare">http://queirozf.com/entries/selenium-hello-world-style-tutorial</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="dsf-openshift-services-selenium-basic-grid.asciidoc_prerequisites">37.2.2. Prerequisites</h4>
<div class="ulist">
<ul>
<li>
<p>OpenShift up &amp; running</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="dsf-openshift-services-selenium-basic-grid.asciidoc_procedure">37.2.3. Procedure</h4>
<div class="paragraph">
<p>The present procedure is divided into two different main parts:
* First part: Selenium Hub (server) installation
* Second part: Selenium node installation (Firefox &amp; Chrome)
* Create persistent volumes for the hub and the node(s)</p>
</div>
<div class="sect4">
<h5 id="dsf-openshift-services-selenium-basic-grid.asciidoc_selenium-hub-installation">Selenium Hub installation</h5>
<div class="paragraph">
<p>The followed approach consists on deploying new image from the OpenShift WenConsole.</p>
</div>
<div class="paragraph">
<p>The image as well as its documentation and details can be found at <a href="https://hub.docker.com/r/selenium/hub/">Selenium Hub Docker Image</a></p>
</div>
<div class="sect5">
<h6 id="dsf-openshift-services-selenium-basic-grid.asciidoc_step-1-deploy-image">Step 1: Deploy Image</h6>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/others/selenium/hub/step1.png" alt="step1">
</div>
</div>
</div>
<div class="sect5">
<h6 id="dsf-openshift-services-selenium-basic-grid.asciidoc_step-2-image-name">Step 2: Image Name</h6>
<div class="paragraph">
<p>As it is specified in the <a href="https://hub.docker.com/r/selenium/hub/">documentation</a> <em>(selenium/hub)</em></p>
</div>
<div class="paragraph">
<p><em>(Please notice that, as it is described in the additional documentation of the above links, the server will run by default on <strong>4444</strong> port)</em></p>
</div>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/others/selenium/hub/step2.png" alt="step2">
</div>
</div>
</div>
<div class="sect5">
<h6 id="dsf-openshift-services-selenium-basic-grid.asciidoc_step-3-introduce-the-appropriate-resource-name">Step 3: Introduce the appropriate resource name</h6>
<div class="paragraph">
<p><em>(selenium-hub in this case)</em></p>
</div>
<div class="paragraph">
<p><em>(No additional config. is required by the moment)</em></p>
</div>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/others/selenium/hub/step3a.png" alt="step3a">
</div>
</div>
<div class="paragraph">
<p>Once the image is deployed, you will be able to check &amp; review the config. of the container. Please notice by, by default, <strong>no route is created for external traffic</strong>, hence the application (the selenium server or hub) is not reachable from outside the cluster</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/others/selenium/hub/step3b.png" alt="step3b">
</div>
</div>
</div>
<div class="sect5">
<h6 id="dsf-openshift-services-selenium-basic-grid.asciidoc_step-4-create-a-route-for-external-traffic">Step 4: Create a route for external traffic</h6>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/others/selenium/hub/step4.png" alt="step4">
</div>
</div>
</div>
<div class="sect5">
<h6 id="dsf-openshift-services-selenium-basic-grid.asciidoc_step-5-change-the-default-config.-if-necessary">Step 5: Change the default config. if necessary</h6>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/others/selenium/hub/step5.png" alt="step5">
</div>
</div>
</div>
<div class="sect5">
<h6 id="dsf-openshift-services-selenium-basic-grid.asciidoc_done-">DONE !!</h6>
<div class="paragraph">
<p>The Selenium Server is now accesible from outside the cluster. Click on the link of the route and you will be able to see the server home page.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/others/selenium/hub/done1.png" alt="done1">
</div>
</div>
</div>
<div class="sect5">
<h6 id="dsf-openshift-services-selenium-basic-grid.asciidoc_consoleview-config-to-see-the-default-server-config.">console/view config to see the default server config.</h6>
<div class="paragraph">
<p>Please notice that the server is not detecting any node up &amp; running, since we have not yet installed none of them.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/others/selenium/hub/done2.png" alt="done2">
</div>
</div>
<hr>
</div>
</div>
<div class="sect4">
<h5 id="dsf-openshift-services-selenium-basic-grid.asciidoc_selenium-node-firefox-installation">Selenium Node Firefox installation</h5>
<div class="paragraph">
<p><em>(Same steps apply for Selenium Node Chrome with the selenium/node-chrome Docker image)</em></p>
</div>
<div class="paragraph">
<p>The key point of the nodes installation is to specify the host name and port of the hub. If this step is not correctly done, the container will be setup but the application will not run.</p>
</div>
<div class="paragraph">
<p>The followed approach consists on deploying new image from the OpenShift WenConsole.</p>
</div>
<div class="paragraph">
<p>The image as well as its documentation and details can be found at <a href="https://hub.docker.com/r/selenium/node-firefox/">Selenium Hub Docker Image</a> <em>(firefox node in this case)</em></p>
</div>
<div class="sect5">
<h6 id="dsf-openshift-services-selenium-basic-grid.asciidoc_step-1-deploy-image">Step 1: Deploy Image</h6>
<div class="paragraph">
<p>Introduce the appropriate Docker Image name as it is specified in the <a href="https://hub.docker.com/r/selenium/node-firefox/">documentation</a> <em>(selenium/node-firefox)</em></p>
</div>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/others/selenium/node/step1.png" alt="step1">
</div>
</div>
</div>
<div class="sect5">
<h6 id="dsf-openshift-services-selenium-basic-grid.asciidoc_step-2-introduce-the-appropriate-resource-name">Step 2: Introduce the appropriate resource name</h6>
<div class="paragraph">
<p><em>(selenium-node-firefox in this case)</em></p>
</div>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/others/selenium/node/step2.png" alt="step2">
</div>
</div>
</div>
<div class="sect5">
<h6 id="dsf-openshift-services-selenium-basic-grid.asciidoc_step-3-introduce">Step 3: Introduce, as environment variables, the host name and port of the selenium hub previously created</h6>
<div class="paragraph">
<p><strong>Env. var. for selenium hub host name</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Name: HUB_PORT_4444_TCP_ADDR</p>
</li>
<li>
<p>Value: The Selenium hub host name. It&#8217;s recommended to use the service name of the internal OpenShift service.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Env. var. for host selenium hub host port</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Name: HUB_PORT_4444_TCP_PORT</p>
</li>
<li>
<p>Value: 4444 <em>(by default)</em>, or the appropriate one if it was changed during the installation.</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/others/selenium/node/step3.png" alt="step3">
</div>
</div>
</div>
<div class="sect5">
<h6 id="dsf-openshift-services-selenium-basic-grid.asciidoc_done-">DONE !!</h6>
<div class="paragraph">
<p>If the creation of the container was correct, we will be able to see our new selenium-node-firefox application up &amp; running, as well as we will be able to see that the firefox node has correctly detected the selenium hub <em>(in the log of the POD)</em></p>
</div>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/others/selenium/node/done1.png" alt="done1">
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/others/selenium/node/done2.png" alt="done2">
</div>
</div>
<div class="paragraph">
<p>If we go back to the configuration of the SeleniumHub through the WebConsole, we also will be able to see the our new firefox node</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/others/selenium/node/done3.png" alt="done3">
</div>
</div>
<hr>
</div>
</div>
<div class="sect4">
<h5 id="dsf-openshift-services-selenium-basic-grid.asciidoc_persistent-volumes">Persistent Volumes</h5>
<div class="paragraph">
<p>Last part of the installation of the Selenium Grid consists on creating persistent volumes for both, the hub container and the node container.</p>
</div>
<div class="paragraph">
<p>Persistent Volumes can be easely created folling the the <a href="#dsf-openshift-services-bitbucket-extra-server-configuration.asciidoc">BitBucket Extra server configuration</a></p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="dsf-mirabaud-cicd-environment-setup.asciidoc">37.3. Mirabaud CICD Environment Setup</h3>
<div class="paragraph">
<p>Initial requirements:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>OS</strong>: RHEL 6.5</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Remote setup in CI machine (located in the Netherlands)</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>    - Jenkins
    - Nexus
    - GitLab
    - Mattermost
    - Atlassian Crucible
    - SonarQube</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="dsf-mirabaud-cicd-environment-setup.asciidoc_1.-install-docker-and-docker-compose-in-rhel-6.5">37.3.1. 1. Install Docker and Docker Compose in RHEL 6.5</h4>
<div class="sect4">
<h5 id="dsf-mirabaud-cicd-environment-setup.asciidoc_docker">Docker</h5>
<div class="paragraph">
<p>Due to that OS version, the only way to have Docker running in the CI machine is by installing it from the <strong>EPEL</strong> repository (Extra Packages for Enterprise Linux).</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="1">
<li>
<p>Add EPEL</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code># rpm -iUvh http://dl.fedoraproject.org/pub/epel/6/x86_64/epel-release-6-8.noarch.rpm</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="2">
<li>
<p>Install <code>docker.io</code> from that repository</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code># yum -y install docker-io</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="3">
<li>
<p>Start Docker daemon</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code># service docker start</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="4">
<li>
<p>Check the installation</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code># docker -v
Docker version 1.7.1, build 786b29d/1.7.1</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="dsf-mirabaud-cicd-environment-setup.asciidoc_docker-compose">Docker Compose</h5>
<div class="paragraph">
<p>Download and install it via <strong>curl</strong>. It will use <a href="https://github.com/docker/compose/releases?after=1.7.0-rc2">this site</a>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code># curl -L https://github.com/docker/compose/releases/download/1.5.0/docker-compose-`uname -s`-`uname -m` &gt; /usr/local/bin/docker-compose

# chmod +x /usr/local/bin/docker-compose</code></pre>
</div>
</div>
<div class="paragraph">
<p>Add it to your <code>sudo</code> path:</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="1">
<li>
<p>Find out where it is:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre># echo $PATH</pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="2">
<li>
<p>Copy the <code>docker-compose</code> file from <code>/usr/local/bin/</code> to your <code>sudo</code> PATH.</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code># docker-compose -v
docker-compose version 1.5.2, build 7240ff3</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="dsf-mirabaud-cicd-environment-setup.asciidoc_2.-directories-structure">37.3.2. 2. Directories structure</h4>
<div class="paragraph">
<p>Several directories had been added to organize some files related to docker (like <code>docker-compose.yml</code>) and docker volumes for each service. Here&#8217;s how it looks:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">/home
    /[username]
        /jenkins
            /volumes
                /jenkins_home
        /sonarqube
            /volumes
                /conf
                /data
                /extensions
                /lib
                    /bundled-plugins
        /nexus
            /volumes
                /nexus-data
        /crucible
            /volumes
                /
        /gitlab
            docker-compose.yml
            /volumes
                /etc
                    /gitlab
                /var
                    /log
                    /opt
        /mattermost
            docker-compose.yml
            /volumes
                /db
                    /var
                        /lib
                            /postgresql
                                /data
                /app
                    /mattermost
                        /config
                        /data
                        /logs
                /web
                    /cert</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="dsf-mirabaud-cicd-environment-setup.asciidoc_3.-cicd-services-with-docker">37.3.3. 3. CICD Services with Docker</h4>
<div class="paragraph">
<p>Some naming conventions had been followed as naming containers as <code>mirabaud_[service]</code>.</p>
</div>
<div class="paragraph">
<p>Several folders have been created to store each service&#8217;s volumes, <code>docker-compose.yml</code>(s), extra configuration settings and so on:</p>
</div>
<div class="sect4">
<h5 id="dsf-mirabaud-cicd-environment-setup.asciidoc_jenkins">Jenkins</h5>
<div class="sect5">
<h6 id="dsf-mirabaud-cicd-environment-setup.asciidoc_command">Command</h6>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code># docker run -d -p 8080:8080 -p 50000:50000 --name=mirabaud_jenkins \
    -v /home/[username]/jenkins/volumes/jenkins_home:/var/jenkins_home \
    jenkins</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="dsf-mirabaud-cicd-environment-setup.asciidoc_generate-keystore">Generate keystore</h6>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>keytool -importkeystore -srckeystore server.p12 -srcstoretype pkcs12 -srcalias 1 -destkeystore newserver.jks -deststoretype jks -destalias server</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="dsf-mirabaud-cicd-environment-setup.asciidoc_start-jekins-with-ssl-todo-make-a-docker-compose.yml-for-this">Start jekins with SSL (TODO: make a docker-compose.yml for this):</h6>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>sudo docker run -d --name mirabaud_jenkins -v /jenkins:/var/jenkins_home -p 8080:8443 jenkins --httpPort=-1 --httpsPort=8443 --httpsKeyStore=/var/jenkins_home/certs/keystore.jks --httpsKeyStorePassword=Mirabaud2017</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="dsf-mirabaud-cicd-environment-setup.asciidoc_volumes">Volumes</h6>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>volumes/jenkins_home:/var/jenkins_home</code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="dsf-mirabaud-cicd-environment-setup.asciidoc_sonarqube">SonarQube</h5>
<div class="sect5">
<h6 id="dsf-mirabaud-cicd-environment-setup.asciidoc_command">Command</h6>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code># docker run -d -p 9000:9000 -p 9092:9092 --name=mirabaud_sonarqube \
    -v /home/[username]/sonarqube/volumes/conf:/opt/sonarqube/conf \
    -v /home/[username]/sonarqube/volumes/data:/opt/sonarqube/data \
    -v /home/[username]/sonarqube/volumes/extensions:/opt/sonarqube/extensions \
    -v /home/[username]/sonarqube/volumes/lib/bundled-plugins:/opt/sonarqube//lib/bundled-plugins \
    sonarqube</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="dsf-mirabaud-cicd-environment-setup.asciidoc_volumes">Volumes</h6>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>volumes/conf:/opt/sonarqube/conf
volumes/data:/opt/sonarqube/data
volumes/extensions:/opt/sonarqube/extensions
volumes/lib/bundled-plugins:/opt/sonarqube/lib/bundled-plugins</code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="dsf-mirabaud-cicd-environment-setup.asciidoc_nexus">Nexus</h5>
<div class="sect5">
<h6 id="dsf-mirabaud-cicd-environment-setup.asciidoc_command">Command</h6>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code># docker run -d -p 8081:8081 --name=mirabaud_nexus\
    -v /home/[username]/nexus/nexus-data:/sonatype-work
    sonatype/nexus</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="dsf-mirabaud-cicd-environment-setup.asciidoc_volumes">Volumes</h6>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>volumes/nexus-data/:/sonatype-work</code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="dsf-mirabaud-cicd-environment-setup.asciidoc_atlassian-crucible">Atlassian Crucible</h5>
<div class="sect5">
<h6 id="dsf-mirabaud-cicd-environment-setup.asciidoc_command">Command</h6>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code># docker run -d -p 8084:8080 --name=mirabaud_crucible \
    -v /home/[username]/crucible/volumes/data:/atlassian/data/crucible
    mswinarski/atlassian-crucible:latest</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="dsf-mirabaud-cicd-environment-setup.asciidoc_volumes">Volumes</h6>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>volumes/data:/atlassian/data/crucible</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="dsf-mirabaud-cicd-environment-setup.asciidoc_4.-cicd-services-with-docker-compose">37.3.4. 4. CICD Services with Docker Compose</h4>
<div class="paragraph">
<p>Both Services had been deploying by using the <code># docker-compose up -d</code> command from their root directories (<code>/gitlab</code> and <code>/mattermost</code>). The syntax of the two <code>docker-compose.yml</code> files is the one corresponding with the 1st version (due to the <code>docker-compose v1.5</code>).</p>
</div>
<div class="sect4">
<h5 id="dsf-mirabaud-cicd-environment-setup.asciidoc_gitlab">GitLab</h5>
<div class="sect5">
<h6 id="dsf-mirabaud-cicd-environment-setup.asciidoc_docker-compose.yml"><code>docker-compose.yml</code></h6>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">mirabaud:
    image: 'gitlab/gitlab-ce:latest'
    restart: always
    ports:
            - '8888:80'
    volumes:
            - '/home/[username]/gitlab/volumes/etc/gilab:/etc/gitlab'
            - '/home/[username]/gitlab/volumes/var/log:/var/log/gitlab'
            - '/home/[username]/gitlab/volumes/var/opt:/var/opt/gitlab'</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="dsf-mirabaud-cicd-environment-setup.asciidoc_command-docker">Command (docker)</h6>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>docker run -d -p 8888:80 --name=mirabaud_gitlab \
    -v /home/[username]/gitlab/volumes/etc/gitlab/:/etc/gitlab \
    -v /home/[username]/gitlab/volumes/var/log:/var/log/gitlab \
    -v /home/[username]/gitlab/volumes/var/opt:/var/opt/gitlab \
    gitlab/gitlab-ce</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="dsf-mirabaud-cicd-environment-setup.asciidoc_volumes">Volumes</h6>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>volumes/etc/gitlab:/etc/gitlab
volumes/var/opt:/var/log/gitlab
volumes/var/log:/var/log/gitlab</code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="dsf-mirabaud-cicd-environment-setup.asciidoc_mattermost">Mattermost</h5>
<div class="sect5">
<h6 id="dsf-mirabaud-cicd-environment-setup.asciidoc_docker-compose.yml"><code>docker-compose.yml</code>:</h6>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">db:
  image: mattermost/mattermost-prod-db
  restart: unless-stopped
  volumes:
    - ./volumes/db/var/lib/postgresql/data:/var/lib/postgresql/data
    - /etc/localtime:/etc/localtime:ro
  environment:
    - POSTGRES_USER=mmuser
    - POSTGRES_PASSWORD=mmuser_password
    - POSTGRES_DB=mattermost

app:
  image: mattermost/mattermost-prod-app
  links:
    - db:db
  restart: unless-stopped
  volumes:
    - ./volumes/app/mattermost/config:/mattermost/config:rw
    - ./volumes/app/mattermost/data:/mattermost/data:rw
    - ./volumes/app/mattermost/logs:/mattermost/logs:rw
    - /etc/localtime:/etc/localtime:ro
  environment:
    - MM_USERNAME=mmuser
    - MM_PASSWORD=mmuser_password
    - MM_DBNAME=mattermost

web:
  image: mattermost/mattermost-prod-web
  ports:
    - "8088:80"
    - "8089:443"
  links:
    - app:app
  restart: unless-stopped
  volumes:
    - ./volumes/web/cert:/cert:ro
    - /etc/localtime:/etc/localtime:ro</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="dsf-mirabaud-cicd-environment-setup.asciidoc_ssl-certificate">SSL Certificate</h6>
<div class="paragraph">
<p>How to generate the certificates:</p>
</div>
<div class="paragraph">
<p>Get the <strong>crt</strong> and <strong>key</strong> from CA or <strong>generate a new one self-signed</strong>. Then:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>// 1. create the p12 keystore
# openssl pkcs12 -export -in cert.crt -inkey mycert.key -out certkeystore.p12

// 2. export the pem certificate with password
# openssl pkcs12 -in certkeystore.p12 -out cert.pem

// 3. export the pem certificate without password
# openssl rsa -in cert.pem -out key-no-password.pem</code></pre>
</div>
</div>
<div class="paragraph">
<p>SSL:</p>
</div>
<div class="paragraph">
<p>Copy the cert and the key without password at:</p>
</div>
<div class="paragraph">
<p><code>./volumes/web/cert/cert.pem</code></p>
</div>
<div class="paragraph">
<p>and</p>
</div>
<div class="paragraph">
<p><code>./volumes/web/cert/key-no-password.pem</code></p>
</div>
<div class="paragraph">
<p>Restart the server and the SSL should be enabled at port <strong>8089</strong> using <strong>HTTPS</strong>.</p>
</div>
</div>
<div class="sect5">
<h6 id="dsf-mirabaud-cicd-environment-setup.asciidoc_volumes">Volumes</h6>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>-- db --
volumes/db/var/lib/postgresql/data:/var/lib/postgresql/data
/etc/localtime:/etc/localtime:ro                                # absolute path

-- app --
volumes/app/mattermost/config:/mattermost/config:rw
volumes/app/mattermost/data:/mattermost/data:rw
volumes/app/mattermost/logs:/mattermost/logs:rw
/etc/localtime:/etc/localtime:ro                                # absolute path

-- web --
volumes/web/cert:/cert:ro
/etc/localtime:/etc/localtime:ro                                # absolute path</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="dsf-mirabaud-cicd-environment-setup.asciidoc_5.-service-integration">37.3.5. 5. Service Integration</h4>
<div class="paragraph">
<p>All integrations had been done following <strong>CICD Services Integration</strong> guides:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#dsf-mirabaud-jenkins-nexus-integration.asciidoc">Jenkins - Nexus integration</a></p>
</li>
<li>
<p><a href="#dsf-mirabaud-jenkins-gitLab-integration.asciidoc">Jenkins - GitLab integration</a></p>
</li>
<li>
<p><a href="#dsf-mirabaud-jenkins-sonarQube-integration.asciidoc">Jenkins - SonarQube integration</a></p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
These guides may be obsolete. You can find here the <a href="dsf-how-to-use.html#Step-1---Configuration-and-service-integration">official configuration guides</a>,
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="dsf-mirabaud-jenkins-gitLab-integration.asciidoc">37.3.6. Jenkins - GitLab integration</h4>
<div class="paragraph">
<p>The first step to have a Continuous Integration system for your development is to make sure that all your changes to your team&#8217;s remote repository are evaluated by the time they are pushed. That usually implies the usage of so-called <em>webhooks</em>. You&#8217;ll find a fancy explanation about what Webhooks are in <a href="http://culttt.com/2014/01/22/webhooks/">here</a>.</p>
</div>
<div class="paragraph">
<p>To resume what we&#8217;re doing here, we are going to prepare our Jenkins and our GitLab so when a developer pushes some changes to the GitLab repository, a pipeline in Jenkins gets triggered. Just like that, in an automatic way.</p>
</div>
<div class="sect4">
<h5 id="dsf-mirabaud-jenkins-gitlab-integration.asciidoc_1.-jenkins-gitlab-plugin">1. Jenkins GitLab plugin</h5>
<div class="paragraph">
<p>As it usually happens, some Jenkins plug-in(s) must be installed. In this case, let&#8217;s install those related with GitLab:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/others/jenkins-gitlab/jenkins-gitlab-plugins.png" alt="jenkins gitlab plugins">
</div>
</div>
</div>
<div class="sect4">
<h5 id="dsf-mirabaud-jenkins-gitlab-integration.asciidoc_2.-gitlab-api-token">2. GitLab API Token</h5>
<div class="paragraph">
<p>To communicate with GitLab from Jenkins, we will need to create an authentication token from your GitLab user settings. A good practice for this would be to create it from a <em>machine user</em>. Something like (i.e.) <code>devonfw-ci/******</code>.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/others/jenkins-gitlab/gitlab-access-token.png" alt="gitlab access token">
</div>
</div>
<div class="paragraph">
<p>Simply by adding a name to it and a date for it expire is enough:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/others/jenkins-gitlab/gitlab-access-token-generation.png" alt="gitlab access token generation">
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/others/jenkins-gitlab/gitlab-access-token-generated.png" alt="gitlab access token generated">
</div>
</div>
<div class="paragraph">
<p>As GitLab said, you should make sure you don&#8217;t lose your token. Otherwise you would need to create a new one.</p>
</div>
<div class="paragraph">
<p>This will allow Jenkins to connect with right permissions to our GitLab server.</p>
</div>
</div>
<div class="sect4">
<h5 id="dsf-mirabaud-jenkins-gitlab-integration.asciidoc_3.-create-gitlab-api-token-credentials">3. Create "GitLab API" Token credentials</h5>
<div class="paragraph">
<p>Those credentials will use that token already generated in GitLab to connect once we declare the GitLab server in the Global Jenkins configuration. Obviously, those credentials must be <strong>GitLab API token</strong>-like.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/others/jenkins-gitlab/jenkins-gitlab-api-token-credentials-kind.png" alt="jenkins gitlab api token credentials kind">
</div>
</div>
<div class="paragraph">
<p>Then, we add the generated token in the <code>API token</code> field:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/others/jenkins-gitlab/jenkins-gitlab-api-token-credentials-complete.png" alt="jenkins gitlab api token credentials complete">
</div>
</div>
<div class="paragraph">
<p>Look in your Global credentials if they had been correctly created:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/others/jenkins-gitlab/jenkins-gitlab-api-token-credentials.png" alt="jenkins gitlab api token credentials">
</div>
</div>
</div>
<div class="sect4">
<h5 id="dsf-mirabaud-jenkins-gitlab-integration.asciidoc_4.-create-gitlab-connection-in-jenkins">4. Create GitLab connection in Jenkins</h5>
<div class="paragraph">
<p>Specify a GitLab connection in your Jenkins&#8217;s <code>Manage Jenkins &gt; Configure System</code> configuration. This will tell Jenkins where is our GitLab server, a user to access it from and so on.</p>
</div>
<div class="paragraph">
<p>You&#8217;ll need to give it a name, for example, related with what this GitLab is dedicated for (specific clients, internal projects&#8230;&#8203;). Then, the <code>Gitlab host URL</code> is just where your GitLab server is. If you have it locally, that field should look similar to:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Connection name: <code>my-local-gitlab</code></p>
</li>
<li>
<p>Gitlab host URL: <code>http://localhost:${PORT_NUMBER}</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Finally, we select our recently GitLab API token as credentials.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/others/jenkins-gitlab/jenkins-gitlab-connection.png" alt="jenkins gitlab connection">
</div>
</div>
</div>
<div class="sect4">
<h5 id="dsf-mirabaud-jenkins-gitlab-integration.asciidoc_5.-jenkins-pipeline-changes">5. Jenkins Pipeline changes</h5>
<div class="sect5">
<h6 id="dsf-mirabaud-jenkins-gitlab-integration.asciidoc_5.1-choose-gitlab-connection-in-pipelines-general-configuration">5.1 Choose GitLab connection in Pipeline&#8217;s General configuration</h6>
<div class="paragraph">
<p>First, our pipeline should allow us to add a GitLab connection to connect to (the already created one).</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/others/jenkins-gitlab/jenkins-pipeline-gitlab-connection.png" alt="jenkins pipeline gitlab connection">
</div>
</div>
<div class="paragraph">
<p>In the case of the local example, could be like this:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>GitLab connection: <code>my-local-gitlab</code></p>
</li>
<li>
<p>GitLab Repository Name: <code>myusername/webhook-test</code> (for example)</p>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="dsf-mirabaud-jenkins-gitlab-integration.asciidoc_5.2-create-a-build-trigger">5.2 Create a Build Trigger</h6>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>You should already see your GitLab project&#8217;s URL (as you stated in the General settings of the Pipeline).</p>
</li>
<li>
<p>Write <code>.*build.*</code> in the comment for triggering a build</p>
</li>
<li>
<p>Specify or filter the branch of your repo you want use as target. That means, whenever a git action is done to that branch (for example, <code>master</code>), this Pipeline is going to be built.</p>
</li>
<li>
<p>Generate a Secret token (to be added in the yet-to-be-created GitLab webhook).</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/others/jenkins-gitlab/jenkins-pipeline-build-trigger.png" alt="jenkins pipeline build trigger">
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="dsf-mirabaud-jenkins-gitlab-integration.asciidoc_6.-gitlab-webhook">6. GitLab Webhook</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Go to you GitLab project&#8217;s <code>Settings &gt; Integration</code> section.</p>
</li>
<li>
<p>Add the path to your Jenkins Pipeline. Make sure you add <strong>project</strong> instead of <strong>job</strong> in the path.</p>
</li>
<li>
<p>Paste the generated Secret token of your Jenkins pipeline</p>
</li>
<li>
<p>Select your git action that will trigger the build.</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/others/jenkins-gitlab/gitlab-webhook.png" alt="gitlab webhook">
</div>
</div>
</div>
<div class="sect4">
<h5 id="dsf-mirabaud-jenkins-gitlab-integration.asciidoc_7.-results">7. Results</h5>
<div class="paragraph">
<p>After all those steps you should have a result similar to this in your Pipeline:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/others/jenkins-gitlab/jenkins-pipeline-result.png" alt="jenkins pipeline result">
</div>
</div>
<div class="paragraph">
<p>Enjoy the Continuous Integration! :)</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="dsf-mirabaud-jenkins-nexus-integration.asciidoc">37.3.7. Jenkins - Nexus integration</h4>
<div class="paragraph">
<p>Nexus is used to both host dependencies for devonfw projects to download (common Maven ones, custom ones such as <code>ojdb</code> and even devonfw so-far-IP modules). Moreover, it will host our projects' build artifacts (<code>.jar</code>, <code>.war</code>, &#8230;&#8203;) and expose them for us to download, wget and so on. A team should have a bidirectional relation with its Nexus repository.</p>
</div>
<div class="sect4">
<h5 id="dsf-mirabaud-jenkins-nexus-integration.asciidoc_1.-jenkins-credentials-to-access-nexus">1. Jenkins credentials to access Nexus</h5>
<div class="paragraph">
<p>By default, when Nexus is installed, it contains 3 user credentials for different purposes. The admin ones look like this: <code>admin/admin123</code>. There are also other 2: <code>deployment/deployment123</code> and <code>TODO</code>.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>// ADD USER TABLE IMAGE FROM NEXUS</pre>
</div>
</div>
<div class="paragraph">
<p>In this case, let&#8217;s use the ones with the greater permissions: <code>admin/admin123</code>.</p>
</div>
<div class="paragraph">
<p>Go to <code>Credentials &gt; System</code> (left sidebar of Jenkins) then to <code>Global credentials (unrestricted)</code> on the page table and on the left sidebar again click on <code>Add Credentials</code>.</p>
</div>
<div class="paragraph">
<p>This should be shown in your Jenkins:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/others/jenkins-nexus/jenkins-new-nexus-credentials.png" alt="jenkins new nexus credentials">
</div>
</div>
<div class="paragraph">
<p>Fill the form like this:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/others/jenkins-nexus/jenkins-new-nexus-credentials-filled.png" alt="jenkins new nexus credentials filled">
</div>
</div>
<div class="paragraph">
<p>And click in OK to create them. Check if the whole thing went as expected:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/others/jenkins-nexus/jenkins-new-nexus-credentials-completed.png" alt="jenkins new nexus credentials completed">
</div>
</div>
</div>
<div class="sect4">
<h5 id="dsf-mirabaud-jenkins-nexus-integration.asciidoc_2.-jenkins-maven-settings">2. Jenkins Maven Settings</h5>
<div class="paragraph">
<p>Those settings are also configured (or maybe not-yet-configured) in our <strong>devonfw distributions</strong> in:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>/${devonfw-dist-path}
    /software
        /maven
            /conf
                settings.xml</code></pre>
</div>
</div>
<div class="paragraph">
<p>Go to <code>Manage Jenkins &gt; Managed files</code> and select <code>Add a new Config</code> in the left sidebar.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/others/jenkins-nexus/jenkins-new-maven-settings.png" alt="jenkins new maven settings">
</div>
</div>
<div class="paragraph">
<p>The ID field will get automatically filled with a unique value if you don&#8217;t set it up. No problems about that. Click on <code>Submit</code> and let&#8217;s create some Servers Credentials:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/others/jenkins-nexus/jenkins-new-maven-settings-servers.png" alt="jenkins new maven settings servers">
</div>
</div>
<div class="paragraph">
<p>Those <strong>Server Credentials</strong> will allow Jenkins to access to the different repositories/servers that are going to be declared afterwards.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s create 4 server credentials.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>my.nexus</code>: Will serve as general profile for <strong>Maven</strong>.</p>
</li>
<li>
<p><code>mynexus.releases</code>: When a <code>mvn deploy</code> process is executed, this will tell <strong>Maven</strong> where to push <strong>releases</strong> to.</p>
</li>
<li>
<p><code>mynexus.snapshots</code>: The same as before, but with <strong>snapshots</strong> instead.</p>
</li>
<li>
<p><code>mynexus.central</code>: Just in case we want to install an specific dependency that is not by default in the Maven Central repository (such as <code>ojdbc</code>), Maven will point to it instead.</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/others/jenkins-nexus/jenkins-new-maven-settings-servers-credentials.png" alt="jenkins new maven settings servers credentials">
</div>
</div>
<div class="paragraph">
<p>A more or less complete Jenkins Maven settings would look look like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;settings xmlns="http://maven.apache.org/SETTINGS/1.0.0"
          xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
          xsi:schemaLocation="http://maven.apache.org/SETTINGS/1.0.0 http://maven.apache.org/xsd/settings-1.0.0.xsd"&gt;

    &lt;mirrors&gt;
        &lt;mirror&gt;
            &lt;id&gt;mynexus.central&lt;/id&gt;
            &lt;mirrorOf&gt;central&lt;/mirrorOf&gt;
            &lt;name&gt;central&lt;/name&gt;
            &lt;url&gt;http://${URL-TO-YOUR-NEXUS-REPOS}/central&lt;/url&gt;
        &lt;/mirror&gt;
    &lt;/mirrors&gt;

    &lt;profiles&gt;
        &lt;profile&gt;
            &lt;id&gt;my.nexus&lt;/id&gt;
            &lt;!-- 3 REPOS ARE DECLARED --&gt;
            &lt;repositories&gt;
                &lt;repository&gt;
                    &lt;id&gt;mynexus.releases&lt;/id&gt;
                    &lt;name&gt;mynexus Releases&lt;/name&gt;
                    &lt;url&gt;http://${URL-TO-YOUR-NEXUS-REPOS}/releases&lt;/url&gt;
                    &lt;releases&gt;
                        &lt;enabled&gt;true&lt;/enabled&gt;
                        &lt;updatePolicy&gt;always&lt;/updatePolicy&gt;
                    &lt;/releases&gt;
                    &lt;snapshots&gt;
                        &lt;enabled&gt;false&lt;/enabled&gt;
                        &lt;updatePolicy&gt;always&lt;/updatePolicy&gt;
                    &lt;/snapshots&gt;
                &lt;/repository&gt;
                &lt;repository&gt;
                    &lt;id&gt;mynexus.snapshots&lt;/id&gt;
                    &lt;name&gt;mynexus Snapshots&lt;/name&gt;
                    &lt;url&gt;http://${URL-TO-YOUR-NEXUS-REPOS}/snapshots&lt;/url&gt;
                    &lt;releases&gt;
                        &lt;enabled&gt;false&lt;/enabled&gt;
                        &lt;updatePolicy&gt;always&lt;/updatePolicy&gt;
                    &lt;/releases&gt;
                    &lt;snapshots&gt;
                        &lt;enabled&gt;true&lt;/enabled&gt;
                        &lt;updatePolicy&gt;always&lt;/updatePolicy&gt;
                    &lt;/snapshots&gt;
                &lt;/repository&gt;
            &lt;/repositories&gt;
            &lt;pluginRepositories&gt;
                &lt;pluginRepository&gt;
                    &lt;id&gt;public&lt;/id&gt;
                    &lt;name&gt;Public Repositories&lt;/name&gt;
                    &lt;url&gt;http://${URL-TO-YOUR-NEXUS}/nexus/content/groups/public/&lt;/url&gt;
                    &lt;releases&gt;
                        &lt;enabled&gt;true&lt;/enabled&gt;
                        &lt;updatePolicy&gt;always&lt;/updatePolicy&gt;
                    &lt;/releases&gt;
                    &lt;snapshots&gt;
                        &lt;enabled&gt;true&lt;/enabled&gt;
                        &lt;updatePolicy&gt;always&lt;/updatePolicy&gt;
                    &lt;/snapshots&gt;
                &lt;/pluginRepository&gt;
            &lt;/pluginRepositories&gt;
        &lt;/profile&gt;
    &lt;/profiles&gt;
    &lt;!-- HERE IS WHERE WE TELL MAVEN TO CHOOSE THE my.nexus PROFILE --&gt;
    &lt;activeProfiles&gt;
        &lt;activeProfile&gt;my.nexus&lt;/activeProfile&gt;
    &lt;/activeProfiles&gt;
&lt;/settings&gt;</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="dsf-mirabaud-jenkins-nexus-integration.asciidoc_3.-use-it-in-jenkins-pipelines">3. Use it in Jenkins Pipelines</h5>

</div>
</div>
<div class="sect3">
<h4 id="dsf-mirabaud-jenkins-sonarqube-integration.asciidoc">37.3.8. Jenkins - SonarQube integration</h4>
<div class="paragraph">
<p>First thing is installing both tools by, for example, Docker or Docker Compose. Then, we have to think about how they should collaborate to create a more efficient Continuous Integration process.</p>
</div>
<div class="paragraph">
<p>Once our project&#8217;s pipeline is triggered (it could also be triggered in a fancy way, such as when a merge to the <code>develop</code> branch is done).</p>
</div>
<div class="sect4">
<h5 id="dsf-mirabaud-jenkins-sonarqube-integration.asciidoc_1.-jenkins-sonarqube-plugin">1. Jenkins SonarQube plugin</h5>
<div class="paragraph">
<p>Typically in those integration cases, Jenkins plug-in installations become a <strong>must</strong>. Let&#8217;s look for some available SonarQube plug-in(s) for Jenkins:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/others/jenkins-sonarqube/jenkins-sonarqube-plugin.png" alt="jenkins sonarqube plugin">
</div>
</div>
</div>
<div class="sect4">
<h5 id="dsf-mirabaud-jenkins-sonarqube-integration.asciidoc_2.-sonarqube-token">2. SonarQube token</h5>
<div class="paragraph">
<p>Once installed let&#8217;s create a <strong>token</strong> in SonarQube so that Jenkins can communicate with it to trigger their Jobs. Once we install SonarQube in our CI/CD machine (ideally a remote machine) let&#8217;s login with <code>admin/admin</code> credentials:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/others/jenkins-sonarqube/sonarqube-login.png" alt="sonarqube login">
</div>
</div>
<div class="paragraph">
<p>Afterwards, SonarQube itself asks you to create this token we talked about (the name is up to you):</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/others/jenkins-sonarqube/sonarqube-token-name.png" alt="sonarqube token name">
</div>
</div>
<div class="paragraph">
<p>Then a token is generated:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/others/jenkins-sonarqube/sonarqube-token-generation.png" alt="sonarqube token generation">
</div>
</div>
<div class="paragraph">
<p>You click in "continue" and the token&#8217;s generation is completed:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/others/jenkins-sonarqube/sonarqube-token-done.png" alt="sonarqube token done">
</div>
</div>
</div>
<div class="sect4">
<h5 id="dsf-mirabaud-jenkins-sonarqube-integration.asciidoc_3.-jenkins-sonarqube-server-setup">3. Jenkins SonarQube Server setup</h5>
<div class="paragraph">
<p>Now we need to tell Jenkins where is SonarQube and how to communicate with it. In <code>Manage Jenkins &gt; Configure Settings</code>. We add a name for the server (up to you), where it is located (URL), version and the Server authentication token created in point 2.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/others/jenkins-sonarqube/jenkins-sonarqube-server-setup.png" alt="jenkins sonarqube server setup">
</div>
</div>
</div>
<div class="sect4">
<h5 id="dsf-mirabaud-jenkins-sonarqube-integration.asciidoc_4.-jenkins-sonarqube-scanner">4. Jenkins SonarQube Scanner</h5>
<div class="paragraph">
<p>Install a SonarQube Scanner as a Global tool in Jenkins to be used in the project&#8217;s pipeline.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/others/jenkins-sonarqube/jenkins-sonarqube-scanner.png" alt="jenkins sonarqube scanner">
</div>
</div>
</div>
<div class="sect4">
<h5 id="dsf-mirabaud-jenkins-sonarqube-integration.asciidoc_5.-pipeline-code">5. Pipeline code</h5>
<div class="paragraph">
<p>Last step is to add the SonarQube process in our project&#8217;s Jenkins pipeline. The following code will trigger a SonarQube process that will evaluate our code&#8217;s quality looking for bugs, duplications, and so on.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">    stage 'SonarQube Analysis'
        def scannerHome = tool 'SonarQube scanner';
        sh "${scannerHome}/bin/sonar-scanner \
             -Dsonar.host.url=http://url-to-your-sq-server:9000/ \
             -Dsonar.login=[SONAR_USER] -Dsonar.password=[SONAR_PASS] \
             -Dsonar.projectKey=[PROJECT_KEY] \
             -Dsonar.projectName=[PROJECT_NAME] -Dsonar.projectVersion=[PROJECT_VERSION] \
             -Dsonar.sources=. -Dsonar.java.binaries=. \
             -Dsonar.java.source=1.8 -Dsonar.language=java"</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="dsf-mirabaud-jenkins-sonarqube-integration.asciidoc_6.-results">6. Results</h5>
<div class="paragraph">
<p>After all this, you should end up having something like this in Jenkins:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/others/jenkins-sonarqube/jenkins-sonarqube-feedback.png" alt="jenkins sonarqube feedback">
</div>
</div>
<div class="paragraph">
<p>And in SonarQube:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/others/jenkins-sonarqube/sonarqube-project-result.png" alt="sonarqube project result">
</div>
</div>
</div>
<div class="sect4">
<h5 id="dsf-mirabaud-jenkins-sonarqube-integration.asciidoc_7.-changes-in-a-devonfw-project-to-execute-sonarqube-tests-with-coverage">7. Changes in a devonfw project to execute SonarQube tests with Coverage</h5>
<div class="paragraph">
<p>The plugin used to have Coverage reports in the SonarQube for devonfw projects is <strong>Jacoco</strong>. There are some changes in the project&#8217;s parent <code>pom.xml</code> that are mandatory to use it.</p>
</div>
<div class="paragraph">
<p>Inside of the <code>&lt;properties&gt;</code> tag:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;properties&gt;

    (...)

    &lt;sonar.jacoco.version&gt;3.8&lt;/sonar.jacoco.version&gt;
    &lt;sonar.java.coveragePlugin&gt;jacoco&lt;/sonar.java.coveragePlugin&gt;
    &lt;sonar.core.codeCoveragePlugin&gt;jacoco&lt;/sonar.core.codeCoveragePlugin&gt;
    &lt;sonar.dynamicAnalysis&gt;reuseReports&lt;/sonar.dynamicAnalysis&gt;
    &lt;sonar.language&gt;java&lt;/sonar.language&gt;
    &lt;sonar.java.source&gt;1.7&lt;/sonar.java.source&gt;
    &lt;sonar.junit.reportPaths&gt;target/surefire-reports&lt;/sonar.junit.reportPaths&gt;
    &lt;sonar.jacoco.reportPaths&gt;target/jacoco.exec&lt;/sonar.jacoco.reportPaths&gt;
    &lt;sonar.sourceEncoding&gt;UTF-8&lt;/sonar.sourceEncoding&gt;
    &lt;sonar.exclusions&gt;
        **/generated-sources/**/*,
        **io/oasp/mirabaud/general/**/*,
        **/*Dao.java,
        **/*Entity.java,
        **/*Cto.java,
        **/*Eto.java,
        **/*SearchCriteriaTo.java,
        **/*management.java,
        **/*SpringBootApp.java,
        **/*SpringBootBatchApp.java,
        **/*.xml,
        **/*.jsp
    &lt;/sonar.exclusions&gt;
    &lt;sonar.coverage.exclusions&gt;
        **io/oasp/mirabaud/general/**/*,
        **/*Dao.java,
        **/*Entity.java,
        **/*Cto.java,
        **/*Eto.java,
        **/*SearchCriteriaTo.java,
        **/*management.java,
        **/*SpringBootApp.java,
        **/*SpringBootBatchApp.java,
        **/*.xml,
        **/*.jsp
    &lt;/sonar.coverage.exclusions&gt;
    &lt;sonar.host.url&gt;http://${YOUR_SONAR_SERVER_URL}/&lt;/sonar.host.url&gt;
    &lt;jacoco.version&gt;0.7.9&lt;/jacoco.version&gt;

    &lt;war.plugin.version&gt;3.2.0&lt;/war.plugin.version&gt;
    &lt;assembly.plugin.version&gt;3.1.0&lt;/assembly.plugin.version&gt;
&lt;/properties&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Of course, those <code>sonar</code> amd <code>sonar.coverage</code> can/must be changed to fit with other projects.</p>
</div>
<div class="paragraph">
<p>Now add the <strong>Jacoco Listener</strong> as a dependency:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;dependencies&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;org.sonarsource.java&lt;/groupId&gt;
        &lt;artifactId&gt;sonar-jacoco-listeners&lt;/artifactId&gt;
        &lt;scope&gt;test&lt;/scope&gt;
    &lt;/dependency&gt;
&lt;/dependencies&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Plugin Management declarations:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;pluginManagement&gt;
    &lt;plugins&gt;
        &lt;plugin&gt;
            &lt;groupId&gt;org.sonarsource.scanner.maven&lt;/groupId&gt;
            &lt;artifactId&gt;sonar-maven-plugin&lt;/artifactId&gt;
            &lt;version&gt;3.2&lt;/version&gt;
        &lt;/plugin&gt;
        &lt;plugin&gt;
            &lt;groupId&gt;org.jacoco&lt;/groupId&gt;
            &lt;artifactId&gt;jacoco-maven-plugin&lt;/artifactId&gt;
            &lt;version&gt;${jacoco.version}&lt;/version&gt;
        &lt;/plugin&gt;
    &lt;/plugins&gt;
&lt;pluginManagement&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Plugins:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;plugins&gt;

    (...)

    &lt;plugin&gt;
        &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
        &lt;artifactId&gt;maven-surefire-plugin&lt;/artifactId&gt;
        &lt;version&gt;2.20.1&lt;/version&gt;
        &lt;configuration&gt;
            &lt;argLine&gt;-XX:-UseSplitVerifier -Xmx2048m ${surefireArgLine}&lt;/argLine&gt;
            &lt;testFailureIgnore&gt;false&lt;/testFailureIgnore&gt;
            &lt;useFile&gt;false&lt;/useFile&gt;
            &lt;reportsDirectory&gt;${project.basedir}/${sonar.junit.reportPaths}&lt;/reportsDirectory&gt;
            &lt;argLine&gt;${jacoco.agent.argLine}&lt;/argLine&gt;
            &lt;excludedGroups&gt;${oasp.test.excluded.groups}&lt;/excludedGroups&gt;
            &lt;alwaysGenerateSurefireReport&gt;true&lt;/alwaysGenerateSurefireReport&gt;
            &lt;aggregate&gt;true&lt;/aggregate&gt;
            &lt;properties&gt;
                &lt;property&gt;
                    &lt;name&gt;listener&lt;/name&gt;
                    &lt;value&gt;org.sonar.java.jacoco.JUnitListener&lt;/value&gt;
                &lt;/property&gt;
            &lt;/properties&gt;
        &lt;/configuration&gt;
    &lt;/plugin&gt;
    &lt;plugin&gt;
        &lt;groupId&gt;org.jacoco&lt;/groupId&gt;
        &lt;artifactId&gt;jacoco-maven-plugin&lt;/artifactId&gt;
        &lt;configuration&gt;
            &lt;argLine&gt;-Xmx128m&lt;/argLine&gt;
            &lt;append&gt;true&lt;/append&gt;
            &lt;propertyName&gt;jacoco.agent.argLine&lt;/propertyName&gt;
            &lt;destFile&gt;${sonar.jacoco.reportPath}&lt;/destFile&gt;
            &lt;excludes&gt;
                &lt;exclude&gt;**/generated-sources/**/*,&lt;/exclude&gt;
                &lt;exclude&gt;**io/oasp/${PROJECT_NAME}/general/**/*&lt;/exclude&gt;
                &lt;exclude&gt;**/*Dao.java&lt;/exclude&gt;
                &lt;exclude&gt;**/*Entity.java&lt;/exclude&gt;
                &lt;exclude&gt;**/*Cto.java&lt;/exclude&gt;
                &lt;exclude&gt;**/*Eto.java&lt;/exclude&gt;
                &lt;exclude&gt;**/*SearchCriteriaTo.java&lt;/exclude&gt;
                &lt;exclude&gt;**/*management.java&lt;/exclude&gt;
                &lt;exclude&gt;**/*SpringBootApp.java&lt;/exclude&gt;
                &lt;exclude&gt;**/*SpringBootBatchApp.java&lt;/exclude&gt;
                &lt;exclude&gt;**/*.class&lt;/exclude&gt;
            &lt;/excludes&gt;
        &lt;/configuration&gt;
        &lt;executions&gt;
            &lt;execution&gt;
                &lt;id&gt;prepare-agent&lt;/id&gt;
                &lt;phase&gt;initialize&lt;/phase&gt;
                &lt;goals&gt;
                    &lt;goal&gt;prepare-agent&lt;/goal&gt;
                &lt;/goals&gt;
                &lt;configuration&gt;
                    &lt;destFile&gt;${sonar.jacoco.reportPath}&lt;/destFile&gt;
                    &lt;append&gt;true&lt;/append&gt;
                &lt;/configuration&gt;
            &lt;/execution&gt;
            &lt;execution&gt;
                &lt;id&gt;report-aggregate&lt;/id&gt;
                &lt;phase&gt;verify&lt;/phase&gt;
                &lt;goals&gt;
                    &lt;goal&gt;report-aggregate&lt;/goal&gt;
                &lt;/goals&gt;
            &lt;/execution&gt;
            &lt;execution&gt;
                &lt;id&gt;jacoco-site&lt;/id&gt;
                &lt;phase&gt;verify&lt;/phase&gt;
                &lt;goals&gt;
                    &lt;goal&gt;report&lt;/goal&gt;
                &lt;/goals&gt;
            &lt;/execution&gt;
        &lt;/executions&gt;
    &lt;/plugin&gt;
&lt;/plugins&gt;</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="dsf-mirabaud-jenkins-sonarqube-integration.asciidoc_jenkins-sonarqube-execution">Jenkins SonarQube execution</h5>
<div class="paragraph">
<p>If the previous configuration is already setup, once Jenkins execute the sonar maven plugin, it will automatically execute coverage as well.</p>
</div>
<div class="paragraph">
<p>This is an example of a block of code from a devonfw project&#8217;s <code>Jenkinsfile</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">    withMaven(globalMavenSettingsConfig: 'YOUR_GLOBAL_MAVEN_SETTINGS', jdk: 'OpenJDK 1.8', maven: 'Maven_3.3.9') {
        sh "mvn sonar:sonar -Dsonar.login=[USERNAME] -Dsonar.password=[PASSWORD]"
    }</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="dsf-okd.asciidoc">37.4. OKD <em>(OpenShift Origin)</em></h3>
<div class="sect3">
<h4 id="dsf-okd.asciidoc_what-is-okd">37.4.1. What is OKD</h4>
<div class="paragraph">
<p>OKD is a distribution of Kubernetes optimized for continuous application development and multi-tenant deployment. OKD is the upstream Kubernetes distribution embedded in Red Hat OpenShift.</p>
</div>
<div class="paragraph">
<p>OKD embeds Kubernetes and extends it with security and other integrated concepts. OKD is also referred to as Origin in github and in the documentation.</p>
</div>
<div class="paragraph">
<p>OKD provides a complete open source container application platform. If you are looking for enterprise-level support, or information on partner certification, Red Hat also offers <a href="https://www.openshift.com/">Red Hat OpenShift Container Platform</a>.</p>
</div>
<hr>
<h4 id="dsf-okd.asciidoc_continue-reading..." class="discrete">Continue reading&#8230;&#8203;</h4>
<div class="ulist">
<ul>
<li>
<p><a href="#dsf-okd-how-to-install.asciidoc">How to install Openshift Origin</a></p>
</li>
<li>
<p><a href="#dsf-okd-initial-setup.asciidoc">Initial setup</a></p>
<div class="ulist">
<ul>
<li>
<p><a href="#dsf-okd-s2i.asciidoc">s2i</a></p>
</li>
<li>
<p><a href="#dsf-okd-templates.asciidoc">templates</a></p>
</li>
<li>
<p><a href="#dsf-okd-customize.asciidoc">Customize Openshift</a></p>
<div class="ulist">
<ul>
<li>
<p><a href="#dsf-okd-customize-icons.asciidoc">Customize icons</a></p>
</li>
<li>
<p><a href="#dsf-okd-customize-catalog.asciidoc">Customize catalog</a></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="dsf-okd-how-to-install.asciidoc">37.4.2. Install OKD <em>(Openshift Origin)</em></h4>
<div class="sect4">
<h5 id="dsf-okd-how-to-install.asciidoc_pre-requisites">Pre-requisites</h5>
<div class="sect5">
<h6 id="dsf-okd-how-to-install.asciidoc_install-docker">Install docker</h6>
<div class="paragraph">
<p><a href="https://docs.docker.com/engine/installation/linux/docker-ce/debian/#set-up-the-repository" class="bare">https://docs.docker.com/engine/installation/linux/docker-ce/debian/#set-up-the-repository</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-Shell hljs" data-lang="Shell">$ sudo groupadd docker
$ sudo usermod -aG docker $USER</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="dsf-okd-how-to-install.asciidoc_download-openshift-origin-client">Download Openshift Origin Client</h6>
<div class="paragraph">
<p>Download Openshift Origin Client from <a href="https://www.openshift.org/download.html#oc-platforms">here</a></p>
</div>
<div class="paragraph">
<p>When the download it&#8217;s complete, only extract it on the directory that you want, for example <code>/home/administrador/oc</code></p>
</div>
</div>
<div class="sect5">
<h6 id="dsf-okd-how-to-install.asciidoc_add-oc-to-path">Add oc to path</h6>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-Shell hljs" data-lang="Shell">$ export PATH=$PATH:/home/administrador/oc</code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="dsf-okd-how-to-install.asciidoc_install-openshift-cluster">Install Openshift Cluster</h5>
<div class="sect5">
<h6 id="dsf-okd-how-to-install.asciidoc_add-the-insecure-registry">Add the insecure registry</h6>
<div class="paragraph">
<p>Create file <code><code>/etc/docker/daemon.json</code></code> with the next content:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
    "insecure-registries" : [ "172.30.0.0/16" ]
}</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="dsf-okd-how-to-install.asciidoc_download-docker-images-for-openshift">Download docker images for openshift</h6>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-Shell hljs" data-lang="Shell">$ oc cluster up</code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="dsf-okd-how-to-install.asciidoc_install-oc-cluster-wrapper">Install Oc Cluster Wrapper</h5>
<div class="paragraph">
<p>To manage easier the cluster persistent, we are going to use oc cluster wrapper.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-Shell hljs" data-lang="Shell">cd /home/administrador/oc
wget https://raw.githubusercontent.com/openshift-evangelists/oc-cluster-wrapper/master/oc-cluster</code></pre>
</div>
</div>
<div class="paragraph">
<p>oc-cluster up devonfw-shop-floor --public-hostname X.X.X.X</p>
</div>
<div class="sect5">
<h6 id="dsf-okd-how-to-install.asciidoc_configure-iptables">Configure iptables</h6>
<div class="paragraph">
<p>We must create iptables rules to allow traffic from other machines.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-diff hljs" data-lang="diff">- The next commands it's to let all traffic, don't do it on a real server.

- $ iptables -F
- $ iptables -X
- $ iptables -t nat -F
- $ iptables -t nat -X
- $ iptables -t mangle -F
- $ iptables -t mangle -X
- $ iptables -P INPUT ACCEPT
- $ iptables -P OUTPUT ACCEPT
- $ iptables -P FORWARD ACCEPT</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="dsf-okd-how-to-install.asciidoc">37.4.3. How to use Oc Cluster Wrapper</h4>
<div class="paragraph">
<p>With oc cluster wrapper we could have different clusters with different context.</p>
</div>
<div class="sect4">
<h5 id="dsf-okd-how-to-install.asciidoc_cluster-up">Cluster up</h5>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-Shell hljs" data-lang="Shell">$ oc-cluster up devonfw-shop-floor --public-hostname X.X.X.X</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="dsf-okd-how-to-install.asciidoc_cluster-down">Cluster down</h5>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-Shell hljs" data-lang="Shell">$ oc-cluster down</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="dsf-okd-how-to-install.asciidoc_use-non-persistent-cluster">Use non-persistent cluster</h5>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-Shell hljs" data-lang="Shell">oc cluster up --image openshift/origin --public-hostname X.X.X.X --routing-suffix apps.X.X.X.X.nip.io</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="dsf-okd-initial-setup.asciidoc">37.4.4. devonfw Openshift Origin Initial Setup</h4>
<div class="paragraph">
<p>These are scripts to customize an Openshift cluster to be a devonfw Openshift.</p>
</div>
<div class="sect4">
<h5 id="dsf-okd-initial-setup.asciidoc_how-to-use">How to use</h5>
<div class="sect5">
<h6 id="dsf-okd-initial-setup.asciidoc_prerequisite-customize-openshift">Prerequisite: Customize Openshift</h6>
<div class="paragraph">
<p>devonfw Openshift Origin use custom icons, and we need to add it to openshift. More information:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#dsf-okd-customize.asciidoc">Customize Openshift</a></p>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="dsf-okd-initial-setup.asciidoc_script-initial-setup">Script initial-setup</h6>
<div class="paragraph">
<p>Download <a href="https://raw.githubusercontent.com/devonfw/devonfw-shop-floor/master/dsf4openshift/openshift-cluster-setup/initial-setup/initial-setup.sh">this</a> script and execute it.</p>
</div>
<div class="paragraph">
<p>More information about what this script does <a href="https://raw.githubusercontent.com/devonfw/devonfw-shop-floor/master/dsf4openshift/openshift-cluster-setup/initial-setup#script-initial-setup">here</a>.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="dsf-okd-initial-setup.asciidoc_known-issues">Known issues</h5>
<div class="sect5">
<h6 id="dsf-okd-initial-setup.asciidoc_failed-to-push-image">Failed to push image</h6>
<div class="paragraph">
<p>If you receive an error like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>error: build error: Failed to push image: After retrying 6 times, Push image still failed due to error: Get http://172.30.1.1:5000/v2/:  dial tcp 172.30.1.1:5000: getsockopt: connection refused</code></pre>
</div>
</div>
<div class="paragraph">
<p>It&#8217;s because the registry isn&#8217;t working, go to openshift console and enter into the <strong>default</strong> project <code><code><a href="https://x.x.x.x:8443/console/project/default/overview" class="bare">https://x.x.x.x:8443/console/project/default/overview</a></code></code> and you must see two resources, <strong>docker-registry</strong> and <strong>router</strong> they must be running. If they don&#8217;t work, try to deploy them and look at the logs what is happen.</p>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="dsf-okd-s2i.asciidoc">37.4.5. s2i devonfw</h4>
<div class="paragraph">
<p>This are the s2i source and templates to build an s2i images. It provides OpenShift builder images for components of the devonfw (at this moment only for angular and java).</p>
</div>
<div class="paragraph">
<p>This work is totally based on the implementation of  <a href="https://github.com/Mickuehl">Michael Kuehl</a> from RedHat for Oasp s2i.</p>
</div>
<div class="paragraph">
<p>All this information is used as a part of the <a href="#dsf-okd-initial-setup.asciidoc">initial setup</a> for openshift.</p>
</div>
<div class="sect4">
<h5 id="dsf-okd-s2i.asciidoc_previous-setup">Previous setup</h5>
<div class="paragraph">
<p>In order to build all of this, it will be necessary, first, to have a running OpenShift cluster. How to install it <a href="#dsf-okd-how-to-install.asciidoc">here</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="dsf-okd-s2i.asciidoc_usage">Usage</h5>
<div class="paragraph">
<p>Before using the builder images, add them to the OpenShift cluster.</p>
</div>
<div class="sect5">
<h6 id="dsf-okd-s2i.asciidoc_deploy-the-source-2-image-builder-images">Deploy the Source-2-Image builder images</h6>
<div class="paragraph">
<p>First, create a dedicated <code>devonfw</code> project as admin.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-Shell hljs" data-lang="Shell">$ oc new-project devonfw --display-name='devonfw' --description='devonfw Application Standard Platform'</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now add the builder image configuration and start their build.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-Shell hljs" data-lang="Shell">oc create -f https://raw.githubusercontent.com/devonfw/devonfw-shop-floor/master/dsf4openshift/openshift-devonfw-deployment/s2i/java/s2i-devonfw-java-imagestream.json --namespace=devonfw
oc create -f https://raw.githubusercontent.com/devonfw/devonfw-shop-floor/master/dsf4openshift/openshift-devonfw-deployment/s2i/angular/s2i-devonfw-angular-imagestream.json --namespace=devonfw
oc start-build s2i-devonfw-java --namespace=devonfw
oc start-build s2i-devonfw-angular --namespace=devonfw</code></pre>
</div>
</div>
<div class="paragraph">
<p>Make sure other projects can access the builder images:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-Shell hljs" data-lang="Shell">oc policy add-role-to-group system:image-puller system:authenticated --namespace=devonfw</code></pre>
</div>
</div>
<div class="paragraph">
<p>That&#8217;s all!</p>
</div>
</div>
<div class="sect5">
<h6 id="dsf-okd-s2i.asciidoc_deploy-devonfw-templates">Deploy devonfw templates</h6>
<div class="paragraph">
<p>Now, it&#8217;s time to create devonfw templates to use this s2i and add it to the browse catalog. More information <a href="#dsf-okd-templates.asciidoc">here</a>.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="dsf-okd-s2i.asciidoc_build-all">Build All</h5>
<div class="paragraph">
<p>Use <a href="https://raw.githubusercontent.com/devonfw/devonfw-shop-floor/master/dsf4openshift/openshift-cluster-setup/initial-setup/initial-setup.sh">this</a> script to automatically install and build all image streams. The script also creates templates devonfw-angular and devonfw-java inside the project 'openshift' to be used by everyone.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Open a bash shell as Administrator</p>
</li>
<li>
<p>Execute shell file:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-Shell hljs" data-lang="Shell">$ /PATH/TO/BUILD/FILE/initial-setup.sh</code></pre>
</div>
</div>
<div class="paragraph">
<p>More information about what this script does <a href="https://raw.githubusercontent.com/devonfw/devonfw-shop-floor/master/dsf4openshift/openshift-cluster-setup/initial-setup#script-initial-setup">here</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="dsf-okd-s2i.asciidoc_links--references">Links &amp; References</h5>
<div class="paragraph">
<p>This is a list of useful articles, etc, that I found while creating the templates.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/openshift/openshift-docs/issues/1329">Template Icons</a></p>
</li>
<li>
<p><a href="https://github.com/jbossdemocentral/coolstore-microservice">Red Hat Cool Store Microservice Demo</a></p>
</li>
<li>
<p><a href="https://docs.openshift.com/container-platform/latest/install_config/web_console_customization.html">Openshift Web Console Customization</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="dsf-okd-templates.asciidoc">37.4.6. devonfw templates</h4>
<div class="paragraph">
<p>This are the devonfw templates to build devonfw apps for Openshift using the s2i images. They are based on the work of Mickuehl in Oasp templates/mythaistar for deploy My Thai Star.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Inside the <code>example-mythaistar</code> we have an example to deploy My Thai Star application using devonfw templates.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>All this information is used as a part of the <a href="#dsf-okd-initial-setup.asciidoc">initial setup</a> for openshift.</p>
</div>
<div class="sect4">
<h5 id="dsf-okd-templates.asciidoc_how-to-use">How to use</h5>
<div class="sect5">
<h6 id="dsf-okd-templates.asciidoc_previous-requirements">Previous requirements</h6>
<div class="sect6">
<h7 id="dsf-okd-templates.asciidoc_deploy-the-source-2-image-builder-images">Deploy the Source-2-Image builder images</h7>
<div class="paragraph">
<p>Remember that this templates need a build image from s2i-devonfw-angular and s2i-devonfw-java. More information:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="dsf-okd-s2i.html#deploy-the-source-2-image-builder-images">Deploy the Source-2-Image builder images</a>.</p>
</li>
</ul>
</div>
</div>
<div class="sect6">
<h7 id="dsf-okd-templates.asciidoc_customize-openshift">Customize Openshift</h7>
<div class="paragraph">
<p>Remember that this templates also have custom icons, and to use it, we must modify the master-config.yml inside openshift. More information:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#dsf-okd-customize.asciidoc">Customize Openshift</a>.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect5">
<h6 id="dsf-okd-templates.asciidoc_deploy-devonfw-templates">Deploy devonfw templates</h6>
<div class="paragraph">
<p>Now, it&#8217;s time to create devonfw templates to use this s2i and add it to the browse catalog.</p>
</div>
<div class="paragraph">
<p>To let all user to use these templates in all openshift projects, we should create it in an openshift namespace. To do that, we must log in as an admin.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-Shell hljs" data-lang="Shell">oc create -f https://raw.githubusercontent.com/devonfw/devonfw-shop-floor/master/dsf4openshift/openshift-devonfw-deployment/templates/devonfw-java-template.json --namespace=openshift
oc create -f https://raw.githubusercontent.com/devonfw/devonfw-shop-floor/master/dsf4openshift/openshift-devonfw-deployment/templates/devonfw-angular-template.json --namespace=openshift</code></pre>
</div>
</div>
<div class="paragraph">
<p>When it finishes, remember to logout as an admin and enter with our normal user.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-Shell hljs" data-lang="Shell">$ oc login</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="dsf-okd-templates.asciidoc_how-to-use-devonfw-templates-in-openshift">How to use devonfw templates in openshift</h6>
<div class="paragraph">
<p>To use these templates with openshift, we can override any parameter values defined in the file by adding the --param-file=paramfile option.</p>
</div>
<div class="paragraph">
<p>This file must be a list of &lt;name&gt;=&lt;value&gt; pairs. A parameter reference may appear in any text field inside the template items.</p>
</div>
<div class="paragraph">
<p><strong>The parameters that we must override are the following</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-Shell hljs" data-lang="Shell">$ cat paramfile
  APPLICATION_NAME=app-Name
  APPLICATION_GROUP_NAME=group-Name
  GIT_URI=Git uri
  GIT_REF=master
  CONTEXT_DIR=/context</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>The following parameters are optional</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-Shell hljs" data-lang="Shell">$ cat paramfile
  APPLICATION_HOSTNAME=Custom hostname for service routes. Leave blank for default hostname, e.g.: &lt;application-name&gt;.&lt;project&gt;.&lt;default-domain-suffix&gt;,
  # Only for angular
  REST_ENDPOINT_URL=The URL of the backend's REST API endpoint. This can be declared after,
  REST_ENDPOINT_PATTERN=The pattern URL of the backend's REST API endpoint that must be modify by the REST_ENDPOINT_URL variable,</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>For example, to deploy My Thai Star Java</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-Shell hljs" data-lang="Shell">$ cat paramfile
  APPLICATION_NAME="mythaistar-java"
  APPLICATION_GROUP_NAME="My-Thai-Star"
  GIT_URI="https://github.com/oasp/my-thai-star.git"
  GIT_REF="develop"
  CONTEXT_DIR="/java/mtsj"

$ oc new-app --template=devonfw-java --namespace=mythaistar --param-file=paramfile</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="dsf-okd-customize.asciidoc">37.4.7. Customize Openshift Origin for devonfw</h4>
<div class="paragraph">
<p>This is a guide to customize Openshift cluster.</p>
</div>
<div class="sect4">
<h5 id="dsf-okd-customize.asciidoc_images-styles">Images Styles</h5>
<div class="paragraph">
<p>The icons for templates must measure the same as below or the images don&#8217;t show right:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>Openshift logo</code>: 230px x 40px.</p>
</li>
<li>
<p><code>Template logo</code>: 50px x 50px.</p>
</li>
<li>
<p><code>Category logo</code>: 110px x 36px.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="dsf-okd-customize.asciidoc_how-to-use">How to use</h5>
<div class="paragraph">
<p>To use it, we need to enter in openshift as an admin and use the next command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-Shell hljs" data-lang="Shell">$ oc login

$ oc edit configmap/webconsole-config -n openshift-web-console</code></pre>
</div>
</div>
<div class="paragraph">
<p>After this, we can see in our shell the webconsole-config.yaml, we only need to navigate until <strong>extensions</strong> and add the url for our own <code>css</code> in the <strong>stylesheetURLs</strong> and <code>javascript</code> in the <strong>scriptURLs</strong> section.</p>
</div>
<div class="paragraph">
<p><strong>IMPORTANT: Scripts and stylesheets must be served with the correct content type or they will not be run by the browser. Scripts must be served with Content-Type: application/javascript and stylesheets with Content-Type: text/css.</strong></p>
</div>
<div class="paragraph">
<p>In git repositories, the content type of raw is text/plain. You can use <a href="https://rawgit.com/">rawgit</a> to convert a raw from a git repository to the correct content type.</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-YAML hljs" data-lang="YAML">webconsole-config.yaml: |
  [...]
    extensions:
      scriptURLs:
        - https://cdn.rawgit.com/devonfw/devonfw-shop-floor/master/dsf4openshift/openshift-cluster-setup/initial-setup/customizeOpenshift/scripts/catalog-categories.js
      stylesheetURLs:
        - https://cdn.rawgit.com/devonfw/devonfw-shop-floor/master/dsf4openshift/openshift-cluster-setup/initial-setup/customizeOpenshift/stylesheet/icons.css
  [...]</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="dsf-okd-customize.asciidoc_more-information">More information</h5>
<div class="ulist">
<ul>
<li>
<p><a href="#dsf-okd-customize-icons.asciidoc">Customize icons</a> for Openshift.</p>
</li>
<li>
<p><a href="#dsf-okd-customize-catalog.asciidoc">Customize catalog</a> for Openshift.</p>
</li>
<li>
<p><a href="https://docs.openshift.com/container-platform/latest/install_config/web_console_customization.html#loading-custom-scripts-and-stylesheets">Openshift docs</a> about customization.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="dsf-okd-customize.asciidoc_old-versions">Old versions</h5>
<div class="ulist">
<ul>
<li>
<p>Customize Openshift for <a href="#dsf-okd-customize-v3-7.asciidoc">version 3.7</a>.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="dsf-okd-customize-icons.asciidoc">How to add Custom Icons inside openshift</h5>
<div class="paragraph">
<p>This is a guide to add custom icons into an Openshift cluster.</p>
</div>
<div class="paragraph">
<p><a href="https://github.com/devonfw/devonfw-shop-floor/tree/master/dsf4openshift/openshift-cluster-setup/initial-setup/customizeOpenshift/stylesheet">Here</a> we can find an icons.css example to use the devonfw icons.</p>
</div>
<div class="sect5">
<h6 id="dsf-okd-customize-icons.asciidoc_images-styles">Images Styles</h6>
<div class="paragraph">
<p>The icons for templates must measure the same as below or the images don&#8217;t show right:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>Openshift logo</code>: 230px x 40px.</p>
</li>
<li>
<p><code>Template logo</code>: 50px x 50px.</p>
</li>
<li>
<p><code>Category logo</code>: 110px x 36px.</p>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="dsf-okd-customize-icons.asciidoc_create-a-css">Create a css</h6>
<div class="sect6">
<h7 id="dsf-okd-customize-icons.asciidoc_custom-logo-for-openshift-cluster">Custom logo for openshift cluster</h7>
<div class="paragraph">
<p>For this example, we are going to call the css icons.css but you can call as you wish.
Openshift cluster draw their icon by the id header-logo, then we only need to add to our icons.css the next Style Attribute ID</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-CSS hljs" data-lang="CSS">#header-logo {
  background-image: url("https://raw.githubusercontent.com/devonfw/devonfw-shop-floor/master/dsf4openshift/openshift-cluster-setup/initial-setup/customizeOpenshift/images/devonfw-openshift.png);
  width: 230px;
  height: 40px;
}</code></pre>
</div>
</div>
</div>
<div class="sect6">
<h7 id="dsf-okd-customize-icons.asciidoc_custom-icons-for-templates">Custom icons for templates</h7>
<div class="paragraph">
<p>To use a custom icon to a template openshift use a class name. Then, we need to insert inside our icons.css the next Style Class</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-CSS hljs" data-lang="CSS">.devonfw-logo {
  background-image: url("https://raw.githubusercontent.com/devonfw/devonfw-shop-floor/master/dsf4openshift/openshift-cluster-setup/initial-setup/customizeOpenshift/images/devonfw.png");
  width: 50px;
  height: 50px;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>To show that custom icon on a template, we only need to write the name of our class in the tag "iconClass" of our template.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-JSON hljs" data-lang="JSON">{
    ...
    "items": [
        {
            ...
            "metadata": {
                ...
                "annotations": {
                    ...
                    "iconClass": "devonfw-logo",
                    ...
                }
            },
            ...
        }
    ]
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect5">
<h6 id="dsf-okd-customize-icons.asciidoc_use-our-own-css-inside-openshift">Use our own css inside openshift</h6>
<div class="paragraph">
<p>To do that, we need to enter in openshift as an admin and use the next command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-Shell hljs" data-lang="Shell">$ oc login
$ oc edit configmap/webconsole-config -n openshift-web-console</code></pre>
</div>
</div>
<div class="paragraph">
<p>After this, we can see in our shell the webconsole-config.yaml, we only need to navigate until <strong>extensions</strong> and add the url for our own <code>css</code> in the <strong>stylesheetURLs</strong> section.</p>
</div>
<div class="paragraph">
<p><strong>IMPORTANT: Scripts and stylesheets must be served with the correct content type or they will not be run by the browser. stylesheets must be served with Content-Type: text/css.</strong></p>
</div>
<div class="paragraph">
<p>In git repositories, the content type of raw is text/plain. You can use <a href="https://rawgit.com/">rawgit</a> to convert a raw from a git repository to the correct content type.</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-YAML hljs" data-lang="YAML">webconsole-config.yaml: |
	[...]
    extensions:
      stylesheetURLs:
		- https://cdn.rawgit.com/devonfw/devonfw-shop-floor/master/dsf4openshift/openshift-cluster-setup/initial-setup/customizeOpenshift/stylesheet/icons.css
    [...]</code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="dsf-okd-customize-catalog.asciidoc">How to add custom catalog categories inside openshift</h5>
<div class="paragraph">
<p>This is a guide to add custom <code>Catalog Categories</code> into an Openshift cluster.</p>
</div>
<div class="paragraph">
<p><a href="https://github.com/devonfw/devonfw-shop-floor/tree/master/dsf4openshift/openshift-cluster-setup/initial-setup/customizeOpenshift/scripts">Here</a> we can find a catalog-categories.js example to use the devonfw catalog categories.</p>
</div>
<div class="sect5">
<h6 id="dsf-okd-customize-catalog.asciidoc_create-a-scrip-to-add-custom-langauges-and-custom-catalog-categories">Create a scrip to add custom langauges and custom catalog categories</h6>
<div class="sect6">
<h7 id="dsf-okd-customize-catalog.asciidoc_custom-language">Custom language</h7>
<div class="paragraph">
<p>For this example, we are going add a new language into the languages category. To do that we must create a script and we named as catalog-categories.js</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-Javascript hljs" data-lang="Javascript">// Find the Languages category.
var category = _.find(window.OPENSHIFT_CONSTANTS.SERVICE_CATALOG_CATEGORIES,
                      { id: 'languages' });
// Add Go as a new subcategory under Languages.
category.subCategories.splice(2,0,{ // Insert at the third spot.
  // Required. Must be unique.
  id: "devonfw-languages",
  // Required.
  label: "devonfw",
  // Optional. If specified, defines a unique icon for this item.
  icon: "devonfw-logo-language",
  // Required. Items matching any tag will appear in this subcategory.
  tags: [
    "devonfw",
    "devonfw-angular",
    "devonfw-java"
  ]
});</code></pre>
</div>
</div>
</div>
<div class="sect6">
<h7 id="dsf-okd-customize-catalog.asciidoc_custom-category">Custom category</h7>
<div class="paragraph">
<p>For this example, we are going add a new category into the category tab. To do that we must create a script and we named as catalog-categories.js</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-Javascript hljs" data-lang="Javascript">// Add a Featured category as the first category tab.
window.OPENSHIFT_CONSTANTS.SERVICE_CATALOG_CATEGORIES.unshift({
  // Required. Must be unique.
  id: "devonfw-featured",
  // Required
  label: "devonfw",
  subCategories: [
    {
      // Required. Must be unique.
      id: "devonfw-languages",
      // Required.
      label: "devonfw",
      // Optional. If specified, defines a unique icon for this item.
      icon: "devonfw-logo-language",
      // Required. Items matching any tag will appear in this subcategory.
      tags: [
        "devonfw",
        "devonfw-angular",
        "devonfw-java"
      ]
    }
  ]
});</code></pre>
</div>
</div>
</div>
</div>
<div class="sect5">
<h6 id="dsf-okd-customize-catalog.asciidoc_use-our-own-javascript-inside-openshift">Use our own javascript inside openshift</h6>
<div class="paragraph">
<p>To do that, we need to enter in openshift as an admin and use the next command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-Shell hljs" data-lang="Shell">$ oc login
$ oc edit configmap/webconsole-config -n openshift-web-console</code></pre>
</div>
</div>
<div class="paragraph">
<p>After this, we can see in our shell the webconsole-config.yaml, we only need to navigate until <strong>extensions</strong> and add the url for our own <code>javascript</code> in the <strong>scriptURLs</strong> section.</p>
</div>
<div class="paragraph">
<p><strong>IMPORTANT: Scripts and stylesheets must be served with the correct content type or they will not be run by the browser. Scripts must be served with Content-Type: application/javascript.</strong></p>
</div>
<div class="paragraph">
<p>In git repositories, the content type of raw is text/plain. You can use <a href="https://rawgit.com/">rawgit</a> to convert a raw from a git repository to the correct content type.</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-YAML hljs" data-lang="YAML">webconsole-config.yaml: |
  [...]
    extensions:
      scriptURLs:
        - https://cdn.rawgit.com/devonfw/devonfw-shop-floor/master/dsf4openshift/openshift-cluster-setup/initial-setup/customizeOpenshift/scripts/catalog-categories.js
  [...]</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="dsf-okd-customize-v3-7.asciidoc">Customize Openshift Origin v3.7 for devonfw</h6>
<div class="paragraph">
<p>This is a guide to customize Openshift cluster. For more information read the next:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://docs.openshift.com/container-platform/3.7/install_config/web_console_customization.html#loading-custom-scripts-and-stylesheets">Openshift docs customization</a> for the version 3.7.</p>
</li>
</ul>
</div>
<div class="sect6">
<h7 id="dsf-okd-customize-v3-7.asciidoc_images-styles">Images Styles</h7>
<div class="paragraph">
<p>The icons for templates must measure the same as below or the images don&#8217;t show right:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>Openshift logo</code>: 230px x 40px.</p>
</li>
<li>
<p><code>Template logo</code>: 50px x 50px.</p>
</li>
<li>
<p><code>Category logo</code>: 110px x 36px.</p>
</li>
</ul>
</div>
</div>
<div class="sect6">
<h7 id="dsf-okd-customize-v3-7.asciidoc_quick-use">Quick Use</h7>
<div class="paragraph">
<p>This is a quick example to add custom icons and categories inside openshift.</p>
</div>
<div class="paragraph">
<p>To modify the icons inside openshift, we must to modify our master-config.yaml of our openshift cluster. This file is inside the openshift container and to obtain a copy of it, we must to know what&#8217;s our openshift container name.</p>
</div>
<div class="sect7">
<h8 id="dsf-okd-customize-v3-7.asciidoc_obtain-the-master-config.yaml-of-our-openshift-cluster">Obtain the master-config.yaml of our openshift cluster</h8>
<div class="sect8">
<h9 id="dsf-okd-customize-v3-7.asciidoc_obtain-the-name-of-our-openshift-container">Obtain the name of our openshift container</h9>
<div class="paragraph">
<p>To obtain it, we can know it executing the next:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-Shell hljs" data-lang="Shell">$ docker container ls
CONTAINER ID        IMAGE                                           COMMAND                  CREATED             STATUS              PORTS                                     NAMES
83a4e3acda5b        openshift/origin:v3.7.0                         "/usr/bin/openshift …"   6 days ago          Up 6 days                                                     origin</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here we can see that the name of the container is origin. Normaly the container it&#8217;s called as origin.</p>
</div>
</div>
<div class="sect8">
<h9 id="dsf-okd-customize-v3-7.asciidoc_copy-the-master-config.yaml-of-our-openshift-container-to-our-directory">Copy the master-config.yaml of our openshift container to our directory</h9>
<div class="paragraph">
<p>This file is inside the openshift container in the next directory: /var/lib/origin/openshift.local.config/master/<code>master-config.yaml</code> and we can copy it with the next command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-Shell hljs" data-lang="Shell">$ docker cp origin:/var/lib/origin/openshift.local.config/master/master-config.yaml ./</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now we have a file with the configuration of our openshift cluster.</p>
</div>
</div>
</div>
<div class="sect7">
<h8 id="dsf-okd-customize-v3-7.asciidoc_copy-all-customize-files-inside-the-openshift-container">Copy all customize files inside the openshift container</h8>
<div class="paragraph">
<p>To use our customization of devonfw Openshift, we need to copy our files inside the openshift container.</p>
</div>
<div class="paragraph">
<p>To do this we need to copy the images, scripts and stylesheets from <a href="https://github.com/devonfw/devonfw-shop-floor/tree/master/dsf4openshift/openshift-cluster-setup/initial-setup/customizeOpenshift">here</a> inside openshift
container, for example, we could put it all inside a folder called openshift.local.devonfw. On the step one we obtain the name of this container, for this example we assume that it&#8217;s called origin. Then our images are located inside openshift container and we can see an access it in <code>/var/lib/origin/openshift.local.devonfw/images</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-Shell hljs" data-lang="Shell">$ docker cp ./openshift.local.devonfw origin:/var/lib/origin/</code></pre>
</div>
</div>
</div>
<div class="sect7">
<h8 id="dsf-okd-customize-v3-7.asciidoc_edit-and-copy-the-master-config.yaml-to-use-our-customize-files">Edit and copy the master-config.yaml to use our customize files</h8>
<div class="paragraph">
<p>The master-config.yaml have a sections to charge our custom files. All these sections are inside the <code>assetConfig</code> and their names are the next:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The custom stylessheets are into <code>extensionStylesheets</code>.</p>
</li>
<li>
<p>The custom scripts are into <code>extensionScripts</code>.</p>
</li>
<li>
<p>The custom images are into <code>extensions</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To use all our custom elements only need to add the directory routes of each element in their appropriate section of the master-config.yaml</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">...
assetConfig:
  ...
  extensionScripts:
  - /var/lib/origin/openshift.local.devonfw/scripts/catalog-categories.js
  extensionStylesheets:
  - /var/lib/origin/openshift.local.devonfw/stylesheet/icons.css
  extensions:
  - name: images
    sourceDirectory: /var/lib/origin/openshift.local.devonfw/images
  ...
...</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now we only need to copy that master-config.yaml inside openshift, and restart it to load the new configuration. To do that execute the next:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-Shell hljs" data-lang="Shell">$ docker cp ./master-config.yaml origin:/var/lib/origin/openshift.local.config/master/master-config.yaml</code></pre>
</div>
</div>
<div class="paragraph">
<p>To re-start openshift do <code>oc cluster down</code> and start again your persistent openshift cluster.</p>
</div>
</div>
</div>
<div class="sect6">
<h7 id="dsf-okd-customize-v3-7.asciidoc_more-information">More information</h7>
<div class="ulist">
<ul>
<li>
<p><a href="#dsf-okd-customize-icons.asciidoc">Customize icons</a> for Openshift.</p>
</li>
<li>
<p><a href="#dsf-okd-customize-catalog.asciidoc">Customize catalog</a> for Openshift.</p>
</li>
<li>
<p><a href="https://docs.openshift.com/container-platform/latest/install_config/web_console_customization.html#loading-custom-scripts-and-stylesheets">Openshift docs</a> about customization.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<h1 id="master-cicdgen.asciidoc" class="sect0">VII: cicdgen</h1>
<div class="openblock partintro">
<div class="content">
<!-- toc disabled -->
</div>
</div>
<div class="sect1">
<h2 id="Home.asciidoc">38. CICDGEN</h2>
<div class="sectionbody">
<div class="paragraph">
<p>cicdgen is a devonfw tool for generate all code/files related to CICD. It will include/modify into your project all files that the project needs run a Jenkins cicd pipeline, to create a docker image based on your project, etc. It’s based on angular schematics, so you can add it as a dependency into your project and generate the code using ng generate. In addition, it has its own CLI for those projects that are not angular based.</p>
</div>
<div class="sect2">
<h3 id="home.asciidoc_what-is-angular-schematics">38.1. What is angular schematics?</h3>
<div class="paragraph">
<p>Schematics are generators that transform an existing filesystem. They can create files, refactor existing files, or move files around.</p>
</div>
<div class="paragraph">
<p>What distinguishes Schematics from other generators, such as Yeoman or Yarn Create, is that schematics are purely descriptive; no changes are applied to the actual filesystem until everything is ready to be committed. There is no side effect, by design, in Schematics.</p>
</div>
</div>
<div class="sect2">
<h3 id="home.asciidoc_cicdgen-cli">38.2. cicdgen CLI</h3>
<div class="paragraph">
<p>For know more about how to use the cicdgen CLI, you can check the <a href="#cicdgen-cli.asciidoc">CLI page</a></p>
</div>
</div>
<div class="sect2">
<h3 id="home.asciidoc_cicdgen-schematics">38.3. cicdgen Schematics</h3>
<div class="paragraph">
<p>For know more about how to use the cicdgen schematics, you can check the <a href="#cicdgen-schematics.asciidoc">schematics page</a></p>
</div>
</div>
<div class="sect2">
<h3 id="home.asciidoc_usage-example">38.4. Usage example</h3>
<div class="paragraph">
<p>A <a href="#usage-example.asciidoc">specific page</a> about how to use cicdgen is also available.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="master-cicdgen.asciidoc_cicdgen-cli">39. cicdgen CLI</h2>
<div class="sectionbody">
<!-- toc disabled -->
<div class="sect3">
<h4 id="cicdgen-cli.asciidoc_cicdgen-cli">39.1. CICDGEN CLI</h4>
<div class="paragraph">
<p>cicdgen is a command line interface that helps you with some CICD in a devonfw project. At this moment we can only generate files related to CICD in a project but we plan to add more functionlity in a future.</p>
</div>
<div class="sect4">
<h5 id="cicdgen-cli.asciidoc_installation">Installation</h5>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ npm i -g @devonfw/cicdgen</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="cicdgen-cli.asciidoc_usage">Usage</h5>
<div class="sect5">
<h6 id="cicdgen-cli.asciidoc_global-arguments">Global arguments</h6>
<div class="ulist">
<ul>
<li>
<p>--version</p>
<div class="literalblock">
<div class="content">
<pre>Prints the cicdgen version number</pre>
</div>
</div>
</li>
<li>
<p>--help</p>
<div class="literalblock">
<div class="content">
<pre>Shows the usage of the command</pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="cicdgen-cli.asciidoc_commands">Commands</h6>
<div class="sect6">
<h7 id="cicdgen-cli.asciidoc_generate.">Generate.</h7>
<div class="paragraph">
<p>This command wraps the usage of angular schematics CLI. With this we generate files in a easy way and also print a better help about usage.</p>
</div>
<div class="paragraph">
<p>Available schematics that generate the code:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#devon4j/devon4j-schematic.asciidoc">devon4j</a></p>
</li>
<li>
<p><a href="#devon4j/devon4ng-schematic.asciidoc">devon4ng</a></p>
</li>
<li>
<p><a href="#devon4j/devon4node-schematic.asciidoc">devon4node</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect5">
<h6 id="cicdgen-cli.asciidoc_examples">Examples</h6>
<div class="ulist">
<ul>
<li>
<p>Generate all CICD files related to a devon4j project</p>
<div class="listingblock">
<div class="content">
<pre>$ cicdgen generate devon4j</pre>
</div>
</div>
</li>
<li>
<p>Generate all CICD files related to a devon4ng project with docker deployment.</p>
<div class="listingblock">
<div class="content">
<pre>$ cicdgen generate devon4ng --groupid com.devonfw --docker --plurl devon.s2-eu.capgemini.com</pre>
</div>
</div>
</li>
<li>
<p>Generate all CICD files related to a devon4node project with OpenShift deployment.</p>
<div class="listingblock">
<div class="content">
<pre>$ cicdgen generate devon4ng --groupid com.devonfw --openshift --plurl devon.s2-eu.capgemini.com --ocurl ocp.itaas.s2-eu.capgemini.com --ocn devonfw</pre>
</div>
</div>
</li>
</ul>
</div>
<!-- toc disabled -->
</div>
</div>
</div>
<div class="sect3">
<h4 id="usage-example.asciidoc_cicdgen-usage-example">39.2. cicdgen usage example</h4>
<div class="paragraph">
<p>In this example we are going to show how to use cicdgen step by step in a devon4ng project.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Install cicdgen</p>
<div class="paragraph">
<p>cicdgen is already included in the devonfw distribution, but if you want to use it outside the devonfw console you can execute the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ npm i -g cicdgen</pre>
</div>
</div>
</li>
<li>
<p>Generate a new devon4ng project using devcon.</p>
<div class="paragraph">
<p><span class="image"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/example/devcon-example.png" alt="devcon example"></span></p>
</div>
</li>
<li>
<p>Execute cicdgen generate command</p>
<div class="paragraph">
<p>As we want to send notifications to MS Teams, we need to create de connector first:</p>
</div>
<div class="openblock">
<div class="content">
<div class="ulist">
<ul>
<li>
<p>Go to a channel in teams and click at the connectors button. Then click at the jenkins configure button.</p>
<div class="paragraph">
<p><span class="image"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/example/teams-1.png" alt="teams 1"></span></p>
</div>
</li>
<li>
<p>Put a name for the connector</p>
<div class="paragraph">
<p><span class="image"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/example/teams-2.png" alt="teams 2"></span></p>
</div>
</li>
<li>
<p>Copy the name and the Webhook URL, we will use it later.</p>
<div class="paragraph">
<p><span class="image"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/example/teams-3.png" alt="teams 3"></span></p>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="paragraph">
<p>With the values that we get in the previous steps, we will execute the cicdgen command inside the project folder. If you have any doubt you can use the help.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/example/help-1.png" alt="help 1"></span></p>
</div>
<div class="paragraph">
<p><span class="image"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/example/help-2.png" alt="help 2"></span></p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ cicdgen generate devon4ng --groupid com.devonfw --docker --plurl devon.s2-eu.capgemini.com --teams --teamsname devon4ng --teamsurl https://outlook.office.com/webhook/...</pre>
</div>
</div>
<div class="paragraph">
<p><span class="image"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/example/cicdgen-command.png" alt="cicdgen command"></span></p>
</div>
</li>
<li>
<p>Create a git repository and upload the code</p>
<div class="paragraph">
<p><span class="image"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/example/gitlab.png" alt="gitlab"></span></p>
</div>
<div class="paragraph">
<p><span class="image"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/example/gitlab-2.png" alt="gitlab 2"></span></p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ git remote add origin https://devon.s2-eu.capgemini.com/gitlab/darrodri/devon4ng.git
$ git push -u origin master</pre>
</div>
</div>
<div class="paragraph">
<p><span class="image"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/example/push-code.png" alt="push code"></span></p>
</div>
<div class="paragraph">
<p>As you can see, no git init or git commit is required, cicdgen do it for you.</p>
</div>
</li>
<li>
<p>Create a multibranch-pipeline in Jenkins</p>
<div class="paragraph">
<p><span class="image"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/example/new-pipeline.png" alt="new pipeline"></span></p>
</div>
<div class="paragraph">
<p>When you push the save button, it will download the repository and execute the pipeline defined in the Jenkinsfile. If you get any problem, check the environment variables defined in the Jenkinsfile. Here we show all variables related with Jenkins:</p>
</div>
<div class="openblock">
<div class="content">
<div class="ulist">
<ul>
<li>
<p>chrome</p>
<div class="paragraph">
<p><span class="image"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/example/chrome-stable.png" alt="chrome stable"></span></p>
</div>
</li>
<li>
<p>sonarTool</p>
<div class="paragraph">
<p><span class="image"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/example/sonar-tool.png" alt="sonar tool"></span></p>
</div>
</li>
<li>
<p>sonarEnv</p>
<div class="paragraph">
<p><span class="image"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/example/sonar-env.png" alt="sonar env"></span></p>
</div>
</li>
<li>
<p>repositoryId</p>
<div class="paragraph">
<p><span class="image"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/example/repository-id.png" alt="repository id"></span></p>
</div>
</li>
<li>
<p>globalSettingsId</p>
<div class="paragraph">
<p><span class="image"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/example/global-settings-id.png" alt="global settings id"></span></p>
</div>
</li>
<li>
<p>mavenInstallation</p>
<div class="paragraph">
<p><span class="image"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/example/maven-installation.png" alt="maven installation"></span></p>
</div>
</li>
<li>
<p>dockerTool</p>
<div class="paragraph">
<p><span class="image"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/example/docker-global.png" alt="docker global"></span></p>
</div>
</li>
</ul>
</div>
</div>
</div>
</li>
<li>
<p>Add a webhook in GitLab</p>
<div class="paragraph">
<p>In order to run the pipeline every time that you push code to GitLab, you need to configure a webhook in your repository.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/example/gitlab-webhook.png" alt="gitlab webhook"></span></p>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>Now your project is ready to work following a CICD strategy.</p>
</div>
<div class="paragraph">
<p>The last thing to take into account is the branch naming. We prepare the pipeline in order to work following the git-flow strategy. So all stages of the pipeline will be executed for the branchs: develop, release/*, master. For the branchs: feature/*, hotfix/*, bugfix/* only the steps related to unit testing will be executed.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="master-cicdgen.asciidoc_cicdgen-schematics">40. cicdgen Schematics</h2>
<div class="sectionbody">
<!-- toc disabled -->
<div class="sect3">
<h4 id="cicdgen-schematics.asciidoc_cicdgen-schematics">40.1. CICDGEN SCHEMATICS</h4>
<div class="paragraph">
<p>We use angular schematics to create and update an existing devonfw project in order to adapt it to a CICD environment. All schematics are prepared to work with Production Line, a Capgemini CICD platform, but it can also work in other environment which have the following tools:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Jenkins</p>
</li>
<li>
<p>Nexus 3</p>
</li>
<li>
<p>SonarQube</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The list of available schematics are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#./devon4j/devon4j-schematic">devon4j</a></p>
</li>
<li>
<p><a href="#./devon4ng/devon4ng-schematic">devon4ng</a></p>
</li>
<li>
<p><a href="#./devon4node/devon4node-schematic">devon4node</a></p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="cicdgen-schematics.asciidoc_how-to-run-the-schematics">How to run the schematics</h5>
<div class="paragraph">
<p>You can run the schematics using the schematic CLI provided by the angular team, but the easiest way to run it is using the <a href="#cicdgen-cli.asciidoc">cicdgen CLI</a> which is a wrapper for the angular CLI in order to use it in a easy way.</p>
</div>
<div class="paragraph">
<p>To generate files you only need to run the command</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ cicdgen generate &lt;schematic-name&gt; [arguments]</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;schematic-name&gt; is the name of the schematic that you want to execute.</p>
</div>
<div class="paragraph">
<p>You can find all information about arguments in the schematic section.</p>
</div>
<!-- toc disabled -->
</div>
</div>
<div class="sect3">
<h4 id="devon4j-schematic.asciidoc_devon4j-schematic">40.2. Devon4j schematic</h4>
<div class="paragraph">
<p>With the <code>cicdgen generate devon4j</code> command you can generate some files required for CICD. In this section we will explain the arguments of this command and also the files that will be generated.</p>
</div>
<div class="sect4">
<h5 id="devon4j-schematic.asciidoc_devon4j-schematic-arguments">Devon4j schematic arguments</h5>
<div class="paragraph">
<p>When you execute the <code>cicdgen generate devon4j</code> command you can also add some arguments in order to modify the behaviour of the command. Those arguments are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>--docker</p>
<div class="paragraph">
<p>The type of this paramter if boolean. If it is present, docker related files and pipeline stage will be also generated. For more details see docker section of Jenkinsfile and <a href="#devon4j-schematic.asciidoc_devon4j-docker-generated-files">files generated for docker</a></p>
</div>
</li>
<li>
<p>--plurl</p>
<div class="paragraph">
<p>Url of Production Line. It is required when <code>--docker</code> is true, and it will be used to know where the docker image will be uploaded.</p>
</div>
</li>
<li>
<p>--openshift</p>
<div class="paragraph">
<p>The type of this paramter if boolean. If it is present, OpenShift related files and pipeline stage will be also generated. For more details see OpenShift section of Jenkinsfile and <a href="#devon4j-schematic.asciidoc_devon4j-docker-generated-files">files generated for docker</a> (same as <code>--docker</code>)</p>
</div>
</li>
<li>
<p>--ocurl</p>
<div class="paragraph">
<p>OpenShift cluster url where the application will be builded and deployed.</p>
</div>
</li>
<li>
<p>--ocn</p>
<div class="paragraph">
<p>Openshift cluster namespace</p>
</div>
</li>
<li>
<p>--teams</p>
<div class="paragraph">
<p>With this argument we can add the teams notification option in the <a href="#devon4j-schematic.asciidoc_jenkinsfile-teams">Jenkinsfile</a>.</p>
</div>
</li>
<li>
<p>--teamsname</p>
<div class="paragraph">
<p>The name of the Microsft Teams webhook. It is defined at Microsoft Teams connectors.</p>
</div>
</li>
<li>
<p>--teamsurl</p>
<div class="paragraph">
<p>The url of the Microsft Teams webhook. It is returned by Microsoft Teams when you create a connector.</p>
</div>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="devon4j-schematic.asciidoc_devon4ng-generated-files">Devon4ng generated files</h5>
<div class="paragraph">
<p>When you execute the generate devon4ng command, some files will be added/updated in your project.</p>
</div>
<div class="sect5">
<h6 id="devon4j-schematic.asciidoc_files">Files</h6>
<div class="ulist">
<ul>
<li>
<p>.gitignore</p>
<div class="paragraph">
<p>Defines all files that git will ignore. e.g: compiled files, IDE configurations.</p>
</div>
</li>
<li>
<p>pom.xml</p>
<div class="paragraph">
<p>The pom.xml is modified in order to add the distributionManagement.</p>
</div>
</li>
<li>
<p>Jenkinsfile</p>
<div class="paragraph">
<p>The Jenkinsfile is the file which define the Jenkins pipeline of our project. With this we can execute the test, build the application and deploy it automatically following a CICD methodology. This file is prepared to work with the Production Line default values, but it is also fully configurable to your needs.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Prerequisites</p>
<div class="ulist">
<ul>
<li>
<p>A Production Line instance. It can works also if you have a Jenkins, SonarQube and Nexus3, but in this case maybe you need to configure them properly.</p>
</li>
<li>
<p>Java installed in Jenkins as a global tool.</p>
</li>
<li>
<p>Google Chrome installed in Jenkins as a global custom tool.</p>
</li>
<li>
<p>SonarQube installed in Jenkins as a global tool.</p>
</li>
<li>
<p>Maven3 installed in Jenkins as a global tool.</p>
</li>
<li>
<p>A maven global settings properly configured in Jenkins.</p>
</li>
<li>
<p>If you will use docker to deploy:</p>
<div class="ulist">
<ul>
<li>
<p>Docker installed in Jenkins as a global custom tool.</p>
</li>
<li>
<p>The Nexus3 with a docker repository.</p>
</li>
<li>
<p>A machine with docker installed where the build and deploy will happen.</p>
</li>
<li>
<p>A docker network called application.</p>
</li>
</ul>
</div>
</li>
<li>
<p>If you will use OpenShift to deploy:</p>
<div class="ulist">
<ul>
<li>
<p>An OpenShift instance</p>
</li>
<li>
<p>The OpenShift projects created</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>The Jenkins syntax</p>
<div class="paragraph">
<p>In this section we will  explain a little bit the syntax of the Jenkins, so if you need to change something you will be able to do it properly.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>agent: Here you can specify the Jenkins agente where the pipeline will be executed. The default value is any.</p>
</li>
<li>
<p>options: Here you can set global options to the pipeline. By default, we add a build discarded to delete old artifacts/buils of the pipeline and also we disable the concurrent builds.</p>
<div id="devon4j-schematic.asciidoc_jenkinsfile-teams" class="paragraph">
<p>If the teams option is passed to cicdgen, we add a new option in order to send notifications to Microsoft Teams with the status of the pipeline executions.</p>
</div>
</li>
<li>
<p>environment: Here all environment variables are defined. All values defined here matches with the Production Line defaults. If you Jenkins has other values, you need to update it manually.</p>
</li>
<li>
<p>stages: Here are defined all stages that our pipeline will execute. Those stages are:</p>
<div class="ulist">
<ul>
<li>
<p>Setup pipeline: We set some variables depending on the git branch which you are executing. Also, we set properly the version number in all pom files. It means that if your branch is develop, your version should end with the word <code>-SNAPSHOT</code>, in order case, if <code>-SNAPSHOT</code> is present it will be removed.</p>
</li>
<li>
<p>Fresh Dependency Installation: install all packages need to build/run your java project.</p>
</li>
<li>
<p>Unit Tests: execute the <code>mvn test</code> command.</p>
</li>
<li>
<p>SonarQube code analysis: send the project to SonarQube in order to get the static code analysis of your project.</p>
</li>
<li>
<p>Deliver application into Nexus: build the project and send all bundle files to Nexsu3.</p>
</li>
<li>
<p>If <code>--docker</code> is present:</p>
<div class="ulist">
<ul>
<li>
<p>Create the Docker image: build a new docker image that contains the new version of the project.</p>
</li>
<li>
<p>Deploy the new image: deploy a new version of the application using the image created in the previous stage. The previous version is removed.</p>
</li>
</ul>
</div>
</li>
<li>
<p>If <code>--openshift</code> is present:</p>
<div class="ulist">
<ul>
<li>
<p>Create the Docker image: build a new docker image that contains the new version of the project using a OpenShift build config.</p>
</li>
<li>
<p>Deploy the new image: deploy a new version of the application in OpenShift.</p>
</li>
<li>
<p>Check pod status: checks that the application deployed in the previous stage is running properly. If the application does not run the pipeline will fail.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>post: actions that will be executed after the stages. We use it to clean up all files.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect4">
<h5 id="devon4j-schematic.asciidoc_devon4j-docker-generated-files">Devon4j Docker generated files</h5>
<div class="paragraph">
<p>When you generate the files for a devon4ng you can also pass the option <code>--docker</code>. It will generate also some extra files related to docker.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If you pass the <code>--docker</code> option the option <code>--plurl</code> is also required. It will be used to upload the images to the Nexus3 inside Production Line. Example: if your PL url is <code>test.s2-eu.capgemini.com</code> you should execute the command in this way: <code>cicdgen generate devon4ng --groupid com.devonfw --docker --plurl test.s2-eu.capgemini.com</code>, and it will use docker-registry-test.s2-eu.capgemini.com as docker registry.
</td>
</tr>
</table>
</div>
<div class="sect5">
<h6 id="devon4j-schematic.asciidoc_files">Files</h6>
<div class="ulist">
<ul>
<li>
<p>Dockerfile</p>
<div class="paragraph">
<p>This file contains the instructions to build a docker image for you project. This Dockerfile is for local development purposes, you can use it in your machine executing:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ cd &lt;path-to-your-project&gt;
$ docker build -t &lt;project-name&gt;/&lt;tag&gt; .</pre>
</div>
</div>
<div class="paragraph">
<p>This build is using a multi-stage build. First, it use a maven image in order to compile the source code, then it will use a java image to run the application. With the multi-stage build we keep the final image as clean as possible.</p>
</div>
</li>
<li>
<p>Dockerfile.ci</p>
<div class="paragraph">
<p>This file contains the instructions to create a docker image for you project. The main difference with the Dockerfile is that this file will be only used in the Jenkins pipeline. Instead of compiling again the code, it takes the compiled war from Jenkins to the image.</p>
</div>
</li>
</ul>
</div>
<!-- toc disabled -->
</div>
</div>
</div>
<div class="sect3">
<h4 id="devon4ng-schematic.asciidoc_devon4ng-schematic">40.3. Devon4ng schematic</h4>
<div class="paragraph">
<p>With the <code>cicdgen generate devon4ng</code> command you can generate some files required for CICD. In this section we will explain the arguments of this command and also the files that will be generated.</p>
</div>
<div class="sect4">
<h5 id="devon4ng-schematic.asciidoc_devon4ng-schematic-arguments">Devon4ng schematic arguments</h5>
<div class="paragraph">
<p>When you execute the <code>cicdgen generate devon4ng</code> command you can also add some arguments in order to modify the behaviour of the command. Those arguments are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>--docker</p>
<div class="paragraph">
<p>The type of this paramter if boolean. If it is present, docker related files and pipeline stage will be also generated. For more details see docker section of Jenkinsfile and <a href="#devon4ng-schematic.asciidoc_devon4ng-docker-generated-files">files generated for docker</a></p>
</div>
</li>
<li>
<p>--plurl</p>
<div class="paragraph">
<p>Url of Production Line. It is required when <code>--docker</code> is true, and it will be used to know where the docker image will be uploaded.</p>
</div>
</li>
<li>
<p>--openshift</p>
<div class="paragraph">
<p>The type of this paramter if boolean. If it is present, OpenShift related files and pipeline stage will be also generated. For more details see OpenShift section of Jenkinsfile and <a href="#devon4ng-schematic.asciidoc_devon4ng-docker-generated-files">files generated for OpenShift</a> (same as <code>--docker</code>)</p>
</div>
</li>
<li>
<p>--ocurl</p>
<div class="paragraph">
<p>OpenShift cluster url where the application will be builded and deployed.</p>
</div>
</li>
<li>
<p>--ocn</p>
<div class="paragraph">
<p>Openshift cluster namespace</p>
</div>
</li>
<li>
<p>--groupid</p>
<div class="paragraph">
<p>The project groupId. This argument is required. It will be used for store the project in a maven repository at Nexus 3. Why maven? Because is the kind of repository where we can upload/download a zip file easily. Npm repository needs a package.json file but, as we compile the angular application to static javascript and html files, the package.json is no needed anymore.</p>
</div>
</li>
<li>
<p>--teams</p>
<div class="paragraph">
<p>With this argument we can add the teams notification option in the <a href="#devon4ng-schematic.asciidoc_jenkinsfile-teams">Jenkinsfile</a>.</p>
</div>
</li>
<li>
<p>--teamsname</p>
<div class="paragraph">
<p>The name of the Microsft Teams webhook. It is defined at Microsoft Teams connectors.</p>
</div>
</li>
<li>
<p>--teamsurl</p>
<div class="paragraph">
<p>The url of the Microsft Teams webhook. It is returned by Microsoft Teams when you create a connector.</p>
</div>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="devon4ng-schematic.asciidoc_devon4ng-generated-files">Devon4ng generated files</h5>
<div class="paragraph">
<p>When you execute the generate devon4ng command, some files will be added/updated in your project.</p>
</div>
<div class="sect5">
<h6 id="devon4ng-schematic.asciidoc_files">Files</h6>
<div class="ulist">
<ul>
<li>
<p>angular.json</p>
<div class="paragraph">
<p>The angular.json is modified in order to change the compiled files destination folder. Now, when you make a build of your project, the compiled files will be generated into dist folder instead of dist/&lt;project-name&gt; folder.</p>
</div>
</li>
<li>
<p>package.json</p>
<div class="paragraph">
<p>The package.json is modified in order to add a script for test the application using Chrome Headless instead of a regular chrome. This script is called <code>test:ci</code>.</p>
</div>
</li>
<li>
<p>karma.conf.js</p>
<div class="paragraph">
<p>The karma.conf.js is also modified in order to add the Chrome Headless as a browser to execute test. The coverage output folder is change to <code>./coverage</code> instead of <code>./coverage/&lt;project-name&gt;</code></p>
</div>
</li>
<li>
<p>Jenkinsfile</p>
<div class="paragraph">
<p>The Jenkinsfile is the file which define the Jenkins pipeline of our project. With this we can execute the test, build the application and deploy it automatically following a CICD methodology. This file is prepared to work with the Production Line default values, but it is also fully configurable to your needs.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Prerequisites</p>
<div class="ulist">
<ul>
<li>
<p>A Production Line instance. It can works also if you have a Jenkins, SonarQube and Nexus3, but in this case maybe you need to configure them properly.</p>
</li>
<li>
<p>NodeJS installed in Jenkins as a global tool.</p>
</li>
<li>
<p>Google Chrome installed in Jenkins as a global custom tool.</p>
</li>
<li>
<p>SonarQube installed in Jenkins as a global tool.</p>
</li>
<li>
<p>Maven3 installed in Jenkins as a global tool.</p>
</li>
<li>
<p>A maven global settings properly configured in Jenkins.</p>
</li>
<li>
<p>If you will use docker :</p>
<div class="ulist">
<ul>
<li>
<p>Docker installed in Jenkins as a global custom tool.</p>
</li>
<li>
<p>The Nexus3 with a docker repository.</p>
</li>
<li>
<p>A machine with docker installed where the build and deploy will happen.</p>
</li>
<li>
<p>A docker network called application.</p>
</li>
</ul>
</div>
</li>
<li>
<p>If you will use OpenShift :</p>
<div class="ulist">
<ul>
<li>
<p>An OpenShift instance</p>
</li>
<li>
<p>The OpenShift projects created</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>The Jenkins syntax</p>
<div class="paragraph">
<p>In this section we will  explain a little bit the syntax of the Jenkins, so if you need to change something you will be able to do it properly.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>agent: Here you can specify the Jenkins agente where the pipeline will be executed. The default value is any.</p>
</li>
<li>
<p>options: Here you can set global options for the pipeline. By default, we add a build discarded to delete old artifacts/buils of the pipeline and also we disable the concurrent builds.</p>
<div id="devon4ng-schematic.asciidoc_jenkinsfile-teams" class="paragraph">
<p>If the teams option is passed to cicdgen, we add a new option in order to send notifications to Microsoft Teams with the status of the pipeline executions.</p>
</div>
</li>
<li>
<p>tools: Here we define the global tools configurations. By default a version of nodejs is added here.</p>
</li>
<li>
<p>environment: Here all environment variables are defined. All values defined here matches with the Production Line defaults. If you Jenkins has other values, you need to update it manually.</p>
</li>
<li>
<p>stages: Here are defined all stages that our pipeline will execute. Those stages are:</p>
<div class="ulist">
<ul>
<li>
<p>Loading Custom Tools: in this stage some custom tools are loaded. Also we set some variables depending on the git branch which you are executing.</p>
</li>
<li>
<p>Fresh Dependency Installation: install all packages need to build/run your angular project.</p>
</li>
<li>
<p>Code Linting: execute the linter analysis.</p>
</li>
<li>
<p>Execute Angular tests: execute the angular test in a Chrome Headless.</p>
</li>
<li>
<p>SonarQube code analysis: send the project to SonarQube in order to get the static code analysis of your project.</p>
</li>
<li>
<p>Build Application: compile the application to be ready to deploy in a web server.</p>
</li>
<li>
<p>Deliver application into Nexus: store all compiled files in Nexus3 as a zip file.</p>
</li>
<li>
<p>If <code>--docker</code> is present:</p>
<div class="ulist">
<ul>
<li>
<p>Create the Docker image: build a new docker image that contains the new version of the project.</p>
</li>
<li>
<p>Deploy the new image: deploy a new version of the application using the image created in the previous stage. The previous version is removed.</p>
</li>
</ul>
</div>
</li>
<li>
<p>If <code>--openshift</code> is present:</p>
<div class="ulist">
<ul>
<li>
<p>Create the Docker image: build a new docker image that contains the new version of the project using a OpenShift build config.</p>
</li>
<li>
<p>Deploy the new image: deploy a new version of the application in OpenShift.</p>
</li>
<li>
<p>Check pod status: checks that the application deployed in the previous stage is running properly. If the application does not run the pipeline will fail.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>post: actions that will be executed after the stages. We use it to clean up all files.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect4">
<h5 id="devon4ng-schematic.asciidoc_devon4ng-docker-generated-files">Devon4ng Docker generated files</h5>
<div class="paragraph">
<p>When you generate the files for a devon4ng you can also pass the option <code>--docker</code>. It will generate also some extra files related to docker.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If you pass the <code>--docker</code> option the option <code>--plurl</code> is also required. It will be used to upload the images to the Nexus3 inside Production Line. Example: if your PL url is <code>test.s2-eu.capgemini.com</code> you should execute the command in this way: <code>cicdgen generate devon4ng --groupid com.devonfw --docker --plurl test.s2-eu.capgemini.com</code>, and it will use docker-registry-test.s2-eu.capgemini.com as docker registry.
</td>
</tr>
</table>
</div>
<div class="sect5">
<h6 id="devon4ng-schematic.asciidoc_files">Files</h6>
<div class="ulist">
<ul>
<li>
<p>.dockerignore</p>
<div class="paragraph">
<p>In this files are defined the folders that will not be copied to the docker image. Fore more information read the <a href="https://docs.docker.com/engine/reference/builder/#dockerignore-file">official documentation</a>.</p>
</div>
</li>
<li>
<p>Dockerfile</p>
<div class="paragraph">
<p>This file contains the instructions to build a docker image for you project. This Dockerfile is for local development purposes, you can use it in your machine executing:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ cd &lt;path-to-your-project&gt;
$ docker build -t &lt;project-name&gt;/&lt;tag&gt; .</pre>
</div>
</div>
<div class="paragraph">
<p>This build is using a multi-stage build. First, it use a node image in order to compile the source code, then it will use a nginx image as a web server for our devon4ng application. With the multi-stage build we avoid everything related to node.js in our final image, where we only have a nginx with our application compiled.</p>
</div>
</li>
<li>
<p>Dockerfile.ci</p>
<div class="paragraph">
<p>This file contains the instructions to create a docker image for you project. The main difference with the Dockerfile is that this file will be only used in the Jenkins pipeline. Instead of compiling again the code, it takes all compiled files and the nginx.conf from Jenkins to the image.</p>
</div>
</li>
<li>
<p>nginx.conf</p>
<div class="paragraph">
<p>Configuration file for our nginx server. It defines the root folder of our application where docker copy the files to. Also it defines a fallback route to the index as described in the <a href="https://angular.io/guide/deployment#routed-apps-must-fallback-to-indexhtml">angular deployment guide</a> in oder to enable the angular routes.</p>
</div>
</li>
</ul>
</div>
<!-- toc disabled -->
</div>
</div>
</div>
<div class="sect3">
<h4 id="devon4node-schematic.asciidoc_devon4node-schematic">40.4. Devon4node schematic</h4>
<div class="paragraph">
<p>With the <code>cicdgen generate devon4node</code> command you can generate some files required for CICD. In this section we will explain the arguments of this command and also the files that will be generated.</p>
</div>
<div class="sect4">
<h5 id="devon4node-schematic.asciidoc_devon4node-schematic-arguments">Devon4node schematic arguments</h5>
<div class="paragraph">
<p>When you execute the <code>cicdgen generate devon4node</code> command you can also add some arguments in order to modify the behaviour of the command. Those arguments are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>--docker</p>
<div class="paragraph">
<p>The type of this paramter if boolean. If it is present, docker related files and pipeline stage will be also generated. For more details see docker section of Jenkinsfile and <a href="#devon4node-schematic.asciidoc_devon4node-docker-generated-files">files generated for docker</a></p>
</div>
</li>
<li>
<p>--plurl</p>
<div class="paragraph">
<p>Url of Production Line. It is required when <code>--docker</code> is true, and it will be used to know where the docker image will be uploaded.</p>
</div>
</li>
<li>
<p>--openshift</p>
<div class="paragraph">
<p>The type of this paramter if boolean. If it is present, OpenShift related files and pipeline stage will be also generated. For more details see OpenShift section of Jenkinsfile and <a href="#devon4node-schematic.asciidoc_devon4node-docker-generated-files">files generated for OpenShift</a> (same as <code>--docker</code>)</p>
</div>
</li>
<li>
<p>--ocurl</p>
<div class="paragraph">
<p>OpenShift cluster url where the application will be builded and deployed.</p>
</div>
</li>
<li>
<p>--ocn</p>
<div class="paragraph">
<p>Openshift cluster namespace</p>
</div>
</li>
<li>
<p>--groupid</p>
<div class="paragraph">
<p>The project groupId. This argument is required. It will be used for store the project in a maven repository at Nexus 3. Why maven? Because is the kind of repository where we can upload/download a zip file easily. Npm repository needs a package.json file but, as we compile the angular application to static javascript and html files, the package.json is no needed anymore.</p>
</div>
</li>
<li>
<p>--teams</p>
<div class="paragraph">
<p>With this argument we can add the teams notification option in the <a href="#devon4node-schematic.asciidoc_jenkinsfile-teams">Jenkinsfile</a>.</p>
</div>
</li>
<li>
<p>--teamsname</p>
<div class="paragraph">
<p>The name of the Microsft Teams webhook. It is defined at Microsoft Teams connectors.</p>
</div>
</li>
<li>
<p>--teamsurl</p>
<div class="paragraph">
<p>The url of the Microsft Teams webhook. It is returned by Microsoft Teams when you create a connector.</p>
</div>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="devon4node-schematic.asciidoc_devon4node-generated-files">Devon4node generated files</h5>
<div class="paragraph">
<p>When you execute the generate devon4node command, some files will be added/updated in your project.</p>
</div>
<div class="sect5">
<h6 id="devon4node-schematic.asciidoc_files">Files</h6>
<div class="ulist">
<ul>
<li>
<p>package.json</p>
<div class="paragraph">
<p>The package.json is modified in order to add a script to run the application in a docker container. It is necessary because we change a little bit the folder structure when we put all files in a docker image, so the script <code>start:prod</code> does not work.</p>
</div>
</li>
<li>
<p>.gitignore</p>
<div class="paragraph">
<p>Defines all files that git will ignore. e.g: compiled files, IDE configurations.</p>
</div>
</li>
<li>
<p>Jenkinsfile</p>
<div class="paragraph">
<p>The Jenkinsfile is the file which define the Jenkins pipeline of our project. With this we can execute the test, build the application and deploy it automatically following a CICD methodology. This file is prepared to work with the Production Line default values, but it is also fully configurable to your needs.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Prerequisites</p>
<div class="ulist">
<ul>
<li>
<p>A Production Line instance. It can works also if you have a Jenkins, SonarQube and Nexus3, but in this case maybe you need to configure them properly.</p>
</li>
<li>
<p>NodeJS installed in Jenkins as a global tool.</p>
</li>
<li>
<p>Google Chrome installed in Jenkins as a global custom tool.</p>
</li>
<li>
<p>SonarQube installed in Jenkins as a global tool.</p>
</li>
<li>
<p>Maven3 installed in Jenkins as a global tool.</p>
</li>
<li>
<p>A maven global settings properly configured in Jenkins.</p>
</li>
<li>
<p>If you will use docker :</p>
<div class="ulist">
<ul>
<li>
<p>Docker installed in Jenkins as a global custom tool.</p>
</li>
<li>
<p>The Nexus3 with a docker repository.</p>
</li>
<li>
<p>A machine with docker installed where the build and deploy will happen.</p>
</li>
<li>
<p>A docker network called application.</p>
</li>
</ul>
</div>
</li>
<li>
<p>If you will use OpenShift :</p>
<div class="ulist">
<ul>
<li>
<p>An OpenShift instance</p>
</li>
<li>
<p>The OpenShift projects created</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>The Jenkins syntax</p>
<div class="paragraph">
<p>In this section we will  explain a little bit the syntax of the Jenkins, so if you need to change something you will be able to do it properly.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>agent: Here you can specify the Jenkins agente where the pipeline will be executed. The default value is any.</p>
</li>
<li>
<p>options: Here you can set global options for the pipeline. By default, we add a build discarded to delete old artifacts/buils of the pipeline and also we disable the concurrent builds.</p>
<div id="devon4node-schematic.asciidoc_jenkinsfile-teams" class="paragraph">
<p>If the teams option is passed to cicdgen, we add a new option in order to send notifications to Microsoft Teams with the status of the pipeline executions.</p>
</div>
</li>
<li>
<p>tools: Here we define the global tools configurations. By default a version of nodejs is added here.</p>
</li>
<li>
<p>environment: Here all environment variables are defined. All values defined here matches with the Production Line defaults. If you Jenkins has other values, you need to update it manually.</p>
</li>
<li>
<p>stages: Here are defined all stages that our pipeline will execute. Those stages are:</p>
<div class="ulist">
<ul>
<li>
<p>Loading Custom Tools: in this stage some custom tools are loaded. Also we set some variables depending on the git branch which you are executing.</p>
</li>
<li>
<p>Fresh Dependency Installation: install all packages need to build/run your node project.</p>
</li>
<li>
<p>Code Linting: execute the linter analysis.</p>
</li>
<li>
<p>Execute tests: execute the tests.</p>
</li>
<li>
<p>SonarQube code analysis: send the project to SonarQube in order to get the static code analysis of your project.</p>
</li>
<li>
<p>Build Application: compile the application to be ready to deploy in a web server.</p>
</li>
<li>
<p>Deliver application into Nexus: store all compiled files in Nexus3 as a zip file.</p>
</li>
<li>
<p>If <code>--docker</code> is present:</p>
<div class="ulist">
<ul>
<li>
<p>Create the Docker image: build a new docker image that contains the new version of the project.</p>
</li>
<li>
<p>Deploy the new image: deploy a new version of the application using the image created in the previous stage. The previous version is removed.</p>
</li>
</ul>
</div>
</li>
<li>
<p>If <code>--openshift</code> is present:</p>
<div class="ulist">
<ul>
<li>
<p>Create the Docker image: build a new docker image that contains the new version of the project using a OpenShift build config.</p>
</li>
<li>
<p>Deploy the new image: deploy a new version of the application in OpenShift.</p>
</li>
<li>
<p>Check pod status: checks that the application deployed in the previous stage is running properly. If the application does not run the pipeline will fail.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>post: actions that will be executed after the stages. We use it to clean up all files.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect4">
<h5 id="devon4node-schematic.asciidoc_devon4node-docker-generated-files">Devon4node Docker generated files</h5>
<div class="paragraph">
<p>When you generate the files for a devon4node you can also pass the option <code>--docker</code>. It will generate also some extra files related to docker.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If you pass the <code>--docker</code> option the option <code>--plurl</code> is also required. It will be used to upload the images to the Nexus3 inside Production Line. Example: if your PL url is <code>test.s2-eu.capgemini.com</code> you should execute the command in this way: <code>cicdgen generate devon4node --groupid com.devonfw --docker --plurl test.s2-eu.capgemini.com</code>, and it will use docker-registry-test.s2-eu.capgemini.com as docker registry.
</td>
</tr>
</table>
</div>
<div class="sect5">
<h6 id="devon4node-schematic.asciidoc_files">Files</h6>
<div class="ulist">
<ul>
<li>
<p>.dockerignore</p>
<div class="paragraph">
<p>In this files are defined the folders that will not be copied to the docker image. Fore more information read the <a href="https://docs.docker.com/engine/reference/builder/#dockerignore-file">official documentation</a>.</p>
</div>
</li>
<li>
<p>Dockerfile</p>
<div class="paragraph">
<p>This file contains the instructions to build a docker image for you project. This Dockerfile is for local development purposes, you can use it in your machine executing:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ cd &lt;path-to-your-project&gt;
$ docker build -t &lt;project-name&gt;/&lt;tag&gt; .</pre>
</div>
</div>
<div class="paragraph">
<p>This build is installs all dependencies in ordre to build the project and then remove all devDependencies in order to keep only the production dependencies.</p>
</div>
</li>
<li>
<p>Dockerfile.ci</p>
<div class="paragraph">
<p>This file contains the instructions to create a docker image for you project. The main difference with the Dockerfile is that this file will be only used in the Jenkins pipeline. Instead of compiling again the code, it takes all compiled files from Jenkins to the image.</p>
</div>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
</div>
<h1 id="master-cobigen.asciidoc" class="sect0">VIII: CobiGen&#8201;&#8212;&#8201;Code-based incremental Generator</h1>
<div class="sect1">
<h2 id="master-cobigen.asciidoc_document-description">41. Document Description</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This document contains the documentation of the CobiGen core module as well as all CobiGen plug-ins and the CobiGen eclipse integration.</p>
</div>
<div class="paragraph">
<p><strong>Current versions:</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>CobiGen - Eclipse Plug-in v4.4.3</p>
</li>
<li>
<p>CobiGen - Maven Build Plug-in v4.1.0</p>
</li>
</ul>
</div>
<hr>
<div class="ulist">
<ul>
<li>
<p>CobiGen v5.3.4</p>
</li>
<li>
<p>CobiGen - Java Plug-in v2.1.0</p>
</li>
<li>
<p>CobiGen - XML Plug-in v4.1.0</p>
</li>
<li>
<p>CobiGen - TypeScript Plug-in v2.3.2</p>
</li>
<li>
<p>CobiGen - Property Plug-in v2.0.0</p>
</li>
<li>
<p>CobiGen - Text Merger v2.0.0</p>
</li>
<li>
<p>CobiGen - JSON Plug-in v2.0.0</p>
</li>
<li>
<p>CobiGen - HTML Plug-in v2.0.1</p>
</li>
<li>
<p>CobiGen - Open API Plug-in v2.3.0</p>
</li>
<li>
<p>CobiGen - FreeMaker Template Engine v2.0.0</p>
</li>
<li>
<p>CobiGen - Velocity Template Engine v2.0.0</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Authors:</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Malte Brunnlieb</p>
</li>
<li>
<p>Jaime Diaz Gonzalez</p>
</li>
<li>
<p>Steffen Holzer</p>
</li>
<li>
<p>Ruben Diaz Martinez</p>
</li>
<li>
<p>Joerg Hohwiller</p>
</li>
<li>
<p>Fabian Kreis</p>
</li>
<li>
<p>Lukas Goerlach</p>
</li>
<li>
<p>Krati Shah</p>
</li>
<li>
<p>Christian Richter</p>
</li>
<li>
<p>Erik Grüner</p>
</li>
<li>
<p>Mike Schumacher</p>
</li>
<li>
<p>Marco Rose</p>
</li>
<li>
<p>Mohamed Ghanmi</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="Guide-to-the-Reader.asciidoc">41.1. Guide to the Reader</h3>
<div class="paragraph">
<p>Dependent on the intention you are reading this document, you might be most interested in the following chapters:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If this is <strong>your first contact with CobiGen</strong>, you will be interested in the <a href="#home.asciidoc">general purpose</a> of CobiGen, in the <a href="#mgmt_license-agreement.asciidoc">licensing of CobiGen</a>, as well as in the <a href="#mgmt_shared-service.asciidoc">Shared Service</a> provided for CobiGen. Additionally, there are some <a href="#cobigen-usecases.asciidoc">general use cases</a>, which are currently implemented and maintained to be used out of the box.</p>
</li>
<li>
<p>As a <strong>user of the CobiGen Eclipse integration</strong>, you should focus on the <a href="#cobigen-eclipse_installation.asciidoc">Installation</a> and <a href="#cobigen-eclipse_usage.asciidoc">Usage</a> chapters to get a good introduction how to use CobiGen in eclipse.</p>
</li>
<li>
<p>As a <strong>user of the Maven integration</strong>, you should focus on the <a href="#cobigen-maven_configuration.asciidoc">Maven configuration</a> chapter, which guides you through the integration if CobiGen into your build configuration.</p>
</li>
<li>
<p>If you like to <strong>adapt the configuration of CobiGen</strong>, you have to step more deeper into the <a href="#cobigen-core_configuration.asciidoc">configuration guide</a> as well as into the plug-in configuration extensions for the <a href="#cobigen-javaplugin.asciidoc">Java Plug-in</a>, <a href="#cobigen-xmlplugin.asciidoc">XML-Plugin</a>, <a href="#cobigen-propertyplugin.asciidoc">Java Property Plug-in</a>, as well as for the <a href="#cobigen-textmerger.asciidoc">Text-Merger Plug-in</a>.</p>
</li>
<li>
<p>Finally, if want to <strong>develop your own templates</strong>, you will be thankful for <a href="#cobigen-templates_helpful-links.asciidoc">helpful links</a> in addition to the plug-ins documentation as referenced in the previous point.</p>
</li>
</ul>
</div>
<!-- toc disabled -->
</div>
<div class="sect2">
<h3 id="Home.asciidoc">41.2. CobiGen - Code-based incremental Generator</h3>
<div class="sect3">
<h4 id="home.asciidoc_overview">41.2.1. Overview</h4>
<div class="paragraph">
<p>CobiGen is a <strong>generic incremental generator</strong> for end to end code generation tasks, mostly used in Java projects.
Due to a template-based approach, CobiGen <strong>generates any set of text-based documents and document fragments</strong>.</p>
</div>
<div class="paragraph">
<p><strong>Input (currently):</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Java classes</p>
</li>
<li>
<p>XML-based files</p>
</li>
<li>
<p>OpenAPI documents</p>
</li>
<li>
<p>Possibly more inputs like wsdl, which is currently not implemented.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Output:</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>any text-based document or document fragments specified by templates</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="home.asciidoc_architecture">41.2.2. Architecture</h4>
<div class="paragraph">
<p>CobiGen is build as an extensible framework for incremental code generation. It provides extension points for new input readers allowing to read new input types and converting them to an internally processed model. The model is used to process templates of different kinds to generate patches. The template processing will be done by different template engines. There is an extension point for template engines to support multiple ones as well. Finally, the patch will be structurally merged into potentially already existing code. To allow structural merge on different programming languages, the extension point for structural mergers has been introduced. Here you will see an overview of the currently available extension points and plug-ins:</p>
</div>
</div>
<div class="sect3">
<h4 id="home.asciidoc_features-and-characteristics">41.2.3. Features and Characteristics</h4>
<div class="ulist">
<ul>
<li>
<p>Generate fresh files across all the layers of a application - ready to run.</p>
</li>
<li>
<p>Add on to existing files merging code into it. E.g. generate new methods into existing java classes or adding nodes to an XML file. Merging of contents into existing files will be done using structural merge mechanisms.</p>
</li>
<li>
<p>Structural merge mechanisms are currently implemented for Java, XML, Java Property Syntax, JSON, Basic HTML, Text Append, TypeScript.</p>
</li>
<li>
<p>Conflicts can be resolved individually but automatically by former configuration for each template.</p>
</li>
<li>
<p>CobiGen provides an <a href="#cobigen-eclipse_usage.asciidoc">Eclipse integration</a> as well as a <a href="#cobigen-maven_configuration.asciidoc">Maven Integration</a>.</p>
</li>
<li>
<p>CobiGen comes with an extensive documentation for <a href="#cobigen-eclipse_installation.asciidoc">users</a> and <a href="#cobigen-core_configuration.asciidoc">developers</a>.</p>
</li>
<li>
<p>templates can be fully tailored to project needs - this is considered as a simple task.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="home.asciidoc_selection-of-current-and-past-cobigen-applications">41.2.4. Selection of current and past CobiGen applications</h4>
<div class="paragraph">
<p>General applications:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Generation of a <strong>Java CRUD application based on <a href="https://github.com/oasp/">deonfw</a> architecture</strong> including all software-layers on the server plus code for js-clients (AngularJs). You can find details <a href="#cobigen-usecases.asciidoc">here</a>.</p>
</li>
<li>
<p>Generation of a <strong>Java CRUD application according to the Register Factory architecture</strong>. Persistence entities are the input for generation.</p>
</li>
<li>
<p>Generation of <strong>builder classes for generating testdata</strong> for JUnit-Tests. Input are the persistence entities.</p>
</li>
<li>
<p>Generation of a <strong>EXT JS 6</strong> client with full CRUD operations connected a devon4j server.</p>
</li>
<li>
<p>Generation of a <strong>Angular 6</strong> client with full CRUD operations connected a devon4j server.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Project-specific applications in the past:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Generation of an <strong>additional Java type hierarchy on top of existing Java classes</strong> in combination with additional methods to be integrated in the modified classes. Hibernate entites were considered as input as well as output of the generation. The rational in this case, was to generate an additional business object hierarchy on top of an existing data model for efficient business processing.</p>
</li>
<li>
<p>Generation of <strong>hash- and equals-methods</strong> as well as copy constructors dependending on the field types of the input Java class. Furthermore, CobiGen is able to re-generate these methods/constructors triggered by the user, i.e, when fields have been changed.</p>
</li>
<li>
<p><strong>Extraction of JavaDoc</strong> of test classes and their methods for generating a csv test documentation. This test documentation has been further processed manually in Excel to provide an good overview about the currently available tests in the software system, which enables further human analysis.</p>
</li>
</ul>
</div>
<!-- toc disabled -->
</div>
</div>
<div class="sect2">
<h3 id="cobigen-usecases.asciidoc">41.3. General use cases</h3>
<div class="paragraph">
<p>In addition to the <a href="Home.html#selection-of-current-and-past-cobigen-applications">selection of CobiGen applications</a> introduced before, this chapter provides a more detailed overview about the currently implemented and maintained general use cases. These can be used by any project following a supported reference architecture as e.g. the <a href="https://github.com/oasp/">devonfw</a> or <a href="http://www.bva.bund.de/SharedDocs/Downloads/DE/BIT/RegisterFactory/Whitepaper_Register_Factory.html">Register Factory</a>.</p>
</div>
<div class="sect3">
<h4 id="cobigen-usecases.asciidoc_devon4j">41.3.1. devon4j</h4>
<div class="paragraph">
<p>With our templates for <a href="https://github.com/devonfw/devon4j">devon4j</a>, you can generate a whole CRUD application from a single Entity class. You save the effort for creating, DAOs, Transfer Objects, simple CRUD use cases with REST services and even the client application can be generated.</p>
</div>
<div class="sect4">
<h5 id="cobigen-usecases.asciidoc_-crud-server-application-for-devon4j">CRUD server application for devon4j</h5>
<div class="paragraph">
<p>For the server, the required files for all architectural layers (Data access, logic, and service layer) can be created based on your Entity class. After the generation, you have CRUD functionality for the entity from bottom to top which can be accessed via a RESTful web service. Details are provided in the <a href="https://github.com/devonfw/devon/wiki/tutorial-devon-generator">Devon wiki</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="cobigen-usecases.asciidoc_crud-client-application-for-devon4ng">CRUD client application for devon4ng</h5>
<div class="paragraph">
<p>Based on the REST services on the server, you can also generate an <a href="https://angularjs.org/">Angular</a> client based on <a href="https://github.com/devonfw/devon4ng">devon4ng</a>. With the help of <a href="https://nodejs.org/">Node.js</a>, you have a working client application for displaying your entities within minutes!</p>
</div>
</div>
<div class="sect4">
<h5 id="cobigen-usecases.asciidoc_testdata-builder-for-devon4j">Testdata Builder for devon4j</h5>
<div class="paragraph">
<p>Generating a builder pattern for POJOs to easily create test data in your tests. CobiGen is not only able to generate a plain builder pattern but rather builder, which follow a specific concept to minimize test data generation efforts in your unit tests. The following <code>Person</code> class as an example:</p>
</div>
<div class="listingblock">
<div class="title">Listing 85. Person class</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class Person {

    private String firstname;
    private String lastname;
    private int birthyear;
    @NotNull
    private Address address;

    @NotNull
    public String getFirstname() {
        return this.firstname;
    }

    // additional default setter and getter
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>It is a simple POJO with a validation annotation, to indicate, that <code>firstname</code> should never be <code>null</code>. Creating this object in a test would imply to call every setter, which is kind of nasty. Therefore, the Builder Pattern has been introduced for quite a long time in software engineering, allowing to easily create POJOs with a fluent API. See below.</p>
</div>
<div class="listingblock">
<div class="title">Listing 86. Builder pattern example</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">Person person = new PersonBuilder()
                .firstname("Heinz")
                .lastname("Erhardt")
                .birthyear(1909)
                .address(
                    new AddressBuilder().postcode("22222")
                        .city("Hamburg").street("Luebecker Str. 123")
                        .createNew())
                .addChild(
                    new PersonBuilder()[...].createNew()).createNew();</code></pre>
</div>
</div>
<div class="paragraph">
<p>The Builder API generated by CobiGen allows you to set any setter accessible field of a POJO in a fluent way. But in addition lets assume a test, which should check the birth year as precondition for any business operation. So specifying all other fields of <code>Person</code>, especially <code>firstname</code> as it is mandatory to enter business code, would not make sense. The test behavior should just depend on the specification of the birth year and on no other data. So we would like to just provide this data to the test.</p>
</div>
<div class="paragraph">
<p>The Builder classes generated by CobiGen try to tackle this inconvenience by providing the ability to declare default values for any mandatory field due to validation or database constraints.</p>
</div>
<div class="listingblock">
<div class="title">Listing 87. Builder Outline</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class PersonBuilder {

    private void fillMandatoryFields() {
        firstname("lasdjfaöskdlfja");
        address(new AddressBuilder().createNew());
    };
    private void fillMandatoryFields_custom() {...};

    public PersonBuilder firstname(String value);
    public PersonBuilder lastname(String value);
    ...

    public Person createNew();
    public Person persist(EntityManager em);
    public List&lt;Person&gt; persistAndDuplicate(EntityManager em, int count);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Looking at the plotted builder API generated by CobiGen, you will find two <code>private</code> methods. The method <code>fillMandatoryFields</code> will be generated by CobiGen and regenerated every time CobiGen generation will be triggered for the <code>Person</code> class. This method will set every automatically detected field with not <code>null</code> constraints to a default value. However, by implementing <code>fillMandatoryFields_custom</code> on your own, you can reset these values or even specify more default values for any other field of the object. Thus, running <code>new PersonBuilder().birthyear(1909).createNew();</code> will create a valid object of <code>Person</code>, which is already pre-filled such that it does not influence the test execution besides the fact that it circumvents database and validation issues.</p>
</div>
<div class="paragraph">
<p>This even holds for complex data structures as indicated by <code>address(new AddressBuilder().createNew());</code>. Due to the use of the <code>AddressBuilder</code> for setting the default value for the field <code>address</code>, also the default values for <code>Address</code> will be set automatically.</p>
</div>
<div class="paragraph">
<p>Finally, the builder API provides different methods to create new objects.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>createNew()</code> just creates a new object from the builder specification and returns it.</p>
</li>
<li>
<p><code>persist(EntityManager)</code> will create a new object from the builder specification and persists it to the database.</p>
</li>
<li>
<p><code>persistAndDuplicate(EntityManager, int)</code> will create the given amount of objects form the builder specification and persists all of these. After the initial generation of each builder, you might want to adapt the method body as you will most probably not be able to persist more than one object with the same field assignments to the database due to <code>unique</code> constraints. Thus, please see the generated comment in the method to adapt <code>unqiue</code> fields accordingly before persisting to the database.</p>
</li>
</ul>
</div>
<div class="sect5">
<h6 id="cobigen-usecases.asciidoc_custom-builder-for-business-needs">Custom Builder for Business Needs</h6>
<div class="paragraph">
<p>CobiGen just generates basic builder for any POJO. However, for project needs you probably would like to have even more complex builders, which enable the easy generation of more complex test data which are encoded in a large object hierarchy. Therefore, the generated builders can just be seen as a tool to achieve this. You can define your own business driven builders in the same way as the generated builders, but explicitely focusing on your business needs. Just take this example as a demonstration of that idea:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">  University uni = new ComplexUniversityBuilder()
    .withStudents(200)
    .withProfessors(4)
    .withExternalStudent()
    .createNew();</code></pre>
</div>
</div>
<div class="paragraph">
<p>E.g. the method <code>withExternalStudent()</code> might create a person, which is a student and is flagged to be an external student. Basing this implementation on the generated builders will even assure that you would benefit from any default values you have set before. In addition, you can even imagine any more complex builder methods setting values driven your reusable testing needs based on the specific business knowledge.</p>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="cobigen-usecases.asciidoc_register-factory">41.3.2. Register Factory</h4>
<div class="sect4">
<h5 id="cobigen-usecases.asciidoc_-crud-server-application">CRUD server application</h5>
<div class="paragraph">
<p>Generates a CRUD application with persistence entites as inputs. This includes DAOs, TOs, use cases, as well as a CRUD JSF user interface if needed.</p>
</div>
</div>
<div class="sect4">
<h5 id="cobigen-usecases.asciidoc_-testdata-builder">Testdata Builder</h5>
<div class="paragraph">
<p>Analogous to <a href="#cobigen-usecases.asciidoc_testdata-builder-for-devon4j">Testdata Builder for devon4J</a></p>
</div>
</div>
<div class="sect4">
<h5 id="cobigen-usecases.asciidoc_test-documentation">Test documentation</h5>
<div class="paragraph">
<p>Generate test documentation from test classes. The input are the doclet tags of several test classes, which e.g. can specify a description, a cross-reference, or a test target description. The result currently is a csv file, which lists all tests with the corresponding meta-information. Afterwards, this file might be styled and passed to the customer if needed and it will be up-to-date every time!</p>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="master-cobigen.asciidoc_cobigen">42. CobiGen</h2>
<div class="sectionbody">
<!-- toc disabled -->
<div class="sect2">
<h3 id="cobigen-core_configuration.asciidoc">42.1. Configuration</h3>
<div class="paragraph">
<p>CobiGen will be configured using a configuration folder containing a context configuration, multiple template folders with a templates configuration per template folder, and a number of templates in each template folder. Find some examples <a href="https://github.com/devonfw/tools-cobigen/tree/master/cobigen-templates">here</a>. Thus, a simple folder structure might look like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>CobiGen_Templates
 |- templateFolder1
    |- templates.xml
 |- templateFolder2
    |- templates.xml
 |- context.xml</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="cobigen-core_configuration.asciidoc_context-configuration">42.1.1. Context Configuration</h4>
<div class="paragraph">
<p>The context configuration (<code>context.xml</code>) always has the following root structure:</p>
</div>
<div class="listingblock">
<div class="title">Listing 88. Context Configuration</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;contextConfiguration xmlns="http://capgemini.com"
                      xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
                      version="1.0"&gt;
    &lt;triggers&gt;
        ...
    &lt;/triggers&gt;
&lt;/contextConfiguration&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The context configuration has a <code>version</code> attribute, which should match the XSD version the context configuration is an instance of. It should not state the version of the currently released version of CobiGen. This attribute should be maintained by the context configuration developers. If configured correctly, it will provide a better feedback for the user and thus higher user experience. Currently there is only the version v1.0. For further version there will be a changelog later on.</p>
</div>
<div class="sect4">
<h5 id="cobigen-core_configuration.asciidoc_trigger-node">Trigger Node</h5>
<div class="paragraph">
<p>As children of the <code>&lt;triggers&gt;</code> node you can define different triggers. By defining a <code>&lt;trigger&gt;</code> you declare a mapping between special inputs and a <code>templateFolder</code>, which contains all templates, which are worth to be generated with the given input.</p>
</div>
<div class="listingblock">
<div class="title">Listing 89. trigger configuration</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;trigger id="..." type="..." templateFolder="..." inputCharset="UTF-8" &gt;
    ...
&lt;/trigger&gt;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>The attribute <code>id</code> should be unique within an context configuration. It is necessary for efficient internal processing.</p>
</li>
<li>
<p>The attribute <code>type</code> declares a specific <em>trigger interpreter</em>, which might be provided by additional plug-ins. A <em>trigger interpreter</em> has to provide an <em>input reader</em>, which reads specific inputs and creates a template object model out of it to be processed by the FreeMarker template engine later on. Have a look at the plug-in&#8217;s documentation of your interest and see, which trigger types and thus inputs are currently supported.</p>
</li>
<li>
<p>The attribute <code>templateFolder</code> declares the relative path to the template folder, which will be used if the trigger gets activated.</p>
</li>
<li>
<p>The attribute <code>inputCharset</code> <em>(optional)</em> determines the charset to be used for reading any input file.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="cobigen-core_configuration.asciidoc_matcher-node">Matcher Node</h5>
<div class="paragraph">
<p>A trigger will be activated if its matchers hold the following formula:</p>
</div>
<div class="paragraph">
<p><code>!(NOT || &#8230;&#8203; || NOT) &amp;&amp; AND &amp;&amp; &#8230;&#8203; &amp;&amp; AND &amp;&amp; (OR || &#8230;&#8203; || OR)</code></p>
</div>
<div class="paragraph">
<p>Whereas NOT/AND/OR describes the accumulationType of a <em>matcher</em> (see below) and e.g. <code>NOT</code> means 'a <em>matcher</em> with accumulationType NOT matches a given input'. Thus additionally to an <em>input reader</em>, a <em>trigger interpreter</em> has to define at least one set of <em>matchers</em>, which are satisfyable, to be fully functional. A <code>&lt;matcher&gt;</code> node declares a specific characteristics a valid input should have.</p>
</div>
<div class="listingblock">
<div class="title">Listing 90. Matcher Configuration</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;matcher type="..." value="..." accumulationType="..."&gt;
    ...
&lt;/matcher&gt;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>The attribute <code>type</code> declares a specific type of <em>matcher</em>, which has to be provided by the surrounding <em>trigger interpreter</em>. Have a look at the plug-in&#8217;s documentation, which also provides the used trigger type for more information about valid matcher and their functionalities.</p>
</li>
<li>
<p>The attribute <code>value</code> might contain any information necessary for processing the <em>matcher&#8217;s</em> functionality. Have a look at the relevant plug-in&#8217;s documentation for more detail.</p>
</li>
<li>
<p>The attribute <code>accumulationType</code> <em>(optional)</em> specifies how the matcher will influence the trigger activation. Valid values are:</p>
<div class="ulist">
<ul>
<li>
<p>OR (default): if any matcher of accumulation type OR <em>matches</em>, the trigger will be activated as long as there are no further matchers with different accumulation types</p>
</li>
<li>
<p>AND: if any matcher with AND accumulation type does <em>not match</em>, the trigger will <em>not</em> be activated</p>
</li>
<li>
<p>NOT: if any matcher with NOT accumulation type <em>matches</em>, the trigger will <em>not</em> be activated</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="cobigen-core_configuration.asciidoc_variableassignment-node">VariableAssignment Node</h5>
<div class="paragraph">
<p>Finally, a <code>&lt;matcher&gt;</code> node can have multiple <code>&lt;variableAssignment&gt;</code> nodes as children. <em>Variable assignments</em> allow to parametrize the generation by additional values, which will be added to the object model for template processing. The variables declared using <em>variable assignments</em>, will be made accessible in the templates.xml as well in the object model for template processing via the namespace <code>variables.*</code>.</p>
</div>
<div class="listingblock">
<div class="title">Listing 91. Complete Configuration Pattern</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;contextConfiguration xmlns="http://capgemini.com"
                      xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
                      version="1.0"&gt;
    &lt;triggers&gt;
        &lt;trigger id="..." type="..." templateFolder="..."&gt;
            &lt;matcher type="..." value="..."&gt;
                &lt;variableAssignment type="..." key="..." value="..." /&gt;
            &lt;/matcher&gt;
        &lt;/trigger&gt;
    &lt;/triggers&gt;
&lt;/contextConfiguration&gt;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>The attribute <code>type</code> declares the type of <em>variable assignment</em> to be processed by the <em>trigger interpreter</em> providing plug-in. This attribute enables <em>variable assignments</em> with different dynamic value resolutions.</p>
</li>
<li>
<p>The attribute <code>key</code> declares the namespace under which the resolved value will be accessible later on.</p>
</li>
<li>
<p>The attribute <code>value</code> might declare a constant value to be assigned or any hint for value resolution done by the <em>trigger interpreter</em> providing plug-in. For instance, if <code>type</code> is <code>regex</code>, then on <code>value</code> you will assign the matched group number by the regex (1, 2, 3&#8230;&#8203;)</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="cobigen-core_configuration.asciidoc_containermatcher-node">ContainerMatcher Node</h5>
<div class="paragraph">
<p>The <code>&lt;containerMatcher&gt;</code> node is an additional matcher for matching containers of multiple input objects.
Such a container might be a package, which encloses multiple types or---more generic---a model, which encloses multiple elements. A container matcher can be declared side by side with other matchers:</p>
</div>
<div class="listingblock">
<div class="title">Listing 92. ContainerMatcher Declaration</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;contextConfiguration xmlns="http://capgemini.com"
                      xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
                      version="1.0"&gt;
    &lt;triggers&gt;
        &lt;trigger id="..." type="..." templateFolder="..." &gt;
            &lt;containerMatcher type="..." value="..." retrieveObjectsRecursively="..." /&gt;
            &lt;matcher type="..." value="..."&gt;
                &lt;variableAssignment type="..." variable="..." value="..." /&gt;
            &lt;/matcher&gt;
        &lt;/trigger&gt;
    &lt;/triggers&gt;
&lt;/contextConfiguration&gt;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>The attribute <code>type</code> declares a specific type of <em>matcher</em>, which has to be provided by the surrounding <em>trigger interpreter</em>. Have a look at the plug-in&#8217;s documentation, which also provides the used trigger type for more information about valid matcher and their functionalities.</p>
</li>
<li>
<p>The attribute <code>value</code> might contain any information necessary for processing the <em>matcher&#8217;s</em> functionality. Have a look at the relevant plug-in&#8217;s documentation for more detail.</p>
</li>
<li>
<p>The attribute <code>retrieveObjectsRecursively</code> <em>(optional boolean)</em> states, whether the children of the input should be retrieved recursively to find matching inputs for generation.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The semantics of a container matchers are the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A <code>&lt;containerMatcher&gt;</code> does not declare any <code>&lt;variableAssignment&gt;</code> nodes</p>
</li>
<li>
<p>A <code>&lt;containerMatcher&gt;</code> matches an input if and only if one of its enclosed elements satisfies a set of <code>&lt;matcher&gt;</code> nodes of the same <code>&lt;trigger&gt;</code></p>
</li>
<li>
<p>Inputs, which match a <code>&lt;containerMatcher&gt;</code> will cause a generation for each enclosed element</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="cobigen-core_configuration.asciidoc_templates-configuration">42.1.2. Templates Configuration</h4>
<div class="paragraph">
<p>The template configuration (<code>templates.xml</code>) specifies, which templates exist and under which circumstances it will be generated. There are two possible configuration styles:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Configure the template meta-data for each template file by <a href="#cobigen-core_configuration.asciidoc_template-node">template nodes</a></p>
</li>
<li>
<p><em>(since cobigen-core-v1.2.0)</em>: Configure <a href="#cobigen-core_configuration.asciidoc_templatescan-node">templateScan nodes</a> to automatically retrieve a default configuration for all files within a configured folder and possibly modify the automatically configured templates using <a href="#cobigen-core_configuration.asciidoc_templateextension-node">templateExtension nodes</a></p>
</li>
</ol>
</div>
<div class="paragraph">
<p>To get an intuition of the idea, the following will intially describe the first (more extensive) configuration style. Such an configuration root structure looks as follows:</p>
</div>
<div class="listingblock">
<div class="title">Listing 93. Extensive Templates Configuration</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;templatesConfiguration xmlns="http://capgemini.com"
                        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
                        version="1.0" templateEngine="FreeMarker"&gt;
    &lt;templates&gt;
            ...
    &lt;/templates&gt;
    &lt;increments&gt;
            ...
    &lt;/increments&gt;
&lt;/templatesConfiguration&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The root node <code>&lt;templatesConfiguration&gt;</code> specifies two attributes. The attribute <code>version</code> provides further usability support and will be handled analogous to the <code>version</code> attribute of the <a href="#cobigen-core_configuration.asciidoc_context-configuration">context configuration</a>. The optional attribute <code>templateEngine</code> specifies the template engine to be used for processing the templates (<em>since cobigen-core-4.0.0</em>). By default it is set to <code>FreeMarker</code>.
The node <code>&lt;templatesConfiguration&gt;</code> allows two different grouping nodes as children. First, there is the <code>&lt;templates&gt;</code> node, which groups all declarations of templates. Second, there is the <code>&lt;increments&gt;</code> node, which groups all declarations about increments.</p>
</div>
<div class="sect4">
<h5 id="cobigen-core_configuration.asciidoc_template-node">Template Node</h5>
<div class="paragraph">
<p>The <code>&lt;templates&gt;</code> node groups multiple <code>&lt;template&gt;</code> declarations, which enables further generation. Each template file should be registered at least once as a template to be considered.</p>
</div>
<div class="listingblock">
<div class="title">Listing 94. Example Template Configuration</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;templates&gt;
    &lt;template name="..." destinationPath="..." templateFile="..." mergeStrategy="..." targetCharset="..." /&gt;
    ...
&lt;/templates&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>A template declaration consist of multiple information:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The attribute <code>name</code> specifies an unique ID within the templates configuration, which will later be reused in the <a href="#cobigen-core_configuration.asciidoc_increment-node">increment definitions</a>.</p>
</li>
<li>
<p>The attribute <code>destinationPath</code> specifies the destination path the template will be generated to. It is possible to use all variables defined by <a href="#cobigen-core_configuration.asciidoc_variableassignment-node">variable assignments</a> within the path declaration using the FreeMarker syntax <code>${variables.*}</code>. While resolving the variable expressions, each dot within the value will be automatically replaced by a slash. This behavior is accounted for by the transformations of Java packages to paths as CobiGen has first been developed in the context of the Java world. Furthermore, the destination path variable resolution provides the following additional built-in operators analogue to the FreeMarker syntax:</p>
<div class="ulist">
<ul>
<li>
<p><code>?cap_first</code> analogue to <a href="http://freemarker.org/docs/ref_builtins_string.html#ref_builtin_cap_first">FreeMarker</a></p>
</li>
<li>
<p><code>?uncap_first</code> analogue to <a href="http://freemarker.org/docs/ref_builtins_string.html#ref_builtin_uncap_first">FreeMarker</a></p>
</li>
<li>
<p><code>?lower_case</code> analogue to <a href="http://freemarker.org/docs/ref_builtins_string.html#ref_builtin_lower_case">FreeMarker</a></p>
</li>
<li>
<p><code>?upper_case</code> analogue to <a href="http://freemarker.org/docs/ref_builtins_string.html#ref_builtin_upper_case">FreeMarker</a></p>
</li>
<li>
<p><code>?replace(regex, replacement)</code> - Replaces all occurrences of the regular expression <code>regex</code> in the variable&#8217;s value with the given <code>replacement</code> string. (since cobigen-core v1.1.0)</p>
</li>
<li>
<p><code>?removeSuffix(suffix)</code> - Removes the given <code>suffix</code> in the variable&#8217;s value iff the variable&#8217;s value ends with the given <code>suffix</code>. Otherwise nothing will happen. (since cobigen-core v1.1.0)</p>
</li>
<li>
<p><code>?removePrefix(prefix)</code> - Analogue to <code>?removeSuffix</code> but removes the prefix of the variable&#8217;s value. (since cobigen-core v1.1.0)</p>
</li>
</ul>
</div>
</li>
<li>
<p>The attribute <code>templateFile</code> describes the relative path dependent on the template folder specified in the <a href="#cobigen-core_configuration.asciidoc_trigger-node">trigger</a> to the template file to be generated.</p>
</li>
<li>
<p>The attribute <code>mergeStrategy</code> <em>(optional)</em> can be <em>optionally</em> specified and declares the type of merge mechanism to be used, when the <code>destinationPath</code> points to an already existing file. CobiGen by itself just comes with a <code>mergeStrategy</code> <code>override</code>, which enforces file regeneration in total. Additional available merge strategies have to be obtained from the different plug-in&#8217;s documentations (see here for <a href="cobigen-javaplugin.html#merger-extensions">java</a>, <a href="cobigen-xmlplugin.html#merger-extensions">XML</a>, <a href="cobigen-propertyplugin.html#merger-extensions">properties</a>, and <a href="cobigen-textmerger.html#merger-extensions">text</a>). Default: <em>not set</em> (means not mergable)</p>
</li>
<li>
<p>The attribute <code>targetCharset</code> <em>(optional)</em> can be <em>optionally</em> specified and declares the encoding with which the contents will be written into the destination file. This also includes reading an existing file at the destination path for merging its contents with the newly generated ones. Default: <em>UTF-8</em></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><em>(Since version 4.1.0)</em> It is possible to reference external <code>template</code> (templates defined on another trigger), thanks to using <code>&lt;incrementRef &#8230;&#8203;&gt;</code> that are explained <a href="#cobigen-core_configuration.asciidoc_increment-node">here</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="cobigen-core_configuration.asciidoc_templatescan-node">TemplateScan Node</h5>
<div class="paragraph">
<p><em>(since cobigen-core-v1.2.0)</em></p>
</div>
<div class="paragraph">
<p>The second configuration style for template meta-data is driven by initially scanning all available templates and automatically configure them with a default set of meta-data. A scanning configuration might look like this:</p>
</div>
<div class="listingblock">
<div class="title">Listing 95. Example of Template-scan configuration</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;templatesConfiguration xmlns="http://capgemini.com"
                        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
                        version="1.2"&gt;
    &lt;templateScans&gt;
        &lt;templateScan templatePath="templates" templateNamePrefix="prefix_" destinationPath="src/main/java"/&gt;
    &lt;/templateScans&gt;
&lt;/templatesConfiguration&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can specify multiple <code>&lt;templateScan &#8230;&#8203;&gt;</code> nodes for different <code>templatePaths</code> and different <code>templateNamePrefixes</code>.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The <code>name</code> can be specified to later on reference the templates found by a template-scan within an <a href="#cobigen-core_configuration.asciidoc_increment-node">increment</a>. <em>(since cobigen-core-v2.1.)</em></p>
</li>
<li>
<p>The <code>templatePath</code> specifys the relative path from the <code>templates.xml</code> to the root folder from which the template scan should be performed.</p>
</li>
<li>
<p>The <code>templateNamePrefix</code> <em>(optional)</em> defines a common id prefix, which will be added to all found and automatically configured templates.</p>
</li>
<li>
<p>The <code>destinationPath</code> defines the root folder all found templates should be generated to, whereas the root folder will be a prefix for all found and automatically configured templates.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>A <code>templateScan</code> will result in the following <strong>default configuration of templates</strong>. For each file found, new <a href="#cobigen-core_configuration.asciidoc_template-node">template</a> will be created virtually with the following default values:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>id</code>: file name without <code>.ftl</code> extension prefixed by <code>templateNamePrefix</code> from <code>template-scan</code></p>
</li>
<li>
<p><code>destinationPath</code>: relative file path of the file found with the prefix defined by <code>destinationPath</code> from <code>template-scan</code>. Furthermore,</p>
<div class="ulist">
<ul>
<li>
<p>it is possible to use the syntax for accessing and modifying variables as described for the attribute <code>destinationPath</code> of the <a href="#cobigen-core_configuration.asciidoc_template-node">template node</a>, besides the only difference, that due to file system restrictions you have to replace all <code>?</code>-signs (for built-ins) with <code>#</code>-signs.</p>
</li>
<li>
<p>the files to be scanned, should provide their final file-ending by the following file naming convention: <code>&lt;filename&gt;.&lt;fileending&gt;.ftl</code> Thus the file-ending <code>.ftl</code> will be removed after generation.</p>
</li>
</ul>
</div>
</li>
<li>
<p><code>templateFile</code>: relative path to the file found</p>
</li>
<li>
<p><code>mergeStrategy</code>: <em>(optional)</em> not set means not mergable</p>
</li>
<li>
<p><code>targetCharset</code>:  <em>(optional)</em> defaults to UTF-8</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><em>(Since version 4.1.0)</em> It is possible to reference external <code>templateScan</code> (templateScans defined on another trigger), thanks to using <code>&lt;incrementRef &#8230;&#8203;&gt;</code> that are explained <a href="#cobigen-core_configuration.asciidoc_increment-node">here</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="cobigen-core_configuration.asciidoc_templateextension-node">TemplateExtension Node</h5>
<div class="paragraph">
<p><em>(since cobigen-core-v1.2.0)</em></p>
</div>
<div class="paragraph">
<p>Additionally to the <a href="#cobigen-core_configuration.asciidoc_templatescan-node">templateScan declaration</a> it is easily possible to rewrite specific attributes for any scanned and automatically configured template.</p>
</div>
<div class="listingblock">
<div class="title">Listing 96. Example Configuration of a TemplateExtension</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;templates&gt;
    &lt;templateExtension ref="prefix_FooClass.java" mergeStrategy="javamerge" /&gt;
&lt;/templates&gt;

&lt;templateScans&gt;
    &lt;templateScan templatePath="foo" templateNamePrefix="prefix_" destinationPath="src/main/java/foo"/&gt;
&lt;/templateScans&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Lets assume, that the above example declares a <code>template-scan</code> for the folder <code>foo</code>, which contains a file <code>FooClass.java.ftl</code> in any folder depth. Thus the template scan will automatically create a virtual <a href="#cobigen-core_configuration.asciidoc_template-node">template</a> declaration with <code>id=prefix_FooClass.java</code> and further <a href="#cobigen-core_configuration.asciidoc_templatescan-node">default configuration</a>.</p>
</div>
<div class="paragraph">
<p>Using the <code>templateExtension</code> declaration above will reference the scanned template by the attribute <code>ref</code> and overrides the <code>mergeStrategy</code> of the automatically configured template by the value <code>javamerge</code>. Thus we are able to minimize the needed templates configuration.</p>
</div>
<div class="paragraph">
<p><em>(Since version 4.1.0)</em> It is possible to reference external <code>templateExtension</code> (templateExtensions defined on another trigger), thanks to using <code>&lt;incrementRef &#8230;&#8203;&gt;</code> that are explained <a href="#cobigen-core_configuration.asciidoc_increment-node">here</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="cobigen-core_configuration.asciidoc_increment-node">Increment Node</h5>
<div class="paragraph">
<p>The <code>&lt;increments&gt;</code> node groups multiple <code>&lt;increment&gt;</code> nodes, which can be seen as a collection of templates to be generated. An increment will be defined by a unique <code>id</code> and a human readable <code>description</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;increments&gt;
    &lt;increment id="..." description="..."&gt;
        &lt;incrementRef ref="..." /&gt;
        &lt;templateRef ref="..." /&gt;
        &lt;templateScanRef ref="..." /&gt;
    &lt;/increment&gt;
&lt;/increments&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>An increment might contain multiple increments and/or templates, which will be referenced using <code>&lt;incrementRef &#8230;&#8203;&gt;</code>, <code>&lt;templateRef &#8230;&#8203;&gt;</code>, resp. <code>&lt;templateScanRef &#8230;&#8203;&gt;</code> nodes. These nodes only declare the attribute <code>ref</code>, which will reference an increment, a template, or a template-scan by its <code>id</code> or <code>name</code>.</p>
</div>
<div class="paragraph">
<p><em>(Since version 4.1.0)</em>  An special case of <code>&lt;incrementRef &#8230;&#8203;&gt;</code> is the external incrementsRef. By default, <code>&lt;incrementRef &#8230;&#8203;&gt;</code> are used to reference increments defined in the same <code>templates.xml</code> file. So for example, we could have:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;increments&gt;
    &lt;increment id="incA" description="..."&gt;
        &lt;incrementRef ref="incB" /&gt;
    &lt;/increment&gt;
    &lt;increment id="incB" description="..."&gt;
        &lt;templateRef .... /&gt;
        &lt;templateScan .... /&gt;
    &lt;/increment&gt;
&lt;/increments&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>However, if we want to reference an increment that it is not defined inside our <code>templates.xml</code> (an increment defined for another trigger), then we can use external incrementRef as shown below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;increment name="..." description="..."&gt;
    &lt;incrementRef ref="trigger_id::increment_id"/&gt;
&lt;/increment&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The ref string is split using as delimiter <code>::</code>. The first part of the string, is the <code>trigger_id</code> to reference. That trigger contains an <code>increment_id</code>. Currently, this functionality only works when both templates use the same kind of input file.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="cobigen-core_configuration.asciidoc_java-template-logic">42.1.3. Java Template Logic</h4>
<div class="paragraph">
<p><em>since cobigen-core-3.0.0 which is included in the Eclipse and Maven Plugin since version 2.0.0</em>
In addition, it is possible to implement more complex template logic by custom Java code. To enable this feature, you can simply import the the <code>CobiGen_Templates</code> by clicking on <em>Adapt Templates</em>, turn it into a simple maven project (if it is not already) and implement any Java logic in the common maven layout (e.g. in the source folder <code>src/main/java</code>). Each Java class will be instantiated by CobiGen for each generation process. Thus, you can even store any state within a Java class instance during generation. However, there is currently no guarantee according to the template processing order.</p>
</div>
<div class="paragraph">
<p>As a consequence, you have to implement your Java classes with a public default (non-parameter) constructor to be used by any template. Methods of the implemented Java classes can be called within templates by the simple standard FreeMarker expression for calling Bean methods: <code>SimpleType.methodName(param1)</code>. Until now, CobiGen will shadow multiple types with the same simple name indeterministically. So please prevent yourself from that situation.</p>
</div>
<div class="paragraph">
<p>Finally, if you would like to do some reflection within your Java code accessing any type of the template project or any type referenced by the input, you should load classes by making use of the classloader of the util classes. CobiGen will take care of the correct classloader building including the classpath of the input source as well as of the classpath of the template project. If you use any other classloader or build it by your own, there will be no guarantee, that generation succeeds.</p>
</div>
</div>
<div class="sect3">
<h4 id="cobigen-core_configuration.asciidoc_template-properties">42.1.4. Template Properties</h4>
<div class="paragraph">
<p><em>since cobigen-core-4.0.0</em>
Using a configuration with <a href="#cobigen-core_configuration.asciidoc_templatescan-node">template scan</a>, you can make use of properties in templates specified in property files named <code>cobigen.properties</code> next to the templates. The property files are specified as <a href="https://en.wikipedia.org/wiki/.properties">Java property files</a>. Property files can be nested in subfolders. Properties will be resolved including property shading. Properties definied nearest to the template to be generated will take precedence.
In addition, a <code>cobigen.properties</code> file can be specified in the target folder root (in eclipse plugin, this is equal to the source project root). These properties take precedence over template properties specified in the template folder.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
It is not allowed to override context variables in <code>cobigen.properties</code> specifications as we have not found any interesting use case. This is most probably an error of the template designer, CobiGen will raise an error in this case.
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="cobigen-core_configuration.asciidoc_multi-module-support-or-template-target-path-redirects">Multi module support or template target path redirects</h5>
<div class="paragraph">
<p><em>since cobigen-core-4.0.0</em>
One special property you can specify in the template properties is the property <code>relocate</code>. It will cause the current folder and its subfolders to be relocated at destination path resolution time. Take the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>folder
  - sub1
    Tempalte.java.ftl
    cobigen.properties</code></pre>
</div>
</div>
<div class="paragraph">
<p>Let the <code>cobigen.properties</code> file contain the line <code>relocate=../sub2/${cwd}</code>. Given that, the relative destination path of <code>Template.java.ftl</code> will be resolved to <code>folder/sub2/Template.java</code>. Compare <a href="#cobigen-core_configuration.asciidoc_templatescan-node">template scan</a> configuration for more information about basic path resolution. The <code>relocate</code> property specifies a relative path from the location of the <code>cobigen.properties</code>. The <code>${cwd}</code> placeholder will contain the remaining relative path from the <code>cobigen.properties</code> location to the template file. In this basic example it just contains <code>Template.java.ftl</code>, but it may even be any relative path including subfolders of sub1 and its templates.
Given the <code>relocate</code> feature, you can even step out of the root path, which in general is the project/maven module the input is located in. This enables template designers to even adress, e.g., maven modules located next to the module the input is coming from.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="cobigen-core_configuration.asciidoc_basic-template-model">42.1.5. Basic Template Model</h4>
<div class="paragraph">
<p>In addition to what is served by the different model builders of the different plug-ins, CobiGen provides a minimal model based on context variables as well as CobiGen properties. The following model is independent of the input format and will be served as a template model all the time:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>variables</p>
<div class="ulist">
<ul>
<li>
<p>all triggered <a href="#cobigen-core_configuration.asciidoc_variableassignment-node">context variables</a> mapped to its assigned/mapped value</p>
</li>
<li>
<p>all <a href="#cobigen-core_configuration.asciidoc_template-properties">template properties</a></p>
</li>
</ul>
</div>
</li>
<li>
<p>all simple names of <a href="#cobigen-core_configuration.asciidoc_java-template-logic">Java template logic</a> implementation classes</p>
</li>
<li>
<p>all full qualified names of <a href="#cobigen-core_configuration.asciidoc_java-template-logic">Java template logic</a> implementation classes</p>
</li>
<li>
<p>further input related model, e.g. <a href="cobigen-javaplugin.html#template-object-model">model from Java inputs</a></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="cobigen-core_configuration.asciidoc_plugin-mechanism">42.1.6. Plugin Mechanism</h4>
<div class="paragraph">
<p>Since cobigen-core 4.1.0, we changed the plug-in discovery mechanism. So far it was necessary to register new plugins programmatically, which introduces the need to let every tool integration, i.e. for eclipse or maven, be dependent on every plug-in, which should be released. This made release cycles take long time as all plug-ins have to be integrated into a final release of maven or eclipse integration.</p>
</div>
<div class="paragraph">
<p>Now, plug-ins are automatically disovered by the Java <a href="https://docs.oracle.com/javase/tutorial/ext/basics/spi.html">Service Loader</a> mechanism from the classpath. This also effects the setup of <a href="cobigen-eclipse_installation.html#upgrading-to-v3">eclipse</a> and <a href="cobigen-maven_configuration.html#additions-since-v3">maven</a> integrations to allow modular releases of CobiGen in future. We are now able to provide faster rollouts of bugfixes in any of the plug-ins as they can be released completely independently.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="master-cobigen.asciidoc_plug-ins">42.2. Plug-ins</h3>
<!-- toc disabled -->
<div class="sect3">
<h4 id="cobigen-javaplugin.asciidoc">42.2.1. Java Plug-in</h4>
<div class="paragraph">
<p>The CobiGen Java Plug-in comes with a new input reader for java artifacts, new java related trigger and matchers, as well as a merging mechanism for Java sources.</p>
</div>
<div class="sect4">
<h5 id="cobigen-javaplugin.asciidoc_trigger-extension">Trigger extension</h5>
<div class="paragraph">
<p>The Java Plug-in provides a new trigger for Java related inputs. It accepts different representations as inputs (see <a href="#cobigen-javaplugin.asciidoc_java-input-reader">Java input reader</a>) and provides additional matching and variable assignment mechanisms. The configuration in the <code>context.xml</code> for this trigger looks like this:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>type 'java'</p>
<div class="listingblock">
<div class="title">Listing 97. Example of a java trigger definition</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;trigger id="..." type="java" templateFolder="..."&gt;
    ...
&lt;/trigger&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>This trigger type enables Java elements as inputs.</p>
</div>
</li>
</ul>
</div>
<div class="sect5">
<h6 id="cobigen-javaplugin.asciidoc_matcher-types">Matcher types</h6>
<div class="paragraph">
<p>With the trigger you might define matchers, which restrict the input upon specific aspects:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>type 'fqn' &#8594; full qualified name matching</p>
<div class="listingblock">
<div class="title">Listing 98. Example of a java trigger definition with a full qualified name matcher</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;trigger id="..." type="java" templateFolder="..."&gt;
    &lt;matcher type="fqn" value="(.+)\.persistence\.([^\.]+)\.entity\.([^\.]+)"&gt;
        ...
    &lt;/matcher&gt;
&lt;/trigger&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>This trigger will be enabled if the full qualified name (<code>fqn</code>) of the declaring input class matches the given regular expression (<code>value</code>).</p>
</div>
</li>
<li>
<p>type 'package' &#8594; package name of the input</p>
<div class="listingblock">
<div class="title">Listing 99. Example of a java trigger definition with a package name matcher</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;trigger id="..." type="java" templateFolder="..."&gt;
    &lt;matcher type="package" value="(.+)\.persistence\.([^\.]+)\.entity"&gt;
        ...
    &lt;/matcher&gt;
&lt;/trigger&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>This trigger will be enabled if the package name (<code>package</code>) of the declaring input class matches the given regular expression (<code>value</code>).</p>
</div>
</li>
<li>
<p>type 'expression'</p>
<div class="listingblock">
<div class="title">Listing 100. Example of a java trigger definition with a package name matcher</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;trigger id="..." type="java" templateFolder="..."&gt;
    &lt;matcher type="expression" value="instanceof java.lang.String"&gt;
        ...
    &lt;/matcher&gt;
&lt;/trigger&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>This trigger will be enabled if the expression evaluates to true. Valid expressions are</p>
</div>
</li>
<li>
<p><code>instanceof fqn</code>: checks an 'is a' relation of the input type</p>
</li>
<li>
<p><code>isAbstract</code>: checks, whether the input type is declared abstract</p>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="cobigen-javaplugin.asciidoc_containermatcher-types">ContainerMatcher types</h6>
<div class="paragraph">
<p>Additionally, the java plugin provides the ability to match packages (containers) as follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>type 'package'</p>
<div class="listingblock">
<div class="title">Listing 101. Example of a java trigger definition with a container matcher for packages</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;trigger id="..." type="java" templateFolder="..."&gt;
    &lt;containerMatcher type="package" value="com\.example\.app\.component1\.persistence.entity" /&gt;
&lt;/trigger&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The container matcher matches packages provided by the type <code>com.capgemini.cobigen.javaplugin.inputreader.to.PackageFolder</code> with a regular expression stated in the <code>value</code> attribute. (See <a href="cobigen-core_configuration.html#containermatcher-node">containerMatcher semantics</a> to get more information about containerMatchers itself.)</p>
</div>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="cobigen-javaplugin.asciidoc_variableassignment-types">VariableAssignment types</h6>
<div class="paragraph">
<p>Furthermore, it provides the ability to extract information from each input for further processing in the templates. The values assigned by variable assignments will be made available in template and the <code>destinationPath</code> of context.xml through the namespace <code>variables.&lt;key&gt;</code>. The Java Plug-in currently provides two different mechanisms:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>type 'regex' &#8594; regular expression group</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;trigger id="..." type="java" templateFolder="..."&gt;
    &lt;matcher type="fqn" value="(.+)\.persistence\.([^\.]+)\.entity\.([^\.]+)"&gt;
        &lt;variableAssignment type="regex" key="rootPackage" value="1" /&gt;
        &lt;variableAssignment type="regex" key="component" value="2" /&gt;
        &lt;variableAssignment type="regex" key="pojoName" value="3" /&gt;
    &lt;/matcher&gt;
&lt;/trigger&gt;</code></pre>
</div>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>This variable assignment assigns the value of the given regular expression group number to the given <code>key</code>.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>type 'constant' &#8594; constant parameter</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;trigger id="..." type="java" templateFolder="..."&gt;
    &lt;matcher type="fqn" value="(.+)\.persistence\.([^\.]+)\.entity\.([^\.]+)"&gt;
        &lt;variableAssignment type="constant" key="domain" value="restaurant" /&gt;
    &lt;/matcher&gt;
&lt;/trigger&gt;</code></pre>
</div>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>This variable assignment assigns the <code>value</code> to the <code>key</code> as a constant.</p>
</div>
</div>
<div class="sect5">
<h6 id="cobigen-javaplugin.asciidoc_java-input-reader">Java input reader</h6>
<div class="paragraph">
<p>The Cobigen Java Plug-in implements an input reader for parsed java sources as well as for java <code>Class&lt;?&gt;</code> objects (loaded by reflection). So API user can pass <code>Class&lt;?&gt;</code> objects as well as <code>JavaClass</code> objects for generation. The latter depends on <a href="http://qdox.codehaus.org/">QDox</a>, which will be used for parsing and merging java sources. For getting the right parsed java inputs you can easily use the <code>JavaParserUtil</code>, which provides static functionality to parse java files and get the appropriate <code>JavaClass</code> object.</p>
</div>
<div class="paragraph">
<p>Furthermore, due to restrictions on both inputs according to model building (see below), it is also possible to provide an array of length two as an input, which contains the <code>Class&lt;?&gt;</code> as well as the <code>JavaClass</code> object of the same class.</p>
</div>
<div class="sect6">
<h7 id="cobigen-javaplugin.asciidoc_template-object-model">Template object model</h7>
<div class="paragraph">
<p>No matter whether you use reflection objects or parsed java classes as input, you will get the following object model for template creation:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>classObject</strong> ('Class' :: Class object of the Java input)</p>
</li>
<li>
<p><strong>pojo</strong></p>
<div class="ulist">
<ul>
<li>
<p><strong>name</strong> ('String' :: Simple name of the input class)</p>
</li>
<li>
<p><strong>package</strong> ('String' :: Package name of the input class)</p>
</li>
<li>
<p><strong>canonicalName</strong> ('String' :: Full qualified name of the input class)</p>
</li>
<li>
<p><strong>annotations</strong> ('Map&lt;String, Object&gt;' :: Annotations, which will be represented by a mapping of the full qualified type of an annotation to its value. To gain template compatibility, the key will be stored with '_' instead of '.' in the full qualified annotation type. Furthermore, the annotation might be recursively defined and thus be accessed using the same type of mapping. Example <code>${pojo.annotations.javax_persistence_Id}</code>)</p>
</li>
<li>
<p><strong>javaDoc</strong> ('Map&lt;String, Object&gt;') :: A generic way of addressing all available javaDoc doclets and comments. The only fixed variable is <code>comment</code> (see below). All other provided variables depend on the doclets found while parsing. The value of a doclet can be accessed by the doclets name (e.g. <code>${&#8230;&#8203;javaDoc.author}</code>). In case of doclet tags that can be declared multiple times (currenly <code>@param</code> and <code>@throws</code>), you will get a map, which you access in a specific way (see below).</p>
<div class="ulist">
<ul>
<li>
<p><strong>comment</strong> ('String' :: javaDoc comment, which does not include any doclets)</p>
</li>
<li>
<p><strong>params</strong> ('Map&lt;String,String&gt; :: javaDoc parameter info. If the comment follows proper conventions, the key will be the name of the parameter and the value being its description. You can also access the parameters by their number, as in <code>arg0</code>, <code>arg1</code> etc, following the order of declaration in the signature, not in order of javadoc)</p>
</li>
<li>
<p><strong>throws</strong> ('Map&lt;String,String&gt; :: javaDoc exception info. If the comment follows proper conventions, the key will be the name of the thrown exception and the value being its description)</p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>extendedType</strong> ('Map&lt;String, Object&gt;' :: The supertype, represented by a set of mappings <em>(since cobigen-javaplugin v1.1.0)</em></p>
<div class="ulist">
<ul>
<li>
<p><strong>name</strong> ('String' :: Simple name of the supertype)</p>
</li>
<li>
<p><strong>canonicalName</strong> ('String' :: Full qualified name of the supertype)</p>
</li>
<li>
<p><strong>package</strong> ('String' :: Package name of the supertype)</p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>implementedTypes</strong> ('List&lt;Map&lt;String, Object&gt;&gt;' :: A list of all implementedTypes (interfaces) represented by a set of mappings <em>(since cobigen-javaplugin v1.1.0)</em></p>
<div class="ulist">
<ul>
<li>
<p><strong>interface</strong> ('Map&lt;String, Object&gt;' :: List element)</p>
<div class="ulist">
<ul>
<li>
<p><strong>name</strong> ('String' :: Simple name of the interface)</p>
</li>
<li>
<p><strong>canonicalName</strong> ('String' :: Full qualified name of the interface)</p>
</li>
<li>
<p><strong>package</strong> ('String' :: Package name of the interface)</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
<li>
<p><strong>fields</strong> ('List&lt;Map&lt;String, Object&gt;&gt;' :: List of fields of the input class) <em>(renamed since cobigen-javaplugin v1.2.0; previously <strong>attributes</strong>)</em></p>
<div class="ulist">
<ul>
<li>
<p>field ('Map&lt;String, Object&gt;' :: List element)</p>
<div class="ulist">
<ul>
<li>
<p><strong>name</strong> ('String' :: Name of the Java field)</p>
</li>
<li>
<p><strong>type</strong> ('String' :: Type of the Java field)</p>
</li>
<li>
<p><strong>canonicalType</strong> ('String' :: Full qualified type declaration of the Java field&#8217;s type)</p>
</li>
<li>
<p>'<strong>isId</strong>' ('Deprecated' :: 'boolean' :: true if the Java field or its setter or its getter is annotated with the javax.persistence.Id annotation, false otherwise. Equivalent to <code>${pojo.attributes[i].annotations.javax_persistence_Id?has_content}</code>)</p>
</li>
<li>
<p><strong>javaDoc</strong> (see pojo.javaDoc)</p>
</li>
<li>
<p><strong>annotations</strong> (see pojo.annotations with the remark, that for fields all annotations of its setter and getter will also be collected)</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
<li>
<p><strong>methodAccessibleFields</strong> ('List&lt;Map&lt;String, Object&gt;&gt;' :: List of fields of the input class or its inherited classes, which are accessible using setter and getter methods)</p>
<div class="ulist">
<ul>
<li>
<p>same as for <em>field</em> (but without javaDoc!)</p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>methods</strong> ('List&lt;Map&lt;String, Object&gt;&gt;' :: The list of all methods, whereas one method will be represented by a set of property mappings)</p>
<div class="ulist">
<ul>
<li>
<p>method ('Map&lt;String, Object&gt;' :: List element)</p>
<div class="ulist">
<ul>
<li>
<p><strong>name</strong> ('String' :: Name of the method)</p>
</li>
<li>
<p><strong>javaDoc</strong> (see pojo.javaDoc)</p>
</li>
<li>
<p><strong>annotations</strong> (see pojo.annotations)</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>Furthermore, when providing a <code>Class&lt;?&gt;</code> object as input, the Java Plug-in will provide additional functionalities as template methods <em>(deprecated)</em>:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><code>isAbstract(String fqn)</code> (Checks whether the type with the given full qualified name is an abstract class. Returns a boolean value.) <em>(since cobigen-javaplugin v1.1.1)</em>  <em>(deprecated)</em></p>
</li>
<li>
<p><code>isSubtypeOf(String subType, String superType)</code> (Checks whether the <code>subType</code> declared by its full qualified name is a sub type of the <code>superType</code> declared by its full qualified name. Equals the Java expression <code>subType instanceof superType</code> and so also returns a boolean value.) <em>(since cobigen-javaplugin v1.1.1)</em>  <em>(deprecated)</em></p>
</li>
</ol>
</div>
</div>
<div class="sect6">
<h7 id="cobigen-javaplugin.asciidoc_model-restrictions">Model Restrictions</h7>
<div class="paragraph">
<p>As stated before both inputs (<code>Class&lt;?&gt;</code> objects and <code>JavaClass</code> objects ) have their restrictions according to model building. In the following these restrictions are listed for both models, the ParsedJava Model which results from an <code>JavaClass</code> input and the RefelctedJava Model, which results from a Class&lt;?&gt;` input.</p>
</div>
<div class="paragraph">
<p>It is important to understand, that these restrictions are only present if you work with either Parsed Model <strong>OR</strong> the Reflected Model. If you use the <em>Maven Build Plug-in</em> or <em>Eclipse Plug-in</em> these two models are merged together so that they can mutually compensate their weaknesses.</p>
</div>
<div class="sect7">
<h8 id="cobigen-javaplugin.asciidoc_parsed-model">Parsed Model</h8>
<div class="ulist">
<ul>
<li>
<p>annotations of the input&#8217;s supertype are not accessible due to restrictions in the <a href="http://qdox.codehaus.org/">QDox</a> library. So <code>pojo.methodAccessibleFields[i].annotations</code> will always be empty for super type fields.</p>
</li>
<li>
<p>annotations' parameter values are available as Strings only (e.g. the Boolean value <code>true</code> is transformed into <code>"true"</code>). This also holds for the Reflected Model.</p>
</li>
<li>
<p>fields of "supersupertypes" of the input JavaClass are not available at all. So <code>pojo.methodAccessibleFields</code> will only contain the input type&#8217;s and the direct superclass&#8217;s fields.</p>
</li>
<li>
<p>[resolved, since cobigen-javaplugin 1.3.1] field types of supertypes are always canonical. So <code>pojo.methodAccessibleFields[i].type</code> will always provide the same value as <code>pojo.methodAccessibleFields[i].canonicalType</code> (e.g. <code>java.lang.String</code> instead of the expected <code>String</code>) for super type fields.</p>
</li>
</ul>
</div>
</div>
<div class="sect7">
<h8 id="cobigen-javaplugin.asciidoc_reflected-model">Reflected Model</h8>
<div class="ulist">
<ul>
<li>
<p>annotations' parameter values are available as Strings only (e.g. the Boolean value <code>true</code> is transformed into <code>"true"</code>). This also holds for the Parsed Model.</p>
</li>
<li>
<p>annotations are only available if the respective annotation has <code>@Retention(value=RUNTIME)</code>, otherwise the annotations are to be discarded by the compiler or by the VM at run time. For more information see <a href="http://docs.oracle.com/javase/7/docs/api/java/lang/annotation/RetentionPolicy.html">RetentionPolicy</a>.</p>
</li>
<li>
<p>information about generic types is lost. E.g. a field&#8217;s/ methodAccessibleField&#8217;s type for <code>List&lt;String&gt;</code> can only be provided as <code>List&lt;?&gt;</code>.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="cobigen-javaplugin.asciidoc_merger-extensions">Merger extensions</h5>
<div class="paragraph">
<p>The Java Plug-in provides two additional merging strategies for Java sources, which can be configured in the <code>templates.xml</code>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Merge strategy <code>javamerge</code> (merges two Java resources and keeps the existing Java elements on conflicts)</p>
</li>
<li>
<p>Merge strategy <code>javamerge_override</code> (merges two Java resources and overrides the existing Java elements on conflicts)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In general merging of two Java sources will be processed as follows:</p>
</div>
<div class="paragraph">
<p>Precondition of processing a merge of generated contents and existing ones is a common Java root class resp. surrounding class. If this is the case this class and all further inner classes will be merged recursively. Therefore, the following Java elements will be merged and conflicts will be resolved according to the configured merge strategy:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>extends</code> and <code>implements</code> relations of a class: Conflicts can only occur for the extends relation.</p>
</li>
<li>
<p>Annotations of a class: Conflicted if an annotation declaration already exists.</p>
</li>
<li>
<p>Fields of a class: Conflicted if there is already a field with the same name in the existing sources. (Will be replaced / ignored in total, also including annotations)</p>
</li>
<li>
<p>Methods of a class: Conflicted if there is already a method with the same signature in the existing sources. (Will be replaced / ignored in total, also including annotations)</p>
</li>
</ul>
</div>
<!-- toc disabled -->
</div>
</div>
<div class="sect3">
<h4 id="cobigen-propertyplugin.asciidoc">42.2.2. Property Plug-in</h4>
<div class="paragraph">
<p>The CobiGen Property Plug-in currently only provides different merge mechanisms for documents written in <a href="http://docs.oracle.com/javase/7/docs/api/java/util/Properties.html">Java property syntax</a>.</p>
</div>
<div class="sect4">
<h5 id="cobigen-propertyplugin.asciidoc_merger-extensions">Merger extensions</h5>
<div class="paragraph">
<p>There are two merge strategies for Java properties, which can be configured in the templates.xml:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Merge strategy <code>propertymerge</code> (merges two properties documents and keeps the existing properties on conflicts)</p>
</li>
<li>
<p>Merge strategy <code>propertymerge_override</code> (merges two properties documents and overrides the existing properties on conflicts)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Both documents (base and patch) will be parsed using the <a href="http://docs.oracle.com/javase/7/docs/api/java/util/Properties.html">Java 7 API</a> and will be compared according their keys. Conflicts will occur if a key in the patch already exists in the base document.</p>
</div>
<!-- toc disabled -->
</div>
</div>
<div class="sect3">
<h4 id="cobigen-xmlplugin.asciidoc">42.2.3. XML Plug-in</h4>
<div class="paragraph">
<p>The CobiGen XML Plug-in comes with an input reader for xml artifacts, xml related trigger and matchers and provides different merge mechanisms for XML result documents.</p>
</div>
<div class="sect4">
<h5 id="cobigen-xmlplugin.asciidoc_trigger-extension">Trigger extension</h5>
<div class="paragraph">
<p><em>(since cobigen-xmlplugin v2.0.0)</em></p>
</div>
<div class="paragraph">
<p>The XML Plug-in provides a trigger for xml related inputs. It accepts xml documents as input (see <a href="#cobigen-xmlplugin.asciidoc_xml-input-reader">XML input reader</a>) and provides additional matching and variable assignment mechanisms. The configuration in the <code>context.xml</code> for this trigger looks like this:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>type 'xml'</p>
<div class="listingblock">
<div class="title">Listing 102. Example of a xml trigger definition.</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;trigger id="..." type="xml" templateFolder="..."&gt;
    ...
&lt;/trigger&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>This trigger type enables xml documents as inputs.</p>
</div>
</li>
<li>
<p>type 'xpath'</p>
<div class="listingblock">
<div class="title">Listing 103. Example of a xpath trigger definition.</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;trigger id="..." type="xpath" templateFolder="..."&gt;
    ...
&lt;/trigger&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>This trigger type enables xml documents as container inputs, which consists of several subdocuments.</p>
</div>
</li>
</ul>
</div>
<div class="sect5">
<h6 id="cobigen-xmlplugin.asciidoc_containermatcher-type">ContainerMatcher type</h6>
<div class="paragraph">
<p>A ContainerMatcher check if the input is a valid container.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>xpath: type: 'xpath'</p>
<div class="listingblock">
<div class="title">Listing 104. Example of a xml trigger definition with a nodename matcher.</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;trigger id="..." type="xml" templateFolder="..."&gt;
    &lt;containerMatcher type="xpath" value="./uml:Model//packagedElement[@xmi:type='uml:Class']"&gt;
        ...
    &lt;/matcher&gt;
&lt;/trigger&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Before applying any Matcher, this containerMatcher checks if the XML file contais a node "uml:Model" with a childnode "packagedElement" which contains an attribute "xmi:type" with the value "uml:Class".</p>
</div>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="cobigen-xmlplugin.asciidoc_matcher-types">Matcher types</h6>
<div class="paragraph">
<p>With the trigger you might define matchers, which restrict the input upon specific aspects:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>xml: type 'nodename' &#8594; document&#8217;s root name matching</p>
<div class="listingblock">
<div class="title">Listing 105. Example of a xml trigger definition with a nodename matcher</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;trigger id="..." type="xml" templateFolder="..."&gt;
    &lt;matcher type="nodename" value="\D\w*"&gt;
        ...
    &lt;/matcher&gt;
&lt;/trigger&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>This trigger will be enabled if the root name of the declaring input document matches the given regular expression (<code>value</code>).</p>
</div>
</li>
<li>
<p>xpath: type: 'xpath' &#8594; matching a node with a xpath value</p>
<div class="listingblock">
<div class="title">Listing 106. Example of a xpath trigger definition with a xpath matcher.</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;trigger id="..." type="xml" templateFolder="..."&gt;
    &lt;matcher type="xpath" value="/packagedElement[@xmi:type='uml:Class']"&gt;
        ...
    &lt;/matcher&gt;
&lt;/trigger&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>This trigger will be enabled if the XML file contains a node "/packagedElement" where the "xmi:type" property equals "uml:Class".</p>
</div>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="cobigen-xmlplugin.asciidoc_variableassignment-types">VariableAssignment types</h6>
<div class="paragraph">
<p>Furthermore, it provides the ability to extract information from each input for further processing in the templates. The values assigned by variable assignments will be made available in template and the <code>destinationPath</code> of context.xml through the namespace <code>variables.&lt;key&gt;</code>. The XML Plug-in currently provides only one mechanism:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>type 'constant' &#8594; constant parameter</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;trigger id="..." type="xml" templateFolder="..."&gt;
    &lt;matcher type="nodename" value="\D\w*"&gt;
        &lt;variableAssignment type="constant" key="domain" value="restaurant" /&gt;
    &lt;/matcher&gt;
&lt;/trigger&gt;</code></pre>
</div>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>This variable assignment assigns the <code>value</code> to the <code>key</code> as a constant.</p>
</div>
</div>
<div class="sect5">
<h6 id="cobigen-xmlplugin.asciidoc_xml-input-reader">XML input reader</h6>
<div class="paragraph">
<p>The Cobigen XML Plug-in implements an input reader for parsed xml documents. So API user can pass <code>org.w3c.dom.Document</code> objects for generation. For getting the right parsed xml inputs you can easily use the <code>xmlplugin.util.XmlUtil</code>, which provides static functionality to parse xml files or input streams and get the appropriate <code>Document</code> object.</p>
</div>
<div class="sect6">
<h7 id="cobigen-xmlplugin.asciidoc_template-object">Template object</h7>
<div class="paragraph">
<p>Due to the heterogeneous structure an xml document can have, the xml input reader does not always create exactly the same model structure (in contrast to the java input reader). For example the model&#8217;s depth differs strongly, according to it&#8217;s input document. To allow navigational access to the nodes, the model also depends on the document&#8217;s element&#8217;s node names. All child elements with unique names, are directly accessable via their names. In addition it is possible to iterate over all child elements with held of the child list <code>Children</code>. So it is also possible to access child elements with non unique names.</p>
</div>
<div class="paragraph">
<p>The XML input reader will create the following object model for template creation (<code><sub>EXAMPLEROOT</sub>, <sub>EXAMPLENODE1</sub>, <sub>EXAMPLENODE2</sub>, <sub>EXAMPLEATTR1</sub>,&#8230;&#8203;</code> are just used here as examples. Of course they will be replaced later by the actual node or attribute names):</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>~EXAMPLEROOT~</strong> ('Map&lt;String, Object&gt;' :: common element structure)</p>
<div class="ulist">
<ul>
<li>
<p><strong>_nodeName_</strong> ('String' :: Simple name of the root node)</p>
</li>
<li>
<p><strong>_text_</strong> ('String' :: Concatenated text content (PCDATA) of the root node)</p>
</li>
<li>
<p><strong>TextNodes</strong> ('List&lt;String&gt;' :: List of all the root&#8217;s text node contents)</p>
</li>
<li>
<p><strong>_at_~EXAMPLEATTR1~</strong> ('String' :: String representation of the attribute&#8217;s value)</p>
</li>
<li>
<p><strong>_at_~EXAMPLEATTR2~</strong> ('String' :: String representation of the attribute&#8217;s value)</p>
</li>
<li>
<p><strong>_at_&#8230;&#8203;</strong></p>
</li>
<li>
<p><strong>Attributes</strong> ('List&lt;Map&lt;String, Object&gt;&gt;' :: List of the root&#8217;s attributes</p>
<div class="ulist">
<ul>
<li>
<p>at ('Map&lt;String, Object&gt;' :: List element)</p>
<div class="ulist">
<ul>
<li>
<p><strong>_attName_</strong> ('String' :: Name of the attribute)</p>
</li>
<li>
<p><strong>_attValue_</strong> ('String' :: String representation of the attribute&#8217;s value)</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
<li>
<p><strong>Children</strong> ('List&lt;Map&lt;String, Object&gt;&gt;' :: List of the root&#8217;s child elements</p>
<div class="ulist">
<ul>
<li>
<p>child ('Map&lt;String, Object&gt;' :: List element)</p>
<div class="ulist">
<ul>
<li>
<p>&#8230;&#8203;common element sub structure&#8230;&#8203;</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
<li>
<p><strong>~EXAMPLENODE1~</strong> ('Map&lt;String, Object&gt;' :: One of the root&#8217;s child nodes)</p>
<div class="ulist">
<ul>
<li>
<p>&#8230;&#8203;common element structure&#8230;&#8203;</p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>~EXAMPLENODE2~</strong> ('Map&lt;String, Object&gt;' :: One of the root&#8217;s child nodes)</p>
<div class="ulist">
<ul>
<li>
<p>&#8230;&#8203;common element sub structure&#8230;&#8203;</p>
</li>
<li>
<p><strong>~EXAMPLENODE21~</strong> ('Map&lt;String, Object&gt;' :: One of the nodes&#8217;s child nodes)</p>
<div class="ulist">
<ul>
<li>
<p>&#8230;&#8203;common element structure&#8230;&#8203;</p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>~EXAMPLENODE&#8230;&#8203;~</strong></p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>~EXAMPLENODE&#8230;&#8203;~</strong></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>In contrast to the java input reader, this xml input reader does currently not provide any additional template methods.</p>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="cobigen-xmlplugin.asciidoc_merger-extensions">Merger extensions</h5>
<div class="paragraph">
<p>The XML plugin uses the <a href="https://github.com/maybeec/lexeme">LeXeMe</a> merger library to produce semantically correct merge prodcuts. The following four merge strategies are implemented and can be configured in the <code>templates.xml</code>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>xmlmerge</code>: In case of a conflict the base value is preferred</p>
</li>
<li>
<p><code>xmlmerge_override</code>: In case of a conflict the patch value is preferred</p>
</li>
<li>
<p><code>xmlmerge_attachTexts</code>: In case of a conflict the base value is preferred. Attributes and text nodes will be merged where possible</p>
</li>
<li>
<p><code>xmlmerge_override_attachTexts</code>: In case of a conflict the patch value is preferred. Attributes and text nodes will be merged where possible</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Currently only the document types included in LeXeMe are supported.
On how the merger works consult the <a href="https://github.com/maybeec/lexeme/wiki">LeXeMe Wiki</a>.</p>
</div>
<!-- toc disabled -->
</div>
</div>
<div class="sect3">
<h4 id="cobigen-textmerger.asciidoc">42.2.4. Text Merger Plug-in</h4>
<div class="paragraph">
<p>The Text Merger Plug-in enables merging result free text documents to existing free text documents. Therefore, the algorithms are also very rudimentary.</p>
</div>
<div class="sect4">
<h5 id="cobigen-textmerger.asciidoc_merger-extensions">Merger extensions</h5>
<div class="paragraph">
<p>There are currently three main merge strategies that apply for the whole document:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>merge strategy <code>textmerge_append</code> (appends the text directly to the end of the existing document)
_Remark_: If no anchors are defined, this will simply append the patch.</p>
</li>
<li>
<p>merge strategy <code>textmerge_appendWithNewLine</code> (appends the text after adding a new line break to the existing document)
_Remark_: empty patches will not result in appending a new line any more since v1.0.1
<em>Remark</em>: Only suitable if no anchors are defined, otherwise it will simply act as <code>textmerge_append</code></p>
</li>
<li>
<p>merge strategy <code>textmerge_override</code> (replaces the contents of the existing file with the patch)
_Remark_: If anchors are defined, override is set as the default mergestrategy for every text block if not redefined in an anchor specification.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="cobigen-textmerger.asciidoc_anchor-functionality">Anchor functionality</h5>
<div class="paragraph">
<p>If a template contains text that fits the definition of <code>anchor:${documentpart}:${mergestrategy}:anchorend</code> or more specifically the regular expression <code>(.*)anchor:([<sup>:]+):(newline_)?([</sup>:]+)(_newline)?:anchorend\\s*(\\r\\n|\\r|\\n)</code>, some additional functionality becomes available about specific parts of the incoming text and the way it will be merged with the existing text. These anchors always change things about the text to come up until the next anchor, text before it is ignored.</p>
</div>
<div class="paragraph">
<p>If no anchors are defined, the complete patch will be appended depending on your choice for the template in the file <code>templates.xml</code>.</p>
</div>
<div class="sect5">
<h6 id="cobigen-textmerger.asciidoc_anchor-definition">Anchor Definition</h6>
<div class="paragraph">
<p>Anchors should always be defined as a comment of the language the template results in, as you do not want them to appear in your readable version, but cannot define them as freemarker comments in the template, or the merger will not know about them.
Anchors will also be read when they are not comments due to the merger being able to merge multiple types of text-based languages, thus making it practically impossible to filter for the correct comment declaration. <strong>That is why anchors have to always be followed by line breaks</strong>. That way there is a universal way to filter anchors that should have anchor functionality and ones that should appear in the text.
<em>Remark:</em> If the resulting language has closing tags for comments, they have to appear in the next line.
<em>Remark:</em> If you do not put the anchor into a new line, all the text that appears before it will be added to the anchor.</p>
</div>
</div>
<div class="sect5">
<h6 id="cobigen-textmerger.asciidoc_documentparts">Documentparts</h6>
<div class="paragraph">
<p>In general, ${documentpart} is an id to mark a part of the document, that way the merger knows what parts of the text to merge with which parts of the patch (e.g. if the existing text contains <code>anchor:table:${}:anchorend</code> that part will be merged with the part tagged <code>anchor:table:${}:anchorend</code> of the patch).</p>
</div>
<div class="paragraph">
<p>If the same documentpart is defined multiple times, it can lead to errors, so instead of defining <code>table</code> multiple times, use <code>table1</code>, <code>table2</code>, <code>table3</code> etc.</p>
</div>
<div class="paragraph">
<p>If a <code>${documentpart}</code> is defined in the document but not in the patch and they are in the same position, it is porcessed int the following way: If only the documentparts <code>header</code>, <code>test</code> and <code>footer</code> are defined in the document in that order, and the patch contains <code>header</code>, <code>order</code> and <code>footer</code>, the resulting order will be <code>header</code>, <code>test</code>, <code>order</code> then <code>footer</code>.</p>
</div>
<div class="paragraph">
<p>The following documentparts have default functionality</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><code>anchor:header:${mergestrategy}:anchorend</code> marks the beginning of a header, that will be added once when the document is created, but not again.
<em>Remark:</em> This is only done once, if you have <code>header</code> in another anchor, it will be ignored</p>
</li>
<li>
<p><code>anchor:footer:${mergestrategy}:anchorend</code> marks the beginning of a footer, that will be added once when the document is created, but not again. Once this is invoked, all following text will be included in the footer, including other anchors.</p>
</li>
</ol>
</div>
</div>
<div class="sect5">
<h6 id="cobigen-textmerger.asciidoc_mergestrategies">Mergestrategies</h6>
<div class="paragraph">
<p>Mergestrategies are only relevant in the patch, as the merger is only interested in how text in the patch should be managed, not how it was managed in the past.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><code>anchor:${documentpart}::anchorend</code> will use the merge strategy from templates.xml, see <a href="#extensions">Merger-Extensions</a>.</p>
</li>
<li>
<p><code>anchor:${}:${mergestrategy}_newline:anchorend</code> or <code>anchor:${}:newline_${mergestrategy}:anchorend</code> states that a new line should be appended before or after this anchors text, depending on where the newline is (before or after the mergestrategy). <code>anchor:${documentpart}:newline:anchorend</code> puts a new line after the anchors text.
<em>Remark:</em> Only works with appending strategies, not merging/replacing ones. These strategies currently include: <code>appendbefore</code>, <code>append</code>/<code>appendafter</code></p>
</li>
<li>
<p><code>achor:${documentpart}:override:anchorend</code> means that the new text of this documentpart will replace the existing one completely</p>
</li>
<li>
<p><code>anchor:${documentpart}:appendbefore:anchorend</code> or <code>anchor:${documentpart}:appendafter:anchorend</code>/<code>anchor:${documentpart}:append:anchorend</code> specifies whether the text of the patch should come before the existing text or after.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect4">
<h5 id="cobigen-textmerger.asciidoc_usage-examples">Usage Examples</h5>
<div class="sect5">
<h6 id="cobigen-textmerger.asciidoc_general">General</h6>
<div class="paragraph">
<p>Below you can see how a file with anchors might look like (using Asciidoc comment tags), with examples of what you might want to use the different functions for.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>// anchor:header:append:anchorend

Table of contents
Introduction/Header

// anchor:part1:appendafter:anchorend

Lists
Table entries

// anchor:part2:nomerge:anchorend

Document Separators
Asciidoc table definitions

// anchor:part3:override:anchorend

Anything that you only want once but changes from time to time

// anchor:footer:append:anchorend

Copyright Info
Imprint</pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="cobigen-textmerger.asciidoc_merging">Merging</h6>
<div class="paragraph">
<p>In this section you will see a comparision on what files look like before and after merging</p>
</div>
<div class="sect6">
<h7 id="cobigen-textmerger.asciidoc_override">override</h7>
<div class="listingblock">
<div class="title">Listing 107. Before</div>
<div class="content">
<pre>// anchor:part:override:anchorend
Lorem Ipsum</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Listing 108. Patch</div>
<div class="content">
<pre>// anchor:part:override:anchorend
Dolor Sit</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Listing 109. After</div>
<div class="content">
<pre>// anchor:part:override:anchorend
Dolor Sit</pre>
</div>
</div>
</div>
<div class="sect6">
<h7 id="cobigen-textmerger.asciidoc_appending">Appending</h7>
<div class="listingblock">
<div class="title">Listing 110. Before</div>
<div class="content">
<pre>// anchor:part:append:anchorend
Lorem Ipsum
// anchor:part2:appendafter:anchorend
Lorem Ipsum
// anchor:part3:appendbefore:anchorend
Lorem Ipsum</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Listing 111. Patch</div>
<div class="content">
<pre>// anchor:part:append:anchorend
Dolor Sit
// anchor:part2:appendafter:anchorend
Dolor Sit
// anchor:part3:appendbefore:anchorend
Dolor Sit</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Listing 112. After</div>
<div class="content">
<pre>// anchor:part:append:anchorend
Lorem Ipsum
Dolor Sit
// anchor:part2:appendafter:anchorend
Lorem Ipsum
Dolor Sit
// anchor:part3:appendbefore:anchorend
Dolor Sit
Lorem Ipsum</pre>
</div>
</div>
</div>
<div class="sect6">
<h7 id="cobigen-textmerger.asciidoc_newline">Newline</h7>
<div class="listingblock">
<div class="title">Listing 113. Before</div>
<div class="content">
<pre>// anchor:part:newline_append:anchorend
Lorem Ipsum
// anchor:part:append_newline:anchorend
Lorem Ipsum
(end of file)</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Listing 114. Patch</div>
<div class="content">
<pre>// anchor:part:newline_append:anchorend
Dolor Sit
// anchor:part:append_newline:anchorend
Dolor Sit
(end of file)</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Listing 115. After</div>
<div class="content">
<pre>// anchor:part:newline_append:anchorend
Lorem Ipsum

Dolor Sit
// anchor:part:append_newline:anchorend
Lorem Ipsum
Dolor Sit

(end of file)</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="cobigen-textmerger.asciidoc_error-list">Error List</h5>
<div class="ulist">
<ul>
<li>
<p>If there are anchors in the text, but either base or patch do not start with one, the merging process wil be aborted, as text might go missing this way.</p>
</li>
<li>
<p>Using <code>_newline</code> or <code>newline_</code> with mergestrategies that don&#8217;t support it , like <code>override</code>, will abort the merging process. See <a href="#mergestrategies">Merge Strategies</a> &#8594;2 for details.</p>
</li>
<li>
<p>Using undefined mergestrategies will abort the merging process.</p>
</li>
<li>
<p>Wrong anchor definitions, for example <code>anchor:${}:anchorend</code> will abort the merging process, see <a href="#anchordef">Anchor Definition</a> for details.</p>
</li>
</ul>
</div>
<!-- toc disabled -->
</div>
</div>
<div class="sect3">
<h4 id="cobigen-jsonplugin.asciidoc">42.2.5. JSON Plug-in</h4>
<div class="paragraph">
<p>At the moment the plug-in can be used for merge generic JSOn files depending on the merge strategy defined at the templates.</p>
</div>
<div class="sect4">
<h5 id="cobigen-jsonplugin.asciidoc_merger-extensions">Merger extensions</h5>
<div class="paragraph">
<p>There are currently these merge strategies:</p>
</div>
<div class="paragraph">
<p><strong>Generic JSON Merge</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>merge strategy <code>jsonmerge</code>(add the new code respecting the existent is case of conflict)</p>
</li>
<li>
<p>merge strategy <code>jsonmerge_override</code> (add the new code overwriting the existent in case of conflict)</p>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>JsonArray&#8217;s will be ignored / replaced in total</p>
</li>
<li>
<p>JsonObjects in conclict will be processed recursively ignoring adding non existent elements.</p>
</li>
</ol>
</div>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="cobigen-jsonplugin.asciidoc_merge-process">Merge Process</h5>
<div class="sect5">
<h6 id="cobigen-jsonplugin.asciidoc_generic-json-merging">Generic JSON Merging</h6>
<div class="paragraph">
<p>The merge process will be:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Add non existent JSON Objects from patch file to base file.</p>
</li>
<li>
<p>For existent object in both files, will add non existent keys from patch to base object. This process will be done recursively for all existent objects.</p>
</li>
<li>
<p>For Json Arrays existent in both files, the arrays will be just concatenated.</p>
</li>
</ol>
</div>
<!-- toc disabled -->
</div>
</div>
</div>
<div class="sect3">
<h4 id="cobigen-tsplugin.asciidoc">42.2.6. TypeScript Plug-in</h4>
<div class="paragraph">
<p>The TypeScript Plug-in enables merging result TS files to existing ones. This plug-in is used at the moment for generate an Angular2 client with all CRUD functionalities enabled. The plug-in also generates de i18n functionality just appending at the end of the word the ES or EN suffixes, to put into the developer knowledge that this words must been translated to the correspondent language. Currently, the generation of Angular2 client requires an ETO java object as input so, there is no need to implement an input reader for ts artifacts for the moment.</p>
</div>
<div class="sect4">
<h5 id="cobigen-tsplugin.asciidoc_trigger-extensions">Trigger Extensions</h5>
<div class="paragraph">
<p>As for the Angular2 generation the input is a java object, the trigger expressions (including matchers and variable assignments) are implemented as <a href="https://github.com/devonfw/tools-cobigen/wiki/cobigen-javaplugin#trigger-extension">Java</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="cobigen-tsplugin.asciidoc_merger-extensions">Merger extensions</h5>
<div class="paragraph">
<p>This plugin uses the <a href="https://github.com/oasp/ts-merger">OASP TypeScript Merger</a> to merge files. There are currently two merge strategies:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>merge strategy <code>tsmerge</code> (add the new code respecting the existing is case of conflict)</p>
</li>
<li>
<p>merge strategy <code>tsmerge_override</code> (add the new code overwriting the existent in case of conflict)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The merge algorithm mainly handles the following AST nodes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>ImportDeclaration</strong></p>
<div class="ulist">
<ul>
<li>
<p>Will add non existent imports whatever the merge strategy is.</p>
</li>
<li>
<p>For different imports from same module, the import clauses will be merged.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-ts hljs" data-lang="ts">import { a } from 'b';
import { c } from 'b';
//Result
import { a, c } from 'b';</code></pre>
</div>
</div>
</li>
</ul>
</div>
</li>
<li>
<p><strong>ClassDeclaration</strong></p>
<div class="ulist">
<ul>
<li>
<p>Adds non existent base properties from patch based on the name property.</p>
</li>
<li>
<p>Adds non existent base methods from patch based on the name signature.</p>
</li>
<li>
<p>Adds non existent annotations to class, properties and methods.</p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>PropertyDeclaration</strong></p>
<div class="ulist">
<ul>
<li>
<p>Adds non existent decorators.</p>
</li>
<li>
<p>Merge existent decorators.</p>
</li>
<li>
<p>With override startegy, the value of the property will be replaced by the patch value.</p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>MethodDeclaration</strong></p>
<div class="ulist">
<ul>
<li>
<p>With override startegy, the body will be replaced.</p>
</li>
<li>
<p>The parameters will be merged.</p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>ParameterDeclaration</strong></p>
<div class="ulist">
<ul>
<li>
<p>Replace type and modifiers with override merge strategy, adding non existent from patch into base.</p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>ConstructorDeclaration</strong></p>
<div class="ulist">
<ul>
<li>
<p>Merged in the same way as Method is.</p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>FunctionDeclaration</strong></p>
<div class="ulist">
<ul>
<li>
<p>Merged in the same way as Method is.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="cobigen-tsplugin.asciidoc_input-reader">Input reader</h5>
<div class="paragraph">
<p>The TypeScript input reader is based on the one that the <a href="https://github.com/devonfw/ts-merger">TypeScript merger</a> uses. The current extensions are additional module fields giving from which library any entity originates.
<code>module: null</code> specifies a standard entity or type as <code>string</code> or <code>number</code>.</p>
</div>
<div class="sect5">
<h6 id="cobigen-tsplugin.asciidoc_object-model">Object model</h6>
<div class="paragraph">
<p>To get a first impression of the created object after parsing, let us start with analyzing a small example, namely the parsing of a simple <a href="https://typeorm.io/#/">type-orm</a> model written in TypeScript.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-Typescript hljs" data-lang="Typescript">import {Entity, PrimaryGeneratedColumn, Column} from "typeorm";

@Entity()
export class User {

    @PrimaryGeneratedColumn()
    id: number;

    @Column()
    firstName: string;

    @Column()
    lastName: string;

    @Column()
    age: number;

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The returned object has the following structure</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-JSON hljs" data-lang="JSON">{
  "importDeclarations": [
    {
      "module": "typeorm",
      "named": [
        "Entity",
        "PrimaryGeneratedColumn",
        "Column"
      ],
      "spaceBinding": true
    }
  ],
  "classes": [
    {
      "identifier": "User",
      "modifiers": [
        "export"
      ],
      "decorators": [
        {
          "identifier": {
            "name": "Entity",
            "module": "typeorm"
          },
          "isCallExpression": true
        }
      ],
      "properties": [
        {
          "identifier": "id",
          "type": {
            "name": "number",
            "module": null
          },
          "decorators": [
            {
              "identifier": {
                "name": "PrimaryGeneratedColumn",
                "module": "typeorm"
              },
              "isCallExpression": true
            }
          ]
        },
        {
          "identifier": "firstName",
          "type": {
            "name": "string",
            "module": null
          },
          "decorators": [
            {
              "identifier": {
                "name": "Column",
                "module": "typeorm"
              },
              "isCallExpression": true
            }
          ]
        },
        {
          "identifier": "lastName",
          "type": {
            "name": "string",
            "module": null
          },
          "decorators": [
            {
              "identifier": {
                "name": "Column",
                "module": "typeorm"
              },
              "isCallExpression": true
            }
          ]
        },
        {
          "identifier": "age",
          "type": {
            "name": "number",
            "module": null
          },
          "decorators": [
            {
              "identifier": {
                "name": "Column",
                "module": "typeorm"
              },
              "isCallExpression": true
            }
          ]
        }
      ]
    }
  ]
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If we only consider the first level of the JSON response, we spot two lists of <code>imports</code> and <code>classes</code>, providing information about the only import statement and the only <strong>User</strong> class, respectively. Moving one level deeper we observe that:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Every import statement is translated to an import declaration entry in the declarations list, containing the module name, as well as a list of entities imported from the given module.</p>
</li>
<li>
<p>Every class entry provides besides the class identifier, its decoration(s), modifier(s), as well as a list of properties that the original class contains.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Note that, for each given type, the module from which it is imported is also given as in</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-JSON hljs" data-lang="JSON">  "identifier": {
    "name": "Column",
    "module": "typeorm"
  }</code></pre>
</div>
</div>
<div class="paragraph">
<p>Returning to the general case, independently from the given TypeScript file, an object having the following Structure will be created.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>importDeclarations</strong>: A list of import statement as described above</p>
</li>
<li>
<p><strong>exportDeclarations</strong>: A list of export declarations</p>
</li>
<li>
<p><strong>classes</strong>: A list of classes extracted from the given file, where each entry is full of class specific fields, describing its properties and decorator for example.</p>
</li>
<li>
<p><strong>interfaces</strong>: A list of interfaces.</p>
</li>
<li>
<p><strong>variables</strong>: A list of variables.</p>
</li>
<li>
<p><strong>functions</strong>: A list of functions.</p>
</li>
<li>
<p><strong>enums</strong>: A list of enumerations.</p>
</li>
</ul>
</div>
<!-- toc disabled -->
</div>
</div>
</div>
<div class="sect3">
<h4 id="cobigen-htmlplugin.asciidoc">42.2.7. HTML Plug-in</h4>
<div class="paragraph">
<p>The HTML Plug-in enables merging result HTML files to existing ones. This plug-in is used at the moment for generate an Angular2 client. Currently, the generation of Angular2 client requires an ETO java object as input so, there is no need to implement an input reader for ts artifacts for the moment.</p>
</div>
<div class="sect4">
<h5 id="cobigen-htmlplugin.asciidoc_trigger-extensions">Trigger Extensions</h5>
<div class="paragraph">
<p>As for the Angular2 generation the input is a java object, the trigger expressions (including matchers and variable assignments) are implemented as <a href="https://github.com/devonfw/tools-cobigen/wiki/cobigen-javaplugin#trigger-extension">Java</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="cobigen-htmlplugin.asciidoc_merger-extensions">Merger extensions</h5>
<div class="paragraph">
<p>There are currently two merge strategies:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>merge strategy <code>html-ng*</code> (add the new code respecting the existing is case of conflict)</p>
</li>
<li>
<p>merge strategy <code>html-ng*_override</code> (add the new code overwriting the existent in case of conflict)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The merging of two Angular2 files will be processed as follows:</p>
</div>
<div class="paragraph">
<p>The merge algorithm handles the following AST nodes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>md-nav-list</p>
</li>
<li>
<p>a</p>
</li>
<li>
<p>form</p>
</li>
<li>
<p>md-input-container</p>
</li>
<li>
<p>input</p>
</li>
<li>
<p>name (for name attribute)</p>
</li>
<li>
<p>ngIf</p>
</li>
</ul>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Be aware, that the HTML merger is not generic and only handles the described tags needed for merging code of a basic Angular client implementation. For future versions, it is planned to implement a more generic solution.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="master-cobigen.asciidoc_maven-build-integration">43. Maven Build Integration</h2>
<div class="sectionbody">
<!-- toc disabled -->
<div class="sect2">
<h3 id="cobigen-maven_configuration.asciidoc">43.1. Maven Build Integration</h3>
<div class="paragraph">
<p>For maven integration of CobiGen you can include the following build plugin into your build:</p>
</div>
<div class="listingblock">
<div class="title">Listing 116. Build integration of CobiGen</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;build&gt;
  &lt;plugins&gt;
    &lt;plugin&gt;
      &lt;groupId&gt;com.devonfw.cobigen&lt;/groupId&gt;
      &lt;artifactId&gt;maven-plugin&lt;/artifactId&gt;
      &lt;version&gt;VERSION-YOU-LIKE&lt;/version&gt;
      &lt;executions&gt;
        &lt;execution&gt;
          &lt;id&gt;cobigen-generate&lt;/id&gt;
          &lt;phase&gt;site&lt;/phase&gt;
          &lt;goals&gt;
            &lt;goal&gt;generate&lt;/goal&gt;
          &lt;/goals&gt;
        &lt;/execution&gt;
      &lt;/executions&gt;
    &lt;/plugin&gt;
  &lt;/plugins&gt;
&lt;/build&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Available goals</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>generate</code>: Generates contents configured by the standard non-compiled configuration folder. Thus generation can be controlled/configured due to an location URI of the configuration and tempalte or increment ids to be generated for a set of inputs.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Available phases</strong> are all phases, which already provide compiled sources such that CobiGen can perform reflection on it. Thus possible phases are for example package, site.</p>
</div>
<div class="sect3">
<h4 id="cobigen-maven_configuration.asciidoc_provide-template-set">43.1.1. Provide Template Set</h4>
<div class="paragraph">
<p>For generation using the CobiGen maven plug-in, the CobiGen configuration can be provided in two different styles:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>By a <code>configurationFolder</code>, which should be available on the file system whenever you are running the generation. The value of <code>configurationFolder</code> should correspond to the maven file path syntax.</p>
<div class="listingblock">
<div class="title">Listing 117. Provide CobiGen configuration by configuration folder (file)</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;build&gt;
  &lt;plugins&gt;
    &lt;plugin&gt;
      ...
      &lt;configuration&gt;
        &lt;configurationFolder&gt;cobigen-templates&lt;/configurationFolder&gt;
      &lt;/configuration&gt;
       ...
     &lt;/plugin&gt;
  &lt;/plugins&gt;
&lt;/build&gt;</code></pre>
</div>
</div>
</li>
<li>
<p>By maven dependency, whereas the maven dependency should stick on the same conventions as the configuration folder. This explicitly means that it should contain non-compiled resources as well as the <code>context.xml</code> on top-level.</p>
<div class="listingblock">
<div class="title">Listing 118. Provide CobiGen configuration by maven dependency (jar)</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;build&gt;
  &lt;plugins&gt;
    &lt;plugin&gt;
      ...
      &lt;dependencies&gt;
        &lt;dependency&gt;
          &lt;groupId&gt;com.devonfw.cobigen&lt;/groupId&gt;
          &lt;artifactId&gt;templates-XYZ&lt;/artifactId&gt;
          &lt;version&gt;VERSION-YOU-LIKE&lt;/version&gt;
        &lt;/dependency&gt;
      &lt;/dependencies&gt;
      ...
    &lt;/plugin&gt;
  &lt;/plugins&gt;
&lt;/build&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>We currently provide a generic deployed version of the templates on the devonfw-nexus for Register Factory (<code>&lt;artifactId&gt;cobigen-templates-rf&lt;/artifactId&gt;</code>) and for the devonfw itself (<code>&lt;artifactId&gt;cobigen-templates-devonfw&lt;/artifactId&gt;</code>).</p>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="cobigen-maven_configuration.asciidoc_build-configuration">43.1.2. Build Configuration</h4>
<div class="paragraph">
<p>Using the following configuration you will be able to customize your generation as follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>&lt;destinationRoot&gt;</code> specifies the root directory the relative <code>destinationPath</code> of <a href="cobigen-core_configuration.html#Templates-configuration">CobiGen templates configuration</a> should depend on. <em>Default $./</em></p>
</li>
<li>
<p><code>&lt;inputPackage&gt;</code> declares a package name to be used as input for batch generation. This refers directly to the CobiGen Java Plug-in <a href="cobigen-javaplugin.html#ContainerMatcher-types">container matchers of type package</a> configuration.</p>
</li>
<li>
<p><code>&lt;inputFile&gt;</code> declares a file to be used as input. The CobiGen maven plug-in will try to parse this file to get an appropriate input to be interpreted by any CobiGen plug-in.</p>
</li>
<li>
<p><code>&lt;increment&gt;</code> specifies an <a href="cobigen-core_configuration.html#increment-node">increment</a> ID to be generated. You can specify one single increment with content <code>ALL</code> to generate all increments matching the input(s).</p>
</li>
<li>
<p><code>&lt;template&gt;</code> specifies a <a href="cobigen-core_configuration.html#increment-node">template</a> ID to be generated. You can specify one single template with content <code>ALL</code> to generate all templates matching the input(s).</p>
</li>
<li>
<p><code>&lt;forceOverride&gt;</code> specifies an overriding behavior, which enables non-mergable resources to be completely rewritten by generated contents. For mergable resources this flag indicates, that conflicting fragments during merge will be replaced by generated content. <em>Default: false</em></p>
</li>
<li>
<p><code>&lt;failOnNothingGenerated&gt;</code> specifies whether the build should fail if the execution does not generate anything.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Listing 119. Example for a simple build configuration</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;build&gt;
  &lt;plugins&gt;
    &lt;plugin&gt;
       ...
      &lt;configuration&gt;
        &lt;destinationRoot&gt;${basedir}&lt;/destinationRoot&gt;
        &lt;inputPackages&gt;
          &lt;inputPackage&gt;package.to.be.used.as.input&lt;/inputPackage&gt;
        &lt;/inputPackages&gt;
        &lt;inputFiles&gt;
          &lt;inputFile&gt;path/to/file/to/be/used/as/input&lt;/inputFile&gt;
        &lt;/inputFiles&gt;
        &lt;increments&gt;
          &lt;increment&gt;IncrementID&lt;/increment&gt;
        &lt;/increments&gt;
        &lt;templates&gt;
          &lt;template&gt;TemplateID&lt;/template&gt;
        &lt;/templates&gt;
        &lt;forceOverride&gt;false&lt;/forceOverride&gt;
      &lt;/configuration&gt;
        ...
    &lt;/plugin&gt;
  &lt;/plugins&gt;
&lt;/build&gt;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="cobigen-maven_configuration.asciidoc_plugin-injection-since-v3">43.1.3. Plugin Injection Since v3</h4>
<div class="paragraph">
<p>Since version 3.0.0, the <a href="cobigen-core_configuration.html#plugin-mechanism">plug-in mechanism</a> has changed to support modular releases of the CobiGen plug-ins. Therefore, you need to add all plug-ins to be used for generation. Take the following example to get the idea:</p>
</div>
<div class="listingblock">
<div class="title">Listing 120. Example of a full configuration including plugins</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;build&gt;
  &lt;plugins&gt;
    &lt;plugin&gt;
      &lt;groupId&gt;com.devonfw.cobigen&lt;/groupId&gt;
      &lt;artifactId&gt;maven-plugin&lt;/artifactId&gt;
      &lt;version&gt;VERSION-YOU-LIKE&lt;/version&gt;
      &lt;executions&gt;
        ...
      &lt;/executions&gt;
      &lt;configuration&gt;
        ...
      &lt;/configuration&gt;
      &lt;dependencies&gt;
        &lt;dependency&gt;
          &lt;groupId&gt;com.devonfw.cobigen&lt;groupId&gt;
          &lt;artifactId&gt;templates-devon4j&lt;/artifactId&gt;
          &lt;version&gt;2.0.0&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
          &lt;groupId&gt;com.devonfw.cobigen&lt;/groupId&gt;
          &lt;artifactId&gt;tempeng-freemarker&lt;/artifactId&gt;
          &lt;version&gt;1.0.0&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
          &lt;groupId&gt;com.devonfw.cobigen&lt;/groupId&gt;
          &lt;artifactId&gt;javaplugin&lt;/artifactId&gt;
          &lt;version&gt;1.6.0&lt;/version&gt;
        &lt;/dependency&gt;
      &lt;/dependencies&gt;
    &lt;/plugin&gt;
  &lt;/plugins&gt;
&lt;/build&gt;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="cobigen-maven_configuration.asciidoc_a-full-example">43.1.4. A full example</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>A complete maven configuration example</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;build&gt;
  &lt;plugins&gt;
    &lt;plugin&gt;
      &lt;groupId&gt;com.devonfw.cobigen&lt;/groupId&gt;
      &lt;artifactId&gt;maven-plugin&lt;/artifactId&gt;
      &lt;version&gt;3.0.0&lt;/version&gt;
      &lt;executions&gt;
        &lt;execution&gt;
          &lt;id&gt;generate&lt;/id&gt;
          &lt;phase&gt;package&lt;/phase&gt;
          &lt;goals&gt;
            &lt;goal&gt;generate&lt;/goal&gt;
          &lt;/goals&gt;
        &lt;/execution&gt;
      &lt;/executions&gt;
      &lt;configuration&gt;
        &lt;inputFiles&gt;
          &lt;inputFile&gt;src/main/java/io/github/devonfw/cobigen/generator/dataaccess/api/InputEntity.java&lt;/inputFile&gt;
        &lt;/inputFiles&gt;
        &lt;increments&gt;
          &lt;increment&gt;dataaccess_infrastructure&lt;/increment&gt;
          &lt;increment&gt;daos&lt;/increment&gt;
        &lt;/increments&gt;
        &lt;failOnNothingGenerated&gt;false&lt;/failOnNothingGenerated&gt;
      &lt;/configuration&gt;
      &lt;dependencies&gt;
        &lt;dependency&gt;
          &lt;groupId&gt;com.devonfw.cobigen&lt;/groupId&gt;
          &lt;artifactId&gt;templates-devon4j&lt;/artifactId&gt;
          &lt;version&gt;2.0.0&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
          &lt;groupId&gt;com.devonfw.cobigen&lt;/groupId&gt;
          &lt;artifactId&gt;tempeng-freemarker&lt;/artifactId&gt;
          &lt;version&gt;1.0.0&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
          &lt;groupId&gt;com.devonfw.cobigen&lt;/groupId&gt;
          &lt;artifactId&gt;javaplugin&lt;/artifactId&gt;
          &lt;version&gt;1.6.0&lt;/version&gt;
        &lt;/dependency&gt;
      &lt;/dependencies&gt;
    &lt;/plugin&gt;
  &lt;/plugins&gt;
&lt;/build&gt;</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="master-cobigen.asciidoc_eclipse-integration">44. Eclipse Integration</h2>
<div class="sectionbody">
<!-- toc disabled -->
<div class="sect2">
<h3 id="cobigen-eclipse_installation.asciidoc">44.1. Installation</h3>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p><strong>Remark:</strong> CobiGen is preinstalled in the <a href="https://github.com/devonfw/devon-ide">devonfw/devon-ide</a>.</p>
</div>
</blockquote>
</div>
<div class="sect3">
<h4 id="cobigen-eclipse_installation.asciidoc_preconditions">44.1.1. Preconditions</h4>
<div class="ulist">
<ul>
<li>
<p>Eclipse 4.x</p>
</li>
<li>
<p>Java 7 Runtime (for starting eclipse with CobiGen). This is independent from the target version of your developed code.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="cobigen-eclipse_installation.asciidoc_installation-steps">44.1.2. Installation steps</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Open the eclipse installation dialog<br>
menu bar &#8594; <em>Help</em> &#8594; <em>Install new Software&#8230;&#8203;</em></p>
<div class="paragraph">
<p><span class="image"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/installation/01-install-new-software.png" alt="01 install new software"></span></p>
</div>
</li>
<li>
<p>Open CobiGen&#8217;s updatesite<br>
Insert the update site of your interest into the filed <em>Work with</em> and press <em>Add &#8230;&#8203;</em></p>
<div class="ulist">
<ul>
<li>
<p>Stable releases: <a href="http://de-mucevolve02/files/cobigen/updatesite/stable/" class="bare">http://de-mucevolve02/files/cobigen/updatesite/stable/</a></p>
</li>
<li>
<p>Beta/RC releases: <a href="http://de-mucevolve02/files/cobigen/updatesite/experimental/" class="bare">http://de-mucevolve02/files/cobigen/updatesite/experimental/</a><br>
<span class="image"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/installation/02-select-update-site.png" alt="02 select update site"></span></p>
</li>
</ul>
</div>
</li>
<li>
<p>Follow the installation wizard<br>
Select <em>CobiGen Eclipse Plug-in</em> &#8594; <em>Next</em> &#8594; <em>Next</em> &#8594; accept the license &#8594; <em>Finish</em> &#8594; <em>OK</em> &#8594; <em>Yes</em></p>
</li>
<li>
<p>Once installed, a new menu entry named "CobiGen" will show up in the <em>Package Explorer&#8217;s</em> context menu. In the sub menu there will the <em>Generate&#8230;&#8203;</em> command, which may ask you to update the templates, and then you can start the generation wizard of CobiGen. You can adapt the templates by clicking on <em>Adapt Templates</em> which will give you the possibility to import the <em>CobiGen_Templates</em> automatically so that you can modified them.</p>
</li>
<li>
<p>Checkout (clone) your project&#8217;s templates folder or use the current templates released with CobiGen (<a href="https://github.com/devonfw/tools-cobigen/tree/master/cobigen-templates" class="bare">https://github.com/devonfw/tools-cobigen/tree/master/cobigen-templates</a>) and then choose Import -&gt; General -&gt; Existing Projects into Workspace to import the templates into your workspace.<br></p>
</li>
<li>
<p>Now you can start generating. To get an introduction of CobiGen try the devon4j templates and work on the devon4j sample application. There you might want to start with Entity objects as a selection to run CobiGen with, which will give you a good overview of what CobiGen can be used for right out of the box in devon4j based development. If you need some more introduction in how to come up with your templates and increments, please be referred to the documentation of the <a href="cobigen-core_configuration.html#context-configuration">context configuration</a> and the <a href="cobigen-core_configuration.html#templates-configuration">templates configuration</a></p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Dependent on your context configuration menu entry <em>Generate&#8230;&#8203;</em> may be greyed out or not. See  for more information about valid selections for generation.</p>
</div>
</div>
<div class="sect3">
<h4 id="cobigen-eclipse_installation.asciidoc_updating">44.1.3. Updating</h4>
<div class="paragraph">
<p>In general updating CobiGen for eclipse is done via the update mechanism of eclipse directly, as shown on image below:</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/installation/03-update-software.png" alt="03 update software"></span></p>
</div>
<div class="paragraph">
<p>Upgrading eclipse CobiGen plug-in to v3.0.0 needs some more attention of the user due to a changed plug-in architecture of CobiGen&#8217;s <a href="cobigen-core_configuration.html#plugin-mechanism">core module</a> and the eclipse integration. Eventually, we were able to provide any plug-in of CobiGen seperately as its own eclipse bundle (fragment), which is automatically discovered by the main CobiGen Eclipse Plug-in after installation.</p>
</div>
<!-- toc disabled -->
</div>
</div>
<div class="sect2">
<h3 id="cobigen-eclipse_usage.asciidoc">44.2. Usage</h3>
<div class="paragraph">
<p>CobiGen has two different generation modes depending on the input selected for generation. The first one is the <em>simple mode</em>, which will be started if the input contains only one input artifact, e.g. for Java an input artifact currently is a Java file. The second one is the <em>batch  mode</em>, which will be started if the input contains multiple input artifacts, e.g. for Java this means a list of files. In general this means also that the batch mode might be started when selecting complex models as inputs, which contain multiple input artifacts. The latter scenario has only been covered in the research group,yet.</p>
</div>
<div class="sect3">
<h4 id="cobigen-eclipse_usage.asciidoc_simple-mode">44.2.1. Simple Mode</h4>
<div class="paragraph">
<p>Selecting the menu entry <em>Generate&#8230;&#8203;</em> the generation wizard will be opened:</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/generate_wizard_page1.png" alt="generate wizard page1"></span></p>
</div>
<div class="paragraph">
<p>The left side of the wizard shows all available increments, which can be selected to be generated. Increments are a container like concept encompassing multiple files to be generated, which should result in a semantically closed generation output.
On the right side of the wizard all files, which might be effected by the generation. Dependent on the increment selection on the left side, potenially effected files will be shown on the right side. The type of modification of each file will be encoded into following color scheme if the files are selected for generation:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>green:</strong> files, which are currently non-existent in the file system. These files will be created during generation</p>
</li>
<li>
<p><strong>yellow:</strong> files, which are currently existent in the file system and which are configured to be merged with generated contents.</p>
</li>
<li>
<p><strong>red:</strong> files, which are currently existent in the file system. These files will be overwritten if manually selected.</p>
</li>
<li>
<p><strong>no color:</strong> files, which are currently existent in the file system. Additionally files, which were unselected and thus will be ignored during generation.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Selecting an increment on the left side will initialize the selection of all shown files to be generated on the right side, whereas green and yellow categorized files will be selected intially. A manual modification of the pre-selection can be performed by switching to the customization tree using the <em>Customize</em> button on the right lower corner.</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p><strong>Optional:</strong> If you want to customize the generation object model of a Java input class, you might continue with the <em>Next &gt;</em> button instead of finishing the generation wizard. The next generation wizard page is currently available for Java file inputs and lists all non-static fields of the input. Unselecting entries will lead to an adapted object model for generation, such that unselected fields will be removed in the object model for generation. By default all fields will be included in the object model.</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>Using the <em>Finish</em> button, the generation will be performed. Finally, CobiGen runs the eclipse internal <em>organize imports</em> and <em>format source code</em> for all generated sources and modified sources. Thus it is possible, that---especially <em>organize imports</em> opens a dialog if some types could not be determined automatically. This dialog can be easily closed by pressing on <em>Continue</em>. If the generation is finished, the <em>Success!</em> dialog will pop up.</p>
</div>
</div>
<div class="sect3">
<h4 id="cobigen-eclipse_usage.asciidoc_batch-mode">44.2.2. Batch mode</h4>
<div class="paragraph">
<p>Are there multiple input elements selected, e.g., Java files, CobiGen will be started in batch mode. For the generation wizard dialog this means, that the generation preview will be contrained to the first selected input element. It does <em>not</em> preview the generation for each element of the selection or of a complex input. The selection of the files to be generated will be generated for each input element analogously afterwards.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/generate_wizard_page1_batch.png" alt="generate wizard page1 batch"></span></p>
</div>
<div class="paragraph">
<p>Thus the color encoding differs also a little bit:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>yellow:</strong> files, which are configured to be merged.</p>
</li>
<li>
<p><strong>red:</strong> files, which are not configured with any merge strategy and thus will be created if the file does not exist or overwritten if the file already exists</p>
</li>
<li>
<p><strong>no color:</strong> files, which will be ignored during generation</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Initially all possible files to be generated will be selected.</p>
</div>
</div>
<div class="sect3">
<h4 id="cobigen-eclipse_usage.asciidoc_health-check">44.2.3. Health Check</h4>
<div class="paragraph">
<p>To check whether CobiGen runs appropriately for the selected element(s) the user can perform a <em>Health Check</em> by activating the respective menu entry as shown below.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/health_check_menu_entry.png" alt="health check menu entry"></span></p>
</div>
<div class="paragraph">
<p>The simple <em>Health Check</em> includes 3 checks. As long as any of these steps fails, the <em>Generate</em> menu entry is grayed out.</p>
</div>
<div class="paragraph">
<p>The first step is to check whether the generation configuration is available at all. If this check fails you will see the following message:</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/health_check_no_templates.png" alt="health check no templates"></span></p>
</div>
<div class="paragraph">
<p>This indicates, that there is no Project named <em>CobiGen_Templates</em> available in the current workspace. To run CobiGen appropriately, it is necessary to have a configuration project named <em>CobiGen_Templates</em> imported into your workspace. For more information see chapter <a href="cobigen-eclipse_installation.html#Installation-steps">Eclipse Installation</a>.</p>
</div>
<div class="paragraph">
<p>The second step is to check whether the template project includes a valid <em>context.xml</em>. If this check fails, you will see the following message:</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/health_check_invalid_config.png" alt="health check invalid config"></span></p>
</div>
<div class="paragraph">
<p>This means that either your <em>context.xml</em></p>
</div>
<div class="ulist">
<ul>
<li>
<p>does not exist (or has another name)</p>
</li>
<li>
<p>or it is not valid one in any released version of CobiGen</p>
</li>
<li>
<p>or there is simply no automatic routine of upgrading your context configuration to a valid state.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If all this is not the case, such as, there is a <em>context.xml</em>, which can be successfully read by CobiGen, you might get the following information:</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/health_check_old_context.png" alt="health check old context"></span></p>
</div>
<div class="paragraph">
<p>This means that your <em>context.xml</em> is available with the correct name but it is outdated (belongs to an older CobiGen version). In this case just click on <em>Upgrade Context Configuration</em> to get the latest version.</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p><strong>Remark:</strong> This will create a backup of your current context configuration and converts your old configuration to the new format. The upgrade will remove all comments from the file, which could be retrieved later on again from the backup.
If the creation of the backup fails, you will be asked to continue or to abort.</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>The third step checks whether there are templates for the selected element(s). If this check fails, you will see the following message:</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/health_check_no_matching_triggers.png" alt="health check no matching triggers"></span></p>
</div>
<div class="paragraph">
<p>This indicates, that there no trigger has been activated, which matches the current selection. The reason might be that your selection is faulty or that you imported the wrong template project (e.g. you are working on a devon4j project, but imported the Templates for the Register Factory). If you are a template developer, have a look at the  <a href="cobigen-core_configuration.html#trigger-node">trigger configuration</a> and at the corresponding available plug-in implementations of triggers, like e.g., <a href="cobigen-javaplugin.html#Trigger-extension">Java Plug-in</a> or <a href="cobigen-xmlplugin.html#Trigger-extension">XML Plug-in</a>.</p>
</div>
<div class="paragraph">
<p>If all the checks are passed you see the following message:</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/health_check_all_OK.png" alt="health check all OK"></span></p>
</div>
<div class="paragraph">
<p>In this case everything is OK and the <em>Generate</em> button is not grayed out anymore so that you are able to trigger it and see the <a href="#cobigen-eclipse_usage.asciidoc_cobigen-eclipse_usage.asciidoc_simple-mode">simple-mode</a>.</p>
</div>
<div class="paragraph">
<p>In addition to the basic check of the context configuration, you also have the opportunity to perform an  <em>Advanced Health Check</em>, which will check all available templates configurations (<em>templates.xml</em>) of path-depth=1 from the configuration project root according to their compatibility.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/health_check_advanced_up_to_date.png" alt="health check advanced up to date"></span></p>
</div>
<div class="paragraph">
<p>Analogous to the upgrade of the <em>context configuration</em>, the <em>Advanced Health Check</em> will also provide upgrade functionality for <em>templates configurations</em> if available.</p>
</div>
</div>
<div class="sect3">
<h4 id="cobigen-eclipse_usage.asciidoc_update-templates">44.2.4. Update Templates</h4>
<div class="paragraph">
<p>Update Template: Select Entity file and right click then select cobigen Update Templates after that click on download then download successfully message will be come .</p>
</div>
</div>
<div class="sect3">
<h4 id="cobigen-eclipse_usage.asciidoc_adapt-templates">44.2.5. Adapt Templates</h4>
<div class="paragraph">
<p>Adapt Template: Select any file and right click, then select cobigen &#8594; <em>Adapt Templates</em> .If cobigen templates jar is not available then it downloads them automatically. If Cobigen templates is already present then it will override existing template in workspace and click on OK then imported template successfully message will be come.</p>
</div>
<div class="paragraph">
<p>Finally, please change the Java version of the project to 1.8 so that you don&#8217;t have any compilation errors.</p>
</div>
<!-- toc disabled -->
</div>
</div>
<div class="sect2">
<h3 id="cobigen-eclipse_logging.asciidoc">44.3. Logging</h3>
<div class="paragraph">
<p>If you have any problem with the CobiGen eclipse plug-in, you might want to enable logging to provide more information for further problem analysis. This can be done easily by adding the <code>logback.xml</code> to the root of the CobiGen_templates configuration folder. The file should contain at least the following contents, whereas you should specify an absolute path to the target log file (at the <code>TODO</code>). If you are using the (<a href="https://github.com/devonfw/tools-cobigen/tree/master/cobigen-templates)">cobigen-templates</a> project, you might have the contents already specified but partially commented.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;!-- This file is for logback classic. The file contains the configuration for sl4j logging --&gt;
&lt;configuration&gt;
    &lt;appender name="FILE" class="ch.qos.logback.core.FileAppender"&gt;
        &lt;file&gt;&lt;!-- TODO choose your log file location --&gt;&lt;/file&gt;
        &lt;encoder class="ch.qos.logback.classic.encoder.PatternLayoutEncoder"&gt;
            &lt;Pattern&gt;%n%date %d{HH:mm:ss.SSS} [%thread] %-5level %logger - %msg%n
            &lt;/Pattern&gt;
        &lt;/encoder&gt;
    &lt;/appender&gt;
    &lt;root level="DEBUG"&gt;
        &lt;appender-ref ref="FILE" /&gt;
    &lt;/root&gt;
&lt;/configuration&gt;</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="master-cobigen.asciidoc_template-development">45. Template Development</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="cobigen-templates_helpful-links.asciidoc">45.1. Helpful links for template development</h3>
<div class="ulist">
<ul>
<li>
<p><a href="http://freemarker.org/">FreeMarker Root Page</a></p>
<div class="ulist">
<ul>
<li>
<p><a href="http://freemarker.org/docs/dgui_template_exp.html#exp_cheatsheet">Expressions Cheat Sheet</a></p>
</li>
<li>
<p><a href="http://freemarker.org/docs/ref.html">Complete Language reference</a></p>
</li>
<li>
<p><a href="http://freemarker-online.kenshoo.com/">FreeMarker Template Tester</a></p>
</li>
</ul>
</div>
</li>
<li>
<p><a href="cobigen-javaplugin.html#template-object-model">Variables to access Java source model</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<h1 id="master-devonfw-testing.asciidoc" class="sect0">IX: devonfw testing</h1>
<div class="openblock partintro">
<div class="content">
<!-- toc disabled -->
</div>
</div>
<div class="sect1">
<h2 id="Home.asciidoc">46. Home</h2>
<div class="sectionbody">
<div class="imageblock">
<div class="content">
<a class="image" href="images/logo_Mr_Checker_v03.png"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/logo_Mr_Checker_v03.png" alt="MrChecker logo" width="450"></a>
</div>
</div>
<div class="sect2">
<h3 id="home.asciidoc_contact">46.1. Contact</h3>
<div class="paragraph">
<p>In case of any questions, please send mail to: DL PL E2E Test Framework &lt;<a href="mailto:e2etestframework.pl@capgemini.com">e2etestframework.pl@capgemini.com</a>&gt;</p>
</div>
</div>
<div class="sect2">
<h3 id="home.asciidoc_what-is-e2e-mr-checker-test-framework">46.2. What is E2E Mr Checker Test Framework</h3>
<div class="paragraph">
<p>Mr Checker Test Framework in the end to end test automation framework written in Java.</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="documentation/E2E_Test_Framework_for_DevOps_Smart_Automation_ver2/Slide4.PNG"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/documentation/E2E_Test_Framework_for_DevOps_Smart_Automation_ver2/Slide4.PNG" alt="E2E Test Framework  for DevOps &amp; Smart Automation" width="450"></a>
</div>
</div>
</div>
<div class="sect2">
<h3 id="home.asciidoc_where-mr-checker-applies">46.3. Where Mr Checker applies?</h3>
<div class="paragraph">
<p>The main goal of MrChecker is to standardize the way we build BlackBox tests. It gives the possibility to have one common software standard in order to build: Component,  Integration and System tests.</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="documentation/E2E_Test_Framework_for_DevOps_Smart_Automation_ver2/Test_pyramid.png"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/documentation/E2E_Test_Framework_for_DevOps_Smart_Automation_ver2/Test_pyramid.png" alt="Test pyramis" width="450"></a>
</div>
</div>
<div class="paragraph">
<p>A Test Engineer does not have access to the application source code in order to perform BlackBox tests, but he is able to attach his tests to any application interfaces, such as:
- IP address
- Domain Name
- communication protocol
- Command Line Interface.</p>
</div>
<div class="paragraph">
<p>Mr Checker&#8217;s specification:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Responsive Web Design application: Selenium Browser</p>
</li>
<li>
<p>REST/SOAP: RestAssure</p>
</li>
<li>
<p>Service Virtualization: Wiremock</p>
</li>
<li>
<p>Database: JDBC drivers for SQL</p>
</li>
<li>
<p>Security: RestAssure + RestAssure Security lib</p>
</li>
<li>
<p>Standalone java application: SWING</p>
</li>
<li>
<p>Native mobile application for Android: Appium</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="home.asciidoc_test-stages">46.3.1. Test stages</h4>
<div class="paragraph">
<p><strong>Unit test</strong></p>
</div>
<div class="paragraph">
<p>A module is the smallest compilable unit of source code. It is often too small to be tested by the functional tests (black-box tests). However, it is the ideal candidate for white-box testing.
White - box tests have to be performed as the first static tests (e.g. Lint and inspections), followed by dynamic tests in order to check boundaries, branches and paths. Usually, that kind of testing would require the enablement of stubs and special test tools. </p>
</div>
<div class="paragraph">
<p><strong>Component test</strong></p>
</div>
<div class="paragraph">
<p>This is the black-box test of modules or groups of modules which represent certain functionalities. There are no rules about what could be called a component. Whatever a tester defines as a component, should make sense and be a testable unit. Components can be step by step integrated into the bigger components and tested as such. </p>
</div>
<div class="paragraph">
<p><strong>Integration test</strong></p>
</div>
<div class="paragraph">
<p>Functions are tested by feeding them input and examining the output, and internal program structure is rarely considered. The software is step by step completed and tested by the tests covering a collaboration of modules or classes. The integration depends on the kind of system.
For example, the steps could be as such: run the operating system first and gradually add one component after another, then check if the black-box tests still are running (the test cases will be extended together with every added component). The integration is done in the laboratory. It may be also completed by using simulators or emulators. Additionally, the input signals could be stimulated. </p>
</div>
<div class="paragraph">
<p><strong>Software / System test</strong></p>
</div>
<div class="paragraph">
<p>System testing is a type of testing conducted on a complete integrated system to evaluate the system&#8217;s compliance with its specified requirements. This is a type of black-box testing of the complete software in the target system. The most important factor in the successful system testing is that the environmental conditions for the software have to be as realistic as possible (complete original hardware in the destination environment).</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="home.asciidoc_benefits-for-the-project">46.4. Benefits for the project</h3>
<div class="paragraph">
<p>Every customer may benefit from using Mr Checker Test Framework.
The main profits for the project are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Resilient and robust building and validation process</p>
</li>
<li>
<p>Quality gates shifted closer to the software development process</p>
</li>
<li>
<p>Team quality awareness increase - including Unit Tests, Static Analyze, Security Tests, Performance in the testing process</p>
</li>
<li>
<p>Test execution environment transparent to any infrastructure</p>
</li>
<li>
<p>Touch base with the Cloud solution</p>
</li>
<li>
<p>Faster Quality and DevOps - driven delivery</p>
</li>
<li>
<p>Proven frameworks,  technologies and processes.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="home.asciidoc_road-map-plan">46.5. Road map plan</h3>
<div class="imageblock">
<div class="content">
<a class="image" href="documentation/E2E_Test_Framework_for_DevOps_Smart_Automation_ver2/Slide9.PNG"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/documentation/E2E_Test_Framework_for_DevOps_Smart_Automation_ver2/Slide9.PNG" alt="MrChecker E2E Framework road map" width="450"></a>
</div>
</div>
<div class="paragraph">
<p>All slides: <a href="https://github.com/devonfw/devonfw-testing/wiki/documentation/E2E_Test_Framework_for_DevOps_Smart_Automation_ver2.pptx">link</a></p>
</div>
</div>
<div class="sect2">
<h3 id="home.asciidoc_wiki-structure">46.6. Wiki Structure</h3>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/devonfw/devonfw-testing/wiki/How-to-install">How to install Mr Checker Test Framework_</a></p>
</li>
<li>
<p>Mr Checker Test Framework modules:</p>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/devonfw/devonfw-testing/wiki/Core-test-module">Core test module</a></p>
</li>
<li>
<p><a href="https://github.com/devonfw/devonfw-testing/wiki/Selenium-test-module">Selenium test module</a></p>
</li>
<li>
<p><a href="https://github.com/devonfw/devonfw-testing/wiki/WebAPI-test-module">WebAPI test module</a></p>
</li>
<li>
<p><a href="https://github.com/devonfw/devonfw-testing/wiki/Security-test-module">Security test module</a></p>
</li>
<li>
<p><a href="https://github.com/devonfw/devonfw-testing/wiki/DataBase-test-module">DataBase test module</a></p>
</li>
<li>
<p><a href="https://github.com/devonfw/devonfw-testing/wiki/Mobile-test-module">Mobile test module</a></p>
</li>
<li>
<p><a href="https://github.com/devonfw/devonfw-testing/wiki/Standalone-test-module">Standalone test module</a></p>
</li>
<li>
<p><a href="https://github.com/devonfw/devonfw-testing/wiki/DevOps-module">DevOps module</a></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<!-- toc disabled -->
</div>
</div>
</div>
<div class="sect1">
<h2 id="How-to-install.asciidoc">47. How to install</h2>
<div class="sectionbody">
<div class="paragraph">
<p>There is one important pre-requisite for Mr Checker installation - there has to be Java installed on the computer and an environmental variable has to be set in order to obtain optimal functioning of the framework.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Install Java 1.8 JDK 64bit</p>
<div class="ulist">
<ul>
<li>
<p>Download and install <a href="http://www.oracle.com/technetwork/java/javase/downloads/jdk8-downloads-2133151.html">Java download link</a></p>
<div class="imageblock">
<div class="content">
<a class="image" href="images/install/3137412086-JAva_install.png"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/install/3137412086-JAva_install.png" alt="Oracle Java download" width="450"></a>
</div>
</div>
</li>
<li>
<p>Windows Local Environment <a href="https://www.java.com/en/download/help/path.xml">how to set</a>:</p>
<div class="ulist">
<ul>
<li>
<p><strong>Variable name</strong>: JAVA_HOME | <strong>Variable value</strong>: c:\Where_You&#8217;ve_Installed_Java</p>
</li>
<li>
<p><strong>Variable name</strong>: PATH | <strong>Variable value</strong>: %JAVA_HOME%/bin;%JAVA_HOME%\lib</p>
<div class="imageblock">
<div class="content">
<a class="image" href="images/install/427137171-Java.png"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/install/427137171-Java.png" alt="Environment Variables" width="450"></a>
</div>
</div>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Verify in command line:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">&gt; java --version</code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>Mr Checker installation can be done in three ways:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Easy out of the box installation</strong> - Fast and easy solution - recommended for all users, who had previously not used any test automation environment. A drawback of these solutions is that it applies not for all Operation Systems</p>
</li>
<li>
<p><strong>Out of the box installation</strong> - with additional steps - when the first way is not working for you</p>
</li>
<li>
<p><strong>Advanced installation</strong> - Manual step by step installation containing all framework ingredients</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="how-to-install.asciidoc_easy-out-of-the-box-installation">47.1. Easy out of the box installation</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Click on the link <a href="https://capgemini.sharepoint.com/sites/E2ETesting-SummitDevonfwProductionLine/Shared%20Documents/General/MrChecker_Test_Framework_2_6_0.7z">Ready to use MrChecker_Test_Environment</a> and download the package</p>
</li>
<li>
<p>Unzip downloaded MrChecker Test Framework to the folder C:\ on your PC - recommended tool: <a href="http://www.7-zip.org/download.html">7z</a>
All necessary components, such as Eclipse, Java and Maven will be pre-installed for you. There is no need for additional installations.</p>
<div class="paragraph">
<p><strong>Note:</strong> Please double check the place in which you have unzipped MrChecker_Test_Framework</p>
</div>
</li>
<li>
<p>Go to folder C:\MrChecker_Test_Framework\ , in which Mr.Checker has been unzipped</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/install/Installation_folder_AllureTestFramework.PNG"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/install/Installation_folder_AllureTestFramework.PNG" alt="Installation folder" width="450"></a>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Double click on <em>start-eclipse.bat</em></p>
</li>
<li>
<p>. Update project structure (<em>ALT + F5</em>)</p>
<div class="imageblock">
<div class="content">
<a class="image" href="images/install/UpdateProjects_in_AllureTestFramework.PNG"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/install/UpdateProjects_in_AllureTestFramework.PNG" alt="Update project structure" width="450"></a>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>If the script is not working for you - try:</p>
</div>
</div>
<div class="sect3">
<h4 id="how-to-install.asciidoc_out-of-the-box-installation---with-additional-steps">47.2. Out of the box installation - with additional steps</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Open Eclipse</p>
</li>
<li>
<p>Manually Delete folders that appear in Eclipse</p>
</li>
<li>
<p>Click inside Eclipse with a right mouse click and open Import</p>
</li>
<li>
<p>Select Maven &#8594; existing Maven project</p>
</li>
<li>
<p>Select Mr Checker &#8594; workspace &#8594; devon project and click OK</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>At this point, all test catalogues should be imported in Eclipse and ready to use.</p>
</div>
</div>
<div class="sect3">
<h4 id="how-to-install.asciidoc_advanced-manual-step-by-step-installation">47.3. Advanced manual step by step installation</h4>
<div class="paragraph">
<p>Install each component separately, or update the existing ones on your PC.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Maven 3.5</p>
<div class="ulist">
<ul>
<li>
<p>Download Maven <a href="http://www-eu.apache.org/dist/maven/maven-3/3.5.0/binaries/apache-maven-3.5.0-bin.zip" class="bare">http://www-eu.apache.org/dist/maven/maven-3/3.5.0/binaries/apache-maven-3.5.0-bin.zip</a></p>
</li>
<li>
<p>Unzip Maven in followin location C:\maven</p>
</li>
<li>
<p>Set Windows Local Environment</p>
<div class="ulist">
<ul>
<li>
<p><strong>Variable name</strong>: M2_HOME | <strong>Variable value</strong>: c:\maven</p>
</li>
<li>
<p><strong>Variable name</strong>: PATH | <strong>Variable value</strong>: %M2_HOME%\bin</p>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/install/4126112216-Maven.png" alt="Maven.PNG" width="450" height="images/install/4126112216-Maven.png">
</div>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Verify in command line:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">&gt; mvn --version</code></pre>
</div>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Eclipse IDE</p>
<div class="ulist">
<ul>
<li>
<p>Download and unzip <a href="https://www.eclipse.org/downloads/download.php?file=/technology/epp/downloads/release/neon/3/eclipse-java-neon-3-win32-x86_64.zip">Eclipse</a></p>
</li>
</ul>
</div>
</li>
<li>
<p>Download Mr Checker Test Framework <a href="https://github.com/devonfw/devonfw-testing/archive/develop.zip">source code</a></p>
</li>
<li>
<p>Import projects in Eclipse</p>
<div class="ulist">
<ul>
<li>
<p>Import:</p>
<div class="imageblock">
<div class="content">
<a class="image" href="images/install/Install_ImportProject.PNG"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/install/Install_ImportProject.PNG" alt="Importing Project" width="450"></a>
</div>
</div>
</li>
<li>
<p>Projects from folders:</p>
<div class="paragraph">
<p><span class="image"><a class="image" href="images/install/Install_ImportAlreadyCreated.PNG"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/install/Install_ImportAlreadyCreated.PNG" alt="Projects from folders" width="450"></a></span></p>
</div>
</li>
<li>
<p>Open already created projects</p>
<div class="imageblock">
<div class="content">
<a class="image" href="images/install/Install_OpenAlreadyCreatedProjects.PNG"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/install/Install_OpenAlreadyCreatedProjects.PNG" alt="Open already created projects" width="450"></a>
</div>
</div>
</li>
<li>
<p>Update project structure - <em>ALT + F5</em></p>
<div class="imageblock">
<div class="content">
<a class="image" href="images/install/UpdateProjects_in_AllureTestFramework.PNG"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/install/UpdateProjects_in_AllureTestFramework.PNG" alt="Update project structure" width="450"></a>
</div>
</div>
</li>
</ul>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="master-devonfw-testing.asciidoc_mr-checker-test-framework-modules">48. Mr Checker Test Framework modules</h2>
<div class="sectionbody">
<!-- toc disabled -->
<div class="paragraph">
<p>This is the structure of Mr Checker Framework Modules:</p>
</div>
<div class="paragraph">
<p><span class="image"><a class="image" href="documentation/E2E_Test_Framework_for_DevOps_Smart_Automation_ver2/Slide6.PNG"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/documentation/E2E_Test_Framework_for_DevOps_Smart_Automation_ver2/Slide6.PNG" alt="E2E Test Framework  modules" width="450"></a></span></p>
</div>
<div class="paragraph">
<p>In this section, it is possible to find all information regarding the main modules of Mr Checker:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/devonfw/devonfw-testing/wiki/Core-test-module">Core Test Module</a></p>
</li>
<li>
<p><a href="https://github.com/devonfw/devonfw-testing/wiki/Selenium-test-module">Selenium Test Module</a></p>
</li>
<li>
<p><a href="https://github.com/devonfw/devonfw-testing/wiki/WebAPI-test-module">WebAPI Test Module</a></p>
</li>
<li>
<p><a href="https://github.com/devonfw/devonfw-testing/wiki/Security-test-module">Security Test Module</a></p>
</li>
<li>
<p><a href="https://github.com/devonfw/devonfw-testing/wiki/DataBase-test-module">Database Test Module</a></p>
</li>
<li>
<p><a href="https://github.com/devonfw/devonfw-testing/wiki/Mobile-test-module">Mobile Test Module</a></p>
</li>
<li>
<p><a href="https://github.com/devonfw/devonfw-testing/wiki/Standalone-test-module">Standalone Test Module</a></p>
</li>
<li>
<p><a href="https://github.com/devonfw/devonfw-testing/wiki/DevOps-module">DevOps Module</a></p>
</li>
</ul>
</div>
<!-- toc disabled -->
<div class="sect2">
<h3 id="Core-test-module.asciidoc">48.1. Core Test Module</h3>
<div class="sect3">
<h4 id="core-test-module.asciidoc_what-is-core-test-module">48.1.1. What is Core Test Module</h4>
<div class="imageblock">
<div class="content">
<a class="image" href="documentation/E2E_Test_Framework_for_DevOps_Smart_Automation_ver2/Slide13.PNG"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/documentation/E2E_Test_Framework_for_DevOps_Smart_Automation_ver2/Slide13.PNG" alt="Core functionality ingredients" width="450"></a>
</div>
</div>
</div>
<div class="sect3">
<h4 id="core-test-module.asciidoc_core-test-module-functions">48.1.2. Core Test Module Functions</h4>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/devonfw/devonfw-testing/wiki/Allure-report">Test reports with logs and/or screenshots</a></p>
</li>
<li>
<p><a href="https://github.com/devonfw/devonfw-testing/wiki/Tags---categories-and-test-suites">Test groups/tags</a></p>
</li>
<li>
<p><a href="https://github.com/devonfw/devonfw-testing/wiki/Data-driven-approach">Data driven approach</a></p>
</li>
<li>
<p><a href="https://github.com/devonfw/devonfw-testing/wiki/parallel-test-execution">Test case parallel execution</a></p>
</li>
<li>
<p><a href="https://github.com/devonfw/devonfw-testing/wiki/Cucumber">BDD - Gherkin - Cucumber approach</a></p>
</li>
<li>
<p><a href="https://github.com/devonfw/devonfw-testing/wiki/Run-on-independent-Operation-Systems">Run on independent Operating Systems</a></p>
</li>
<li>
<p><a href="https://github.com/devonfw/devonfw-testing/wiki/Different-environments">Externalize test environment (DEV, QA, SIT, PROD)</a></p>
</li>
<li>
<p><a href="https://github.com/devonfw/devonfw-testing/wiki/Different-environments#encrypting-sensitive-data">Encrypting sensitive data</a></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="core-test-module.asciidoc_how-to-start">48.1.3. How to start?</h4>
<div class="paragraph">
<p>Read: <a href="https://github.com/devonfw/devonfw-testing/wiki/framework-test-class">Framework Test Class</a></p>
</div>
<!-- toc disabled -->
</div>
<div class="sect3">
<h4 id="Framework-Test-Class.asciidoc">48.1.4. Test Class</h4>
<div class="sect4">
<h5 id="framework-test-class.asciidoc_overview">Overview</h5>
<div class="paragraph">
<p>The following image gives a general overview of the test class "lifecycle".</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/test-class-structure.png"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/test-class-structure.png" alt="Structure of the Test Class" width="450"></a>
</div>
</div>
<div class="paragraph">
<p>More information on the methods and annotations used in this image can be found in the following chapter.</p>
</div>
</div>
<div class="sect4">
<h5 id="framework-test-class.asciidoc_methods-and-annotations">Methods and annotations</h5>
<div class="paragraph">
<p>The actual tests that will be executed are loacted in so called <em>Test Classes</em>. Starting a new project, a new package should be created.</p>
</div>
<div class="paragraph">
<p><strong>Source folder</strong>: mrchecker-app-under-test/src/test/java</p>
</div>
<div class="paragraph">
<p><strong>Name</strong>: com.example.selenium.tests.tests.YOUR_PROJECT</p>
</div>
<div class="paragraph">
<p>Test classes have to extend the <strong>BaseTest</strong> class.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class DemoTest extends BaseTest {

	@Override
	public void setUp() {

	}

	@Override
	public void tearDown() {

	}
}</code></pre>
</div>
</div>
<div class="sect5">
<h6 id="framework-test-class.asciidoc_basepage-method-setup">BasePage method: setUp</h6>
<div class="paragraph">
<p>This method will be executed before the test. It allows objects to be instantiated, e.g. Page objects.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Override
public void setUp() {
	someTestPage = new SomeTestPage();
}</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="framework-test-class.asciidoc_basepage-method-teardown">BasePage method: tearDown</h6>
<div class="paragraph">
<p>The tearDown methods executes after the test. It allows the clean up of the testing environment.</p>
</div>
</div>
<div class="sect5">
<h6 id="framework-test-class.asciidoc_annotations">Annotations</h6>
<div class="paragraph">
<p>The <em>@Test</em> annotation indicates that the following method is a test method.</p>
</div>
<div class="paragraph">
<p>Additionally, there are two annotations that can help preparing and disassembling the test class: <em>@BeforeClass</em> and <em>@AfterClass</em>.</p>
</div>
<div class="paragraph">
<p><em>@BeforeClass</em> will execute the following method once at the beginning, before running any test method. Compared to the <em>setUp()</em> method provided by the BaseTest class, this annotation will only run once, instead of before every single test method. The advantage here: Things like login can be set up in <em>@BeforeClass</em>, as they can oftentimes be very time consuming. Loggin in on a webapplication once and afterwards running all the test methods is more efficient than loggin in before every test method, even though they are being executed on the same page.</p>
</div>
<div class="paragraph">
<p><em>@AfterClass</em> will execute after the last test method. Just like <em>@BeforeClass</em> this method will only run once, in contrary to the <em>tearDown()</em> method.</p>
</div>
<div class="paragraph">
<p>Initialize a new test method by using the <em>@Test</em> annotation.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Test
public void willResultBeShown() {

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This method will interact with a page object in order to test it.</p>
</div>
</div>
<div class="sect5">
<h6 id="framework-test-class.asciidoc_sample-setup">Sample setup</h6>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@BeforeClass
public static void setUpBeforeClass() throws Exception {
	BFLogger.logInfo("[Step1] Login as Account Administrator");
}

@AfterClass
public static void tearDownAfterClass() throws Exception {
	BFLogger.logInfo("[Step4] Logout");
}

@Override
public void setUp() {
	BFLogger.logInfo("Open home page before each test");
}

@Override
public void tearDown() {
	BFLogger.logInfo("Clean all data updated while executing each test");
}

@Test
public void test1() {
	BFLogger.logInfo("[Step2] Filter by \"Creation Date\" - Descending");
	BFLogger.logInfo("[Step3] Set $1 for first 10 Users in column \"Invoice to pay\"");

}

@Test
public void test2() {
	BFLogger.logInfo("[Step2] Filter by \"Invoice to pay\" - Ascending");
	BFLogger.logInfo("[Step3] Set $100 for first 10 Users in column \"Invoice to pay\"");
}</code></pre>
</div>
</div>
<!-- toc disabled -->
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="Selenium-test-module.asciidoc">48.2. Selenium Test Module</h3>
<div class="sect3">
<h4 id="selenium-test-module.asciidoc_what-is-mr-checker-e2e-selenium-test-module">48.2.1. What is Mr Checker E2E Selenium Test Module</h4>
<div class="imageblock">
<div class="content">
<a class="image" href="documentation/E2E_Test_Framework_for_DevOps_Smart_Automation_ver2/Slide14.PNG"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/documentation/E2E_Test_Framework_for_DevOps_Smart_Automation_ver2/Slide14.PNG" alt="What is Mr Checker E2E Selenium Test Module" width="450"></a>
</div>
</div>
</div>
<div class="sect3">
<h4 id="selenium-test-module.asciidoc_selenium-structure">48.2.2. Selenium Structure</h4>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/devonfw/devonfw-testing/wiki/what-is-selenium">What is Selenium</a></p>
</li>
<li>
<p><a href="https://github.com/devonfw/devonfw-testing/wiki/What-is-WebDriver">What is WebDriver</a></p>
</li>
<li>
<p><a href="https://github.com/devonfw/devonfw-testing/wiki/What-is-Page-Object-Model">What is Page Object Model/Pattern</a></p>
</li>
<li>
<p><a href="https://github.com/devonfw/devonfw-testing/wiki/List-of-WebElements">List of web elements (Button, Dropdown, Checkbox, Alert Popup, etc.)</a></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="selenium-test-module.asciidoc_framework-features">48.2.3. Framework Features</h4>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/devonfw/devonfw-testing/wiki/Construction-of-Framework-Page-Class">Construction of Framework Page Class</a></p>
<div class="ulist">
<ul>
<li>
<p>Every Page class must extend BasePage</p>
</li>
<li>
<p>What is isLoaded(), load() and pageTitle() for</p>
</li>
<li>
<p>How to create selector variable - 'private static final By ButtonOkSelector = By.Css(&#8230;&#8203;)'</p>
</li>
<li>
<p>How to prepare everlasting selector - <a href="https://github.com/devonfw/devonfw-testing/wiki/documentation/cssSelector.docx">documentation</a></p>
</li>
<li>
<p>Method/action naming convention - <a href="https://github.com/devonfw/devonfw-testing/wiki/Method-naming-convention">documentation</a></p>
</li>
<li>
<p>Why we should use findElementDynamic() and findElementQuietly() instead of classic Selenium findElement</p>
</li>
<li>
<p>List of well-rounded groups of user friendly actions (ElementButton, ElementCheckbox, ElementInput, etc.)</p>
</li>
<li>
<p>Verification points of well-defined Page classes and Test classes - <a href="https://github.com/devonfw/devonfw-testing/blob/master/mrchecker-app-under-test/CONTRIBUTING.md">documentation</a></p>
</li>
</ul>
</div>
</li>
<li>
<p><a href="https://github.com/devonfw/devonfw-testing/wiki/Run-on-different-browsers">Run on different browsers: Chrome, Firefox, IE, Safari, Edge</a></p>
</li>
<li>
<p><a href="https://github.com/devonfw/devonfw-testing/wiki/Run-with-different-browser-options">Run with different browser options</a></p>
</li>
<li>
<p><a href="https://github.com/devonfw/devonfw-testing/wiki/Run-with-full-range-of-resolution">Run with full range of resolution (mobile and desktop): Testing Response Design Webpage</a></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="selenium-test-module.asciidoc_how-to-start">48.2.4. How to start?</h4>
<div class="paragraph">
<p>Read: <a href="https://github.com/devonfw/devonfw-testing/wiki/Building-basic-Selenium-Test">My first Selenium Test</a></p>
</div>
</div>
<div class="sect3">
<h4 id="selenium-test-module.asciidoc_selenium-best-practices">48.2.5. Selenium Best Practices</h4>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/devonfw/devonfw-testing/wiki/Selenium-best-practices">Table of best practices</a></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="selenium-test-module.asciidoc_selenium-uft-comparison">48.2.6. Selenium UFT Comparison</h4>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/devonfw/devonfw-testing/wiki/Selenium-UFT-Comparison">Selenium UFT Comparison</a></p>
</li>
</ul>
</div>
<!-- toc disabled -->
</div>
<div class="sect3">
<h4 id="Building-basic-Selenium-Test.asciidoc">48.2.7. Sample Walkthrough</h4>
<div class="paragraph">
<p>This page will walk you through the process of creating a test case. We&#8217;ll create a very simple test for the Google search engine.</p>
</div>
<div class="sect4">
<h5 id="building-basic-selenium-test.asciidoc_test-procedure">Test Procedure</h5>
<div class="paragraph">
<p>We would like to open the Google search engine, enter some search query and afterwards submit the form. We hope to see some results being listed, otherwise the test will fail. Summarized, the testing process would look like this.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Open google.com</p>
</li>
<li>
<p>Enter the string "Test" into the searchbox</p>
</li>
<li>
<p>Submit the form</p>
</li>
<li>
<p>Get the results and check if the result list is empty</p>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="building-basic-selenium-test.asciidoc_creating-new-packages">Creating new packages</h5>
<div class="paragraph">
<p>We will need two new packages, one for the new page classes, the other one for our test classes.</p>
</div>
<div class="sect5">
<h6 id="building-basic-selenium-test.asciidoc_creating-package-for-test-classes">Creating package for test classes</h6>
<div class="paragraph">
<p>Open Eclipse, use the "Project Explorer" on the left to navigate to</p>
</div>
<div class="paragraph">
<p>mrchecker-app-under-test &#8594; src/test/java &#8594; com.example &#8594; selenium.tests &#8594; tests</p>
</div>
<div class="paragraph">
<p>Right click on "tests", click on "New" &#8594; New Package. We&#8217;ll the new package "com.example.selenium.tests.googleSearch".</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/new-test-class-package.png"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/new-test-class-package.png" alt="Creating a new test class package" width="450"></a>
</div>
</div>
</div>
<div class="sect5">
<h6 id="building-basic-selenium-test.asciidoc_creating-package-for-page-classes">Creating package for page classes</h6>
<div class="paragraph">
<p>Navigate to</p>
</div>
<div class="paragraph">
<p>mrchecker-app-under-test &#8594; src/main/java &#8594; com.example &#8594; selenium &#8594; pages</p>
</div>
<div class="paragraph">
<p>Right click on "pages", click on "New" &#8594; New Package. The new package will be called "com.example.selenium.pages.googleSearch".</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/new-page-class-package.png"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/new-page-class-package.png" alt="Creating a new page class package" width="450"></a>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="building-basic-selenium-test.asciidoc_creating-the-test-class">Creating the test class</h5>
<div class="paragraph">
<p>The test class will contain the entire testing-routine. At first, we&#8217;ll create a new class inside of our newly created "googleSearch" package (under src/test/java) and call it "GoogleSearchTest".</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/new-test-class.png"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/new-test-class.png" alt="Creating a new test class" width="450"></a>
</div>
</div>
<div class="paragraph">
<p>As "GoogleSearchTest" is a test class, it has to extend the <em>BaseTest</em> class. You may have to import some required packages and afterwards include a few required methods.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class GoogleSearchTest extends BaseTest {

	@Override
	public void setUp() {

	}

	@Override
	public void tearDown() {

	}
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now, we&#8217;ll need a new Page object, which will represent the Google Search page. The page class will be named "GoogleSearchPage".</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">private GoogleSearchPage googleSearchPage;

@Override
public void setUp() {
	googleSearchPage = new GoogleSearchPage();
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="building-basic-selenium-test.asciidoc_creating-the-googlesearchpage-class">Creating the GoogleSearchPage class</h5>
<div class="paragraph">
<p>We created a new field for the GoogleSearchPage class and instantiated an object in the <em>setUp()</em> method. As this class doesn&#8217;t exist yet, we&#8217;ll have to create it inside of the googleSearch page class package.</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/new-page-class.png"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/new-page-class.png" alt="Creating a new page class" width="450"></a>
</div>
</div>
<div class="paragraph">
<p>We extend the GoogleSearchPage class with <em>BasePage</em>, import all necessary packages and include all required methods.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class GoogleSearchPage extends BasePage {

	@Override
	public boolean isLoaded() {
		return false;
	}

	@Override
	public void load() {

	}

	@Override
	public String pageTitle() {
		return "";
	}

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>As this page class represents the Google homepage, we have to set up selectors for web elements required in our test case.
In our example we have to create a selector for the search bar which we&#8217;ll interact with. The selector will be implemented as a field.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">private static final By selectorGoogleSearchInput = By.css(#lst-ib);</code></pre>
</div>
</div>
<div class="paragraph">
<p>The input field&#8217;s id <em>#lst-ib</em> was found by using the developer console in Google Chrome.</p>
</div>
<div class="paragraph">
<p>This selector can be used to create a WebElement object of said search bar. Therefore, we&#8217;ll create a new method and call it "enterGoogleSearchInput".</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public GoogleResultPage enterGoogleSearchInput(String searchText) {
	WebElement googleSearchInput = getDriver().findDynamicElement(selectorGoogleSearchInput);
	googleSearchInput.sendKeys(searchText);
	googleSearchInput.submit();

	return new GoogleResultPage();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see, we return another page object that wasn&#8217;t yet created. This step is required, as the results that we would like to check are on another Google Page. This means we&#8217;ll have to create another page class, which will be shown later.</p>
</div>
<div class="paragraph">
<p>Finally, the empty methods inherited from the BasePage class have to be filled:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Override
public boolean isLoaded() {
	if(getDriver().getTitle().equals(pageTitle())) {
		return true;
	}
	return false;
}

@Override
public void load() {
	getDriver().get("http://google.com");
}

@Override
public String pageTitle() {
	return "Google";
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The method <em>isLoaded()</em> checks if the page was loaded by comparing the actual title with the expected title provided by the method <em>pageTitle()</em>. The <em>load()</em> method simply loads a given URL, in this case <em><a href="http://google.com" class="bare">http://google.com</a></em>.</p>
</div>
<div class="paragraph">
<p>The completion of these methods finalizes our <em>GoogleSearchPage</em> class. Now we still have to create the <em>GoogleResultPage</em> class mentioned before. This page will deal with the elements on the Google search result page.</p>
</div>
</div>
<div class="sect4">
<h5 id="building-basic-selenium-test.asciidoc_creating-the-googleresultpage-class">Creating the GoogleResultPage class</h5>
<div class="paragraph">
<p>By right-clicking on the "pages" package, we&#8217;ll navigate to "new" &#8594; "Class" to create a new class.</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/new-result-page-class.png"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/new-result-page-class.png" alt="Creating the GoogleResultPage class" width="450"></a>
</div>
</div>
<div class="paragraph">
<p>The <em>GoogleResultPage</em> class also has to extend <em>BasePage</em> and include all required methods. Next, a new selector for the result list will be created. By using the result list, we can finally check if the result count is bigger than zero and the search request therefore was successful.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">private static final By selectorResultList = By.cssSelector("#res");</code></pre>
</div>
</div>
<div class="paragraph">
<p>We&#8217;ll use this selector inside a new <em>getter</em>-method, which will return all ListElements.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public ListElements getResultList() {
	return getDriver().elementList(selectorResultList);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This method will allow the testcase to simply get the result list and afterwards check if the list is empty or not.</p>
</div>
<div class="paragraph">
<p>Finally, we have to complete all inherited methods.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Override
public boolean isLoaded() {
	getDriver().waitForPageLoaded();
	if(getDriver().getCurrentUrl().contains("search")) {
		return true;
	}
	return false;
}

@Override
public void load() {
	BFLogger.logError("Google result page was not loaded.");
}

@Override
public String getTitle() {
	return "";
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The method <em>isLoaded()</em> differs from the same method in <em>GoogleSearchPage</em>, because this site is being loaded as a result from a previous action. That&#8217;s why we&#8217;ll have to use the method <em>getDriver().waitForPageLoaded()</em> to be certain, that the page was loaded completely. Afterwards we check if the current URL contains the term "search", as it only occurs on the result page. This way we can check if we&#8217;re on the right page.</p>
</div>
<div class="paragraph">
<p>Another result of this page being loaded by another object, we don&#8217;t have to load any specific URL. We just add a BFLogger instance to print an error message if the page was not successfully loaded.</p>
</div>
<div class="paragraph">
<p>As we don&#8217;t use the <em>getTitle()</em> method we simply return an empty String.</p>
</div>
<div class="paragraph">
<p>Finally, all required page classes are complete and we can finalize the test class.</p>
</div>
</div>
<div class="sect4">
<h5 id="building-basic-selenium-test.asciidoc_finalizing-the-test-class">Finalizing the test class</h5>
<div class="paragraph">
<p>At this point, our GoogleSearchTest class looks like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class GoogleSearchTest {

	private GoogleSearchPage googleSearchPage;


	@Override
	public void setUp() {
		googleSearchPage = new GoogleSearchPage();
	}

	@Override
	public void tearDown() {

	}
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Next up, we&#8217;ll create the test method, let&#8217;s call it <em>shouldResultReturn()</em>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Test
public void shouldResultReturn() {
	GoogleResultPage googleResultPage = googleSearchPage.enterGoogleSearchInput("Test");
	ListElements results = googleResultPage.getResultList();
	assertTrue("Number of results equals 0", results.getSize() &gt; 0);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Code explanation: At first, we will run the <em>enterGoogleSearchInput()</em> method on the GoogleSearchPage with the parameter "Test" to search for this exact string on Google. As this method returns a GoogleResultPage object, we will store this in the local variable <em>googleResultPage</em>.
Afterwards, we get the result list by utilizing the getter method that we created before. Finally, we create an assertion: We expect the list size to be bigger than zero, meaning that the google search query was successful as we received results. If this assertion is wrong, a message will be printed out, stating that the number of results equals zero.</p>
</div>
<div class="paragraph">
<p>We can run the test by right clicking on the test method &#8594; Run as &#8594; JUnit test.</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/run-test.png"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/run-test.png" alt="Running the test method" width="450"></a>
</div>
</div>
<div class="paragraph">
<p>After starting the test, you&#8217;ll notice a browser window opening, resizing to given dimensions, opening Google, entering the query "Test" and submitting the form. After completing the test, you&#8217;ll see the test results on the right side of Eclipse. A green color indicator means that the test was successful, red means the test failed.</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/test-output.png"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/test-output.png" alt="Test output" width="450"></a>
</div>
</div>
<div class="paragraph">
<p>This walkthrough should&#8217;ve provided you with the basic understanding on how the framework can be used to create test cases.</p>
</div>
<!-- toc disabled -->
</div>
</div>
</div>
<div class="sect2">
<h3 id="WebAPI-test-module.asciidoc">48.3. WebAPI Test Module</h3>

</div>
<div class="sect2">
<h3 id="WebAPI-test-module.asciidoc">48.4. Service Virtualization</h3>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/devonfw/devonfw-testing/wiki/What-is-service-virtualization">What is service virtualization</a></p>
</li>
<li>
<p><a href="https://github.com/devonfw/devonfw-testing/wiki/How-plug-in-service-virtualization-into-Application-Under-Test">How plug in service virtualization into Application Under Test</a></p>
</li>
<li>
<p><a href="https://github.com/devonfw/devonfw-testing/wiki/How-to-make-virtual-asset">How to make virtual asset</a></p>
</li>
<li>
<p><a href="https://github.com/devonfw/devonfw-testing/wiki/Smoke-Tests-virtualization">Smoke Tests virtualization</a></p>
</li>
</ul>
</div>
<!-- toc disabled -->
</div>
<div class="sect2">
<h3 id="Security-test-module.asciidoc">48.5. Security Test Module</h3>
<div class="sect3">
<h4 id="security-test-module.asciidoc_what-is-security">48.5.1. What is Security?</h4>
<div class="paragraph">
<p>Application Security is concerned with <strong>Integrity</strong>, <strong>Availability</strong> and <strong>Confidentiality</strong> of data processed, stored and transferred by the application.</p>
</div>
<div class="paragraph">
<p>Application Security is a cross-cutting concern which touches every aspect of the Software Development Lifecycle. You can introduce some SQL injection flaws in your application and make it exploitable, but you can also expose your secrets due to poor secret management process (which will have nothing to do with code itself), and fail as well.</p>
</div>
<div class="paragraph">
<p>Because of this, and many other reasons, not every aspect of security can be automatically verified. Manual tests and audits will be still needed. Nevertheless, every security requirement which are automatically verified, will prevent code degeneration and misconfiguration in a continuous manner.</p>
</div>
</div>
<div class="sect3">
<h4 id="security-test-module.asciidoc_how-to-test-security">48.5.2. How to test Security?</h4>
<div class="paragraph">
<p>Security tests can be performed in many different ways like:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Static Code Analysis</strong> - improves the security by (usually) automated code review. Good way to search after vulnerabilities, which are 'obvious' on the code level (like e.g. SQL injection). The downside is that the professional tools to perform such scans are very expensive and still produce many false positives.</p>
</li>
<li>
<p><strong>Dynamic Code Analysis</strong> - tests are run against a working environment. Good way to search after vulnerabilities, which require all client- and server-side components to be present and running (like e.g. Cross-Site Scripting). Tests are performed in a semi-automated manner and require a proxy tool (like e.g. OWASP ZAP)</p>
</li>
<li>
<p><strong>Unit tests</strong> - self written and maintained tests. They work usually on the HTTP/REST level (as this defines the trust boundary between the client and the server) and run against a working environment. Unit tests are best suited to verify requirements which involve business knowledge of the system or which assure secure configuration on the HTTP level.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In the current release of the Security Module the main focus will be <strong>Unit Tests</strong>.</p>
</div>
<div class="paragraph">
<p>Although the most common choice of environment for security tests to run on will be <strong>integration</strong> (as the environment offers the right stability and should mirror the production closely), it is not uncommon for some security tests to run on production as well. This is done for e.g. TLS configuration testing to ensure proper configuration of the most relevant environment in a continuous manner.</p>
</div>
</div>
<div class="sect3">
<h4 id="security-test-module.asciidoc_scope-definition">48.5.3. Scope definition</h4>
<!-- toc disabled -->
</div>
</div>
<div class="sect2">
<h3 id="Database-test-module.asciidoc">48.6. Database Test Module</h3>
<div class="sect3">
<h4 id="database-test-module.asciidoc_what-is-mr.-checker-database-test-module">48.6.1. What is Mr. Checker Database Test Module</h4>
<div class="paragraph">
<p>Database module is based on Object-Relational Mapping programming technique. All functionalities are build using Java Persistence API but examples use Hibernate as a main provider.</p>
</div>
</div>
<div class="sect3">
<h4 id="database-test-module.asciidoc_jpa-structure-schema">48.6.2. JPA structure schema</h4>
<div class="paragraph">
<p>This module was written to allow the use of any JPA provider. Structure is represented by schema below.</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/database/JPA-structure-schema-ver4.PNG"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/database/JPA-structure-schema-ver4.PNG" alt="What is Mr. Checker Database Test Module" width="750"></a>
</div>
</div>
</div>
<div class="sect3">
<h4 id="database-test-module.asciidoc_orm-representation-applied-in-framework">48.6.3. ORM representation applied in Framework</h4>
<div class="imageblock">
<div class="content">
<a class="image" href="images/database/Structure-of-ORM.PNG"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/database/Structure-of-ORM.PNG" alt="What is Mr. Checker Database Test Module" width="650"></a>
</div>
</div>
<!-- toc disabled -->
</div>
</div>
<div class="sect2">
<h3 id="Mobile-test-module.asciidoc">48.7. Mobile Test Module</h3>
<!-- toc disabled -->
</div>
<div class="sect2">
<h3 id="Standalone-test-module.asciidoc">48.8. Standalone Test Module</h3>
<!-- toc disabled -->
</div>
<div class="sect2">
<h3 id="DevOps-module.asciidoc">48.9. DevOps Module</h3>
<div class="sect3">
<h4 id="devops-module.asciidoc_what-is-devops-for-us">48.9.1. What is DevOps for us?</h4>
<div class="paragraph">
<p>DevOps consists of a mixture of three key components in a technical project:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>People skills and mindset</p>
</li>
<li>
<p>Processes</p>
</li>
<li>
<p>Tools</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>By using <strong>E2E Mr Checker Test Framework</strong> it is possible to cover the majority of these areas.</p>
</div>
</div>
<div class="sect3">
<h4 id="devops-module.asciidoc_qa-team-goal">48.9.2. QA Team Goal</h4>
<div class="paragraph">
<p>For QA engineers, it is essential to take care of the product code quality.</p>
</div>
<div class="paragraph">
<p>Therefore, we have to understand, that a <strong>test case is also a code which has to be validated</strong> against quality gates.
As a result, we must <strong>test our developed test case</strong> alike it is done during standard Software Delivery Life Cycle.</p>
</div>
</div>
<div class="sect3">
<h4 id="devops-module.asciidoc_well-rounded-test-case-production-process">48.9.3. Well rounded test case production process</h4>
<div class="ulist">
<ul>
<li>
<p>How do we define top notch test cases development process in <strong>E2E Mr Checker Test Framework</strong></p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="image/devops/TC_develop_process.png"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/devops/TC_develop_process.png" alt="TC Development Process" width="450"></a>
</div>
</div>
</div>
<div class="sect3">
<h4 id="devops-module.asciidoc_continuous-integration-ci-and-continuous-delivery-cd">48.9.4. Continuous Integration (CI) and Continuous Delivery (CD)</h4>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/devonfw/devonfw-testing/wiki/continuous-integration">Continuous Integration (CI)</a> - procedure where quality gates validate test case creation process</p>
</li>
<li>
<p><a href="https://github.com/devonfw/devonfw-testing/wiki/continuous-delivery">Continuous Delivery (CD)</a> - procedure where we include as smoke/regression/security created test cases, validated against CI</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/ci-cd.png"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/ci-cd.png" alt="CI/CD" width="450"></a>
</div>
</div>
</div>
<div class="sect3">
<h4 id="devops-module.asciidoc_what-should-you-receive-from-this-devops-module">48.9.5. What should you receive from this DevOps module</h4>
<div class="imageblock">
<div class="content">
<a class="image" href="images/devops/DevOps_infrastructure.png"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/devops/DevOps_infrastructure.png" alt="DevOps infrastructure" width="450"></a>
</div>
</div>
</div>
<div class="sect3">
<h4 id="devops-module.asciidoc_what-will-you-gain-with-our-devops-module">48.9.6. What will you gain with our DevOps module</h4>
<div class="paragraph">
<p>The CI procedure has been divided into transparent modules. This solution makes configuration and maintenance very easy because everyone is able to manage versions and customize the configuration independently for each module. A separate security module ensures the protection of your credentials and assigned access roles regardless of changes in other modules.</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/devops/Superior_CI_ingredients.png"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/devops/Superior_CI_ingredients.png" alt="Superior CI Ingredients" width="450"></a>
</div>
</div>
<div class="paragraph">
<p>Your CI process will be matched to the current project. You can easily go back to the previous configuration, test a new one or move a selected one to other projects.</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/devops/Setup_your_own_proven_CI.png"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/devops/Setup_your_own_proven_CI.png" alt="Setup your own proven CI" width="450"></a>
</div>
</div>
<div class="paragraph">
<p>DevOps module supports a delivery model in which executors are made available to the user as needed. It has advantages such as:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Saving computing resources</p>
</li>
<li>
<p>Eliminating guessing on your infrastructure capacity needs</p>
</li>
<li>
<p>Not spending time on running and maintaining additional executors</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/devops/Traditional_jenkins_infrastructure.png"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/devops/Traditional_jenkins_infrastructure.png" alt="Traditional Jenkins Infrastructure" width="450"></a>
</div>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/devops/On_demand_jenkins_infrastructure.png"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/devops/On_demand_jenkins_infrastructure.png" alt="On demand Jenkins Infrastructure" width="450"></a>
</div>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/devops/Devops_module_benefit.png"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/devops/Devops_module_benefit.png" alt="Devops module benefit" width="450"></a>
</div>
</div>
</div>
<div class="sect3">
<h4 id="devops-module.asciidoc_how-to-build-this-devops-module">48.9.7. How to build this DevOps module</h4>
<div class="paragraph">
<p>If you want to install the module, please click the link below.
Installation should not take more than a few minutes</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/devonfw/devonfw-testing/wiki/How-to-build-this-DevOps-module">DevOps module installation</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Once you have implemented the module, you can learn more about:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/devonfw/devonfw-testing/wiki/Building-jobs-&amp;-running-builds">Building jobs &amp; Running builds</a></p>
</li>
<li>
<p><a href="https://github.com/devonfw/devonfw-testing/wiki/Docker-commands">Docker commands</a></p>
</li>
</ul>
</div>
<!-- toc disabled -->
</div>
<div class="sect3">
<h4 id="continuous-integration.asciidoc">48.9.8. Continuous Integration</h4>
<div class="paragraph">
<p>Embrace quality with Continuous Integration while you produce test case/s.</p>
</div>
<div class="sect4">
<h5 id="continuous-integration.asciidoc_overview">Overview</h5>
<div class="paragraph">
<p>There are two ways to set up your Continuous Integration environment:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create a Jenkins instance from scratch (e.g. by using the Jenkins Docker image)</p>
<div class="paragraph">
<p>Using a clean Jenkins instance requires the installation of additional plugins. The plugins required and their versions can be found on <a href="https://github.com/devonfw/devonfw-testing/wiki/jenkins-plugins">this page</a>.</p>
</div>
</li>
<li>
<p>Use thre pre-configured custom Docker image provided by us</p>
<div class="paragraph">
<p>No more additional configurations is required (but optional) using this custom Docker image. Additionally, this Jenkins setup allows to be dynamically scaled across multiple machines and even the cloud (AWS, Azure, Google Cloud etc.).</p>
</div>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="continuous-integration.asciidoc_jenkins-overview">Jenkins Overview</h5>
<div class="paragraph">
<p>Jenkins is an Open Source Continuous Integration Tool. It allows the user to create automated build jobs which will run remotely on so called <em>Jenkins Slaves</em>. A build job can be triggered by several events, for example on new pull request on specified repositories or timed (e.g. at midnight).</p>
</div>
<div class="sect5">
<h6 id="continuous-integration.asciidoc_jenkins-configuration">Jenkins Configuration</h6>
<div class="paragraph">
<p>Tests created by using the testing framework can be easily implemented on a Jenkins instance. The following chapter will describe such a job configuration. If you&#8217;re running your own Jenkins instance you may have to install additional plugins listed on the page <a href="https://github.com/devonfw/devonfw-testing/wiki/jenkins-plugins">Jenkins Plugins</a> for a trouble-free integration of your tests.</p>
</div>
<div class="sect6">
<h7 id="continuous-integration.asciidoc_initial-configuration">Initial Configuration</h7>
<div class="paragraph">
<p>The test job is configured as a so-called <em>parametrized</em> job. This means, after starting the job, parameters can be specified, which will then be used in the build process. In this case, <em>branch</em> and <em>testname</em> will be expected when starting the job. These parameters specify which branch in the code repository should be checked out (possibly feature branch) and the name of the test, that should be executed.</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/jenkins-parameterized.png"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/jenkins-parameterized.png" alt="Parameterized Jenkins Job" width="450"></a>
</div>
</div>
</div>
<div class="sect6">
<h7 id="continuous-integration.asciidoc_build-process-configuration">Build Process Configuration</h7>
<div class="ulist">
<ul>
<li>
<p>The first step inside the build process configuration is to get the author of the commit that was made. The mail will be extracted and gets stored in a file called <em>build.properties</em>. This way, the author can be notified if the build fails.</p>
<div class="imageblock">
<div class="content">
<a class="image" href="images/jenkins-build-1.png"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/jenkins-build-1.png" alt="Extracting Author Information" width="450"></a>
</div>
</div>
</li>
<li>
<p>Next up, Maven will be used to check if the code can be compiled, without running any tests.</p>
<div class="imageblock">
<div class="content">
<a class="image" href="images/jenkins-build-2.png"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/jenkins-build-2.png" alt="Testing if code can be compiled" width="450"></a>
</div>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>After making sure that the code can be compiled, the actual tests will be executed.</p>
</div>
<div class="paragraph">
<p>+
image::images/jenkins-build-3.png["Starting the actual tests", width="450", link="images/jenkins-build-3.png"]</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Finally, reports will be generated.</p>
<div class="imageblock">
<div class="content">
<a class="image" href="images/jenkins-build-4.png"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/jenkins-build-4.png" alt="Generating Reports" width="450"></a>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect6">
<h7 id="continuous-integration.asciidoc_post-build-configuration">Post Build Configuration</h7>
<div class="ulist">
<ul>
<li>
<p>At first, the results will be imported to the <a href="https://github.com/devonfw/devonfw-testing/wiki/Allure-report#allure-reports">Allure System</a></p>
<div class="imageblock">
<div class="content">
<a class="image" href="images/jenkins-post-1.png"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/jenkins-post-1.png" alt="Reporting test results to Allure" width="450"></a>
</div>
</div>
</li>
<li>
<p>JUnit test results will be reported as well. Using this step, the test result trend graph will be displayed on the Jenkins job overview.</p>
<div class="imageblock">
<div class="content">
<a class="image" href="images/jenkins-post-2.png"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/jenkins-post-2.png" alt="Reporting JUnit test reports" width="450"></a>
</div>
</div>
</li>
<li>
<p>Finally, an E-Mail will be sent to the previously extracted author of the commit.</p>
<div class="imageblock">
<div class="content">
<a class="image" href="images/jenkins-post-3.png"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/jenkins-post-3.png" alt="Sending mail on failure" width="450"></a>
</div>
</div>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="continuous-integration.asciidoc_using-the-pre-configured-custom-docker-image">Using the Pre-Configured Custom Docker Image</h5>
<div class="paragraph">
<p>If you are starting a new Jenkins instance for your tests, we&#8217;d suggest to use the pre-configured Docker image. This image already contains all configurations and additional features.</p>
</div>
<div class="paragraph">
<p>The configurations that are made are e.g. Plugins and Pre-Installed job setup samples. This way, you don&#8217;t have to set up the entire CI-Environment from ground up.</p>
</div>
<div class="paragraph">
<p>The additional features from this docker image allow the dynamic creation and deletion of Jenkins slaves, by creating Docker containers. Also, Cloud Solutions can be implemented to allow wide-spread load balancing.</p>
</div>
<!-- toc disabled -->
</div>
</div>
<div class="sect3">
<h4 id="continuous-delivery.asciidoc">48.9.9. Continuous Delivery</h4>
<div class="paragraph">
<p>Include quality with Continuous Delivery during product release.
image::images/devops/CD.png["CD", width="450", link="image/devops/CD.png"]</p>
</div>
<div class="sect4">
<h5 id="continuous-delivery.asciidoc_overview">Overview</h5>
<div class="paragraph">
<p>CD from Jenkins point of view does not change a lot from Continuous Integration one.</p>
</div>
</div>
<div class="sect4">
<h5 id="continuous-delivery.asciidoc_jenkins-overview">Jenkins Overview</h5>
<div class="paragraph">
<p>For Jenkins CD setup please use the same Jenkins settings as for CI <a href="https://github.com/devonfw/devonfw-testing/wiki/continuous-integration#jenkins-configuration">link</a>
The only difference is:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>What type of test you we will execute. Before we have been picking test case(s), however now we will choose test suite(s)</p>
</li>
<li>
<p>Who will will trigger given Smoke/Integration/Performance job</p>
</li>
<li>
<p>What is the name of official branch. This branch ought to use be used always in every CD execution. It will be either <strong>master</strong>, or <strong>develop</strong>.</p>
</li>
</ul>
</div>
<div class="sect5">
<h6 id="continuous-delivery.asciidoc_jenkins-for-smoke-tests">Jenkins for Smoke Tests</h6>
<div class="paragraph">
<p>In point where we input test name - $TESTNAME ( <a href="https://github.com/devonfw/devonfw-testing/wiki/continuous-integration#initial-configuration">link</a> ), please input test suite which merge by tags -( <a href="https://github.com/devonfw/devonfw-testing/wiki/tags-and-test-suites">link</a> ) how to all test cases need to run only smoke tests.</p>
</div>
</div>
<div class="sect5">
<h6 id="continuous-delivery.asciidoc_jenkins-for-performance-tests">Jenkins for Performance Tests</h6>
<div class="paragraph">
<p>Under construction - added when WebAPI module is included.</p>
</div>
<!-- toc disabled -->
</div>
</div>
</div>
<div class="sect3">
<h4 id="Selenium-Grid.asciidoc">48.9.10. Selenium Grid</h4>
<div class="sect4">
<h5 id="selenium-grid.asciidoc_what-is-selenium-grid">What is Selenium Grid</h5>
<div class="paragraph">
<p>Selenium Grid allows running web/mobile browsers test cases to fulfil bedrock factors, such as:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Independence infrastructure, similar to end-users</p>
</li>
<li>
<p>Scalable infrastructure (\~50 simultaneous sessions at once)</p>
</li>
<li>
<p>Huge variety of web browsers (from mobile to desktop)</p>
</li>
<li>
<p>Continuous Integration and Continuous Delivery process</p>
</li>
<li>
<p>Support multi-type programming languages  (java, javascript, python, &#8230;&#8203;).</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/seleniumgrid/Slide2.PNG"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/seleniumgrid/Slide2.PNG" alt="Selenium Grid" width="450"></a>
</div>
</div>
<div class="paragraph">
<p>On a daily basis, a test automation engineer uses his local environments for test case execution/development.
However, created browser test case has to be able to run on any other infrastructure. Selenium Grid enables this portability for us.</p>
</div>
</div>
<div class="sect4">
<h5 id="selenium-grid.asciidoc_selenium-grid-structure">Selenium Grid Structure</h5>
<div class="imageblock">
<div class="content">
<a class="image" href="images/seleniumgrid/Slide7.PNG"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/seleniumgrid/Slide7.PNG" alt="Selenium Grid Structure" width="450"></a>
</div>
</div>
<div class="paragraph">
<p>Full documentation for Selenium Grid can be found here: <a href="https://github.com/SeleniumHQ/selenium">here</a> and <a href="http://docs.seleniumhq.org/docs/07_selenium_grid.jsp">here</a>.</p>
</div>
<div class="paragraph">
<p>'Vanilla flavour' Selenium Grid is based on two, not too complicated, ingredients:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><strong>Selenium Hub</strong>  - as one machine, accepting connections to grid from test cases executors. It also plays a managerial role in connection to/from Selenium Nodes</p>
</li>
<li>
<p><strong>Selenium Node</strong> - from one to many machines, where on each machine a browser used during test case execution is installed.</p>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="selenium-grid.asciidoc_how-to-setup">How to setup</h5>
<div class="paragraph">
<p>There are two options of Selenium Grid setup:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Classic</strong>, static solution - <a href="http://docs.seleniumhq.org/docs/07_selenium_grid.jsp#installation">link</a></p>
</li>
<li>
<p><strong>Cloud</strong>, scalable solution - <a href="https://bitbucket.org/lukasz_stefaniszyn/seleniumgriddockercompose/overview">link</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Advantages and disadvantages of both solutions:</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/seleniumgrid/Slide6.PNG"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/seleniumgrid/Slide6.PNG" alt="Pros and Cons" width="450"></a>
</div>
</div>
</div>
<div class="sect4">
<h5 id="selenium-grid.asciidoc_how-to-use-selenium-grid-with-e2e-mr-checker-test-frameworks">How to use Selenium Grid with E2E Mr Checker Test Frameworks</h5>
<div class="paragraph">
<p>Run following command either in Eclipse or in Jenkins:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">&gt; mvn test -Dtest=com.capgemini.ntc.selenium.tests.samples.resolutions.ResolutionTest -DseleniumGrid="http://10.40.232.61:4444/wd/hub" -Dos=LINUX -Dbrowser=chrome</code></pre>
</div>
</div>
<div class="paragraph">
<p>As a result of this command:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>-Dtest=com.capgemini.ntc.selenium.features.samples.resolutions.ResolutionTest</em> - name of test case to execute</p>
</li>
<li>
<p><em>-DseleniumGrid="http://10.40.232.61:4444/wd/hub"</em>   -  IP address of Selenium Hub</p>
</li>
<li>
<p><em>-Dos=LINUX</em> - what operating system must be taken during test case execution</p>
</li>
<li>
<p><em>-Dbrowser=chrome</em> - what type of browser will be used during test case execution</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/seleniumgrid/SeleniumGrid_Example.png"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/seleniumgrid/SeleniumGrid_Example.png" alt="Selenium Grid Example" width="450"></a>
</div>
</div>
<!-- toc disabled -->
</div>
</div>
<div class="sect3">
<h4 id="Docker-commands.asciidoc">48.9.11. What is Docker</h4>
<div class="paragraph">
<p>Docker - open source software platform to create, deploy and manage virtualized application containers on a common operating system (OS), with an ecosystem of allied tools.</p>
</div>
</div>
<div class="sect3">
<h4 id="Docker-commands.asciidoc">48.9.12. Where do we use Docker</h4>
<div class="paragraph">
<p>DevOps module consists of Docker images</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Jenkins image</p>
</li>
<li>
<p>Jenkins job image</p>
</li>
<li>
<p>Jenkins management image</p>
</li>
<li>
<p>Security image</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>in addition, each new node is also based on the Docker</p>
</div>
</div>
<div class="sect3">
<h4 id="Docker-commands.asciidoc">48.9.13. Exploring basic Docker options</h4>
<div class="paragraph">
<p>Let&#8217;s expose some of the most important commands that are needed when working with our DevOps module based on the Docker platform. Each command given below should be preceded by a <code>sudo</code> call by default. If you don’t want to use sudo command create a Unix group called docker and add user to it.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>$ sudo groupadd docker
$ sudo usermod -aG docker $USER</code></pre>
</div>
</div>
<div class="sect4">
<h5 id="docker-commands.asciidoc_build-an-image-from-a-dockerfile">Build an image from a Dockerfile</h5>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code># docker build [OPTIONS] PATH | URL | -
#
# Options:
#  --tag , -t : Name and optionally a tag in the ‘name:tag’ format

$ docker build -t vc_jenkins_jobs .</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="docker-commands.asciidoc_container-start">Container start</h5>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code># docker run [OPTIONS] IMAGE[:TAG|@DIGEST] [COMMAND] [ARG...]
#
# Options:
# -d : To start a container in detached mode (background)
# -it : interactive terminal
# --name : assign a container name
# --rm : clean up
# --volumes-from="": Mount all volumes from the given container(s)
# -p : explicitly map a single port or range of ports
# --volume : storage associated with the image

$ docker run -d --name vc_jenkins_jobs vc_jenkins_jobs</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="docker-commands.asciidoc_remove-one-or-more-containers">Remove one or more containers</h5>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code># docker rm [OPTIONS] CONTAINER
#
# Options:
# --force , -f : Force the removal of a running container

$ docker rm -f jenkins</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="docker-commands.asciidoc_list-containers">List containers</h5>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code># docker ps [OPTIONS]
# --all, -a : Show all containers (default shows just running)

$ docker ps</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="docker-commands.asciidoc_pull-an-image-or-a-repository-from-a-registry">Pull an image or a repository from a registry</h5>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code># docker pull [OPTIONS] NAME[:TAG|@DIGEST]

$ docker pull jenkins/jenkins:2.73.1</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="docker-commands.asciidoc_push-the-image-or-a-repository-to-a-registry">Push the image or a repository to a registry</h5>
<div class="paragraph">
<p>Pushing new image takes place in two steps. First save image by adding container ID to commit command and next use push:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code># docker push [OPTIONS] NAME[:TAG]

$ docker ps
  # copy container ID from the result
$ docker commit b46778v943fh vc_jenkins_mng:project_x
$ docker push vc_jenkins_mng:project_x</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="docker-commands.asciidoc_return-information-on-docker-object">Return information on Docker object</h5>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code># docker inspect [OPTIONS] NAME|ID [NAME|ID...]
#
# Options:
# --format , -f : output format

$ docker inspect -f '{{ .Mounts }}' vc_jenkins_mng</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="docker-commands.asciidoc_list-images">List images</h5>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code># docker images [OPTIONS] [REPOSITORY[:TAG]]
#
# Options:
--all , -a : show all images with intermediate images

$ docker images
$ docker images jenkins</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="docker-commands.asciidoc_remove-one-or-more-images">Remove one or more images</h5>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code># docker rmi [OPTIONS] IMAGE [IMAGE...]
#
# Options:
#   --force , -f : Force removal of the image

$ docker rmi jenkins/jenkins:latest</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="docker-commands.asciidoc_run-a-command-in-a-running-container">Run a command in a running container</h5>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code># docker exec [OPTIONS] CONTAINER COMMAND [ARG...]
# -d : run command in the background
# -it : interactive terminal
# -w : working directory inside the container
# -e : Set environment variables

$ docker exec vc_jenkins_jobs sh -c "chmod 755 config.xml"</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="Docker-commands.asciidoc">48.9.14. Advanced commands</h4>
<div class="sect4">
<h5 id="docker-commands.asciidoc_remove-dangling-images">Remove dangling images</h5>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>$ docker rmi $(docker images -f dangling=true -q)</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="docker-commands.asciidoc_remove-all-images">Remove all images</h5>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>$ docker rmi $(docker images -a -q)</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="docker-commands.asciidoc_removing-images-according-to-a-pattern">Removing images according to a pattern</h5>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>$ docker images | grep "pattern" | awk '{print $2}' | xargs docker rm</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="docker-commands.asciidoc_remove-all-exited-containers">Remove all exited containers</h5>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>$ docker rm $(docker ps -a -f status=exited -q)</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="docker-commands.asciidoc_remove-all-stopped-containers">Remove all stopped containers</h5>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>$ docker rm $(docker ps --no-trunc -aq)</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="docker-commands.asciidoc_remove-containers-according-to-a-pattern">Remove containers according to a pattern</h5>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>$ docker ps -a | grep "pattern" | awk '{print $1}' | xargs docker rmi</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="docker-commands.asciidoc_remove-dangling-volumes">Remove dangling volumes</h5>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>$ docker volume rm $(docker volume ls -f dangling=true -q)</code></pre>
</div>
</div>
<!-- toc disabled -->
</div>
</div>
<div class="sect3">
<h4 id="How-to-build-DevOps-module.asciidoc">48.9.15. How to build DevOps module</h4>
<div class="sect4">
<h5 id="how-to-build-devops-module.asciidoc_prerequisites">Prerequisites</h5>
<div class="ulist">
<ul>
<li>
<p>64-bit Linux operating server system (recommended: Ubuntu 16.04 LTS server - <a href="https://www.ubuntu.com/download/server/thank-you?version=16.04.3&amp;architecture=amd64">Download</a></p>
</li>
<li>
<p>Non-root user with sudo privileges (the default user created during the operating system installation process)</p>
</li>
<li>
<p>Docker - open source software platform to create, deploy and manage virtualized application containers on a common operating system (OS), with an ecosystem of allied tools.</p>
</li>
<li>
<p>git - version control system software to clone module code</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="how-to-build-devops-module.asciidoc_docker-service-installation">Docker service installation</h5>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>$  curl -fsSL get.docker.com -o get-docker.sh

$  sh get-docker.sh</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="how-to-build-devops-module.asciidoc_git-installation">Git installation</h5>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>$  sudo apt-get install git</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="how-to-build-devops-module.asciidoc_creating-special-system-users">Creating special system users</h5>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>$  sudo useradd -M jenkins

$  sudo usermod -L jenkins

$  sudo usermod -a -G docker jenkins</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="how-to-build-devops-module.asciidoc_cloning-the-repository">Cloning the repository</h5>
<div class="paragraph">
<p>Check Your current directory, create a new for DevOps module in /home/&lt;YourUserName&gt;. Open it and enter git clone command</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>$  pwd
   /home/&lt;YourUserName&gt;/
$  mkdir dev_ops_module
$  cd dev_ops_module
$  pwd
   /home/&lt;YourUserName&gt;/dev_ops_module
$  git clone https://bitbucket.org/lukasz_stefaniszyn/jenkinsdockercompose.git</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="how-to-build-devops-module.asciidoc_enabling-docker-remote-api">Enabling Docker remote API</h5>
<div class="paragraph">
<p>Enable Docker remote API - By default, due to security reasons, Docker runs via a non-networked Unix socket. This solution allows only local communication. The Docker daemon in Ubuntu 16.04 is configured by the system, so You need to modify file <code>/lib/systemd/system/docker.service</code>. You&#8217;ll enable the access to the Docker daemon from specific IP address.</p>
</div>
<div class="paragraph">
<p>Allow port communication:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>$  sudo ufw allow 4243/tcp
$  sudo ufw allow 32000:33000/tcp</code></pre>
</div>
</div>
<div class="paragraph">
<p>Open file docker service and replace variable <code>ExecStart</code> value:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>$  sudo nano /lib/systemd/system/docker.service
#
# Find variable ExecStart and change value to: /usr/bin/dockerd -H tcp://0.0.0.0:4243 -H unix:///var/run/docker.sock
#

$  ExecStart=/usr/bin/dockerd -H tcp://0.0.0.0:4243 -H unix:///var/run/docker.sock</code></pre>
</div>
</div>
<div class="paragraph">
<p>Finish editing this file: Nano: <code>Ctrl + X</code> and <code>Y</code> Vi: <code>Esc + wq</code></p>
</div>
<div class="paragraph">
<p>Restart deamon and docker service:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>$  sudo systemctl daemon-reload
$  sudo service docker restart</code></pre>
</div>
</div>
<div class="paragraph">
<p>Please, test the configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>$  curl --noproxy GET http://127.0.0.1:4243/version</code></pre>
</div>
</div>
<div class="paragraph">
<p>The answer should be similar to the one shown in the picture:</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/devops/Api_version_test.png"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/devops/Api_version_test.png" alt="Api version test" width="450"></a>
</div>
</div>
</div>
<div class="sect4">
<h5 id="how-to-build-devops-module.asciidoc_jenkins-with-docker">Jenkins with Docker</h5>
<div class="paragraph">
<p>Execute commands:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>$  sudo apt-get upgrade -y
$  sudo apt-get install -y sudo libltdl-dev
$  GID=$(cut -d: -f3 &lt; &lt;(getent group docker))</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="How-to-build-DevOps-module.asciidoc">48.9.16. Running module</h4>
<div class="paragraph">
<p>Open JenkinsDockerCompose directory and print the path by <code>pwd</code> command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>$ pwd
/home/&lt;YourUserName&gt;/dev_ops_module
$ cd jenkinsdockercompose
$ pwd
/home/&lt;YourUserName&gt;/dev_ops_module/jenkinsdockercompose/</code></pre>
</div>
</div>
<div class="paragraph">
<p>Let&#8217;s edit a configuration file <code>create_and_run.sh</code>. You can use default system text editors such as "nano" or "vi":</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>$ nano create_and_run.sh</code></pre>
</div>
</div>
<div class="paragraph">
<p>Replace variable value in the second line with the path previously displayed: <code>/home/&lt;YourUserName&gt;/dev_ops_module/jenkinsdockercompose/</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>1  echo "Set global variables"
2  REPO_HOME=/home/&lt;DefaultUserName&gt;/dev_ops_module/jenkinsdockercompose/</code></pre>
</div>
</div>
<div class="paragraph">
<p>Finish editing this file: Nano: <code>Ctrl + X</code> and <code>Y</code> Vi: <code>Esc + wq</code> and run the script:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>$ sudo ./create_and_run.sh</code></pre>
</div>
</div>
<div class="paragraph">
<p>Wait until the end of the building process. It can take a few minutes. What happened there?</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Setting global variables</p>
</li>
<li>
<p>Removing older docker images (if they exist)</p>
</li>
<li>
<p>Building jenkins_home_security image</p>
</li>
<li>
<p>Building jenkins_home_jobs image</p>
</li>
<li>
<p>Building jenkins_home_mng image</p>
</li>
<li>
<p>Start Jenkins</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Run web browser with address <code><a href="http://&lt;server-ip-address&gt;:8080" class="bare">http://&lt;server-ip-address&gt;:8080</a></code>. If the configuration is correct, the Jenkins main page will be displayed.</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/devops/Jenkins_main_page.png"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/devops/Jenkins_main_page.png" alt="Jenkins main page" width="450"></a>
</div>
</div>
<div class="sect4">
<h5 id="how-to-build-devops-module.asciidoc_configuring-slaves">Configuring slaves</h5>
<div class="paragraph">
<p>Login as jenkins admin and run web browser with address <code><a href="http://&lt;server-ip-address&gt;:8080/configure" class="bare">http://&lt;server-ip-address&gt;:8080/configure</a></code></p>
</div>
<div class="paragraph">
<p>Find API ip address option and change it to <code><a href="http://&lt;server-ip-address&gt;:4243" class="bare">http://&lt;server-ip-address&gt;:4243</a></code></p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/devops/Jenkins_api_gui_test.PNG"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/devops/Jenkins_api_gui_test.PNG" alt="Jenkins api gui test" width="450"></a>
</div>
</div>
<!-- toc disabled -->
</div>
</div>
<div class="sect3">
<h4 id="How-to-build-jobs-and-run-builds.asciidoc">48.9.17. Adding a new item</h4>
<div class="paragraph">
<p>The easiest way to create a new job is to use the "new item" option. You can create a whole new item or copy the configuration from an already existing job with changing only the parameters we are interested in.</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/devops/Jobs_menu.png"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/devops/Jobs_menu.png" alt="List of jobs" width="450"></a>
</div>
</div>
<div class="paragraph">
<p>Click "new item" in the menu and next and on the next page enter an item name and choose the type.</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/devops/New_item_name.png"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/devops/New_item_name.png" alt="List of jobs" width="450"></a>
</div>
</div>
<div class="paragraph">
<p>If you want, you can copy an existing configuration:</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/devops/Copy_conf_from_old_job.png"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/devops/Copy_conf_from_old_job.png" alt="List of jobs" width="450"></a>
</div>
</div>
</div>
<div class="sect3">
<h4 id="How-to-build-jobs-and-run-builds.asciidoc">48.9.18. Configuring job</h4>
<div class="paragraph">
<p>Each job can be configured according to your preferences. This is done on the page available in the menu of the job page. Just click on "configure".</p>
</div>
<div class="paragraph">
<p>Load the main page again and next look at the middle of the page. Two job catalogs are displayed there.</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/devops/List_of_jobs.png"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/devops/List_of_jobs.png" alt="List of jobs" width="450"></a>
</div>
</div>
<div class="paragraph">
<p>Click "Training" directory name. You will be taken to a page with a list of available jobs. In the default configuration there are:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>selenium_workshop</p>
</li>
<li>
<p>selenium_workshop_cucumber</p>
</li>
<li>
<p>selenium_workshop_cucumberParallel</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/devops/List_of_training_jobs.png"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/devops/List_of_training_jobs.png" alt="List of training jobs" width="450"></a>
</div>
</div>
<div class="paragraph">
<p>Click on the name - "selenium_workshop". You will be taken to the main page of the selected Job</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/devops/Selenium_workshop_content.png"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/devops/Selenium_workshop_content.png" alt="Selenium workshop content" width="450"></a>
</div>
</div>
<div class="paragraph">
<p>From the menu on the left select "configure".</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/devops/Job_config_page.png"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/devops/Job_config_page.png" alt="Job config page" width="450"></a>
</div>
</div>
<div class="paragraph">
<p>The configuration categories are displayed there:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>General</p>
</li>
<li>
<p>Source Code Management</p>
</li>
<li>
<p>Build Triggers</p>
</li>
<li>
<p>Build Environment</p>
</li>
<li>
<p>Build</p>
</li>
<li>
<p>Post-build Actions</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="How-to-build-jobs-and-run-builds.asciidoc">48.9.19. Running example build</h4>
<div class="paragraph">
<p>Let create the first build. Choose selenium workshop main page again.</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/devops/Selenium_workshop_content.png"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/devops/Selenium_workshop_content.png" alt="Selenium workshop content" width="450"></a>
</div>
</div>
<div class="paragraph">
<p>Click the link "Build with parameters " in the menu on the left. On this page you can choose the configuration of the branch name and the name of the test that will run.</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/devops/Build_with_parameters_page_content.png"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/devops/Build_with_parameters_page_content.png" alt="Build with parameters page content" width="450"></a>
</div>
</div>
<div class="paragraph">
<p>Click the button and see that your build has been targeted.</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/devops/Waiting_for_executor_for_first_build.png"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/devops/Waiting_for_executor_for_first_build.png" alt="Waiting for executor for first build" width="450"></a>
</div>
</div>
<div class="paragraph">
<p>After assigning to him the executor it will be executed.</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/devops/Jenkins_slave_execution_process.png"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/devops/Jenkins_slave_execution_process.png" alt="Jenkins slave execution process" width="450"></a>
</div>
</div>
<div class="paragraph">
<p>It is also possible to preview the build page:</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/devops/Jenkins_after_build_page.png"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/devops/Jenkins_after_build_page.png" alt="Jenkins after build page" width="450"></a>
</div>
</div>
</div>
<div class="sect3">
<h4 id="How-to-build-jobs-and-run-builds.asciidoc">48.9.20. Editing the list of plugins</h4>
<div class="paragraph">
<p>Please, open <code>/home/&lt;YourUserName&gt;/dev_ops_module/jenkinsdockercompose/jenkins_home_mng</code> directory. You should see file  <code>plugins.txt</code> on the list. Please edit it. It is possible to add or remove plugins that interest you.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>$  cd /home/&lt;YourUserName&gt;/dev_ops_module/jenkinsdockercompose/jenkins_home_mng
$  ls
$  nano plugins.txt</code></pre>
</div>
</div>
<div class="paragraph">
<p>Finish editing this file: Nano: <code>Ctrl + X</code> and <code>Y</code> Vi: <code>Esc + wq</code>. After this operation, the application must be restarted:
* <a href="https://github.com/devonfw/devonfw-testing/wiki/How-to-build-this-DevOps-module">DevOps module installation</a></p>
</div>
<div class="paragraph">
<p>The second way is to edit the plugins option in the GUI.</p>
</div>
</div>
<div class="sect3">
<h4 id="How-to-build-jobs-and-run-builds.asciidoc">48.9.21. User management</h4>
<div class="paragraph">
<p>Please, open <code>/home/&lt;YourUserName&gt;/dev_ops_module/jenkinsdockercompose/jenkins_home_security/jenkins_home/users</code> directory. Print content of it by <code>ls</code> command. You should see list of jenkins users.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>$  cd /home/&lt;YourUserName&gt;/dev_ops_module/jenkinsdockercompose/jenkins_home_security/jenkins_home/users
$  ls</code></pre>
</div>
</div>
<div class="sect4">
<h5 id="how-to-build-jobs-and-run-builds.asciidoc_adding-new-user">Adding new user</h5>
<div class="paragraph">
<p>The easiest way to create a new user is to copy his configuration file from one of the existing users and substitute the required options.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code># Please create directory for new user and copy files
#
$  mkdir newUserName
$  cd newUserName
$  cp ../user1/config.xml .
$  ls
#  You should see Your config. Please edit chosen option if You want
$  nano config.xml</code></pre>
</div>
</div>
<div class="paragraph">
<p>Finish editing this file: Nano: <code>Ctrl + X</code> and <code>Y</code></p>
</div>
</div>
<div class="sect4">
<h5 id="how-to-build-jobs-and-run-builds.asciidoc_removing-user">Removing user</h5>
<div class="paragraph">
<p>Open default directory of users again: <code>/home/&lt;YourUserName&gt;/dev_ops_module/jenkinsdockercompose/jenkins_home_security/jenkins_home/users</code>. Choose user name to remove and execute it by Unix <code>rm</code> command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>$  cd /home/&lt;YourUserName&gt;/dev_ops_module/jenkinsdockercompose/jenkins_home_security/jenkins_home/users
$  ls
#  execute commmand : rm -rf &lt;userName&gt;
#  ! Take special care, executing the following command in the wrong directory can cause undesirable effects for other
#  applications or the entire operating system
$  rm -rf user1</code></pre>
</div>
</div>
<!-- toc disabled -->
</div>
</div>
</div>
</div>
</div>
<h1 id="master-my-thai-star.asciidoc" class="sect0">X: MyThaiStar</h1>
<div class="sect1">
<h2 id="agile.asciidoc">49. 1.	My Thai Star – Agile Framework</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="agile.asciidoc_1.1-team-setup">49.1. 1.1 Team Setup</h3>
<div class="paragraph">
<p>The team working on the development of the My Thai Star app and the documentation beside the technical development works distributed in various locations across Germany, the Netherlands, Spain and Poland. For the communication part the team uses the two channels Skype and Mail and for the documentation part the team makes usage mainly of GitHub and Jira.</p>
</div>
</div>
<div class="sect2">
<h3 id="agile.asciidoc_1.2-scrum-events">49.2. 1.2 Scrum events</h3>
<div class="sect3">
<h4 id="agile.asciidoc_sprint-planning">49.2.1. Sprint Planning</h4>
<div class="paragraph">
<p>Within the My Thai Star project we decided on having one hour Sprint Planning meetings for a four-week Sprints. This decision is based on the fact that this project is not the main project of the team members. As the backlog refinement is done during the Sprint Planning we make usage of the planningpoker.com tool for the estimation of the tasks.</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/methodology_01.png"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/methodology_1.png" alt="Screenshot of planningpoker.com" width="450"></a>
</div>
<div class="title">Figure 81. Screenshot of planningpoker.com during Sprint 1 Planning</div>
</div>
<div class="paragraph">
<p>During the Sprint Planning meeting the team receives support from Devon colleagues outside the development. This feedback helps the team to focus on important functionalities and task by keeping the eyes on the overall aim which is to have a working application by the end of June 2017.</p>
</div>
</div>
<div class="sect3">
<h4 id="agile.asciidoc_sprint-review">49.2.2. Sprint Review</h4>
<div class="paragraph">
<p>The Sprint Review meetings are time boxed to one hour for the four week Sprint. Within the Sprint Review meeting the team plans to do a retrospective of the finished Sprint. As well as it is done during the Sprint Planning the team receives support from Devon colleagues.</p>
</div>
</div>
<div class="sect3">
<h4 id="agile.asciidoc_sprint-retrospective">49.2.3. Sprint Retrospective</h4>
<div class="paragraph">
<p>For this project the team aligned on not having a specific Sprint Retrospective meeting. The team is going to have a retrospective of a finished Sprint during the Sprint Review.</p>
</div>
</div>
<div class="sect3">
<h4 id="agile.asciidoc_daily-standups">49.2.4. Daily Standups</h4>
<div class="paragraph">
<p>The team aligned on having two weekly Standup meetings instead of a Daily Standup meeting. In comparison with the time boxed length of 15mins described in the CAF for this project the team extended the Standup meeting to 30mins. The content of the meetings remains the same.</p>
</div>
</div>
<div class="sect3">
<h4 id="agile.asciidoc_backlog-refinement">49.2.5. Backlog refinement</h4>
<div class="paragraph">
<p>The team decided that the backlog refinement meeting is part of the Sprint Planning meeting.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="agile.asciidoc_1.3-establish-product-backlog">49.3. 1.3 Establish Product Backlog</h3>
<div class="paragraph">
<p>For the My Thai Stair project the team decided on using the Jira agile documentation which is one of the widely used agile tools. Jira is equipped with several of useful tools regarding the agile software development (e.g. Scrum-Board). One of the big advantages of Jira are the extensive configuration and personalization possibilities.
With having a list of the Epics and User Stories for the My Thai Star development in GitHub, the team transferred the User Stories into the Jira backlog as it is shown in the screenshot below. All User Stories are labeled colorfully with the related Epic which shapes the backlog in clearly manner.</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/methodology_02.png"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/methodology_2.png" alt="Screenshot of planningpoker.com" width="450"></a>
</div>
<div class="title">Figure 82. Screenshot of the Jira backlog during Sprint 2</div>
</div>
<div class="paragraph">
<p>We decided on working with Subtask as a single user story comprised a number of single and separated tasks. Another benefit of working with subtask is that every single subtask can be assigned to a single team member whereas a user story can only be assigned to one team member. By picking single subtask the whole process of a user story is better organized.</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/methodology_03.png"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/methodology_3.png" alt="Screenshot of Subtasks" width="450"></a>
</div>
<div class="title">Figure 83. Screenshots of Subtasks during Sprint 2</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="agile.asciidoc">50. 2.	My Thai Star – Agile Diary</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In parallel to the Diary Ideation we use this Agile Diary to document our Scrum events. The target of this diary is to describe the differences to the Scrum methodology as well as specific characteristics of the project. We also document the process on how we approach the Scrum methodology over the length of the project.</p>
</div>
<div class="sect2">
<h3 id="agile.asciidoc_24.03.2017-sprint-1-planning">50.1. 24.03.2017 Sprint 1 Planning</h3>
<div class="paragraph">
<p>Within the Sprint 1 Planning we used planning poker.com for the estimation of the user stories. The estimation process usually is part of the backlog refinement meeting. Regarding the project circumstances we decided to estimate the user stories during the Sprint Planning. Starting the estimation process we noticed that we had to align our interpretation of the estimation effort as these story points are not equivalent to a certain time interval. The story points are relative values to compare the effort of the user stories. With this in mind we proceeded with the estimation of the user stories. We decided to start Sprint 1 with the following user stories and the total amount of 37 story points:
•	ICSDSHOW-2	Create invite for friends	(8  Story Points)
•	ICSDSHOW-4	Create reservation		(3)
•	ICSDSHOW-5	Handle invite			(3)
•	ICSDSHOW-6	Revoke accepted invite 	(5)
•	ICSDSHOW-9	Cancel invite			(3)
•	ICSDSHOW-11	Filter menu			(5)
•	ICSDSHOW-12	Define order			(5)
•	ICSDSHOW-13	Order the order		(5)
As the Sprint Planning is time boxed to one hour we managed to hold this meeting within this time window.</p>
</div>
</div>
<div class="sect2">
<h3 id="agile.asciidoc_27.04.2017-sprint-1-review">50.2. 27.04.2017 Sprint 1 Review</h3>
<div class="paragraph">
<p>During the Sprint 1 Review we had a discussion about the data model proposal. For the discussion we extended this particular Review meeting to 90min. As this discussion took almost 2/3 of the Review meeting we only had a short time left for our review of Sprint 1. For the following scrum events we decided to focus on the primary target of these events and have discussions needed for alignments in separate meetings.
Regarding the topic of splitting user stories we had the example of a certain user story which included a functionality of a twitter integration (ICSDSHOW-17 User Profile and Twitter integration). As the twitter functionality could not have been implemented at this early point of time we thought about cutting the user story into two user stories. We aligned on mocking the twitter functionality until the dependencies are developed in order to test the components. As this user story is estimated with 13 story points it is a good example for the question whether to cut a user story into multiple user stories or not.
Unfortunately not all user stories of Sprint 1 could have been completed. Due this situation we discussed on whether pushing all unfinished user stories into the status done or moving them to Sprint 2. We aligned on transferring the unfinished user stories into the next Sprint. During the Sprint 1 the team underestimated that a lot of holidays crossed the Sprint 1 goals. As taking holidays and absences of team members into consideration is part of a Sprint Planning we have a learning effect on setting a Sprint Scope.</p>
</div>
</div>
<div class="sect2">
<h3 id="agile.asciidoc_03.05.2017-sprint-2-planning">50.3. 03.05.2017 Sprint 2 Planning</h3>
<div class="paragraph">
<p>As we aligned during the Sprint 1 Review on transferring unfinished user stories into Sprint 2 the focus for Sprint 2 was on finishing these transferred user stories. During our discussion on how many user stories we could work on in Sprint 2 we needed to remind ourselves that the overall target is to develop an example application for the DevonFW. Considering this we aligned on a clear target for Sprint 2: To focus on finishing User Stories as we need to aim for a practicable and realizable solution. Everybody aligned on the aim of having a working application at the end of Sprint 2.
For the estimation process of user stories we make again usage of planningpoker.com as the team prefers this “easy-to-use” tool. During our second estimation process we had the situation in which the estimated story points differs strongly from one team member to another. In this case the team members shortly explains how the understood and interpreted the user story. It turned out that team members misinterpreted the user stories. With having this discussion all team members got the same understanding of the specific functionality and scope of a user story. After the alignment the team members adjusted their estimations.
Beside this need for discussion the team estimated most of the user stories with very similar story points. This fact shows the increase within the effort estimation for each team member in comparison to Sprint 1 planning. Over the short time of two Sprint planning the team received a better understanding and feeling for the estimation with story points.</p>
</div>
</div>
<div class="sect2">
<h3 id="agile.asciidoc_01.06.2017-sprint-2-review">50.4. 01.06.2017 Sprint 2 Review</h3>
<div class="paragraph">
<p>As our Sprint 1 Review four weeks ago was not completely structured like a Sprint Review meeting we focused on the actual intention of a Sprint Review meeting during Sprint 2 Review. This means we demonstrated the completed and implemented functionalities with screen sharing and the product owner accepted the completed tasks.
Within the User Story ICSDSHOW-22 “See all orders/reservations” the functionality “filtering the list by date” could have not been implemented during Sprint 2. The team was unsure on how to proceed with this task. One team member added that especially in regards of having a coherent release, implementing less but working functionalities is much better than implementing more but not working functionalities. For this the team reminded itself focusing on completing functionalities and not working straight to a working application.</p>
</div>
<!-- toc disabled -->
</div>
</div>
</div>
<div class="sect1">
<h2 id="User-Stories.asciidoc">51. User Stories</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The list of user stories, exported from JIRA, can be downloaded from <a href="#resources/us_export_jira.xlsx">here</a>.</p>
</div>
<div class="sect2">
<h3 id="user-stories.asciidoc_epic-invite-friends">51.1. Epic: Invite friends</h3>
<div class="sect3">
<h4 id="user-stories.asciidoc_us-create-invite-for-friends">51.1.1. US: create invite for friends</h4>
<div class="paragraph">
<p>Epic: Invite friends</p>
</div>
<div class="paragraph">
<p>As a guest I want to create an dinner event by entering date and time and adding potential guests by their emails so that each potential guests receives a email in order to confirm or decline my invite.</p>
</div>
<div class="sect5">
<h6 id="user-stories.asciidoc_acceptance-criteria">Acceptance criteria</h6>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>only date and time in future possible and both required</p>
</li>
<li>
<p>only valid email addresses: <a href="mailto:text@text.xx">text@text.xx</a>, one entered email-address is required</p>
</li>
<li>
<p>if AGB are not checked, an error message is shown</p>
</li>
<li>
<p>after the invite is done</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>I see the confirmation screen of my invite (see wireframe)</p>
</li>
<li>
<p>I receive a confirmation email about my invite containing date, time and invited guests</p>
</li>
<li>
<p>all guests receive a mail with my invite</p>
</li>
</ol>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect3">
<h4 id="user-stories.asciidoc_us-create-reservation">51.1.2. US: create reservation</h4>
<div class="paragraph">
<p>Epic: Invite friends</p>
</div>
<div class="paragraph">
<p>As a guest I want to create a reservation by entering date and time and number of adults and kids</p>
</div>
<div class="sect5">
<h6 id="user-stories.asciidoc_acceptance-criteria">Acceptance criteria</h6>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>only date and time in future possible and both required</p>
</li>
<li>
<p>only valid email addresses: <a href="mailto:text@text.xx">text@text.xx</a>, one entered email-address is required</p>
</li>
<li>
<p>if AGB are not checked, an error message is shown</p>
</li>
<li>
<p>after the reservation is done</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>I see a confirmation screen of my reservation with datetime, number of persons and kids</p>
</li>
<li>
<p>I receive a confirmation email about my reservation</p>
</li>
</ol>
</div>
</li>
</ol>
</div>
</div>
<div class="sect5">
<h6 id="user-stories.asciidoc_wireframes">Wireframes</h6>
<div class="paragraph">
<p>see realtimeboard</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="user-stories.asciidoc_us-handle-invite">51.1.3. US: handle invite</h4>
<div class="paragraph">
<p>As an invited guest I would like to receive an email - after somebody as invited me - with the option to accept or decline the invite so that the system knows about my participation</p>
</div>
<div class="sect5">
<h6 id="user-stories.asciidoc_ac">AC:</h6>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>the mail contains the following information about the invite</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>who has invited</p>
</li>
<li>
<p>who else is invited</p>
</li>
<li>
<p>date and time of the invite</p>
</li>
<li>
<p>button to accept or decline</p>
</li>
<li>
<p>after pressing the buttons the system will store the status (yes/no) of my invite</p>
</li>
</ol>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect3">
<h4 id="user-stories.asciidoc_us-revoke-accepted-invite">51.1.4. US: revoke accepted invite</h4>
<div class="paragraph">
<p>As an invited guest I would like to revoke my previous answer in order to inform the system and the inviter about my no showup</p>
</div>
<div class="sect4">
<h5 id="user-stories.asciidoc_ac">AC:</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>the inviter and myself receives an email about my cancelation</p>
</li>
<li>
<p>the system sets my status of my invite to no</p>
</li>
<li>
<p>in case I have placed an order, the order is also removed from the system.</p>
</li>
<li>
<p>the cancelation is only possible 10 minutes before the event takes place. The system shows a message that cancelation is not possible anymore.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect3">
<h4 id="user-stories.asciidoc_us-calculate-best-table">51.1.5. US: calculate best table</h4>
<div class="paragraph">
<p>As a guest I would like the system to check (1 hour before my invite) all my invites and to reserve a table fitting the number of accepted users</p>
</div>
<div class="sect5">
<h6 id="user-stories.asciidoc_details">Details</h6>
<div class="paragraph">
<p>Pseudo-algorithm for reservation:
Find table for given date and time where seats of guests &gt;= Count of invited guests plus one. In case no results, decline request and show error message to user. In case of any result, make a reservation for table&#8230;&#8203;.
For each decline of a guest remove guest and search with reduced number for new table. In case table is found, reserve it and remove reservation from previous table. In case not, do not change reservations.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="user-stories.asciidoc_us-find-table-by-reservation-info">51.1.6. US: find table by reservation info</h4>
<div class="paragraph">
<p>As a waiter I would like to search by reference number or email address for the reserved table in order to know the table for my visit. (when arriving at the restaurant)</p>
</div>
<div class="sect5">
<h6 id="user-stories.asciidoc_ac">AC:</h6>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>After entering the email the systems shows the number of the table. In case no reservation found, a message is shown.</p>
</li>
<li>
<p>Entered email address could be email of inviter or any invited guest.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect3">
<h4 id="user-stories.asciidoc_us-cancel-invite">51.1.7. US: cancel invite</h4>
<div class="paragraph">
<p>Epic: Invite friends</p>
</div>
<div class="paragraph">
<p>As a guests who has sent an invite I want to be able to cancel my previous invite in order to inform the restaurent and my invited guests that I will not show up</p>
</div>
<div class="sect5">
<h6 id="user-stories.asciidoc_ac">AC:</h6>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>the option to cancel the invite is available in the confirmation-mail about my invite</p>
</li>
<li>
<p>after my cancelation all invited guests receives a mail about the cancelation</p>
</li>
<li>
<p>I see a confirmation that my invite was cancelled successfully</p>
</li>
<li>
<p>after my cancelation my invite and reservation and all orders related to it are deleted from the system and no one can accept or decline any invite for it</p>
</li>
<li>
<p>the cancelation is only possible one hour before the inite takes place. After that I am not allowed to cancel it any more.</p>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="user-stories.asciidoc_epic-digital-menu">51.2. Epic: Digital Menu</h3>
<div class="sect3">
<h4 id="user-stories.asciidoc_us-filter-menu">51.2.1. US: filter menu</h4>
<div class="paragraph">
<p>As a guest I want to filter the menu so that I only see the dishes I am interested in</p>
</div>
<div class="sect5">
<h6 id="user-stories.asciidoc_ac">AC:</h6>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>the guest can filter by</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>type: starter | main dish | dessert; XOR; if nothing is selected all are shown (default value)</p>
</li>
<li>
<p>veggy (yes|no|does not matter (default))</p>
</li>
<li>
<p>vegan (yes|no|does not matter (default))</p>
</li>
<li>
<p>rice (yes|no|does not matter (default))</p>
</li>
<li>
<p>curry (yes|no|does not matter (default))</p>
</li>
<li>
<p>noodle (yes|no|does not matter (default))</p>
</li>
<li>
<p>price (range)</p>
</li>
<li>
<p>ratings (range)</p>
</li>
<li>
<p>my favorite (yes|no|does not matter (default))&#8201;&#8212;&#8201;free text (search in title and description)</p>
</li>
</ol>
</div>
</li>
<li>
<p>the guest can sort by price asc, rating asc</p>
</li>
<li>
<p>after setting the filter only dishes are shown which fulfills those criteria</p>
</li>
<li>
<p>by pressing the button reset filter all filter are reset to the initial value</p>
</li>
<li>
<p>by pressing the filter button the filter is applied [or is it triggered after each change?]</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect3">
<h4 id="user-stories.asciidoc_us-define-order">51.2.2. US: Define order</h4>
<div class="paragraph">
<p>As a guest I want to define my order by selecting dishes from the menu</p>
</div>
<div class="sect5">
<h6 id="user-stories.asciidoc_ac">AC:</h6>
<div class="ulist">
<ul>
<li>
<p>The guest can add each dish to the order</p>
</li>
<li>
<p>In case the guest adds the same dish multiple times, a counter in the order for this dish is increased for this dish</p>
</li>
<li>
<p>The guest can remove the dish from the order</p>
</li>
<li>
<p>The guest can add for each main dish the type of meat (pork, chicken, tofu)</p>
</li>
<li>
<p>The guest can add for each dish a free-text-comment</p>
</li>
<li>
<p>After adding/removing any dish the price is calculated including VAT</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="user-stories.asciidoc_us-order-the-order">51.2.3. US: Order the order</h4>
<div class="paragraph">
<p>As a guest I want to order my selected dishes (order)</p>
</div>
<div class="paragraph">
<p>AC:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>I receive a mail containing my order with all dishes and the final price</p>
</li>
<li>
<p>precondtion for ordering:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Each order must be assocaited with a reservation / invite. Without any reference no order could be placed. The reference could be obtain from a previous reservation/invite (created during same session) or by the previous accepted invite (link in email) or by entering the reference id when asked by the system.</p>
<div class="olist lowerroman">
<ol class="lowerroman" type="i">
<li>
<p>In case precondition is not fullfillied, the guest is asked</p>
<div class="olist upperalpha">
<ol class="upperalpha" type="A">
<li>
<p>whether he/she would like to create a reservation/invite and is forwarded to US Invite Friends. Only after finalizing the reservation the order is accepted.</p>
</li>
<li>
<p>or he/she would enter previous created reservation-id he/she knows in order to associate his/her order with this reservation</p>
</li>
</ol>
</div>
</li>
</ol>
</div>
</li>
</ol>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="user-stories.asciidoc_us-cancel-order">51.2.4. US: Cancel order</h4>
<div class="paragraph">
<p>As a guest I want to cancel my order.</p>
</div>
<div class="paragraph">
<p>AC:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>in my received confirmation mail I have the option to cancel my order</p>
</li>
<li>
<p>the cancelation is only possible one hour before my reservation takes place</p>
</li>
<li>
<p>my order is deleted from the system</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Remark: Changing the order is not possible. For that the order must be canceled and created from scratch again</p>
</div>
</div>
<div class="sect3">
<h4 id="user-stories.asciidoc_us-read-twitter-rating-for-dishes">51.2.5. US: Read twitter rating for dishes</h4>
<div class="paragraph">
<p>As a guest I want to read for all dishes the rating done be twitter because I would like to know the opnion of others</p>
</div>
<div class="paragraph">
<p>AC:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>For each dish I see the latest 3 comments done by twitter for this vote (text, username, avatar)</p>
</li>
<li>
<p>For each dish I see the number of likes done by twitter</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="user-stories.asciidoc_epic-user-profile">51.3. Epic: User Profile</h3>
<div class="sect3">
<h4 id="user-stories.asciidoc_us-user-profile">51.3.1. US: User Profile</h4>
<div class="paragraph">
<p>As a guest I want to have a user profile to associate it with my twitter account to be able to like/rate dishes</p>
</div>
<div class="paragraph">
<p>AC:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Username of my profile is my email address</p>
</li>
<li>
<p>My profile is protected by password</p>
</li>
<li>
<p>I can log in and log out to my profile</p>
</li>
<li>
<p>I can reset my password by triggering the reset by mail</p>
</li>
<li>
<p>I can assocaite my profile with my twitter account in order to rate dishes and store my favorites by liking posts assocaited to dishes</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="user-stories.asciidoc_epic-rate-by-twitter">51.4. Epic: Rate by twitter</h3>
<div class="sect3">
<h4 id="user-stories.asciidoc_us-receive-mail-to-rate-your-dish">51.4.1. US: Receive mail to rate your dish</h4>
<div class="paragraph">
<p>As a guest I want to receive a mail by the system in order to rate my dish</p>
</div>
</div>
<div class="sect3">
<h4 id="user-stories.asciidoc_us-rate-your-dish">51.4.2. US: Rate your dish</h4>
<div class="paragraph">
<p>As a guest I want to add a comment or a like via my twitter account for a dish</p>
</div>
<div class="paragraph">
<p>AC:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Before I write my rate I would like to be able to read all tweets of other users for this dihs</p>
</li>
<li>
<p>I would like to see the number of likes for a dish</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="user-stories.asciidoc_epic-waiter-cockpit">51.5. Epic: Waiter Cockpit</h3>
<div class="sect3">
<h4 id="user-stories.asciidoc_us-see-all-ordersreservations">51.5.1. US: See all orders/reservations</h4>
<div class="paragraph">
<p>As a waiter I want to see all orders/reservation in order to know what is going on in my restaurant</p>
</div>
<div class="paragraph">
<p>AC:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>all orders/reservations are shown in a list view (read-only). Those list can be filtered and sorted (similar to excel-data-filters)</p>
</li>
<li>
<p>orders/reservations are shown in seperate lists.</p>
</li>
<li>
<p>for each order the dish, meat, comment, item, reservation-id, reservation datetime, creation-datetime is shown</p>
</li>
<li>
<p>for each reservation the inviters email, the guests-emails, the number of accepts and declines, calculated table number, the reservation-id, reservation date-time and creation-datetime are shown</p>
</li>
<li>
<p>the default filter for all lists is the todays date for reservation datetime. this filter can be deleted.</p>
</li>
<li>
<p>only reservations and orders with reservation date in the future shall be available in this view. All other orders and reservation shall not be deleted; for data analytics those orders and reservation shall still exisit in the system.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>checklist:</p>
</div>
<div class="paragraph">
<p>talk about:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>who?</p>
</li>
<li>
<p>what?</p>
</li>
<li>
<p>why (purpose)</p>
</li>
<li>
<p>why (objective)</p>
</li>
<li>
<p>what happens outside the software</p>
</li>
<li>
<p>what might go wrong</p>
</li>
<li>
<p>any question or assumptions (write them down) , DoR should check that those sections are empty.</p>
</li>
<li>
<p>is there any better solution?</p>
</li>
<li>
<p>how (technical perspective)</p>
</li>
<li>
<p>do a rough estimate</p>
</li>
<li>
<p>check INVEST</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="master-my-thai-star.asciidoc_technical-design">52. Technical design</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="master-my-thai-star.asciidoc_data-model">52.1. Data Model</h3>
<div class="sect3">
<h4 id="My-Thai-Star-data-model.asciidoc">52.1.1. Data Model</h4>
<div class="imageblock">
<div class="content">
<a class="image" href="images/mts_datamodel.png"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/mts_datamodel.png" alt="mts datamodel"></a>
</div>
</div>
</div>
<div class="sect3">
<h4 id="my-thai-star-nosql-data-model.asciidoc">52.1.2. NoSQL Data Model</h4>
<div class="imageblock">
<div class="content">
<a class="image" href="images/nodejs/dynamodb-data-model-1.4.1.png"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/nodejs/dynamodb-data-model-1.4.1.png" alt="dynamodb data model 1.4.1"></a>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="master-my-thai-star.asciidoc_server-side">52.2. Server Side</h3>
<!-- toc disabled -->
<div class="sect3">
<h4 id="java-design.asciidoc">52.2.1. Java design</h4>
<div class="sect4">
<h5 id="java-design.asciidoc_introduction">Introduction</h5>
<div class="paragraph">
<p>The Java backend for My Thai Star application is going to be based on:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>DEVON4J</strong> as the Java framework</p>
</li>
<li>
<p><strong>Devonfw</strong> as the Development environment</p>
</li>
<li>
<p><strong>Cobigen</strong> as code generation tool</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To know more details about the above technologies please visit the following documentation:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/devonfw/devon4j/wiki">DEVON4J</a></p>
</li>
<li>
<p><a href="https://github.com/devonfw/devon/wiki">Devonfw</a></p>
</li>
<li>
<p><a href="https://github.com/devonfw/tools-cobigen/wiki">Cobigen</a></p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="java-design.asciidoc_basic-architecture-details">Basic architecture details</h5>
<div class="paragraph">
<p>Following the DEVON4J conventions the Java My Thai Star backend is going to be developed dividing the application in <em>Components</em> and using a three layers architecture.</p>
</div>
<div class="sect5">
<h6 id="java-design.asciidoc_project-modules">Project modules</h6>
<div class="paragraph">
<p>Using the DEVON4J approach for the Java backend project we will have a structure of a <em>Maven</em> project formed by three projects</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/java/project_modules.png"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/java/project_modules.png" alt="project modules"></a>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><em>api</em>: Stores all the REST interfaces and corresponding Request/Response objects.</p>
</li>
<li>
<p><em>core</em>: Stores all the logic and functionality of the application.</p>
</li>
<li>
<p><em>server</em>: Configures the packaging of the application.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>We can automatically generate this project structure <a href="https://github.com/devonfw/devon/wiki/getting-started-creating-new-devonfw-application#running-the-archetype">using the DEVON4J <em>Maven</em> archetype</a></p>
</div>
</div>
<div class="sect5">
<h6 id="java-design.asciidoc_components">Components</h6>
<div class="paragraph">
<p>The application is going to be divided in different components to encapsulate the different domains of the application functionalities.</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/java/mtsj_components.png"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/java/mtsj_components.png" alt="mtsj components"></a>
</div>
</div>
<div class="paragraph">
<p>As <em>main components</em> we will find:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>Bookingmanagement</em>: Manages the bookings part of the application. With this component the users (anonymous/logged in) can create new bookings or cancel an existing booking. The users with waiter role can see all scheduled bookings.</p>
</li>
<li>
<p><em>Ordermanagement</em>: This component handles the process to order dishes (related to bookings). A user (as a host or as a guest) can create orders (that contain dishes) or cancel an existing one. The users with waiter role can see all ordered orders.</p>
</li>
<li>
<p><em>Dishmanagement</em>: This component groups the logic related to the menu (dishes) view. Its main feature is to provide the client with the data of the available dishes but also can be used by other components (Ordermanagement) as a data provider in some processes.</p>
</li>
<li>
<p><em>Usermanagement</em>: Takes care of the User Profile management, allowing to create and update the data profiles.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>As <em>common components</em> (that don&#8217;t exactly represent an application&#8217;s area but provide functionalities that can be used by the <em>main components</em>):</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>Imagemanagement</em>: Manages the images of the application. In a first approach the <em>Dishmanagement</em> component and the <em>Usermanagement</em> component will have an image as part of its data. The <em>Imagemanagement</em> component will expose the functionality to store and retrieve this kind of data.</p>
</li>
<li>
<p><em>Mailservice</em>: with this service we will provide the functionality for sending email notifications. This is a shared service between different app components such as <em>bookingmanagement</em> or <em>ordercomponent</em>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Other components:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Security (will manage the access to the <em>private</em> part of the application using a <a href="https://jwt.io/">jwt</a> implementation).</p>
</li>
<li>
<p>Twitter integration: planned as a <em>Microservice</em> will provide the twitter integration needed for some specific functionalities of the application.</p>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="java-design.asciidoc_layers">Layers</h6>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/devonfw/devon4j/wiki/guide-service-layer">Service Layer</a>: this layer will expose the REST api to exchange information with the client applications.</p>
</li>
<li>
<p><a href="https://github.com/devonfw/devon4j/wiki/guide-logic-layer">Logic Layer</a>: the layer in charge of hosting the business logic of the application.</p>
</li>
<li>
<p><a href="https://github.com/devonfw/devon4j/wiki/guide-dataaccess-layer">Data Access Layer</a>: the layer to communicate with the data base.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This architecture is going to be reflected dividing each component of the application in different packages to match those three layers.</p>
</div>
</div>
<div class="sect5">
<h6 id="java-design.asciidoc_component-structure">Component structure</h6>
<div class="paragraph">
<p>Each one of the components defined previously are going to be structured using the <em>three-layers</em> architecture. In each case we will have a <em>service</em> package, a <em>logic</em> package and a <em>dataaccess</em> package to fit the layers definition.</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/java/component_structure.png"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/java/component_structure.png" alt="component structure"></a>
</div>
</div>
</div>
<div class="sect5">
<h6 id="java-design.asciidoc_dependency-injection">Dependency injection</h6>
<div class="paragraph">
<p>As it is explained in the <a href="https://github.com/devonfw/devon4j/wiki/guide-dependency-injection">devonfw documentation</a> we are going to implement the <em>dependency injection</em> pattern basing our solution on <em>Spring</em> and the Java standards: <em>java.inject</em> (JSR330) combined with JSR250.</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/java/dependency_injection.png"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/java/dependency_injection.png" alt="dependency injection"></a>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Separation of API and implementation: Inside each layer we will separate the elements in different packages: <em>api</em> and <em>impl</em>. The <em>api</em> will store the <em>interface</em> with the methods definition and inside the <em>impl</em> we will store the class that implements the <em>interface</em>.</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/java/layer_api_impl.png"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/java/layer_api_impl.png" alt="layer api impl"></a>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Usage of JSR330: The Java standard set of annotations for <em>dependency injection</em> (<code>@Named</code>, <code>@Inject</code>, <code>@PostConstruct</code>, <code>@PreDestroy</code>, etc.) provides us with all the needed annotations to define our beans and inject them.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Named
public class MyBeanImpl implements MyBean {
  @Inject
  private MyOtherBean myOtherBean;

  @PostConstruct
  public void init() {
    // initialization if required (otherwise omit this method)
  }

  @PreDestroy
  public void dispose() {
    // shutdown bean, free resources if required (otherwise omit this method)
  }
}</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="java-design.asciidoc_layers-communication">Layers communication</h6>
<div class="paragraph">
<p>The connection between layers, to access to the functionalities of each one, will be solved using the <em>dependency injection</em> and the JSR330 annotations.</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/java/layers_impl.png"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/java/layers_impl.png" alt="layers impl"></a>
</div>
</div>
<div class="paragraph">
<p><strong>Connection Service - Logic</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Named("DishmanagementRestService")
public class DishmanagementRestServiceImpl implements DishmanagementRestService {

  @Inject
  private Dishmanagement dishmanagement;

  // use the 'this.dishmanagement' object to access to the functionalities of the logic layer of the component

  ...

}</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Connection Logic - Data Access</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Named
public class DishmanagementImpl extends AbstractComponentFacade implements Dishmanagement {

  @Inject
  private DishDao dishDao;

  // use the 'this.dishDao' to access to the functionalities of the data access layer of the component
  ...

}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="java-design.asciidoc_service-layer">Service layer</h5>
<div class="paragraph">
<p>The services layer will be solved using REST services with the <a href="https://github.com/devonfw/devon4j/wiki/guide-rest#jax-rs">JAX-RS implementation</a>.</p>
</div>
<div class="paragraph">
<p>To give service to the defined <em>User Stories</em> we will need to implement the following services:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>provide all available dishes.</p>
</li>
<li>
<p>save a booking.</p>
</li>
<li>
<p>save an order.</p>
</li>
<li>
<p>provide a list of bookings (only for waiters) and allow filtering.</p>
</li>
<li>
<p>provide a list of orders (only for waiters) and allow filtering.</p>
</li>
<li>
<p>login service (see the <em>Security</em> section).</p>
</li>
<li>
<p>provide the <em>current user</em> data (see the <em>Security</em> section)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Following the <a href="https://github.com/devonfw/devon4j/wiki/guide-rest">naming conventions</a> proposed for <em>Devon4j</em> applications we will define the following <em>end points</em> for the listed services.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>(POST) <code>/mythaistar/services/rest/dishmanagement/v1/dish/search</code>.</p>
</li>
<li>
<p>(POST) <code>/mythaistar/services/rest/bookingmanagement/v1/booking</code>.</p>
</li>
<li>
<p>(POST) <code>/mythaistar/services/rest/ordermanagement/v1/order</code>.</p>
</li>
<li>
<p>(POST) <code>/mythaistar/services/rest/bookingmanagement/v1/booking/search</code>.</p>
</li>
<li>
<p>(POST) <code>/mythaistar/services/rest/ordermanagement/v1/order/search</code>.</p>
</li>
<li>
<p>(POST) <code>/mythaistar/services/rest/ordermanagement/v1/order/filter</code> (to filter with fields that does not belong to the Order entity).</p>
</li>
<li>
<p>(POST) <code>/mythaistar/login</code>.</p>
</li>
<li>
<p>(GET) <code>/mythaistar/services/rest/security/v1/currentuser/</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can find all the details for the services implementation in the <a href="https://github.com/devonfw/my-thai-star/blob/develop/swagger/mythaistar.yaml">Swagger definition</a> included in the My Thai Star project on Github.</p>
</div>
<div class="sect5">
<h6 id="java-design.asciidoc_service-api">Service api</h6>
<div class="paragraph">
<p>The <em>api.rest</em> package in the <em>service</em> layer of a <em>component</em> will store the definition of the service by a  <em>Java interface</em>. In this definition of the service we will set-up the <em>endpoints</em> of the service, the type of data expected and returned, the <em>HTTP</em> method for each endpoint of the service and other configurations if needed.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Path("/dishmanagement/v1")
@Consumes(MediaType.APPLICATION_JSON)
@Produces(MediaType.APPLICATION_JSON)
public interface DishmanagementRestService {

  @GET
  @Path("/dish/{id}/")
  public DishCto getDish(@PathParam("id") long id);

  ...

}</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="java-design.asciidoc_service-impl">Service impl</h6>
<div class="paragraph">
<p>Once the service <em>api</em> is defined we need to implement it using the <em>Java interface</em> as reference. We will add the <em>service implementation</em> class to the <em>impl.rest</em> package and implement the <em>RestService interface</em>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Named("DishmanagementRestService")
public class DishmanagementRestServiceImpl implements DishmanagementRestService {

  @Inject
  private Dishmanagement dishmanagement;

  @Override
  public DishCto getDish(long id) {
    return this.dishmanagement.findDish(id);
  }

  ...

}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>You can see the Devon4j conventions for REST services <a href="https://github.com/devonfw/devon4j/wiki/guide-rest">here</a>. And the My Thai Star services definition <a href="https://github.com/devonfw/my-thai-star/blob/develop/swagger/mythaistar.yaml">here</a> as part of the <a href="https://github.com/devonfw/my-thai-star">My Thai Star</a> project.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect4">
<h5 id="java-design.asciidoc_logic-layer">Logic layer</h5>
<div class="paragraph">
<p>In the <em>logic</em> layer we will locate all the <em>business logic</em> of the application. We will keep the same schema as we have done for the <em>service</em> layer, having an <em>api</em> package with the definition of the methods and a <em>impl</em> package for the implementation.</p>
</div>
<div class="paragraph">
<p>Also, inside the <em>api</em> package, a <em>to</em> package will be the place to store the <a href="https://github.com/devonfw/devon4j/wiki/guide-transferobject"><em>transfer objects</em></a> needed to pass data through the layers of the component.</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/java/logic_layer.png"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/java/logic_layer.png" alt="logic layer"></a>
</div>
</div>
<div class="paragraph">
<p>The logic <em>api</em> definition:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public interface Dishmanagement {

  DishCto findDish(Long id);

  ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The logic <em>impl</em> class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Named
public class DishmanagementImpl extends AbstractComponentFacade implements Dishmanagement {

  @Inject
  private DishDao dishDao;


  @Override
  public DishCto findDish(Long id) {

    return getBeanMapper().map(this.dishDao.findOne(id), DishCto.class);
  }

  ...

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <em>BeanMapper</em> will provide the needed transformations between <em>entity</em> and <em>transfer objects</em>.</p>
</div>
<div class="paragraph">
<p>Also, the <em>logic</em> layer is the place to add validation for <em>Authorization</em> based on <em>roles</em> as we will see later.</p>
</div>
</div>
<div class="sect4">
<h5 id="java-design.asciidoc_data-access-layer">Data Access layer</h5>
<div class="paragraph">
<p>The data-access layer is responsible for managing the connections to access and process data. The mapping between java objects to a relational database is done in <em>Devon4j</em> with the <a href="https://spring.io/projects/spring-data-jpa">spring-data-jpa</a>.</p>
</div>
<div class="paragraph">
<p>As in the previous layers, the <em>data-access</em> layer will have both <em>api</em> and <em>impl</em> packages. However, in this case, the implementation will be slightly different. The <em>api</em> package will store the <em>component</em> main <em>entities and, inside the _api</em> package, another <em>api.repo</em> package will store the Repositories. The <em>repository</em> interface will extend <code>DefaultRepository</code> interface (located in <code>com.devonfw.module.jpa.dataaccess.api.data</code> package of <a href="http://repo1.maven.org/maven2/com/devonfw/java/starters/devon4j-starter-spring-data-jpa/3.0.0/">devon4j-starter-spring-data-jpa</a> ).</p>
</div>
<div class="paragraph">
<p>For queries we will differentiate between <em>static queries</em> (that will be located in a mapped file) and <em>dynamic queries</em> (implemented with <a href="http://www.querydsl.com/">QueryDsl</a>). You can find all the details about how to manage queries with <em>Devon4j</em> <a href="https://github.com/devonfw/devon4j/wiki/guide-jpa-query">here</a>.</p>
</div>
<div class="paragraph">
<p>The default data base included in the project will be the <a href="http://www.h2database.com/html/main.html">H2</a> instance included with the <em>Devon4j</em> projects.</p>
</div>
<div class="paragraph">
<p>To get more details about <em>pagination</em>, <em>data base security, _concurrency control</em>, <em>inheritance</em> or how to solve the different <em>relationships</em> between entities visit the official <a href="https://github.com/devonfw/devon4j/wiki/guide-dataaccess-layer">devon4j dataaccess documentation</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="java-design.asciidoc_sap-hana">SAP Hana</h5>
<div class="sect5">
<h6 id="java-design.asciidoc_downloadinstall-vmwaresap-hana">Download/Install Vmware/SAP hana</h6>
<div class="ulist">
<ul>
<li>
<p>Download VMware Workstation Player to run SAP Hana database <a href="https://www.vmware.com/in/products/workstation-player/workstation-player-evaluation.html" class="bare">https://www.vmware.com/in/products/workstation-player/workstation-player-evaluation.html</a></p>
</li>
<li>
<p>Install VMware and open. Using VMware browse check if you can find hxe.ova file. This file is not visible through windows explorer. This is the SAP Hana Express Edition image to be run inside VMware. If available open it in VMware. Otherwise, download Download Manager for SAP Hana from the link below. It may ask to register which is a simple process.
<a href="https://www.sap.com/cmp/ft/crm-xu16-dat-hddedft/typ.html" class="bare">https://www.sap.com/cmp/ft/crm-xu16-dat-hddedft/typ.html</a></p>
</li>
<li>
<p>Run the download manager and on the screen use the defaults and click download.</p>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="java-design.asciidoc_run-sap-hana-database-server">Run SAP Hana Database Server</h6>
<div class="ulist">
<ul>
<li>
<p>Once the .ova file has been opened inside VMware workstation. Click on the image and go to Edit Virtual Machine Settings. Set the memory allocation to 5GB. And Network Connection to NAT . NAT shows the IP for the virtual machine which will be used to establish JDBC connection</p>
</li>
<li>
<p>Click Play Virtual Machine. When first time the virtual machine runs it display following. Copy the IP address which will be used for JDBC connection</p>
</li>
<li>
<p>Type hxeadm, which is the username and hit Enter. Next it will ask for password which is HXEHana1. Once successfully logged in it will ask to set a new password. Choose a new password and remember.</p>
</li>
<li>
<p>You need to set Master password for SAP Hana database. Set it as you like and remember.</p>
</li>
<li>
<p>For “proceed with configuration” type y and hit Enter. Hana database has started in the background.</p>
</li>
<li>
<p>Try connecting with following command, replace the password with the master password</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>hxehost:hxeadm&gt;hdbsql
   \c -d SYSTEMDB -n localhost:39013 -u SYSTEM -p &lt;&gt;</pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="java-design.asciidoc_setting-up-database-for-mtsj">Setting up Database for MTSJ</h6>
<div class="paragraph">
<p>Once you have install SAP hana with VMware , you need to setup the DB.</p>
</div>
</div>
<div class="sect5">
<h6 id="java-design.asciidoc_connect-to-db">Connect to DB</h6>
<div class="ulist">
<ul>
<li>
<p>After you start Vmware, login with hxeadm as login and the password.
At the prompt  - hxehost:hxeadm&gt;hdbsql
Please note the IP address, that need to be put in mtsj java backend</p>
</li>
<li>
<p>On prompt hdbsql&gt; type below to connect to the DB</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>\c -d SYSTEMDB -n localhost:39013 -u SYSTEM -p &lt;password&gt;</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Type below query to see, if you have access to tenant database i.e. HXE</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>SELECT DATABASE_NAME,  ACTIVE_STATUS FROM SYS.M_DATABASES ORDER BY 1;</pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="java-design.asciidoc_enabling-the-script-server">Enabling the script server</h6>
<div class="paragraph">
<p>Run the below for enabling the script server</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sql hljs" data-lang="sql">ALTER DATABASE HXE ADD 'scriptserver'</code></pre>
</div>
</div>
<div class="paragraph">
<p>To check if the script server is enable, execute below statement</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sql hljs" data-lang="sql">SELECT SERVICE_NAME, PORT, ACTIVE_STATUS FROM SYS.M_SERVICES ORDER BY 1;</code></pre>
</div>
</div>
<div class="paragraph">
<p>It should see the scriptserver in it.</p>
</div>
</div>
<div class="sect5">
<h6 id="java-design.asciidoc_creating-a-user-on-hxe">Creating a User on HXE</h6>
<div class="ulist">
<ul>
<li>
<p>Connect using the below</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>\c -d hxe -n localhost:39013 -u system -p &lt;password&gt;</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>To create a user</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>Create user hanauser1 password &lt;password&gt; no force_first_password_change</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Grant below permission to the user</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>GRANT AFLPM_CREATOR_ERASER_EXECUTE TO hanauser1
GRANT AFL__SYS_AFL_AFLPAL_EXECUTE TO hanauser1 – here we have 2 underscore
grant AFL__SYS_AFL_AFLPAL_EXECUTE_WITH_GRANT_OPTION to hanauser1
grant AFLPM_CREATOR_ERASER_EXECUTE to hanauser
GRANT DATA ADMIN TO hanauser1
GRANT IMPORT TO hanauser1

GRANT EXECUTE on _SYS_REPO.GRANT_ACTIVATED_ROLE TO hanauser1
GRANT EXECUTE ON system.afl_wrapper_generator to hanauser1

GRANT EXECUTE ON system.afl_wrapper_eraser to hanauser1
GRANT MODELING TO hanauser1</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Now connect to HXE tenant using below</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>\c -d hxe -n localhost:39013 -u hanauser1 -p &lt;password&gt;</pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="java-design.asciidoc_setting-up-mtsj-java-backend">Setting up MTSJ Java backend</h6>
<div class="ulist">
<ul>
<li>
<p>Update applicaion.properties file</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties"># update the below
spring.flyway.locations=classpath:db/migration,classpath:db/specific/hana
# Add the below
spring.jpa.database=default
spring.jpa.database-platform=org.hibernate.dialect.HANAColumnStoreDialect
spring.datasource.driver-class-name=com.sap.db.jdbc.Driver
spring.jpa.properties.hibernate.jdbc.lob.non_contextual_creation=true

#Comment the below
#spring.profiles.active=h2mem

spring.profiles.active=hana</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Update config/applicaion.properties file</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties"># update the below
spring.flyway.locations=classpath:db/migration,classpath:db/specific/hana
spring.datasource.url=jdbc:sap://ip:port/?databaseName=hxe
spring.datasource.username=username
spring.datasource.password=password</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="java-design.asciidoc_enabling-prediction-usecase-in-mtsj">Enabling prediction usecase in MTSJ</h6>
<div class="ulist">
<ul>
<li>
<p>Please refer link <a href="https://github.com/devonfw/my-thai-star/wiki/angular-design" class="bare">https://github.com/devonfw/my-thai-star/wiki/angular-design</a> to enable prediction in gui</p>
</li>
<li>
<p>Setting up data for Predictive use case, please refer to <a href="https://github.com/SAP/hana-my-thai-star-data-generator" class="bare">https://github.com/SAP/hana-my-thai-star-data-generator</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect4">
<h5 id="java-design.asciidoc_security-with-json-web-token">Security with Json Web Token</h5>
<div class="paragraph">
<p>For the <em>Authentication</em> and <em>Authorization</em> the app will implement the <a href="https://jwt.io/">json web token</a> protocol.</p>
</div>
<div class="sect5">
<h6 id="java-design.asciidoc_jwt-basics">Jwt basics</h6>
<div class="ulist">
<ul>
<li>
<p>A user will provide a username / password combination to our auth server.</p>
</li>
<li>
<p>The auth server will try to identify the user and, if the credentials match, will issue a token.</p>
</li>
<li>
<p>The user will send the token as the <em>Authorization</em> header to access resources on server protected by JWT Authentication.</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/java/jwt_schema.png"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/java/jwt_schema.png" alt="jwt schema"></a>
</div>
</div>
</div>
<div class="sect5">
<h6 id="java-design.asciidoc_jwt-implementation-details">Jwt implementation details</h6>
<div class="paragraph">
<p>The <em>Json Web Token</em> pattern will be implemented based on the <a href="https://docs.spring.io/spring-security/site/docs/current/reference/htmlsingle/"><em>Spring Security</em></a> framework that is provided by default in the <em>Devon4j</em> projects.</p>
</div>
<div class="sect6">
<h7 id="java-design.asciidoc_authentication">Authentication</h7>
<div class="paragraph">
<p>Based on the <em>Spring Security</em> approach, we will implement a class extending <em>WebSecurityConfigurerAdapter</em> (<em>Devon4j</em> already provides the <em>BaseWebSecurityConfig</em> class) to define the security <em>entry point</em> and filters. Also, as <em>My Thai Star</em> is a mainly <em>public</em> application, we will define here the resources that won&#8217;t be secured.</p>
</div>
<div class="paragraph">
<p>List of <em>unsecured resources</em>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>/services/rest/dishmanagement/**</em>: to allow anonymous users to see the dishes info in the <em>menu</em> section.</p>
</li>
<li>
<p><em>/services/rest/ordermanagement/v1/order</em>: to allow anonymous users to save an order. They will need a <em>booking token</em> but they won&#8217;t be authenticated to do this task.</p>
</li>
<li>
<p><em>/services/rest/bookingmanagement/v1/booking</em>: to allow anonymous users to create a booking. Only a <em>booking token</em> is necessary to accomplish this task.</p>
</li>
<li>
<p><em>/services/rest/bookingmanagement/v1/booking/cancel/**</em>: to allow cancelling a booking from an email. Only the <em>booking token</em> is needed.</p>
</li>
<li>
<p><em>/services/rest/bookingmanagement/v1/invitedguest/accept/**</em>: to allow guests to accept an invite. Only a <em>guest token</em> is needed.</p>
</li>
<li>
<p><em>/services/rest/bookingmanagement/v1/invitedguest/decline/**</em>: to allow guests to reject an invite. Only a <em>guest token</em> is needed.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To configure the <em>login</em> we will set up the <em>HttpSecurity</em> object in the <em>configure</em> method of the class. We will define a <em>JWTLoginFilter</em> class that will handle the requests to the <code>/login</code> <em>endpoint</em>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">http.[...].antMatchers(HttpMethod.POST, "/login").permitAll().[...].addFilterBefore(new JWTLoginFilter("/login", authenticationManager()), UsernamePasswordAuthenticationFilter.class);</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the same <em>HttpSecurity</em> object we will set up the filter for the rest of the requests, to check the presence of the JWT token in the header. First we will need to create a <em>JWTAuthenticationFilter</em> class extending the <em>GenericFilterBean</em> class. Then we can add the filter to the <em>HttpSecurity</em> object</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">http.[...].addFilterBefore(new JWTAuthenticationFilter(), UsernamePasswordAuthenticationFilter.class);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Finally, as default users to start using the <em>My Thai Star</em> app we are going to define two profiles using the <em>inMemoryAuthentication</em> of the <em>Spring Security</em> framework. In the <code>configure(AuthenticationManagerBuilder auth)</code> method we will create:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>user: <em>waiter</em></p>
</li>
<li>
<p>password: <em>waiter</em></p>
</li>
<li>
<p>role: <em>Waiter</em></p>
</li>
<li>
<p>user: <em>user0</em></p>
</li>
<li>
<p>password: <em>password</em></p>
</li>
<li>
<p>role: <em>Customer</em></p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">auth.inMemoryAuthentication().withUser("waiter").password("waiter").roles("Waiter").and().withUser("user0").password("password").roles("Customer");</code></pre>
</div>
</div>
</div>
<div class="sect6">
<h7 id="java-design.asciidoc_token-set-up">Token set up</h7>
<div class="paragraph">
<p>Following the <a href="https://jwt.io/introduction/">official documentation</a> the implementation details for the MyThaiStar&#8217;s jwt will be:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>Secret</em>: Used as part of the signature of the token, acting as a private key. For the showcase purposes we will use simply "ThisIsASecret".</p>
</li>
<li>
<p><em>Token Prefix</em> schema: Bearer. The token will look like <code>Bearer &lt;token&gt;</code></p>
</li>
<li>
<p><em>Header</em>: Authorization. The response header where the token will be included. Also, in the requests, when checking the token it will be expected to be in the same header.</p>
</li>
<li>
<p>The <em>Authorization</em> header should be part of the <code>Access-Control-Expose-Headers</code> header to allow clients access to the <em>Authorization</em> header content (the token);</p>
</li>
<li>
<p>The <em>claims</em> are the content of the <em>payload</em> of the token. The <em>claims</em> are statements about the user, so we will include the user info in this section.</p>
<div class="ulist">
<ul>
<li>
<p><em>subject</em>: "sub". The username.</p>
</li>
<li>
<p><em>issuer</em>: "iss". Who creates the token. We could use the <em>url</em> of our service but, as this is a showcase app, we simply will use "MyThaiStarApp"</p>
</li>
<li>
<p><em>expiration date</em>: "exp". Defines when the token expires.</p>
</li>
<li>
<p><em>creation date</em>: "iat". Defines when the token has been created.</p>
</li>
<li>
<p><em>scope</em>: "scope". Array of strings to store the user roles.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Signature Algorithm: To encrypt the token we will use the default algorithm HS512.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>An example of a token claims before encryption would be:</p>
</div>
<div class="paragraph">
<p><code>{sub=waiter, scope=[ROLE_Waiter], iss=MyThaiStarApp, exp=1496920280, iat=1496916680}</code></p>
</div>
</div>
<div class="sect6">
<h7 id="java-design.asciidoc_current-user-request">Current User request</h7>
<div class="paragraph">
<p>To provide to the client with the current user data our application should expose a service to return the user details. In <em>Devon4j</em> applications the <code>/general/service/impl/rest/SecurityRestServiceImpl.java</code> class is ready to do that.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Path("/security/v1")
@Named("SecurityRestService")
public class SecurityRestServiceImpl {

  @Produces(MediaType.APPLICATION_JSON)
  @GET
  @Path("/currentuser/")
  public UserDetailsClientTo getCurrentUserDetails(@Context HttpServletRequest request) {

  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>we only will need to implement the <code>getCurrentUserDetails</code> method.</p>
</div>
</div>
<div class="sect6">
<h7 id="java-design.asciidoc_authorization">Authorization</h7>
<div class="paragraph">
<p>We need to secure three services, that only should be accessible for users with role <em>Waiter</em>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>(POST) <code>/mythaistar/services/rest/bookingmanagement/v1/booking/search</code>.</p>
</li>
<li>
<p>(POST) <code>/mythaistar/services/rest/ordermanagement/v1/order/search</code>.</p>
</li>
<li>
<p>(POST) <code>/mythaistar/services/rest/ordermanagement/v1/order/filter</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>As part of the token we are providing the user <em>Role</em>. So, when validating the token, we can obtain that same information and build a <code>UsernamePasswordAuthenticationToken</code> with username and the roles as collection of <em>Granted Authorities</em>.</p>
</div>
<div class="paragraph">
<p>Doing so, afterwards, in the implementation class of the <em>logic</em> layer we can set up the related methods with the <em>java security</em> '@RolesAllowed' annotation to block the access to the resource to users that does not match the expected roles.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@RolesAllowed(Roles.WAITER)
public PaginatedListTo&lt;BookingEto&gt; findBookings(BookingSearchCriteriaTo criteria) {
  return findBookings(criteria);
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="net-design.asciidoc">52.2.2. .NET design</h4>
<div class="paragraph">
<p>TODO</p>
</div>
<!-- toc disabled -->
</div>
<div class="sect3">
<h4 id="nodejs-design.asciidoc">52.2.3. Node.js design (deprecated)</h4>
<div class="sect4">
<h5 id="nodejs-design.asciidoc_introduction">Introduction</h5>
<div class="paragraph">
<p>The Node.js backend for My Thai Star application is going to be based on:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Express.js</strong> as the web application framework</p>
</li>
<li>
<p><strong>OASP4Fn</strong> as data access layer framework</p>
</li>
<li>
<p><strong>DynamoDB</strong> as NoSQL Database</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To know more details about the above technologies please visit the following documentation:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://expressjs.com">Express.js</a></p>
</li>
<li>
<p><a href="https://github.com/oasp/oasp4fn/wiki">OASP4Fn</a></p>
</li>
<li>
<p><a href="https://aws.amazon.com/dynamodb/developer-resources/">DynamoDB</a></p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="nodejs-design.asciidoc_basic-architecture-details">Basic architecture details</h5>
<div class="paragraph">
<p>This structure can be shown in the following example image:</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/nodejs/folder_organization.png"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/nodejs/folder_organization.png" alt="folder organization"></a>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>public - All files which be exposed on the server directly</p>
</li>
<li>
<p>src</p>
<div class="ulist">
<ul>
<li>
<p>database folder - Folder with scripts to create/delete/seed the database</p>
</li>
<li>
<p>model - Folder with all data model</p>
</li>
<li>
<p>routes - Folder with all Express.js routers</p>
</li>
<li>
<p>utils - Folder with all utils like classes and functions</p>
</li>
<li>
<p><em>app.ts</em> - File with Express.js declaration</p>
</li>
<li>
<p><em>config.ts</em> - File with server configs</p>
</li>
<li>
<p><em>logic.ts</em> - File with the business logic</p>
</li>
</ul>
</div>
</li>
<li>
<p>test - Folder with all tests</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="nodejs-design.asciidoc_layers">Layers</h5>
<div class="ulist">
<ul>
<li>
<p>Service Layer: this layer will expose the REST api to exchange information with the client applications.</p>
</li>
<li>
<p>Logic Layer: the layer in charge of hosting the business logic of the application.</p>
</li>
<li>
<p>Data Access Layer: the layer to communicate with the data base.</p>
</li>
</ul>
</div>
<div class="sect5">
<h6 id="nodejs-design.asciidoc_service-layer">Service layer</h6>
<div class="paragraph">
<p>The services layer will be solved using REST services with <a href="https://expressjs.com">Express.js</a></p>
</div>
<div class="paragraph">
<p>To give service to the defined <em>User Stories</em> we will need to implement the following services:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>provide all available dishes.</p>
</li>
<li>
<p>save a booking.</p>
</li>
<li>
<p>save an order.</p>
</li>
<li>
<p>provide a list of bookings (only for waiters) and allow filtering.</p>
</li>
<li>
<p>provide a list of orders (only for waiters) and allow filtering.</p>
</li>
<li>
<p>login service (see the <em>Security</em> section).</p>
</li>
<li>
<p>provide the <em>current user</em> data (see the <em>Security</em> section)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In order to be compatible with the other backend implementations, we must follow the <a href="https://github.com/devonfw/devon4j/wiki/guide-rest">naming conventions</a> proposed for <em>Devon4j</em> applications. We will define the following <em>end points</em> for the listed services.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>(POST) <code>/mythaistar/services/rest/dishmanagement/v1/dish/search</code>.</p>
</li>
<li>
<p>(POST) <code>/mythaistar/services/rest/bookingmanagement/v1/booking</code>.</p>
</li>
<li>
<p>(POST) <code>/mythaistar/services/rest/ordermanagement/v1/order</code>.</p>
</li>
<li>
<p>(POST) <code>/mythaistar/services/rest/bookingmanagement/v1/booking/search</code>.</p>
</li>
<li>
<p>(POST) <code>/mythaistar/services/rest/ordermanagement/v1/order/search</code>.</p>
</li>
<li>
<p>(POST) <code>/mythaistar/services/rest/ordermanagement/v1/order/filter</code> (to filter with fields that does not belong to the Order entity).</p>
</li>
<li>
<p>(POST) <code>/mythaistar/login</code>.</p>
</li>
<li>
<p>(GET) <code>/mythaistar/services/rest/security/v1/currentuser/</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can find all the details for the services implementation in the <a href="https://github.com/devonfw/my-thai-star/blob/develop/swagger/mythaistar.yaml">Swagger definition</a> included in the My Thai Star project on Github.</p>
</div>
<div class="paragraph">
<p>To treat these services separately, the following routers were created:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>bookingmanagement: will answer all requests with the prefix <code>/mythaistar/services/rest/bookingmanagement/v1</code></p>
</li>
<li>
<p>dishmanagement: will answer all requests with the prefix <code>/mythaistar/services/rest/dishmanagement/v1</code></p>
</li>
<li>
<p>ordermanagement: will answer all requests with the prefix <code>/mythaistar/services/rest/ordermanagement/v1</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>These routers will define the behavior for each service and use the logical layer.</p>
</div>
<div class="paragraph">
<p>An example of service definition:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-javascript hljs" data-lang="javascript">router.post('/booking/search', (req: types.CustomRequest, res: Response) =&gt; {
    try {
        // body content must be SearchCriteria
        if (!types.isSearchCriteria(req.body)) {
            throw {code: 400, message: 'No booking token given' };
        }

        // use the searchBooking method defined at business logic
        business.searchBooking(req.body, (err: types.Error | null, bookingEntity: types.PaginatedList) =&gt; {
            if (err) {
                res.status(err.code || 500).json(err.message);
            } else {
                res.json(bookingEntity);
            }
        });
    } catch (err) {
        res.status(err.code || 500).json({ message: err.message });
    }
});</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="nodejs-design.asciidoc_logic-layer-and-data-access-layer">Logic layer and Data access layer</h6>
<div class="paragraph">
<p>In the <em>logic</em> layer we will locate all the <em>business logic</em> of the application. It will be located in the file logic.ts. If in this layer we need to get access to the data, we make use of data access layer directly, in this case using OASP4fn with the DynamoDB adapter.</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-javascript hljs" data-lang="javascript">export async function cancelOrder(orderId: string, callback: (err: types.Error | null) =&gt; void) {
    let order: dbtypes.Order;

    try {
        // Data access
        order = await oasp4fn.table('Order', orderId).promise() as dbtypes.Order;

        [...]
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>We could define the data access layer separately, but oasp4fn allows us to do this in a simple and clear way. So, we decided  to not separate the access layer to the logic business.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="nodejs-design.asciidoc_security-with-json-web-token">Security with Json Web Token</h5>
<div class="paragraph">
<p>For the <em>Authentication</em> and <em>Authorization</em> the app will implement the <a href="https://jwt.io/">json web token</a> protocol.</p>
</div>
<div class="sect5">
<h6 id="nodejs-design.asciidoc_jwt-basics">Jwt basics</h6>
<div class="paragraph">
<p>Refer to <a href="java-design.html#jwt-basics">Jwt basiscs</a> for more information.</p>
</div>
</div>
<div class="sect5">
<h6 id="nodejs-design.asciidoc_jwt-implementation-details">Jwt implementation details</h6>
<div class="paragraph">
<p>The <em>Json Web Token</em> pattern will be implemented based on the <a href="https://github.com/auth0/node-jsonwebtoken"><em>JSON web token</em></a> library available on npm.</p>
</div>
<div class="sect6">
<h7 id="nodejs-design.asciidoc_authentication">Authentication</h7>
<div class="paragraph">
<p>Based on the <em>JSON web token</em> approach, we will implement a class <em>Authentication</em> to define the security <em>entry point</em> and filters. Also, as <em>My Thai Star</em> is a mainly <em>public</em> application, we will define here the resources that won&#8217;t be secured.</p>
</div>
<div class="paragraph">
<p>List of <em>unsecured resources</em>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>/services/rest/dishmanagement/**</em>: to allow anonymous users to see the dishes info in the <em>menu</em> section.</p>
</li>
<li>
<p><em>/services/rest/ordermanagement/v1/order</em>: to allow anonymous users to save an order. They will need a <em>booking token</em> but they won&#8217;t be authenticated to do this task.</p>
</li>
<li>
<p><em>/services/rest/bookingmanagement/v1/booking</em>: to allow anonymous users to create a booking. Only a <em>booking token</em> is necessary to accomplish this task.</p>
</li>
<li>
<p><em>/services/rest/bookingmanagement/v1/booking/cancel/**</em>: to allow cancelling a booking from an email. Only the <em>booking token</em> is needed.</p>
</li>
<li>
<p><em>/services/rest/bookingmanagement/v1/invitedguest/accept/**</em>: to allow guests to accept an invite. Only a <em>guest token</em> is needed.</p>
</li>
<li>
<p><em>/services/rest/bookingmanagement/v1/invitedguest/decline/**</em>: to allow guests to reject an invite. Only a <em>guest token</em> is needed.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To configure the <em>login</em> we will create an instance of <em>Authentication</em> in the app file and then we will use the methond <em>auth</em> for handle the requests to the /login endpoint.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-javascript hljs" data-lang="javascript">app.post('/mythaistar/login', auth.auth);</code></pre>
</div>
</div>
<div class="paragraph">
<p>To verify the presence of the <em>Authorization token</em> in the headers, we will register in the express the <em>Authentication.registerAuthentication</em> middleware. This middleware will check if the token is correct, if so, it will place the user in the request and continue to process it. If the token is not correct it will continue processing the request normally.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-javascript hljs" data-lang="javascript">app.use(auth.registerAuthentication);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Finally, we have two default users created in the database:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>user: <em>waiter</em></p>
</li>
<li>
<p>password: <em>waiter</em></p>
</li>
<li>
<p>role: <em>WAITER</em></p>
</li>
<li>
<p>user: <em>user0</em></p>
</li>
<li>
<p>password: <em>password</em></p>
</li>
<li>
<p>role: <em>CUSTOMER</em></p>
</li>
</ul>
</div>
</div>
<div class="sect6">
<h7 id="nodejs-design.asciidoc_token-set-up">Token set up</h7>
<div class="paragraph">
<p>Following the <a href="https://jwt.io/introduction/">official documentation</a> the implementation details for the MyThaiStar&#8217;s jwt will be:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>Secret</em>: Used as part of the signature of the token, acting as a private key. It can be modified at config.ts file.</p>
</li>
<li>
<p><em>Token Prefix</em> schema: Bearer. The token will look like <code>Bearer &lt;token&gt;</code></p>
</li>
<li>
<p><em>Header</em>: Authorization. The response header where the token will be included. Also, in the requests, when checking the token it will be expected to be in the same header.</p>
</li>
<li>
<p>The <em>Authorization</em> header should be part of the <code>Access-Control-Expose-Headers</code> header to allow clients access to the <em>Authorization</em> header content (the token);</p>
</li>
<li>
<p>Signature Algorithm: To encrypt the token we will use the default algorithm HS512.</p>
</li>
</ul>
</div>
</div>
<div class="sect6">
<h7 id="nodejs-design.asciidoc_current-user-request">Current User request</h7>
<div class="paragraph">
<p>To provide to the client with the current user data our application should expose a service to return the user details. In this case the <em>Authentication</em> has a method called <em>getCurrentUser</em> which will return the user data. We only need register it at express.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-javascript hljs" data-lang="javascript">app.get('/mythaistar/services/rest/security/v1/currentuser', auth.getCurrentUser);</code></pre>
</div>
</div>
</div>
<div class="sect6">
<h7 id="nodejs-design.asciidoc_authorization">Authorization</h7>
<div class="paragraph">
<p>We need to secure three services, that only should be accessible for users with role <em>Waiter</em>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>(POST) <code>/mythaistar/services/rest/bookingmanagement/v1/booking/search</code>.</p>
</li>
<li>
<p>(POST) <code>/mythaistar/services/rest/ordermanagement/v1/order/search</code>.</p>
</li>
<li>
<p>(POST) <code>/mythaistar/services/rest/ordermanagement/v1/order/filter</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To ensure this, the <em>Authorization</em> class has the <em>securizedEndpoint</em> method that guarantees access based on the role. This method can be used as middleware in secure services. As the role is included in the token, once validated we will have this information in the request and the middleware can guarantee access or return a 403 error.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-javascript hljs" data-lang="javascript">app.use('/mythaistar/services/rest/ordermanagement/v1/order/filter', auth.securizedEndpoint('WAITER'));
app.use('/mythaistar/services/rest/ordermanagement/v1/order/search', auth.securizedEndpoint('WAITER'));
app.use('/mythaistar/services/rest/bookingmanagement/v1/booking/search', auth.securizedEndpoint('WAITER'));</code></pre>
</div>
</div>
<!-- toc disabled -->
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="serverless-design.asciidoc">52.2.4. Serverless design (deprecated)</h4>
<div class="sect4">
<h5 id="serverless-design.asciidoc_introduction">Introduction</h5>
<div class="paragraph">
<p>The Node.js backend for My Thai Star application is going to be based on:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Serverless</strong> as serverless framework</p>
</li>
<li>
<p><strong>OASP4Fn</strong> as data access layer framework</p>
</li>
<li>
<p><strong>DynamoDB</strong> as NoSQL Database</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To know more details about the above technologies please visit the following documentation:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://serverless.com/">Serverless</a></p>
</li>
<li>
<p><a href="https://github.com/oasp/oasp4fn/wiki">OASP4Fn</a></p>
</li>
<li>
<p><a href="https://aws.amazon.com/dynamodb/developer-resources/">DynamoDB</a></p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="serverless-design.asciidoc_basic-architecture-details">Basic architecture details</h5>
<div class="paragraph">
<p>This structure can be shown in the following example image:</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/serverless/folder_organization.png"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/serverless/folder_organization.png" alt="folder organization"></a>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>handlers - All function handlers following oasp4fn structure</p>
</li>
<li>
<p>src</p>
<div class="ulist">
<ul>
<li>
<p>model - Folder with all data model</p>
</li>
<li>
<p>utils - Folder with all utils like classes and functions</p>
</li>
<li>
<p><em>config.ts</em> - File with server configs</p>
</li>
<li>
<p><em>logic.ts</em> - File with the business logic</p>
</li>
</ul>
</div>
</li>
<li>
<p>test - Folder with all tests</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="serverless-design.asciidoc_layers">Layers</h5>
<div class="ulist">
<ul>
<li>
<p>Service Layer: this layer will expose the REST api to exchange information with the client applications.</p>
</li>
<li>
<p>Logic Layer: the layer in charge of hosting the business logic of the application.</p>
</li>
<li>
<p>Data Access Layer: the layer to communicate with the data base.</p>
</li>
</ul>
</div>
<div class="sect5">
<h6 id="serverless-design.asciidoc_service-layer">Service layer</h6>
<div class="paragraph">
<p>The services layer will be solved using REST services with <a href="https://serverless.com/">Serverless</a></p>
</div>
<div class="paragraph">
<p>To give service to the defined <em>User Stories</em> we will need to implement the following services:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>provide all available dishes.</p>
</li>
<li>
<p>save a booking.</p>
</li>
<li>
<p>save an order.</p>
</li>
<li>
<p>provide a list of bookings (only for waiters) and allow filtering.</p>
</li>
<li>
<p>provide a list of orders (only for waiters) and allow filtering.</p>
</li>
<li>
<p>login service (see the <em>Security</em> section).</p>
</li>
<li>
<p>provide the <em>current user</em> data (see the <em>Security</em> section)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In order to be compatible with the other backend implementations, we must follow the <a href="https://github.com/devonfw/devon4j/wiki/guide-rest">naming conventions</a> proposed for <em>Devon4j</em> applications. We will define the following <em>end points</em> for the listed services.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>(POST) <code>/mythaistar/services/rest/dishmanagement/v1/dish/search</code>.</p>
</li>
<li>
<p>(POST) <code>/mythaistar/services/rest/bookingmanagement/v1/booking</code>.</p>
</li>
<li>
<p>(POST) <code>/mythaistar/services/rest/ordermanagement/v1/order</code>.</p>
</li>
<li>
<p>(POST) <code>/mythaistar/services/rest/bookingmanagement/v1/booking/search</code>.</p>
</li>
<li>
<p>(POST) <code>/mythaistar/services/rest/ordermanagement/v1/order/search</code>.</p>
</li>
<li>
<p>(POST) <code>/mythaistar/services/rest/ordermanagement/v1/order/filter</code> (to filter with fields that does not belong to the Order entity).</p>
</li>
<li>
<p>(POST) <code>/mythaistar/login</code>.</p>
</li>
<li>
<p>(GET) <code>/mythaistar/services/rest/security/v1/currentuser/</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can find all the details for the services implementation in the <a href="https://github.com/oasp/my-thai-star/blob/develop/swagger/mythaistar.yaml">Swagger definition</a> included in the My Thai Star project on Github.</p>
</div>
<div class="paragraph">
<p>To treat these http services, we must define the handlers following the <a href="https://github.com/oasp/oasp4fn/wiki/Structure">oasp4fn convention</a>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>(handlers/Http/POST/dish-search-handler) <code>/mythaistar/services/rest/dishmanagement/v1/dish/search</code>.</p>
</li>
<li>
<p>(handlers/Http/POST/booking-handler) <code>/mythaistar/services/rest/bookingmanagement/v1/booking</code>.</p>
</li>
<li>
<p>(handlers/Http/POST/order-handler) <code>/mythaistar/services/rest/ordermanagement/v1/order</code>.</p>
</li>
<li>
<p>(handlers/Http/POST/booking-search-handler) <code>/mythaistar/services/rest/bookingmanagement/v1/booking/search</code>.</p>
</li>
<li>
<p>(handlers/Http/POST/order-search-handler) <code>/mythaistar/services/rest/ordermanagement/v1/order/search</code>.</p>
</li>
<li>
<p>(handlers/Http/POST/order-filter-handler) <code>/mythaistar/services/rest/ordermanagement/v1/order/filter</code> (to filter with fields that does not belong to the Order entity).</p>
</li>
<li>
<p>(handlers/Http/POST/login-handler) <code>/mythaistar/login</code>.</p>
</li>
<li>
<p>(handlers/Http/GET/current-user-handler) <code>/mythaistar/services/rest/security/v1/currentuser/</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>These handlers will define the behavior for each service and use the logical layer.</p>
</div>
<div class="paragraph">
<p>An example of handler definition:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-javascript hljs" data-lang="javascript">oasp4fn.config({ path: '/mythaistar/services/rest/bookingmanagement/v1/booking/search' });
export async function bookingSearch(event: HttpEvent, context: Context, callback: Function) {
    try {
        const search = &lt;types.SearchCriteria&gt;event.body;
        const authToken = event.headers.Authorization;
        // falta lo que viene siendo comprobar el token y eso

        auth.decode(authToken, (err, decoded) =&gt; {
            if (err || decoded.role !== 'WAITER') {
                throw { code: 403, message: 'Forbidden'};
            }

            // body content must be SearchCriteria
            if (!types.isSearchCriteria(search)) {
                throw { code: 400, message: 'No booking token given' };
            }

            business.searchBooking(search, (err: types.Error | null, bookingEntity: types.PaginatedList) =&gt; {
                if (err) {
                    callback(new Error(`[${err.code || 500}] ${err.message}`));
                } else {
                    callback(null, bookingEntity);
                }
            });
        });
    } catch (err) {
        callback(new Error(`[${err.code || 500}] ${err.message}`));
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The default integration for a handler is <em>lambda</em>. See <a href="https://github.com/oasp/oasp4fn/wiki/Configuration">oasp documentation</a> for more information about default values and how to change it.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If you change the integration to lambda-proxy, you must take care that in this case the data will not be parsed. You must do JSON.parse explicitly</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>After defining all the handlers, we must execute the <em>fun</em> command, which will generate the files serverless.yml and webpack.config.js.</p>
</div>
</div>
<div class="sect5">
<h6 id="serverless-design.asciidoc_logic-layer-and-data-access-layer">Logic layer and Data access layer</h6>
<div class="paragraph">
<p><a href="nodejs-design.html#logic-layer-and-data-access-layer">See in nodejs section</a></p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="serverless-design.asciidoc_security-with-json-web-token">Security with Json Web Token</h5>
<div class="paragraph">
<p>For the <em>Authentication</em> and <em>Authorization</em> the app will implement the <a href="https://jwt.io/">json web token</a> protocol.</p>
</div>
<div class="sect5">
<h6 id="serverless-design.asciidoc_jwt-basics">Jwt basics</h6>
<div class="paragraph">
<p>Refer to <a href="java-design.html#jwt-basics">Jwt basiscs</a> for more information.</p>
</div>
</div>
<div class="sect5">
<h6 id="serverless-design.asciidoc_jwt-implementation-details">Jwt implementation details</h6>
<div class="paragraph">
<p>The <em>Json Web Token</em> pattern will be implemented based on the <a href="https://github.com/auth0/node-jsonwebtoken"><em>JSON web token</em></a> library available on npm.</p>
</div>
<div class="sect6">
<h7 id="serverless-design.asciidoc_authentication">Authentication</h7>
<div class="paragraph">
<p>Based on the <em>JSON web token</em> approach, we will implement two methods in order to verify and user + generate the token and decode the token + return the user data. Also, as <em>My Thai Star</em> is a mainly <em>public</em> application, we will define here the resources that won&#8217;t be secured.</p>
</div>
<div class="paragraph">
<p>List of <em>unsecured resources</em>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>/services/rest/dishmanagement/**</em>: to allow anonymous users to see the dishes info in the <em>menu</em> section.</p>
</li>
<li>
<p><em>/services/rest/ordermanagement/v1/order</em>: to allow anonymous users to save an order. They will need a <em>booking token</em> but they won&#8217;t be authenticated to do this task.</p>
</li>
<li>
<p><em>/services/rest/bookingmanagement/v1/booking</em>: to allow anonymous users to create a booking. Only a <em>booking token</em> is necessary to accomplish this task.</p>
</li>
<li>
<p><em>/services/rest/bookingmanagement/v1/booking/cancel/**</em>: to allow cancelling a booking from an email. Only the <em>booking token</em> is needed.</p>
</li>
<li>
<p><em>/services/rest/bookingmanagement/v1/invitedguest/accept/**</em>: to allow guests to accept an invite. Only a <em>guest token</em> is needed.</p>
</li>
<li>
<p><em>/services/rest/bookingmanagement/v1/invitedguest/decline/**</em>: to allow guests to reject an invite. Only a <em>guest token</em> is needed.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To configure the <em>login</em> we will create a handler called login and then we will use the methond <em>code</em> for verify the user and generate the token.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-javascript hljs" data-lang="javascript">app.post(oasp4fn.config({ integration: 'lambda-proxy', path: '/mythaistar/login' });
export async function login(event: HttpEvent, context: Context, callback: Function) {
.
.
.
.
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>We have two default users created in the database:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>user: <em>waiter</em></p>
</li>
<li>
<p>password: <em>waiter</em></p>
</li>
<li>
<p>role: <em>WAITER</em></p>
</li>
<li>
<p>user: <em>user0</em></p>
</li>
<li>
<p>password: <em>password</em></p>
</li>
<li>
<p>role: <em>CUSTOMER</em></p>
</li>
</ul>
</div>
</div>
<div class="sect6">
<h7 id="serverless-design.asciidoc_token-set-up">Token set up</h7>
<div class="paragraph">
<p><a href="nodejs-design.html#token-set-up">See in nodejs section</a></p>
</div>
</div>
<div class="sect6">
<h7 id="serverless-design.asciidoc_current-user-request">Current User request</h7>
<div class="paragraph">
<p>To provide the client with the current user data our application should expose a service to return the user details. In order to do this, we must define a handler called current-user-handler. This handler must decode the <em>Authorization token</em> and return the user data.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-javascript hljs" data-lang="javascript">oasp4fn.config({
    path: '/mythaistar/services/rest/security/v1/currentuser',
});
export async function currentUser(event: HttpEvent, context: Context, callback: Function) {
    let authToken = event.headers.Authorization;
    try {
        auth.decode(authToken, (err: any, decoded?: any) =&gt; {
            if (err) {
                callback(new Error(`[403] Forbidden`));
            } else {
                callback(null, decoded);
            }
        });
    } catch (err) {
        callback(new Error(`[${err.code || 500}] ${err.message}`));
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect6">
<h7 id="serverless-design.asciidoc_authorization">Authorization</h7>
<div class="paragraph">
<p>We need to secure three services, that only should be accessible for users with role <em>Waiter</em>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>(POST) <code>/mythaistar/services/rest/bookingmanagement/v1/booking/search</code>.</p>
</li>
<li>
<p>(POST) <code>/mythaistar/services/rest/ordermanagement/v1/order/search</code>.</p>
</li>
<li>
<p>(POST) <code>/mythaistar/services/rest/ordermanagement/v1/order/filter</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To ensure this, we must decode the <em>Autorization token</em> and check the result. As the role is included in the token, once validated we will have this information and can guarantee access or return a 403 error.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-javascript hljs" data-lang="javascript">oasp4fn.config({ path: '/mythaistar/services/rest/bookingmanagement/v1/booking/search' });
export async function bookingSearch(event: HttpEvent, context: Context, callback: Function) {
    const authToken = event.headers.Authorization;
    auth.decode(authToken, (err, decoded) =&gt; {
        try {
            if (err || decoded.role !== 'WAITER') {
                throw { code: 403, message: 'Forbidden' };
            }

            [...]

        } catch (err) {
            callback(new Error(`[${err.code || 500}] ${err.message}`));
        }
    });
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="graphql-design.asciidoc">52.2.5. GraphQL design</h4>
<div class="paragraph">
<p>TODO</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="master-my-thai-star.asciidoc_client-side">52.3. Client Side</h3>
<!-- toc disabled -->
<div class="sect3">
<h4 id="angular-design.asciidoc">52.3.1. Angular design</h4>
<div class="sect4">
<h5 id="angular-design.asciidoc_introduction">Introduction</h5>
<div class="paragraph">
<p>MyThaiStar client side has been built using latest frameworks, component libraries and designs:</p>
</div>
<div class="paragraph">
<p><strong>Angular</strong> <em>4</em> as main front-end Framework. <a href="https://angular.io/" class="bare">https://angular.io/</a></p>
</div>
<div class="paragraph">
<p><strong>Angular/CLI</strong> <em>1.0.5</em> as Angular tool helper. <a href="https://github.com/angular/angular-cli" class="bare">https://github.com/angular/angular-cli</a></p>
</div>
<div class="paragraph">
<p><strong>Covalent Teradata</strong> <em>1.0.0-beta4</em> as Angular native component library based on Material Design. <a href="https://teradata.github.io/covalent/#/" class="bare">https://teradata.github.io/covalent/#/</a></p>
</div>
<div class="paragraph">
<p><strong>Angular/Material2</strong> <em>1.0.0-beta5</em> used by Covalent Teradata. <a href="https://github.com/angular/material2" class="bare">https://github.com/angular/material2</a></p>
</div>
<div class="paragraph">
<p><em>Note: this dependencies are evolving at this moment and if it is possible, we are updating it on the project.</em></p>
</div>
</div>
<div class="sect4">
<h5 id="angular-design.asciidoc_basic-project-structure">Basic project structure</h5>
<div class="paragraph">
<p>The project is using the basic project seed that Angular/CLI provides with “ng new &lt;project name&gt;”. Then the app folder has been organized as Angular recommends and goes as follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>app</p>
<div class="ulist">
<ul>
<li>
<p>components</p>
<div class="ulist">
<ul>
<li>
<p>sub-components</p>
</li>
<li>
<p>shared</p>
</li>
<li>
<p>component files</p>
</li>
</ul>
</div>
</li>
<li>
<p>main app component</p>
</li>
</ul>
</div>
</li>
<li>
<p>assets folder</p>
</li>
<li>
<p>environments folder</p>
</li>
<li>
<p>rest of angular files</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This structure can be shown in the following example image:</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/angular/folder_organization.png"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/angular/folder_organization.png" alt="folder organization"></a>
</div>
</div>
</div>
<div class="sect4">
<h5 id="angular-design.asciidoc_main-views-and-components">Main Views and components</h5>
<div class="paragraph">
<p>List of components that serve as a main view to navigate or components developed to make atomically a group of functionalities which given their nature, can be highly reusable through the app.</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/angular/routes.png"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/angular/routes.png" alt="routes"></a>
</div>
</div>
<div class="paragraph">
<p><em>Note: no-name-route corresponds to whatever URL the user introduced and does not exist, it redirects to HomeComponent.</em></p>
</div>
<div class="sect5">
<h6 id="angular-design.asciidoc_public-area">Public area</h6>
<div class="sect6">
<h7 id="angular-design.asciidoc_appcomponent">AppComponent</h7>
<div class="paragraph">
<p>Contains the components that are on top of all views, including:</p>
</div>
<div class="sect7">
<h8 id="angular-design.asciidoc_order-sidenav">Order sidenav</h8>
<div class="paragraph">
<p>Sidenav where selected orders are displayed with their total price and some comments.</p>
</div>
</div>
<div class="sect7">
<h8 id="angular-design.asciidoc_navigation-sidenav-only-for-mobile">Navigation sidenav (only for mobile)</h8>
<div class="paragraph">
<p>This sidenav proposal is to let user navigate through the app when the screen is too small to show the navigation buttons on the header.</p>
</div>
</div>
<div class="sect7">
<h8 id="angular-design.asciidoc_header">Header</h8>
<div class="paragraph">
<p>It contains the title, and some other basic functions regarding open and close sidenavs.</p>
</div>
</div>
<div class="sect7">
<h8 id="angular-design.asciidoc_footer-only-for-desktop">Footer (only for desktop)</h8>
<div class="paragraph">
<p>At the end of the page that shows only when open on desktop.</p>
</div>
</div>
</div>
<div class="sect6">
<h7 id="angular-design.asciidoc_homecomponent">HomeComponent</h7>
<div class="paragraph">
<p>Main view that shows up when the app initializes.</p>
</div>
</div>
<div class="sect6">
<h7 id="angular-design.asciidoc_menucomponent">MenuComponent</h7>
<div class="paragraph">
<p>View where the users can view, filter and select the dishes (with their extras) they want to order it contains a component to each menu entry:</p>
</div>
<div class="sect7">
<h8 id="angular-design.asciidoc_menu-card">Menu-card</h8>
<div class="paragraph">
<p>This component composes all the data of a dish in a card. Component made to display indeterminate number of dishes easily.</p>
</div>
</div>
</div>
<div class="sect6">
<h7 id="angular-design.asciidoc_booktablecomponent">BookTableComponent</h7>
<div class="paragraph">
<p>View to make book a table in a given data with a given number of assistants or create a reservation with a number of invitations via email.</p>
</div>
<div class="sect7">
<h8 id="angular-design.asciidoc_book-table-dialog">Book-table-dialog</h8>
<div class="paragraph">
<p>Dialog which opens as a result of fulfilling the booking form, it displays all the data of the booking attempt, if everything is correct, the user can send the information or cancel if something is wrong.</p>
</div>
</div>
<div class="sect7">
<h8 id="angular-design.asciidoc_invitation-dialog">Invitation-dialog</h8>
<div class="paragraph">
<p>Dialog which opens as a result of fulfilling the invitation form, it displays all the data of the booking with friends attempt, if everything is correct, the user can send the information or cancel if something is wrong.</p>
</div>
</div>
</div>
<div class="sect6">
<h7 id="angular-design.asciidoc_userarea">UserArea</h7>
<div class="paragraph">
<p>Group of dialogs with the proposal of giving some functionalities to the user, as login, register, change password or connect with Twitter.</p>
</div>
<div class="sect7">
<h8 id="angular-design.asciidoc_login-dialog">Login-dialog</h8>
<div class="paragraph">
<p>Dialog with a tab to navigate between login and register.</p>
</div>
</div>
<div class="sect7">
<h8 id="angular-design.asciidoc_password-dialog">Password-dialog</h8>
<div class="paragraph">
<p>Functionality reserved to already logged users, in this dialog the user can change freely their password.</p>
</div>
</div>
<div class="sect7">
<h8 id="angular-design.asciidoc_twitter-dialog">Twitter-dialog</h8>
<div class="paragraph">
<p>Dialog designed specifically to connect your user account with Twitter.</p>
</div>
</div>
</div>
</div>
<div class="sect5">
<h6 id="angular-design.asciidoc_waiter-cockpit-area">Waiter cockpit area</h6>
<div class="paragraph">
<p>Restricted area to workers of the restaurant, here we can see all information about booked tables with the selected orders and the reservations with all the guests and their acceptance or decline of the event.</p>
</div>
<div class="sect6">
<h7 id="angular-design.asciidoc_ordercockpitcomponent">OrderCockpitComponent</h7>
<div class="paragraph">
<p>Data table with all the booked tables and a filter to search them, to show more info about that table you can click on it and open a dialog.</p>
</div>
<div class="sect7">
<h8 id="angular-design.asciidoc_order-dialog">Order-dialog</h8>
<div class="paragraph">
<p>Complete display of data regarding the selected table and its orders.</p>
</div>
</div>
</div>
<div class="sect6">
<h7 id="angular-design.asciidoc_reservationcockpitcomponent">ReservationCockpitComponent</h7>
<div class="paragraph">
<p>Data table with all the reservations and a filter to search them, to show more info about that table you can click on it and open a dialog.</p>
</div>
<div class="sect7">
<h8 id="angular-design.asciidoc_reservation-dialog">Reservation-dialog</h8>
<div class="paragraph">
<p>Complete display of data regarding the selected table and its guests.</p>
</div>
</div>
</div>
</div>
<div class="sect5">
<h6 id="angular-design.asciidoc_email-management">Email Management</h6>
<div class="paragraph">
<p>As the application send emails to both guests and hosts, we choose an approach based on URL’s where the email contain a button with an URL to a service in the app and a token, front-end read that token and depending on the URL, will redirect to one service or another. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>http://localhost:4200/booking/cancel/CB_20170605_8fb5bc4c84a1c5049da1f6beb1968afc</code></pre>
</div>
</div>
<div class="paragraph">
<p>This URL will tell the app that is a cancelation of a booking with the token <em>CB_20170605_8fb5bc4c84a1c5049da1f6beb1968afc</em>. The app will process this information, send it to back-end with the correct headers, show the confirmation of the event and redirect to home page.</p>
</div>
<div class="paragraph">
<p>The main cases at the moment are:</p>
</div>
<div class="sect6">
<h7 id="angular-design.asciidoc_accept-invite">Accept Invite</h7>
<div class="paragraph">
<p>A guest accept an invitation sent by a host. It will receive another email to decline if it change its mind later on.</p>
</div>
</div>
<div class="sect6">
<h7 id="angular-design.asciidoc_reject-invite">Reject Invite</h7>
<div class="paragraph">
<p>A guest decline the invitation.</p>
</div>
</div>
<div class="sect6">
<h7 id="angular-design.asciidoc_cancel-reservation">Cancel Reservation</h7>
<div class="paragraph">
<p>A host cancel the reservation, everybody that has accepted or not already answered will receive an email notifying this event is canceled. Also all the orders related to this reservations will be removed.</p>
</div>
</div>
<div class="sect6">
<h7 id="angular-design.asciidoc_cancel-orders">Cancel Orders</h7>
<div class="paragraph">
<p>When you have a reservation, you will be assigned to a token, with that token you can save your order in the restaurant. When sent, you will receive an email confirming the order and the possibility to remove it.</p>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="angular-design.asciidoc_services-and-directives">Services and directives</h5>
<div class="paragraph">
<p>Services are where all the main logic between components of that view should be. This includes calling a remote server, composing objects, calculate prices, etc.</p>
</div>
<div class="paragraph">
<p>Directives are a single functionality that are related to a component.</p>
</div>
<div class="paragraph">
<p>As it can be seen in the basic structure, every view that has a minimum of logic or need to call a server has its own service located in the shared folder.</p>
</div>
<div class="paragraph">
<p>Also, services and directives can be created to compose a reusable piece of code that will be reused in some parts of the code:</p>
</div>
<div class="sect5">
<h6 id="angular-design.asciidoc_price-calculator-service">Price-calculator-service</h6>
<div class="paragraph">
<p>This service located in the shared folder of sidenav contains the basic logic to calculate the price of a single order (with all the possibilities) and to calculate the price of a full list of orders for a table. As this is used in the sidenav and in the waiter cockpit, it has been exported as a service to be imported where needed and easily testable.</p>
</div>
</div>
<div class="sect5">
<h6 id="angular-design.asciidoc_authentication">Authentication</h6>
<div class="paragraph">
<p>Authentication services serves as a validator of roles and login and, at the same time, stores the basic data regarding security and authentication.</p>
</div>
<div class="paragraph">
<p>Main task of this services is to provide visibility at app level of the current user information:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Check if the user is logged or not.</p>
</li>
<li>
<p>Check the permissions of the current user.</p>
</li>
<li>
<p>Store the username and the JWT token.</p>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="angular-design.asciidoc_snackservice">SnackService</h6>
<div class="paragraph">
<p>Service created to serve as a factory of Angular Material Snackbars, which are used commonly through the app. This service accepts some parameters to customize the snackBar and opens it with this parameters.</p>
</div>
</div>
<div class="sect5">
<h6 id="angular-design.asciidoc_windowservice">WindowService</h6>
<div class="paragraph">
<p>For responsiveness reasons, the dialogs have to accept a width parameter to adjust to screen width and this information is given by Window object, as it is a good practice to have it in an isolated service, which also calculates the width percentage to apply on the dialogs.</p>
</div>
</div>
<div class="sect5">
<h6 id="angular-design.asciidoc_equal-validator-directive">Equal-validator-directive</h6>
<div class="paragraph">
<p>This directive located in the shared folder of userArea is used in 2 fields to make sure they have the same value. This directive is used in confirm password fields in register and change password.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="angular-design.asciidoc_mock-backend">Mock Backend</h5>
<div class="paragraph">
<p>To develop meanwhile a real back-end is being developed let us to make a more realistic application and to make easier the adaptation when the backend is able to be connected and called. Its structure is as following:</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/angular/back-end.png"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/angular/back-end.png" alt="back end"></a>
</div>
</div>
<div class="paragraph">
<p>Contains the three main groups of functionalities in the application. Every group is composed by:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>An <strong>interface</strong> with all the methods to implement.</p>
</li>
<li>
<p>A <strong>service</strong> that implements that interface, the main task of this service is to choose between real backend and mock backend depending on an environment variable.</p>
</li>
<li>
<p><strong>Mock backend service</strong> which implements all the methods declared in the interface using mock data stored in a local file and mainly uses Lodash to operate the arrays.</p>
</li>
<li>
<p><strong>Real backend service</strong> works as Mock backend but in this case the methods call for server rest services through http.</p>
</li>
</ul>
</div>
<div class="sect5">
<h6 id="angular-design.asciidoc_booking">Booking</h6>
<div class="paragraph">
<p>The booking group of functionalities manages the calls to reserve a table with a given time and assistants or with guests, get reservations filtered, accept or decline invitations or cancel the reservation.</p>
</div>
</div>
<div class="sect5">
<h6 id="angular-design.asciidoc_orders">Orders</h6>
<div class="paragraph">
<p>Management of the orders, including saving, filtering and cancel an order.</p>
</div>
</div>
<div class="sect5">
<h6 id="angular-design.asciidoc_dishes">Dishes</h6>
<div class="paragraph">
<p>The dishes group of functionalities manages the calls to get and filter dishes.</p>
</div>
</div>
<div class="sect5">
<h6 id="angular-design.asciidoc_login">Login</h6>
<div class="paragraph">
<p>Login manages the userArea logic: login, register and change password.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="angular-design.asciidoc_sap-hana">SAP Hana</h5>
<div class="sect5">
<h6 id="angular-design.asciidoc_setting-up-mtsj-angular">Setting up MTSJ angular</h6>
<div class="paragraph">
<p>update the following property in config file in my-thai-star\angular\src\app\core\config</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">enablePrediction: true,</code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="angular-design.asciidoc_security">Security</h5>
<div class="paragraph">
<p>My Thai Star security is composed by two main security services:</p>
</div>
<div class="sect5">
<h6 id="angular-design.asciidoc_auth-guard">Auth-guard</h6>
<div class="paragraph">
<p>Front-end security approach, this service implements an interface called CanActivate that comes from angular/router module. CanActivate interface forces you to implement a canActivate() function which returns a Boolean.
This service checks with the AuthService stored data if the user is logged and if he has enough permission to access the waiter cockpit. This prevents that a forbidden user could access to waiter cockpit just by editing the URL in the browser.</p>
</div>
</div>
<div class="sect5">
<h6 id="angular-design.asciidoc_jwt">JWT</h6>
<div class="paragraph">
<p>Jason Web Token consist in a token that is generated by the server when the user logs in, once provided, the token has to be included in an Authentication header on every Http call to the rest service, otherwise it will be forbidden.
JWT also has an expiration date and a role checking, so if a user has not enough permissions or keeps logged for a long certain amount of time that exceeds this expiration date, the next time he calls for a service call, the server will return an error and forbid the call. You can log again to restore the token.</p>
</div>
<div class="sect6">
<h7 id="angular-design.asciidoc_httpclient">HttpClient</h7>
<div class="paragraph">
<p>To implement this Authorization header management, an HttpClient service has been implemented.
This services works as an envelope of Http, providing some more functionalities, likes a header management and an automatically management of a server token error in case the JWT has expired, corrupted or not permitted.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="xamarin-design.asciidoc">52.3.2. Xamarin design</h4>
<div class="paragraph">
<p>TODO</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="master-my-thai-star.asciidoc_security">53. Security</h2>
<div class="sectionbody">
<!-- toc disabled -->
<div class="sect2">
<h3 id="twofactor.asciidoc">53.1. Two-Factor Authentication</h3>
<div class="paragraph">
<p>Two-factor Authentication (2FA) provides an additional level of security to your account. Once enabled, in addition to supplying your username and password to login, you’ll be prompted for a code generated by your Google authenticator. For example, a password manager on one of your devices.</p>
</div>
<div class="paragraph">
<p>By enabling 2FA, to log into your account an additional one-time password is required what requires access to your paired device. This massively increases the barrier for an attacker to break into your account.</p>
</div>
<div class="sect4">
<h5 id="twofactor.asciidoc_backend-mechanism">Backend mechanism</h5>
<div class="paragraph">
<p>In the backend, we utilize Spring Security for any authentication.
Following the arrows, one can see all processes regarding authentication. The main idea is to check all credentials depending on their 2FA status and then either grand access to the specific user or deny access. This picture illustrates a normal authentication with username and password.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/security/security_cross_component.png" alt="security cross component">
</div>
</div>
<div class="paragraph">
<p>When dealing with 2FA, another provider and filter is handling the request from <strong>/verify</strong></p>
</div>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/security/security_cross_component_twofactor.png" alt="security cross component twofactor">
</div>
</div>
<div class="paragraph">
<p>Here you can observe which filter will be used.
<strong>JWTAuthenticationFilter</strong> does intercept any request, which enforces being authenticated via JWT</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/security/filters_png.png" alt="filters png">
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Whenever the secret or qr code gets transfered between two parties, one must enforce <a href="https://tools.ietf.org/html/rfc5246">SSL/TLS</a> or <a href="https://tools.ietf.org/html/rfc4301">IPsec</a> to be comply with <a href="https://tools.ietf.org/html/rfc6238#page-5">RFC 6238</a>.
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="twofactor.asciidoc_activating-two-factor-authentication">Activating Two-Factor Authentication</h5>
<div class="paragraph">
<p>In the current state, <a href="https://en.wikipedia.org/wiki/Time-based_One-time_Password_algorithm">TOTP</a>
will be used for OTP generation. For this purpose we recommend the <strong>Google Authenticator</strong> or any TOTP generator out there.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Login with your account</p>
</li>
<li>
<p>Open the 2FA settings</p>
</li>
<li>
<p>Activate the 2FA Status</p>
</li>
<li>
<p>Initialize your device with either a <strong>QR-Code</strong> or a <strong>secret</strong></p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="twofactor.asciidoc_frontend">Frontend</h5>
<div class="paragraph">
<p>These are the two main options, which you can obtain my toggling between <strong>QR-Code</strong> and <strong>secret</strong>.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/security/2FA_qr_code_menu.png" alt="2FA qr code menu">
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/security/2FA_secret_menu.png" alt="2FA secret menu">
</div>
</div>
<div class="paragraph">
<p>After an activation and logout. This prompt will ask you to enter the OTP given from your device.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/security/otp_prompt.png" alt="otp prompt">
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="master-my-thai-star.asciidoc_testing">54. Testing</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="master-my-thai-star.asciidoc_server-side">54.1. Server Side</h3>
<!-- toc disabled -->
<div class="sect3">
<h4 id="java-testing.asciidoc">54.1.1. Java testing</h4>
<div class="sect4">
<h5 id="java-testing.asciidoc_component-testing">Component testing</h5>
<div class="paragraph">
<p>We are going to test our components as a unit using <em>Spring Test</em> and <em>Devon4j-test</em> modules.</p>
</div>
<div class="paragraph">
<p>In order to test a basic component of the app first we will create a test class in the <code>src/test/java</code> folder and inside the main package of the test module. We will name the class following the convetion</p>
</div>
<div class="listingblock">
<div class="content">
<pre>[Component]Test</pre>
</div>
</div>
<div class="paragraph">
<p>Then, in the declaration of the test class we will use the <code>@SpringBootTest</code> annotation to run the application context. In addition, we will extend the <code>ComponentTest</code> from <code>Devon4j-test</code> module to have access to the main functionalities of the module, <a href="https://github.com/devonfw/devon4j/wiki/guide-testing">see more details here</a>.</p>
</div>
<div class="paragraph">
<p><em>Spring Test</em> allows us to use <em>Dependency Injection</em> so we can inject our component directly using the <code>@Inject</code> annotation.</p>
</div>
<div class="paragraph">
<p>Each test will be represented by a method annotated with <code>@Test</code>. Inside the method we will test one functionality, evaluating the result thanks to the <em>asserts</em> provided by the <em>ComponentTest</em> class that we are extending.</p>
</div>
<div class="paragraph">
<p>A simple test example</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@SpringBootTest(classes = SpringBootApp.class)
public class DishmanagementTest extends ComponentTest {

  @Inject
  private Dishmanagement dishmanagement;

  @Test
  public void findAllDishes() {

    PaginatedListTo&lt;DishCto&gt; result = this.dishmanagement.findDishes();
    assertThat(result).isNotNull();
  }

  ...
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="java-testing.asciidoc_running-the-tests">Running the tests</h5>
<div class="sect5">
<h6 id="java-testing.asciidoc_from-eclipse">From Eclipse</h6>
<div class="paragraph">
<p>We can run the test from within <em>Eclipse</em> with the contextual menu <em>Run As &gt; JUnit Test</em>. This functionality can be launched from method level, class level or even package level. The results will be shown in the <em>JUnit</em> tab.</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/java/test_results_eclipse.PNG"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/java/test_results_eclipse.PNG" alt="test results eclipse"></a>
</div>
</div>
</div>
<div class="sect5">
<h6 id="java-testing.asciidoc_from-command-line-using-maven">From command line using Maven</h6>
<div class="paragraph">
<p>We can also run tests using <em>Maven</em> and the command line, using the command <em>mvn test</em> (or <em>mvn clean test</em>).</p>
</div>
<div class="listingblock">
<div class="content">
<pre>C:\MyThaiStar&gt;mvn clean test</pre>
</div>
</div>
<div class="paragraph">
<p>Doing this we will run all the tests of the project (recognized by the <em>Test</em> word at the end of the classes) and the results will be shown by sub-project.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>...

[D: 2017-07-17 09:30:08,457] [P: INFO ] [C: ] [T: Thread-5] [L: org.springframework.orm.jpa.LocalContainerEntityManagerFactoryBean] - [M: Closing JPA EntityManagerFactory for persistence unit 'default']

Results :

Tests run: 11, Failures: 0, Errors: 0, Skipped: 1

...

[INFO]
[INFO] --- maven-compiler-plugin:3.1:testCompile (default-testCompile) @ mtsj-server ---
[INFO] No sources to compile
[INFO]
[INFO] --- maven-surefire-plugin:2.12.4:test (default-test) @ mtsj-server ---
[INFO] No tests to run.
[INFO] ------------------------------------------------------------------------
[INFO] Reactor Summary:
[INFO]
[INFO] mtsj ............................................... SUCCESS [  0.902 s]
[INFO] mtsj-core .......................................... SUCCESS [02:30 min]
[INFO] mtsj-server ........................................ SUCCESS [  1.123 s]
[INFO] ------------------------------------------------------------------------
[INFO] BUILD SUCCESS
[INFO] ------------------------------------------------------------------------
[INFO] Total time: 02:35 min
[INFO] Finished at: 20XX-07-17T09:30:13+02:00
[INFO] Final Memory: 39M/193M
[INFO] ------------------------------------------------------------------------</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="net-testing.asciidoc">54.1.2. .NET testing</h4>
<div class="paragraph">
<p>TODO</p>
</div>
</div>
<div class="sect3">
<h4 id="nodejs-testing.asciidoc">54.1.3. Node.js testing</h4>
<div class="paragraph">
<p>TODO</p>
</div>
</div>
<div class="sect3">
<h4 id="graphql-testing.asciidoc">54.1.4. GraphQL testing</h4>
<div class="paragraph">
<p>TODO</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="master-my-thai-star.asciidoc_client-side">54.2. Client Side</h3>
<!-- toc disabled -->
<div class="sect3">
<h4 id="angular-testing.asciidoc">54.2.1. Angular testing</h4>
<div class="imageblock">
<div class="content">
<a class="image" href="images/angular/testing.JPG"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/angular/testing.JPG" alt="testing"></a>
</div>
</div>
<div class="paragraph">
<p>MyThaiStar testing is made using Angular default testing environment and syntax language: <a href="https://karma-runner.github.io/1.0/index.html"><strong>Karma</strong></a> and <a href="https://jasmine.github.io/"><strong>Jasmine</strong></a></p>
</div>
<div class="paragraph">
<p>To test an element of the application, you indicate that tests are a special type of files with the extension <strong>.spec.ts</strong>, then, in MyThaiStar angular/CLI config you can notice that there is an array with only one entry, Karma, with at the same time has one entry to Karma.config.js.</p>
</div>
<div class="paragraph">
<p>In the configuration of Karma we indicate which syntax language we are going to use (currently Jasmine as said before) between some other configurations, it is remarkable the last one: <em>browsers</em>. By default, the only available browser is chrome, that is because Karma works opening a chrome view to run all the tests, in that same window, Karma shows the result or errors of the test run. But we can add some other browser to adjust to our necessities, for example, in some automatic processes that run from console, it is not an option to open a chrome window, in that case, MyThaiStar used PhantomJS and ChromeHeadless.</p>
</div>
<div class="paragraph">
<p>Taking all of this into account, to run the test in MyThaiStar we need to move to project root folder and run this command : <code>ng test --browser &lt;browser&gt;</code></p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If you run just <code>ng test</code> it will run the three browser options <strong>simultaneously</strong>, giving as a result three test runs and outputs, it can cause timeouts and unwanted behaviors, if you want a shortcut to run the test with chrome window you can just run <code>yarn test</code> so we really encourage to <strong>not use</strong> just <code>ng test</code>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Here we are going to see how Client side testing of MyThaiStar has been done.</p>
</div>
<div class="sect4">
<h5 id="angular-testing.asciidoc_testing-components">Testing Components</h5>
<div class="paragraph">
<p>Angular components were created using angular/CLI <code>ng create component</code> so they already come with an spec file to test them. The only thing left to do is to add the providers and imports needed in the component to work as the component itself, once this is done, the most basic test is to be sure that all the dependencies and the component itself can be correctly created.</p>
</div>
<div class="paragraph">
<p>As an example, this is the <em>spec.ts</em> of the menu view component:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-javascript hljs" data-lang="javascript">all the imports...

describe('MenuComponent', () =&gt; {
  let component: MenuComponent;
  let fixture: ComponentFixture&lt;MenuComponent&gt;;

  beforeEach(async(() =&gt; {
    TestBed.configureTestingModule({
      declarations: [ MenuComponent, MenuCardComponent ],
      providers: [SidenavService, MenuService, SnackBarService],
      imports: [
        BrowserAnimationsModule,
        BackendModule.forRoot({environmentType: 0, restServiceRoot: 'v1'}),
        CovalentModule,
      ],
    })
    .compileComponents();
  }));

  beforeEach(() =&gt; {
    fixture = TestBed.createComponent(MenuComponent);
    component = fixture.componentInstance;
    fixture.detectChanges();
  });

  it('should create', () =&gt; {
    expect(component).toBeTruthy();
  });
});</code></pre>
</div>
</div>
<div class="paragraph">
<p>First we declare the component to be tested and a Fixture object, then, we configure the testingModule right in the same way we could configure the MenuModule with the difference here that tests always have to use the mockBackend because we do not want to really depend on a server to test our components.</p>
</div>
<div class="paragraph">
<p>Once configured the test module, we have to prepare the context of the test, in this case we create the component, that is exactly what is going on in the <code>beforeEach()</code> function.</p>
</div>
<div class="paragraph">
<p>Finally, we are ready to use the component and it&#8217;s fixture to check if the component has bee correctly created.</p>
</div>
<div class="paragraph">
<p>At this moment this is the case for most of the components, in the future, some work would be applied on this matter to have a full testing experience in MyThaiStar components.</p>
</div>
<div class="sect5">
<h6 id="angular-testing.asciidoc_dialog-components">Dialog components</h6>
<div class="paragraph">
<p>Dialog components are in a special category because they can not be tested normally. In the way Material implements the opening of dialogs, you have to create a component that will load into a dialog, to tell the module to load this components when needed, they have to be added into a special array category: <em>EntryComponents</em>. So, to test them, we need to import them in the test file as well.</p>
</div>
<div class="paragraph">
<p>Also, the testing code to open the component is a bit different too:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-javascript hljs" data-lang="javascript">...
  beforeEach(() =&gt; {
    dialog = TestBed.get(MdDialog);
    component = dialog.open(CommentDialogComponent).componentInstance;
  });
...</code></pre>
</div>
</div>
<div class="paragraph">
<p>That is right, the <code>beforeEach()</code> function is slightly different from the the example above, in this case we have to force to the test to know that the component is only displayed in a dialog, so we have to open a dialog with this component in order to access it.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="angular-testing.asciidoc_testing-services">Testing Services</h5>
<div class="paragraph">
<p>As well as components, services can be tested too, actually, they are even more necessary to be tested because they have inside more complex logic and data management.</p>
</div>
<div class="paragraph">
<p>As an example of testing services i am going to use a well done services, with a specific purpose and with its logic completely tested, the price-calculator service:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-javascript hljs" data-lang="javascript">...

describe('PriceCalculatorService', () =&gt; {

  beforeEach(() =&gt; {
    TestBed.configureTestingModule({
      providers: [PriceCalculatorService],
    });
  });

  it('should be properly injected', inject([PriceCalculatorService], (service: PriceCalculatorService) =&gt; {
    expect(service).toBeTruthy();
  }));

  describe('check getPrice method', () =&gt; {

    it('should calculate price for single order without extras', inject([PriceCalculatorService], (service: PriceCalculatorService) =&gt; {
      const order: OrderView = {
        dish: {
          id: 0,
          price: 12.50,
          name: 'Order without extras',
        },
        orderLine: {
          comment: '',
          amount: 1,
        },
        extras: [],
      };

      expect(service.getPrice(order)).toEqual(order.dish.price);
    }));
...</code></pre>
</div>
</div>
<div class="paragraph">
<p>In services test, we have to inject the service in order to use it, then we can define some initializing contexts to test if the functions of the services returns the expected values, in the example we can see how an imaginary order is created and expected the function <code>getPrice()</code> to correctly calculate the price of that order.</p>
</div>
<div class="paragraph">
<p>In this same test file you can find some more test regarding all the possibilities of use in that services: orders with and without extras, single order, multiple orders and so on.</p>
</div>
<div class="paragraph">
<p>Some services as well as the components have only tested that they are correctly created and they dependencies properly injected, in the future, will be full covering regarding this services test coverage.</p>
</div>
</div>
<div class="sect4">
<h5 id="angular-testing.asciidoc_testing-in-a-ci-environment">Testing in a CI environment</h5>

</div>
</div>
<div class="sect3">
<h4 id="xamarin-testing.asciidoc">54.2.2. Xamarin testing</h4>
<div class="paragraph">
<p>TODO</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="master-my-thai-star.asciidoc_end-to-end">54.3. End to end</h3>
<!-- toc disabled -->
<div class="sect3">
<h4 id="mrchecker.asciidoc">54.3.1. MrChecker E2E Testing</h4>
<div class="sect4">
<h5 id="mrchecker.asciidoc_introduction">Introduction</h5>
<div class="paragraph">
<p>MrChecker is a testing framework included in devonfw with several useful modules, from which we will focus on the Selenium Module, a module designed to make end-to-end testing easier to implement.</p>
</div>
</div>
<div class="sect4">
<h5 id="mrchecker.asciidoc_how-to-use-it">How to use it</h5>
<div class="paragraph">
<p>First of all download the repository.</p>
</div>
<div class="paragraph">
<p>You must run My Thai Star frontend and backend application and modify your url to the front in <code>mrchecker/endtoend-test/src/resources/settings.properties</code></p>
</div>
<div class="paragraph">
<p>Now you can run end to end test to <strong>check</strong> if the application works properly.</p>
</div>
<div class="paragraph">
<p>To run the e2e test you have two options:</p>
</div>
<div class="paragraph">
<p><strong>The first option is using the command line in devonfw distribution</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>cd mrchecker/endtoend-test/
mvn test -Dtest=MyThaiStarTest -Dbrowser=Chrome</code></pre>
</div>
</div>
<div class="paragraph">
<p>optionally you can use it with a headless version or using another navigator:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>// chrome headless (without visual component)
mvn test -Dtest=MyThaiStarTest -Dbrowser=ChromeHeadless
// use firefox navigator
mvn test -Dtest=MyThaiStarTest -Dbrowser=FireFox</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>The second is importing the project in devonfw Eclipse and running <em>MyThaiStarTest.java</em> as JUnit (right click, run as JUnit)</strong></p>
</div>
<div class="paragraph">
<p>They can be executed one by one or all in one go, comment or uncomment <em>@Test</em> before those tests to enable or disable them.</p>
</div>
<div class="paragraph">
<p>For more information about how to use MrChecker and build your own end to end test read:
 * MrChecker documentation
 * MrChecker tutorial for My Thai Star</p>
</div>
</div>
<div class="sect4">
<h5 id="mrchecker.asciidoc_end-to-end-tests-in-my-thai-star">End to end tests in My Thai Star</h5>
<div class="paragraph">
<p>We have included a test suite with four tests to run in My Thai Star to verify everything works properly.</p>
</div>
<div class="paragraph">
<p>The included tests do the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>Test_loginAndLogOut</em>: Log in and log out.</p>
</li>
<li>
<p><em>Test_loginFake</em>: Attempt to log in with a fake user.</p>
</li>
<li>
<p><em>Test_bookTable</em>: Log in and book a table, then login with a waiter and check if the table was successfully booked.</p>
</li>
<li>
<p><em>Test_orderMenu</em>: Log in and order food for a certain booked table.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>These four tests can be found inside <strong>MyThaiStarTest.java</strong> located <a href="https://github.com/devonfw/my-thai-star/tree/develop/mrchecker/endtoend-test/src/test/java/com/devonfw/mts/tests">here</a>.</p>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="master-my-thai-star.asciidoc_ui-design">55. UI design</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="style-guide.asciidoc">55.1. Style guide</h3>
<div class="imageblock">
<div class="content">
<a class="image" href="images/mts_styleguide.png"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/mts_styleguide.png" alt="mts styleguide"></a>
</div>
</div>
</div>
<div class="sect2">
<h3 id="style-guide.asciidoc">55.2. Low and high fidelity wireframes</h3>
<div class="paragraph">
<p>History of mockup designs for My Thai Star.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#resources/MTS_Wireframes_Low_Fidelity.pdf">MTS Wireframes Low Fidelity</a></p>
</li>
<li>
<p><a href="#resources/MTS_Wireframes_High_Fidelity_(Sprint_1).pdf">MTS Wireframes High Fidelity (Sprint 1)</a></p>
</li>
<li>
<p><a href="#resources/MTS_Wireframes_High_Fidelity_(Sprint_1)-Copy.pdf">MTS Wireframes High Fidelity (Sprint 1) - Copy</a></p>
</li>
<li>
<p><a href="#resources/MTS_Wireframes_High_Fidelity_(Sprint_1)-Mobile.pdf">MTS Wireframes High Fidelity (Sprint 1) - Mobile</a></p>
</li>
<li>
<p><a href="#resources/MTS_Wireframes_High_Fidelity_(Sprint_2).pdf">MTS Wireframes High Fidelity (Sprint 2)</a></p>
</li>
<li>
<p><a href="#resources/MTS_Wireframes_High_Fidelity_(Sprint_2)-Modifications.pdf">MTS Wireframes High Fidelity (Sprint 2) - Modifications</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="master-my-thai-star.asciidoc_cicd">56. CI/CD</h2>
<div class="sectionbody">
<!-- toc disabled -->
<div class="sect2">
<h3 id="production-line-ci.asciidoc">56.1. My Thai Star in Production Line</h3>
<div class="sect4">
<h5 id="production-line-ci.asciidoc_what-is-pl">What is PL?</h5>
<div class="paragraph">
<p>The Production Line Project is a set of server-side collaboration tools for Capgemini engagements. It has been developed for supporting project engagements with individual tools like issue tracking, continuous integration, continuous deployment, documentation, binary storage and much more!</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/ci/pl_logo.png"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/ci/pl_logo.png" alt="pl logo"></a>
</div>
</div>
</div>
<div class="sect4">
<h5 id="production-line-ci.asciidoc_introduction">Introduction</h5>
<div class="paragraph">
<p>Although the PL Project is a wide set of tools, only 3 are going to be mainly used for My Thai Star projects to build a Continuous Integration and Continuos Delivery environment. All three are available in the <a href="https://devon.s2-eu.capgemini.com/#https://devon.s2-eu.capgemini.com/jenkins/">PL instance</a> used for this project.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Jenkins</p>
<div class="paragraph">
<p>This is going to be the "main tool". Jenkins helps to automate the non-human part of the development with Continuos Integration and is going to host all Pipelines (and, obviously, execute them).</p>
</div>
</li>
<li>
<p>Nexus</p>
<div class="paragraph">
<p>Nexus manages software "artifacts" required for development. It is possible to both download dependencies from Nexus and publish artifacts as well. It allows to share resources within an organization.</p>
</div>
</li>
<li>
<p>SonarQube</p>
<div class="paragraph">
<p>It is a platform for continuous inspection of the code. It is going to be used for the Java back-end.</p>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="production-line-ci.asciidoc_where-can-i-find-all-my-thai-star-pipelines">56.1.3. Where can I find all My Thai Star Pipelines?</h4>
<div class="paragraph">
<p>They are located under the <strong>MTS</strong> folder of the PL instance:</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="iamges/jenkins/mts-pipelines.png"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/jenkins/mts-pipelines.png" alt="mts pipelines"></a>
</div>
</div>
<div class="paragraph">
<p>Those Jenkins Pipelines will not have any code to execute. They&#8217;re just pointing to all <strong>Jenkinsfiles</strong> under the <code>/jenkins</code> folder of the repository. They can be found <a href="https://github.com/devonfw/my-thai-star/tree/develop/jenkins">here</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="production-line-ci.asciidoc_ci-in-my-thai-star-stack">56.1.4. CI in My Thai Star stack</h4>
<div class="ulist">
<ul>
<li>
<p><a href="#angular-ci.asciidoc">Angular CI</a></p>
</li>
<li>
<p><a href="#java-ci.asciidoc">Java CI</a></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="production-line-ci.asciidoc_how-to-configure-everything-out-of-the-box">56.1.5. How to configure everything out of the box</h4>
<div class="paragraph">
<p>Production Line currently has a template to integrate My Thai Star. All information can be found at <a href="https://github.com/devonfw-forge/devon-production-line">devon production line repository</a></p>
</div>
<!-- toc disabled -->
</div>
<div class="sect3">
<h4 id="angular-ci.asciidoc">56.1.6. Angular CI</h4>
<div class="paragraph">
<p>The Angular client-side of My Thai Star is going to have some specific needs for the CI-CD Pipeline to perform mandatory operations.</p>
</div>
<div class="sect4">
<h5 id="angular-ci.asciidoc_pipeline">Pipeline</h5>
<div class="paragraph">
<p>The Pipeline for the Angular client-side is going to be called <strong>MyThaiStar_FRONTEND_BUILD</strong>. It is located in the PL instance, under the <a href="https://devon.s2-eu.capgemini.com/jenkins/job/MTS/">MTS folder</a> (as previously explained). It is going to follow a process flow like this one:</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="angular_pipeline_flow.PNG"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/ci/angular/angular_pipeline_flow.PNG" alt="angular pipeline flow"></a>
</div>
</div>
<div class="paragraph">
<p>Each of those steps are called <em>stages</em> in the Jenkins context.Let&#8217;s see what those steps mean in the context of the Angular application:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><strong>Declarative: Checkout SCM</strong></p>
<div class="paragraph">
<p>Retrieves the project from the GitHub repository which it&#8217;s located. This step is not defined directly in our pipeline, but as it is loaded from the repository this step should always be done at the beginning.</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="pipeline_config.PNG"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/ci/angular/pipeline-config.png" alt="pipeline config"></a>
</div>
</div>
</li>
<li>
<p><strong>Declarative: Tool Install</strong></p>
<div class="paragraph">
<p>The Pipeline needs some Tools to perform some operations with the Angular project. These tool is a correct version of <strong>NodeJS</strong> (10.14.0 LTS) with <strong>Yarn</strong> installed as global package.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">tools {
    nodejs "NodeJS 10.14.0"
}</code></pre>
</div>
</div>
</li>
<li>
<p><strong>Loading Custom Tools</strong></p>
<div class="paragraph">
<p>The Pipeline also needs a browser in order to execute the tests, so in this step the chrome-stable will be loaded. We will use it in a headless mode.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">tool chrome</code></pre>
</div>
</div>
</li>
<li>
<p><strong>Fresh Dependency Installation</strong></p>
<div class="paragraph">
<p>The script <code>$ yarn</code> does a package installation. As we always clean the workspace after the pipeline, all packages must be installed in every execution.</p>
</div>
</li>
<li>
<p><strong>Code Linting</strong></p>
<div class="paragraph">
<p>This script executes a linting process of TypeScript. Rules can be defined in the <code>tslint.json</code> file of the project. It throws an exception whenever a file contains a non-compliant piece of code.</p>
</div>
</li>
<li>
<p><strong>Execute Angular tests</strong></p>
<div class="paragraph">
<p>The CI testing of the Angular client is different than the standard local testing (addapted to CI environments, as specified in the <strong>Addaptation</strong> section of document). This script just executes the following commands:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">ng test --browsers ChromeHeadless --watch=false</code></pre>
</div>
</div>
</li>
<li>
<p><strong>SonarQube code analysis</strong></p>
<div class="paragraph">
<p>The script load and execute the tool <code>sonar-scanner</code>. This tool is loaded here because it&#8217;s not used in any other part of the pipeline. The <code>sonar-scanner</code> will take all code, upload it to sonarQube and wait until sonarQube send us a response with the quality of our code. If the code do not pass the quality gate, the pipeline will stop at this point.</p>
</div>
</li>
<li>
<p><strong>Build Application</strong></p>
<div class="paragraph">
<p>The building process of the Angular client would result in a folder called <code>/dist</code> in the main Angular&#8217;s directory. That folder is the one that is going to be served afterwards as an artifact. This process has also been addapted to some Deployment needs. This building script executes the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">ng build --configuration=docker</code></pre>
</div>
</div>
</li>
<li>
<p><strong>Deliver application into Nexus</strong></p>
<div class="paragraph">
<p>Once the scripts produce the Angular artifact (<code>/dist</code> folder), it&#8217;s time to package it and store into nexus.</p>
</div>
</li>
<li>
<p>Declarative: Post Actions</p>
<div class="paragraph">
<p>At the end, this step is always executed, even if a previous stage fail. We use this step to clean up the workspace for future executions</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">post {
    always {
        cleanWs()
    }
}</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="angular-ci.asciidoc_adjustments">Adjustments</h5>
<div class="paragraph">
<p>The Angular project Pipeline needed some "extra" features to complete all planned processes. Those features resulted in some additions to the project.</p>
</div>
<div class="sect5">
<h6 id="angular-ci.asciidoc_pipeline-environment">Pipeline Environment</h6>
<div class="paragraph">
<p>In order to easily reuse the pipeline in other angular projects, all variables have been defined in the block environment. All variables have the default values that Production Line uses, so if you&#8217;re going to work in production line you won&#8217;t have to change anything. Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">environment {
    // Script for build the application. Defined at package.json
    buildScript = 'build --configuration=docker'
    // Script for lint the application. Defined at package.json
    lintScript = 'lint'
    // Script for test the application. Defined at package.json
    testScript = 'test:ci'
    // Angular directory
    angularDir = 'angular'
    // SRC folder. It will be angularDir/srcDir
    srcDir = 'src'
    // Name of the custom tool for chrome stable
    chrome = 'Chrome-stable'

    // sonarQube
    // Name of the sonarQube tool
    sonarTool = 'SonarQube'
    // Name of the sonarQube environment
    sonarEnv = "SonarQube"

    // Nexus
    // Artifact groupId
    groupId = 'com.devonfw.mythaistar'
    // Nexus repository ID
    repositoryId = 'pl-nexus'
    // Nexus internal URL
    repositoryUrl = 'http://nexus3-core:8081/nexus3/repository/maven-snapshots'
    // Maven global settings configuration ID
    globalSettingsId = 'MavenSettings'
    // Maven tool id
    mavenInstallation = 'Maven3'
}</code></pre>
</div>
</div>
<div class="sect6">
<h7 id="angular-ci.asciidoc_description">Description</h7>
<div class="ulist">
<ul>
<li>
<p><strong>buildScript</strong>: script for build the applicaction. It must be defined at package.json.</p>
<div class="paragraph">
<p>Example (package.json):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
    "name": "mythaistar-restaurant",
    ...
    "scripts": {
        ...
        "build": "ng build",
        ...
    }
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This will be used as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">sh """yarn ${buildScript}"""</code></pre>
</div>
</div>
</li>
<li>
<p><strong>lintScript</strong>: Script for lint the application. Defined at package.json</p>
<div class="paragraph">
<p>Example (package.json):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
    "name": "mythaistar-restaurant",
    ...
    "scripts": {
        ...
        "lint": "ng lint",
        ...
    }
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This will be used as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">sh """yarn ${lintScript}"""</code></pre>
</div>
</div>
</li>
<li>
<p><strong>testScript</strong>: Script for test the application. Defined at package.json</p>
<div class="paragraph">
<p>Example (package.json):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
    "name": "mythaistar-restaurant",
    ...
    "scripts": {
        ...
        "test:ci": "npm run postinstall:web &amp;&amp; ng test --browsers ChromeHeadless --watch=false",
        ...
    }
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This will be used as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">sh """yarn ${testScript}"""</code></pre>
</div>
</div>
</li>
<li>
<p><strong>angularDir</strong>: Relative route to angular application. In My Thai Star this is the angular folder. The actual directory (.) is also allowed.</p>
<div class="imageblock">
<div class="content">
<a class="image" href="angular_directory.PNG"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/ci/angular/angular_directory.png" alt="angular directory"></a>
</div>
</div>
</li>
<li>
<p><strong>srcDir</strong>: Directory where you store the soruce code. For angular applications the default value is <code>src</code></p>
<div class="imageblock">
<div class="content">
<a class="image" href="src_directory.PNG"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/ci/angular/src_directory.png" alt="src directory"></a>
</div>
</div>
</li>
<li>
<p><strong>chrome</strong>: Since you need a browser to run your tests, we must provide one. This variable contains the name of the custom tool for google chrome.</p>
<div class="imageblock">
<div class="content">
<a class="image" href="chrome_installation.PNG"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/ci/angular/chrome_installation.png" alt="chrome installation"></a>
</div>
</div>
</li>
<li>
<p><strong>sonarTool</strong>: Name of the sonarQube scanner installation.</p>
<div class="imageblock">
<div class="content">
<a class="image" href="sonar-scanner.PNG"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/ci/angular/sonar-scanner.png" alt="sonar scanner"></a>
</div>
</div>
</li>
<li>
<p><strong>sonarEnv</strong>: Name of the sonarQube environment. SonarQube is the default value for PL.</p>
<div class="imageblock">
<div class="content">
<a class="image" href="sonar-env.PNG"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/ci/angular/sonar-env.png" alt="sonar env"></a>
</div>
</div>
</li>
<li>
<p><strong>groupId</strong>: Group id of the application. It will be used to storage the application in nexus3</p>
<div class="imageblock">
<div class="content">
<a class="image" href="nexus3_groupid.PNG"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/ci/angular/nexus3_groupid.png" alt="nexus3 groupid"></a>
</div>
</div>
</li>
<li>
<p><strong>repositoryId</strong>: Id of the nexus3 repository. It must be defined at maven global config file.</p>
<div class="imageblock">
<div class="content">
<a class="image" href="nexus3_id.PNG"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/ci/angular/nexus3_id.png" alt="nexus3 id"></a>
</div>
</div>
</li>
<li>
<p><strong>repositoryUrl</strong>: The url of the repository.</p>
</li>
<li>
<p><strong>globalSettingsId</strong>: The id of the global settings file.</p>
<div class="imageblock">
<div class="content">
<a class="image" href="nexus3_global_config.PNG"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/ci/angular/nexus3_global_config.png" alt="nexus3 global config"></a>
</div>
</div>
</li>
<li>
<p>mavenInstallation: The name of the maven tool.</p>
<div class="imageblock">
<div class="content">
<a class="image" href="maven_tool.PNG"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/ci/angular/maven_tool.png" alt="maven tool"></a>
</div>
</div>
</li>
</ul>
</div>
<!-- toc disabled -->
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="java-ci.asciidoc">56.1.7. Java CI</h4>
<div class="paragraph">
<p>The Java server-side of My Thai Star is an <strong>devon4j</strong>-based application. As long as <strong>Maven</strong> and a <strong>Java 8</strong> are going to be needed, the Pipeline should have those tools available as well.</p>
</div>
<div class="sect4">
<h5 id="java-ci.asciidoc_pipeline">Pipeline</h5>
<div class="paragraph">
<p>This Pipeline is called <strong>MyThaiStar_SERVER_BUILD</strong>, and it is located exactly in the same PL instance&#8217;s folder than <strong>MyThaiStar_FRONTEND_BUILD</strong>. Let&#8217;s see how the Pipeline&#8217;s flow behaves.</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="java_pipeline_flow.PNG"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/ci/java/java_pipeline_flow.PNG" alt="java pipeline flow"></a>
</div>
</div>
<div class="paragraph">
<p>Check those Pipeline stages with more detail:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><strong>Declarative: Checkout SCM</strong></p>
<div class="paragraph">
<p>Gets the code from <a href="https://github.com/devonfw/my-thai-star" class="bare">https://github.com/devonfw/my-thai-star</a> . This step is not defined directly in our pipeline, but as it is loaded from the repository this step should always be done at the beginning.</p>
</div>
</li>
<li>
<p><strong>Unit Tests</strong></p>
<div class="paragraph">
<p>This step will execute the project unit test with maven.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">mvn clean test</code></pre>
</div>
</div>
</li>
<li>
<p><strong>SonarQube analysis</strong></p>
<div class="paragraph">
<p>The code is evaluated using the integrated PL instance&#8217;s SonarQube. Also, it will wait for the quality gate status. If the status is failing, the pipeline execution will be stoped.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">withSonarQubeEnv(sonarEnv) {
    sh "mvn sonar:sonar"
}

def qg = waitForQualityGate()
if (qg.status != 'OK') {
    error "Pipeline aborted due to quality gate failure: ${qg.status}"
}</code></pre>
</div>
</div>
</li>
<li>
<p><strong>Deliver application into Nexus</strong></p>
<div class="paragraph">
<p>Store all artifacts into nexus.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">mvn deploy -Dmaven.test.skip=true</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="java-ci.asciidoc_adjustments">Adjustments</h5>
<div class="sect5">
<h6 id="java-ci.asciidoc_pipeline-environment">Pipeline Environment</h6>
<div class="paragraph">
<p>In order to easily reuse the pipeline in other java projects, all variables have been defined in the block environment. All variables have the default values that Production Line uses, so if you&#8217;re going to work in production line you won&#8217;t have to change anything. Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">environment {
    // Directory with java project
    javaDir = 'java/mtsj'

    // sonarQube
    // Name of the sonarQube environment
    sonarEnv = "SonarQube"

    // Nexus 3
    // Maven global settings configuration ID
    globalSettingsId = 'MavenSettings'
    // Maven tool id
    mavenInstallation = 'Maven3'
}</code></pre>
</div>
</div>
<div class="sect6">
<h7 id="java-ci.asciidoc_description">Description</h7>
<div class="ulist">
<ul>
<li>
<p><strong>javaDir</strong>: Relative route to java application. In My Thai Star this is the java/mtsj folder. The actual directory (.) is also allowed.</p>
<div class="imageblock">
<div class="content">
<a class="image" href="java_directory.png"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/ci/java/java_directory.png" alt="java directory"></a>
</div>
</div>
</li>
<li>
<p><strong>sonarEnv</strong>: Name of the sonarQube environment. SonarQube is the default value for PL.</p>
</li>
<li>
<p><strong>globalSettingsId</strong>: The id of the global settings file. MavenSettings is the default value for PL.</p>
<div class="imageblock">
<div class="content">
<a class="image" href="nexus3_global_config.PNG"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/ci/angular/nexus3_global_config.png" alt="nexus3 global config"></a>
</div>
</div>
</li>
<li>
<p><strong>mavenInstallation</strong>: The name of the maven tool. Maven3 is the default value for PL.</p>
<div class="imageblock">
<div class="content">
<a class="image" href="maven_tool.PNG"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/ci/angular/maven_tool.png" alt="maven tool"></a>
</div>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect5">
<h6 id="java-ci.asciidoc_distribution-management">Distribution management</h6>
<div class="paragraph">
<p>The only <em>extra</em> thing that needs to be added to the Java server-side is some information that determines where the artifact of the project is going to be stored in <strong>Nexus</strong>. This is going to be a section in the main <code>pom.xml</code> file called <code>&lt;distributionManagement&gt;</code>. This section will point to the PL instance&#8217;s Nexus. Let&#8217;s have a look at it. It&#8217;s already configured with the PL default values.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;distributionManagement&gt;
    &lt;repository&gt;
      &lt;id&gt;pl-nexus&lt;/id&gt;
      &lt;name&gt;PL Releases&lt;/name&gt;
      &lt;url&gt;http://nexus3-core:8081/nexus/content/repositories/maven-releases/&lt;/url&gt;
    &lt;/repository&gt;
    &lt;snapshotRepository&gt;
      &lt;id&gt;pl-nexus&lt;/id&gt;
      &lt;name&gt;PL Snapshots&lt;/name&gt;
      &lt;url&gt;http://nexus3-core:8081/nexus3/repository/maven-snapshots&lt;/url&gt;
    &lt;/snapshotRepository&gt;
&lt;/distributionManagement&gt;</code></pre>
</div>
</div>
<!-- toc disabled -->
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="deployment.asciidoc">56.2. Deployment</h3>
<div class="paragraph">
<p>The main deployment tool used for <strong>My Thai Star</strong> is be <strong>Docker</strong>.</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="https://www.docker.com/"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/ci/deployment/docker.png" alt="docker"></a>
</div>
</div>
<div class="paragraph">
<p>It is a tool to run application in isolated environments. Those <em>isolated environments</em> will be what we call <strong>Docker containers</strong>. For instance, it won&#8217;t be necessary any installation of <strong>nginx</strong> or <strong>Apache tomcat</strong> or anything necessary to deploy, because there will be some containers that actually <em>have</em> those technologies inside.</p>
</div>
<div class="sect4">
<h5 id="deployment.asciidoc_where-docker-containers-will-be-running">Where Docker containers will be running?</h5>
<div class="paragraph">
<p>Of course, it is necessary to have an external Deployment Server. Every Docker process will run in it. It will be accessed from Production Line pipelines via <strong>SSH</strong>. Thus, the pipeline itself will manage the scenario of, if every previous process like testing passes as OK, stop actual containers and create new ones.</p>
</div>
<div class="paragraph">
<p>This external server will be located in <a href="http://de-mucdevondepl01" class="bare">http://de-mucdevondepl01</a> .</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="deployment.asciidoc">56.3. Container Schema</h3>
<div class="paragraph">
<p>3 Docker containers are being used for the deployment of My Thai Star:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><strong>nginx</strong> for the Reverse Proxy</p>
</li>
<li>
<p><strong>tomcat</strong> for the Java Server</p>
</li>
<li>
<p><strong>nginx</strong> for the Angular Client</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The usage of the <strong>Reverse Proxy</strong> will allow the client to call via <code>/api</code> every single Java Server&#8217;s REST operation. Moreover, there will only be 1 port in usage in the remote Docker host, the one mapped for the Reverse Proxy: <code>8080</code>.
Besides the deployment itself using <strong>nginx</strong> and <strong>tomcat</strong>, both client and server are previously built using <strong>nodejs</strong> and <strong>maven</strong> images. Artifacts produced by them will be pasted in servers' containers using multi-stage docker builds. It will all follow this schema:</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="https://user-images.githubusercontent.com/20857839/36028242-8998f41c-0d9e-11e8-93b3-6bfe50152bf8.png"><img src="https://user-images.githubusercontent.com/20857839/36028242-8998f41c-0d9e-11e8-93b3-6bfe50152bf8.png" alt="36028242 8998f41c 0d9e 11e8 93b3 6bfe50152bf8"></a>
</div>
</div>
<div class="paragraph">
<p>This orchestration of all 3 containers will be done by using a <code>docker-compose.yml</code> file. To redirect traffic from one container to another (i.e. rever-proxy to angular client or angular client to java server) will be done by using, as hostnames, the service name <code>docker-compose</code> defines for each of them, followed by the internal exposed port:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code><a href="http://reverse-proxy:80" class="bare">http://reverse-proxy:80</a></code></p>
</li>
<li>
<p><code><a href="http://angular:80" class="bare">http://angular:80</a></code></p>
</li>
<li>
<p><code><a href="http://java:8080" class="bare">http://java:8080</a></code></p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
A implementation using <a href="#traefik-reverse-proxy.asciidoc">Traefik as reverse proxy</a> instead of NGINX is also available.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="deployment.asciidoc">56.4. Run My Thai Star</h3>
<div class="paragraph">
<p>The steps to run <strong>My Thai Star</strong> are:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Clone the repository <code>$ git clone <a href="https://github.com/devonfw/my-thai-star.git" class="bare">https://github.com/devonfw/my-thai-star.git</a></code></p>
</li>
<li>
<p>Run the docker compose command: <code>$ docker-compose up</code></p>
</li>
</ol>
</div>
<!-- toc disabled -->
<div class="sect3">
<h4 id="deployment-pipelines.asciidoc">56.4.1. Deployment Pipelines</h4>
<div class="paragraph">
<p>As PL does not support deployments, we have created separate pipelines for this purpose. Those pipelines are: <strong>MyThaiStar_DEPLOY-Together</strong>, <strong>MyThaiStar_FRONTEND_DEPLOY</strong> and <strong>MyThaiStar_SERVER_DEPLOY</strong>.</p>
</div>
<div class="paragraph">
<p>The application will be deployed using docker on a remote machine. The architecture is as follows:</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/ci/deployment/deployment_arch.png"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/ci/deployment/deployment_arch.png" alt="deployment arch"></a>
</div>
</div>
<div class="paragraph">
<p>The parts to be deployed are: an NGINX reverse proxy, the java application and the angular application.</p>
</div>
<div class="sect4">
<h5 id="deployment-pipelines.asciidoc_mythaistar_deploy-together-pipeline">MyThaiStar_DEPLOY-Together Pipeline</h5>
<div class="paragraph">
<p>The MyThaiStar_DEPLOY-Together pipeline will deploy all parts of My Thai Star application into a remote server via ssh.</p>
</div>
<div class="sect5">
<h6 id="deployment-pipelines.asciidoc_parameters">Parameters</h6>
<div class="ulist">
<ul>
<li>
<p><strong>sshAgentCredentials</strong>: The SSH private key to connecto to remote server. The public key must be included in the remote server as a authorized_keys.</p>
</li>
<li>
<p><strong>nexusApiUrl</strong>: The url to the nexus api. <a href="http://nexus3-core:8081/nexus3" class="bare">http://nexus3-core:8081/nexus3</a> is the default url for PL.</p>
</li>
<li>
<p><strong>nexusCredentialsId</strong>: The nexus credentials.</p>
</li>
<li>
<p><strong>repository</strong>: Name of the repository where the artifacts are stored. maven-snapshots is the default value for PL.</p>
</li>
<li>
<p><strong>JAVA_VERSION</strong>: The version of the java project that you want to deploy.</p>
</li>
<li>
<p><strong>ANGULAR_VERSION</strong>: The version of the java project that you want to deploy.</p>
</li>
<li>
<p><strong>EXTERNAL_SERVER_IP</strong>: The IP of the remote server where you will deploy My Thai Star.</p>
</li>
<li>
<p><strong>APPLICATION_DIR</strong>: The folder of the application.</p>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="deployment-pipelines.asciidoc_pipeline-steps">Pipeline steps</h6>
<div class="ulist">
<ul>
<li>
<p><strong>Copy files to remote server</strong>: Copy all files required for the deployment to the remote server. Those files are all files inside the reverse_proxy folder in the My Thai Star repository.</p>
</li>
<li>
<p><strong>Deploy java application</strong>: Call to <strong>MyThaiStar_SERVER_DEPLOY</strong> pipeline.</p>
</li>
<li>
<p><strong>Deploy angular application</strong>: Call to <strong>MyThaiStar_FRONTEND_DEPLOY</strong> pipeline.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect4">
<h5 id="deployment-pipelines.asciidoc_mythaistar_server_deploy-pipeline">MyThaiStar_SERVER_DEPLOY Pipeline</h5>
<div class="paragraph">
<p>Deploys on the server the Java part of My Thai Star.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
You need to run the MyThaiStar_DEPLOY-Together pipeline at least once before you run this one.
</td>
</tr>
</table>
</div>
<div class="sect5">
<h6 id="deployment-pipelines.asciidoc_parameters">Parameters</h6>
<div class="ulist">
<ul>
<li>
<p><strong>sshAgentCredentials</strong>: The SSH private key to connecto to remote server. The public key must be included in the remote server as a authorized_keys.</p>
</li>
<li>
<p><strong>nexusApiUrl</strong>: The url to the nexus api. <a href="http://nexus3-core:8081/nexus3" class="bare">http://nexus3-core:8081/nexus3</a> is the default url for PL.</p>
</li>
<li>
<p><strong>nexusCredentialsId</strong>: The nexus credentials.</p>
</li>
<li>
<p><strong>repository</strong>: Name of the repository where the artifacts are stored. maven-snapshots is the default value for PL.</p>
</li>
<li>
<p><strong>JAVA_VERSION</strong>: The version of the java project that you want to deploy.</p>
</li>
<li>
<p><strong>EXTERNAL_SERVER_IP</strong>: The IP of the remote server where you will deploy My Thai Star.</p>
</li>
<li>
<p><strong>APPLICATION_DIR</strong>: The folder of the application.</p>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="deployment-pipelines.asciidoc_pipeline-steps">Pipeline steps</h6>
<div class="ulist">
<ul>
<li>
<p><strong>Download artifact from Nexus</strong>: Download the artifact from nexus using the nexus3 API. The downloaded artifact will be the last snapshot of the version specified in the parameters.</p>
</li>
<li>
<p><strong>Deployment</strong>: Deploy the download artifact in the remote server. It will create a new docker image and redeploy the java docker container.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect4">
<h5 id="deployment-pipelines.asciidoc_mythaistar_frontend_deploy">MyThaiStar_FRONTEND_DEPLOY</h5>
<div class="paragraph">
<p>Deploys on the server the Angular part of My Thai Star</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
You need to run the MyThaiStar_DEPLOY-Together pipeline at least once before you run this one.
</td>
</tr>
</table>
</div>
<div class="sect5">
<h6 id="deployment-pipelines.asciidoc_parameters">Parameters</h6>
<div class="ulist">
<ul>
<li>
<p><strong>sshAgentCredentials</strong>: The SSH private key to connecto to remote server. The public key must be included in the remote server as a authorized_keys.</p>
</li>
<li>
<p><strong>nexusApiUrl</strong>: The url to the nexus api. <a href="http://nexus3-core:8081/nexus3" class="bare">http://nexus3-core:8081/nexus3</a> is the default url for PL.</p>
</li>
<li>
<p><strong>nexusCredentialsId</strong>: The nexus credentials.</p>
</li>
<li>
<p><strong>repository</strong>: Name of the repository where the artifacts are stored. maven-snapshots is the default value for PL.</p>
</li>
<li>
<p><strong>ANGULAR_VERSION</strong>: The version of the java project that you want to deploy.</p>
</li>
<li>
<p><strong>EXTERNAL_SERVER_IP</strong>: The IP of the remote server where you will deploy My Thai Star.</p>
</li>
<li>
<p><strong>APPLICATION_DIR</strong>: The folder of the application.</p>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="deployment-pipelines.asciidoc_pipeline-steps">Pipeline steps</h6>
<div class="ulist">
<ul>
<li>
<p><strong>Download artifact from Nexus</strong>: Download the artifact from nexus using the nexus3 API. The downloaded artifact will be the last snapshot of the version specified in the parameters.</p>
</li>
<li>
<p><strong>Deployment</strong>: Deploy the download artifact in the remote server. It will create a new docker image and redeploy the angular docker container.</p>
</li>
</ul>
</div>
<!-- toc disabled -->
</div>
</div>
</div>
<div class="sect3">
<h4 id="deployment-strategies.asciidoc">56.4.2. Deployment Strategies</h4>
<div class="paragraph">
<p>In this chapter different way of deploying My Thai Star are explained. Everything will be based in Docker.</p>
</div>
<div class="sect4">
<h5 id="deployment-strategies.asciidoc_independendent-docker-containers">Independendent Docker containers</h5>
<div class="paragraph">
<p>The first way of deployment will use isolated Docker containers. That means that if the client-side container is deployed, it does not affect the server-side container&#8217;s lifecycle and viceversa.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s show how the containers will behave during their life cycle.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>0) Copy everything you need into the Deployment Server directory</p>
</li>
<li>
<p>1) Remove existing container (Nginx or Tomcat)</p>
<div class="imageblock">
<div class="content">
<a class="image" href="container1.png"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/ci/angular/container1.png" alt="container1"></a>
</div>
</div>
</li>
<li>
<p>2) Run new one from the Docker images collection of the external Deployment Server.</p>
<div class="imageblock">
<div class="content">
<a class="image" href="container2.png"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/ci/angular/container2.png" alt="container2"></a>
</div>
</div>
</li>
<li>
<p>3) Add the artifact <code>/dist</code> to the "depoyable" folder of the Docker container (<code>/usr/share/nginx/html/</code>)</p>
<div class="imageblock">
<div class="content">
<a class="image" href="container3.png"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/ci/angular/container3.png" alt="container3"></a>
</div>
</div>
<div class="paragraph">
<p>Now, let&#8217;s see how it&#8217;s being executed in the command line (simplified due to documentation purposes). The next block of code represents what is inside of the last stage of the Pipeline.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">sshagent (credentials: ['my_ssh_token']) {
    sh """
        // Copy artifact from workspace to deployment server

        // Manage container:
        docker rm -f [mts-container]
        docker run -itd --name=[mts-container] [base_image]
        docker exec [mts-container] bash -C \\"rm [container_deployment_folder]/*\\"
        docker cp [artifact] [mts-container]:[container_deployment_folder]
    """
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>For every operation performed in the external Deployment Server, it is necessary to define <em>where</em> those commands are going to be executed. So, for each one of previous <code>docker</code> commands, this should appear before:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>ssh -o StrictHostKeyChecking=no root@10.40.235.244</pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="deployment-strategies.asciidoc_docker-compose">Docker Compose</h5>
<div class="paragraph">
<p>The second way of deployment will be by orchestrating both elements of the application: The Angular client-side and the Java server-side. Both elements will be running in Docker containers as well, but in this case they won&#8217;t be independendent anymore. <strong>Docker Compose</strong> will be in charge of keeping both containers up, or to put them down.</p>
</div>
<div class="sect5">
<h6 id="deployment-strategies.asciidoc_project-adjustment">Project adjustment</h6>
<div class="paragraph">
<p>In order to perform this second way of deployment, some files will be created in the project. The first one is the <strong>Dockerfile</strong> for the Angular client-side. This file will pull (if necessary) an <strong>nginx</strong> Docker image and copy the Angular artifact (<code>/dist</code> folder) inside of the deployment folder of the image. It will be located in the main directory of the Angular client-side project.</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="dockerfile-angular.PNG"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/ci/deployment/dockerfile-angular.PNG" alt="dockerfile angular"></a>
</div>
</div>
<div class="paragraph">
<p>The second file is the <strong>Dockerfile</strong> for the Java server-side. Its function will be quite similar to the Angular one. It will run a <strong>tomcat</strong> Docker image and copy the Java artifact (<code>mythaistar.war</code> file) in its deployment folder.</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="dockerfile-java.PNG"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/ci/deployment/dockerfile-java.PNG" alt="dockerfile java"></a>
</div>
</div>
<div class="paragraph">
<p>Finally, as long as the <strong>docker-compose</strong> is being used, a file containing its configuration will be necessary as well. A new folder one the main My That Star&#8217;s directory is created, and it&#8217;s called <code>/docker</code>. Inside there is just a <code>docker-compose.yml</code> file. It contains all the information needed to orchestrate the deployment process. For example, which port both containers are going to be published on, and so on. This way of deployment will allow the application to be published or not just with one action.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>docker-compose rm -f            # down
docker-compsoe up --build -d    # up fresh containers</pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="docker-compose.PNG"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/ci/deployment/docker-compose.PNG" alt="docker compose"></a>
</div>
</div>
<div class="paragraph">
<p>Let&#8217;s have a look at the file itself:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">version: '3'
services:
  client_compose:
    build: "angular"
    ports:
      - "8091:80"
    depends_on:
      - server_compose
  server_compose:
    build: "java"
    ports:
      - "9091:8080"</code></pre>
</div>
</div>
<div class="paragraph">
<p>This Orchestrated Deployment will offer some interesting possibilities for <a href="#future-deployment.asciidoc">the future of the application</a>.</p>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="future-deployment.asciidoc">56.4.3. Future Deployment</h4>
<div class="paragraph">
<p>The <strong>My Thai Star</strong> project is going to be built in many technologies. Thus, let&#8217;s think about one deployment schema that allow the Angular client to communicate to all three backends: <strong>Java</strong>, <strong>Node</strong> and <strong>.NET</strong>.</p>
</div>
<div class="paragraph">
<p>As long as <strong>Docker containers</strong> are being used, it shouldn&#8217;t be that hard to deal with this "distributed" deployment. The schema represents 6 Docker containers that will have client-side(s) and server-side(s). Each of 3 Angular client containers (those in red) are going to communicate with different back-ends. So, when the deployment is finished, it would be possible to use all three server-sides just by changing the "port" in the URL.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s see how it would look like:</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/ci/future/deployment_schema.PNG"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/ci/future/deployment_schema.PNG" alt="deployment schema"></a>
</div>
</div>
<!-- toc disabled -->
<div class="sect4">
<h5 id="traefik-reverse-proxy.asciidoc_reverse-proxy-strategy-using-traefik">Reverse proxy strategy using Traefik</h5>
<div class="paragraph">
<p>This implementation is the same as described at <a href="#deployment.asciidoc">My Thai Star deployment wiki page</a>. The only thing that changes is that Traefik is used instead of NGINX.</p>
</div>
<div class="paragraph">
<p>Using Traefik as reverse proxy, we can define the routes using labels in the docker containers instead of using a nginx.conf file. With this, it is not necessary to modify the reverse proxy container for each application. In addition, as Traefik is listening to the docker daemon, it can detect new containers and create routes for them without rebooting.</p>
</div>
<div class="paragraph">
<p>Example of labels:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">labels:
    - "traefik.frontend.rule=PathPrefixStrip:/api/;AddPrefix:/mythaistar"
    - "traefik.backend.healthcheck.path=/mythaistar/services/rest/dishmanagement/v1/category/0/"
    - "traefik.backend.healthcheck.interval=10s"
    - "traefik.backend.healthcheck.scheme=http"</code></pre>
</div>
</div>
<div class="sect5">
<h6 id="traefik-reverse-proxy.asciidoc_how-to-use-it">How to use it</h6>
<div class="paragraph">
<p>If you want to build the images from code, change to My Thai Star root folder and execute:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ docker-compose -f docker-compose.traefik.yml up -d --build</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you want to build the images from artifacts, change to traefik folder (reverse-proxy/traefik) and execute:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ docker-compose up -d --build</code></pre>
</div>
</div>
<div class="paragraph">
<p>After a seconds, when the healthcheck detects that containers are running, your application will be available at <a href="http://localhost:8090" class="bare">http://localhost:8090</a>. Also, the Traefik dashboard is available at <a href="http://localhost:8080" class="bare">http://localhost:8080</a>.</p>
</div>
<div class="paragraph">
<p>If you want to check the behaviour of the application when you scale up the backend, you can execute:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ docker-compose scale java=5</code></pre>
</div>
</div>
<div class="paragraph">
<p>With this, the access to the java backend will be using the load balacing method: Weighted Round Robin.</p>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<h1 id="master-general-end.asciidoc" class="sect0">XI: Contributing Guide</h1>
<div class="openblock partintro">
<div class="content">
<!-- toc disabled -->
</div>
</div>
<div class="sect1">
<h2 id="Contributing-Code.asciidoc">57. Code Contributions</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Moved <a href="https://github.com/devonfw/.github/blob/master/CONTRIBUTING.asciidoc#contributing">here</a>. This document will be removed in the future.</p>
</div>
<div class="sect2">
<h3 id="contributing-code.asciidoc_notes-on-code-contributions">57.1. Notes on Code Contributions</h3>
<div class="paragraph">
<p>devonfw platform is intended to be easy to contribute to. One service allowing such simplicity is GitHub was therefore selected as preferred collaboration platform.</p>
</div>
<div class="paragraph">
<p>In order to contribute code, git and GitHub specific pull-requests are being used.</p>
</div>
<div class="paragraph">
<p>It is mandatory to follow the <a href="#Contributing-Code-of-Conduct.asciidoc">code of conduct</a> that must be present in the root of every OSS or private project as <code>CODE_OF_CONDUCT.asciidoc</code> or <code>CODE_OF_CONDUCT.md</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="contributing-code.asciidoc_introduction-to-git-and-github">57.2. Introduction to Git and GitHub</h3>
<div class="paragraph">
<p>Git is a version control system used for a coordinated and versioned collaboration of computer files. It enables a project to be easily worked on by multiple developers and contributors.</p>
</div>
<div class="paragraph">
<p>GitHub is an online repository used by deonvfw and OASP in order to host the corresponding files. Using the command line tool or any GUI Tool as "GitHub Desktop", "Fork" or "Atlassian SourceTree" a user can easily manage project files. There are private and public repositories. Public ones can be accessed by everyone, private repositories require access permissions.</p>
</div>
<div class="sect3">
<h4 id="contributing-code.asciidoc_creating-a-new-user-account">57.2.1. Creating a new user account</h4>
<div class="paragraph">
<p>The devonfw projects use GitHub as hosting service. Therefore you&#8217;ll need an account to allow collaboration. Visit <a href="https://github.com/join?source=header-home">this page</a> to create a new account. If available, use <strong>your CORP username</strong> as GitHub username and <strong>your CORP email address</strong>.</p>
</div>
<div class="paragraph">
<p>A GitHub account is essential for contributing code and gaining permissions to access private repositories.</p>
</div>
</div>
<div class="sect3">
<h4 id="contributing-code.asciidoc_git-basics">57.2.2. Git Basics</h4>
<div class="paragraph">
<p>An in-depth documentation on basic Git syntax and usage can be found on the <a href="https://git-scm.com/docs">official Git homepage</a>. Another helpful and easy to follow instruction can be found <a href="http://rogerdudler.github.io/git-guide/">here</a>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="contributing-code.asciidoc_structure-of-our-projects">57.3. Structure of our projects</h3>
<div class="paragraph">
<p>In total, there are three GitHub organizations regarding devonfw:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/devonfw-forge"><strong>devonfw-forge</strong></a></p>
<div class="paragraph">
<p>Repository organization used for work on incubators and other research projects.</p>
</div>
</li>
<li>
<p><a href="https://github.com/devonfw/"><strong>devonfw</strong></a></p>
<div class="paragraph">
<p>The official <em>devonfw Platform</em> project repository. Usually, two main branches exist inside each repository:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>develop</strong></p>
<div class="paragraph">
<p>This branch contains software in the state of being in development.</p>
</div>
</li>
<li>
<p><strong>master</strong></p>
<div class="paragraph">
<p>This branch contains software in release state.</p>
</div>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="contributing-code.asciidoc_contributing-to-our-projects">57.4. Contributing to our projects</h3>
<div class="paragraph">
<p>In order to contribute to our projects, developers must follow the following <a href="#Contributing-Development-Guidelines.asciidoc">development guidelines</a>. Other sources about contributing to devonfw:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/devonfw/devonfw-guide/blob/master/general/Contributing-Code-of-Conduct.asciidoc">devonfw code of conduct</a></p>
</li>
<li>
<p><a href="https://github.com/devonfw/devonfw-guide/blob/master/general/Contributing-Code.asciidoc">devonfw code contributions</a></p>
</li>
<li>
<p><a href="https://github.com/devonfw/devonfw-guide/blob/master/general/Contributing-Development-Guidelines.asciidoc">devonfw development guidelines</a></p>
</li>
<li>
<p><a href="https://github.com/devonfw/devonfw-guide/blob/master/general/Contributing-Git-Fork-Guide.asciidoc">Git Fork guide</a></p>
</li>
<li>
<p><a href="https://github.com/devonfw/devonfw-guide/blob/master/general/Contributing-Wiki.asciidoc">devonfw documentation</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Every project must include the following files</strong> in order to establish the contributing rules and facilitate the process:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>CONTRIBUTING.asciidoc</code> that establishes the specific guidelines of contributing in a project repository.</p>
</li>
<li>
<p><code>CODE_OF_CONDUCT.asciidoc</code> mandatory to contribute.</p>
</li>
<li>
<p><code>ISSUE_TEMPLATE.asciidoc</code> that defines the appropriated way to submit an issue in a project repository.</p>
</li>
<li>
<p><code>PULL_REQUEST_TEMPLATE.asciidoc</code> that specifies the rules in order to submit a pull request in a project repository.</p>
</li>
</ul>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
This files must be included at the root folder or the the issues and pull request templates inside a <code>.github</code> folder.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><a href="https://github.com/stevemao/github-issue-templates">This repository</a> is a good resource to find the perfect templates for issues and pull requests that fit in your repository.</p>
</div>
<div class="sect3">
<h4 id="contributing-code.asciidoc_process-of-contributing-code-to-the-devonfw-projects">57.4.1. Process of contributing code to the devonfw projects</h4>
<div class="ulist">
<ul>
<li>
<p>Use the issue tracker to check whether the issue you would like to be working on exists. Otherwise create a new issue.</p>
<div class="imageblock">
<div class="content">
<a class="image" href="images/contributing/issue_list.PNG?raw=true"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/contributing/issue_list.PNG?raw=true" alt="Issue list" width="450"></a>
</div>
<div class="title">Figure 84. Using GitHub&#8217;s issue tracker</div>
</div>
</li>
<li>
<p>Before making more complex changes you should probably notify the community. The worst case would be you investing time and effort into something that&#8217;ll be later rejected. Oftentimes the <a href="https://www.yammer.com/capgemini.com/#/threads/inGroup?type=in_group&amp;feedId=5030942&amp;view=all">devonfw Community</a> on Yammer will have the right answer.</p>
</li>
<li>
<p>Assign yourself to the issue you would like to work on. If a member was already assigned to your preferred issue, get in contact to contribute to the same issue.</p>
</li>
<li>
<p>Fork the desired repository to your corporate GitHub account. Afterwards you&#8217;ll have your own copy of the repository you&#8217;d like to work on.</p>
</li>
<li>
<p>Create a new branch for your feature/bugfix. Check out the develop branch for the upcoming release. The following changes will afterwards be merged when the new version is released.</p>
</li>
<li>
<p>Please read the <a href="#Contributing-Git-Fork-Guide.asciidoc">Working with forked repositories</a> document to learn all about this topic.</p>
<div class="ulist">
<ul>
<li>
<p>Check out the develop branch</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">git checkout develop-x.y.z</code></pre>
</div>
</div>
</li>
<li>
<p>Create a new branch</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">git checkout -b myBranchName</code></pre>
</div>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Apply your modifications according to the <a href="https://github.com/devonfw/devon4j/wiki/coding-conventions">coding conventions</a> to the newly created branch</p>
</li>
<li>
<p>Verify your changes to only include relevant and required changes.</p>
</li>
<li>
<p>Commit your changes locally</p>
<div class="ulist">
<ul>
<li>
<p>When commiting changes please follow this pattern for your commit message:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>#&lt;issueId&gt;: &lt;change description&gt;</code></pre>
</div>
</div>
</li>
<li>
<p>When working on multiple different repositories, the actual repository name of the change should also be declared in the commit message:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>&lt;project&gt;/&lt;repository&gt;#&lt;issueId&gt;: &lt;change description&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>devonfw/devon4j#1: added REST service for tablemanagement</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Note:</strong> Starting directly with a # symbol will comment out the line when using the editor to insert a commit message. Instead, you should use a prefix like a space or simply typing "Issue". E.g.:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>Issue #4: Added some new feature, fixed some bug</code></pre>
</div>
</div>
<div class="paragraph">
<p>The language to be used for commit messages is English.</p>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Push the changes to your Fork of the repository</p>
</li>
<li>
<p>After completing the issue/bugfix/feature, use the <em>pull request</em> function in GitHub. This feature allows other members to look over your branch, automated CI systems may test your changes and finally apply the changes to the corresponding branch (if no conflicts occur).</p>
<div class="paragraph">
<p>Use the tab "Pull requests" and the button labeled "New pull request". Afterwards you can <em>Choose different branches or forks above to discuss and review changes</em>.</p>
</div>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Most of the devonfw projects contain a <strong>documents</strong> folder that includes the related documentation. It would be really interesting to add the documentation files of your new feature inside this pull request.<br>
Bare in mind that, in case the changes have a big impact, the <strong>devonfw core team</strong> will request the necessary documentation in the pull request.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="contributing-code.asciidoc_reviewing-pull-requests">57.5. Reviewing Pull Requests</h3>
<div class="paragraph">
<p>Detailed information about revieweing can be found on the <a href="https://help.github.com/articles/reviewing-changes-in-pull-requests/">official topic on GitHub Pull Requests</a>.</p>
</div>
<div class="paragraph">
<p>There are two different methods to review Pull Requests:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Human based reviews</strong></p>
<div class="paragraph">
<p>Other project members are able to discuss the changes made in the pull request by having insight into changed files and file differences by commenting.</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/contributing/pr_commenting.PNG?raw=true"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/contributing/pr_commenting.PNG?raw=true" alt="Commenting on pull requests" width="450"></a>
</div>
<div class="title">Figure 85. People can add comments to pull requests and suggest further changes</div>
</div>
</li>
<li>
<p><strong>CI based reviews</strong></p>
<div class="paragraph">
<p>CI Systems like <a href="https://jenkins.io/">Jenkins</a> or <a href="https://travis-ci.org/">Travis.ci</a> are able to listen for new pull requests on specified projects. As soon as the request was made, Travis for example checks out the to-be-merged branch and builds it. This enables an automated build which could even include testcases. Finally, the CI approves the pull requests if the build was built and tested successfully, otherwise it&#8217;ll let the project members know that something went wrong.</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/contributing/travis_failure.png?raw=true"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/contributing/travis_failure.png?raw=true" alt="Travis failed to build" width="450"></a>
</div>
<div class="title">Figure 86. If Travis fails to build a project, it&#8217;ll post the results directly to the pull request</div>
</div>
<div class="paragraph">
<p>Combining these two possibilities should accelerate the reviewing process of pull requests.</p>
</div>
</li>
</ul>
</div>
<!-- toc disabled -->
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
This document is the <strong>Official Covenant Code of Conduct</strong> that must be present in every OASP or devonfw project at the root folder as <code>CODE_OF_CONDUCT.asciidoc</code> or <code>CODE_OF_CONDUCT.md</code>. Please, include this contents in your repository and  the <strong>Product Owner email address</strong> in the right place below.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="Contributing-Code-of-Conduct.asciidoc">58. Contributor Covenant Code of Conduct</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="contributing-code-of-conduct.asciidoc_our-pledge">58.1. Our Pledge</h3>
<div class="paragraph">
<p>In the interest of fostering an open and welcoming environment, we as contributors and maintainers pledge to making participation in our project and our community a harassment-free experience for everyone, regardless of age, body size, disability, ethnicity, gender identity and expression, level of experience, nationality, personal appearance, race, religion, or sexual identity and orientation.</p>
</div>
</div>
<div class="sect2">
<h3 id="contributing-code-of-conduct.asciidoc_our-standards">58.2. Our Standards</h3>
<div class="paragraph">
<p>Examples of behavior that contributes to creating a positive environment include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Using welcoming and inclusive language</p>
</li>
<li>
<p>Being respectful of differing viewpoints and experiences</p>
</li>
<li>
<p>Gracefully accepting constructive criticism</p>
</li>
<li>
<p>Focusing on what is best for the community</p>
</li>
<li>
<p>Showing empathy towards other community members</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Examples of unacceptable behavior by participants include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The use of sexualized language or imagery and unwelcome sexual attention or advances</p>
</li>
<li>
<p>Trolling, insulting/derogatory comments, and personal or political attacks</p>
</li>
<li>
<p>Public or private harassment</p>
</li>
<li>
<p>Publishing others' private information, such as a physical or electronic address, without explicit permission</p>
</li>
<li>
<p>Other conduct which could reasonably be considered inappropriate in a professional setting</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="contributing-code-of-conduct.asciidoc_our-responsibilities">58.3. Our Responsibilities</h3>
<div class="paragraph">
<p>Project maintainers are responsible for clarifying the standards of acceptable behavior and are expected to take appropriate and fair corrective action in response to any instances of unacceptable behavior.</p>
</div>
<div class="paragraph">
<p>Project maintainers have the right and responsibility to remove, edit, or reject comments, commits, code, wiki edits, issues, and other contributions that are not aligned to this Code of Conduct, or to ban temporarily or permanently any contributor for other behaviors that they deem inappropriate, threatening, offensive, or harmful.</p>
</div>
</div>
<div class="sect2">
<h3 id="contributing-code-of-conduct.asciidoc_scope">58.4. Scope</h3>
<div class="paragraph">
<p>This Code of Conduct applies both within project spaces and in public spaces when an individual is representing the project or its community. Examples of representing a project or community include using an official project e-mail address, posting via an official social media account, or acting as an appointed representative at an online or offline event. Representation of a project may be further defined and clarified by project maintainers.</p>
</div>
</div>
<div class="sect2">
<h3 id="contributing-code-of-conduct.asciidoc_enforcement">58.5. Enforcement</h3>
<div class="paragraph">
<p>Instances of abusive, harassing, or otherwise unacceptable behavior may be reported by contacting the project team at <strong>[INSERT PRODUCT OWNER EMAIL ADDRESS]</strong>. All complaints will be reviewed and investigated and will result in a response that is deemed necessary and appropriate to the circumstances. The project team is obligated to maintain confidentiality with regard to the reporter of an incident. Further details of specific enforcement policies may be posted separately.</p>
</div>
<div class="paragraph">
<p>Project maintainers who do not follow or enforce the Code of Conduct in good faith may face temporary or permanent repercussions as determined by other members of the project&#8217;s leadership.</p>
</div>
</div>
<div class="sect2">
<h3 id="contributing-code-of-conduct.asciidoc_attribution">58.6. Attribution</h3>
<div class="paragraph">
<p>This Code of Conduct is adapted from the <a href="https://www.contributor-covenant.org">Contributor Covenant</a>, version 1.4,
available at <a href="https://www.contributor-covenant.org/version/1/4/code-of-conduct.html" class="bare">https://www.contributor-covenant.org/version/1/4/code-of-conduct.html</a></p>
</div>
<!-- toc disabled -->
</div>
</div>
</div>
<div class="sect1">
<h2 id="Contributing-Development-Guidelines.asciidoc">59. Development Guidelines</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><strong>Always ask before creating a pull request.</strong> To avoid duplication efforts, its better to discuss it with us first or create an issue.</p>
</li>
<li>
<p><strong>All code must be reviewed via a pull request.</strong> Before anything can be merged, it must be reviewed by other developer and ideally at least 2 others.</p>
</li>
<li>
<p><strong>Use git flow processes.</strong> Start a feature, release, or hotfix branch, and you should never commit and push directly to master.</p>
</li>
<li>
<p><strong>Code should adhere to lint and codestyle tests.</strong> While you can commit code that doesn&#8217;t validate but still works, it is encouraged to validate your code. It saves other&#8217;s headaches down the road.</p>
</li>
<li>
<p><strong>Code must pass existing tests when submitting a pull request.</strong> If your code breaks a test, it needs to be updated to pass the tests before merging.</p>
</li>
<li>
<p><strong>New code should come with proper tests.</strong> Your code should come with proper test coverage, ideally 95%, minimum 80%, before it can be merged.</p>
</li>
<li>
<p><strong>Bug fixes must come with a test.</strong> Any bug fixes should come with an appropriate test to verify the bug is fixed, and does not return.</p>
</li>
<li>
<p><strong>Code structure should be maintained.</strong> The structure of the repo and files has been carefully crafted, and any deviations from that should be only done when agreed upon by the entire community.</p>
</li>
</ul>
</div>
<!-- toc disabled -->
</div>
</div>
<div class="sect1">
<h2 id="Contributing-Git-Fork-Guide.asciidoc">60. Working with forked repositories</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="contributing-git-fork-guide.asciidoc_fork-a-repository">60.1. Fork a repository</h3>
<div class="paragraph">
<p>A fork is a copy of a repository. Forking a repository allows you to freely experiment with changes without affecting the original project.</p>
</div>
<div class="paragraph">
<p>Most commonly, forks are used to either propose changes to someone else&#8217;s project or to use someone else&#8217;s project as a starting point for your own idea.</p>
</div>
<div class="sect3">
<h4 id="contributing-git-fork-guide.asciidoc_propose-changes-to-someone-elses-project">60.1.1. Propose changes to someone else&#8217;s project</h4>
<div class="paragraph">
<p>A great example of using forks to propose changes is for bug fixes. Rather than logging an issue for a bug you&#8217;ve found, you can:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Fork the repository.</p>
</li>
<li>
<p>Make the fix.</p>
</li>
<li>
<p>Submit a pull request to the project owner.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>If the project owner likes your work, they might pull your fix into the original repository!</p>
</div>
</div>
<div class="sect3">
<h4 id="contributing-git-fork-guide.asciidoc_how-to-fork-a-repository">60.1.2. How to fork a repository</h4>
<div class="paragraph">
<p>GitHub, GitLab and Bitbucket have a very accesible option to fork any repository you can access to. For example, at GitHub you will only need to do the following:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/contributing/fork-github-1.PNG" alt="Fork a Github repository">
</div>
</div>
<div class="paragraph">
<p>In order to work locally you will need to pull your forked repository. Open the Terminal or Git Bash and run the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ git clone https://github.com/YOUR-USERNAME/YOUR-REPOSITORY</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="contributing-git-fork-guide.asciidoc_configuring-a-remote-for-a-fork">60.2. Configuring a remote for a fork</h3>
<div class="paragraph">
<p>You must configure a remote that points to the upstream repository in Git to sync changes you make in a fork with the original repository. This also allows you to sync changes made in the original repository with the fork.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Open Terminal or Git Bash.</p>
</li>
<li>
<p>List the current configured remote repository for your fork.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ git remote -v
origin  https://github.com/YOUR_USERNAME/YOUR_FORK.git (fetch)
origin  https://github.com/YOUR_USERNAME/YOUR_FORK.git (push)</code></pre>
</div>
</div>
</li>
<li>
<p>Specify a new remote upstream repository that will be synced with the fork.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ git remote add upstream https://github.com/ORIGINAL_OWNER/ORIGINAL_REPOSITORY.git</code></pre>
</div>
</div>
</li>
<li>
<p>Verify the new upstream repository you&#8217;ve specified for your fork.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ git remote -v
origin    https://github.com/YOUR_USERNAME/YOUR_FORK.git (fetch)
origin    https://github.com/YOUR_USERNAME/YOUR_FORK.git (push)
upstream  https://github.com/ORIGINAL_OWNER/ORIGINAL_REPOSITORY.git (fetch)
upstream  https://github.com/ORIGINAL_OWNER/ORIGINAL_REPOSITORY.git (push)</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="contributing-git-fork-guide.asciidoc_syncing-a-fork">60.3. Syncing a fork</h3>
<div class="paragraph">
<p>Sync a fork of a repository to keep it up-to-date with the upstream repository.</p>
</div>
<div class="paragraph">
<p>Before you can sync your fork with an upstream repository, you must configure a remote that points to the upstream repository in Git.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Open Terminal or Git Bash.</p>
</li>
<li>
<p>Change the current working directory to your local project.</p>
</li>
<li>
<p>Fetch the branches and their respective commits from the upstream repository. Commits to <code>master</code> will be stored in a local branch, <code>upstream/master</code>.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ git fetch upstream
remote: Counting objects: 75, done.
remote: Compressing objects: 100% (53/53), done.
remote: Total 62 (delta 27), reused 44 (delta 9)
Unpacking objects: 100% (62/62), done.
From https://github.com/ORIGINAL_OWNER/ORIGINAL_REPOSITORY
 * [new branch]      master     -&gt; upstream/master</code></pre>
</div>
</div>
</li>
<li>
<p>Check out your fork&#8217;s local <code>master</code> branch.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ git checkout master
Switched to branch 'master'</code></pre>
</div>
</div>
</li>
<li>
<p>Merge the changes from <code>upstream/master</code> into your local master branch. This brings your fork&#8217;s <code>master</code> branch into sync with the upstream repository, without losing your local changes.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ git merge upstream/master
Updating a422352..5fdff0f
Fast-forward
 README                    |    9 -------
 README.md                 |    7 ++++++
 2 files changed, 7 insertions(+), 9 deletions(-)
 delete mode 100644 README
 create mode 100644 README.md</code></pre>
</div>
</div>
<div class="paragraph">
<p>If your local branch didn&#8217;t have any unique commits, Git will instead perform a "fast-forward":</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">git merge upstream/master
Updating 34e91da..16c56ad
Fast-forward
 README.md                 |    5 +++--
 1 file changed, 3 insertions(+), 2 deletions(-)</code></pre>
</div>
</div>
</li>
<li>
<p>Push the changes to update your fork on GitHub, GitLab, Bitbucket, etc.</p>
</li>
</ol>
</div>
<!-- toc disabled -->
</div>
</div>
</div>
<div class="sect1">
<h2 id="Contributing-Wiki.asciidoc">61. Wiki Contributions</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Contributing guidelines moved <a href="https://github.com/devonfw/.github/blob/master/CONTRIBUTING.asciidoc#contributing">here</a>. Feel free to merge over what remains valuable from here. This document will be delted in the future.</p>
</div>
<div class="paragraph">
<p>Our wikis are written in the so called <em>AsciiDoc</em> format. Check the <a href="https://powerman.name/doc/asciidoc">AsciiDoc cheatsheet</a> and the <a href="http://asciidoctor.org/docs/asciidoc-syntax-quick-reference/">AsciiDoc quick reference</a> for more information. Knowing the following basic features should allow you to convert your Word documents into the Wiki friendly AsciiDoc format.</p>
</div>
<div class="paragraph">
<p>It is mandatory to follow the <a href="#Contributing-Code-of-Conduct.asciidoc">code of conduct</a> that must be present in the root of every OSS or private project as <code>CODE_OF_CONDUCT.asciidoc</code> or <code>CODE_OF_CONDUCT.md</code>.</p>
</div>
<div class="sect2">
<h3 id="contributing-wiki.asciidoc_text-styles">61.1. Text styles</h3>
<div class="paragraph">
<p><em>Italic Text</em></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>_Italic Text_</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Bold Text</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>*Bold Text*</code></pre>
</div>
</div>
<div class="paragraph">
<p>Mono Spaced Text</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>+Mono Spaced Text+</code></pre>
</div>
</div>
<div class="paragraph">
<p>Text in <sup>Superscript</sup></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>Text in ^Superscript^</code></pre>
</div>
</div>
<div class="paragraph">
<p>Text in <sub>Subscript</sub></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>Text in ~Subscript~</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="contributing-wiki.asciidoc_titles">61.2. Titles</h3>
<div class="paragraph">
<p>A title can be initiated like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>[[Contributing-Wiki.asciidoc]]
= Level 1 header
[[contributing-wiki.asciidoc_level-2-header]]
== Level 2 header
[[contributing-wiki.asciidoc_level-3-header]]
== Level 3 header
...</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="contributing-wiki.asciidoc_lists">61.3. Lists</h3>
<div class="paragraph">
<p>Ordered and unordered lists can be created like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>Ordered list:
. Item 1
. Item 2
. Item 3
. ...

Unordered list:
* Item 1
* Item 2
* Item 3
* ...</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="contributing-wiki.asciidoc_tables">61.4. Tables</h3>
<div class="paragraph">
<p>The following example shows how a table can be created. Note that the <em>header</em> flag is optional.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>[options="header"]
|===
|Header 1|Header 2| Header 3
|  Item 1|  Item 2|   Item 3
|     ...|     ...|      ...
|===</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="contributing-wiki.asciidoc_source-code">61.5. Source Code</h3>
<div class="paragraph">
<p>If you want to show off some code examples, you can use the <em>code block</em>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>[source]
 ----
 Some source code
 ----</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also specify which script language is used. This will allow GitHUb to use a matching color scheme. Therefore, just type in the type of code used:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>[source, bash]</code></pre>
</div>
</div>
<div class="paragraph">
<p>or</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>[source, java]</code></pre>
</div>
</div>
</div>
</div>
</div>
<h1 id="master-general-end.asciidoc" class="sect0">XII: OSS Compliance</h1>
<div class="openblock partintro">
<div class="content">
<!-- toc disabled -->
</div>
</div>
<div class="sect1">
<h2 id="Cookbook-OSS-Compliance.asciidoc">62. Cookbook OSS Compliance</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This chapter helps you to gain transparency on OSS usage and reach OSS compliance in your project.</p>
</div>
<div class="sect2">
<h3 id="cookbook-oss-compliance.asciidoc_preface">62.1. Preface</h3>
<div class="paragraph">
<p>devonfw, as most Java software, makes strong use of Open Source Software (OSS). It is using about 150 OSS products on the server only and on the client even more. Using a platform like devonfw to develop your own custom solution requires handling contained OSS correctly, i.e acting <em>OSS-compliant</em>.</p>
</div>
<div class="paragraph">
<p>Please read the Open Source policy of your company first, e.g. the <a href="https://talent.capgemini.com/media_library/Medias/Common_images/OSS_Policy__Final.pdf">Capgemini OSS Policy</a> which contains a short, comprehensive and well written explanation on relevant OSS-knowledge. Make sure you:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>understand the copyleft effect and its effect in commercial projects</p>
</li>
<li>
<p>understand the 3 license categories: "permissive", "weak copyleft" and "strong copyleft"</p>
</li>
<li>
<p>know prominent license types as e.g. "Apache-2.0" or GPL-3.0" and what copyleft-category they are in</p>
</li>
<li>
<p>are aware that some OSS offer dual/multi-licenses</p>
</li>
<li>
<p>Understand that OSS libraries often come with sub-dependencies of other OSS carying licenses themselfes</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To define sufficient OSS compliance measures, contact your IP officer or legal team as early as possible, especially if you develop software for clients.</p>
</div>
</div>
<div class="sect2">
<h3 id="cookbook-oss-compliance.asciidoc_obligations-when-using-oss">62.2. Obligations when using OSS</h3>
<div class="paragraph">
<p>If you create a custom solution containing OSS, this in legal sense is a "derived" work. If you distribute your derived work to your business client or any other legal entity in binary packaged form, the license obligations of contained OSS get into effect. Ignoring these leads to a license infringement which can create high damage.</p>
</div>
<div class="paragraph">
<p>To carefully handle these obligations you must:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>maintain an OSS inventory (to gain transparency on OSS usage and used licenses)</p>
</li>
<li>
<p>check license conformity depending on usage/distribution in a commercial scenario</p>
</li>
<li>
<p>check license compatibility between used OSS-licenses</p>
</li>
<li>
<p>fulfill obligations defined by the OSS-licenses</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Obligations need to be checked per license. Frequent obligations are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>deliver the license terms of all used versions of the OSS licenses</p>
</li>
<li>
<p>not to change any copyright statements or warranty exclusions contained in the used OSS components</p>
</li>
<li>
<p>deliver the source code of the OSS components (e.g. on a data carrier)</p>
</li>
<li>
<p>when modifying OSS, track any source code modification (including date and name of the employee/company)</p>
</li>
<li>
<p>display OSS license notice in a user frontend (if any)</p>
</li>
<li>
<p>other obligations depending on individual license</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="cookbook-oss-compliance.asciidoc_automate-oss-handling">62.3. Automate OSS handling</h3>
<div class="paragraph">
<p>Carefully judging the OSS usage in your project is a MANUAL activity! However, collecting OSS information and fulfilling license obligations should be automated as much as possible. A prominent professional tool to automate OSS compliance is the commercial software "Blackduck". Unfortunately it is rather expensive - either purchased or used as Saas.</p>
</div>
<div class="paragraph">
<p>The most recommended lightweight tooling is a combination of Maven plugins. We will mainly use the <a href="http://www.mojohaus.org/license-maven-plugin/">Mojo Maven License Plugin</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="cookbook-oss-compliance.asciidoc_configure-the-mojo-maven-license-plugin">62.4. Configure the Mojo Maven License Plugin</h3>
<div class="paragraph">
<p>You can use it from commandline but this will limit the ability to sustainably configure it (shown later).
Therefore we add it permanently as a build-plugin to the project parent-pom like this (already contained in OASP-parent-pom):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;plugin&gt;
  &lt;groupId&gt;org.codehaus.mojo&lt;/groupId&gt;
  &lt;artifactId&gt;license-maven-plugin&lt;/artifactId&gt;
  &lt;version&gt;1.14&lt;/version&gt;

  &lt;configuration&gt;
    &lt;outputDirectory&gt;${project.build.directory}/generated-resources&lt;/outputDirectory&gt;
    &lt;sortArtifactByName&gt;true&lt;/sortArtifactByName&gt;
    &lt;includeTransitiveDependencies&gt;true&lt;/includeTransitiveDependencies&gt;
    &lt;!-- the "missing file" declares licenses for dependencies that could not be detected automatically --&gt;
    &lt;useMissingFile&gt;true&lt;/useMissingFile&gt;
    &lt;!-- find the "missing files" in all child-projects at the following location --&gt;
    &lt;missingFile&gt;src/license/THIRD-PARTY.properties&lt;/missingFile&gt;
    &lt;!-- if the "missing files" are not yet existing in child-projects they will be created automatically --&gt;
    &lt;failOnMissing&gt;false&lt;/failOnMissing&gt;
    &lt;overrideFile&gt;src/license/override-THIRD-PARTY.properties&lt;/overrideFile&gt;
    &lt;!-- harmonize different ways of writing license names --&gt;
    &lt;licenseMerges&gt;
      &lt;licenseMerge&gt;Apache-2.0|Apache 2.0&lt;/licenseMerge&gt;
      &lt;licenseMerge&gt;Apache-2.0|Apache License, Version 2.0&lt;/licenseMerge&gt;
      &lt;licenseMerge&gt;Apache-2.0|Apache Software License, Version 2.0&lt;/licenseMerge&gt;
      &lt;licenseMerge&gt;Apache-2.0|The Apache Software License, Version 2.0&lt;/licenseMerge&gt;
    &lt;/licenseMerges&gt;
    &lt;encoding&gt;utf-8&lt;/encoding&gt;
  &lt;/configuration&gt;
&lt;/plugin&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the config above there are several settings that help to permanently improve the result of an automated OSS scan. We explain these now.</p>
</div>
<div class="sect3">
<h4 id="cookbook-oss-compliance.asciidoc_declare-additional-licenses">62.4.1. Declare additional licenses</h4>
<div class="paragraph">
<p>Sometimes the licenses of used OSS cannot be resolved automatically. That is not the mistake of the maven-license-tool, but the mistake of the OSS author who didn&#8217;t make the respective license-information properly available.</p>
</div>
<div class="paragraph">
<p>Declare additional licenses in a "missing file" within <em>each</em> maven-subproject: /src/license/THIRD-PARTY.properties.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"># Generated by org.codehaus.mojo.license.AddThirdPartyMojo
#-------------------------------------------------------------------------------
# Already used licenses in project :
# - ASF 2.0
# - Apache 2
...
#-------------------------------------------------------------------------------
# Please fill the missing licenses for dependencies :
...
dom4j--dom4j--1.6.1=BSD 3-Clause
javax.servlet--jstl--1.2=CDDL
...</code></pre>
</div>
</div>
<div class="paragraph">
<p>In case the use of "missing files" is activated, but the THIRD-PARTY.properties-file is not yet existing, the first run of an "aggregate-add-third-party" goal (see below) will fail. Luckily the license-plugin just helped us and created the properties-files automatically (in each maven-subproject) and prefilled it with:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>a list of all detected licenses within the maven project</p>
</li>
<li>
<p>all OSS libraries where a license could not be detected automatically.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You now need to fill in missing license information and rerun the plugin.</p>
</div>
</div>
<div class="sect3">
<h4 id="cookbook-oss-compliance.asciidoc_redefine-wrongly-detected-licenses">62.4.2. Redefine wrongly detected licenses</h4>
<div class="paragraph">
<p>In case automatically detected licenses proof to be wrong by closer investigation, this wrong detection can be overwritten. Add a configuration to declare alternative licenses within each maven-subproject: /src/license/override-THIRD-PARTY.properties</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">com.sun.mail--javax.mail--1.5.6=Common Development and Distribution License 1.1</code></pre>
</div>
</div>
<div class="paragraph">
<p>This can be also be useful for OSS that provides a multi-license to make a decision which license to actually choose .</p>
</div>
</div>
<div class="sect3">
<h4 id="cookbook-oss-compliance.asciidoc_merge-licenses">62.4.3. Merge licenses</h4>
<div class="paragraph">
<p>You will see that many prominent licenses come in all sorts of notations, e.g. Apache-2.0 as: "Apache 2" or "ASL-2.0" or "The Apache License, Version 2.0". The Mojo Maven License Plugin allows to harmonize different forms of a license-naming like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">    &lt;!-- harmonize different ways of writing license names --&gt;
    &lt;licenseMerges&gt;
      &lt;licenseMerge&gt;Apache-2.0|Apache 2.0&lt;/licenseMerge&gt;
      &lt;licenseMerge&gt;Apache-2.0|Apache License, Version 2.0&lt;/licenseMerge&gt;
      &lt;licenseMerge&gt;Apache-2.0|Apache Software License, Version 2.0&lt;/licenseMerge&gt;
      &lt;licenseMerge&gt;Apache-2.0|The Apache Software License, Version 2.0&lt;/licenseMerge&gt;
    &lt;/licenseMerges&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>License-names will be harmonized in the OSS report to one common term. We propose to harmonize to short-license-IDs defined by the <a href="https://spdx.org/">SPDX</a> standard.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="cookbook-oss-compliance.asciidoc_retrieve-licenses-list">62.5. Retrieve licenses list</h3>
<div class="paragraph">
<p>For a quick initial judgement of OSS license situation run the following maven command from commandline:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ mvn license:license-list</code></pre>
</div>
</div>
<div class="paragraph">
<p>You receive the summary list of all used OSS licenses on the cmd-out.</p>
</div>
</div>
<div class="sect2">
<h3 id="cookbook-oss-compliance.asciidoc_create-an-oss-inventory">62.6. Create an OSS inventory</h3>
<div class="paragraph">
<p>To create an OSS inventory means to report on the overall bill of material of used OSS and corresponding licenses.
Within the parent project, run the following maven goal from command line.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ mvn license:aggregate-download-licenses -Dlicense.excludedScopes=test,provided</code></pre>
</div>
</div>
<div class="paragraph">
<p>Running the aggregate-download-licenses goal creates two results.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>a license.xml that contains all used OSS depenencies (even sub-dependencies) with respective license information</p>
</li>
<li>
<p>puts all used OSS-license-texts as html files into folder target/generated resources</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Carefully validate and judge the outcome of the license list. It is recommended to copy the license.xml to the project documentation and hand it over to your client. You may also import it into a spreadsheet to get a better overview.</p>
</div>
</div>
<div class="sect2">
<h3 id="cookbook-oss-compliance.asciidoc_create-a-third-party-file">62.7. Create a THIRD PARTY file</h3>
<div class="paragraph">
<p>Within Java software it is a common practice to add a "THIRD-PARTY" text file to the distribution. Contained is a summary-list of all used OSS and respective licenses. This can also be achieved with the Mojo Maven License Plugin.</p>
</div>
<div class="paragraph">
<p>Within the parent project, run the following maven goal from command line.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ mvn license:aggregate-add-third-party -Dlicense.excludedScopes=test,provided</code></pre>
</div>
</div>
<div class="paragraph">
<p>Find the THIRD-PARTY.txt in the folder: target\generated-resources. The goal aggregate-add-third-party also profits from configuration as outlined above.</p>
</div>
</div>
<div class="sect2">
<h3 id="cookbook-oss-compliance.asciidoc_download-and-package-oss-sourcecode">62.8. Download and package OSS SourceCode</h3>
<div class="paragraph">
<p>Some OSS licenses require handing over the OSS source code which is packaged with your custom software to the client the solution is distributed to. It is a good practice to hand over the source code of <em>all</em> used OSS to your client. Collecting all source code can be accomplished by another Maven plugin: Apache Maven Dependency Plugin.</p>
</div>
<div class="paragraph">
<p>It downloads all OSS Source Jars into the folder: \target\sources across the parent and all child maven projects.</p>
</div>
<div class="paragraph">
<p>You configure the plugin like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;plugin&gt;
  &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
  &lt;artifactId&gt;maven-dependency-plugin&lt;/artifactId&gt;
  &lt;version&gt;3.0.2&lt;/version&gt;

  &lt;configuration&gt;
    &lt;classifier&gt;sources&lt;/classifier&gt;
    &lt;failOnMissingClassifierArtifact&gt;false&lt;/failOnMissingClassifierArtifact&gt;
    &lt;outputDirectory&gt;${project.build.directory}/sources&lt;/outputDirectory&gt;
  &lt;/configuration&gt;
  &lt;executions&gt;
    &lt;execution&gt;
      &lt;id&gt;src-dependencies&lt;/id&gt;
      &lt;phase&gt;package&lt;/phase&gt;
      &lt;goals&gt;
        &lt;!-- use unpack-dependencies instead if you want to explode the sources --&gt;
        &lt;goal&gt;copy-dependencies&lt;/goal&gt;
      &lt;/goals&gt;
    &lt;/execution&gt;
  &lt;/executions&gt;
&lt;/plugin&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>You run the plugin from commandline like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ mvn dependency:copy-dependencies -Dclassifier=sources</code></pre>
</div>
</div>
<div class="paragraph">
<p>The plugin provides another goal that also unzips the jars, which is not recommended, since contents get mixed up.</p>
</div>
<div class="paragraph">
<p>Deliver the OSS source jars to your client with the release of your custom solution. This has been done physically - e.g. on DVD.</p>
</div>
</div>
<div class="sect2">
<h3 id="cookbook-oss-compliance.asciidoc_handle-oss-within-ci-process">62.9. Handle OSS within CI-process</h3>
<div class="paragraph">
<p>To automate OSS handling in the regular build-process (which is not recommended to start with) you may declare the following executions and goals in your maven-configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;plugin&gt;
  ...

  &lt;executions&gt;
    &lt;execution&gt;
      &lt;id&gt;aggregate-add-third-party&lt;/id&gt;
      &lt;phase&gt;generate-resources&lt;/phase&gt;
      &lt;goals&gt;
        &lt;goal&gt;aggregate-add-third-party&lt;/goal&gt;
      &lt;/goals&gt;
    &lt;/execution&gt;

    &lt;execution&gt;
      &lt;id&gt;aggregate-download-licenses&lt;/id&gt;
      &lt;phase&gt;generate-resources&lt;/phase&gt;
      &lt;goals&gt;
        &lt;goal&gt;aggregate-download-licenses&lt;/goal&gt;
      &lt;/goals&gt;
    &lt;/execution&gt;
  &lt;/executions&gt;
&lt;/plugin&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that the build may fail in case the OSS information was not complete. Check the build-output to understand and resolve the issue - like e.g. add missing license information in the "missing file".</p>
</div>
</div>
</div>
</div>
<h1 id="master-general-end.asciidoc" class="sect0">XIII: Release Notes</h1>
<div class="openblock partintro">
<div class="content">
<!-- toc disabled -->
</div>
</div>
<div class="sect1">
<h2 id="release-notes-version-3.1.asciidoc">63. devonfw Release notes 3.1 “Goku”</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="release-notes-version-3.1.asciidoc_introduction">63.1. Introduction</h3>
<div class="paragraph">
<p>We are proud to announce the immediate release of devonfw version 3.1 (code named “Goku” during development). This version is the first one that implements our new documentation workflow, that will allow users to get the updated documentation at any moment and not to wait for the next devonfw release.</p>
</div>
<div class="paragraph">
<p>This is now possible as we have established a new workflow and rules during development of our assets. The idea behind this is that all the repositories contain a <code>documentation</code> folder and, in any pull request, the developer must include the related documentation change. A new Travis CI configuration added to all these repositories will automatically take the changes and publish them in the wiki section of every repository and in the new devonfw-guide repository that consolidates all the changes from all the repositories. Another pipeline will take changes from this consolidated repository and generate dynamically the devonfw guide in PDF and in the next weeks in HTML for the new planned devonfw website. The following schema explains this process:</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/documentation_workflow.png"><img src="/home/runner/work/devonfw-official-website/devonfw-official-website/target/generated-docs/images/documentation_workflow.png" alt="documentation workflow"></a>
</div>
</div>
<div class="paragraph">
<p>This release includes the very first version of the new CobiGen CLI. Now using commands, you will be able to generate code the same way as you do with Eclipse. This means that you can use CobiGen on other IDEs like Visual Studio Code or IntelliJ. Please take a look at <a href="https://github.com/devonfw/tools-cobigen/wiki/howto_Cobigen-CLI-generation" class="bare">https://github.com/devonfw/tools-cobigen/wiki/howto_Cobigen-CLI-generation</a> for more info.</p>
</div>
<div class="paragraph">
<p>The devonfw-shop-floor project has got a lot of updates in order to make even easier the creation of devonfw projects with CICD pipelines that run on the Production Line, deploy on Red Hat OpenShift Clusters and in general Docker environments. See the details below.</p>
</div>
<div class="paragraph">
<p>This release includes the very first version of our devonfw-ide tool that will allow users to automate devonfw setup and update the development environment. This tool will become the default devonfw setup tool in future releases. For more information please visit the repository <a href="https://github.com/devonfw/devon-ide" class="bare">https://github.com/devonfw/devon-ide</a>.</p>
</div>
<div class="paragraph">
<p>Following the same collaboration model we used in order to improve the integration of devonfw with Red Hat OpenShift and which allowed us to get the Red Hat Open Shift Primed certification, we have been working alongside with SAP HANA developers in order to support this database in the devon4j. This model was based on the contribution and review of pull requests in our reference application My Thai Star. In this case, SAP developers collaborated with us in the following two new use cases:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Prediction of future demand</p>
</li>
<li>
<p>Geospatial analysis and clustering of customers</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>More info at <a href="https://blogs.sap.com/2019/06/17/introducing-devonfw-support-for-sap-hana/" class="bare">https://blogs.sap.com/2019/06/17/introducing-devonfw-support-for-sap-hana/</a>.</p>
</div>
<div class="paragraph">
<p>Last but not least the devonfw extension pack for VS Code has been improved with the latest extensions and helpers for this IDE. Among many others you can now use:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Remote development on Docker containers and VMs <a href="https://marketplace.visualstudio.com/items?itemName=ms-vscode-remote.vscode-remote-extensionpack" class="bare">https://marketplace.visualstudio.com/items?itemName=ms-vscode-remote.vscode-remote-extensionpack</a></p>
</li>
<li>
<p>Dependency Analysis for maven and npm <a href="https://marketplace.visualstudio.com/items?itemName=redhat.fabric8-analytics" class="bare">https://marketplace.visualstudio.com/items?itemName=redhat.fabric8-analytics</a></p>
</li>
<li>
<p>React Native Tools <a href="https://marketplace.visualstudio.com/items?itemName=msjsdiag.vscode-react-native" class="bare">https://marketplace.visualstudio.com/items?itemName=msjsdiag.vscode-react-native</a></p>
</li>
<li>
<p>NgRx Snippets <a href="https://marketplace.visualstudio.com/itemdetails?itemName=hardikpthv.NgRxSnippets" class="bare">https://marketplace.visualstudio.com/itemdetails?itemName=hardikpthv.NgRxSnippets</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Also it is worth the try of the updated support for Java and Spring Boot development in VS Code. Check it out for yourself!</p>
</div>
<div class="paragraph">
<p>More information at <a href="https://marketplace.visualstudio.com/items?itemName=devonfw.devonfw-extension-pack" class="bare">https://marketplace.visualstudio.com/items?itemName=devonfw.devonfw-extension-pack</a>. Also, you can contribute to this extension in this GitHub repository <a href="https://github.com/devonfw/devonfw-extension-pack-vscode" class="bare">https://github.com/devonfw/devonfw-extension-pack-vscode</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="release-notes-version-3.1.asciidoc_changes-and-new-features">63.2. Changes and new features</h3>
<div class="sect3">
<h4 id="release-notes-version-3.1.asciidoc_devonfw-dist">63.2.1. Devonfw dist</h4>
<div class="ulist">
<ul>
<li>
<p>Eclipse 2018.12 integrated</p>
<div class="ulist">
<ul>
<li>
<p>CheckStyle Plugin updated.</p>
</li>
<li>
<p>SonarLint Plugin updated.</p>
</li>
<li>
<p>Git Plugin updated.</p>
</li>
<li>
<p>FindBugs Plugin updated.</p>
</li>
<li>
<p>Cobigen plugin updated.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Other Software</p>
<div class="ulist">
<ul>
<li>
<p>Visual Studio Code latest version included and preconfigured with the devonfw Platform Extension Pack.</p>
</li>
<li>
<p>Ant updated to latest.</p>
</li>
<li>
<p>Maven updated to latest.</p>
</li>
<li>
<p>Java updated to latest.</p>
</li>
<li>
<p>Nodejs LTS updated to latest.</p>
</li>
<li>
<p>@angular/cli included.</p>
</li>
<li>
<p>@devonfw/cicdgen included.</p>
</li>
<li>
<p>Yarn package manager updated.</p>
</li>
<li>
<p>Python3 updated.</p>
</li>
<li>
<p>Spyder3 IDE integrated in python3 installation updated.</p>
</li>
<li>
<p>devon4ng-application-template for Angular 8 at workspaces/examples</p>
</li>
<li>
<p>devon4ng-ionic-application-template for Ionic 4 at workspace/samples</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="release-notes-version-3.1.asciidoc_my-thay-star-sample-application">63.2.2. My Thay Star Sample Application</h4>
<div class="paragraph">
<p>The new release of My Thai Star has focused on the following improvements:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Release 3.1.0.</p>
</li>
<li>
<p>devon4j:</p>
<div class="ulist">
<ul>
<li>
<p>devon4j 3.1.0 integrated.</p>
</li>
<li>
<p>Spring Boot 2.1.6 integrated.</p>
</li>
<li>
<p>SAP 4/HANA prediction use case.</p>
</li>
<li>
<p>Bug fixes.</p>
</li>
</ul>
</div>
</li>
<li>
<p>devon4ng:</p>
<div class="ulist">
<ul>
<li>
<p>SAP 4/HANA prediction use case.</p>
</li>
<li>
<p>2FA togglable (two factor authentication).</p>
</li>
<li>
<p>NgRx integration in process (PR #234).</p>
</li>
</ul>
</div>
</li>
<li>
<p>devon4node</p>
<div class="ulist">
<ul>
<li>
<p>TypeScript 3.1.3.</p>
</li>
<li>
<p>Based on Nest framework.</p>
</li>
<li>
<p>Aligned with devon4j.</p>
</li>
<li>
<p>Complete backend implementation.</p>
</li>
<li>
<p>TypeORM integrated with SQLite database configuration.</p>
</li>
<li>
<p>Webpack bundler.</p>
</li>
<li>
<p>Nodemon runner.</p>
</li>
<li>
<p>Jest unit tests.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Mr.Checker</p>
<div class="ulist">
<ul>
<li>
<p>Example cases for end-to-end test.</p>
</li>
<li>
<p>Production line configuration.</p>
</li>
<li>
<p>CICD</p>
</li>
<li>
<p>Improved integration with Production Line</p>
</li>
<li>
<p>New Traefik load balancer and reverse proxy</p>
</li>
<li>
<p>New deployment from artifact</p>
</li>
<li>
<p>New CICD pipelines</p>
</li>
<li>
<p>New deployment pipelines</p>
</li>
<li>
<p>Automated creation of pipelines in Jenkins</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="release-notes-version-3.1.asciidoc_documentation-updates">63.2.3. Documentation updates</h4>
<div class="paragraph">
<p>This release addresses the new documentation workflow, being now possible to keep the documentation synced with any change. The new documentation includes the following contents:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Getting started</p>
</li>
<li>
<p>Contribution guide</p>
</li>
<li>
<p>Devcon</p>
</li>
<li>
<p>Release notes</p>
</li>
<li>
<p>devon4j documentation</p>
</li>
<li>
<p>devon4ng documentation</p>
</li>
<li>
<p>devon4net documentation</p>
</li>
<li>
<p>devonfw-shop-floor documentation</p>
</li>
<li>
<p>cicdgen documentation</p>
</li>
<li>
<p>devonfw testing with MrChecker</p>
</li>
<li>
<p>My Thai Star documentation</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="release-notes-version-3.1.asciidoc_devon4j">63.2.4. devon4j</h4>
<div class="paragraph">
<p>The following changes have been incorporated in devon4j:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Added Support for Java8 up to Java11</p>
</li>
<li>
<p>Upgrade to Spring Boot 2.1.6.</p>
</li>
<li>
<p>Upgrade to Spring 5.1.8</p>
</li>
<li>
<p>Upgrade to JPA 2.2</p>
</li>
<li>
<p>Upgrade to Hibernate 5.3</p>
</li>
<li>
<p>Upgrade to Dozer 6.4.1 (ATTENTION: Requires Migration, use devon-ide for automatic upgrade)</p>
</li>
<li>
<p>Many improvements to documentation (added JDK guide, architecture-mapping, JMS, etc.)</p>
</li>
<li>
<p>Completed support (JSON, Beanmapping) for pagination, IdRef, and java.time</p>
</li>
<li>
<p>Added MasterCto</p>
</li>
<li>
<p>For all details see <a href="https://github.com/devonfw/devon4j/milestone/3?closed=1">milestone</a>.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="release-notes-version-3.1.asciidoc_devon4ng">63.2.5. devon4ng</h4>
<div class="paragraph">
<p>The following changes have been incorporated in devon4ng:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Angular CLI 8,</p>
</li>
<li>
<p>Angular 8,</p>
</li>
<li>
<p>Angular Material 8,</p>
</li>
<li>
<p>Ionic 4,</p>
</li>
<li>
<p>Capacitor 1.0 as Cordova replacement,</p>
</li>
<li>
<p>NgRx 8 support for State Management,</p>
</li>
<li>
<p>devon4ng Angular application template updated to Angular 8 with visual improvements and bugfixes <a href="https://github.com/devonfw/devon4ng-application-template" class="bare">https://github.com/devonfw/devon4ng-application-template</a></p>
</li>
<li>
<p>devon4ng Ionic application template updated and improved <a href="https://github.com/devonfw/devon4ng-ionic-application-template" class="bare">https://github.com/devonfw/devon4ng-ionic-application-template</a></p>
</li>
<li>
<p>New devon4ng Angular application template with state management using Angular 8 and NgRx 8 <a href="https://github.com/devonfw/devon4ng-ngrx-template" class="bare">https://github.com/devonfw/devon4ng-ngrx-template</a></p>
</li>
<li>
<p>New devon4ng library <a href="https://github.com/devonfw/devon4ng-library" class="bare">https://github.com/devonfw/devon4ng-library</a> that includes the following libraries:</p>
<div class="ulist">
<ul>
<li>
<p>Cache Module for Angular 7+ projects.</p>
</li>
<li>
<p>Authorization Module for Angular 7+ projects.</p>
</li>
</ul>
</div>
</li>
<li>
<p>New use cases with documentation and samples:</p>
<div class="ulist">
<ul>
<li>
<p>Web Components with Angular Elements</p>
</li>
<li>
<p>Initial configuration with App Initializer pattern</p>
</li>
<li>
<p>Error Handling</p>
</li>
<li>
<p>PWA with Angular and Ionic</p>
</li>
<li>
<p>Lazy Loading</p>
</li>
<li>
<p>Library construction</p>
</li>
<li>
<p>Layout with Angular Material</p>
</li>
<li>
<p>Theming with Angular Material</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="release-notes-version-3.1.asciidoc_devon4net">63.2.6. devon4net</h4>
<div class="paragraph">
<p>The following changes have been incorporated in devon4net:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>New circuit breaker component to communicate microservices via HTTP</p>
</li>
<li>
<p>Resolved the update packages issue</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="release-notes-version-3.1.asciidoc_appsec-quick-solution-guide">63.2.7. AppSec Quick Solution Guide</h4>
<div class="paragraph">
<p>This release incorporates a new Solution Guide for Application Security based on the state of the art in OWASP based application security. The purpose of this guide is to offer quick solutions for common application security issues for all applications based on devonfw. It’s often the case that we need our systems to comply to certain sets of security requirements and standards. Each of these requirements needs to be understood, addressed and converted to code or project activity. We want this guide to prevent the wheel from being reinvented over and over again and to give clear hints and solutions to common security problems.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The wiki can be accessed here: <a href="https://github.com/devonfw/devonfw-security/wiki" class="bare">https://github.com/devonfw/devonfw-security/wiki</a></p>
</li>
<li>
<p>The PDF can be accessed here: <a href="https://github.com/devonfw/devonfw-security" class="bare">https://github.com/devonfw/devonfw-security</a></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="release-notes-version-3.1.asciidoc_cobigen">63.2.8. CobiGen</h4>
<div class="ulist">
<ul>
<li>
<p>CobiGen core new features:</p>
<div class="ulist">
<ul>
<li>
<p>CobiGen CLI: New command line interface for CobiGen. Using commands, you will be able to generate code the same way as you do with Eclipse. This means that you can use CobiGen on other IDEs like Visual Studio Code or IntelliJ. Please take a look into the documentation for more info.</p>
<div class="ulist">
<ul>
<li>
<p>Performance improves greatly in the CLI thanks to the lack of GUI.</p>
</li>
<li>
<p>You will be able to use path globs for selecting multiple input files.</p>
</li>
<li>
<p>We have implemented a search functionality so that you can easily search for increments or templates.</p>
</li>
</ul>
</div>
</li>
<li>
<p>First steps taken on CobiGen refactoring: With the new refactoring we will be able to decouple Cobigen completely from the target and input language. This will facilitate the creation of parsers and mergers for any language.</p>
<div class="ulist">
<ul>
<li>
<p>NashornJS has been deprecated: It was used for executing JavaScript code inside JVM. With the refactoring, performance has improved on the TypeScript merger.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Improving CobiGen templates:</p>
<div class="ulist">
<ul>
<li>
<p>Removed Covalent from Angular templates as it is not compatible with Angular 8.</p>
</li>
<li>
<p>Added devon4ng-NgRx templates that implement reactive state management. Note: The TypeScript merger is currently being improved in order to accept NgRx. The current templates are set as overridable by default.</p>
</li>
<li>
<p>Test data builder templates now make use of Lambdas and Consumers.</p>
</li>
<li>
<p>CTOs and ETOs increments have been correctly separated.</p>
</li>
</ul>
</div>
</li>
<li>
<p>TypeScript merger has been improved: Now it is possible to merge comments (like tsdoc) and enums.</p>
</li>
<li>
<p>OpenAPI parsing extended to read enums. Also fixed some bugs when no properties were set or when URLs were too short.</p>
</li>
<li>
<p>Java static and object initializers now get merged.</p>
</li>
<li>
<p>Fixed bugs when downloading and adapting templates.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="release-notes-version-3.1.asciidoc_devcon">63.2.9. Devcon</h4>
<div class="paragraph">
<p>A new version of Devcon has been released. Fixes and new features include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Updated to match current devon4j</p>
</li>
<li>
<p>Update to download Linux distribution.</p>
</li>
<li>
<p>Custom modules creation improvements.</p>
</li>
<li>
<p>Code Migration feature added.</p>
</li>
<li>
<p>Bugfixes.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="release-notes-version-3.1.asciidoc_devonfw-oss-modules">63.2.10. Devonfw OSS Modules</h4>
<div class="paragraph">
<p>Modules upgraded to be used in new devon4j projects:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Reporting module</p>
</li>
<li>
<p>WinAuth AD Module</p>
</li>
<li>
<p>WinAuth SSO Module</p>
</li>
<li>
<p>I18n Module</p>
</li>
<li>
<p>Async Module</p>
</li>
<li>
<p>Integration Module</p>
</li>
<li>
<p>Microservice Module</p>
</li>
<li>
<p>Compose for Redis Module
See: <a href="https://github.com/devonfw/devon/wiki#devonfw-modules" class="bare">https://github.com/devonfw/devon/wiki#devonfw-modules</a></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="release-notes-version-3.1.asciidoc_devonfw-shop-floor">63.2.11. devonfw shop floor</h4>
<div class="ulist">
<ul>
<li>
<p>Industrialization oriented to configure the provisioning environment provided by Production Line and deploy applications on an OpenShift cluster.</p>
</li>
<li>
<p>Added Jenkinsfiles to configure automatically OpenShift environments to deploy devonfw applications.</p>
</li>
<li>
<p>Industrialization to start new projects and configure them with CICD.</p>
</li>
<li>
<p>Upgrade the documentation with getting started guide to configure CICD in any devonfw project and deploy it.</p>
</li>
<li>
<p>Added new tool cicdgen to generate CICD code/files.</p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="release-notes-version-3.1.asciidoc_cicdgen">cicdgen</h5>
<div class="paragraph">
<p>cicdgen is a devonfw tool to generate all code/files related to CICD in your project. It&#8217;s based on angular schematics and it has its own CLI.
More information <a href="https://github.com/devonfw/cicdgen">here</a>.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>CICD configuration for devon4j, devon4ng and devon4node projects</p>
</li>
<li>
<p>Option to deploy devonfw projects with Docker</p>
</li>
<li>
<p>Option to deploy devonfw projects with OpenShift</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="release-notes-version-3.1.asciidoc_devonfw-testing">63.2.12. Devonfw Testing</h4>
<div class="sect4">
<h5 id="release-notes-version-3.1.asciidoc_mr.checker">Mr.Checker</h5>
<div class="paragraph">
<p>The Mr.Checker Test Framework is an automated testing framework for functional testing of web applications, API web services, Service Virtualization, Security and in coming future native mobile apps, and databases. All modules have tangible examples of how to build resilient integration test cases based on delivered functions. Mr.Checker updates and improvements:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Examples available under embedded project “MrChecker-App-Under-Test” and in project wiki: <a href="https://github.com/devonfw/devonfw-testing/wiki" class="bare">https://github.com/devonfw/devonfw-testing/wiki</a></p>
</li>
<li>
<p>How to install:</p>
<div class="ulist">
<ul>
<li>
<p>Wiki : <a href="https://github.com/devonfw/devonfw-testing/wiki/How-to-install" class="bare">https://github.com/devonfw/devonfw-testing/wiki/How-to-install</a></p>
</li>
</ul>
</div>
</li>
<li>
<p>Release Note:</p>
<div class="ulist">
<ul>
<li>
<p>module selenium - 3.8.2.1:</p>
<div class="ulist">
<ul>
<li>
<p>possibility to define version of driver in properties.file</p>
</li>
<li>
<p>automatic driver download if the version is not specified</p>
</li>
<li>
<p>possibility to run with different browser options</p>
</li>
<li>
<p>module webAPI – 1.2.1:</p>
</li>
<li>
<p>possibility to connect to the remote WireMock server</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
</ul>
</div>
<!-- toc disabled -->
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="release-notes-version-3.0.asciidoc">64. devonfw Release notes 3.0 “Fry”</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="release-notes-version-3.0.asciidoc_introduction">64.1. Introduction</h3>
<div class="paragraph">
<p>We are proud to announce the immediate release of devonfw version 3.0 (code named “Fry” during development). This version is the consolidation of Open Source, focused on the major namespace change ever in the platform, removing the OASP references and adopting the new devonfw names for each technical stack or framework.</p>
</div>
<div class="paragraph">
<p>The new stack names are the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>devon4j, former OASP4J, is the new name for Java.</p>
</li>
<li>
<p>devon4ng, former OASP4JS, is the new one for Angular.</p>
</li>
<li>
<p>devon4net, is the new .NET stack.</p>
</li>
<li>
<p>devon4X, is the new stack for Xamarin development.</p>
</li>
<li>
<p>devon4node, is the new devonfw incubator for node.js.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The new devon4j version was created directly from the latest oasp4j version (3.0.0). Hence it brings all the features and values that oasp4j offered. However, the namespace migration was used to do some housekeeping and remove deprecated code as well as reduce dependencies. Therefore your data-access layer will no longer have to depend on any third party except for devon4j as well as of course the JPA. We also have improved the application template that now comes with a modern JSON logging ready for docker and logstash based environments.</p>
</div>
<div class="paragraph">
<p>To help you upgrading we introduced a migration feature in devcon. This can automatically migrate your code from oasp4j (even older versions starting from 2.4.0) to the latest version of devon4j. There might be some small manual changes left to do but 90% of the migration will be done automatically for you.</p>
</div>
<div class="paragraph">
<p>Besides, the first version of the devonfw plugin for SonarQube has been released. It extends SonarQube with the ability to validate your code according to the devon4j architecture. More details at <a href="https://github.com/devonfw/sonar-devon-plugin" class="bare">https://github.com/devonfw/sonar-devon-plugin</a>.</p>
</div>
<div class="paragraph">
<p>This is the first release that integrates the new devonfw .NET framework, called devon4net, and Xamarin for mobile native development, devon4X. devon4NET and devon4X are the Capgemini standard frameworks for .NET and Xamarin software development. With the two new family members devonfw provides guidance and acceleration for the major software development platforms in our industry. Their interoperability provides you the assurance your multichannel solution will be consistent across web and mobile channels.</p>
</div>
<div class="paragraph">
<p>“Fry” release contains lots of improvements in our Mr.Checker E2E Testing Framework, including a complete E2E sample inside our reference application My Thai Star. Besides Mr.Checker, we include as an incubator Testar, a test tool (and framework)  to test applications at the GUI level whose objective is to solve part of the maintenance problem affecting tests by automatically generating test cases based on a structure that is automatically derived from the GUI. Testar is not included to replace Mr.Checker but rather to provide development teams with a series of interesting options which go beyond what Mr.Checker already provides.</p>
</div>
<div class="paragraph">
<p>Apart from Mr.Checker, engagements can now use Testar as an extra option for testing. This is a tool that enables the automated system testing of desktop, web and mobile applications at the GUI level. Testar has been added as an incubator to the platform awaiting further development during 2019.</p>
</div>
<div class="paragraph">
<p>The new incubator for node.js, called devon4node, has been included and implemented in several internal projects. This incubator is based on the Nest framework <a href="https://www.nestjs.com/" class="bare">https://www.nestjs.com/</a>. Nest is a framework for building efficient, scalable Node.js server-side applications. It uses progressive JavaScript, is built with TypeScript (preserves compatibility with pure JavaScript) and combines elements of OOP (Object Oriented Programming), FP (Functional Programming), and FRP (Functional Reactive Programming). Under the hood, Nest makes use of Express, but also provides compatibility with a wide range of other libraries (e.g. Fastify). This allows for easy use of the myriad third-party plugins which are available.</p>
</div>
<div class="paragraph">
<p>In order to facilitate the utilization of Microsoft Visual Studio Code in devonfw, we have developed and included the new devonfw Platform Extension Pack with lots of features to develop and test applications with this IDE in languages and frameworks such as TypeScript, JavaScript, .NET, Java, Rust, C++ and many more. More information at <a href="https://marketplace.visualstudio.com/items?itemName=devonfw.devonfw-extension-pack" class="bare">https://marketplace.visualstudio.com/items?itemName=devonfw.devonfw-extension-pack</a>. Also, you can contribute to this extension in this GitHub repository <a href="https://github.com/devonfw/devonfw-extension-pack-vscode" class="bare">https://github.com/devonfw/devonfw-extension-pack-vscode</a>.</p>
</div>
<div class="paragraph">
<p>There is a whole range of new features and improvements which can be seen in that light. The My Thai Star sample app has now been upgraded to devon4j and devon4ng, a new devon4node backend implementation has been included that is seamless interchangeable, an E2E MrChecker sample project, CICD and deployment scripts and lots of bugs have been fixed.</p>
</div>
<div class="paragraph">
<p>Last but not least, the projects wikis and the devonfw Guide has once again been updated accordingly before the big refactor that will be addressed in the following release in 2019.</p>
</div>
</div>
<div class="sect2">
<h3 id="release-notes-version-3.0.asciidoc_changes-and-new-features">64.2. Changes and new features</h3>
<div class="sect3">
<h4 id="release-notes-version-3.0.asciidoc_devonfw-dist">64.2.1. Devonfw dist</h4>
<div class="ulist">
<ul>
<li>
<p>Eclipse 2018.9 integrated</p>
<div class="ulist">
<ul>
<li>
<p>CheckStyle Plugin updated.</p>
</li>
<li>
<p>SonarLint Plugin updated.</p>
</li>
<li>
<p>Git Plugin updated.</p>
</li>
<li>
<p>FindBugs Plugin updated.</p>
</li>
<li>
<p>Cobigen plugin updated.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Other Software</p>
<div class="ulist">
<ul>
<li>
<p>Visual Studio Code latest version included and preconfigured with the devonfw Platform Extension Pack.</p>
</li>
<li>
<p>Ant updated to latest.</p>
</li>
<li>
<p>Maven updated to latest.</p>
</li>
<li>
<p>Java updated to latest.</p>
</li>
<li>
<p>Nodejs LTS updated to latest.</p>
</li>
<li>
<p>@angular/cli included.</p>
</li>
<li>
<p>Yarn package manager updated.</p>
</li>
<li>
<p>Python3 updated.</p>
</li>
<li>
<p>Spyder3 IDE integrated in python3 installation updated.</p>
</li>
<li>
<p>devon4ng-application-template for Angular 7 at workspaces/examples</p>
</li>
<li>
<p>devon4ng-ionic-application-template for Ionic 3.20 at workspace/samples</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="release-notes-version-3.0.asciidoc_my-thay-star-sample-application">64.2.2. My Thay Star Sample Application</h4>
<div class="paragraph">
<p>The new release of My Thai Star has focused on the following improvements:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Release 1.12.2.</p>
</li>
<li>
<p>devon4j:</p>
<div class="ulist">
<ul>
<li>
<p>devon4j 3.0.0 integrated.</p>
</li>
<li>
<p>Spring Boot 2.0.4 integrated.</p>
</li>
<li>
<p>Spring Data integration.</p>
</li>
<li>
<p>New pagination and search system.</p>
</li>
<li>
<p>Bug fixes.</p>
</li>
</ul>
</div>
</li>
<li>
<p>devon4ng:</p>
<div class="ulist">
<ul>
<li>
<p>Client devon4ng updated to Angular 7.</p>
</li>
<li>
<p>Angular Material and Covalent UI frameworks updated.</p>
</li>
<li>
<p>Electron framework integrated.</p>
</li>
</ul>
</div>
</li>
<li>
<p>devon4node</p>
<div class="ulist">
<ul>
<li>
<p>TypeScript 3.1.3.</p>
</li>
<li>
<p>Based on Nest framework.</p>
</li>
<li>
<p>Aligned with devon4j.</p>
</li>
<li>
<p>Complete backend implementation.</p>
</li>
<li>
<p>TypeORM integrated with SQLite database configuration.</p>
</li>
<li>
<p>Webpack bundler.</p>
</li>
<li>
<p>Nodemon runner.</p>
</li>
<li>
<p>Jest unit tests.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Mr.Checker</p>
<div class="ulist">
<ul>
<li>
<p>Example cases for end-to-end test.</p>
</li>
<li>
<p>Production line configuration.</p>
</li>
<li>
<p>CICD</p>
</li>
<li>
<p>Improved integration with Production Line</p>
</li>
<li>
<p>New deployment from artifact</p>
</li>
<li>
<p>New CICD pipelines</p>
</li>
<li>
<p>New deployment pipelines</p>
</li>
<li>
<p>Automated creation of pipelines in Jenkins</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="release-notes-version-3.0.asciidoc_documentation-updates">64.2.3. Documentation updates</h4>
<div class="paragraph">
<p>The following contents in the devonfw guide have been updated:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Upgrade of all the new devonfw named assets.</p>
<div class="ulist">
<ul>
<li>
<p>devon4j</p>
</li>
<li>
<p>devon4ng</p>
</li>
<li>
<p>Mr.Checker</p>
</li>
</ul>
</div>
</li>
<li>
<p>Electron integration cookbook.</p>
</li>
<li>
<p>Updated cookbook about Swagger.</p>
</li>
<li>
<p>Removed deprecated entries.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Apart from this the documentation has been reviewed and some typos and errors have been fixed.</p>
</div>
<div class="paragraph">
<p>The current development of the guide has been moved to <a href="https://github.com/devonfw-forge/devon-guide/wiki" class="bare">https://github.com/devonfw-forge/devon-guide/wiki</a> in order to be available as the rest of OSS assets.</p>
</div>
</div>
<div class="sect3">
<h4 id="release-notes-version-3.0.asciidoc_devon4j">64.2.4. devon4j</h4>
<div class="paragraph">
<p>The following changes have been incorporated in devon4j:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Spring Boot 2.0.4 Integrated.</p>
</li>
<li>
<p>Spring Data layer Integrated.</p>
</li>
<li>
<p>Decouple mmm.util.*</p>
</li>
<li>
<p>Removed depreciated restaurant sample.</p>
</li>
<li>
<p>Updated Pagination support for Spring Data</p>
</li>
<li>
<p>Add support for hana as dbType.</p>
</li>
<li>
<p>Bugfixes.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="release-notes-version-3.0.asciidoc_devon4ng">64.2.5. devon4ng</h4>
<div class="paragraph">
<p>The following changes have been incorporated in devon4ng:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>New client application architecture guide <a href="https://github.com/devonfw/devon4ng/wiki" class="bare">https://github.com/devonfw/devon4ng/wiki</a></p>
</li>
<li>
<p>Angular CLI 7,</p>
</li>
<li>
<p>Angular 7,</p>
</li>
<li>
<p>Angular Material 7 and Covalent 2.0.0-beta.7,</p>
</li>
<li>
<p>Ionic 3.20.0,</p>
</li>
<li>
<p>Cordova 8.0.0,</p>
</li>
<li>
<p>devon4ng Angular application template updated to Angular 7 with visual improvements and bugfixes <a href="https://github.com/devonfw/devon4ng-application-template" class="bare">https://github.com/devonfw/devon4ng-application-template</a></p>
</li>
<li>
<p>devon4ng Ionic application template updated and improved <a href="https://github.com/devonfw/devon4ng-ionic-application-template" class="bare">https://github.com/devonfw/devon4ng-ionic-application-template</a></p>
</li>
<li>
<p>PWA enabled.</p>
</li>
<li>
<p>Electron integrated to run My Thai Star as a desktop application in Windows, Linux or macOS.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="release-notes-version-3.0.asciidoc_devon4net">64.2.6. devon4net</h4>
<div class="paragraph">
<p>Some of the highlights of devon4net 1.0 are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>External configuration file for each environment.</p>
</li>
<li>
<p>.NET Core 2.1.X working solution (Latest 2.1.402).</p>
</li>
<li>
<p>Packages and solution templates published on nuget.org.</p>
</li>
<li>
<p>Full components customization by config file.</p>
</li>
<li>
<p>Docker ready (My Thai Star sample fully working on docker).</p>
</li>
<li>
<p>Port specification by configuration.</p>
</li>
<li>
<p>Dependency injection by Microsoft .NET Core.</p>
</li>
<li>
<p>Automapper support.</p>
</li>
<li>
<p>Entity framework ORM (Unit of work, async methods).</p>
</li>
<li>
<p>.NET Standard library 2.0 ready.</p>
</li>
<li>
<p>Multi-platform support: Windows, Linux, Mac.</p>
</li>
<li>
<p>Samples: My Thai Star back-end, Google API integration, Azure login, AOP with Castle.</p>
</li>
<li>
<p>Documentation site.</p>
</li>
<li>
<p>SPA page support.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>And included the following features:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Logging:</p>
<div class="ulist">
<ul>
<li>
<p>Text File.</p>
</li>
<li>
<p>Sqlite database support.</p>
</li>
<li>
<p>Serilog Seq Server support.</p>
</li>
<li>
<p>Graylog integration ready through TCP/UDP/HTTP protocols.</p>
</li>
<li>
<p>API Call params interception (simple and compose objects).</p>
</li>
<li>
<p>API error exception management.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Swagger:</p>
<div class="ulist">
<ul>
<li>
<p>Swagger auto generating client from comments and annotations on controller classes.</p>
</li>
<li>
<p>Full swagger client customization (Version, Title, Description, Terms, License, Json endpoint definition).</p>
</li>
</ul>
</div>
</li>
<li>
<p>JWT:</p>
<div class="ulist">
<ul>
<li>
<p>Issuer, audience, token expiration customization by external file configuration.</p>
</li>
<li>
<p>Token generation via certificate.</p>
</li>
<li>
<p>MVC inherited classes to access JWT user properties.</p>
</li>
<li>
<p>API method security access based on JWT Claims.</p>
</li>
</ul>
</div>
</li>
<li>
<p>CORS:</p>
<div class="ulist">
<ul>
<li>
<p>Simple CORS definition ready.</p>
</li>
<li>
<p>Multiple CORS domain origin definition with specific headers and verbs.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Headers:</p>
<div class="ulist">
<ul>
<li>
<p>Automatic header injection with middleware.</p>
</li>
<li>
<p>Supported header definitions: AccessControlExposeHeader, StrictTransportSecurityHeader, XFrameOptionsHeader, XssProtectionHeader, XContentTypeOptionsHeader, ContentSecurityPolicyHeader, PermittedCrossDomainPoliciesHeader, ReferrerPolicyHeader.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Reporting server:</p>
<div class="ulist">
<ul>
<li>
<p>Partial implementation of reporting server based on My-FyiReporting (now runs on linux container).</p>
</li>
</ul>
</div>
</li>
<li>
<p>Testing:</p>
<div class="ulist">
<ul>
<li>
<p>Integration test template with sqlite support.</p>
</li>
<li>
<p>Unit test template.</p>
</li>
<li>
<p>Moq, xunit frameworks integrated.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="release-notes-version-3.0.asciidoc_devon4x">64.2.7. devon4X</h4>
<div class="paragraph">
<p>Some of the highlights of the new devonfw Xamarin framework are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Based on Excalibur framework by Hans Harts (<a href="https://github.com/Xciles/Excalibur" class="bare">https://github.com/Xciles/Excalibur</a>).</p>
</li>
<li>
<p>Updated to latest MVVMCross 6 version.</p>
</li>
<li>
<p>My Thai Star Excalibur forms sample.</p>
</li>
<li>
<p>Xamarin Forms template available on nuget.org.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="release-notes-version-3.0.asciidoc_appsec-quick-solution-guide">64.2.8. AppSec Quick Solution Guide</h4>
<div class="paragraph">
<p>This release incorporates a new Solution Guide for Application Security based on the state of the art in OWASP based application security. The purpose of this guide is to offer quick solutions for common application security issues for all applications based on devonfw.  It’s often the case that we need our systems to comply to certain sets of security requirements and standards. Each of these requirements needs to be understood, addressed and converted to code or project activity. We want this guide to prevent the wheel from being reinvented over and over again and to give clear hints and solutions to common security problems.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The wiki can be accessed here: <a href="https://github.com/devonfw/devonfw-security/wiki" class="bare">https://github.com/devonfw/devonfw-security/wiki</a></p>
</li>
<li>
<p>The PDF can be accessed here: <a href="https://github.com/devonfw/devonfw-security" class="bare">https://github.com/devonfw/devonfw-security</a></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="release-notes-version-3.0.asciidoc_cobigen">64.2.9. CobiGen</h4>
<div class="ulist">
<ul>
<li>
<p>CobiGen core new features:</p>
<div class="ulist">
<ul>
<li>
<p>CobiGen_Templates will not need to be imported into the workspace anymore. However, If you want to adapt them, you can still click on a button that automatically imports them for you.</p>
</li>
<li>
<p>CobiGen_Templates can be updated by one-click whenever the user wants to have the latest version.</p>
</li>
<li>
<p>Added the possibility to reference external increments on configuration level. This is used for reducing the number of duplicated templates.</p>
</li>
</ul>
</div>
</li>
<li>
<p>CobiGen_Templates project and docs updated:</p>
<div class="ulist">
<ul>
<li>
<p>Spring standard has been followed better than ever.</p>
</li>
<li>
<p>Interface templates get automatically relocated to the api project. Needed for following the new devon4j standard.</p>
</li>
</ul>
</div>
</li>
<li>
<p>CobiGen Angular:</p>
<div class="ulist">
<ul>
<li>
<p>Angular 7 generation improved based on the updated application template.</p>
</li>
<li>
<p>Pagination changed to fit Spring standard.</p>
</li>
</ul>
</div>
</li>
<li>
<p>CobiGen Ionic: Pagination changed to fit Spring standard.</p>
</li>
<li>
<p>CobiGen OpenAPI plugin released with multiple bug-fixes and other functionalities like:</p>
<div class="ulist">
<ul>
<li>
<p>Response and parameter types are parsed properly when they are a reference to an entity.</p>
</li>
<li>
<p>Parameters defined on the body of a request are being read correctly.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="release-notes-version-3.0.asciidoc_devcon">64.2.10. Devcon</h4>
<div class="paragraph">
<p>A new version of Devcon has been released. Fixes and new features include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Updated to match current devon4j</p>
</li>
<li>
<p>Update to download Linux distribution.</p>
</li>
<li>
<p>Custom modules creation improvements.</p>
</li>
<li>
<p>Code Migration feature added</p>
</li>
<li>
<p>Bugfixes.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="release-notes-version-3.0.asciidoc_devonfw-oss-modules">64.2.11. Devonfw OSS Modules</h4>
<div class="paragraph">
<p>Modules upgraded to be used in new devon4j projects:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Reporting module</p>
</li>
<li>
<p>WinAuth AD Module</p>
</li>
<li>
<p>WinAuth SSO Module</p>
</li>
<li>
<p>I18n Module</p>
</li>
<li>
<p>Async Module</p>
</li>
<li>
<p>Integration Module</p>
</li>
<li>
<p>Microservice Module</p>
</li>
<li>
<p>Compose for Redis Module</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>See: <a href="https://github.com/devonfw/devon/wiki#devonfw-modules" class="bare">https://github.com/devonfw/devon/wiki#devonfw-modules</a></p>
</div>
</div>
<div class="sect3">
<h4 id="release-notes-version-3.0.asciidoc_devonfw-testing">64.2.12. Devonfw Testing</h4>
<div class="sect4">
<h5 id="release-notes-version-3.0.asciidoc_mr.checker">Mr.Checker</h5>
<div class="paragraph">
<p>The Mr.Checker Test Framework is an automated testing framework for functional testing of web applications, API web services, Service Virtualization, Security and in coming future native mobile apps, and databases. All modules have tangible examples of how to build resilient integration test cases based on delivered functions. Mr.Checker updates and improvements:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Examples available under embedded project “MrChecker-App-Under-Test” and in project wiki: <a href="https://github.com/devonfw/devonfw-testing/wiki" class="bare">https://github.com/devonfw/devonfw-testing/wiki</a></p>
</li>
<li>
<p>How to install:</p>
<div class="ulist">
<ul>
<li>
<p>Wiki : <a href="https://github.com/devonfw/devonfw-testing/wiki/How-to-install" class="bare">https://github.com/devonfw/devonfw-testing/wiki/How-to-install</a></p>
</li>
</ul>
</div>
</li>
<li>
<p>Release Note:</p>
<div class="ulist">
<ul>
<li>
<p>module selenium - 3.8.1.13:</p>
<div class="ulist">
<ul>
<li>
<p>headless browser</p>
</li>
<li>
<p>enable browser options</p>
</li>
</ul>
</div>
</li>
<li>
<p>module DevOps :</p>
<div class="ulist">
<ul>
<li>
<p>Jenkinsfile align with ProductionLine</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="release-notes-version-3.0.asciidoc_testar">Testar</h5>
<div class="paragraph">
<p>We have added Test*, Testar, as an incubator to the available test tools within devonfw. This ground-breaking tool is being developed by the Technical University of Valencia (UPV). In 2019 Capgemini will co-develop Testar with the UPV.</p>
</div>
<div class="paragraph">
<p>Testar is a tool that enables the automated system testing of desktop, web and mobile applications at the GUI level.</p>
</div>
<div class="paragraph">
<p>With Testar, you can start testing immediately. It automatically generates and executes test sequences based on a structure that is automatically derived from the UI through the accessibility API. Testar can detect the violation of general-purpose system requirements and you can use plugins to customize your tests.</p>
</div>
<div class="paragraph">
<p>You do not need test scripts and maintenance of it. The tests are random and are generated and executed automatically.</p>
</div>
<div class="paragraph">
<p>If you need to do directed tests you can create scripts to test specific requirements of your application.</p>
</div>
<div class="paragraph">
<p>Testar is included in the devonfw distro or can be downloaded from <a href="https://testar.org/download/" class="bare">https://testar.org/download/</a>.</p>
</div>
<div class="paragraph">
<p>The Github repository can be found at o: <a href="https://github.com/TESTARtool/TESTAR" class="bare">https://github.com/TESTARtool/TESTAR</a>.</p>
</div>
<!-- toc disabled -->
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="release-notes-version-2.4.asciidoc">65. devonfw Release notes 2.4 “EVE”</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="release-notes-version-2.4.asciidoc_introduction">65.1. Introduction</h3>
<div class="paragraph">
<p>We are proud to announce the immediate release of devonfw version 2.4 (code named “EVE” during development). This version is the first one that fully embraces Open Source, including components like the documentation assets and Cobigen. Most of the IP (Intellectual Property or proprietary) part of devonfw are now published under the Apache License version 2.0 (with the documentation under the Creative Commons License (Attribution-NoDerivatives)). This includes the GitHub repositories where all the code and documentation is located. All of these repositories are now open for public viewing as well.</p>
</div>
<div class="paragraph">
<p>“EVE” contains a slew of new features but in essence it is already driven by what we expect to be the core focus of 2018: strengthening the platform and improving quality.</p>
</div>
<div class="paragraph">
<p>This release is also fully focused on deepening the platform rather than expanding it. That is to say: we have worked on improving existing features rather than adding new ones and strengthen the qualitative aspects of the software development life cycle, i.e. security, testing, infrastructure (CI, provisioning) etc.</p>
</div>
<div class="paragraph">
<p>“EVE” already is very much an example of this. This release contains the Allure Test Framework (included as an incubator in version 2.3) update called MrChecker Test Framework. MrChecker is an automated testing framework for functional testing of web applications, API web services, Service Virtualization, Security and in coming future native mobile apps, and databases. All modules have tangible examples of how to build resilient integration test cases based on delivered functions.</p>
</div>
<div class="paragraph">
<p>Another incubator being updated is the devonfw Shop Floor which intended to be a compilation of DevOps experiences from the devonfw perspective. A new part of the release is the new Solution Guide for Application Security based on the state of the art in OWASP based application security.</p>
</div>
<div class="paragraph">
<p>There is a whole range of new features and improvements which can be seen in that light. OASP4j 2.6 changes and improves the package structure of the core Java framework. The My Thai Star sample app has now been upgraded to Angular 6, lots of bugs have been fixed and the devonfw Guide has once again been improved.</p>
</div>
<div class="paragraph">
<p>Last but not least, this release contains the formal publication of the devonfw Methodology or The Accelerated Solution Design - an Industry Standards based solution design and specification (documentation) methodology for Agile (and less-than-agile) projects.</p>
</div>
</div>
<div class="sect2">
<h3 id="release-notes-version-2.4.asciidoc_changes-and-new-features">65.2. Changes and new features</h3>
<div class="sect3">
<h4 id="release-notes-version-2.4.asciidoc_devonfw-2.4-is-open-source">65.2.1. devonfw 2.4 is Open Source</h4>
<div class="paragraph">
<p>This version is the first release of devonfw that fully embraces Open Source, including components like the documentation assets and Cobigen. This is done in response to intensive market pressure and demands from the MU´s (Public Sector France, Netherlands)</p>
</div>
<div class="paragraph">
<p>Most of the IP (Intellectual Property or proprietary) part of devonfw are now published under the Apache License version 2.0 (with the documentation under the Creative Commons License (Attribution-NoDerivatives)).</p>
</div>
<div class="paragraph">
<p>So you can now use the devonfw distribution (the "zip" file), Cobigen, the devonfw modules and all other components without any worry to expose the client unwittingly to Capgemini IP.</p>
</div>
<div class="paragraph">
<p><strong>Note:</strong> there are still some components which are IP and are not published under an OSS license. The class room trainings, the Sencha components and some Cobigen templates. But these are not includes in the distribution nor documentation and are now completely maintained separately.</p>
</div>
</div>
<div class="sect3">
<h4 id="release-notes-version-2.4.asciidoc_devonfw-dist">65.2.2. devonfw dist</h4>
<div class="ulist">
<ul>
<li>
<p>Eclipse Oxygen integrated</p>
<div class="ulist">
<ul>
<li>
<p>CheckStyle Plugin updated.</p>
</li>
<li>
<p>SonarLint Plugin updated.</p>
</li>
<li>
<p>Git Plugin updated.</p>
</li>
<li>
<p>FindBugs Plugin updated.</p>
</li>
<li>
<p>Cobigen plugin updated.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Other Software</p>
<div class="ulist">
<ul>
<li>
<p>Visual Studio Code latest version included and preconfigured with <a href="https://github.com/oasp/oasp-vscode-ide" class="bare">https://github.com/oasp/oasp-vscode-ide</a></p>
</li>
<li>
<p>Ant updated to latest.</p>
</li>
<li>
<p>Maven updated to latest.</p>
</li>
<li>
<p>Java updated to latest.</p>
</li>
<li>
<p>Nodejs LTS updated to latest.</p>
</li>
<li>
<p>@angular/cli included.</p>
</li>
<li>
<p>Yarn package manager updated.</p>
</li>
<li>
<p>Python3 updated.</p>
</li>
<li>
<p>Spyder3 IDE integrated in python3 installation updated.</p>
</li>
<li>
<p>OASP4JS-application-template for Angular 6 at workspaces/examples</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="release-notes-version-2.4.asciidoc_my-thay-star-sample-application">65.2.3. My Thay Star Sample Application</h4>
<div class="paragraph">
<p>The new release of My Thai Star has focused on the following improvements:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Release 1.6.0.</p>
</li>
<li>
<p>Travis CI integration with Docker. Now we get a valuable feedback of the current status and when collaborators make pull requests.</p>
</li>
<li>
<p>Docker compose deployment.</p>
</li>
<li>
<p>OASP4J:</p>
<div class="ulist">
<ul>
<li>
<p>Flyway upgrade from 3.2.1 to 4.2.0</p>
</li>
<li>
<p>Bug fixes.</p>
</li>
</ul>
</div>
</li>
<li>
<p>OASP4JS:</p>
<div class="ulist">
<ul>
<li>
<p>Client OASP4JS updated to Angular 6.</p>
</li>
<li>
<p>Frontend translated into 9 languages.</p>
</li>
<li>
<p>Improved mobile and tablet views.</p>
</li>
<li>
<p>Routing fade animations.</p>
</li>
<li>
<p>Compodoc included to generate dynamically frontend documentation.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="release-notes-version-2.4.asciidoc_documentation-updates">65.2.4. Documentation updates</h4>
<div class="paragraph">
<p>The following contents in the devonfw guide have been updated:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>devonfw OSS modules documentation.</p>
</li>
<li>
<p>Creating a new OASP4J application.</p>
</li>
<li>
<p>How to update Angular CLI in devonfw.</p>
</li>
<li>
<p>Include Angular i18n.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Apart from this the documentation has been reviewed and some typos and errors have been fixed.</p>
</div>
<div class="paragraph">
<p>The current development of the guide has been moved to <a href="https://github.com/oasp-forge/devon-guide/wiki" class="bare">https://github.com/oasp-forge/devon-guide/wiki</a> in order to be available as the rest of OSS assets.</p>
</div>
</div>
<div class="sect3">
<h4 id="release-notes-version-2.4.asciidoc_oasp4j">65.2.5. OASP4J</h4>
<div class="paragraph">
<p>The following changes have been incorporated in OASP4J:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Integrate batch with archetype.</p>
</li>
<li>
<p>Application module structure and dependencies improved.</p>
</li>
<li>
<p>Issues with Application Template fixed.</p>
</li>
<li>
<p>Solved issue where Eclipse maven template oasp4j-template-server version 2.4.0 produced pom with missing dependency spring-boot-starter-jdbc.</p>
</li>
<li>
<p>Solved datasource issue with project archetype 2.4.0.</p>
</li>
<li>
<p>Decouple archetype from sample (restaurant).</p>
</li>
<li>
<p>Upgrade to Flyway 4.</p>
</li>
<li>
<p>Fix for issue with Java 1.8 and QueryDSL #599.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="release-notes-version-2.4.asciidoc_oasp4js">65.2.6. OASP4JS</h4>
<div class="paragraph">
<p>The following changes have been incorporated in OASP4JS:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>First version of the new client application architecture guide <a href="https://github.com/oasp-forge/oasp4js-wiki/wiki" class="bare">https://github.com/oasp-forge/oasp4js-wiki/wiki</a></p>
</li>
<li>
<p>Angular CLI 6,</p>
</li>
<li>
<p>Angular 6,</p>
</li>
<li>
<p>Angular Material 6 and Covalent 2.0.0-beta.1,</p>
</li>
<li>
<p>Ionic 3.20.0,</p>
</li>
<li>
<p>Cordova 8.0.0,</p>
</li>
<li>
<p>OASP4JS Angular application template updated to Angular 6 with visual improvements and bugfixes <a href="https://github.com/oasp/oasp4js-application-template" class="bare">https://github.com/oasp/oasp4js-application-template</a></p>
</li>
<li>
<p>OASP4JS Ionic application template updated and improved <a href="https://github.com/oasp/oasp4js-ionic-application-template" class="bare">https://github.com/oasp/oasp4js-ionic-application-template</a></p>
</li>
<li>
<p>PWA enabled.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="release-notes-version-2.4.asciidoc_appsec-quick-solution-guide">65.2.7. AppSec Quick Solution Guide</h4>
<div class="paragraph">
<p>This release incorporates a new Solution Guide for Application Security based on the state of the art in OWASP based application security. The purpose of this guide is to offer quick solutions for common application security issues for all applications based on devonfw.  It’s often the case that we need our systems to comply to certain sets of security requirements and standards. Each of these requirements needs to be understood, addressed and converted to code or project activity. We want this guide to prevent the wheel from being reinvented over and over again and to give clear hints and solutions to common security problems.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The wiki can be accessed here: <a href="https://github.com/devonfw/devonfw-security/wiki" class="bare">https://github.com/devonfw/devonfw-security/wiki</a></p>
</li>
<li>
<p>The PDF can be accessed here: <a href="https://github.com/devonfw/devonfw-security" class="bare">https://github.com/devonfw/devonfw-security</a></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="release-notes-version-2.4.asciidoc_cobigen">65.2.8. CobiGen</h4>
<div class="ulist">
<ul>
<li>
<p>CobiGen_Templates project and docs updated.</p>
</li>
<li>
<p>CobiGen Angular 6 generation improved based on the updated application template</p>
</li>
<li>
<p>CobiGen Ionic CRUD App generation based on Ionic application template. Although a first version was already implemented, it has been deeply improved:</p>
<div class="ulist">
<ul>
<li>
<p>Changed the code structure to comply with Ionic standards.</p>
</li>
<li>
<p>Added pagination.</p>
</li>
<li>
<p>Pull-to-refresh, swipe and attributes header implemented.</p>
</li>
<li>
<p>Code documented and JSDoc enabled (similar to Javadoc)</p>
</li>
</ul>
</div>
</li>
<li>
<p>CobiGen TSPlugin Interface Merge support.</p>
</li>
<li>
<p>CobiGen XML plugin comes out with new cool features:</p>
<div class="ulist">
<ul>
<li>
<p>Enabled the use of XPath within variable assignment. You can now retrieve almost any data from an XML file and store it on a variable for further processing on the templates. Documented here.</p>
</li>
<li>
<p>Able to generate multiple output files per XML input file.</p>
</li>
<li>
<p>Generating code from UML diagrams. XMI files (standard XML for UML) can be now read and processed. This means that you can develop templates and generate code from an XMI like class diagrams.</p>
</li>
</ul>
</div>
</li>
<li>
<p>CobiGen OpenAPI plugin released with multiple bug-fixes and other functionalities like:</p>
<div class="ulist">
<ul>
<li>
<p>Assigning global and local variables is now possible. Therefore you can set any string for further processing on the templates. For instance, changing the root package name of the generated files. Documented here.</p>
</li>
<li>
<p>Enabled having a class with more than one relationship to another class (more than one property of the same type).</p>
</li>
</ul>
</div>
</li>
<li>
<p>CobiGen Text merger plugin has been extended and now it is able to merge text blocks. This means, for example, that the generation and merging of AsciiDoc documentation is possible. Documented here.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="release-notes-version-2.4.asciidoc_devcon">65.2.9. Devcon</h4>
<div class="paragraph">
<p>A new version of Devcon has been released. Fixes and new features include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Now Devcon is OSS, with public repository at <a href="https://github.com/devonfw/devcon" class="bare">https://github.com/devonfw/devcon</a></p>
</li>
<li>
<p>Updated to match current OASP4J</p>
</li>
<li>
<p>Update to download Linux distribution.</p>
</li>
<li>
<p>Custom modules creation improvements.</p>
</li>
<li>
<p>Bugfixes.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="release-notes-version-2.4.asciidoc_devonfw-oss-modules">65.2.10. devonfw OSS Modules</h4>
<div class="ulist">
<ul>
<li>
<p>Existing devonfw IP modules have been moved to OSS.</p>
<div class="ulist">
<ul>
<li>
<p>They can now be accessed in any OASP4J project as optional dependencies from Maven Central.</p>
</li>
<li>
<p>The repository now has public access <a href="https://github.com/devonfw/devon" class="bare">https://github.com/devonfw/devon</a></p>
</li>
</ul>
</div>
</li>
<li>
<p>Starters available for modules:</p>
<div class="ulist">
<ul>
<li>
<p>Reporting module</p>
</li>
<li>
<p>WinAuth AD Module</p>
</li>
<li>
<p>WinAuth SSO Module</p>
</li>
<li>
<p>I18n Module</p>
</li>
<li>
<p>Async Module</p>
</li>
<li>
<p>Integration Module</p>
</li>
<li>
<p>Microservice Module</p>
</li>
<li>
<p>Compose for Redis Module</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>See: <a href="https://github.com/devonfw/devon/wiki#devonfw-modules" class="bare">https://github.com/devonfw/devon/wiki#devonfw-modules</a></p>
</div>
</div>
<div class="sect3">
<h4 id="release-notes-version-2.4.asciidoc_devonfw-shop-floor">65.2.11. devonfw Shop Floor</h4>
<div class="ulist">
<ul>
<li>
<p>devonfw Shop Floor 4 Docker</p>
<div class="ulist">
<ul>
<li>
<p>Docker-based CICD environment</p>
<div class="ulist">
<ul>
<li>
<p>docker-compose.yml (installation file)</p>
</li>
<li>
<p>dsf4docker.sh (installation script)</p>
</li>
<li>
<p>Service Integration (documentation in Wiki)</p>
</li>
</ul>
</div>
</li>
<li>
<p>devonfw projects build and deployment with Docker</p>
<div class="ulist">
<ul>
<li>
<p>Dockerfiles (multi-stage building)</p>
<div class="ulist">
<ul>
<li>
<p>Build artifact (NodeJS for Angular and Maven for Java)</p>
</li>
<li>
<p>Deploy built artifact (NGINX for Angular and Tomcat for Java)</p>
</li>
<li>
<p>NGINX Reverse-Proxy to redirect traffic between both Angular client and Java server containers.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>devonfw Shop Floor 4 OpenShift</p>
<div class="ulist">
<ul>
<li>
<p>devonfw projects deployment in OpenShift cluster</p>
<div class="ulist">
<ul>
<li>
<p>s2i images</p>
</li>
<li>
<p>OpenShift templates</p>
</li>
<li>
<p>Video showcase (OpenShift Origin 3.6)</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>This incubator is intended to be a compilation of DevOps experiences from the devonfw perspective. “How we use our devonfw projects in DevOps environments”. Integration with the Production Line, creation and service integration of a Docker-based CI environment and deploying devonfw applications in an OpenShift Origin cluster using devonfw templates.
See: <a href="https://github.com/devonfw/devonfw-shop-floor" class="bare">https://github.com/devonfw/devonfw-shop-floor</a></p>
</div>
</div>
<div class="sect3">
<h4 id="release-notes-version-2.4.asciidoc_devonfw-testing">65.2.12. devonfw Testing</h4>
<div class="paragraph">
<p>The MrChecker Test Framework is an automated testing framework for functional testing of web applications, API web services, Service Virtualization, Security and in coming future native mobile apps, and databases. All modules have tangible examples of how to build resilient integration test cases based on delivered functions.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Examples available under embedded project “MrChecker-App-Under-Test” and in project wiki: <a href="https://github.com/devonfw/devonfw-testing/wiki" class="bare">https://github.com/devonfw/devonfw-testing/wiki</a></p>
</li>
<li>
<p>How to install:</p>
<div class="ulist">
<ul>
<li>
<p>Wiki : <a href="https://github.com/devonfw/devonfw-testing/wiki/How-to-install" class="bare">https://github.com/devonfw/devonfw-testing/wiki/How-to-install</a></p>
</li>
</ul>
</div>
</li>
<li>
<p>Release Note:</p>
<div class="ulist">
<ul>
<li>
<p>module core - 4.12.0.8:</p>
<div class="ulist">
<ul>
<li>
<p>fixes on getting Environment values</p>
</li>
<li>
<p>top notch example how to keep vulnerable data in repo , like passwords</p>
</li>
</ul>
</div>
</li>
<li>
<p>module selenium - 3.8.1.8:</p>
<div class="ulist">
<ul>
<li>
<p>browser driver auto downloader</p>
</li>
<li>
<p>list of out off the box examples to use in any web page</p>
</li>
</ul>
</div>
</li>
<li>
<p>module webAPI - ver. 1.0.2 :</p>
<div class="ulist">
<ul>
<li>
<p>api service virtualization with REST and SOAP examples</p>
</li>
<li>
<p>api service virtualization with dynamic arguments</p>
</li>
<li>
<p>REST working test examples with page object model</p>
</li>
</ul>
</div>
</li>
<li>
<p>module security - 1.0.1 (security tests against My Thai Start)</p>
</li>
<li>
<p>module DevOps :</p>
<div class="ulist">
<ul>
<li>
<p>dockerfile for Test environment execution</p>
</li>
<li>
<p>CI + CD as jenkinsfile code</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="release-notes-version-2.4.asciidoc_devonfw-methodology-accelerated-solution-design">65.2.13. devonfw methodology: Accelerated Solution Design</h4>
<div class="paragraph">
<p>One of the prime challenges in Distributed Agile Delivery is the maintenance of a common understanding and unity of intent among all participants in the process of creating a product. That is: how can you guarantee that different parties in the client, different providers, all in different locations and time zones during a particular period of time actually understand the requirements of the client, the proposed solution space and the state of implementation.</p>
</div>
<div class="paragraph">
<p>We offer the Accelerated Solution Design as a possible answer to these challenges. The ASD is carefully designed to be a practical guideline that fosters and ensures the collaboration and communication among all team members.</p>
</div>
<div class="paragraph">
<p>The Accelerated Solution Design is:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A practical guideline rather than a “methodology”</p>
</li>
<li>
<p>Based on industry standards rather than proprietary methods</p>
</li>
<li>
<p>Consisting of an evolving, “living”, document set rather than a static, fixed document</p>
</li>
<li>
<p>Encapsulating the business requirements, functional definitions as well as Architecture design</p>
</li>
<li>
<p>Based on the intersection of Lean, Agile, DDD and User Story Mapping</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>And further it is based on the essential belief or paradigm that ASD should be:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Focused on the design (definition) of the “externally observable behavior of a system”</p>
</li>
<li>
<p>Promoting communication and collaboration between team members</p>
</li>
<li>
<p>Guided by prototypes</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For more on the devonfw Methodology / ASD, see:
<a href="https://github.com/devonfw/devon-methodology/blob/master/design-guidelines/Accelerated_Solution_Design.adoc" class="bare">https://github.com/devonfw/devon-methodology/blob/master/design-guidelines/Accelerated_Solution_Design.adoc</a></p>
</div>
<!-- toc disabled -->
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="release-notes-version-2.3.asciidoc">66. devonfw Release notes 2.3 "Dash"</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="release-notes-version-2.3.asciidoc_release-improving--strengthening-the-platform">66.1. Release: improving &amp; strengthening the Platform</h3>
<div class="paragraph">
<p>We are proud to announce the immediate release of <strong>devonfw version 2.3</strong> (code named “<em>Dash</em>” during development).  This release comes with a bit of a delay as we decided to wait for the publication of OASP4j 2.5. “Dash” contains a slew of new features but in essence it is already driven by what we expect to be the core focus of 2018: strengthening the platform and improving quality.</p>
</div>
<div class="paragraph">
<p>After one year and a half of rapid expansion, we expect the next release(s) of the devonfw 2.x series to be fully focused on deepening the platform rather than expanding it. That is to say: we should work on improving existing features rather than adding new ones and strengthen the qualitative aspects of the software development life cycle, i.e. testing, infrastructure (CI, provisioning) etc.</p>
</div>
<div class="paragraph">
<p>“Dash” already is very much an example of this. This release contains the Allure Test Framework as an incubator. This is an automated testing framework for functional testing of web applications. Another incubator is the devonfw Shop Floor which intended to be a compilation of DevOps experiences from the devonfw perspective. And based on this devonfw has been <em>OpenShift Primed</em> (“certified”) by Red Hat.</p>
</div>
<div class="paragraph">
<p>There is a whole range of new features and improvements which can be seen in that light. OASP4j 2.5 changes and improves the package structure of the core Java framework. The My Thai Star sample app has now been fully integrated in the different frameworks and the devonfw Guide has once again been significantly expanded and improved.</p>
</div>
</div>
<div class="sect2">
<h3 id="release-notes-version-2.3.asciidoc_an-industrialized-platform-for-the-adcenter">66.2. An industrialized platform for the ADcenter</h3>
<div class="paragraph">
<p>Although less visible to the overall devonfw community, an important driving force was (meaning that lots of work has been done in the context of) the creation of the ADcenter concept towards the end of 2017. Based on a radical transformation of on/near/offshore software delivery, the focus of the ADcenters is to deliver agile &amp; accelerated “Rightshore” services with an emphasis on:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Delivering Business Value and optimized User Experience</p>
</li>
<li>
<p>Innovative software development with state of the art technology</p>
</li>
<li>
<p>Highly automated devops; resulting in lower costs &amp; shorter time-to-market</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The first two ADcenters, in Valencia (Spain) and Bangalore (India), are already servicing clients all over Europe - Germany, France, Switzerland  and the Netherlands - while ADcenter aligned production teams are currently working for Capgemini UK as well (through Spain).Through the ADcenter, Capgemini establishes industrialized innovation; designed for &amp; with the user. The availability of platforms for industrialized software delivery like devonfw and the Production Line has allowed us to train and make available over a 150 people in very short time.</p>
</div>
<div class="paragraph">
<p>The creation of the ADcenter is such a short time is visible proof that we´re getting closer to a situation where devonfw and Production Line are turning into the default development platform for APPS2, thereby standardizing all aspects of the software development life cycle: from training and design, architecture, devops and development,  all the way up to QA and deployment.</p>
</div>
</div>
<div class="sect2">
<h3 id="release-notes-version-2.3.asciidoc_changes-and-new-features">66.3. Changes and new features</h3>
<div class="sect3">
<h4 id="release-notes-version-2.3.asciidoc_devonfw-dist">66.3.1. devonfw dist</h4>
<div class="paragraph">
<p>The <strong>devonfw dist</strong>, or distribution, i.e. the central zip file which contains the main working environment for the devonfw developer, has been significantly enhanced. New features include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Eclipse Oxygen integrated</p>
<div class="ulist">
<ul>
<li>
<p>CheckStyle Plugin installed and configured</p>
</li>
<li>
<p>SonarLint Plugin installed and configured</p>
</li>
<li>
<p>Git Plugin installed</p>
</li>
<li>
<p>FindBugs replaced by SpotBugs and configured</p>
</li>
<li>
<p>Tomcat8 specific Oxygen configuration</p>
</li>
<li>
<p>CobiGen Plugin installed</p>
</li>
</ul>
</div>
</li>
<li>
<p>Other Software</p>
<div class="ulist">
<ul>
<li>
<p>Cmder integrated (when console.bat launched)</p>
</li>
<li>
<p>Visual Studio Code latest version included and pre-configured with <a href="https://github.com/oasp/oasp-vscode-ide" class="bare">https://github.com/oasp/oasp-vscode-ide</a></p>
</li>
<li>
<p>Ant updated to latest.</p>
</li>
<li>
<p>Maven updated to latest.</p>
</li>
<li>
<p>Java updated to latest.</p>
</li>
<li>
<p>Nodejs LTS updated to latest.</p>
</li>
<li>
<p>@angular/cli included.</p>
</li>
<li>
<p>Yarn package manager included.</p>
</li>
<li>
<p>Python3 integrated</p>
</li>
<li>
<p>Spyder3 IDE integrated in python3 installation</p>
</li>
<li>
<p>OASP4JS-application-template for Angular5 at workspaces/examples</p>
</li>
<li>
<p>Devon4sencha starter templates updated</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="release-notes-version-2.3.asciidoc_oasp4j-2.5">66.3.2. OASP4j 2.5</h4>
<div class="sect4">
<h5 id="release-notes-version-2.3.asciidoc_support-for-jax-rs--jax-ws-clients">Support for JAX-RS &amp; JAX-WS clients</h5>
<div class="paragraph">
<p>With the aim to enhance the ease in consuming RESTful and SOAP web services, JAX-RS and JAX-WS clients have been introduced. They enable developers to concisely and efficiently implement portable client-side solutions that leverage existing and well-established client-side HTTP connector implementations. Furthermore, the getting started time for consuming web services has been considerably reduced with the default configuration out-of-the-box which can be tweaked as per individual project requirements.</p>
</div>
<div class="paragraph">
<p>See: <a href="https://github.com/oasp/oasp4j/issues/358" class="bare">https://github.com/oasp/oasp4j/issues/358</a></p>
</div>
</div>
<div class="sect4">
<h5 id="release-notes-version-2.3.asciidoc_separate-security-logs-for-oasp4j-log-component">Separate security logs for OASP4J log component</h5>
<div class="paragraph">
<p>Based on OWASP(Open Web Application Security Project), OASP4J aims to give developers more control and flexibility with the logging of security events and tracking of forensic information. Furthermore, it helps classifying the information in log messages and applying masking when necessary. It provides powerful security features while based on set of logging APIs developers are already familiar with over a decade of their experience with Log4J and its successors.</p>
</div>
<div class="paragraph">
<p>See: <a href="https://github.com/oasp/oasp4j/issues/569" class="bare">https://github.com/oasp/oasp4j/issues/569</a></p>
</div>
</div>
<div class="sect4">
<h5 id="release-notes-version-2.3.asciidoc_support-for-microservices">Support for Microservices</h5>
<div class="paragraph">
<p>Integration of an OASP4J application to a Microservices environment can now be leveraged with this release of OASP4J. Introduction of service clients for RESTful and SOAP web services based on Java EE give developers agility and ease to access microservices in the Devon framework. It significantly cuts down the efforts on part of developers around boilerplate code and stresses more focus on the business code improving overall efficiency and quality of deliverables.</p>
</div>
<div class="paragraph">
<p>See: <a href="https://github.com/oasp/oasp4j/pull/589/commits" class="bare">https://github.com/oasp/oasp4j/pull/589/commits</a></p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="release-notes-version-2.3.asciidoc_cobigen">66.3.3. Cobigen</h4>
<div class="paragraph">
<p>A new version of Cobigen has been included. New features include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Swagger/Yaml Plugin for CobiGen. Cobigen is able to read a swagger definition file that follows the OpenAPI 3.0 spec and generate code. A preliminary release was already included in 2.2.1 but the current version is much more mature and stable. See: <a href="https://github.com/devonfw/tools-cobigen/wiki/howto_openapi_generation" class="bare">https://github.com/devonfw/tools-cobigen/wiki/howto_openapi_generation</a></p>
</li>
<li>
<p>Integration of CobiGen into Maven build process. This already existed but has been improved. It consists mainly of documentation + better log output and bug fixes. See: <a href="https://github.com/devonfw/tools-cobigen/wiki/cobigen-maven_configuration" class="bare">https://github.com/devonfw/tools-cobigen/wiki/cobigen-maven_configuration</a></p>
</li>
<li>
<p>CobiGen Ionic CRUD App generation based on <a href="https://github.com/oasp/oasp4js-ionic-application-template" class="bare">https://github.com/oasp/oasp4js-ionic-application-template</a></p>
</li>
<li>
<p>Cobigen_Templates project and docs updated</p>
</li>
<li>
<p>Bugfixes and Hardening</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="release-notes-version-2.3.asciidoc_my-thai-star-sample-application">66.3.4. My Thai Star Sample Application</h4>
<div class="paragraph">
<p>From this release on the My Thai Star application has been fully integrated in the different frameworks in the platform. Further more, a more modularized approach has been followed in the current release of My Thai star application to decouple client from implementation details. Which provides better encapsulation of code and dependency management for API and implementation classes. This has been achieved with creation of a new “API” module that contain interfaces for REST services and corresponding Request/Response objects. With existing “Core” module being dependent on “API” module. To read further you can follow the link <a href="https://github.com/oasp/my-thai-star/wiki/java-design#basic-architecture-details" class="bare">https://github.com/oasp/my-thai-star/wiki/java-design#basic-architecture-details</a></p>
</div>
<div class="paragraph">
<p>Furthermore: an email and Twitter micro service were integrated in my-thai-star. This is just for demonstration purposes. A full micro service framework is already part of oasp4j 2.5.0</p>
</div>
</div>
<div class="sect3">
<h4 id="release-notes-version-2.3.asciidoc_documentation-refactoring">66.3.5. Documentation refactoring</h4>
<div class="paragraph">
<p>The complete devonfw guide is restructured and refactored. Getting started guides are added for easy start with devonfw.Integration of the new Tutorial with the existing devonfw Guide whereby existing chapters of the previous tutorial were converted to Cookbook chapters. Asciidoctor is used for devonfw guide PDF generation.
See: <a href="https://github.com/devonfw/devon-guide/wiki" class="bare">https://github.com/devonfw/devon-guide/wiki</a></p>
</div>
</div>
<div class="sect3">
<h4 id="release-notes-version-2.3.asciidoc_oasp4js">66.3.6. OASP4JS</h4>
<div class="paragraph">
<p>The following changes have been incorporated in OASP4JS:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Angular CLI 1.6.0,</p>
</li>
<li>
<p>Angular 5.1,</p>
</li>
<li>
<p>Angular Material 5 and Covalent 1.0.0 RC1,</p>
</li>
<li>
<p>PWA enabled,</p>
</li>
<li>
<p>Core and Shared Modules included to follow the recommended Angular projects structure,</p>
</li>
<li>
<p>Yarn and NPM compliant since both lock files are included in order to get a stable installation.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="release-notes-version-2.3.asciidoc_admin-interface-for-oasp4j-apps">66.3.7. Admin interface for oasp4j apps</h4>
<div class="paragraph">
<p>The new version includes an Integration of an admin interface for oasp4j apps (Spring Boot). This module is based on CodeCentric´s Spring Boot Admin (<a href="https://github.com/codecentric/spring-boot-admin" class="bare">https://github.com/codecentric/spring-boot-admin</a>). See: <a href="https://github.com/devonfw/devon-guide/wiki/Spring-boot-admin-Integration-with-devon4j" class="bare">https://github.com/devonfw/devon-guide/wiki/Spring-boot-admin-Integration-with-devon4j</a></p>
</div>
</div>
<div class="sect3">
<h4 id="release-notes-version-2.3.asciidoc_devcon">66.3.8. Devcon</h4>
<div class="paragraph">
<p>A new version of Devcon has been released. Fixes and new features include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Renaming of system Commands.</p>
</li>
<li>
<p>New menu has been added - “other modules”, if menus are more than 10, other modules will display some menus.</p>
</li>
<li>
<p>A progress bar has been added for installing the distribution</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="release-notes-version-2.3.asciidoc_devonfw-modules">66.3.9. devonfw Modules</h4>
<div class="paragraph">
<p>Existing devonfw modules can now be accessed with the help of starters following namespace devonfw-&lt;module_name&gt;-starter. Starters available for modules:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Reporting module</p>
</li>
<li>
<p>WinAuth AD Module</p>
</li>
<li>
<p>WinAuth SSO Module</p>
</li>
<li>
<p>I18n Module</p>
</li>
<li>
<p>Async Module</p>
</li>
<li>
<p>Integration Module</p>
</li>
<li>
<p>Microservice Module</p>
</li>
<li>
<p>Compose for Redis Module</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>See: <a href="https://github.com/devonfw/devon/wiki#ip-modules" class="bare">https://github.com/devonfw/devon/wiki#ip-modules</a></p>
</div>
</div>
<div class="sect3">
<h4 id="release-notes-version-2.3.asciidoc_devonfw-shop-floor">66.3.10. devonfw Shop Floor</h4>
<div class="paragraph">
<p>This incubator is intended to be a compilation of DevOps experiences from the devonfw perspective. “How we use our devonfw projects in DevOps environments”. Integration with the Production Line, creation and service integration of a Docker-based CI environment and deploying devonfw applications in an OpenShift Origin cluster using devonfw templates.</p>
</div>
<div class="paragraph">
<p>See: <a href="https://github.com/devonfw/devonfw-shop-floor" class="bare">https://github.com/devonfw/devonfw-shop-floor</a></p>
</div>
</div>
<div class="sect3">
<h4 id="release-notes-version-2.3.asciidoc_devonfw-testing">66.3.11. devonfw-testing</h4>
<div class="paragraph">
<p>The Allure Test Framework is an automated testing framework for functional testing of web applications and in coming future native mobile apps, web services and databases. All modules have tangible examples of how to build resilient integration test cases based on delivered functions.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Examples available under embedded project “Allure-App-Under-Test” and in project wiki: <a href="https://github.com/devonfw/devonfw-testing/wiki" class="bare">https://github.com/devonfw/devonfw-testing/wiki</a></p>
</li>
<li>
<p>How to install: <a href="https://github.com/devonfw/devonfw-testing/wiki/How-to-install" class="bare">https://github.com/devonfw/devonfw-testing/wiki/How-to-install</a></p>
</li>
<li>
<p>Release Notes:</p>
<div class="ulist">
<ul>
<li>
<p>Core Module – ver.4.12.0.3:</p>
<div class="ulist">
<ul>
<li>
<p>Test report with logs and/or screenshots</p>
</li>
<li>
<p>Test groups/tags</p>
</li>
<li>
<p>Data Driven (inside test case, external file)</p>
</li>
<li>
<p>Test case parallel execution</p>
</li>
<li>
<p>Run on independent Operating System (Java)</p>
</li>
<li>
<p>Externalize test environment (DEV, QA, PROD)</p>
</li>
</ul>
</div>
</li>
<li>
<p>UI Selenium module – ver. 3.4.0.3:</p>
<div class="ulist">
<ul>
<li>
<p>Malleable resolution ( Remote Web Design, Mobile browsers)</p>
</li>
<li>
<p>Support for many browsers( Internet Explorer, Edge, Chrome, Firefox, Safari)</p>
</li>
<li>
<p>User friendly actions ( elementCheckBox, elementDropdown, etc. )</p>
</li>
<li>
<p>Ubíquese test execution (locally, against Selenium Grid through Jenkins)</p>
</li>
<li>
<p>Page Object Model architecture</p>
</li>
<li>
<p>Selenium WebDriver library ver. 3.4.0</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>See:  <a href="https://github.com/devonfw/devonfw-testing/wiki" class="bare">https://github.com/devonfw/devonfw-testing/wiki</a></p>
</div>
</div>
<div class="sect3">
<h4 id="release-notes-version-2.3.asciidoc_dot.net-framework-incubators">66.3.12. DOT.NET Framework incubators</h4>
<div class="paragraph">
<p>The .NET Core and Xamarin frameworks are still under development by a workgroup from The Netherlands, Spain, Poland, Italy, Norway and Germany. The 1.0 release is expected to be coming soon but the current incubator frameworks are already being used in several engagements.  Some features to highlight are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Full .NET implementation with multi-platform support</p>
</li>
<li>
<p>Detailed documentation for developers</p>
</li>
<li>
<p>Docker ready</p>
</li>
<li>
<p>Web API server side template :</p>
<div class="ulist">
<ul>
<li>
<p>Swagger auto-generation</p>
</li>
<li>
<p>JWT security</p>
</li>
<li>
<p>Entity Framework Support</p>
</li>
<li>
<p>Advanced log features</p>
</li>
</ul>
</div>
</li>
<li>
<p>Xamarin Templates based on Excalibur framework</p>
</li>
<li>
<p>My Thai Star implementation:</p>
<div class="ulist">
<ul>
<li>
<p>Backend (.NET Core)</p>
</li>
<li>
<p>FrontEnd (Xamarin)</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="release-notes-version-2.3.asciidoc_devonfw-has-been-primed-by-red-hat-for-openshift">66.3.13. devonfw has been Primed by Red Hat for OpenShift</h4>
<div class="paragraph">
<p>OpenShift is a supported distribution of Kubernetes from Red Hat for container-based software deployment and management. It is using Docker containers and DevOps tools for accelerated application development. Using Openshift allows Capgemini to avoid Cloud Vendor lock-in. Openshift provides devonfw with a state of the art CI/CD environment (devonfw Shop Floor), providing devonfw with a platform for the whole development life cycle: from development to staging / deploy.</p>
</div>
<div class="paragraph">
<p>See <a href="https://hub.openshift.com/primed/120-capgemini" class="bare">https://hub.openshift.com/primed/120-capgemini</a> and <a href="https://github.com/oasp/s2i" class="bare">https://github.com/oasp/s2i</a></p>
</div>
</div>
<div class="sect3">
<h4 id="release-notes-version-2.3.asciidoc_harvested-components-and-modules">66.3.14. Harvested components and modules</h4>
<div class="paragraph">
<p>The devonfw Harvesting process continues to add valuable components and modules to the devonfw platform. The last months the following elements were contributed:</p>
</div>
<div class="sect4">
<h5 id="release-notes-version-2.3.asciidoc_service-client-support-for-micro-service-projects.">Service Client support (for Micro service Projects).</h5>
<div class="paragraph">
<p>This client is for consuming microservices from other application.This solution is already very flexible and customizable.As of now,this is suitable for small and simple project where two or three microservices are invoked. Donated by Jörg Holwiller. See: <a href="https://github.com/devonfw/devon-microservices" class="bare">https://github.com/devonfw/devon-microservices</a></p>
</div>
</div>
<div class="sect4">
<h5 id="release-notes-version-2.3.asciidoc_jhipster-devonfw-code-generation">JHipster devonfw code generation</h5>
<div class="paragraph">
<p>This compomnent was donated by the ADcenter in Valencia. It was made in order to comply with strong requirements (especially from the French BU) to use jHipster for code generation.</p>
</div>
<div class="paragraph">
<p>JHipster is a code generator based on Yeoman generators. Its default generator generator-jhipster generates a specific JHipster structure. The purpose of generator-jhipster-DevonModule is to generate the structure and files of a typical OASP4j project. It is therefore equivalent to the standard OASP4j application template based Cobige code generation.</p>
</div>
<div class="paragraph">
<p>See: <a href="https://github.com/devonfw/devon-guide/wiki/cookbook-devon-jhipster-module" class="bare">https://github.com/devonfw/devon-guide/wiki/cookbook-devon-jhipster-module</a></p>
</div>
</div>
<div class="sect4">
<h5 id="release-notes-version-2.3.asciidoc_simple-jenkins-task-status-dashboard">Simple Jenkins task status dashboard</h5>
<div class="paragraph">
<p>This component has been donated by, has been harvested from system in use by, Capgemini  Valencia. This dashboard, apart from an optional gamification element, allows the display of multiple Jenkins instances. See: <a href="https://github.com/oasp/jenkins_view" class="bare">https://github.com/oasp/jenkins_view</a></p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="release-notes-version-2.3.asciidoc_and-lots-more">66.3.15. And lots more, among others:</h4>
<div class="ulist">
<ul>
<li>
<p>OASP4J/devonfw docker based build IN a docker process. See: <a href="https://github.com/devonfw/devon-guide/wiki/Dockerfile-for-the-maven-based-spring.io-projects" class="bare">https://github.com/devonfw/devon-guide/wiki/Dockerfile-for-the-maven-based-spring.io-projects</a></p>
</li>
<li>
<p>CI test boot archetype. This is for unit testing.This will create a sample project and add sample web service to it. A Jenkins job will start oasp4j server and will call web service. See: <a href="https://github.com/devonfw/devonfw-shop-floor/tree/master/testing/Oasp4jTestingScripts" class="bare">https://github.com/devonfw/devonfw-shop-floor/tree/master/testing/Oasp4jTestingScripts</a></p>
</li>
<li>
<p>CI test Angular starterTemplate. Testing automation for Angular applications (My Thai Star) in Continuous Integration environments by using Headless browsers and creating Node.js scripts. See: <a href="https://github.com/oasp/my-thai-star/blob/develop/angular/package.json#L8-L12" class="bare">https://github.com/oasp/my-thai-star/blob/develop/angular/package.json#L8-L12</a> and <a href="https://github.com/oasp/my-thai-star/blob/develop/angular/karma.conf.js" class="bare">https://github.com/oasp/my-thai-star/blob/develop/angular/karma.conf.js</a></p>
</li>
</ul>
</div>
<!-- toc disabled -->
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="release-notes-version-2.2.asciidoc">67. devonfw Release notes 2.2 "Courage"</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="release-notes-version-2.2.asciidoc_production-line-integration">67.1. Production Line Integration</h3>
<div class="paragraph">
<p>devonfw is now fully supported on the Production Line v1.3 and the coming v2.0. Besides that, we now "eat our own dogfood" as the whole devonfw project, all "buildable assets", now run on the Production Line.</p>
</div>
</div>
<div class="sect2">
<h3 id="release-notes-version-2.2.asciidoc_oasp4js-2.0">67.2. OASP4js 2.0</h3>
<div class="paragraph">
<p>The main focus of the Courage release is the renewed introduction of "OASP for JavaScript", or OASP4js. This new version is a completely new implementation based on Angular (version 4). This new "stack" comes with:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>New application templates for Angular 4 application (as well as Ionic 3)</p>
</li>
<li>
<p>A new reference application</p>
</li>
<li>
<p>A new tutorial (and Architecture Guide following soon)</p>
</li>
<li>
<p>Component Gallery</p>
</li>
<li>
<p>New Cobigen templates for generation of both Angular 4 and Ionic 3 UI components ("screens")</p>
</li>
<li>
<p>Integration of Covalent and Bootstrap offering a large number of components</p>
</li>
<li>
<p>my-thai-star, a showcase and reference implementation in Angular of a real, responsive usable app using recommended architecture and patterns</p>
</li>
<li>
<p>A new Tutorial using my-thai-star as a starting point</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>See:
<a href="https://github.com/oasp/oasp4js-application-template" class="bare">https://github.com/oasp/oasp4js-application-template</a>
<a href="https://github.com/oasp/oasp4js-angular-catalog" class="bare">https://github.com/oasp/oasp4js-angular-catalog</a>
<a href="https://github.com/oasp/my-thai-star/tree/develop/angular" class="bare">https://github.com/oasp/my-thai-star/tree/develop/angular</a></p>
</div>
</div>
<div class="sect2">
<h3 id="release-notes-version-2.2.asciidoc_a-new-oasp-portal">67.3. A new OASP Portal</h3>
<div class="paragraph">
<p>As part of the new framework(s) we have also done a complete redesign of the OASP Portal website at <a href="http://oasp.io/" class="bare">http://oasp.io/</a> which should make all things related with OASP more accessible and easier to find.</p>
</div>
</div>
<div class="sect2">
<h3 id="release-notes-version-2.2.asciidoc_new-cobigen">67.4. New Cobigen</h3>
<div class="paragraph">
<p>Major changes in this release:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Support for multi-module projects</p>
</li>
<li>
<p>Client UI Generation:</p>
<div class="ulist">
<ul>
<li>
<p>New Angular 4 templates based on the latest - angular project seed</p>
</li>
<li>
<p>Basic Typescript Merger</p>
</li>
<li>
<p>Basic Angular Template Merger</p>
</li>
<li>
<p>JSON Merger</p>
</li>
</ul>
</div>
</li>
<li>
<p>Refactored oasp4j templates to make use of Java template logic feature</p>
</li>
<li>
<p>Bugfixes:</p>
<div class="ulist">
<ul>
<li>
<p>Fixed merging of nested Java annotations including array values</p>
</li>
<li>
<p>more minor issues</p>
</li>
</ul>
</div>
</li>
<li>
<p>Under the hood:</p>
<div class="ulist">
<ul>
<li>
<p>Large refactoring steps towards language agnostic templates formatting sensitive placeholder descriptions automatically formatting camelCase to TrainCase to snake-case, etc.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Easy setup of CobiGen IDE to enable fluent contribution</p>
</li>
<li>
<p>CI integration improved to integrate with GitHub for more valuable feedback</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>See: <a href="https://github.com/devonfw/tools-cobigen/releases" class="bare">https://github.com/devonfw/tools-cobigen/releases</a></p>
</div>
</div>
<div class="sect2">
<h3 id="release-notes-version-2.2.asciidoc_mythaistar-new-restaurant-example">67.5. MyThaiStar: New Restaurant Example, reference implementation &amp; Methodology showcase</h3>
<div class="paragraph">
<p>A major part of the new devonfw release is the incorporation of a new application, "my-thai-star" which among others:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>serve as an example of how to make a "real" devonfw application (i.e. the application could be used for real)</p>
</li>
<li>
<p>Serves  as an attractive showcase</p>
</li>
<li>
<p>Serves as a reference application of devonfw patterns and practices as well as the standard example in the new devonfw tutorial</p>
</li>
<li>
<p>highlights modern security option like JWT Integration</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The application is  accompanied by a substantial new documentation asset, the devonfw methodology, which described in detail the whole lifecycle of the development of a devonfw application, from requirements gathering to technical design. Officially my-that-star is still considered to be an incubator as especially this last part is still not as mature as it could be. But the example application and tutorial are 100% complete and functional and form a marked improvement over the "old" restaurant example app. My-Thai-star will become the standard example app from devonfw 3.0 onwards.</p>
</div>
<div class="paragraph">
<p>See:     <a href="https://github.com/oasp/my-thai-star" class="bare">https://github.com/oasp/my-thai-star</a>
         <a href="https://github.com/oasp/my-thai-star/wiki" class="bare">https://github.com/oasp/my-thai-star/wiki</a></p>
</div>
</div>
<div class="sect2">
<h3 id="release-notes-version-2.2.asciidoc_the-new-oasp-tutorial">67.6. The new OASP Tutorial</h3>
<div class="paragraph">
<p>The OASP Tutorial is a new part of the combined OASP / devonfw documentation which changes the focus of how people can get started with the platform</p>
</div>
<div class="paragraph">
<p>There are tutorials for OASP4j, OASP4js (Angular), OASP4fn and more to come. My-Thai-Star is used throughout the tutorial series to demonstrate the basic principles, architecture, and good practices of the different OASP "stacks". There is an elaborated exercise where the readers get to write their own application "JumpTheQueue".</p>
</div>
<div class="paragraph">
<p>We hope that the new tutorial offers a better, more efficient way for people to get started with devonfw. Answering especially the question: how to make a devonfw application.</p>
</div>
<div class="paragraph">
<p>Oasp4j tutorial: <a href="https://github.com/oasp/oasp-tutorial-sources/wiki/OASP4jGettingStartedHome" class="bare">https://github.com/oasp/oasp-tutorial-sources/wiki/OASP4jGettingStartedHome</a>
Oasp4js tutorial: <a href="https://github.com/oasp/oasp-tutorial-sources/wiki/OASP4jsGettingStartedHome" class="bare">https://github.com/oasp/oasp-tutorial-sources/wiki/OASP4jsGettingStartedHome</a>
Oasp4fn tutorial: <a href="https://github.com/oasp/oasp-tutorial-sources/wiki/OASP4FnGettingStartedHome" class="bare">https://github.com/oasp/oasp-tutorial-sources/wiki/OASP4FnGettingStartedHome</a></p>
</div>
</div>
<div class="sect2">
<h3 id="release-notes-version-2.2.asciidoc_oasp4j-2.4.0">67.7. OASP4j 2.4.0</h3>
<div class="paragraph">
<p>"OASP for Java" or OASP4j now includes updated versions of the latest stable versions of Spring Boot and the Spring Framework and all related dependencies. This allows guaranteed, stable, execution of any devonfw 2.X application on the latest versions of the Industry Standard Spring stack.
Another important new feature is a new testing architecture/infrastructure. All database options are updated to the latest versions as well as guaranteed to function on all Application Servers which should cause less friction and configuration time when starting a new OASP4j project.</p>
</div>
<div class="paragraph">
<p>Details:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Spring Boot Upgrade to 1.5.3</p>
</li>
<li>
<p>Updated all underlying dependencies</p>
</li>
<li>
<p>Spring version is 4.3.8</p>
</li>
<li>
<p>Exclude Third Party Libraries that are not needed from sample restaurant application</p>
</li>
<li>
<p>Bugfix:Fixed the 'WhiteLabel' error received when tried to login to the sample restaurant application that is deployed onto external Tomcat</p>
</li>
<li>
<p>Bugfix:Removed the API api.org.apache.catalina.filters.SetCharacterEncodingFilter and used spring framework&#8217;s API org.springframework.web.filter.CharacterEncodingFilter instead</p>
</li>
<li>
<p>Bugfix:Fixed the error "class file for javax.interceptor.InterceptorBinding not found" received when executing the command 'mvn site' when trying to generate javadoc using Maven javadoc plugin</p>
</li>
<li>
<p>Removed the deprecated API io.oasp.module.web.common.base.PropertiesWebApplicationContextInitializer</p>
</li>
<li>
<p>Documentation of the usage of UserDetailsService of Spring Security</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>See: <a href="https://github.com/oasp/oasp4j" class="bare">https://github.com/oasp/oasp4j</a></p>
</div>
<div class="paragraph">
<p>Wiki: <a href="https://github.com/oasp/oasp4j/wiki" class="bare">https://github.com/oasp/oasp4j/wiki</a></p>
</div>
</div>
<div class="sect2">
<h3 id="release-notes-version-2.2.asciidoc_microservices-netflix">67.8. Microservices Netflix</h3>
<div class="paragraph">
<p>devonfw now includes a microservices implementation based on Spring Cloud Netflix. It provides a Netflix OSS integrations for Spring Boot apps through autoconfiguration and binding to the Spring Environment. It  offers microservices archetypes and a complete user guide with all the details to start creating microservices with devonfw.</p>
</div>
<div class="paragraph">
<p>See: <a href="https://github.com/devonfw-forge/devon-guide/wiki/devon-microservices" class="bare">https://github.com/devonfw-forge/devon-guide/wiki/devon-microservices</a></p>
</div>
</div>
<div class="sect2">
<h3 id="release-notes-version-2.2.asciidoc_devonfw-distribution-based-on-eclipse-oomph">67.9. devonfw distribution based on Eclipse OOMPH</h3>
<div class="paragraph">
<p>The new Eclipse devonfw distribution is now based on Eclipse OOMPH, which allows us, an any engagement, to create and manage the distribution more effectively by formalizing the setup instructions so they can be performed automatically (due to a blocking issue postponed to devonfw 2.2.1 which will be released a few weeks after 2.2.0)</p>
</div>
</div>
<div class="sect2">
<h3 id="release-notes-version-2.2.asciidoc_visual-studio-code--atom">67.10. Visual Studio Code / Atom</h3>
<div class="paragraph">
<p>The devonfw distro now contains Visual Studio Code alongside Eclipse in order to provide a default, state of the art, environment for web based development.</p>
</div>
<div class="paragraph">
<p>See: <a href="https://github.com/oasp/oasp-vscode-ide" class="bare">https://github.com/oasp/oasp-vscode-ide</a></p>
</div>
</div>
<div class="sect2">
<h3 id="release-notes-version-2.2.asciidoc_more-i18n-options">67.11. More I18N options</h3>
<div class="paragraph">
<p>The platform now contains more documentation and a conversion utility which makes it easier to share i18n resource files between the different frameworks.</p>
</div>
<div class="paragraph">
<p>See: <a href="https://github.com/devonfw/devon/wiki/cookbook-i18n-resource-converter" class="bare">https://github.com/devonfw/devon/wiki/cookbook-i18n-resource-converter</a></p>
</div>
</div>
<div class="sect2">
<h3 id="release-notes-version-2.2.asciidoc_spring-integration-as-devonfw-module">67.12. Spring Integration as devonfw Module</h3>
<div class="paragraph">
<p>This release includes a new module based on the Java Message Service (JMS) and Spring Integration which provides a communication system (sender/subscriber) out-of-the-box with simple channels (only to send and read messages), request and reply channels (to send messages and responses) and request &amp; reply asynchronously channels.</p>
</div>
<div class="paragraph">
<p>See: <a href="https://github.com/devonfw/devon/wiki/cookbook-integration-module" class="bare">https://github.com/devonfw/devon/wiki/cookbook-integration-module</a></p>
</div>
</div>
<div class="sect2">
<h3 id="release-notes-version-2.2.asciidoc_devonfw-harvest-contributions">67.13. devonfw Harvest contributions</h3>
<div class="paragraph">
<p>devonfw contains a whole series of new components obtained through the Harvesting process. Examples are :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>New backend IP module Compose for Redis: management component for cloud environments. Redis is an open-source, blazingly fast, key/value low maintenance store. Compose&#8217;s platform gives you a configuration pre-tuned for high availability and locked down with additional security features. The component will manage the service connection and the main methods to manage the key/values on the storage. The library used is "lettuce".</p>
</li>
<li>
<p>Sencha component for extending GMapPanel with the following functionality :</p>
<div class="ulist">
<ul>
<li>
<p>Markers management</p>
</li>
<li>
<p>Google Maps options management</p>
</li>
<li>
<p>Geoposition management</p>
</li>
<li>
<p>Search address and coordinates management</p>
</li>
<li>
<p>Map events management</p>
</li>
<li>
<p>Map life cycle and behavior management</p>
</li>
</ul>
</div>
</li>
<li>
<p>Sencha responsive Footer that moves from horizontal to vertical layout depending on the screen resolution or the device type. It is a simple functionality but we consider it very useful and reusable.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>See: <a href="https://github.com/devonfw/devon/wiki/cookbook-compose-for-redis-module" class="bare">https://github.com/devonfw/devon/wiki/cookbook-compose-for-redis-module</a></p>
</div>
</div>
<div class="sect2">
<h3 id="release-notes-version-2.2.asciidoc_more-deployment-options-to-jee-application-servers-and-dockercloudfoundry">67.14. More Deployment options to JEE Application Servers and Docker/CloudFoundry</h3>
<div class="paragraph">
<p>The platform now fully supports deployment on the latest version of Weblogic, Websphere, Wildfly (JBoss) as well as Docker and Cloudfoundtry</p>
</div>
<div class="paragraph">
<p>See:    <a href="https://github.com/devonfw/devon/wiki/Deployment-on-WebLogic" class="bare">https://github.com/devonfw/devon/wiki/Deployment-on-WebLogic</a>
    <a href="https://github.com/devonfw/devon/wiki/cookbook-Deployment-on-WebSphere" class="bare">https://github.com/devonfw/devon/wiki/cookbook-Deployment-on-WebSphere</a>
    <a href="https://github.com/devonfw/devon/wiki/cookbook-Deployment-on-Wildfly" class="bare">https://github.com/devonfw/devon/wiki/cookbook-Deployment-on-Wildfly</a></p>
</div>
</div>
<div class="sect2">
<h3 id="release-notes-version-2.2.asciidoc_devcon-on-linux">67.15. Devcon on Linux</h3>
<div class="paragraph">
<p>Devcon is now fully supported on Linux which, together with the devonfw distro running on Linux, makes devonfw fully multi-platform and Cloud compatible (as Linux is the default OS in the Cloud!)</p>
</div>
<div class="paragraph">
<p>See: <a href="https://github.com/devonfw/devcon/releases" class="bare">https://github.com/devonfw/devcon/releases</a></p>
</div>
</div>
<div class="sect2">
<h3 id="release-notes-version-2.2.asciidoc_new-oasp-incubators">67.16. New OASP Incubators</h3>
<div class="paragraph">
<p>From different Business Units (countries) have contributed "incubator" frameworks:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>OASP4NET (Stack based on .NET Core / .NET "Classic" (4.6))</p>
</li>
<li>
<p>OASP4X (Stack based on Xamarin)</p>
</li>
<li>
<p>OASP4Fn (Stack based on Node-js/Serverless): <a href="https://github.com/oasp/oasp4fn" class="bare">https://github.com/oasp/oasp4fn</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>An "incubator" status means that the frameworks are production ready, all are actually already used in production, but  are still not fully compliant with the OASP definition of a "Minimally Viable Product".</p>
</div>
<div class="paragraph">
<p>During this summer the OASP4NET and OASP4X repos will be properly installed. In the mean time, if you want to have access to the source code, please contact the <em>devonfw Core Team</em>.</p>
</div>
<!-- toc disabled -->
</div>
</div>
</div>
<div class="sect1">
<h2 id="release-notes-version-2.1.asciidoc">68. Release notes devonfw 2.1.1 "Balu"</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="release-notes-version-2.1.asciidoc_version-2.1.2-oasp4j-updates--some-new-features">68.1. Version 2.1.2: OASP4J updates &amp; some new features</h3>
<div class="paragraph">
<p>We&#8217;ve released the latest update release of devonfw in the <em>Balu</em> series: version 2.1.2. The next major release, code named <em>Courage</em>, will be released approximately the end of June. This current release contains the following items:</p>
</div>
<div class="sect3">
<h4 id="release-notes-version-2.1.asciidoc_oasp4j-2.3.0-release">68.1.1. OASP4j 2.3.0 Release</h4>
<div class="paragraph">
<p>Friday the 12th of May 2017 OASP4J version 2.3.0 was released. Major features added are :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Database Integration with PostGres, MSSQL Server, MariaDB</p>
</li>
<li>
<p>Added docs folder for gh pages and added oomph setups</p>
</li>
<li>
<p>Refactored Code</p>
</li>
<li>
<p>Refactored Test Infrastructure</p>
</li>
<li>
<p>Added Documentation on debugging tests</p>
</li>
<li>
<p>Added Two Batch Job tests in the restaurant sample</p>
</li>
<li>
<p>Bugfix: Fixed the error received when the Spring Boot Application from sample application that is created from maven archetype is launched</p>
</li>
<li>
<p>Bugfix: Fix for 404 error received when clicked on the link '1. Table' in index.html of the sample application created from maven archetype</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>More details on features added can be found at <a href="https://github.com/oasp/oasp4j/milestone/23?closed=1" class="bare">https://github.com/oasp/oasp4j/milestone/23?closed=1</a> .
The OASP4j wiki and other documents are updated for release 2.3.0.</p>
</div>
</div>
<div class="sect3">
<h4 id="release-notes-version-2.1.asciidoc_cobigen-enhancements">68.1.2. Cobigen Enhancements</h4>
<div class="paragraph">
<p>Previous versions of CobiGen are able to generate code for REST services only. Now it is possible to generate the code for SOAP services as well. There are two use cases available in CobiGen:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>SOAP without nested data</p>
</li>
<li>
<p>SOAP nested data</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The "nested data" use case is when there are 3 or more entities which are interrelated with each other. Cobigen will generate code which will return the nested data. Currently Cobigen services return ETO classes, Cobigen has been enhanced as to return CTO classes (ETO + relationship).</p>
</div>
<div class="paragraph">
<p>Apart from the SOAP code generation, the capability to express nested relationships have been added to the existing ReST code generator as well.</p>
</div>
<div class="paragraph">
<p>See: <a href="https://github.com/devonfw/devon-guide/wiki/cookbook-cobigen-advanced-use-cases-soap-and-nested-data" class="bare">https://github.com/devonfw/devon-guide/wiki/cookbook-cobigen-advanced-use-cases-soap-and-nested-data</a></p>
</div>
</div>
<div class="sect3">
<h4 id="release-notes-version-2.1.asciidoc_micro-services-module-spring-cloudnetflix-oss">68.1.3. Micro services module (Spring Cloud/Netflix OSS)</h4>
<div class="paragraph">
<p>To make it easier for devonfw users to design and develop applications based on microservices, this release provides a series of archetypes and resources based on <em>Spring Cloud Netflix</em> to automate the creation and configuration of microservices.</p>
</div>
<div class="paragraph">
<p>New documentation ind de devonfw Guide contais all the details to start <a href="https://github.com/devonfw-forge/devon-guide/wiki/devon-microservices">creating microservices with devonfw</a></p>
</div>
</div>
<div class="sect3">
<h4 id="release-notes-version-2.1.asciidoc_spring-integration-module">68.1.4. Spring Integration Module</h4>
<div class="paragraph">
<p>Based on the <em>Java Message Service</em> (JMS) and <em>Spring Integration</em>, the devonfw <em>Integration module</em> provides a communication system (sender/subscriber) out-of-the-box with simple channels (only to send and read messages), request and reply channels (to send messages and responses) and request &amp; reply asynchronously channels. You can find more details about the implementation in the <a href="https://github.com/devonfw/devon-guide/wiki/cookbook-integration-module">devonfw guide</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="release-notes-version-2.1.asciidoc_websphere--wildfly-deployment-documentation">68.1.5. WebSphere &amp; Wildfly deployment documentation</h4>
<div class="paragraph">
<p>The new version of devonfw contains more elaborate and updated documentation about deployment on <a href="https://github.com/devonfw/devon-guide/wiki/cookbook-Deployment-on-WebSphere">WebSpere</a> and <a href="https://github.com/devonfw/devon-guide/wiki/cookbook-Deployment-on-Wildfly">Wildfly</a>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="release-notes-version-2.1.asciidoc_version-2.1.1-updates">68.2. Version 2.1.1 Updates, fixes &amp; some new features</h3>
<div class="sect3">
<h4 id="release-notes-version-2.1.asciidoc_cobigen-code-generator-fixes">68.2.1. Cobigen code-generator fixes</h4>
<div class="paragraph">
<p>The Cobigen incremental code generator released in the previous version contained a regression which has now been fixed. Generating services in Batch mode whereby a package can be given as an input, using all Entities contained in that package, works again as expected.</p>
</div>
<div class="paragraph">
<p>For more information see: <a href="https://github.com/devonfw/tools-cobigen/wiki">The Cobigen documentation</a> and the corresponding change in the <a href="https://github.com/devonfw/devon/wiki/getting-started-Cobigen">devonfw Guide</a></p>
</div>
</div>
<div class="sect3">
<h4 id="release-notes-version-2.1.asciidoc_devcon-enhancements">68.2.2. Devcon enhancements</h4>
<div class="paragraph">
<p>In this new release we have added devcon to the devonfw distribution itself so one can directly use devcon from the console.bat or ps-console.bat windows. It is therefore no longer necessary to independently install devcon. However, as devcon is useful outside of the devonfw distribution, this remains a viable option.</p>
</div>
</div>
<div class="sect3">
<h4 id="release-notes-version-2.1.asciidoc_devon4sencha">68.2.3. Devon4Sencha</h4>
<div class="paragraph">
<p>in Devon4Sencha there are changes in the sample application. It now complies fully with the architecture which is known as "universal app", so now it has screens custom tailored for desktop and mobile devices. All the basic logic remains the same for both versions. (The StarterTemplate is still only for creating a desktop app. This will be tackled in the next release.)</p>
</div>
</div>
<div class="sect3">
<h4 id="release-notes-version-2.1.asciidoc_new-winauth-modules">68.2.4. New Winauth modules</h4>
<div class="paragraph">
<p>The original <em>winauth</em> module that, in previous Devon versions, implemeted the <em>Active Directory</em> authentication and the <em>Single Sign-on</em> authentication now has been divided in two independent modules. The <em>Active Directory</em> authentication now is included in the new <em>Winauth-ad</em> module whereas the <em>Single Sign-on</em> implementation is included in a separate module called <em>Winauth-sso</em>.
Also some improvements have been added to <em>Winauth-sso</em> module to ease the way in which the module can be injected.</p>
</div>
<div class="paragraph">
<p>For more information about the update see: <a href="https://github.com/devonfw/devon/wiki/Client-GUI-Sencha-Introduction-to-Devon4sencha">The Sencha docs within the devonfw Guide</a></p>
</div>
</div>
<div class="sect3">
<h4 id="release-notes-version-2.1.asciidoc_general-updates">68.2.5. General updates</h4>
<div class="paragraph">
<p>There are a series of updates to the devonfw documentation, principally the devonfw Guide. Further more, from this release on, you can find the devonfw guide in the <em>doc</em> folder of the distribution.</p>
</div>
<div class="paragraph">
<p>Furthermore, the OASP4J and devonfw source-code in the "examples" workspace, have been updated to the latest version.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="release-notes-version-2.1.asciidoc_version-2.1-new-features">68.3. Version 2.1 New features, improvements and updates</h3>
<div class="sect3">
<h4 id="release-notes-version-2.1.asciidoc_introduction">68.3.1. Introduction</h4>
<div class="paragraph">
<p>We are proud to present the new release of devonfw, version "2.1" which we&#8217;ve baptized "Balu". A major focus for this release is developer productivity. So that explains the name, as Balu is not just big, friendly and cuddly but also was very happy to let Mowgli do the work for him.</p>
</div>
</div>
<div class="sect3">
<h4 id="release-notes-version-2.1.asciidoc_cobigen-code-generator-ui-code-generation-and-more">68.3.2. Cobigen code-generator UI code generation and more</h4>
<div class="paragraph">
<p>The Cobigen incremental code generator which is part of devonfw has been significantly improved. Based on a single data schema it can generate the JPA/Hibernate code for the whole service layer (from data-access code to web services) for all CRUD operations. When generating code, Cobigen is able to detect and leave untouched any code which developers have added manually.</p>
</div>
<div class="paragraph">
<p>In the new release it supports Spring Data for data access and it is now capable of generating the whole User Interface as well: data-grids and individual rows/records with support for filters, pagination etc.  That is to say: Cobigen can now generate automatically all the code from the server-side database access layer all the way up to the UI "screens" in the web browser.</p>
</div>
<div class="paragraph">
<p>Currently we support Sencha Ext JS with support for Angular 2 coming soon. The code generated by Cobigen can be opened and used by Sencha Architect, the visual design tool, which enables the programmer to extend and enhance the generated UI non-programmatically. When Cobigen regenerates the code, even those additions are left intact. All these features combined allow for an iterative, incremental way of development which can be up to an order of an magnitude more productive than "programming manual"</p>
</div>
<div class="paragraph">
<p>Cobigen can now also be used for code-generation within the context of an engagement. It is easily extensible and the process of how to extend it for your own project is well documented. This becomes already worthwhile ("delivers ROI") when having 5+ identical elements within the project.</p>
</div>
<div class="paragraph">
<p>For more information see: <a href="https://github.com/devonfw/tools-cobigen/wiki">The Cobigen documentation</a> and the corresponding changer in the <a href="https://github.com/devonfw/devon/wiki/getting-started-Cobigen">devonfw Guide</a> and</p>
</div>
</div>
<div class="sect3">
<h4 id="release-notes-version-2.1.asciidoc_angular-2">68.3.3. Angular 2</h4>
<div class="paragraph">
<p>With the official release of Angular 2 and TypeScript 2, we&#8217;re slowly but steadily moving to embrace  these important new players in the  web development scene. We keep supporting the Angular 1 based OASP4js framework and are planning a migration of this framework to Angular 2 in the near future. For "Balu" we&#8217;ve have decided to integrate "vanilla" Angular 2.</p>
</div>
<div class="paragraph">
<p>We have migrated the Restaurant Sample application to serve as a, documented and supported, blueprint for Angular 2 applications. Furthermore, we support three "kickstarter" projects which help engagement getting started with Angular2 - either using Bootstrap or Google´s Material Design - or, alternatively, Ionic 2 (the mobile framework on top of Angular 2). For more information see: <a href="https://github.com/devonfw/devonfw-angular2-kickstarter">Angular 2 Kickstarter</a> and <a href="https://github.com/devonfw/devonfw-ionic2-kickstarter/">Ionic 2 Kickstarter</a></p>
</div>
</div>
<div class="sect3">
<h4 id="release-notes-version-2.1.asciidoc_oasp4j-2.2.0-release">68.3.4. OASP4J 2.2.0 Release</h4>
<div class="paragraph">
<p>A new release of OASP4J, version 2.2.0, is included in this release of devonfw. This release mainly focuses on server side of oasp. i.e oasp4j.</p>
</div>
<div class="paragraph">
<p>Major features added are :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Upgrade to Spring Boot 1.3.8.RELEASE</p>
</li>
<li>
<p>Upgrade to Apache CXF 3.1.8</p>
</li>
<li>
<p>Database Integration with Oracle 11g</p>
</li>
<li>
<p>Added Servlet for HTTP-Debugging</p>
</li>
<li>
<p>Refactored code and improved JavaDoc</p>
</li>
<li>
<p>Bugfix: mvn spring-boot:run executes successfully for oasp4j application created using oasp4j template</p>
</li>
<li>
<p>Added subsystem tests of SalesmanagementRestService and several other tests</p>
</li>
<li>
<p>Added Tests to test java packages conformance to OASP conventions</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>More details on features added can be found at <a href="https://github.com/oasp/oasp4j/milestone/19?closed=1(here" class="bare">https://github.com/oasp/oasp4j/milestone/19?closed=1(here</a>). The OASP4j wiki and other documents are updated for release 2.2.0.</p>
</div>
</div>
<div class="sect3">
<h4 id="release-notes-version-2.1.asciidoc_devon4sencha">68.3.5. Devon4Sencha</h4>
<div class="paragraph">
<p>Devon4Sencha is an alternative view layer for web applications developed with devonfw. It is based on Sencha Ext JS. As it requires a license for commercial applications it is not provided as Open Source and is considered to be part of the IP of Capgemini.</p>
</div>
<div class="paragraph">
<p>These libraries provide support for creating SPA (Single Page Applications) with a very rich set of components for both desktop and mobile. In the new version we extend this functionality to support for "Universal Apps", the Sencha specific term for true multi-device applications which make it possible to develop a single application for desktop, tablet as well as mobile devices. In the latest version Devon4Sencha has been upgraded to support Ext JS 6.2 and we now support the usage of Cobigen as well as Sencha Architect as extra option to improve developer productivity.
For more information about the update see: <a href="https://github.com/devonfw/devon/wiki/Client-GUI-Sencha-Introduction-to-Devon4sencha">The Sencha docs within the devonfw Guide</a></p>
</div>
</div>
<div class="sect3">
<h4 id="release-notes-version-2.1.asciidoc_devcon-enhancements">68.3.6. Devcon enhancements</h4>
<div class="paragraph">
<p>The Devon Console, Devcon, is a cross-platform command line tool running on the JVM that provides many automated tasks around the full life-cycle of Devon applications, from installing the basic working environment and generating a new project, to running a test server and deploying an application to production. It can be used by the engagements to integrate with their proprietary tool chain.</p>
</div>
<div class="paragraph">
<p>In this new release we have added an optional graphical user interface (with integrated help) which makes using Devcon even easier to use. Another new feature is that it is now possible to easily extend it with commands just by adding your own or project specific Javascript files. This makes it an attractive option for project task automation. You can find more information in the <a href="https://github.com/devonfw/devon/wiki/devcon-command-developers-guide">Devcon Command Developers Guide</a></p>
</div>
</div>
<div class="sect3">
<h4 id="release-notes-version-2.1.asciidoc_ready-for-the-cloud">68.3.7. Ready for the Cloud</h4>
<div class="paragraph">
<p>devonfw is in active use in the Cloud, with projects running on IBM Bluemix and on Amazon AWS. The focus is very much to keep Cloud-specific functionality decoupled from the devonfw core. The engagement can choose between - and easily configure the use of - either CloudFoundry or Spring Cloud (alternatively, you can run devonfw in Docker containers in the Cloud as well. See elsewhere in the release notes). For more information
about how to configure devonfw for use in the cloud see: <a href="https://github.com/devonfw/devon/wiki/cookbook-dockerization">devonfw on Docker</a> and <a href="https://github.com/devonfw/devon/wiki/devon-in-bluemix">devonfw in IBM Bluemix</a></p>
</div>
</div>
<div class="sect3">
<h4 id="release-notes-version-2.1.asciidoc_spring-data">68.3.8. Spring Data</h4>
<div class="paragraph">
<p>The java server stack within devonfw, OASP4J,  is build on a very solid DDD architecture  which uses JPA for its data access layer. We now offer integration of Spring Data as an alternative or to be used in conjunction with JPA. Spring Data offers significant advantages over JPA through its query mechanism which allows the developer to specify complex queries in an easy way. Overall working with Spring Data should be quite more productive compared with JPA for the average or junior developer. And extra advantage is that Spring Data also allows - and comes with support for - the usage of NoSQL databases like MongoDB, Cassandra, DynamoDB etc. THis becomes especially critical in the Cloud where NoSQL databases typically offer better scalability than relational databases.
For more information see: <a href="https://github.com/devonfw/devon/wiki/cookbook-spring-data">Integrating Spring Data in OASP4J</a></p>
</div>
</div>
<div class="sect3">
<h4 id="release-notes-version-2.1.asciidoc_videos-content-in-the-devonfw-guide">68.3.9. Videos content in the devonfw Guide</h4>
<div class="paragraph">
<p>The devonfw Guide is the single, authoritative tutorial and reference ("cookbook") for all things devonfw, targeted at the general developer working with the platform (there is another document for Architects).  It is clear and concise but because of the large scope and wide reach of devonfw, it comes with a hefty 370+ pages. For the impatient - and sometimes images do indeed say more than words - we&#8217;ve added 17 videos to the Guide which significantly speed up getting started with the diverse aspects of devonfw.</p>
</div>
<div class="paragraph">
<p>For more information see: <a href="https://coconet.capgemini.com/sf/frs/do/listReleases/projects.apps2_devon/frs.videos">Video releases on TeamForge</a></p>
</div>
</div>
<div class="sect3">
<h4 id="release-notes-version-2.1.asciidoc_containerisation-with-docker-and-the-production-line">68.3.10. Containerisation with Docker and the Production Line</h4>
<div class="paragraph">
<p>Docker (see: <a href="https://www.docker.com/" class="bare">https://www.docker.com/</a>) containers wrap a piece of software in a complete filesystem that contains everything needed to run: code, runtime, system tools, system libraries – anything that can be installed on a server. Docker containers resemble virtual machines but are far more resource efficient. Because of this, Docker and related technologies like Kubernetes are taking the Enterprise and Cloud by storm. We have certified and documented the usage of devonfw on Docker so we can now firmly state that "devonfw is Docker" ready. All the more so as the iCSD Production Line is now supporting devonfw as well. The Production Line is a Docker based set of methods and tools that make possible to develop custom software to our customers on time and with the expected quality. By having first-class support for devonfw on the Production Line, iCSD has got an unified, integral solution which covers all the phases involved on the application development cycle from requirements to testing and hand-off to the client.</p>
</div>
<div class="paragraph">
<p>See: <a href="https://github.com/devonfw/devon/wiki/cookbook-dockerization">devonfw on Docker</a> and <a href="https://github.com/devonfw/devon/wiki/devon-guide-production-line">devonfw on the Production Line</a></p>
</div>
</div>
<div class="sect3">
<h4 id="release-notes-version-2.1.asciidoc_eclipse-neon">68.3.11. Eclipse Neon</h4>
<div class="paragraph">
<p>devonfw comes with its own pre configured and enhanced Eclipse based IDE:  the Open Source "OASP IDE" and "devonfw Distr" which falls under Capgemini IP. We&#8217;ve updated both versions to the latest stable version of Eclipse, Neon. From Balu onwards we support the IDE on Linux as well and we offer downloadable versions for both Windows and Linux.</p>
</div>
<div class="paragraph">
<p>See: <a href="https://github.com/devonfw/devon-guide/wiki/getting-started-the-devon-ide">The Devon IDE</a></p>
</div>
</div>
<div class="sect3">
<h4 id="release-notes-version-2.1.asciidoc_default-java-8-with-java-7-compatibility">68.3.12. Default Java 8 with Java 7 compatibility</h4>
<div class="paragraph">
<p>From version 2.1. "Balu" onwards, devonfw is using by default Java 8 for both the tool-chain as well as the integrated development environments. However, both the framework as well as the IDE and tool-set remain fully backward compatible with Java 7. We have added documentation to help configuring aspects of the framework to use Java 7 or to upgrade existing projects to Java 8. See: <a href="https://github.com/devonfw/devon/wiki/Compatibility-guide-for-Java7,-Java8-and-Tomcat7,-Tomcat8">Compatibility guide for Java7, Java8 and Tomcat7, Tomcat8</a></p>
</div>
</div>
<div class="sect3">
<h4 id="release-notes-version-2.1.asciidoc_full-linux-support">68.3.13. Full Linux support</h4>
<div class="paragraph">
<p>In order to fully support the move towards the Cloud, from version 2.1. "Balu" onwards, devonfw is fully supported on Linux. Linux is the de-facto standard for most Cloud providers. We currently only offer first-class support for Ubuntu 16.04 LTS onward but most aspects of devonfw should run without problems on other and older distributions as well.</p>
</div>
</div>
<div class="sect3">
<h4 id="release-notes-version-2.1.asciidoc_initial-atom-support">68.3.14. Initial ATOM support</h4>
<div class="paragraph">
<p>Atom is a text editor that&#8217;s modern, approachable, yet hackable to the core—a tool you can customize to do anything but also use productively without ever touching a config file. It is turning into a standard for modern web development. In devonfw 2.1 "Balu" we provide a script which installs automatically the most recent version of Atom in the devonfw distribution with a preconfigured set of essential plugins. See: <a href="https://github.com/oasp/oasp-atom-ide/wiki">OASP/devonfw Atom editor ("IDE") settings &amp; packages</a></p>
</div>
</div>
<div class="sect3">
<h4 id="release-notes-version-2.1.asciidoc_database-support">68.3.15. Database support</h4>
<div class="paragraph">
<p>Through JPA (and now Spring Data as well) devonfw supports many databases. In Balu we&#8217;ve extended this support to prepared configuration, extensive documentations and supporting examples for all major "Enterprise" DB servers. So it becomes even easier for engagements to start using these standard database options. Currently we provide this extended support for Oracle, Microsoft SQL Server, MySQL and PostgreSQL.
For more information see: <a href="https://github.com/devonfw/devon4j/wiki/guide-database-migration">OASP Database Migration Guide</a></p>
</div>
</div>
<div class="sect3">
<h4 id="release-notes-version-2.1.asciidoc_file-upload-and-download">68.3.16. File upload and download</h4>
<div class="paragraph">
<p>File up and download was supported in previous version of the framework, but as these operations are common but complex, we&#8217;ve extended the base functionality and improved the available documentation so it becomes substantially easier to offer both File up- as well as download in devonfw based applications. See: <a href="https://github.com/devonfw/devon-guide/wiki/cookbook-File-Upload-and-Download">devonfw Guide Cookbook: File Upload and Download</a></p>
</div>
</div>
<div class="sect3">
<h4 id="release-notes-version-2.1.asciidoc_internationalisation-i18n-improvements">68.3.17. Internationalisation (I18N) improvements</h4>
<div class="paragraph">
<p>Likewise, existing basic Internationalisation (I18N) support has been significantly enhanced through an new devonfw module and extended to support Ext JS and Angular 2 apps as well. This means that both server as well as client side applications can be made easily to support multiple languages ("locales"), using industry standard tools and without touching programming code (essential when working with teams of translators). For more information see: <a href="https://github.com/devonfw/devon-guide/wiki/cookbook-i18n-module">The I18N (Internationalization) module</a> and <a href="https://github.com/devonfw/devon-guide/wiki/Client-GUI-Sencha-i18n">Client GUI Sencha i18n</a></p>
</div>
</div>
<div class="sect3">
<h4 id="release-notes-version-2.1.asciidoc_asynchronous-http-support">68.3.18. Asynchronous HTTP support</h4>
<div class="paragraph">
<p>Asynchronous HTTP is an important feature allowing so-called "long polling" HTTP Requests (for streaming applications, for example) or with requests sending large amounts of data. By making HTTP Requests asynchronous, devonfw server instances can better support these types of use-cases while offering far better performance. Documentation about how to include the new devonfw module implementing this feature can be found at: <a href="https://github.com/devonfw/devon-guide/wiki/cookbook-async-module">The devonfw async module</a></p>
</div>
</div>
<div class="sect3">
<h4 id="release-notes-version-2.1.asciidoc_security-and-license-guarantees">68.3.19. Security and License guarantees</h4>
<div class="paragraph">
<p>In devonfw security comes first. The components of the framework are designed and implemented according to the recommendations and guidelines as specified by OWASP in order to confront the top 10 security vulnerabilities.</p>
</div>
<div class="paragraph">
<p>From version 2.1 "Balu" onward we certify that devonfw has been scanned by software from "Black Duck". This verifies that devonfw is based on 100% Open Source Software (non Copyleft) and demonstrates that at moment of release there are no known, critical security flaws. Less critical issues are clearly documented.</p>
</div>
</div>
<div class="sect3">
<h4 id="release-notes-version-2.1.asciidoc_documentation-improvements">68.3.20. Documentation improvements</h4>
<div class="paragraph">
<p>Apart from the previously mentioned additions and improvements to diverse aspects of the devonfw documentation, principally the devonfw Guide,  there are a number of other important changes. We&#8217;ve incorporated the Devon Modules Developer´s Guide which describes how to extend devonfw with its Spring-based module system. Furthermore we&#8217;ve significantly improved the Guide to the usage of web services. We&#8217;ve included a Compatibility Guide which details a series of considerations related with different version of the framework as well as Java 7 vs 8. And finally, we&#8217;ve extended the F.A.Q. to provide the users with direct answers to common, Frequently Asked Questions.</p>
</div>
</div>
<div class="sect3">
<h4 id="release-notes-version-2.1.asciidoc_contributors">68.3.21. Contributors</h4>
<div class="paragraph">
<p>Many thanks to adrianbielewicz, aferre777, amarinso, arenstedt, azzigeorge, cbeldacap, cmammado, crisjdiaz, csiwiak, Dalgar, drhoet, Drophoff, dumbNickname, EastWindShak, fawinter, fbougeno, fkreis, GawandeKunal, henning-cg, hennk, hohwille, ivanderk, jarek-jpa, jart, jensbartelheimer, jhcore, jkokoszk, julianmetzler, kalmuczakm, kiran-vadla, kowalj, lgoerlach, ManjiriBirajdar, MarcoRose, maybeec, mmatczak, nelooo, oelsabba, pablo-parra, patrhel, pawelkorzeniowski, PriyankaBelorkar, RobertoGM, sekaiser, sesslinger, SimonHuber, sjimenez77, sobkowiak, sroeger, ssarmokadam, subashbasnet, szendo, tbialecki, thoptr, tsowada, znazir and anyone who we may have forgotten to add!</p>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="footnotes">
<hr>
<div class="footnote" id="_footnotedef_1">
<a href="#_footnoteref_1">1</a>. "Stammdaten" in German.
</div>
<div class="footnote" id="_footnotedef_2">
<a href="#_footnoteref_2">2</a>. A package is a file or directory that is described by a package.json. .
</div>
</div>
<div id="footer">
<div id="footer-text">
</div>
</div>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.13.1/styles/github.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.13.1/highlight.min.js"></script>
<script>hljs.initHighlighting()</script>
</body>
</html>